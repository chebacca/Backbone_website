import{j as e,B as o,T as a,G as c,ae as De,aY as G,aT as Q,bh as Re,K as Ue,t as fe,v as ye,i as Fe,r as ke,a as F,af as Ne,u as ze,w as We,x as Ve,y as Be,ag as $e,z as Ke,D as _e,c as Ge,p as we,al as He,bS as Qe,a2 as Xe,H as Ye,aa as qe}from"./mui-CbJLuC6G.js";import{u as Je,r as n,L as k,b as Ee}from"./vendor-CjD1bmmO.js";import{u as Ze,c as I,e as P}from"./index-CottxbUI.js";import{c as H}from"./CloudProjectIntegration-Bnq00FO6.js";import{firestoreLicenseService as N}from"./FirestoreLicenseService-Bb2daPC7.js";import{isWebOnlyMode as es,auth as ss}from"./firebase-Bta7UujM.js";import{M as z}from"./MetricCard-DEDCS3oR.js";import{S as ts}from"./StorageWarningCard-CHo25xKI.js";import"./stripe-iaBWsbMy.js";import"./index.esm-D6OvRmrs.js";import"./index.esm-B6Q1BJpE.js";import"./index.esm-Cicvjgiv.js";var X=(s=>(s.BASIC="BASIC",s.PRO="PRO",s.ENTERPRISE="ENTERPRISE",s))(X||{}),Ie=(s=>(s.PENDING="PENDING",s.ACTIVE="ACTIVE",s.SUSPENDED="SUSPENDED",s.EXPIRED="EXPIRED",s.REVOKED="REVOKED",s))(Ie||{});const Se=[{type:"license",title:"License Activated",description:"Pro license activated for john.doe@company.com",timestamp:"2 hours ago",status:"success"},{type:"payment",title:"Payment Successful",description:"Monthly subscription renewed for $297.00",timestamp:"1 day ago",status:"success"},{type:"user",title:"Team Member Added",description:"Sarah Johnson added to development team",timestamp:"2 days ago",status:"success"},{type:"security",title:"Security Alert",description:"New device login detected from New York",timestamp:"3 days ago",status:"warning"}],as=s=>{switch(s){case"license":return e.jsx(De,{});case"payment":return e.jsx(qe,{});case"user":return e.jsx(Q,{});case"security":return e.jsx(Ye,{});default:return e.jsx(Xe,{})}},rs=s=>{switch(s){case"success":return"success.main";case"warning":return"warning.main";case"error":return"error.main";default:return"text.secondary"}},Rs=()=>{var ee;const{user:s}=Ze(),A=Je(),Pe=()=>(s==null?void 0:s.isTeamMember)===!0||(s==null?void 0:s.role)==="TEAM_MEMBER"||(s==null?void 0:s.memberRole)&&(s==null?void 0:s.memberRole)!=="OWNER"||localStorage.getItem("team_member_data")!==null,[Ae,Y]=n.useState(!0),[L,v]=n.useState(0),[T,f]=n.useState(0),[ns,y]=n.useState(0),[is,w]=n.useState(0),[W,E]=n.useState(""),[q,S]=n.useState(""),[os,g]=n.useState(!1),[cs,J]=n.useState(!1),[ls,Z]=n.useState(null),[V,m]=n.useState(0),[Le,b]=n.useState(0),[Te,j]=n.useState(0),[ds,ms]=n.useState(!1),[hs,us]=n.useState([]),[xs,gs]=n.useState([]),[bs,js]=n.useState(null),[ps,vs]=n.useState(!0),[fs,ys]=n.useState(null);n.useEffect(()=>{let l=!0;return(async()=>{var se,te,ae,re,ne,ie,oe,ce,le,de,me,he,ue,xe;try{Y(!0);const C=Pe();if(console.log("ðŸ” [DashboardOverview] User is team member:",C),C){console.log("ðŸ” [DashboardOverview] Fetching team member data only");try{const D=await H.getUserProjects();if(!l)return;const O=D||[];b(O.length),j(O.filter(M=>M.isActive&&!M.isArchived).length),v(0),f(0),y(0),w(0),E("Team Member"),S("N/A"),g(!1),m(0),console.log("ðŸ” [DashboardOverview] Team member data loaded successfully")}catch(D){console.error("ðŸ” [DashboardOverview] Error fetching team member data:",D),b(0),j(0),v(0),f(0),y(0),w(0),E("Team Member"),S("N/A"),g(!1),m(0)}}else{if(console.log("ðŸ” [DashboardOverview] Fetching account owner data"),es())try{const r=(se=ss.currentUser)==null?void 0:se.uid;let i=[];if(s!=null&&s.id)try{const t=await N.getMyLicenses(s.id);i.push(...t),console.log(`âœ… [DashboardOverview] Found ${t.length} licenses by backend userId`)}catch(t){console.warn("âš ï¸ [DashboardOverview] Failed to fetch licenses by backend userId:",t)}if(i.length===0&&r)try{const t=await N.getLicensesByFirebaseUid(r);i.push(...t),console.log(`âœ… [DashboardOverview] Found ${t.length} licenses by Firebase Auth UID`)}catch(t){console.warn("âš ï¸ [DashboardOverview] Failed to fetch licenses by Firebase Auth UID:",t)}if(i.length===0&&(s!=null&&s.email))try{const t=await N.getLicensesByEmail(s.email);i.push(...t),console.log(`âœ… [DashboardOverview] Found ${t.length} licenses by email`)}catch(t){console.warn("âš ï¸ [DashboardOverview] Failed to fetch licenses by email:",t)}if(i.length===0&&(s!=null&&s.organizationId))try{const t=await N.getOrganizationLicenses(s.organizationId);i.push(...t),console.log(`âœ… [DashboardOverview] Found ${t.length} organization licenses`)}catch(t){console.warn("âš ï¸ [DashboardOverview] Failed to fetch organization licenses:",t)}const p=i.filter((t,ve,R)=>ve===R.findIndex(U=>U.id===t.id));if(!l)return;const _=p.length,je=p.filter(t=>String(t.status||"").toUpperCase()==="ACTIVE").length;console.log("ðŸ“Š [DashboardOverview] License Summary:",{total:_,active:je,allLicenses:p.map(t=>({id:t.id,status:t.status,assignedTo:t.assignedToEmail}))}),f(_),v(je);const Me=await H.getUserProjects();if(!l)return;const pe=Me||[];if(b(pe.length),j(pe.filter(t=>t.isActive&&!t.isArchived).length),E(_>0?"pro":""),S(""),g(!1),m(0),J(!1),Z(null),console.log("âœ… [DashboardOverview] Loaded web-only data from Firestore"),s!=null&&s.organizationId)try{const t=await I.get(P.organizations.context()).catch(()=>null);if((ae=(te=t==null?void 0:t.data)==null?void 0:te.data)!=null&&ae.members){const R=t.data.data.members.filter(U=>U&&U.status==="ACTIVE").length;m(R),console.log(`âœ… [DashboardOverview] Found ${R} team members in org context`)}}catch(t){console.warn("âš ï¸ [DashboardOverview] Failed to fetch team member count:",t)}return}catch(r){console.warn("âš ï¸ [DashboardOverview] Web-only Firestore load failed; falling back to HTTP API:",r)}const[D,O,M,K,h]=await Promise.all([I.get(P.subscriptions.mySubscriptions()),I.get(P.licenses.analytics()),I.get(P.licenses.myLicenses()),H.getUserProjects(),I.get(P.organizations.context()).catch(()=>null)]);if(!l)return;const ge=((ne=(re=M.data)==null?void 0:re.data)==null?void 0:ne.licenses)??[],Ce=ge.length,Oe=ge.filter(r=>r.status===Ie.ACTIVE).length;f(Ce),v(Oe);const be=((oe=(ie=D.data)==null?void 0:ie.data)==null?void 0:oe.subscriptions)??[],d=be.find(r=>r.status==="ACTIVE")||be[0];if(d){if(E(((ce=d.tier)==null?void 0:ce.toLowerCase())??""),d.currentPeriodEnd){const r=new Date(d.currentPeriodEnd),i=Math.max(0,Math.ceil((r.getTime()-Date.now())/(1e3*60*60*24)));S(`${i} day${i===1?"":"s"}`)}g(d.tier===X.ENTERPRISE)}let u=0;if((de=(le=h==null?void 0:h.data)==null?void 0:le.data)!=null&&de.members)u=h.data.data.members.filter(i=>i&&i.status==="ACTIVE").length,console.log("[DashboardOverview] Found team members in org context:",u);else if((he=(me=h==null?void 0:h.data)==null?void 0:me.data)!=null&&he.organization){const r=h.data.data.organization;r.members&&Array.isArray(r.members)&&(u=r.members.filter(i=>i&&i.status==="ACTIVE").length,console.log("[DashboardOverview] Found team members in org object:",u))}else console.log("[DashboardOverview] No organization context available");u>0?(m(u),g(!0),console.log("[DashboardOverview] Setting team members count:",u)):d&&d.tier===X.ENTERPRISE?(m(d.seats||0),console.log("[DashboardOverview] Using subscription seats for Enterprise:",d.seats||0)):(m(0),console.log("[DashboardOverview] No team members found"));const x=(ue=O.data)==null?void 0:ue.data;if(x)if(x.summary){y(x.summary.totalEvents??0);const r=((xe=x.summary.eventTypes)==null?void 0:xe.SDK_DOWNLOAD_REQUEST)||0;w(r)}else x.totalEvents!==void 0&&(y(x.totalEvents),w(x.downloads||0));try{if(K){const r=K.length,i=K.filter(p=>p.isActive&&!p.isArchived).length;b(r),j(i)}}catch(r){console.error("Error processing cloud projects data:",r),b(0),j(0)}J(!1),Z(null)}}catch(C){if(console.error("Error fetching dashboard data:",C),!l)return;v(0),f(0),y(0),w(0),E(""),S(""),g(!1),m(0),b(0),j(0)}finally{l&&Y(!1)}})(),()=>{l=!1}},[]);const B=n.useMemo(()=>T<=0?0:Math.round(L/T*100),[L,T]);return Ae?e.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(a,{children:"Loading dashboard..."})}):e.jsxs(o,{sx:{p:3},children:[e.jsx(o,{sx:{mb:4},children:e.jsxs(o,{sx:{mb:4},children:[e.jsxs(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:["Welcome back, ",((ee=s==null?void 0:s.name)==null?void 0:ee.split(" ")[0])||"User","! ðŸ‘‹"]}),e.jsx(a,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Here's what's happening with your BackboneLogic, Inc. licenses"})]})}),e.jsxs(c,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(c,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(z,{title:"Active Licenses",value:L,icon:e.jsx(De,{}),trend:{value:12,direction:"up"},color:"primary"})}),V>0&&e.jsx(c,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(G,{title:"Click to view Team Management",arrow:!0,children:e.jsx("div",{children:e.jsx(z,{title:"Team Members",value:V,icon:e.jsx(Q,{}),trend:{value:8,direction:"up"},color:"secondary",onClick:()=>A("/dashboard/team")})})})}),e.jsx(c,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(G,{title:"Click to view Cloud Projects",arrow:!0,children:e.jsx("div",{children:e.jsx(z,{title:"Total Projects",value:Le,icon:e.jsx(Re,{}),trend:{value:15,direction:"up"},color:"success",onClick:()=>A("/dashboard/cloud-projects")})})})}),e.jsx(c,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(G,{title:"Click to view Cloud Projects",arrow:!0,children:e.jsx("div",{children:e.jsx(z,{title:"Active Projects",value:Te,icon:e.jsx(Ue,{}),trend:{value:8,direction:"up"},color:"warning",onClick:()=>A("/dashboard/cloud-projects")})})})})]}),e.jsx(ts,{onUpgrade:()=>A("/pricing"),compact:!0}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,lg:8,children:e.jsx(o,{children:e.jsx(fe,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",mb:3},children:e.jsxs(ye,{children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600,mb:3},children:"License Overview"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsxs(c,{item:!0,xs:12,md:6,children:[e.jsxs(o,{sx:{mb:3},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:"License Utilization"}),e.jsxs(a,{variant:"body2",sx:{fontWeight:600},children:[B,"%"]})]}),e.jsx(Fe,{variant:"determinate",value:B,sx:{height:8,borderRadius:4,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:4,background:B>80?"linear-gradient(90deg, #ff9800 0%, #f44336 100%)":"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}}),e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[L," of ",T," licenses in use"]})]}),e.jsxs(o,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Current Plan"}),e.jsx(ke,{label:W&&W.charAt(0).toUpperCase()+W.slice(1).toLowerCase()||"â€”",color:"primary",sx:{fontWeight:600,mb:2}}),e.jsx(a,{variant:"body2",color:"text.secondary",children:q?`Next renewal in ${q}`:"â€”"})]})]}),e.jsxs(c,{item:!0,xs:12,md:6,children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Quick Actions"}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:1},children:[V>0&&e.jsx(F,{variant:"outlined",startIcon:e.jsx(Q,{}),component:k,to:"/dashboard/team",sx:{justifyContent:"flex-start"},children:"Add Team Member"}),e.jsx(F,{variant:"outlined",startIcon:e.jsx(Ne,{}),component:k,to:"/dashboard/downloads",sx:{justifyContent:"flex-start"},children:"Download SDK"}),e.jsx(F,{variant:"outlined",startIcon:e.jsx(ze,{}),component:k,to:"/dashboard/billing",sx:{justifyContent:"flex-start"},children:"Upgrade Plan"})]})]})]})]})})})}),e.jsx(c,{item:!0,xs:12,lg:4,children:e.jsx(o,{children:e.jsx(fe,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",height:"fit-content"},children:e.jsxs(ye,{children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Recent Activity"}),e.jsx(We,{dense:!0,children:Se.map((l,$)=>e.jsxs(Ee.Fragment,{children:[e.jsxs(Ve,{sx:{px:0},children:[e.jsx(Be,{sx:{minWidth:40},children:e.jsx($e,{sx:{width:32,height:32,bgcolor:rs(l.status),fontSize:"1rem"},children:as(l.type)})}),e.jsx(Ke,{primary:l.title,secondary:e.jsxs(Ee.Fragment,{children:[e.jsx(a,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:l.description}),e.jsx(a,{variant:"caption",color:"text.secondary",children:l.timestamp})]}),primaryTypographyProps:{variant:"body2",fontWeight:500}})]}),$<Se.length-1&&e.jsx(_e,{variant:"inset",component:"li",sx:{borderColor:"rgba(255,255,255,0.1)"}})]},$))}),e.jsx(F,{variant:"text",size:"small",sx:{mt:2,color:"primary.main"},component:k,to:"/dashboard/activity",children:"View All Activity"})]})})})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(o,{children:e.jsxs(Ge,{sx:{p:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600,mb:2},children:"System Status"}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(we,{sx:{color:"success.main",fontSize:20}}),e.jsxs(o,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"License Server"}),e.jsx(a,{variant:"caption",color:"success.main",children:"Operational"})]})]})}),e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(we,{sx:{color:"success.main",fontSize:20}}),e.jsxs(o,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"API Services"}),e.jsx(a,{variant:"caption",color:"success.main",children:"Operational"})]})]})}),e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(He,{sx:{color:"warning.main",fontSize:20}}),e.jsxs(o,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Maintenance"}),e.jsx(a,{variant:"caption",color:"warning.main",children:"Scheduled 2AM EST"})]})]})}),e.jsx(c,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Qe,{sx:{color:"primary.main",fontSize:20}}),e.jsxs(o,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"SDK Version"}),e.jsx(a,{variant:"caption",color:"primary.main",children:"v14.2.1 Available"})]})]})})]})]})})})]})]})};export{Rs as default};
