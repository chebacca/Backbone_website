import{j as e,B as n,T as t,G as i,ae as je,aY as B,aT as _,bh as De,K as Ie,t as xe,v as ue,i as Ce,r as Te,a as M,af as Le,u as Me,w as Re,x as Oe,y as Ue,ag as ke,z as Ne,D as We,c as Fe,p as he,al as ze,bS as Ve,a2 as Be,H as Ke,aa as _e}from"./mui-CbJLuC6G.js";import{u as Ge,r as a,L as R,b as ge}from"./vendor-CjD1bmmO.js";import{u as He,c as O,e as U}from"./index-ChS-x-Ml.js";import{c as K}from"./CloudProjectIntegration-C_KVfnFv.js";import{firestoreLicenseService as $e}from"./FirestoreLicenseService-B7wrfFa3.js";import{isWebOnlyMode as Qe,auth as Xe}from"./firebase-CxN2zutr.js";import{M as k}from"./MetricCard-DEDCS3oR.js";import{S as Ye}from"./StorageWarningCard-BikHBSt6.js";import"./stripe-iaBWsbMy.js";import"./index.esm-D6OvRmrs.js";import"./index.esm-B6Q1BJpE.js";import"./index.esm-Cicvjgiv.js";var G=(s=>(s.BASIC="BASIC",s.PRO="PRO",s.ENTERPRISE="ENTERPRISE",s))(G||{}),pe=(s=>(s.PENDING="PENDING",s.ACTIVE="ACTIVE",s.SUSPENDED="SUSPENDED",s.EXPIRED="EXPIRED",s.REVOKED="REVOKED",s))(pe||{});const be=[{type:"license",title:"License Activated",description:"Pro license activated for john.doe@company.com",timestamp:"2 hours ago",status:"success"},{type:"payment",title:"Payment Successful",description:"Monthly subscription renewed for $297.00",timestamp:"1 day ago",status:"success"},{type:"user",title:"Team Member Added",description:"Sarah Johnson added to development team",timestamp:"2 days ago",status:"success"},{type:"security",title:"Security Alert",description:"New device login detected from New York",timestamp:"3 days ago",status:"warning"}],Je=s=>{switch(s){case"license":return e.jsx(je,{});case"payment":return e.jsx(_e,{});case"user":return e.jsx(_,{});case"security":return e.jsx(Ke,{});default:return e.jsx(Be,{})}},qe=s=>{switch(s){case"success":return"success.main";case"warning":return"warning.main";case"error":return"error.main";default:return"text.secondary"}},Is=()=>{var Y;const{user:s}=He(),P=Ge(),fe=()=>(s==null?void 0:s.isTeamMember)===!0||(s==null?void 0:s.role)==="TEAM_MEMBER"||(s==null?void 0:s.memberRole)&&(s==null?void 0:s.memberRole)!=="OWNER"||localStorage.getItem("team_member_data")!==null,[ve,H]=a.useState(!0),[A,j]=a.useState(0),[D,p]=a.useState(0),[Ze,f]=a.useState(0),[es,v]=a.useState(0),[N,y]=a.useState(""),[$,w]=a.useState(""),[ss,h]=a.useState(!1),[ts,Q]=a.useState(!1),[rs,X]=a.useState(null),[W,m]=a.useState(0),[ye,g]=a.useState(0),[we,b]=a.useState(0),[as,ns]=a.useState(!1),[is,os]=a.useState([]),[cs,ls]=a.useState([]),[ds,ms]=a.useState(null),[xs,us]=a.useState(!0),[hs,gs]=a.useState(null);a.useEffect(()=>{let c=!0;return(async()=>{var J,q,Z,ee,se,te,re,ae,ne,ie,oe,ce;try{H(!0);const I=fe();if(console.log("🔍 [DashboardOverview] User is team member:",I),I){console.log("🔍 [DashboardOverview] Fetching team member data only");try{const E=await K.getUserProjects();if(!c)return;const C=E||[];g(C.length),b(C.filter(T=>T.isActive&&!T.isArchived).length),j(0),p(0),f(0),v(0),y("Team Member"),w("N/A"),h(!1),m(0),console.log("🔍 [DashboardOverview] Team member data loaded successfully")}catch(E){console.error("🔍 [DashboardOverview] Error fetching team member data:",E),g(0),b(0),j(0),p(0),f(0),v(0),y("Team Member"),w("N/A"),h(!1),m(0)}}else{if(console.log("🔍 [DashboardOverview] Fetching account owner data"),Qe())try{const r=(J=Xe.currentUser)==null?void 0:J.uid;let o=[];if(r?o=await $e.getLicensesByFirebaseUid(r):console.warn("⚠️ [DashboardOverview] No Firebase UID; licenses default to 0"),!c)return;const S=o.length,Pe=o.filter(L=>String(L.status||"").toUpperCase()==="ACTIVE").length;p(S),j(Pe);const Ae=await K.getUserProjects();if(!c)return;const me=Ae||[];g(me.length),b(me.filter(L=>L.isActive&&!L.isArchived).length),y(S>0?"pro":""),w(""),h(!1),m(0),Q(!1),X(null),console.log("✅ [DashboardOverview] Loaded web-only data from Firestore");return}catch(r){console.warn("⚠️ [DashboardOverview] Web-only Firestore load failed; falling back to HTTP API:",r)}const[E,C,T,V,d]=await Promise.all([O.get(U.subscriptions.mySubscriptions()),O.get(U.licenses.analytics()),O.get(U.licenses.myLicenses()),K.getUserProjects(),O.get(U.organizations.context()).catch(()=>null)]);if(!c)return;const le=((Z=(q=T.data)==null?void 0:q.data)==null?void 0:Z.licenses)??[],Ee=le.length,Se=le.filter(r=>r.status===pe.ACTIVE).length;p(Ee),j(Se);const de=((se=(ee=E.data)==null?void 0:ee.data)==null?void 0:se.subscriptions)??[],l=de.find(r=>r.status==="ACTIVE")||de[0];if(l){if(y(((te=l.tier)==null?void 0:te.toLowerCase())??""),l.currentPeriodEnd){const r=new Date(l.currentPeriodEnd),o=Math.max(0,Math.ceil((r.getTime()-Date.now())/(1e3*60*60*24)));w(`${o} day${o===1?"":"s"}`)}h(l.tier===G.ENTERPRISE)}let x=0;if((ae=(re=d==null?void 0:d.data)==null?void 0:re.data)!=null&&ae.members)x=d.data.data.members.filter(o=>o&&o.status==="ACTIVE").length,console.log("[DashboardOverview] Found team members in org context:",x);else if((ie=(ne=d==null?void 0:d.data)==null?void 0:ne.data)!=null&&ie.organization){const r=d.data.data.organization;r.members&&Array.isArray(r.members)&&(x=r.members.filter(o=>o&&o.status==="ACTIVE").length,console.log("[DashboardOverview] Found team members in org object:",x))}else console.log("[DashboardOverview] No organization context available");x>0?(m(x),h(!0),console.log("[DashboardOverview] Setting team members count:",x)):l&&l.tier===G.ENTERPRISE?(m(l.seats||0),console.log("[DashboardOverview] Using subscription seats for Enterprise:",l.seats||0)):(m(0),console.log("[DashboardOverview] No team members found"));const u=(oe=C.data)==null?void 0:oe.data;if(u)if(u.summary){f(u.summary.totalEvents??0);const r=((ce=u.summary.eventTypes)==null?void 0:ce.SDK_DOWNLOAD_REQUEST)||0;v(r)}else u.totalEvents!==void 0&&(f(u.totalEvents),v(u.downloads||0));try{if(V){const r=V.length,o=V.filter(S=>S.isActive&&!S.isArchived).length;g(r),b(o)}}catch(r){console.error("Error processing cloud projects data:",r),g(0),b(0)}Q(!1),X(null)}}catch(I){if(console.error("Error fetching dashboard data:",I),!c)return;j(0),p(0),f(0),v(0),y(""),w(""),h(!1),m(0),g(0),b(0)}finally{c&&H(!1)}})(),()=>{c=!1}},[]);const F=a.useMemo(()=>D<=0?0:Math.round(A/D*100),[A,D]);return ve?e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(t,{children:"Loading dashboard..."})}):e.jsxs(n,{sx:{p:3},children:[e.jsx(n,{sx:{mb:4},children:e.jsxs(n,{sx:{mb:4},children:[e.jsxs(t,{variant:"h4",sx:{fontWeight:700,mb:1},children:["Welcome back, ",((Y=s==null?void 0:s.name)==null?void 0:Y.split(" ")[0])||"User","! 👋"]}),e.jsx(t,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Here's what's happening with your BackboneLogic, Inc. licenses"})]})}),e.jsxs(i,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(i,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(k,{title:"Active Licenses",value:A,icon:e.jsx(je,{}),trend:{value:12,direction:"up"},color:"primary"})}),W>0&&e.jsx(i,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(B,{title:"Click to view Team Management",arrow:!0,children:e.jsx("div",{children:e.jsx(k,{title:"Team Members",value:W,icon:e.jsx(_,{}),trend:{value:8,direction:"up"},color:"secondary",onClick:()=>P("/dashboard/team")})})})}),e.jsx(i,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(B,{title:"Click to view Cloud Projects",arrow:!0,children:e.jsx("div",{children:e.jsx(k,{title:"Total Projects",value:ye,icon:e.jsx(De,{}),trend:{value:15,direction:"up"},color:"success",onClick:()=>P("/dashboard/cloud-projects")})})})}),e.jsx(i,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(B,{title:"Click to view Cloud Projects",arrow:!0,children:e.jsx("div",{children:e.jsx(k,{title:"Active Projects",value:we,icon:e.jsx(Ie,{}),trend:{value:8,direction:"up"},color:"warning",onClick:()=>P("/dashboard/cloud-projects")})})})})]}),e.jsx(Ye,{onUpgrade:()=>P("/pricing"),compact:!0}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,lg:8,children:e.jsx(n,{children:e.jsx(xe,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",mb:3},children:e.jsxs(ue,{children:[e.jsx(t,{variant:"h6",sx:{fontWeight:600,mb:3},children:"License Overview"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsxs(i,{item:!0,xs:12,md:6,children:[e.jsxs(n,{sx:{mb:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"License Utilization"}),e.jsxs(t,{variant:"body2",sx:{fontWeight:600},children:[F,"%"]})]}),e.jsx(Ce,{variant:"determinate",value:F,sx:{height:8,borderRadius:4,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:4,background:F>80?"linear-gradient(90deg, #ff9800 0%, #f44336 100%)":"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[A," of ",D," licenses in use"]})]}),e.jsxs(n,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Current Plan"}),e.jsx(Te,{label:N&&N.charAt(0).toUpperCase()+N.slice(1).toLowerCase()||"—",color:"primary",sx:{fontWeight:600,mb:2}}),e.jsx(t,{variant:"body2",color:"text.secondary",children:$?`Next renewal in ${$}`:"—"})]})]}),e.jsxs(i,{item:!0,xs:12,md:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Quick Actions"}),e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:1},children:[W>0&&e.jsx(M,{variant:"outlined",startIcon:e.jsx(_,{}),component:R,to:"/dashboard/team",sx:{justifyContent:"flex-start"},children:"Add Team Member"}),e.jsx(M,{variant:"outlined",startIcon:e.jsx(Le,{}),component:R,to:"/dashboard/downloads",sx:{justifyContent:"flex-start"},children:"Download SDK"}),e.jsx(M,{variant:"outlined",startIcon:e.jsx(Me,{}),component:R,to:"/dashboard/billing",sx:{justifyContent:"flex-start"},children:"Upgrade Plan"})]})]})]})]})})})}),e.jsx(i,{item:!0,xs:12,lg:4,children:e.jsx(n,{children:e.jsx(xe,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",height:"fit-content"},children:e.jsxs(ue,{children:[e.jsx(t,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Recent Activity"}),e.jsx(Re,{dense:!0,children:be.map((c,z)=>e.jsxs(ge.Fragment,{children:[e.jsxs(Oe,{sx:{px:0},children:[e.jsx(Ue,{sx:{minWidth:40},children:e.jsx(ke,{sx:{width:32,height:32,bgcolor:qe(c.status),fontSize:"1rem"},children:Je(c.type)})}),e.jsx(Ne,{primary:c.title,secondary:e.jsxs(ge.Fragment,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:c.description}),e.jsx(t,{variant:"caption",color:"text.secondary",children:c.timestamp})]}),primaryTypographyProps:{variant:"body2",fontWeight:500}})]}),z<be.length-1&&e.jsx(We,{variant:"inset",component:"li",sx:{borderColor:"rgba(255,255,255,0.1)"}})]},z))}),e.jsx(M,{variant:"text",size:"small",sx:{mt:2,color:"primary.main"},component:R,to:"/dashboard/activity",children:"View All Activity"})]})})})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(n,{children:e.jsxs(Fe,{sx:{p:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:600,mb:2},children:"System Status"}),e.jsxs(i,{container:!0,spacing:3,children:[e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(he,{sx:{color:"success.main",fontSize:20}}),e.jsxs(n,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:500},children:"License Server"}),e.jsx(t,{variant:"caption",color:"success.main",children:"Operational"})]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(he,{sx:{color:"success.main",fontSize:20}}),e.jsxs(n,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:500},children:"API Services"}),e.jsx(t,{variant:"caption",color:"success.main",children:"Operational"})]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ze,{sx:{color:"warning.main",fontSize:20}}),e.jsxs(n,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:500},children:"Maintenance"}),e.jsx(t,{variant:"caption",color:"warning.main",children:"Scheduled 2AM EST"})]})]})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ve,{sx:{color:"primary.main",fontSize:20}}),e.jsxs(n,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:500},children:"SDK Version"}),e.jsx(t,{variant:"caption",color:"primary.main",children:"v14.2.1 Available"})]})]})})]})]})})})]})]})};export{Is as default};
