const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FirestoreLicenseService-D7GNG3E-.js","assets/index-DVGPJOCC.js","assets/mui-D8UjIA2s.js","assets/vendor-CjD1bmmO.js","assets/stripe-CUttI3Gx.js","assets/index-CBai7h7s.css","assets/index.esm-CZcVTLdu.js","assets/index.esm-COtph9ny.js","assets/index.esm-Bm1DnCIa.js","assets/firebase-_rYwBkzE.js"])))=>i.map(i=>d[i]);
import{u as Pa,_ as D,c as X,e as Z}from"./index-DVGPJOCC.js";import{j as e,B as oe,T as ee,a as J,aS as ya,G as E,aT as Sa,p as Ve,u as Ke,ao as Ea,c as Ia,ap as ja,aq as Aa,ar as ea,as as Q,at as Ma,ag as _a,r as aa,aU as Da,aV as Ca,g as fe,au as Oa,aW as Na,ai as Ra,a4 as La,a5 as B,y as Le,ay as za,aX as ta,aw as ze,aB as ye,aC as Se,aD as Ee,d as ge,e as ae,aG as Fe,aH as ke,aI as $e,I as Ie,V as je,h as Ae,aE as Me,al as Fa}from"./mui-D8UjIA2s.js";import{r as A}from"./vendor-CjD1bmmO.js";import{u as ka}from"./notistack.esm-Ca-E78ev.js";import{M as _e}from"./MetricCard-B_DL-kwb.js";import"./stripe-CUttI3Gx.js";const $a=w=>{switch(w){case"admin":return"secondary";case"owner":return"secondary";case"manager":return"info";case"member":return"success";case"viewer":return"default";default:return"default"}},Va=w=>{switch(w){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},Ua=w=>{switch(w){case"active":return e.jsx(Ve,{});case"pending":return e.jsx(Fa,{});case"suspended":return e.jsx(ta,{});default:return e.jsx(Ve,{})}},Za=()=>{const{enqueueSnackbar:w}=ka(),{user:f}=Pa(),sa=()=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";let s="";for(let c=0;c<12;c++)s+=a.charAt(Math.floor(Math.random()*a.length));return s},[na,ie]=A.useState([]),[q,re]=A.useState({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}),V=typeof window<"u"&&(window.location.hostname.includes("web.app")||window.location.hostname.includes("firebaseapp.com")||window.location.hostname.includes("backbone-logic.web.app")||window.location.hostname.includes("backbone-client.web.app")||window.WEBONLY_MODE===!0||localStorage.getItem("WEB_ONLY")==="true"||localStorage.getItem("USE_FIRESTORE")==="true"),[I,be]=A.useState(null),[Wa,we]=A.useState(""),[Ba,Ue]=A.useState(null),[H,De]=A.useState(null),le=(a,{includeTime:s=!1}={})=>{try{if(!a){const m=new Date;return s?m.toISOString():m.toISOString().slice(0,10)}if(typeof a=="string"||typeof a=="number"){const m=new Date(a);if(!Number.isNaN(m.getTime()))return s?m.toISOString():m.toISOString().slice(0,10)}if(typeof a=="object"){const m=a._seconds,y=a._nanoseconds??0;if(typeof m=="number"){const S=m*1e3+Math.floor(y/1e6),N=new Date(S);return s?N.toISOString():N.toISOString().slice(0,10)}}}catch{}const c=new Date;return s?c.toISOString():c.toISOString().slice(0,10)};A.useEffect(()=>{let a=!0;return(async()=>{var s,c,m,y,S,N,R,z,L,h,g,b,M,u;try{console.log("[TeamPage] useEffect - Web-only mode detection:"),console.log("  - isWebOnlyHost:",V),console.log("  - hostname:",typeof window<"u"?window.location.hostname:"N/A"),console.log("  - WEBONLY_MODE:",typeof window<"u"?window.WEBONLY_MODE:"N/A"),console.log("  - localStorage WEB_ONLY:",typeof window<"u"?localStorage.getItem("WEB_ONLY"):"N/A"),console.log("  - localStorage USE_FIRESTORE:",typeof window<"u"?localStorage.getItem("USE_FIRESTORE"):"N/A"),console.log("  - user?.id:",f==null?void 0:f.id);let n=null,v=[],P=null,U=null;if(V&&(f!=null&&f.id))try{console.log("[TeamPage] Web-only mode: Getting data from Firestore...");const{firestoreLicenseService:t}=await D(async()=>{const{firestoreLicenseService:_}=await import("./FirestoreLicenseService-D7GNG3E-.js");return{firestoreLicenseService:_}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),{getFirestore:l,collection:r,query:o,where:p,getDocs:x}=await D(async()=>{const{getFirestore:_,collection:G,query:se,where:K,getDocs:$}=await import("./index.esm-CZcVTLdu.js");return{getFirestore:_,collection:G,query:se,where:K,getDocs:$}},__vite__mapDeps([6,7])),{db:k}=await D(async()=>{const{db:_}=await import("./firebase-_rYwBkzE.js");return{db:_}},__vite__mapDeps([9,1,2,3,4,5,7,6,8])),j=await x(o(r(k,"users"),p("id","==",f.id)));if(console.log("[TeamPage] User document query result:",j.empty?"empty":"found",j.docs.length,"docs"),j.empty)console.warn("[TeamPage] No user document found in Firestore for ID:",f.id);else{const _=j.docs[0].data();if(console.log("[TeamPage] User data from Firestore:",_),_.organizationId){console.log("[TeamPage] User has organizationId:",_.organizationId);const G=await x(o(r(k,"organizations"),p("id","==",_.organizationId)));console.log("[TeamPage] Organization query result:",G.empty?"empty":"found",G.docs.length,"docs"),G.empty?(console.warn("[TeamPage] No organization found for ID:",_.organizationId),console.log("[TeamPage] Creating fallback organization object..."),n={id:_.organizationId,name:"Enterprise Organization",type:"ENTERPRISE",status:"ACTIVE"},console.log("[TeamPage] Created fallback organization:",n)):(n={id:_.organizationId,...G.docs[0].data()},console.log("[TeamPage] Found organization in Firestore:",n));const se=o(r(k,"teamMembers"),p("organizationId","==",_.organizationId));v=(await x(se)).docs.map(me=>({id:me.id,...me.data()})),console.log("[TeamPage] Found team members in Firestore:",v.length);const $=o(r(k,"org_members"),p("userId","==",f.id)),ne=await x($);ne.empty?console.warn("[TeamPage] No org_members record found for user:",f.id):(U=ne.docs[0].data().role,console.log("[TeamPage] User role from Firestore:",U))}else{console.warn("[TeamPage] User has no organizationId in Firestore"),console.log("[TeamPage] Trying to get organization ID from team members...");const G=o(r(k,"teamMembers")),K=(await x(G)).docs.find($=>$.data().email===f.email);if(K){const $=K.data();if(console.log("[TeamPage] Found team member data:",$),$.organizationId){console.log("[TeamPage] Using organization ID from team member:",$.organizationId);const ne=await x(o(r(k,"organizations"),p("id","==",$.organizationId)));if(ne.empty){console.log("[TeamPage] Creating fallback organization from team member data..."),n={id:$.organizationId,name:"Enterprise Organization",type:"ENTERPRISE",status:"ACTIVE"},console.log("[TeamPage] Created fallback organization from team member:",n);const me=o(r(k,"teamMembers"),p("organizationId","==",$.organizationId));v=(await x(me)).docs.map(pe=>({id:pe.id,...pe.data()})),console.log("[TeamPage] Found team members from team member query:",v.length)}else{n={id:$.organizationId,...ne.docs[0].data()},console.log("[TeamPage] Found organization from team member:",n);const me=o(r(k,"teamMembers"),p("organizationId","==",$.organizationId));v=(await x(me)).docs.map(pe=>({id:pe.id,...pe.data()})),console.log("[TeamPage] Found team members from team member query:",v.length)}}}}}}catch(t){console.warn("[TeamPage] Failed to get data from Firestore:",t)}if(!V&&!n){console.log("[TeamPage] Not in web-only mode, falling back to API calls...");const t=await X.get(Z.organizations.context()).catch(()=>null),l=((c=(s=t==null?void 0:t.data)==null?void 0:s.data)==null?void 0:c.organization)||null,r=((y=(m=t==null?void 0:t.data)==null?void 0:m.data)==null?void 0:y.members)||[],o=((N=(S=t==null?void 0:t.data)==null?void 0:S.data)==null?void 0:N.activeSubscription)||null,p=((z=(R=t==null?void 0:t.data)==null?void 0:R.data)==null?void 0:z.primaryRole)||null;if(n=l,v=r,P=o,!n){const x=await X.get(Z.organizations.my()),k=((h=(L=x==null?void 0:x.data)==null?void 0:L.data)==null?void 0:h.owned)??[],j=((b=(g=x==null?void 0:x.data)==null?void 0:g.data)==null?void 0:b.memberOf)??[];n=k[0]||j[0]||null,v=(n==null?void 0:n.members)||[]}}if(!n){a&&(be(null),we(""),ie([]),re({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}));return}const Y=v.filter(t=>t.status==="ACTIVE").length;let F=0;P&&P.status==="ACTIVE"&&P.organizationId===n.id?F=Number(P.seats||0):V||(F=(((u=(M=(await X.get(Z.subscriptions.mySubscriptions())).data)==null?void 0:M.data)==null?void 0:u.subscriptions)??[]).filter(o=>o.organizationId===n.id&&o.status==="ACTIVE").reduce((o,p)=>(!P&&p.status==="ACTIVE"&&(P=p),o+(p.seats||0)),0));let C=Math.max(0,F-Y);if(console.log(`[TeamPage] Web-only mode check: ${V}, User ID: ${f==null?void 0:f.id}, Org ID: ${n==null?void 0:n.id}`),V&&(f!=null&&f.id)&&(n!=null&&n.id))try{const{firestoreLicenseService:t}=await D(async()=>{const{firestoreLicenseService:r}=await import("./FirestoreLicenseService-D7GNG3E-.js");return{firestoreLicenseService:r}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]));console.log(`[TeamPage] Checking Firestore licenses for organization: ${n.id}`);let l=await t.getUnassignedLicenses(n.id);if(console.log(`[TeamPage] Unassigned licenses found: ${l.length}`),l.length===0){console.log("[TeamPage] No unassigned licenses found, trying organization licenses...");const r=await t.getOrganizationLicenses(n.id);console.log(`[TeamPage] Organization licenses found: ${r.length}`),l=r.filter(o=>o.status==="ACTIVE"&&!o.assignedToUserId&&!o.assignedToEmail),console.log(`[TeamPage] Filtered available licenses: ${l.length}`)}if(l.length===0){console.log("[TeamPage] No organization licenses found, trying fallback method...");const r=await t.getAllAccessibleLicenses();console.log(`[TeamPage] Fallback licenses found: ${r.length}`);const o=r.filter(p=>!p.organizationId||p.organizationId===n.id||!p.assignedToUserId&&!p.assignedToEmail);console.log(`[TeamPage] Filtered licenses for org: ${o.length}`),l=o.filter(p=>p.status==="ACTIVE"&&!p.assignedToUserId&&!p.assignedToEmail)}if(l.length===0&&(console.log("[TeamPage] Still no licenses found, trying final fallback..."),l=await t.getAllUnassignedLicenses(),console.log(`[TeamPage] Final fallback found: ${l.length} unassigned licenses`)),console.log(`[TeamPage] Final result: ${l.length} available licenses for organization ${n.id}`),console.log("[TeamPage] License details:",l.map(r=>({id:r.id,status:r.status,assignedToUserId:r.assignedToUserId,assignedToEmail:r.assignedToEmail,organizationId:r.organizationId}))),l.length>0){const r=await t.getOrganizationLicenses(n.id);F=r.filter(p=>p.status==="ACTIVE").length;const o=r.filter(p=>p.status==="ACTIVE"&&(p.assignedToUserId||p.assignedToEmail));C=l.length,console.log(`[TeamPage] Updated from Firestore: totalSeats=${F}, assignedLicenses=${o.length}, availableSeats=${C}`)}}catch(t){console.warn("[TeamPage] Failed to check Firestore licenses:",t),console.error("[TeamPage] Error details:",t)}const i=(Array.isArray(v)?v:[]).filter(t=>t&&t.status!=="REMOVED"&&t.status!=="removed").map(t=>{var j,_;const l=String(t.email||"user@example.com"),r=l.split("@")[0]||"User",o={OWNER:"owner",ENTERPRISE_ADMIN:"admin",MANAGER:"manager",MEMBER:"member"},p={INVITED:"pending",ACTIVE:"active",REMOVED:"removed"},x=t.firstName||((j=t.name)==null?void 0:j.split(" ")[0])||r.charAt(0).toUpperCase()+r.slice(1),k=t.lastName||((_=t.name)==null?void 0:_.split(" ").slice(1).join(" "))||"";return{id:String(t.id||`${l}-${Math.random().toString(36).slice(2)}`),firstName:x,lastName:k,email:l,role:o[String(t.role)]||"member",status:p[String(t.status)]||"active",department:t.department||"",licenseType:t.licenseType||"PROFESSIONAL",joinedAt:le(t.joinedAt),lastActive:le(t.updatedAt||t.joinedAt||new Date,{includeTime:!0})}});if(!a)return;be(n.id),we(n.name||"Organization"),Ue(U||null),console.log("[TeamPage] Organization ID:",n.id,"Type:",typeof n.id,"Length:",String(n.id).length),console.log("[TeamPage] Organization ID characters:",Array.from(String(n.id)).map(t=>`${t}(${t.charCodeAt(0)})`).join(" ")),De(P?{id:String(P.id),tier:String(P.tier).toUpperCase(),seats:Number(P.seats||0),status:String(P.status||""),organizationId:P.organizationId}:null),ie(i),re({totalMembers:i.length,activeMembers:Y,pendingInvites:0,availableSeats:C,totalSeats:F})}catch(n){if(!a)return;console.error("[TeamPage] Failed to load team data:",n),ie([]),re({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0})}})(),()=>{a=!1}},[f==null?void 0:f.email]),A.useEffect(()=>{if(!V||!I)return;let a;return(async()=>{try{const{db:s}=await D(async()=>{const{db:R}=await import("./firebase-_rYwBkzE.js");return{db:R}},__vite__mapDeps([9,1,2,3,4,5,7,6,8])),{collection:c,query:m,where:y,onSnapshot:S}=await D(async()=>{const{collection:R,query:z,where:L,onSnapshot:h}=await import("./index.esm-CZcVTLdu.js");return{collection:R,query:z,where:L,onSnapshot:h}},__vite__mapDeps([6,7])),N=m(c(s,"teamMembers"),y("organizationId","==",String(I)));a=S(N,R=>{console.log("[TeamPage] Firestore subscription: received",R.docs.length,"team members");const L=R.docs.filter(g=>{const b=g.data(),M=b&&(b.status==="REMOVED"||b.status==="removed");return M&&console.log("[TeamPage] Filtering out removed member:",b.email,"with status:",b.status),b&&!M}).map(g=>{const b=g.data(),M=String(b.email||"user@example.com"),u=M.split("@")[0]||"User",n=b.firstName||u.charAt(0).toUpperCase()+u.slice(1),v=b.lastName||"",P={INVITED:"pending",ACTIVE:"active",REMOVED:"removed",SUSPENDED:"suspended"},U={OWNER:"owner",ENTERPRISE_ADMIN:"admin",MANAGER:"manager",MEMBER:"member"};return{id:g.id,firstName:n,lastName:v,email:M,role:U[String(b.role)]||"member",status:P[String(b.status)]||"active",department:b.department||"",licenseType:b.licenseType||"PROFESSIONAL",joinedAt:le(b.createdAt),lastActive:le(b.updatedAt||b.createdAt||new Date,{includeTime:!0})}}).sort((g,b)=>{const M=u=>{if(!u)return 0;const n=new Date(u);return isNaN(n.getTime())?0:n.getTime()};return M(b.joinedAt)-M(g.joinedAt)}),h=L.filter(g=>g.status==="active").length;ie(L),re(g=>({...g,totalMembers:L.length,activeMembers:h,pendingInvites:0,availableSeats:Math.max(0,g.totalSeats-h)}))})}catch(s){console.warn("[TeamPage] Firestore subscription failed:",s)}})(),()=>{try{a&&a()}catch{}}},[I]);const ve=async()=>{var a,s,c,m,y,S,N,R,z,L,h,g,b,M;try{let u=null,n=[],v=null,P=null;if(V&&(f!=null&&f.id))try{console.log("[TeamPage] Refresh: Web-only mode - Getting data from Firestore...");const{firestoreLicenseService:i}=await D(async()=>{const{firestoreLicenseService:j}=await import("./FirestoreLicenseService-D7GNG3E-.js");return{firestoreLicenseService:j}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),{getFirestore:t,collection:l,query:r,where:o,getDocs:p}=await D(async()=>{const{getFirestore:j,collection:_,query:G,where:se,getDocs:K}=await import("./index.esm-CZcVTLdu.js");return{getFirestore:j,collection:_,query:G,where:se,getDocs:K}},__vite__mapDeps([6,7])),{db:x}=await D(async()=>{const{db:j}=await import("./firebase-_rYwBkzE.js");return{db:j}},__vite__mapDeps([9,1,2,3,4,5,7,6,8])),k=await p(r(l(x,"users"),o("id","==",f.id)));if(!k.empty){const j=k.docs[0].data();if(j.organizationId){const _=await p(r(l(x,"organizations"),o("id","==",j.organizationId)));_.empty||(u={id:j.organizationId,..._.docs[0].data()},console.log("[TeamPage] Refresh: Found organization in Firestore:",u));const G=r(l(x,"teamMembers"),o("organizationId","==",j.organizationId));n=(await p(G)).docs.map(ne=>({id:ne.id,...ne.data()})),console.log("[TeamPage] Refresh: Found team members in Firestore:",n.length);const K=r(l(x,"org_members"),o("userId","==",f.id)),$=await p(K);$.empty||(P=$.docs[0].data().role,console.log("[TeamPage] Refresh: User role from Firestore:",P))}}}catch(i){console.warn("[TeamPage] Refresh: Failed to get data from Firestore:",i)}if(!V&&!u){console.log("[TeamPage] Refresh: Using API calls...");const i=await X.get(Z.organizations.context()).catch(()=>null),t=((s=(a=i==null?void 0:i.data)==null?void 0:a.data)==null?void 0:s.organization)||null,l=((m=(c=i==null?void 0:i.data)==null?void 0:c.data)==null?void 0:m.members)||[],r=((S=(y=i==null?void 0:i.data)==null?void 0:y.data)==null?void 0:S.activeSubscription)||null;if(P=((R=(N=i==null?void 0:i.data)==null?void 0:N.data)==null?void 0:R.primaryRole)||null,u=t,n=l,v=r,!u){const o=await X.get(Z.organizations.my()),p=((L=(z=o==null?void 0:o.data)==null?void 0:z.data)==null?void 0:L.owned)??[],x=((g=(h=o==null?void 0:o.data)==null?void 0:h.data)==null?void 0:g.memberOf)??[];u=p[0]||x[0]||null,n=(u==null?void 0:u.members)||[]}}if(!u){be(null),we(""),ie([]),re({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0});return}const U=n.filter(i=>i.status==="ACTIVE").length;let Y=0;v&&v.status==="ACTIVE"&&v.organizationId===u.id?Y=Number(v.seats||0):V||(Y=(((M=(b=(await X.get(Z.subscriptions.mySubscriptions())).data)==null?void 0:b.data)==null?void 0:M.subscriptions)??[]).filter(r=>r.organizationId===u.id&&r.status==="ACTIVE").reduce((r,o)=>(!v&&o.status==="ACTIVE"&&(v=o),r+(o.seats||0)),0));let F=Math.max(0,Y-U);if(V&&(f!=null&&f.id)&&(u!=null&&u.id))try{const{firestoreLicenseService:i}=await D(async()=>{const{firestoreLicenseService:l}=await import("./FirestoreLicenseService-D7GNG3E-.js");return{firestoreLicenseService:l}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]));console.log(`[TeamPage] Refresh - Checking Firestore licenses for organization: ${u.id}`);let t=await i.getUnassignedLicenses(u.id);if(console.log(`[TeamPage] Refresh - Unassigned licenses found: ${t.length}`),t.length===0){console.log("[TeamPage] Refresh - No unassigned licenses found, trying organization licenses...");const l=await i.getOrganizationLicenses(u.id);console.log(`[TeamPage] Refresh - Organization licenses found: ${l.length}`),t=l.filter(r=>r.status==="ACTIVE"&&!r.assignedToUserId&&!r.assignedToEmail),console.log(`[TeamPage] Refresh - Filtered available licenses: ${t.length}`)}if(t.length===0){console.log("[TeamPage] Refresh - No organization licenses found, trying fallback method...");const l=await i.getAllAccessibleLicenses();console.log(`[TeamPage] Refresh - Fallback licenses found: ${l.length}`);const r=l.filter(o=>!o.organizationId||o.organizationId===u.id||!o.assignedToUserId&&!o.assignedToEmail);console.log(`[TeamPage] Refresh - Filtered licenses for org: ${r.length}`),t=r.filter(o=>o.status==="ACTIVE"&&!o.assignedToUserId&&!o.assignedToEmail)}if(t.length===0&&(console.log("[TeamPage] Refresh - Still no licenses found, trying final fallback..."),t=await i.getAllUnassignedLicenses(),console.log(`[TeamPage] Refresh - Final fallback found: ${t.length} unassigned licenses`)),console.log(`[TeamPage] Refresh - Final result: ${t.length} available licenses for organization ${u.id}`),t.length>0){const l=await i.getOrganizationLicenses(u.id);Y=l.filter(o=>o.status==="ACTIVE").length;const r=l.filter(o=>o.status==="ACTIVE"&&(o.assignedToUserId||o.assignedToEmail));F=t.length,console.log(`[TeamPage] Refresh - Updated from Firestore: totalSeats=${Y}, assignedLicenses=${r.length}, availableSeats=${F}`)}}catch(i){console.warn("[TeamPage] Refresh - Failed to check Firestore licenses:",i)}const C=(Array.isArray(n)?n:[]).filter(i=>i&&i.status!=="REMOVED"&&i.status!=="removed").map(i=>{const t=String(i.email||"user@example.com"),l=t.split("@")[0]||"User",r={OWNER:"owner",ENTERPRISE_ADMIN:"admin",MANAGER:"manager",MEMBER:"member"},o={INVITED:"pending",ACTIVE:"active",REMOVED:"removed"};return{id:String(i.id||`${t}-${Math.random().toString(36).slice(2)}`),firstName:l.charAt(0).toUpperCase()+l.slice(1),lastName:"",email:t,role:r[String(i.role)]||"member",status:o[String(i.status)]||"active",department:i.department||"",licenseType:i.licenseType||"PROFESSIONAL",joinedAt:le(i.joinedAt),lastActive:le(i.updatedAt||i.joinedAt||new Date,{includeTime:!0})}});be(u.id),we(u.name||"Organization"),Ue(P||null),De(v?{id:String(v.id),tier:String(v.tier).toUpperCase(),seats:Number(v.seats||0),status:String(v.status||""),organizationId:v.organizationId}:null),ie(C),re({totalMembers:C.length,activeMembers:U,pendingInvites:0,availableSeats:F,totalSeats:Y})}catch(u){console.error("[TeamPage] Failed to refresh team data:",u)}},[We,Be]=A.useState(null),[O,qe]=A.useState(null),[oa,ce]=A.useState(!1),[ra,xe]=A.useState(!1),[Ye,Ge]=A.useState(0),[ia,ue]=A.useState(!1),[he,Te]=A.useState(!1),[Qe,He]=A.useState(!1),[Xe,Ze]=A.useState(!1),[Ce,la]=A.useState(!1),[Oe,ca]=A.useState(!1),[T,de]=A.useState({newPassword:"",confirmPassword:"",email:"",role:"member",status:"active"}),[da,Ne]=A.useState(!1),[W,Re]=A.useState(null),[d,te]=A.useState({email:"",firstName:"",lastName:"",role:"member",department:"",message:"",password:"",confirmPassword:""}),ma=(a,s)=>{Be(a.currentTarget),qe(s)},Pe=()=>{Be(null)},ga=async()=>{var a,s,c,m,y,S,N,R,z,L;if(I){if(!V&&q.availableSeats<=0){w("No licenses available. Please check your organization's licenses before inviting new members.",{variant:"warning"});return}if(d.password||d.confirmPassword){if(d.password!==d.confirmPassword){w("Passwords do not match",{variant:"error"});return}if(d.password.length<8){w("Password must be at least 8 characters long",{variant:"error"});return}}try{if(typeof window<"u"&&(window.WEBONLY_MODE===!0||localStorage.getItem("WEB_ONLY")==="true"||localStorage.getItem("USE_FIRESTORE")==="true"||window.location.hostname.includes("backbone-client.web.app")||window.location.hostname.includes("web.app")||window.location.hostname.includes("firebaseapp.com"))){console.log("[TeamPage] WebOnly mode detected - checking Firebase Auth...");const{db:g,auth:b}=await D(async()=>{const{db:C,auth:i}=await import("./firebase-_rYwBkzE.js");return{db:C,auth:i}},__vite__mapDeps([9,1,2,3,4,5,7,6,8])),{collection:M,addDoc:u,serverTimestamp:n,doc:v,setDoc:P}=await D(async()=>{const{collection:C,addDoc:i,serverTimestamp:t,doc:l,setDoc:r}=await import("./index.esm-CZcVTLdu.js");return{collection:C,addDoc:i,serverTimestamp:t,doc:l,setDoc:r}},__vite__mapDeps([6,7])),{createUserWithEmailAndPassword:U,signInAnonymously:Y}=await D(async()=>{const{createUserWithEmailAndPassword:C,signInAnonymously:i}=await import("./index.esm-Bm1DnCIa.js");return{createUserWithEmailAndPassword:C,signInAnonymously:i}},__vite__mapDeps([8,7]));if(!b.currentUser){console.log("[TeamPage] No Firebase Auth user - attempting anonymous sign-in...");try{await Y(b),console.log("[TeamPage] Anonymous sign-in successful")}catch(C){throw console.error("[TeamPage] Anonymous sign-in failed:",C),new Error("Firebase authentication required for team member creation")}}console.log("[TeamPage] Creating Firebase Auth user account...");const F=d.password||sa();try{const i=(await U(b,d.email.trim(),F)).user;console.log("[TeamPage] Firebase Auth user created successfully:",i.uid);const t={id:i.uid,email:d.email.trim(),firstName:d.firstName.trim(),lastName:d.lastName.trim(),licenseType:"PROFESSIONAL",organizationId:I,role:"MEMBER",status:"ACTIVE",department:((a=d.department)==null?void 0:a.trim())||void 0,createdBy:((s=b.currentUser)==null?void 0:s.uid)||(f==null?void 0:f.id)||"unknown",createdAt:n(),updatedAt:n(),temporaryPassword:F},l=Object.fromEntries(Object.entries(t).filter(([p,x])=>x!=null));console.log("[TeamPage] Creating team member in Firestore with data:",l);const r=await P(v(g,"teamMembers",i.uid),l);console.log("[TeamPage] Team member created successfully in Firestore:",i.uid);try{console.log("[TeamPage] Attempting to assign license to new team member via API...");const{firestoreLicenseService:p}=await D(async()=>{const{firestoreLicenseService:k}=await import("./FirestoreLicenseService-D7GNG3E-.js");return{firestoreLicenseService:k}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),x=await p.getUnassignedLicenses(I);if(console.log(`[TeamPage] Found ${x.length} available licenses for organization ${I}`),x.length>0){const j=x.sort((_,G)=>{const se={ENTERPRISE:3,PRO:2,BASIC:1},K=se[_.tier]||0;return(se[G.tier]||0)-K})[0];console.log(`[TeamPage] Assigning license ${j.id} (${j.tier}) to new team member`),await p.assignLicense(j.id,d.email.trim()),console.log(`[TeamPage] Successfully assigned license ${j.id} to ${d.email}`),w(`License automatically assigned to ${d.email}`,{variant:"info"})}else console.warn("[TeamPage] No available licenses found for automatic assignment"),w("Team member created but no licenses available for automatic assignment",{variant:"warning"})}catch(p){console.error("[TeamPage] Failed to automatically assign license:",p),w("Team member created but license assignment failed",{variant:"warning"})}const o=d.password?`Team member ${d.email} created successfully with your custom password!`:`Team member ${d.email} created successfully! Temporary password: ${F}`;w(o,{variant:"success"}),ce(!1),te({email:"",firstName:"",lastName:"",role:"member",department:"",message:"",password:"",confirmPassword:""}),await ve()}catch(C){throw console.error("[TeamPage] Firebase Auth user creation failed:",C),C.code==="auth/email-already-in-use"?w(`User with email ${d.email} already exists in Firebase Auth`,{variant:"error"}):C.code==="auth/weak-password"?w("Password is too weak. Please use a stronger password.",{variant:"error"}):w(`Failed to create Firebase Auth user: ${C.message}`,{variant:"error"}),C}}else{console.log("[TeamPage] Using HTTP API for team member creation");const g={email:d.email.trim(),firstName:d.firstName.trim(),lastName:d.lastName.trim(),licenseType:"PROFESSIONAL",organizationId:I,createdBy:(f==null?void 0:f.id)||"unknown",sendWelcomeEmail:!0};d.department&&d.department.trim()&&(g.department=d.department.trim()),d.password&&d.password.trim()&&(g.temporaryPassword=d.password.trim());const b=Object.fromEntries(Object.entries(g).filter(([u,n])=>n!=null));console.log("[TeamPage] Creating team member with payload:",b),console.log("[TeamPage] Organization ID:",I,"Type:",typeof I),console.log("[TeamPage] Organization ID validation test:",/^[a-zA-Z0-9\-_\.]+$/.test(String(I))),console.log("[TeamPage] Organization ID characters:",Array.from(String(I)).map(u=>`${u}(${u.charCodeAt(0)})`).join(" "));const M=await X.post(Z.teamMembers.create(),b);if((c=M.data)!=null&&c.success){const u=M.data.data.teamMember,n=M.data.data.temporaryPassword;try{console.log("[TeamPage] Attempting to assign license to new team member via API...");const{firestoreLicenseService:P}=await D(async()=>{const{firestoreLicenseService:Y}=await import("./FirestoreLicenseService-D7GNG3E-.js");return{firestoreLicenseService:Y}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),U=await P.getUnassignedLicenses(I);if(console.log(`[TeamPage] Found ${U.length} available licenses for organization ${I}`),U.length>0){const F=U.sort((C,i)=>{const t={ENTERPRISE:3,PRO:2,BASIC:1},l=t[C.tier]||0;return(t[i.tier]||0)-l})[0];console.log(`[TeamPage] Assigning license ${F.id} (${F.tier}) to new team member`),await P.assignLicense(F.id,d.email.trim()),console.log(`[TeamPage] Successfully assigned license ${F.id} to ${d.email}`),w(`License automatically assigned to ${d.email}`,{variant:"info"})}else console.warn("[TeamPage] No available licenses found for automatic assignment"),w("Team member created but no licenses available for automatic assignment",{variant:"warning"})}catch(P){console.error("[TeamPage] Failed to automatically assign license:",P),w("Team member created but license assignment failed",{variant:"warning"})}const v=d.password?`Team member ${u.email} created successfully with your custom password!`:`Team member ${u.email} created successfully! Temporary password: ${n}`;w(v,{variant:"success"}),ce(!1),te({email:"",firstName:"",lastName:"",role:"member",department:"",message:"",password:"",confirmPassword:""}),await ve()}else throw new Error("Failed to create team member")}}catch(h){if(console.error("[TeamPage] Team member creation failed:",h),h!=null&&h.response){console.error("[TeamPage] Error response:",(m=h==null?void 0:h.response)==null?void 0:m.data),console.error("[TeamPage] Error status:",(y=h==null?void 0:h.response)==null?void 0:y.status),console.error("[TeamPage] Error headers:",(S=h==null?void 0:h.response)==null?void 0:S.headers);const g=((R=(N=h==null?void 0:h.response)==null?void 0:N.data)==null?void 0:R.message)||((L=(z=h==null?void 0:h.response)==null?void 0:z.data)==null?void 0:L.error)||(h==null?void 0:h.message)||"Failed to create team member";w(g,{variant:"error"})}else{const g=(h==null?void 0:h.message)||"Failed to create team member";w(g,{variant:"error"})}}}},ua=A.useMemo(()=>String((f==null?void 0:f.role)||"").toUpperCase()==="SUPERADMIN",[f==null?void 0:f.role]),ha=()=>{if(!H){w("No active subscription found for this organization.",{variant:"warning"});return}Ge(Number(H.seats||0)),xe(!0)},pa=async()=>{var a,s;if(H)try{const c=H.tier,m=Number(Ye||0);if(c==="BASIC"&&m!==1){w("Basic plan supports exactly 1 seat.",{variant:"warning"});return}if(c==="PRO"&&(m<1||m>50)){w("Pro plan seats must be between 1 and 50.",{variant:"warning"});return}if(c==="ENTERPRISE"&&m<10){w("Enterprise requires minimum 10 seats.",{variant:"warning"});return}await X.put(Z.subscriptions.update(H.id),{seats:m}),De(y=>y&&{...y,seats:m}),re(y=>({...y,totalSeats:m,availableSeats:Math.max(0,m-(y.activeMembers+y.pendingInvites))})),w("Seats updated successfully",{variant:"success"}),xe(!1)}catch(c){const m=((s=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:s.message)||(c==null?void 0:c.message)||"Failed to update seats";w(m,{variant:"error"})}},fa=()=>{de({newPassword:"",confirmPassword:"",email:(O==null?void 0:O.email)||"",role:(O==null?void 0:O.role)||"member",status:(O==null?void 0:O.status)||"active"}),He(!1),Ze(!1),ue(!0)},ba=async()=>{var m,y;if(!O)return;if(O.status!=="active"){w("Password can only be set after the member has joined (status Active).",{variant:"warning"});return}const a=O.email,{newPassword:s,confirmPassword:c}=T;if(!s||s.length<8){w("Password must be at least 8 characters.",{variant:"warning"});return}if(s!==c){w("Passwords do not match.",{variant:"warning"});return}try{if(Te(!0),V){console.log("[TeamPage] Web-only mode detected - updating password in Firestore...");const{db:S}=await D(async()=>{const{db:L}=await import("./firebase-_rYwBkzE.js");return{db:L}},__vite__mapDeps([9,1,2,3,4,5,7,6,8])),{doc:N,updateDoc:R,serverTimestamp:z}=await D(async()=>{const{doc:L,updateDoc:h,serverTimestamp:g}=await import("./index.esm-CZcVTLdu.js");return{doc:L,updateDoc:h,serverTimestamp:g}},__vite__mapDeps([6,7]));await R(N(S,"teamMembers",O.id),{temporaryPassword:s,updatedAt:z()})}else{if(!I){w("Organization context not found.",{variant:"error"});return}await X.put(Z.organizations.setMemberPassword(I,O.id),{password:s})}w(`Password set for ${a}`,{variant:"success"}),ue(!1)}catch(S){const N=((y=(m=S==null?void 0:S.response)==null?void 0:m.data)==null?void 0:y.message)||(S==null?void 0:S.message)||"Failed to set password";w(N,{variant:"error"})}finally{Te(!1)}},wa=async()=>{var a,s;if(!(!O||!I))try{Te(!0);const c={admin:"ENTERPRISE_ADMIN",owner:"ENTERPRISE_ADMIN",manager:"MANAGER",member:"MEMBER",viewer:"MEMBER"},m={pending:"INVITED",active:"ACTIVE",suspended:"SUSPENDED",removed:"REMOVED"};if(console.log("Updating member:",{memberId:O.id,email:T.email,role:c[T.role],status:m[T.status]}),V){console.log("[TeamPage] Web-only mode detected - updating team member in Firestore...");const{db:y}=await D(async()=>{const{db:z}=await import("./firebase-_rYwBkzE.js");return{db:z}},__vite__mapDeps([9,1,2,3,4,5,7,6,8])),{doc:S,updateDoc:N,serverTimestamp:R}=await D(async()=>{const{doc:z,updateDoc:L,serverTimestamp:h}=await import("./index.esm-CZcVTLdu.js");return{doc:z,updateDoc:L,serverTimestamp:h}},__vite__mapDeps([6,7]));await N(S(y,"teamMembers",O.id),{email:T.email,role:c[T.role],status:m[T.status],updatedAt:R()}),T.newPassword&&T.confirmPassword&&T.newPassword===T.confirmPassword&&await N(S(y,"teamMembers",O.id),{temporaryPassword:T.newPassword,updatedAt:R()})}else await X.patch(Z.organizations.updateMember(I,O.id),{email:T.email,role:c[T.role],status:m[T.status]}),T.newPassword&&T.confirmPassword&&T.newPassword===T.confirmPassword&&await X.put(Z.organizations.setMemberPassword(I,O.id),{password:T.newPassword});w("Member updated successfully",{variant:"success"}),ue(!1),await ve()}catch(c){console.error("[TeamPage] Update member failed:",c);const m=((s=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:s.message)||(c==null?void 0:c.message)||"Failed to update member";w(m,{variant:"error"})}finally{Te(!1)}},va=()=>{O&&(Re(O),Ne(!0),Pe())},xa=async()=>{if(!(!W||!I))try{if(V){console.log("[TeamPage] Web-only mode detected - removing team member in Firestore...");const{db:a}=await D(async()=>{const{db:g}=await import("./firebase-_rYwBkzE.js");return{db:g}},__vite__mapDeps([9,1,2,3,4,5,7,6,8])),{doc:s,updateDoc:c,serverTimestamp:m,deleteDoc:y,collection:S,query:N,where:R,getDocs:z}=await D(async()=>{const{doc:g,updateDoc:b,serverTimestamp:M,deleteDoc:u,collection:n,query:v,where:P,getDocs:U}=await import("./index.esm-CZcVTLdu.js");return{doc:g,updateDoc:b,serverTimestamp:M,deleteDoc:u,collection:n,query:v,where:P,getDocs:U}},__vite__mapDeps([6,7])),{firestoreLicenseService:L}=await D(async()=>{const{firestoreLicenseService:g}=await import("./FirestoreLicenseService-D7GNG3E-.js");return{firestoreLicenseService:g}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),{getAuth:h}=await D(async()=>{const{getAuth:g}=await import("./index.esm-Bm1DnCIa.js");return{getAuth:g}},__vite__mapDeps([8,7]));console.log(`[TeamPage] Finding licenses assigned to ${W.email}...`);try{const g=N(S(a,"licenses"),R("assignedToEmail","==",W.email)),b=await z(g);if(b.empty)console.log(`[TeamPage] No licenses found for ${W.email}`);else{console.log(`[TeamPage] Found ${b.size} licenses assigned to ${W.email}`);for(const M of b.docs)console.log(`[TeamPage] Unassigning license ${M.id} from ${W.email}`),await L.unassignLicense(M.id);console.log(`[TeamPage] Successfully released all licenses for ${W.email}`),w(`Released ${b.size} licenses from ${W.email}`,{variant:"info"})}}catch(g){console.error("[TeamPage] Error releasing licenses:",g)}await c(s(a,"teamMembers",W.id),{status:"REMOVED",updatedAt:m()});try{console.log(`[TeamPage] Attempting to delete Firebase Auth user for ${W.email}...`);const g=h();console.log("[TeamPage] Firebase Auth user deletion should be handled by a backend process")}catch(g){console.warn("[TeamPage] Could not delete Firebase Auth user (expected in client code):",g)}}else await X.post(Z.organizations.removeMember(I,W.id));w(`${W.email} removed from team`,{variant:"warning"}),await ve()}catch(a){console.error("[TeamPage] Remove member failed:",a),w((a==null?void 0:a.message)||"Failed to remove member",{variant:"error"})}finally{Ne(!1),Re(null)}},Je=()=>{Ne(!1),Re(null)};return A.useMemo(()=>q.totalSeats<=0?0:(q.totalSeats-q.availableSeats)/q.totalSeats*100,[q.totalSeats,q.availableSeats]),e.jsxs(oe,{children:[e.jsx(oe,{children:e.jsxs(oe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(oe,{children:[e.jsx(ee,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsx(ee,{variant:"body1",color:"text.secondary",sx:{mb:2},children:"Create and manage your team members with automatic Firebase Authentication setup. Each member gets their own account and temporary password."})]}),e.jsx(J,{variant:"contained",startIcon:e.jsx(ya,{}),onClick:()=>ce(!0),disabled:V?!1:q.availableSeats<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Add Team Member"}),ua&&e.jsxs(J,{variant:"outlined",onClick:ha,sx:{ml:2},children:["Manage Seats",H?` (${H.seats})`:""]}),typeof window<"u"&&window.location.hostname==="localhost"&&e.jsx(J,{variant:"outlined",onClick:async()=>{try{console.log("ðŸ” [TeamPage] Debug: Testing license service...");const{firestoreLicenseService:a}=await D(async()=>{const{firestoreLicenseService:s}=await import("./FirestoreLicenseService-D7GNG3E-.js");return{firestoreLicenseService:s}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]));if(I){console.log("ðŸ” [TeamPage] Debug: Testing with org ID:",I);const s=await a.getUnassignedLicenses(I),c=await a.getOrganizationLicenses(I),m=await a.getAllAccessibleLicenses();console.log("ðŸ“Š [TeamPage] Debug Results:"),console.log("  - Unassigned licenses:",s.length),console.log("  - Organization licenses:",c.length),console.log("  - All accessible licenses:",m.length),console.log("  - Unassigned details:",s),console.log("  - Org licenses details:",c)}else console.log("âŒ [TeamPage] Debug: No org ID available")}catch(a){console.error("âŒ [TeamPage] Debug: License service test failed:",a)}},sx:{ml:2},children:"Debug Licenses"})]})}),e.jsxs(E,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsx(_e,{title:"Team Members",value:q.totalMembers,icon:e.jsx(Sa,{}),color:"primary",trend:{value:12,direction:"up"}})}),e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsx(_e,{title:"Active Members",value:q.activeMembers,icon:e.jsx(Ve,{}),color:"success",trend:{value:8,direction:"up"}})}),e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsx(_e,{title:"Total Seats",value:q.totalSeats,icon:e.jsx(Ke,{}),color:"primary"})}),e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsx(_e,{title:"Available Seats",value:q.availableSeats,icon:e.jsx(Ke,{}),color:"secondary"})})]}),e.jsx(oe,{children:e.jsx(Ea,{component:Ia,sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(ja,{children:[e.jsx(Aa,{children:e.jsxs(ea,{children:[e.jsx(Q,{sx:{fontWeight:600},children:"Member"}),e.jsx(Q,{sx:{fontWeight:600},children:"Role"}),e.jsx(Q,{sx:{fontWeight:600},children:"Department"}),e.jsx(Q,{sx:{fontWeight:600},children:"Status"}),e.jsx(Q,{sx:{fontWeight:600},children:"License"}),e.jsx(Q,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(Q,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Ma,{children:na.map(a=>e.jsxs(ea,{hover:!0,children:[e.jsx(Q,{children:e.jsxs(oe,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(_a,{sx:{width:40,height:40},children:[a.firstName[0],a.lastName[0]]}),e.jsxs(oe,{children:[e.jsxs(ee,{variant:"body2",sx:{fontWeight:500},children:[a.firstName," ",a.lastName]}),e.jsx(ee,{variant:"caption",color:"text.secondary",children:a.email})]})]})}),e.jsx(Q,{children:e.jsx(aa,{icon:a.role==="admin"?e.jsx(Da,{}):e.jsx(Ca,{}),label:a.role.toUpperCase(),color:$a(a.role),size:"small",variant:"outlined"})}),e.jsx(Q,{children:e.jsx(ee,{variant:"body2",children:a.department||"Not assigned"})}),e.jsx(Q,{children:e.jsx(aa,{icon:Ua(a.status),label:a.status.toUpperCase(),color:Va(a.status),size:"small"})}),e.jsx(Q,{children:e.jsx(ee,{variant:"body2",children:a.licenseType||"PROFESSIONAL"})}),e.jsx(Q,{children:e.jsx(ee,{variant:"body2",children:a.lastActive?new Date(a.lastActive).toLocaleDateString():"Never"})}),e.jsx(Q,{children:e.jsx(fe,{onClick:s=>ma(s,a),size:"small",children:e.jsx(Oa,{})})})]},a.id))})]})})}),e.jsx(Na,{color:"primary",sx:{position:"fixed",bottom:24,right:24,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000"},onClick:()=>ce(!0),children:e.jsx(Ra,{})}),e.jsxs(La,{anchorEl:We,open:!!We,onClose:Pe,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsxs(B,{onClick:()=>{Pe(),fa()},children:[e.jsx(Le,{children:e.jsx(za,{fontSize:"small"})}),"Edit Member"]}),e.jsxs(B,{onClick:Pe,children:[e.jsx(Le,{children:e.jsx(ta,{fontSize:"small"})}),"Suspend Member"]}),e.jsxs(B,{onClick:va,sx:{color:"error.main"},children:[e.jsx(Le,{children:e.jsx(ze,{fontSize:"small",sx:{color:"error.main"}})}),"Remove Member"]})]}),e.jsx(ye,{open:oa,onClose:()=>ce(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:e.jsxs("form",{onSubmit:a=>{a.preventDefault(),ga()},children:[e.jsx(Se,{children:"Create New Team Member"}),e.jsxs(Ee,{children:[e.jsx(ee,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Create a new team member account with automatic Firebase Authentication setup. You can set a custom password or leave it blank to auto-generate one. The member will receive a welcome email with their login credentials."}),e.jsxs(E,{container:!0,spacing:3,sx:{mt:1},children:[q.availableSeats<=0&&e.jsx(E,{item:!0,xs:12,children:e.jsx(ge,{severity:"warning",children:"No available licenses. Please check your organization's licenses to add more team members."})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(ae,{fullWidth:!0,label:"First Name",value:d.firstName,onChange:a=>te(s=>({...s,firstName:a.target.value})),required:!0})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(ae,{fullWidth:!0,label:"Last Name",value:d.lastName,onChange:a=>te(s=>({...s,lastName:a.target.value})),required:!0})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(ae,{fullWidth:!0,label:"Email Address",type:"email",value:d.email,onChange:a=>te(s=>({...s,email:a.target.value})),required:!0})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsxs(Fe,{fullWidth:!0,children:[e.jsx(ke,{children:"Role"}),e.jsxs($e,{value:d.role,label:"Role",onChange:a=>te(s=>({...s,role:a.target.value})),inputProps:{"aria-label":"Select team member role",title:"Select the role for this team member"},children:[e.jsx(B,{value:"viewer",children:"Viewer"}),e.jsx(B,{value:"member",children:"Member"}),e.jsx(B,{value:"admin",children:"Admin"})]})]})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(ae,{fullWidth:!0,label:"Department",value:d.department,onChange:a=>te(s=>({...s,department:a.target.value}))})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(ge,{severity:"info",sx:{mb:2},children:e.jsxs(ee,{variant:"body2",children:[e.jsx("strong",{children:"Password Setup:"})," You can either set a custom password for the team member or leave it blank to auto-generate a secure temporary password."]})})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(ae,{fullWidth:!0,label:"Password (Optional)",type:Ce?"text":"password",value:d.password,onChange:a=>te(s=>({...s,password:a.target.value})),helperText:"Leave blank to auto-generate a secure password",inputProps:{autoComplete:"new-password"},InputProps:{endAdornment:e.jsx(Ie,{position:"end",children:e.jsx(fe,{onClick:()=>la(!Ce),edge:"end","aria-label":"toggle password visibility",children:Ce?e.jsx(je,{}):e.jsx(Ae,{})})})}})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(ae,{fullWidth:!0,label:"Confirm Password",type:Oe?"text":"password",value:d.confirmPassword,onChange:a=>te(s=>({...s,confirmPassword:a.target.value})),disabled:!d.password,helperText:d.password?"Must match the password above":"Enter a password first",inputProps:{autoComplete:"new-password"},InputProps:{endAdornment:e.jsx(Ie,{position:"end",children:e.jsx(fe,{onClick:()=>ca(!Oe),edge:"end","aria-label":"toggle confirm password visibility",disabled:!d.password,children:Oe?e.jsx(je,{}):e.jsx(Ae,{})})})}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(ae,{fullWidth:!0,label:"Welcome Message (Optional)",multiline:!0,rows:3,value:d.message,onChange:a=>te(s=>({...s,message:a.target.value}))})})]})]}),e.jsxs(Me,{children:[e.jsx(J,{onClick:()=>ce(!1),children:"Cancel"}),e.jsx(J,{type:"submit",variant:"contained",disabled:!d.email||!d.firstName||!d.lastName||!V&&q.availableSeats<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Create Team Member"})]})]})}),e.jsxs(ye,{open:ra,onClose:()=>xe(!1),maxWidth:"xs",fullWidth:!0,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(Se,{children:"Manage Seats"}),e.jsx(Ee,{children:e.jsxs(E,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(E,{item:!0,xs:12,children:e.jsx(ge,{severity:"info",children:H?`${H.tier} subscription`:"No active subscription"})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(ae,{fullWidth:!0,type:"number",label:"Total Seats",value:Ye,onChange:a=>Ge(parseInt(a.target.value||"0",10)),inputProps:{min:1,max:(H==null?void 0:H.tier)==="PRO"?50:1e3}})})]})}),e.jsxs(Me,{children:[e.jsx(J,{onClick:()=>xe(!1),children:"Cancel"}),e.jsx(J,{onClick:pa,variant:"contained",disabled:!H,children:"Save"})]})]}),e.jsxs(ye,{open:ia,onClose:()=>{ue(!1),qe(null)},maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(Se,{children:"Edit Member"}),e.jsx(Ee,{children:e.jsxs(E,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(E,{item:!0,xs:12,children:e.jsx(ae,{fullWidth:!0,label:"Email",value:T.email,onChange:a=>de(s=>({...s,email:a.target.value}))})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsxs(Fe,{fullWidth:!0,children:[e.jsx(ke,{children:"Role"}),e.jsxs($e,{value:T.role,label:"Role",onChange:a=>de(s=>({...s,role:a.target.value})),children:[e.jsx(B,{value:"viewer",children:"Viewer"}),e.jsx(B,{value:"member",children:"Member"}),e.jsx(B,{value:"manager",children:"Manager"}),e.jsx(B,{value:"admin",children:"Admin"}),e.jsx(B,{value:"owner",children:"Owner"})]})]})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsxs(Fe,{fullWidth:!0,children:[e.jsx(ke,{children:"Status"}),e.jsxs($e,{value:T.status,label:"Status",onChange:a=>de(s=>({...s,status:a.target.value})),children:[e.jsx(B,{value:"pending",children:"Pending"}),e.jsx(B,{value:"active",children:"Active"}),e.jsx(B,{value:"suspended",children:"Suspended"}),e.jsx(B,{value:"removed",children:"Removed"})]})]})}),e.jsx(E,{item:!0,xs:12,children:T.status!=="active"?e.jsx(ge,{severity:"warning",children:"This member has not joined yet (Pending/Suspended/Removed). You can only set a password for Active members."}):e.jsx(ge,{severity:"info",children:"Set a temporary password for this user to log into Backbone. They can change it later."})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(ae,{fullWidth:!0,label:"New Password",type:Qe?"text":"password",value:T.newPassword,onChange:a=>de(s=>({...s,newPassword:a.target.value})),inputProps:{minLength:8},helperText:"Minimum 8 characters",InputProps:{endAdornment:e.jsx(Ie,{position:"end",children:e.jsx(fe,{onClick:()=>He(a=>!a),edge:"end","aria-label":"toggle password visibility",children:Qe?e.jsx(je,{}):e.jsx(Ae,{})})})}})}),e.jsx(E,{item:!0,xs:12,sm:6,children:e.jsx(ae,{fullWidth:!0,label:"Confirm Password",type:Xe?"text":"password",value:T.confirmPassword,onChange:a=>de(s=>({...s,confirmPassword:a.target.value})),InputProps:{endAdornment:e.jsx(Ie,{position:"end",children:e.jsx(fe,{onClick:()=>Ze(a=>!a),edge:"end","aria-label":"toggle password visibility",children:Xe?e.jsx(je,{}):e.jsx(Ae,{})})})}})})]})}),e.jsxs(Me,{children:[e.jsx(J,{onClick:()=>ue(!1),disabled:he,children:"Cancel"}),e.jsx(J,{onClick:wa,variant:"outlined",disabled:he,children:he?"Savingâ€¦":"Save Changes"}),e.jsx(J,{onClick:ba,variant:"contained",disabled:he||!T.newPassword||!T.confirmPassword||T.status!=="active",children:he?"Savingâ€¦":"Save Password Only"})]})]}),e.jsxs(ye,{open:da,onClose:Je,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(Se,{children:e.jsxs(oe,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ze,{color:"error"}),"Remove Team Member"]})}),e.jsxs(Ee,{children:[e.jsxs(ee,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsx("strong",{children:W==null?void 0:W.email})," from your team?"]}),e.jsx(ge,{severity:"warning",sx:{mt:2},children:e.jsx(ee,{variant:"body2",children:"This action cannot be undone. The member will lose access to all organization resources and data."})})]}),e.jsxs(Me,{children:[e.jsx(J,{onClick:Je,color:"inherit",children:"Cancel"}),e.jsx(J,{onClick:xa,color:"error",variant:"contained",startIcon:e.jsx(ze,{}),children:"Remove Member"})]})]})]})};export{Za as default};
