const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FirestoreCollectionManager-CaBRGLLK.js","assets/index-5toz-txF.js","assets/mui-D8UjIA2s.js","assets/vendor-CjD1bmmO.js","assets/stripe-CUttI3Gx.js","assets/index-CBai7h7s.css","assets/index.esm-CZcVTLdu.js","assets/index.esm-COtph9ny.js","assets/index.esm-Bm1DnCIa.js"])))=>i.map(i=>d[i]);
import{_ as S}from"./index-5toz-txF.js";import{r as C,i as D,S as P,D as j,_ as z,a as R,b as U,c as O,d as x,e as k,f as V,g as L,h as B,F as G}from"./index.esm-COtph9ny.js";import{getFirestore as A,query as f,collection as b,where as c,getDocs as y,getDoc as N,doc as w,orderBy as q,addDoc as Q,deleteDoc as K}from"./index.esm-CZcVTLdu.js";import{getAuth as E}from"./index.esm-Bm1DnCIa.js";import"./mui-D8UjIA2s.js";import"./vendor-CjD1bmmO.js";import"./stripe-CUttI3Gx.js";var Y="firebase",$="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */C(Y,$,"app");const W=Object.freeze(Object.defineProperty({__proto__:null,FirebaseError:G,SDK_VERSION:P,_DEFAULT_ENTRY_NAME:j,_addComponent:z,_apps:R,_components:U,_getProvider:O,_isFirebaseServerApp:x,_registerComponent:k,_serverApps:V,getApp:L,getApps:B,initializeApp:D,registerVersion:C},Symbol.toStringTag,{value:"Module"})),h={},X=()=>typeof window<"u"&&window.FIREBASE_CONFIG?window.FIREBASE_CONFIG:{apiKey:(h==null?void 0:h.VITE_FIREBASE_API_KEY)||"AIzaSyDFnIzSYCdPsDDdvP1lympVxEeUn0AQhWs",authDomain:"backbone-logic.firebaseapp.com",projectId:"backbone-logic",storageBucket:"backbone-logic.firebasestorage.app",messagingSenderId:"749245129278",appId:"1:749245129278:web:dfa5647101ea160a3b276f",measurementId:"G-8SZRDQ4XVR"},M=X();let g;try{g=D(M),console.log("üî• [Firebase] App initialized successfully")}catch(e){console.log("‚ÑπÔ∏è [Firebase] App already initialized or error:",e)}async function Z(){if(g)return g;try{const{getApps:e}=await S(async()=>{const{getApps:t}=await Promise.resolve().then(()=>W);return{getApps:t}},void 0),r=e();if(r.length>0)return g=r[0],console.log("‚úÖ [Firebase] Using existing app instance"),g}catch(e){console.warn("‚ö†Ô∏è [Firebase] Failed to get existing apps:",e)}try{return g=D(M,"fallback"),console.log("‚úÖ [Firebase] Created fallback app instance"),g}catch(e){throw console.error("‚ùå [Firebase] Failed to create fallback app:",e),new Error("Failed to initialize Firebase app")}}const d=g?A(g):A(),F=g?E(g):E();async function ce(){const e=await Z();return{app:e,db:A(e),auth:E(e)}}function H(){if(!(typeof window>"u"))try{console.log("‚ÑπÔ∏è [Firebase] Skipping client-side CSP override - relying on Firebase hosting CSP");const e=document.querySelector('meta[http-equiv="Content-Security-Policy"]');e&&(e.remove(),console.log("üßπ [Firebase] Removed conflicting client-side CSP meta tag"))}catch(e){console.warn("‚ö†Ô∏è [Firebase] Failed to clean up CSP:",e)}}H();typeof window<"u"&&(window.FIREBASE_IGNORE_UNDEFINED_PROPERTIES=!0);const _=e=>{if(typeof e!="object"||e===null)return e;if(Array.isArray(e))return e.map(t=>_(t));const r={};for(const[t,a]of Object.entries(e))a!=null&&(r[t]=_(a));return r};console.log("üåê [Firebase] Licensing website mode: production (web-only) - no emulators");const le=()=>!0;let T=!1;const me=async()=>{if(!T)try{const{firestoreCollectionManager:e}=await S(async()=>{const{firestoreCollectionManager:r}=await import("./FirestoreCollectionManager-CaBRGLLK.js");return{firestoreCollectionManager:r}},__vite__mapDeps([0,1,2,3,4,5,6,7,8]));await e.initializeCollections(),T=!0,console.log("‚úÖ [Firebase] Collection manager initialized")}catch(e){console.error("‚ùå [Firebase] Failed to initialize collection manager:",e)}},pe=()=>F.currentUser!==null,de=()=>F.currentUser,J=e=>{var r;return((r=F.currentUser)==null?void 0:r.email)===e},ge=async e=>{try{if(J(e))return!0;if(F.currentUser&&F.currentUser.email!==e){const{signOut:r}=await S(async()=>{const{signOut:t}=await import("./index.esm-Bm1DnCIa.js");return{signOut:t}},__vite__mapDeps([8,7]));await r(F)}return!1}catch{return!1}};class ue{static async getOrganizationsForUser(r){try{console.log("üîç [Firebase] Getting organizations for user:",r);const t=f(b(d,"organizations"),c("ownerUserId","==",r)),a=await y(t),n=f(b(d,"org_members"),c("userId","==",r),c("status","==","ACTIVE")),u=await y(n),o=new Set,i=[];a.forEach(m=>{const p={id:m.id,...m.data()};i.push(p),o.add(m.id)});for(const m of u.docs){const s=m.data().orgId;if(!o.has(s)){const l=await N(w(d,"organizations",s));if(l.exists()){const v={id:l.id,...l.data()};i.push(v),o.add(s)}}}return console.log("‚úÖ [Firebase] Found organizations:",i.length),i}catch(t){return console.error("‚ùå [Firebase] Error getting organizations:",t),[]}}static async getOrgMembers(r){try{console.log("üîç [Firebase] Getting org members for:",r);const t=f(b(d,"org_members"),c("orgId","==",r),c("status","==","ACTIVE"),q("createdAt","desc")),a=await y(t),n=[];return a.forEach(u=>{const o=u.data();let i=o.name;i||(o.firstName&&o.lastName?i=`${o.firstName} ${o.lastName}`:o.firstName?i=o.firstName:o.lastName?i=o.lastName:o.email?i=o.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "):i="Unknown User");const m={id:u.id,...o,name:i};n.push(m)}),console.log("‚úÖ [Firebase] Found org members:",n.length),n}catch(t){return console.error("‚ùå [Firebase] Error getting org members:",t),[]}}static async getProjectTeamMembers(r){try{console.log("üîç [Firebase] Getting project team members for:",r);const t=f(b(d,"projectTeamMembers"),c("projectId","==",r),c("isActive","==",!0)),a=await y(t),n=[];for(const u of a.docs){const o=u.data();let i;try{const p=await N(w(d,"org_members",o.teamMemberId));if(p.exists()){const s=p.data();let l=s.name;l||(s.firstName&&s.lastName?l=`${s.firstName} ${s.lastName}`:s.firstName?l=s.firstName:s.lastName?l=s.lastName:s.email?l=s.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(I=>I.charAt(0).toUpperCase()+I.slice(1).toLowerCase()).join(" "):l="Unknown User"),i={id:p.id,...s,name:l}}}catch(p){console.warn("Failed to get team member details:",p)}const m={id:u.id,...o,teamMember:i};n.push(m)}return console.log("‚úÖ [Firebase] Found project team members:",n.length),n}catch(t){return console.error("‚ùå [Firebase] Error getting project team members:",t),[]}}static async addTeamMemberToProject(r,t,a="DO_ER"){try{console.log("üîç [Firebase] Adding team member to project:",{projectId:r,teamMemberId:t,role:a});const n=f(b(d,"projectTeamMembers"),c("projectId","==",r),c("teamMemberId","==",t),c("isActive","==",!0));if(!(await y(n)).empty)throw new Error("Team member is already assigned to this project");if(a==="ADMIN"){const p=f(b(d,"projectTeamMembers"),c("projectId","==",r),c("role","==","ADMIN"),c("isActive","==",!0));if(!(await y(p)).empty)throw new Error("Only one Admin is allowed per project. Please remove the existing Admin first.")}const o={projectId:r,teamMemberId:t,role:a,assignedAt:new Date,assignedBy:"current_user",isActive:!0},i=_(o),m=await Q(b(d,"projectTeamMembers"),i);return console.log("‚úÖ [Firebase] Team member added successfully:",m.id),{id:m.id,...o}}catch(n){throw console.error("‚ùå [Firebase] Error adding team member:",n),n}}static async removeTeamMemberFromProject(r,t){try{console.log("üîç [Firebase] Removing team member from project:",{projectId:r,teamMemberId:t});const a=f(b(d,"projectTeamMembers"),c("projectId","==",r),c("teamMemberId","==",t),c("isActive","==",!0)),n=await y(a);for(const u of n.docs)await K(w(d,"projectTeamMembers",u.id));console.log("‚úÖ [Firebase] Team member removed successfully")}catch(a){throw console.error("‚ùå [Firebase] Error removing team member:",a),a}}}export{ue as FirebaseTeamMemberService,g as app,F as auth,d as db,ue as default,F as firebaseAuth,d as firestore,H as fixCSPIssues,de as getCurrentFirebaseUser,ce as getInitializedServices,me as initializeFirebaseCollections,J as isEmailAuthenticated,pe as isUserAuthenticated,le as isWebOnlyMode,ge as tryRestoreFirebaseSession};
