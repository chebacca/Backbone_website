import{j as e,a as y,T as a,b9 as X,ba as D,G as h,c,D as P,aC as p,aD as b,aE as l,aF as s,aG as v,S as J,h as Z,u as F,d as I,aB as ee}from"./mui-pHPyF4nf.js";import{r as x}from"./vendor-DIxetjBo.js";import{c as C,e as _}from"./index-CuSDiT7l.js";import"./stripe-B5n5czio.js";const ae=()=>{var A,E,Y,k;const[z,w]=x.useState([]),[L,M]=x.useState(""),[R,N]=x.useState(""),[m,U]=x.useState(0),[i,K]=x.useState(null),[d,$]=x.useState(null),[G,W]=x.useState([]),[H,V]=x.useState([]),O=async()=>{var t,r;const n=await C.get(_.accounting.payments(),{params:{limit:50}});w(((r=(t=n.data)==null?void 0:t.data)==null?void 0:r.payments)||[])};x.useEffect(()=>{(async()=>{var j,T,g,S,f,B;O();const[t,r,o,u]=await Promise.all([C.get("accounting/overview"),C.get("accounting/tax/summary"),C.get("accounting/kyc"),C.get("accounting/compliance-events")]);K(((j=t.data)==null?void 0:j.data)||null),$(((T=r.data)==null?void 0:T.data)||null),W(((S=(g=o.data)==null?void 0:g.data)==null?void 0:S.users)||[]),V(((B=(f=u.data)==null?void 0:f.data)==null?void 0:B.events)||[])})()},[]);const q=async()=>{var S,f;const n={from:L,to:R,includePII:!1},r=((f=(S=(await C.post(_.accounting.exportPayments(),n)).data)==null?void 0:S.data)==null?void 0:f.rows)||[],u=[Object.keys(r[0]||{}).join(","),...r.map(B=>Object.values(B).map(Q=>JSON.stringify(Q??"")).join(","))].join(`
`),j=new Blob([u],{type:"text/csv"}),T=URL.createObjectURL(j),g=document.createElement("a");g.href=T,g.download=`payments_${L||"all"}_${R||"all"}.csv`,g.click(),URL.revokeObjectURL(T)};return e.jsxs(y,{sx:{p:3},children:[e.jsx(a,{variant:"h4",fontWeight:700,gutterBottom:!0,children:"Accounting & Compliance"}),e.jsx(a,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Financial reporting, tax, KYC/AML, and regulatory oversight snapshot."}),e.jsxs(X,{value:m,onChange:(n,t)=>U(t),sx:{mb:2},children:[e.jsx(D,{label:"Overview"}),e.jsx(D,{label:"Payments"}),e.jsx(D,{label:"Tax"}),e.jsx(D,{label:"KYC"}),e.jsx(D,{label:"Compliance"})]}),m===0&&e.jsxs(y,{children:[e.jsxs(h,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(h,{item:!0,xs:12,md:3,children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"overline",children:"Revenue (USD)"}),e.jsx(a,{variant:"h5",children:((((A=i==null?void 0:i.totals)==null?void 0:A.revenue_cents)||0)/100).toLocaleString()})]})}),e.jsx(h,{item:!0,xs:12,md:3,children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"overline",children:"Tax Collected"}),e.jsx(a,{variant:"h5",children:((((E=i==null?void 0:i.totals)==null?void 0:E.tax_cents)||0)/100).toLocaleString()})]})}),e.jsx(h,{item:!0,xs:12,md:3,children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"overline",children:"Payments"}),e.jsx(a,{variant:"h5",children:((Y=i==null?void 0:i.totals)==null?void 0:Y.paymentsCount)||0})]})}),e.jsx(h,{item:!0,xs:12,md:3,children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"overline",children:"KYC Completed"}),e.jsx(a,{variant:"h5",children:((k=i==null?void 0:i.kycCounts)==null?void 0:k.COMPLETED)||0})]})})]}),e.jsxs(c,{sx:{p:2,mb:2},children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Recent Payments"}),e.jsx(P,{sx:{mb:1}}),e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Invoice"}),e.jsx(s,{align:"right",children:"Amount"}),e.jsx(s,{children:"Tax"}),e.jsx(s,{children:"Jurisdiction"})]})}),e.jsx(v,{children:((i==null?void 0:i.recentPayments)||[]).map(n=>e.jsxs(l,{children:[e.jsx(s,{children:new Date(n.createdAt).toLocaleDateString()}),e.jsx(s,{children:n.stripeInvoiceId}),e.jsx(s,{align:"right",children:(n.amount??0)/100}),e.jsxs(s,{children:[((n.taxAmount??0)/100).toFixed(2)," (",((n.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(s,{children:n.jurisdiction})]},n.id))})]})]}),e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Tax by Jurisdiction"}),e.jsx(P,{sx:{mb:1}}),e.jsx(J,{direction:"row",spacing:1,flexWrap:"wrap",children:(i==null?void 0:i.taxByJurisdiction)&&Object.entries(i.taxByJurisdiction).map(([n,t])=>e.jsx(Z,{label:`${n}: ${(t/100).toLocaleString()}`},n))})]})]}),m===1&&e.jsxs(y,{children:[e.jsxs(J,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(F,{label:"From (YYYY-MM-DD)",placeholder:"2025-01-01",value:L,onChange:n=>M(n.target.value),size:"small"}),e.jsx(F,{label:"To (YYYY-MM-DD)",placeholder:"2025-12-31",value:R,onChange:n=>N(n.target.value),size:"small"}),e.jsx(I,{variant:"contained",onClick:q,children:"Export CSV"}),e.jsx(I,{variant:"outlined",onClick:O,children:"Refresh"})]}),e.jsx(ee,{component:c,children:e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Invoice"}),e.jsx(s,{align:"right",children:"Amount"}),e.jsx(s,{children:"Currency"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Tax"}),e.jsx(s,{children:"Jurisdiction"}),e.jsx(s,{children:"User Email"}),e.jsx(s,{children:"Residency"})]})}),e.jsx(v,{children:z.map(n=>{var t,r,o;return e.jsxs(l,{children:[e.jsx(s,{children:new Date(n.createdAt).toLocaleDateString()}),e.jsx(s,{children:n.stripeInvoiceId}),e.jsx(s,{align:"right",children:(n.amount??0)/100}),e.jsx(s,{children:n.currency}),e.jsx(s,{children:n.status}),e.jsxs(s,{children:[((n.taxAmount??0)/100).toFixed(2)," (",((n.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(s,{children:n.taxJurisdiction}),e.jsx(s,{children:(t=n.user)==null?void 0:t.email}),e.jsx(s,{children:(o=(r=n.user)==null?void 0:r.taxInformation)==null?void 0:o.taxResidency})]},n.id)})})]})})]}),m===2&&e.jsx(y,{children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Tax Summary"}),e.jsx(P,{sx:{mb:1}}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(a,{variant:"overline",children:"By Jurisdiction"}),e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Jurisdiction"}),e.jsx(s,{align:"right",children:"Tax"}),e.jsx(s,{align:"right",children:"Taxable"}),e.jsx(s,{align:"right",children:"Count"})]})}),e.jsx(v,{children:(d==null?void 0:d.byJurisdiction)&&Object.entries(d.byJurisdiction).map(([n,t])=>e.jsxs(l,{children:[e.jsx(s,{children:n}),e.jsx(s,{align:"right",children:((t.tax_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:((t.taxable_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:t.count})]},n))})]})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(a,{variant:"overline",children:"By Country"}),e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Country"}),e.jsx(s,{align:"right",children:"Tax"}),e.jsx(s,{align:"right",children:"Taxable"}),e.jsx(s,{align:"right",children:"Count"})]})}),e.jsx(v,{children:(d==null?void 0:d.byCountry)&&Object.entries(d.byCountry).map(([n,t])=>e.jsxs(l,{children:[e.jsx(s,{children:n}),e.jsx(s,{align:"right",children:((t.tax_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:((t.taxable_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:t.count})]},n))})]})]})]})]})}),m===3&&e.jsx(y,{children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"KYC Overview"}),e.jsx(P,{sx:{mb:1}}),e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Email"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Completed At"}),e.jsx(s,{children:"Name"}),e.jsx(s,{children:"Nationality"}),e.jsx(s,{children:"Residence"}),e.jsx(s,{children:"Company"})]})}),e.jsx(v,{children:G.map(n=>{var t,r,o,u,j;return e.jsxs(l,{children:[e.jsx(s,{children:n.email}),e.jsx(s,{children:n.kycStatus}),e.jsx(s,{children:n.kycCompletedAt?new Date(n.kycCompletedAt).toLocaleDateString():"-"}),e.jsxs(s,{children:[(t=n.complianceProfile)==null?void 0:t.firstName," ",(r=n.complianceProfile)==null?void 0:r.lastName]}),e.jsx(s,{children:(o=n.complianceProfile)==null?void 0:o.nationality}),e.jsx(s,{children:(u=n.complianceProfile)==null?void 0:u.countryOfResidence}),e.jsx(s,{children:(j=n.businessProfile)==null?void 0:j.companyName})]},n.id)})})]})]})}),m===4&&e.jsx(y,{children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Compliance Events"}),e.jsx(P,{sx:{mb:1}}),e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Type"}),e.jsx(s,{children:"Severity"}),e.jsx(s,{children:"Description"})]})}),e.jsx(v,{children:H.map(n=>e.jsxs(l,{children:[e.jsx(s,{children:n.eventType}),e.jsx(s,{children:n.severity}),e.jsx(s,{children:n.description})]},n.id))})]})]})})]})};export{ae as default};
