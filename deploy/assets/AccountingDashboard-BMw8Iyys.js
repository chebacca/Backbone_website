import{j as e,a as R,T as m,t as K,aA as Ge,aB as D,c as S,G as u,S as Q,u as y,bZ as Xe,b_ as P,aZ as qe,a_ as Ze,a$ as et,a4 as je,b0 as H,d as f,R as tt,as as pe,b$ as at,c0 as nt,c1 as st,M,c2 as it,c3 as ot,aC as rt,c4 as lt,aO as E,aP as N,aQ as b,aR as a,aS as k,h as ct,aN as dt}from"./mui-T5zcPaKR.js";import{r as j,h as ht,u as xt}from"./vendor-OeuszDaU.js";import{c as v,e as O}from"./index-D8p3pxbN.js";import"./stripe-Bd-xCkZF.js";const gt=()=>{var te,ae,ne,se,ie;const[ge,ye]=j.useState([]),F=ht(),G=xt(),[z,be]=j.useState(""),[B,ve]=j.useState(""),[C,J]=j.useState(0),X=j.useMemo(()=>({"#overview":0,"#payments":1,"#tax":2,"#filings":3,"#kyc":4,"#compliance":5,"#terms":6}),[]),Se=j.useMemo(()=>({0:"overview",1:"payments",2:"tax",3:"filings",4:"kyc",5:"compliance",6:"terms"}),[]);j.useEffect(()=>{const t=(F.hash||"").toLowerCase();if(t&&Object.prototype.hasOwnProperty.call(X,t)){const n=X[t];n!==C&&J(n)}else t||(C!==0&&J(0),F.pathname.startsWith("/accounting")&&G("/accounting#overview",{replace:!0}))},[F.hash]);const fe=(t,n)=>{J(n);const l=`#${Se[n]}`;(F.hash||"").toLowerCase()!==l&&G(`/accounting${l}`,{replace:!0})},[p,Te]=j.useState(null),[x,q]=j.useState(null),[Ce,we]=j.useState([]),[Ae,Le]=j.useState([]),[_e,$e]=j.useState([]),[V,Ie]=j.useState(0),[A,_]=j.useState(""),[L,$]=j.useState(""),[U,Re]=j.useState("US_SALES_TAX"),[o,T]=j.useState({legalName:"",taxId:"",addressLine1:"",addressLine2:"",city:"",region:"",postalCode:"",country:"US",contactEmail:""}),[Oe,De]=j.useState([]),[W,Me]=j.useState("NY"),[Z,Ee]=j.useState("US"),[Ne,ke]=j.useState(null),Y=[{code:"AL",name:"Alabama"},{code:"AK",name:"Alaska"},{code:"AZ",name:"Arizona"},{code:"AR",name:"Arkansas"},{code:"CA",name:"California",portal:"https://onlineservices.cdtfa.ca.gov"},{code:"CO",name:"Colorado"},{code:"CT",name:"Connecticut"},{code:"DE",name:"Delaware"},{code:"FL",name:"Florida",portal:"https://floridarevenue.com/taxes/Pages/return_drt.aspx"},{code:"GA",name:"Georgia"},{code:"HI",name:"Hawaii"},{code:"ID",name:"Idaho"},{code:"IL",name:"Illinois"},{code:"IN",name:"Indiana"},{code:"IA",name:"Iowa"},{code:"KS",name:"Kansas"},{code:"KY",name:"Kentucky"},{code:"LA",name:"Louisiana"},{code:"ME",name:"Maine"},{code:"MD",name:"Maryland"},{code:"MA",name:"Massachusetts"},{code:"MI",name:"Michigan"},{code:"MN",name:"Minnesota"},{code:"MS",name:"Mississippi"},{code:"MO",name:"Missouri"},{code:"MT",name:"Montana"},{code:"NE",name:"Nebraska"},{code:"NV",name:"Nevada"},{code:"NH",name:"New Hampshire"},{code:"NJ",name:"New Jersey"},{code:"NM",name:"New Mexico"},{code:"NY",name:"New York",portal:"https://www.tax.ny.gov/online/"},{code:"NC",name:"North Carolina"},{code:"ND",name:"North Dakota"},{code:"OH",name:"Ohio"},{code:"OK",name:"Oklahoma"},{code:"OR",name:"Oregon"},{code:"PA",name:"Pennsylvania"},{code:"RI",name:"Rhode Island"},{code:"SC",name:"South Carolina"},{code:"SD",name:"South Dakota"},{code:"TN",name:"Tennessee"},{code:"TX",name:"Texas",portal:"https://comptroller.texas.gov/taxes/file-pay/"},{code:"UT",name:"Utah"},{code:"VT",name:"Vermont"},{code:"VA",name:"Virginia"},{code:"WA",name:"Washington",portal:"https://secure.dor.wa.gov/"},{code:"WV",name:"West Virginia"},{code:"WI",name:"Wisconsin"},{code:"WY",name:"Wyoming"},{code:"DC",name:"District of Columbia"}];j.useEffect(()=>{try{const r=localStorage.getItem("filing_company_default");r&&T(JSON.parse(r))}catch{}const t=new Date,n=new Date(t.getFullYear(),t.getMonth()-1,1),s=new Date(t.getFullYear(),t.getMonth(),0),l=r=>`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`;_(l(n)),$(l(s))},[]);const Pe=t=>{const n=new Date,s=i=>`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`,l=(i,c)=>new Date(i,c,1),r=(i,c)=>new Date(i,c+1,0),h=(i,c)=>new Date(i,c*3,1),d=(i,c)=>new Date(i,c*3+3,0);if(t==="THIS_MONTH"){const i=l(n.getFullYear(),n.getMonth()),c=r(n.getFullYear(),n.getMonth());_(s(i)),$(s(c));return}if(t==="LAST_MONTH"){const i=l(n.getFullYear(),n.getMonth()-1),c=r(n.getFullYear(),n.getMonth()-1);_(s(i)),$(s(c));return}if(t==="THIS_QUARTER"){const i=Math.floor(n.getMonth()/3),c=h(n.getFullYear(),i),g=d(n.getFullYear(),i);_(s(c)),$(s(g));return}if(t==="LAST_QUARTER"){let i=Math.floor(n.getMonth()/3)-1,c=n.getFullYear();i<0&&(i=3,c-=1);const g=h(c,i),w=d(c,i);_(s(g)),$(s(w));return}if(t==="YTD"){const i=new Date(n.getFullYear(),0,1),c=n;_(s(i)),$(s(c));return}if(t==="LAST_YEAR"){const i=n.getFullYear()-1,c=new Date(i,0,1),g=new Date(i,11,31);_(s(c)),$(s(g));return}},Ue=async()=>{try{localStorage.setItem("filing_company_default",JSON.stringify(o))}catch{}try{await v.post(O.admin.companyFilingSave(),o)}catch{}},Ye=()=>{try{const t=localStorage.getItem("filing_company_default");t&&T(JSON.parse(t))}catch{}},ee=async()=>{var n,s;const t=await v.get(O.accounting.payments(),{params:{limit:50}});ye(((s=(n=t.data)==null?void 0:n.data)==null?void 0:s.payments)||[])};j.useEffect(()=>{(async()=>{var i,c,g,w,I,oe,re,le,ce,de,he,xe;ee();const[n,s,l,r,h]=await Promise.all([v.get("accounting/overview"),v.get("accounting/tax/summary"),v.get("accounting/kyc"),v.get("accounting/compliance-events"),v.get(O.accounting.consentsLatest())]);Te(((i=n.data)==null?void 0:i.data)||null),q(((c=s.data)==null?void 0:c.data)||null),we(((w=(g=l.data)==null?void 0:g.data)==null?void 0:w.users)||[]),Le(((oe=(I=r.data)==null?void 0:I.data)==null?void 0:oe.events)||[]),$e(((le=(re=h.data)==null?void 0:re.data)==null?void 0:le.users)||[]);const d=(((de=(ce=l.data)==null?void 0:ce.data)==null?void 0:de.users)||[]).filter(me=>String(me.kycStatus||"").toUpperCase()!=="COMPLETED").length;Ie(d);try{const ue=(xe=(he=(await v.get(O.admin.companyFilingGet())).data)==null?void 0:he.data)==null?void 0:xe.company;ue&&T(Qe=>({...Qe,...ue}))}catch{}})()},[]);const Fe=async()=>{var c,g;const t={from:z,to:B,includePII:!1},s=((g=(c=(await v.post(O.accounting.exportPayments(),t)).data)==null?void 0:c.data)==null?void 0:g.rows)||[],r=[Object.keys(s[0]||{}).join(","),...s.map(w=>Object.values(w).map(I=>JSON.stringify(I??"")).join(","))].join(`
`),h=new Blob([r],{type:"text/csv"}),d=URL.createObjectURL(h),i=document.createElement("a");i.href=d,i.download=`payments_${z||"all"}_${B||"all"}.csv`,i.click(),URL.revokeObjectURL(d)},We=async()=>{var c,g;const t={from:A,to:L,includePII:!1},s=((g=(c=(await v.post(O.accounting.exportPayments(),t)).data)==null?void 0:c.data)==null?void 0:g.rows)||[],r=[Object.keys(s[0]||{}).join(","),...s.map(w=>Object.values(w).map(I=>JSON.stringify(I??"")).join(","))].join(`
`),h=new Blob([r],{type:"text/csv"}),d=URL.createObjectURL(h),i=document.createElement("a");i.href=d,i.download=`payments_${A||"all"}_${L||"all"}.csv`,i.click(),URL.revokeObjectURL(d)},He=async()=>{var s,l,r;const t=await v.get("accounting/tax/summary",{params:{from:A||void 0,to:L||void 0}});q(((s=t.data)==null?void 0:s.data)||null);const n=await v.get(O.accounting.payments(),{params:{from:A||void 0,to:L||void 0,limit:500}});De(((r=(l=n.data)==null?void 0:l.data)==null?void 0:r.payments)||[])},ze=()=>{if(!x)return;const t=[];if(U==="US_SALES_TAX"){const d=(x==null?void 0:x.byJurisdiction)||{};for(const[i,c]of Object.entries(d))t.push({jurisdiction:i,tax_cents:c.tax_cents??0,taxable_cents:c.taxable_cents??0,count:c.count??0})}else{const d=(x==null?void 0:x.byCountry)||{};for(const[i,c]of Object.entries(d))t.push({country:i,tax_cents:c.tax_cents??0,taxable_cents:c.taxable_cents??0,count:c.count??0})}const s=[Object.keys(t[0]||{}).join(","),...t.map(d=>Object.values(d).map(i=>JSON.stringify(i??"")).join(","))].join(`
`),l=new Blob([s],{type:"text/csv"}),r=URL.createObjectURL(l),h=document.createElement("a");h.href=r,h.download=`filing_summary_${U}_${A||"all"}_${L||"all"}.csv`,h.click(),URL.revokeObjectURL(r)},Be=()=>{const t=window.open("","PRINT","height=800,width=800");if(!t)return;const n=`${A||"Start"} to ${L||"End"}`,s=U==="US_SALES_TAX"?(x==null?void 0:x.byJurisdiction)||{}:(x==null?void 0:x.byCountry)||{},l=Object.values(s).reduce((h,d)=>({tax:h.tax+((d==null?void 0:d.tax_cents)||0),taxable:h.taxable+((d==null?void 0:d.taxable_cents)||0),count:h.count+((d==null?void 0:d.count)||0)}),{tax:0,taxable:0,count:0}),r=`<!doctype html><html><head><meta charset="utf-8"><title>Filing Cover Sheet</title>
      <style>body{font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding:24px;} h1,h2{margin:0 0 8px;} table{border-collapse: collapse; width:100%; margin-top:16px;} th,td{border:1px solid #ccc; padding:8px; text-align:left;} small{color:#666}</style>
    </head><body>
      <h1>Tax Filing Cover Sheet</h1>
      <small>Generated by Accounting Dashboard</small>
      <h2>Company</h2>
      <div>${o.legalName||"-"}</div>
      <div>${o.addressLine1||""} ${o.addressLine2||""}</div>
      <div>${o.city||""} ${o.region||""} ${o.postalCode||""} ${o.country||""}</div>
      <div>Tax ID: ${o.taxId||"-"}</div>
      <div>Contact: ${o.contactEmail||"-"}</div>
      <h2>Filing</h2>
      <div>Scheme: ${U}</div>
      <div>Period: ${n}</div>
      <table>
        <tr><th>Total Taxable</th><th>Total Tax</th><th>Transactions</th></tr>
        <tr><td>${(l.taxable/100).toLocaleString()}</td><td>${(l.tax/100).toLocaleString()}</td><td>${l.count}</td></tr>
      </table>
      <p style="margin-top:16px">Attach the jurisdiction/member-state summary CSV and payments CSV for the filing period when submitting via your tax portal or provider.</p>
      <script>window.onload=function(){window.print(); setTimeout(()=>window.close(), 300);}<\/script>
    </body></html>`;t.document.write(r),t.document.close(),t.focus()},Je=()=>{var n;const t={};for(const s of Oe){if(String(s.status).toUpperCase()!=="SUCCEEDED")continue;const l=((n=s.billingAddress)==null?void 0:n.state)||"UNKNOWN",r=s.taxAmount??0,h=(s.amount??0)-r;t[l]=t[l]||{taxable_cents:0,tax_cents:0,count:0},t[l].taxable_cents+=h,t[l].tax_cents+=r,t[l].count+=1}return t},Ve=t=>{const s=Je()[t]||{taxable_cents:0,tax_cents:0,count:0},l=`${A||"Start"} to ${L||"End"}`,r=Y.find(i=>i.code===t),h=window.open("","PRINT","height=900,width=1000");if(!h)return;const d=`<!doctype html><html><head><meta charset="utf-8"><title>${t} Sales Tax Worksheet</title>
      <style>body{font-family:-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;padding:24px;} h1{margin:0 0 8px} table{border-collapse:collapse;width:100%;margin-top:16px;} th,td{border:1px solid #ccc;padding:8px;text-align:left;} small{color:#666}</style>
    </head><body>
      <h1>${(r==null?void 0:r.name)||t} Sales and Use Tax Return (Worksheet)</h1>
      <small>For reference only. Most states require e-filing via their tax portal.</small>
      <h2>Company</h2>
      <div>${o.legalName||"-"}</div>
      <div>${o.addressLine1||""} ${o.addressLine2||""}</div>
      <div>${o.city||""} ${o.region||""} ${o.postalCode||""} ${o.country||""}</div>
      <div>Tax ID: ${o.taxId||"-"}</div>
      <div>Contact: ${o.contactEmail||"-"}</div>
      <h2>Period: ${l}</h2>
      <table>
        <tr><th>Taxable sales (${t})</th><td>${(s.taxable_cents/100).toLocaleString()}</td></tr>
        <tr><th>Sales and use tax due (${t})</th><td>${(s.tax_cents/100).toLocaleString()}</td></tr>
        <tr><th>Transactions</th><td>${s.count}</td></tr>
      </table>
      ${r!=null&&r.portal?`<p style="margin-top:16px">Portal: <a href="${r.portal}" target="_blank" rel="noreferrer">${r.portal}</a></p>`:""}
      <script>window.onload=function(){window.print(); setTimeout(()=>window.close(), 300);}<\/script>
    </body></html>`;h.document.write(d),h.document.close(),h.focus()},Ke=t=>{const n=`${A||"Start"} to ${L||"End"}`,l=((x==null?void 0:x.byCountry)||{})[t]||{tax_cents:0,taxable_cents:0,count:0},r=window.open("","PRINT","height=900,width=1000");if(!r)return;const h=`<!doctype html><html><head><meta charset="utf-8"><title>${t} VAT/Sales Worksheet</title>
      <style>body{font-family:-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;padding:24px;} h1{margin:0 0 8px} table{border-collapse:collapse;width:100%;margin-top:16px;} th,td{border:1px solid #ccc;padding:8px;text-align:left;} small{color:#666}</style>
    </head><body>
      <h1>${t} Indirect Tax Worksheet</h1>
      <small>For reference only. File via your national portal (e.g., EU OSS, CRA GST/HST).</small>
      <h2>Company</h2>
      <div>${o.legalName||"-"}</div>
      <div>${o.addressLine1||""} ${o.addressLine2||""}</div>
      <div>${o.city||""} ${o.region||""} ${o.postalCode||""} ${o.country||""}</div>
      <div>Tax ID: ${o.taxId||"-"}</div>
      <div>Contact: ${o.contactEmail||"-"}</div>
      <h2>Period: ${n}</h2>
      <table>
        <tr><th>Taxable amount (${t})</th><td>${(l.taxable_cents/100).toLocaleString()}</td></tr>
        <tr><th>Tax due (${t})</th><td>${(l.tax_cents/100).toLocaleString()}</td></tr>
        <tr><th>Transactions</th><td>${l.count||0}</td></tr>
      </table>
      <script>window.onload=function(){window.print(); setTimeout(()=>window.close(), 300);}<\/script>
    </body></html>`;r.document.write(h),r.document.close(),r.focus()};return e.jsxs(R,{sx:{p:3},children:[e.jsx(m,{variant:"h4",fontWeight:700,gutterBottom:!0,children:"Accounting & Compliance"}),e.jsx(m,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Financial reporting, tax, KYC/AML, and regulatory oversight snapshot."}),V>0&&e.jsxs(K,{severity:"warning",sx:{mb:2},children:[V," user",V===1?"":"s"," require KYC verification. Review the KYC tab for details."]}),e.jsxs(Ge,{value:C,onChange:fe,sx:{mb:2},children:[e.jsx(D,{label:"Overview"}),e.jsx(D,{label:"Payments"}),e.jsx(D,{label:"Tax"}),e.jsx(D,{label:"Filings"}),e.jsx(D,{label:"KYC"}),e.jsx(D,{label:"Compliance"}),e.jsx(D,{label:"Terms"})]}),C===3&&e.jsx(R,{children:e.jsxs(S,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Filing Packet"}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"Filing Period"}),e.jsxs(Q,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(y,{label:"From (YYYY-MM-DD)",placeholder:"2025-01-01",value:A,onChange:t=>_(t.target.value),size:"small"}),e.jsx(y,{label:"To (YYYY-MM-DD)",placeholder:"2025-12-31",value:L,onChange:t=>$(t.target.value),size:"small"})]}),e.jsxs(Xe,{exclusive:!0,size:"small",value:Ne,onChange:(t,n)=>{if(ke(n),!n)return;Pe({THIS_MONTH:"THIS_MONTH",LAST_MONTH:"LAST_MONTH",THIS_QUARTER:"THIS_QUARTER",LAST_QUARTER:"LAST_QUARTER",YTD:"YTD",LAST_YEAR:"LAST_YEAR"}[n])},sx:{mb:2,flexWrap:"wrap"},children:[e.jsx(P,{value:"THIS_MONTH",children:"This Month"}),e.jsx(P,{value:"LAST_MONTH",children:"Last Month"}),e.jsx(P,{value:"THIS_QUARTER",children:"This Quarter"}),e.jsx(P,{value:"LAST_QUARTER",children:"Last Quarter"}),e.jsx(P,{value:"YTD",children:"YTD"}),e.jsx(P,{value:"LAST_YEAR",children:"Last Year"})]}),e.jsxs(qe,{size:"small",sx:{minWidth:240},children:[e.jsx(Ze,{id:"scheme-label",children:"Scheme"}),e.jsxs(et,{labelId:"scheme-label",id:"scheme",value:U,label:"Scheme",onChange:t=>Re(t.target.value),children:[e.jsx(je,{value:"US_SALES_TAX",children:"US Sales Tax (state/county)"}),e.jsx(je,{value:"EU_OSS",children:"EU OSS VAT (member state)"})]})]}),e.jsxs(H,{variant:"contained",size:"small",sx:{mt:2,flexWrap:"wrap"},children:[e.jsx(f,{color:"inherit",startIcon:e.jsx(tt,{}),onClick:He,children:"Refresh"}),e.jsx(f,{color:"primary",startIcon:e.jsx(pe,{}),onClick:ze,children:"Summary CSV"}),e.jsx(f,{color:"secondary",startIcon:e.jsx(pe,{}),onClick:We,children:"Payments CSV"})]})]}),e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"Company Info (for cover sheet)"}),e.jsxs(u,{container:!0,spacing:1,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Legal Name",value:o.legalName,onChange:t=>T({...o,legalName:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Tax ID / VAT",value:o.taxId,onChange:t=>T({...o,taxId:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Contact Email",value:o.contactEmail,onChange:t=>T({...o,contactEmail:t.target.value})})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Address Line 1",value:o.addressLine1,onChange:t=>T({...o,addressLine1:t.target.value})})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Address Line 2",value:o.addressLine2,onChange:t=>T({...o,addressLine2:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:4,children:e.jsx(y,{fullWidth:!0,size:"small",label:"City",value:o.city,onChange:t=>T({...o,city:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:4,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Region/State",value:o.region,onChange:t=>T({...o,region:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:4,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Postal Code",value:o.postalCode,onChange:t=>T({...o,postalCode:t.target.value})})})]}),e.jsxs(H,{variant:"outlined",size:"small",sx:{mt:2,flexWrap:"wrap"},children:[e.jsx(f,{startIcon:e.jsx(at,{}),onClick:Be,children:"Cover Sheet"}),e.jsx(f,{startIcon:e.jsx(nt,{}),onClick:Ue,children:"Save Defaults"}),e.jsx(f,{startIcon:e.jsx(st,{}),onClick:Ye,children:"Load Defaults"})]}),e.jsx(M,{sx:{my:2}}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"US State Worksheets"}),e.jsx(it,{options:Y,getOptionLabel:t=>`${t.code} â€” ${t.name}`,value:Y.find(t=>t.code===W)||null,onChange:(t,n)=>Me((n==null?void 0:n.code)||"NY"),renderInput:t=>e.jsx(y,{...t,label:"Select State",size:"small"}),sx:{maxWidth:400,mt:1}}),e.jsxs(H,{size:"small",sx:{mt:2,flexWrap:"wrap"},children:[e.jsx(f,{variant:"contained",startIcon:e.jsx(ot,{}),onClick:()=>Ve(W),children:"Print State Worksheet"}),((te=Y.find(t=>t.code===W))==null?void 0:te.portal)&&e.jsx(f,{variant:"outlined",startIcon:e.jsx(rt,{}),onClick:()=>window.open(Y.find(t=>t.code===W).portal,"_blank","noreferrer"),children:"Open Portal"})]})]}),e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"International (Country) Worksheets"}),e.jsx(y,{label:"Country Code (ISO alpha-2)",size:"small",value:Z,onChange:t=>Ee(t.target.value.toUpperCase()),sx:{maxWidth:240,mt:1}}),e.jsx(H,{size:"small",sx:{mt:2,flexWrap:"wrap"},children:e.jsx(f,{variant:"contained",startIcon:e.jsx(lt,{}),onClick:()=>Ke(Z),children:"Print Country Worksheet"})}),e.jsx(K,{severity:"info",sx:{mt:2},children:"For EU OSS, use scheme EU_OSS and the jurisdiction summary CSV; for Canada, file GST/HST per CRA portal."})]})]})]})]}),e.jsx(K,{severity:"info",sx:{mt:2},children:"This packet mirrors common filings used by SaaS: US Sales Tax returns (state/county totals) and EU OSS VAT returns (member-state totals). Attach the CSV summaries and payments export when filing via your tax portal or provider."})]})}),C===0&&e.jsxs(R,{children:[e.jsxs(u,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(S,{sx:{p:2},children:[e.jsx(m,{variant:"overline",children:"Revenue (USD)"}),e.jsx(m,{variant:"h5",children:((((ae=p==null?void 0:p.totals)==null?void 0:ae.revenue_cents)||0)/100).toLocaleString()})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(S,{sx:{p:2},children:[e.jsx(m,{variant:"overline",children:"Tax Collected"}),e.jsx(m,{variant:"h5",children:((((ne=p==null?void 0:p.totals)==null?void 0:ne.tax_cents)||0)/100).toLocaleString()})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(S,{sx:{p:2},children:[e.jsx(m,{variant:"overline",children:"Payments"}),e.jsx(m,{variant:"h5",children:((se=p==null?void 0:p.totals)==null?void 0:se.paymentsCount)||0})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(S,{sx:{p:2},children:[e.jsx(m,{variant:"overline",children:"KYC Completed"}),e.jsx(m,{variant:"h5",children:((ie=p==null?void 0:p.kycCounts)==null?void 0:ie.COMPLETED)||0})]})})]}),e.jsxs(S,{sx:{p:2,mb:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Recent Payments"}),e.jsx(M,{sx:{mb:1}}),e.jsxs(E,{size:"small",children:[e.jsx(N,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Invoice"}),e.jsx(a,{align:"right",children:"Amount"}),e.jsx(a,{children:"Tax"}),e.jsx(a,{children:"Jurisdiction"})]})}),e.jsx(k,{children:((p==null?void 0:p.recentPayments)||[]).map(t=>e.jsxs(b,{children:[e.jsx(a,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(a,{children:t.stripeInvoiceId}),e.jsx(a,{align:"right",children:(t.amount??0)/100}),e.jsxs(a,{children:[((t.taxAmount??0)/100).toFixed(2)," (",((t.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(a,{children:t.jurisdiction})]},t.id))})]})]}),e.jsxs(S,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Tax by Jurisdiction"}),e.jsx(M,{sx:{mb:1}}),e.jsx(Q,{direction:"row",spacing:1,flexWrap:"wrap",children:(p==null?void 0:p.taxByJurisdiction)&&Object.entries(p.taxByJurisdiction).map(([t,n])=>e.jsx(ct,{label:`${t}: ${(n/100).toLocaleString()}`},t))})]})]}),C===1&&e.jsxs(R,{children:[e.jsxs(Q,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(y,{label:"From (YYYY-MM-DD)",placeholder:"2025-01-01",value:z,onChange:t=>be(t.target.value),size:"small"}),e.jsx(y,{label:"To (YYYY-MM-DD)",placeholder:"2025-12-31",value:B,onChange:t=>ve(t.target.value),size:"small"}),e.jsx(f,{variant:"contained",onClick:Fe,children:"Export CSV"}),e.jsx(f,{variant:"outlined",onClick:ee,children:"Refresh"})]}),e.jsx(dt,{component:S,children:e.jsxs(E,{size:"small",children:[e.jsx(N,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Invoice"}),e.jsx(a,{align:"right",children:"Amount"}),e.jsx(a,{children:"Currency"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Tax"}),e.jsx(a,{children:"Jurisdiction"}),e.jsx(a,{children:"User Email"}),e.jsx(a,{children:"Residency"})]})}),e.jsx(k,{children:ge.map(t=>{var n,s,l;return e.jsxs(b,{children:[e.jsx(a,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(a,{children:t.stripeInvoiceId}),e.jsx(a,{align:"right",children:(t.amount??0)/100}),e.jsx(a,{children:t.currency}),e.jsx(a,{children:t.status}),e.jsxs(a,{children:[((t.taxAmount??0)/100).toFixed(2)," (",((t.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(a,{children:t.taxJurisdiction}),e.jsx(a,{children:(n=t.user)==null?void 0:n.email}),e.jsx(a,{children:(l=(s=t.user)==null?void 0:s.taxInformation)==null?void 0:l.taxResidency})]},t.id)})})]})})]}),C===2&&e.jsx(R,{children:e.jsxs(S,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Tax Summary"}),e.jsx(M,{sx:{mb:1}}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"By Jurisdiction"}),e.jsxs(E,{size:"small",children:[e.jsx(N,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Jurisdiction"}),e.jsx(a,{align:"right",children:"Tax"}),e.jsx(a,{align:"right",children:"Taxable"}),e.jsx(a,{align:"right",children:"Count"})]})}),e.jsx(k,{children:(x==null?void 0:x.byJurisdiction)&&Object.entries(x.byJurisdiction).map(([t,n])=>e.jsxs(b,{children:[e.jsx(a,{children:t}),e.jsx(a,{align:"right",children:((n.tax_cents||0)/100).toLocaleString()}),e.jsx(a,{align:"right",children:((n.taxable_cents||0)/100).toLocaleString()}),e.jsx(a,{align:"right",children:n.count})]},t))})]})]}),e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"By Country"}),e.jsxs(E,{size:"small",children:[e.jsx(N,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Country"}),e.jsx(a,{align:"right",children:"Tax"}),e.jsx(a,{align:"right",children:"Taxable"}),e.jsx(a,{align:"right",children:"Count"})]})}),e.jsx(k,{children:(x==null?void 0:x.byCountry)&&Object.entries(x.byCountry).map(([t,n])=>e.jsxs(b,{children:[e.jsx(a,{children:t}),e.jsx(a,{align:"right",children:((n.tax_cents||0)/100).toLocaleString()}),e.jsx(a,{align:"right",children:((n.taxable_cents||0)/100).toLocaleString()}),e.jsx(a,{align:"right",children:n.count})]},t))})]})]})]})]})}),C===4&&e.jsx(R,{children:e.jsxs(S,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"KYC Overview"}),e.jsx(M,{sx:{mb:1}}),e.jsxs(E,{size:"small",children:[e.jsx(N,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Email"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Completed At"}),e.jsx(a,{children:"Name"}),e.jsx(a,{children:"Nationality"}),e.jsx(a,{children:"Residence"}),e.jsx(a,{children:"Company"})]})}),e.jsx(k,{children:Ce.map(t=>{var n,s,l,r,h;return e.jsxs(b,{children:[e.jsx(a,{children:t.email}),e.jsx(a,{children:t.kycStatus}),e.jsx(a,{children:t.kycCompletedAt?new Date(t.kycCompletedAt).toLocaleDateString():"-"}),e.jsxs(a,{children:[(n=t.complianceProfile)==null?void 0:n.firstName," ",(s=t.complianceProfile)==null?void 0:s.lastName]}),e.jsx(a,{children:(l=t.complianceProfile)==null?void 0:l.nationality}),e.jsx(a,{children:(r=t.complianceProfile)==null?void 0:r.countryOfResidence}),e.jsx(a,{children:(h=t.businessProfile)==null?void 0:h.companyName})]},t.id)})})]})]})}),C===5&&e.jsx(R,{children:e.jsxs(S,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Compliance Events"}),e.jsx(M,{sx:{mb:1}}),e.jsxs(E,{size:"small",children:[e.jsx(N,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Type"}),e.jsx(a,{children:"Severity"}),e.jsx(a,{children:"Description"})]})}),e.jsx(k,{children:Ae.map(t=>e.jsxs(b,{children:[e.jsx(a,{children:t.eventType}),e.jsx(a,{children:t.severity}),e.jsx(a,{children:t.description})]},t.id))})]})]})}),C===6&&e.jsx(R,{children:e.jsxs(S,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Terms & Privacy Acceptance"}),e.jsx(M,{sx:{mb:1}}),e.jsxs(E,{size:"small",children:[e.jsx(N,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Email"}),e.jsx(a,{children:"Terms Version"}),e.jsx(a,{children:"Terms Accepted At"}),e.jsx(a,{children:"Privacy Version"}),e.jsx(a,{children:"Privacy Accepted At"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(k,{children:_e.map(t=>e.jsxs(b,{children:[e.jsx(a,{children:t.email}),e.jsx(a,{children:t.termsVersionAccepted||"-"}),e.jsx(a,{children:t.termsAcceptedAt?new Date(t.termsAcceptedAt).toLocaleString():"-"}),e.jsx(a,{children:t.privacyPolicyVersionAccepted||"-"}),e.jsx(a,{children:t.privacyPolicyAcceptedAt?new Date(t.privacyPolicyAcceptedAt).toLocaleString():"-"}),e.jsx(a,{children:e.jsx(f,{size:"small",onClick:async()=>{var c,g;const s=((g=(c=(await v.get(O.accounting.userConsentHistory(t.id),{params:{includePII:!1}})).data)==null?void 0:c.data)==null?void 0:g.consents)||[],r=[Object.keys(s[0]||{}).join(","),...s.map(w=>Object.values(w).map(I=>JSON.stringify(I??"")).join(","))].join(`
`),h=new Blob([r],{type:"text/csv"}),d=URL.createObjectURL(h),i=document.createElement("a");i.href=d,i.download=`consent_history_${t.email}.csv`,i.click(),URL.revokeObjectURL(d)},children:"Export History"})})]},t.id))})]})]})})]})};export{gt as default};
