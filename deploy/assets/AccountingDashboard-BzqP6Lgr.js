import{j as e,a as y,T as a,t as ne,b9 as ie,ba as D,G as h,c,D as P,aC as p,aD as b,aE as l,aF as s,aG as C,S as K,h as ae,u as _,d as z,aB as re}from"./mui-pHPyF4nf.js";import{r as d}from"./vendor-DIxetjBo.js";import{c as v,e as M}from"./index-C_IqXqnP.js";import"./stripe-B5n5czio.js";const oe=()=>{var A,k,J,w;const[U,N]=d.useState([]),[B,$]=d.useState(""),[E,G]=d.useState(""),[j,W]=d.useState(0),[i,q]=d.useState(null),[o,H]=d.useState(null),[V,Q]=d.useState([]),[X,Z]=d.useState([]),[O,ee]=d.useState(0),Y=async()=>{var n,r;const t=await v.get(M.accounting.payments(),{params:{limit:50}});N(((r=(n=t.data)==null?void 0:n.data)==null?void 0:r.payments)||[])};d.useEffect(()=>{(async()=>{var S,g,T,f,L,R,F,I;Y();const[n,r,x,m]=await Promise.all([v.get("accounting/overview"),v.get("accounting/tax/summary"),v.get("accounting/kyc"),v.get("accounting/compliance-events")]);q(((S=n.data)==null?void 0:S.data)||null),H(((g=r.data)==null?void 0:g.data)||null),Q(((f=(T=x.data)==null?void 0:T.data)==null?void 0:f.users)||[]),Z(((R=(L=m.data)==null?void 0:L.data)==null?void 0:R.events)||[]);const u=(((I=(F=x.data)==null?void 0:F.data)==null?void 0:I.users)||[]).filter(te=>String(te.kycStatus||"").toUpperCase()!=="COMPLETED").length;ee(u)})()},[]);const se=async()=>{var T,f;const t={from:B,to:E,includePII:!1},r=((f=(T=(await v.post(M.accounting.exportPayments(),t)).data)==null?void 0:T.data)==null?void 0:f.rows)||[],m=[Object.keys(r[0]||{}).join(","),...r.map(L=>Object.values(L).map(R=>JSON.stringify(R??"")).join(","))].join(`
`),u=new Blob([m],{type:"text/csv"}),S=URL.createObjectURL(u),g=document.createElement("a");g.href=S,g.download=`payments_${B||"all"}_${E||"all"}.csv`,g.click(),URL.revokeObjectURL(S)};return e.jsxs(y,{sx:{p:3},children:[e.jsx(a,{variant:"h4",fontWeight:700,gutterBottom:!0,children:"Accounting & Compliance"}),e.jsx(a,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Financial reporting, tax, KYC/AML, and regulatory oversight snapshot."}),O>0&&e.jsxs(ne,{severity:"warning",sx:{mb:2},children:[O," user",O===1?"":"s"," require KYC verification. Review the KYC tab for details."]}),e.jsxs(ie,{value:j,onChange:(t,n)=>W(n),sx:{mb:2},children:[e.jsx(D,{label:"Overview"}),e.jsx(D,{label:"Payments"}),e.jsx(D,{label:"Tax"}),e.jsx(D,{label:"KYC"}),e.jsx(D,{label:"Compliance"})]}),j===0&&e.jsxs(y,{children:[e.jsxs(h,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(h,{item:!0,xs:12,md:3,children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"overline",children:"Revenue (USD)"}),e.jsx(a,{variant:"h5",children:((((A=i==null?void 0:i.totals)==null?void 0:A.revenue_cents)||0)/100).toLocaleString()})]})}),e.jsx(h,{item:!0,xs:12,md:3,children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"overline",children:"Tax Collected"}),e.jsx(a,{variant:"h5",children:((((k=i==null?void 0:i.totals)==null?void 0:k.tax_cents)||0)/100).toLocaleString()})]})}),e.jsx(h,{item:!0,xs:12,md:3,children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"overline",children:"Payments"}),e.jsx(a,{variant:"h5",children:((J=i==null?void 0:i.totals)==null?void 0:J.paymentsCount)||0})]})}),e.jsx(h,{item:!0,xs:12,md:3,children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"overline",children:"KYC Completed"}),e.jsx(a,{variant:"h5",children:((w=i==null?void 0:i.kycCounts)==null?void 0:w.COMPLETED)||0})]})})]}),e.jsxs(c,{sx:{p:2,mb:2},children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Recent Payments"}),e.jsx(P,{sx:{mb:1}}),e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Invoice"}),e.jsx(s,{align:"right",children:"Amount"}),e.jsx(s,{children:"Tax"}),e.jsx(s,{children:"Jurisdiction"})]})}),e.jsx(C,{children:((i==null?void 0:i.recentPayments)||[]).map(t=>e.jsxs(l,{children:[e.jsx(s,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(s,{children:t.stripeInvoiceId}),e.jsx(s,{align:"right",children:(t.amount??0)/100}),e.jsxs(s,{children:[((t.taxAmount??0)/100).toFixed(2)," (",((t.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(s,{children:t.jurisdiction})]},t.id))})]})]}),e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Tax by Jurisdiction"}),e.jsx(P,{sx:{mb:1}}),e.jsx(K,{direction:"row",spacing:1,flexWrap:"wrap",children:(i==null?void 0:i.taxByJurisdiction)&&Object.entries(i.taxByJurisdiction).map(([t,n])=>e.jsx(ae,{label:`${t}: ${(n/100).toLocaleString()}`},t))})]})]}),j===1&&e.jsxs(y,{children:[e.jsxs(K,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(_,{label:"From (YYYY-MM-DD)",placeholder:"2025-01-01",value:B,onChange:t=>$(t.target.value),size:"small"}),e.jsx(_,{label:"To (YYYY-MM-DD)",placeholder:"2025-12-31",value:E,onChange:t=>G(t.target.value),size:"small"}),e.jsx(z,{variant:"contained",onClick:se,children:"Export CSV"}),e.jsx(z,{variant:"outlined",onClick:Y,children:"Refresh"})]}),e.jsx(re,{component:c,children:e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Invoice"}),e.jsx(s,{align:"right",children:"Amount"}),e.jsx(s,{children:"Currency"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Tax"}),e.jsx(s,{children:"Jurisdiction"}),e.jsx(s,{children:"User Email"}),e.jsx(s,{children:"Residency"})]})}),e.jsx(C,{children:U.map(t=>{var n,r,x;return e.jsxs(l,{children:[e.jsx(s,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(s,{children:t.stripeInvoiceId}),e.jsx(s,{align:"right",children:(t.amount??0)/100}),e.jsx(s,{children:t.currency}),e.jsx(s,{children:t.status}),e.jsxs(s,{children:[((t.taxAmount??0)/100).toFixed(2)," (",((t.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(s,{children:t.taxJurisdiction}),e.jsx(s,{children:(n=t.user)==null?void 0:n.email}),e.jsx(s,{children:(x=(r=t.user)==null?void 0:r.taxInformation)==null?void 0:x.taxResidency})]},t.id)})})]})})]}),j===2&&e.jsx(y,{children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Tax Summary"}),e.jsx(P,{sx:{mb:1}}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(a,{variant:"overline",children:"By Jurisdiction"}),e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Jurisdiction"}),e.jsx(s,{align:"right",children:"Tax"}),e.jsx(s,{align:"right",children:"Taxable"}),e.jsx(s,{align:"right",children:"Count"})]})}),e.jsx(C,{children:(o==null?void 0:o.byJurisdiction)&&Object.entries(o.byJurisdiction).map(([t,n])=>e.jsxs(l,{children:[e.jsx(s,{children:t}),e.jsx(s,{align:"right",children:((n.tax_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:((n.taxable_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:n.count})]},t))})]})]}),e.jsxs(h,{item:!0,xs:12,md:6,children:[e.jsx(a,{variant:"overline",children:"By Country"}),e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Country"}),e.jsx(s,{align:"right",children:"Tax"}),e.jsx(s,{align:"right",children:"Taxable"}),e.jsx(s,{align:"right",children:"Count"})]})}),e.jsx(C,{children:(o==null?void 0:o.byCountry)&&Object.entries(o.byCountry).map(([t,n])=>e.jsxs(l,{children:[e.jsx(s,{children:t}),e.jsx(s,{align:"right",children:((n.tax_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:((n.taxable_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:n.count})]},t))})]})]})]})]})}),j===3&&e.jsx(y,{children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"KYC Overview"}),e.jsx(P,{sx:{mb:1}}),e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Email"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Completed At"}),e.jsx(s,{children:"Name"}),e.jsx(s,{children:"Nationality"}),e.jsx(s,{children:"Residence"}),e.jsx(s,{children:"Company"})]})}),e.jsx(C,{children:V.map(t=>{var n,r,x,m,u;return e.jsxs(l,{children:[e.jsx(s,{children:t.email}),e.jsx(s,{children:t.kycStatus}),e.jsx(s,{children:t.kycCompletedAt?new Date(t.kycCompletedAt).toLocaleDateString():"-"}),e.jsxs(s,{children:[(n=t.complianceProfile)==null?void 0:n.firstName," ",(r=t.complianceProfile)==null?void 0:r.lastName]}),e.jsx(s,{children:(x=t.complianceProfile)==null?void 0:x.nationality}),e.jsx(s,{children:(m=t.complianceProfile)==null?void 0:m.countryOfResidence}),e.jsx(s,{children:(u=t.businessProfile)==null?void 0:u.companyName})]},t.id)})})]})]})}),j===4&&e.jsx(y,{children:e.jsxs(c,{sx:{p:2},children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Compliance Events"}),e.jsx(P,{sx:{mb:1}}),e.jsxs(p,{size:"small",children:[e.jsx(b,{children:e.jsxs(l,{children:[e.jsx(s,{children:"Type"}),e.jsx(s,{children:"Severity"}),e.jsx(s,{children:"Description"})]})}),e.jsx(C,{children:X.map(t=>e.jsxs(l,{children:[e.jsx(s,{children:t.eventType}),e.jsx(s,{children:t.severity}),e.jsx(s,{children:t.description})]},t.id))})]})]})})]})};export{oe as default};
