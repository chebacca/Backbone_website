import{j as e,a as _,T as h,t as q,b9 as ve,ba as R,c as f,G as u,S as E,u as b,d as y,aR as fe,aS as Se,aT as Ce,a4 as Z,D as I,aC as M,aD as k,aE as v,aF as n,aG as P,h as Te,aB as Le}from"./mui-pHPyF4nf.js";import{r as g}from"./vendor-DIxetjBo.js";import{c as D,e as J}from"./index-CSSTRyyl.js";import"./stripe-B5n5czio.js";const Oe=()=>{var H,V,K,Q;const[ee,te]=g.useState([]),[U,ne]=g.useState(""),[z,se]=g.useState(""),[w,ae]=g.useState(0),[m,ie]=g.useState(null),[x,B]=g.useState(null),[le,re]=g.useState([]),[ce,oe]=g.useState([]),[N,de]=g.useState(0),[A,C]=g.useState(""),[O,T]=g.useState(""),[$,xe]=g.useState("US_SALES_TAX"),[c,S]=g.useState({legalName:"",taxId:"",addressLine1:"",addressLine2:"",city:"",region:"",postalCode:"",country:"US",contactEmail:""});g.useEffect(()=>{try{const o=localStorage.getItem("filing_company_default");o&&S(JSON.parse(o))}catch{}const t=new Date,s=new Date(t.getFullYear(),t.getMonth()-1,1),l=new Date(t.getFullYear(),t.getMonth(),0),d=o=>`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`;C(d(s)),T(d(l))},[]);const Y=t=>{const s=new Date,l=a=>`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,d=(a,i)=>new Date(a,i,1),o=(a,i)=>new Date(a,i+1,0),j=(a,i)=>new Date(a,i*3,1),r=(a,i)=>new Date(a,i*3+3,0);if(t==="THIS_MONTH"){const a=d(s.getFullYear(),s.getMonth()),i=o(s.getFullYear(),s.getMonth());C(l(a)),T(l(i));return}if(t==="LAST_MONTH"){const a=d(s.getFullYear(),s.getMonth()-1),i=o(s.getFullYear(),s.getMonth()-1);C(l(a)),T(l(i));return}if(t==="THIS_QUARTER"){const a=Math.floor(s.getMonth()/3),i=j(s.getFullYear(),a),p=r(s.getFullYear(),a);C(l(i)),T(l(p));return}if(t==="LAST_QUARTER"){let a=Math.floor(s.getMonth()/3)-1,i=s.getFullYear();a<0&&(a=3,i-=1);const p=j(i,a),L=r(i,a);C(l(p)),T(l(L));return}if(t==="YTD"){const a=new Date(s.getFullYear(),0,1),i=s;C(l(a)),T(l(i));return}if(t==="LAST_YEAR"){const a=s.getFullYear()-1,i=new Date(a,0,1),p=new Date(a,11,31);C(l(i)),T(l(p));return}},he=()=>{try{localStorage.setItem("filing_company_default",JSON.stringify(c))}catch{}},ue=()=>{try{const t=localStorage.getItem("filing_company_default");t&&S(JSON.parse(t))}catch{}},W=async()=>{var s,l;const t=await D.get(J.accounting.payments(),{params:{limit:50}});te(((l=(s=t.data)==null?void 0:s.data)==null?void 0:l.payments)||[])};g.useEffect(()=>{(async()=>{var r,a,i,p,L,F,G,X;W();const[s,l,d,o]=await Promise.all([D.get("accounting/overview"),D.get("accounting/tax/summary"),D.get("accounting/kyc"),D.get("accounting/compliance-events")]);ie(((r=s.data)==null?void 0:r.data)||null),B(((a=l.data)==null?void 0:a.data)||null),re(((p=(i=d.data)==null?void 0:i.data)==null?void 0:p.users)||[]),oe(((F=(L=o.data)==null?void 0:L.data)==null?void 0:F.events)||[]);const j=(((X=(G=d.data)==null?void 0:G.data)==null?void 0:X.users)||[]).filter(be=>String(be.kycStatus||"").toUpperCase()!=="COMPLETED").length;de(j)})()},[]);const me=async()=>{var i,p;const t={from:U,to:z,includePII:!1},l=((p=(i=(await D.post(J.accounting.exportPayments(),t)).data)==null?void 0:i.data)==null?void 0:p.rows)||[],o=[Object.keys(l[0]||{}).join(","),...l.map(L=>Object.values(L).map(F=>JSON.stringify(F??"")).join(","))].join(`
`),j=new Blob([o],{type:"text/csv"}),r=URL.createObjectURL(j),a=document.createElement("a");a.href=r,a.download=`payments_${U||"all"}_${z||"all"}.csv`,a.click(),URL.revokeObjectURL(r)},je=async()=>{var i,p;const t={from:A,to:O,includePII:!1},l=((p=(i=(await D.post(J.accounting.exportPayments(),t)).data)==null?void 0:i.data)==null?void 0:p.rows)||[],o=[Object.keys(l[0]||{}).join(","),...l.map(L=>Object.values(L).map(F=>JSON.stringify(F??"")).join(","))].join(`
`),j=new Blob([o],{type:"text/csv"}),r=URL.createObjectURL(j),a=document.createElement("a");a.href=r,a.download=`payments_${A||"all"}_${O||"all"}.csv`,a.click(),URL.revokeObjectURL(r)},ge=async()=>{var s;const t=await D.get("accounting/tax/summary",{params:{from:A||void 0,to:O||void 0}});B(((s=t.data)==null?void 0:s.data)||null)},pe=()=>{if(!x)return;const t=[];if($==="US_SALES_TAX"){const r=(x==null?void 0:x.byJurisdiction)||{};for(const[a,i]of Object.entries(r))t.push({jurisdiction:a,tax_cents:i.tax_cents??0,taxable_cents:i.taxable_cents??0,count:i.count??0})}else{const r=(x==null?void 0:x.byCountry)||{};for(const[a,i]of Object.entries(r))t.push({country:a,tax_cents:i.tax_cents??0,taxable_cents:i.taxable_cents??0,count:i.count??0})}const l=[Object.keys(t[0]||{}).join(","),...t.map(r=>Object.values(r).map(a=>JSON.stringify(a??"")).join(","))].join(`
`),d=new Blob([l],{type:"text/csv"}),o=URL.createObjectURL(d),j=document.createElement("a");j.href=o,j.download=`filing_summary_${$}_${A||"all"}_${O||"all"}.csv`,j.click(),URL.revokeObjectURL(o)},ye=()=>{const t=window.open("","PRINT","height=800,width=800");if(!t)return;const s=`${A||"Start"} to ${O||"End"}`,l=$==="US_SALES_TAX"?(x==null?void 0:x.byJurisdiction)||{}:(x==null?void 0:x.byCountry)||{},d=Object.values(l).reduce((j,r)=>({tax:j.tax+((r==null?void 0:r.tax_cents)||0),taxable:j.taxable+((r==null?void 0:r.taxable_cents)||0),count:j.count+((r==null?void 0:r.count)||0)}),{tax:0,taxable:0,count:0}),o=`<!doctype html><html><head><meta charset="utf-8"><title>Filing Cover Sheet</title>
      <style>body{font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding:24px;} h1,h2{margin:0 0 8px;} table{border-collapse: collapse; width:100%; margin-top:16px;} th,td{border:1px solid #ccc; padding:8px; text-align:left;} small{color:#666}</style>
    </head><body>
      <h1>Tax Filing Cover Sheet</h1>
      <small>Generated by Accounting Dashboard</small>
      <h2>Company</h2>
      <div>${c.legalName||"-"}</div>
      <div>${c.addressLine1||""} ${c.addressLine2||""}</div>
      <div>${c.city||""} ${c.region||""} ${c.postalCode||""} ${c.country||""}</div>
      <div>Tax ID: ${c.taxId||"-"}</div>
      <div>Contact: ${c.contactEmail||"-"}</div>
      <h2>Filing</h2>
      <div>Scheme: ${$}</div>
      <div>Period: ${s}</div>
      <table>
        <tr><th>Total Taxable</th><th>Total Tax</th><th>Transactions</th></tr>
        <tr><td>${(d.taxable/100).toLocaleString()}</td><td>${(d.tax/100).toLocaleString()}</td><td>${d.count}</td></tr>
      </table>
      <p style="margin-top:16px">Attach the jurisdiction/member-state summary CSV and payments CSV for the filing period when submitting via your tax portal or provider.</p>
      <script>window.onload=function(){window.print(); setTimeout(()=>window.close(), 300);}<\/script>
    </body></html>`;t.document.write(o),t.document.close(),t.focus()};return e.jsxs(_,{sx:{p:3},children:[e.jsx(h,{variant:"h4",fontWeight:700,gutterBottom:!0,children:"Accounting & Compliance"}),e.jsx(h,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Financial reporting, tax, KYC/AML, and regulatory oversight snapshot."}),N>0&&e.jsxs(q,{severity:"warning",sx:{mb:2},children:[N," user",N===1?"":"s"," require KYC verification. Review the KYC tab for details."]}),e.jsxs(ve,{value:w,onChange:(t,s)=>ae(s),sx:{mb:2},children:[e.jsx(R,{label:"Overview"}),e.jsx(R,{label:"Payments"}),e.jsx(R,{label:"Tax"}),e.jsx(R,{label:"Filings"}),e.jsx(R,{label:"KYC"}),e.jsx(R,{label:"Compliance"})]}),w===3&&e.jsx(_,{children:e.jsxs(f,{sx:{p:2},children:[e.jsx(h,{variant:"subtitle1",gutterBottom:!0,children:"Filing Packet"}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(h,{variant:"overline",children:"Filing Period"}),e.jsxs(E,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(b,{label:"From (YYYY-MM-DD)",placeholder:"2025-01-01",value:A,onChange:t=>C(t.target.value),size:"small"}),e.jsx(b,{label:"To (YYYY-MM-DD)",placeholder:"2025-12-31",value:O,onChange:t=>T(t.target.value),size:"small"})]}),e.jsxs(E,{direction:{xs:"column",sm:"row"},spacing:1,sx:{mb:2},children:[e.jsx(y,{size:"small",variant:"outlined",onClick:()=>Y("THIS_MONTH"),children:"This Month"}),e.jsx(y,{size:"small",variant:"outlined",onClick:()=>Y("LAST_MONTH"),children:"Last Month"}),e.jsx(y,{size:"small",variant:"outlined",onClick:()=>Y("THIS_QUARTER"),children:"This Quarter"}),e.jsx(y,{size:"small",variant:"outlined",onClick:()=>Y("LAST_QUARTER"),children:"Last Quarter"}),e.jsx(y,{size:"small",variant:"outlined",onClick:()=>Y("YTD"),children:"YTD"}),e.jsx(y,{size:"small",variant:"outlined",onClick:()=>Y("LAST_YEAR"),children:"Last Year"})]}),e.jsxs(fe,{size:"small",sx:{minWidth:240},children:[e.jsx(Se,{id:"scheme-label",children:"Scheme"}),e.jsxs(Ce,{labelId:"scheme-label",id:"scheme",value:$,label:"Scheme",onChange:t=>xe(t.target.value),children:[e.jsx(Z,{value:"US_SALES_TAX",children:"US Sales Tax (state/county)"}),e.jsx(Z,{value:"EU_OSS",children:"EU OSS VAT (member state)"})]})]}),e.jsxs(E,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mt:2},children:[e.jsx(y,{variant:"outlined",onClick:ge,children:"Refresh Summary"}),e.jsx(y,{variant:"contained",onClick:pe,children:"Download Summary CSV"}),e.jsx(y,{variant:"outlined",onClick:je,children:"Download Payments CSV"})]})]}),e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(h,{variant:"overline",children:"Company Info (for cover sheet)"}),e.jsxs(u,{container:!0,spacing:1,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Legal Name",value:c.legalName,onChange:t=>S({...c,legalName:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Tax ID / VAT",value:c.taxId,onChange:t=>S({...c,taxId:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Contact Email",value:c.contactEmail,onChange:t=>S({...c,contactEmail:t.target.value})})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Address Line 1",value:c.addressLine1,onChange:t=>S({...c,addressLine1:t.target.value})})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Address Line 2",value:c.addressLine2,onChange:t=>S({...c,addressLine2:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:4,children:e.jsx(b,{fullWidth:!0,size:"small",label:"City",value:c.city,onChange:t=>S({...c,city:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:4,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Region/State",value:c.region,onChange:t=>S({...c,region:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:4,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Postal Code",value:c.postalCode,onChange:t=>S({...c,postalCode:t.target.value})})})]}),e.jsxs(E,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mt:2},children:[e.jsx(y,{variant:"outlined",onClick:ye,children:"Print Filing Cover Sheet"}),e.jsx(y,{variant:"text",onClick:he,children:"Save as Default"}),e.jsx(y,{variant:"text",onClick:ue,children:"Load Default"})]})]})]}),e.jsx(q,{severity:"info",sx:{mt:2},children:"This packet mirrors common filings used by SaaS: US Sales Tax returns (state/county totals) and EU OSS VAT returns (member-state totals). Attach the CSV summaries and payments export when filing via your tax portal or provider."})]})}),w===0&&e.jsxs(_,{children:[e.jsxs(u,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(f,{sx:{p:2},children:[e.jsx(h,{variant:"overline",children:"Revenue (USD)"}),e.jsx(h,{variant:"h5",children:((((H=m==null?void 0:m.totals)==null?void 0:H.revenue_cents)||0)/100).toLocaleString()})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(f,{sx:{p:2},children:[e.jsx(h,{variant:"overline",children:"Tax Collected"}),e.jsx(h,{variant:"h5",children:((((V=m==null?void 0:m.totals)==null?void 0:V.tax_cents)||0)/100).toLocaleString()})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(f,{sx:{p:2},children:[e.jsx(h,{variant:"overline",children:"Payments"}),e.jsx(h,{variant:"h5",children:((K=m==null?void 0:m.totals)==null?void 0:K.paymentsCount)||0})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(f,{sx:{p:2},children:[e.jsx(h,{variant:"overline",children:"KYC Completed"}),e.jsx(h,{variant:"h5",children:((Q=m==null?void 0:m.kycCounts)==null?void 0:Q.COMPLETED)||0})]})})]}),e.jsxs(f,{sx:{p:2,mb:2},children:[e.jsx(h,{variant:"subtitle1",gutterBottom:!0,children:"Recent Payments"}),e.jsx(I,{sx:{mb:1}}),e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(v,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Invoice"}),e.jsx(n,{align:"right",children:"Amount"}),e.jsx(n,{children:"Tax"}),e.jsx(n,{children:"Jurisdiction"})]})}),e.jsx(P,{children:((m==null?void 0:m.recentPayments)||[]).map(t=>e.jsxs(v,{children:[e.jsx(n,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(n,{children:t.stripeInvoiceId}),e.jsx(n,{align:"right",children:(t.amount??0)/100}),e.jsxs(n,{children:[((t.taxAmount??0)/100).toFixed(2)," (",((t.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(n,{children:t.jurisdiction})]},t.id))})]})]}),e.jsxs(f,{sx:{p:2},children:[e.jsx(h,{variant:"subtitle1",gutterBottom:!0,children:"Tax by Jurisdiction"}),e.jsx(I,{sx:{mb:1}}),e.jsx(E,{direction:"row",spacing:1,flexWrap:"wrap",children:(m==null?void 0:m.taxByJurisdiction)&&Object.entries(m.taxByJurisdiction).map(([t,s])=>e.jsx(Te,{label:`${t}: ${(s/100).toLocaleString()}`},t))})]})]}),w===1&&e.jsxs(_,{children:[e.jsxs(E,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(b,{label:"From (YYYY-MM-DD)",placeholder:"2025-01-01",value:U,onChange:t=>ne(t.target.value),size:"small"}),e.jsx(b,{label:"To (YYYY-MM-DD)",placeholder:"2025-12-31",value:z,onChange:t=>se(t.target.value),size:"small"}),e.jsx(y,{variant:"contained",onClick:me,children:"Export CSV"}),e.jsx(y,{variant:"outlined",onClick:W,children:"Refresh"})]}),e.jsx(Le,{component:f,children:e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(v,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Invoice"}),e.jsx(n,{align:"right",children:"Amount"}),e.jsx(n,{children:"Currency"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Tax"}),e.jsx(n,{children:"Jurisdiction"}),e.jsx(n,{children:"User Email"}),e.jsx(n,{children:"Residency"})]})}),e.jsx(P,{children:ee.map(t=>{var s,l,d;return e.jsxs(v,{children:[e.jsx(n,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(n,{children:t.stripeInvoiceId}),e.jsx(n,{align:"right",children:(t.amount??0)/100}),e.jsx(n,{children:t.currency}),e.jsx(n,{children:t.status}),e.jsxs(n,{children:[((t.taxAmount??0)/100).toFixed(2)," (",((t.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(n,{children:t.taxJurisdiction}),e.jsx(n,{children:(s=t.user)==null?void 0:s.email}),e.jsx(n,{children:(d=(l=t.user)==null?void 0:l.taxInformation)==null?void 0:d.taxResidency})]},t.id)})})]})})]}),w===2&&e.jsx(_,{children:e.jsxs(f,{sx:{p:2},children:[e.jsx(h,{variant:"subtitle1",gutterBottom:!0,children:"Tax Summary"}),e.jsx(I,{sx:{mb:1}}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(h,{variant:"overline",children:"By Jurisdiction"}),e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(v,{children:[e.jsx(n,{children:"Jurisdiction"}),e.jsx(n,{align:"right",children:"Tax"}),e.jsx(n,{align:"right",children:"Taxable"}),e.jsx(n,{align:"right",children:"Count"})]})}),e.jsx(P,{children:(x==null?void 0:x.byJurisdiction)&&Object.entries(x.byJurisdiction).map(([t,s])=>e.jsxs(v,{children:[e.jsx(n,{children:t}),e.jsx(n,{align:"right",children:((s.tax_cents||0)/100).toLocaleString()}),e.jsx(n,{align:"right",children:((s.taxable_cents||0)/100).toLocaleString()}),e.jsx(n,{align:"right",children:s.count})]},t))})]})]}),e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(h,{variant:"overline",children:"By Country"}),e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(v,{children:[e.jsx(n,{children:"Country"}),e.jsx(n,{align:"right",children:"Tax"}),e.jsx(n,{align:"right",children:"Taxable"}),e.jsx(n,{align:"right",children:"Count"})]})}),e.jsx(P,{children:(x==null?void 0:x.byCountry)&&Object.entries(x.byCountry).map(([t,s])=>e.jsxs(v,{children:[e.jsx(n,{children:t}),e.jsx(n,{align:"right",children:((s.tax_cents||0)/100).toLocaleString()}),e.jsx(n,{align:"right",children:((s.taxable_cents||0)/100).toLocaleString()}),e.jsx(n,{align:"right",children:s.count})]},t))})]})]})]})]})}),w===4&&e.jsx(_,{children:e.jsxs(f,{sx:{p:2},children:[e.jsx(h,{variant:"subtitle1",gutterBottom:!0,children:"KYC Overview"}),e.jsx(I,{sx:{mb:1}}),e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(v,{children:[e.jsx(n,{children:"Email"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Completed At"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Nationality"}),e.jsx(n,{children:"Residence"}),e.jsx(n,{children:"Company"})]})}),e.jsx(P,{children:le.map(t=>{var s,l,d,o,j;return e.jsxs(v,{children:[e.jsx(n,{children:t.email}),e.jsx(n,{children:t.kycStatus}),e.jsx(n,{children:t.kycCompletedAt?new Date(t.kycCompletedAt).toLocaleDateString():"-"}),e.jsxs(n,{children:[(s=t.complianceProfile)==null?void 0:s.firstName," ",(l=t.complianceProfile)==null?void 0:l.lastName]}),e.jsx(n,{children:(d=t.complianceProfile)==null?void 0:d.nationality}),e.jsx(n,{children:(o=t.complianceProfile)==null?void 0:o.countryOfResidence}),e.jsx(n,{children:(j=t.businessProfile)==null?void 0:j.companyName})]},t.id)})})]})]})}),w===5&&e.jsx(_,{children:e.jsxs(f,{sx:{p:2},children:[e.jsx(h,{variant:"subtitle1",gutterBottom:!0,children:"Compliance Events"}),e.jsx(I,{sx:{mb:1}}),e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(v,{children:[e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Severity"}),e.jsx(n,{children:"Description"})]})}),e.jsx(P,{children:ce.map(t=>e.jsxs(v,{children:[e.jsx(n,{children:t.eventType}),e.jsx(n,{children:t.severity}),e.jsx(n,{children:t.description})]},t.id))})]})]})})]})};export{Oe as default};
