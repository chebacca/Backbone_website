import{j as e,B as A,T as m,d as K,aU as Ze,aV as O,c as f,G as u,S as G,e as y,bC as et,bD as N,ar as tt,as as at,at as nt,M as ge,au as z,a as S,R as st,ah as ye,bE as it,bF as ot,bG as rt,D as E,bH as lt,bI as ct,bJ as dt,bK as ht,aC as M,aD as k,aE as b,aF as a,aG as P,aP as Q,g as X,az as be,r as xt,aB as mt,h as ut}from"./mui-L6QpU7G9.js";import{r as j,e as jt,u as pt}from"./vendor-CjD1bmmO.js";import{c as v,e as R}from"./index-DAWnePqa.js";import"./stripe-DjH5xBT-.js";const ft=()=>{var ne,se,ie,oe,re;const[ve,fe]=j.useState([]),F=jt(),q=pt(),[H,Se]=j.useState(""),[V,Te]=j.useState(""),[C,B]=j.useState(0),Z=j.useMemo(()=>({"#overview":0,"#payments":1,"#tax":2,"#filings":3,"#kyc":4,"#compliance":5,"#terms":6}),[]),Ce=j.useMemo(()=>({0:"overview",1:"payments",2:"tax",3:"filings",4:"kyc",5:"compliance",6:"terms"}),[]);j.useEffect(()=>{const t=(F.hash||"").toLowerCase();if(t&&Object.prototype.hasOwnProperty.call(Z,t)){const n=Z[t];n!==C&&B(n)}else t||(C!==0&&B(0),F.pathname.startsWith("/accounting")&&q("/accounting#overview",{replace:!0}))},[F.hash]);const we=(t,n)=>{B(n);const l=`#${Ce[n]}`;(F.hash||"").toLowerCase()!==l&&q(`/accounting${l}`,{replace:!0})},[p,Ae]=j.useState(null),[x,ee]=j.useState(null),[Le,Ie]=j.useState([]),[_e,$e]=j.useState([]),[De,Re]=j.useState([]),[J,Oe]=j.useState(0),[L,_]=j.useState(""),[I,$]=j.useState(""),[U,Ee]=j.useState("US_SALES_TAX"),[o,T]=j.useState({legalName:"",taxId:"",addressLine1:"",addressLine2:"",city:"",region:"",postalCode:"",country:"US",contactEmail:""}),[Me,ke]=j.useState([]),[W,Pe]=j.useState("NY"),[te,Ne]=j.useState("US"),[Ue,Ye]=j.useState(null),Y=[{code:"AL",name:"Alabama"},{code:"AK",name:"Alaska"},{code:"AZ",name:"Arizona"},{code:"AR",name:"Arkansas"},{code:"CA",name:"California",portal:"https://onlineservices.cdtfa.ca.gov"},{code:"CO",name:"Colorado"},{code:"CT",name:"Connecticut"},{code:"DE",name:"Delaware"},{code:"FL",name:"Florida",portal:"https://floridarevenue.com/taxes/Pages/return_drt.aspx"},{code:"GA",name:"Georgia"},{code:"HI",name:"Hawaii"},{code:"ID",name:"Idaho"},{code:"IL",name:"Illinois"},{code:"IN",name:"Indiana"},{code:"IA",name:"Iowa"},{code:"KS",name:"Kansas"},{code:"KY",name:"Kentucky"},{code:"LA",name:"Louisiana"},{code:"ME",name:"Maine"},{code:"MD",name:"Maryland"},{code:"MA",name:"Massachusetts"},{code:"MI",name:"Michigan"},{code:"MN",name:"Minnesota"},{code:"MS",name:"Mississippi"},{code:"MO",name:"Missouri"},{code:"MT",name:"Montana"},{code:"NE",name:"Nebraska"},{code:"NV",name:"Nevada"},{code:"NH",name:"New Hampshire"},{code:"NJ",name:"New Jersey"},{code:"NM",name:"New Mexico"},{code:"NY",name:"New York",portal:"https://www.tax.ny.gov/online/"},{code:"NC",name:"North Carolina"},{code:"ND",name:"North Dakota"},{code:"OH",name:"Ohio"},{code:"OK",name:"Oklahoma"},{code:"OR",name:"Oregon"},{code:"PA",name:"Pennsylvania"},{code:"RI",name:"Rhode Island"},{code:"SC",name:"South Carolina"},{code:"SD",name:"South Dakota"},{code:"TN",name:"Tennessee"},{code:"TX",name:"Texas",portal:"https://comptroller.texas.gov/taxes/file-pay/"},{code:"UT",name:"Utah"},{code:"VT",name:"Vermont"},{code:"VA",name:"Virginia"},{code:"WA",name:"Washington",portal:"https://secure.dor.wa.gov/"},{code:"WV",name:"West Virginia"},{code:"WI",name:"Wisconsin"},{code:"WY",name:"Wyoming"},{code:"DC",name:"District of Columbia"}];j.useEffect(()=>{try{const r=localStorage.getItem("filing_company_default");r&&T(JSON.parse(r))}catch{}const t=new Date,n=new Date(t.getFullYear(),t.getMonth()-1,1),s=new Date(t.getFullYear(),t.getMonth(),0),l=r=>`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`;_(l(n)),$(l(s))},[]);const Fe=t=>{const n=new Date,s=i=>`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`,l=(i,c)=>new Date(i,c,1),r=(i,c)=>new Date(i,c+1,0),h=(i,c)=>new Date(i,c*3,1),d=(i,c)=>new Date(i,c*3+3,0);if(t==="THIS_MONTH"){const i=l(n.getFullYear(),n.getMonth()),c=r(n.getFullYear(),n.getMonth());_(s(i)),$(s(c));return}if(t==="LAST_MONTH"){const i=l(n.getFullYear(),n.getMonth()-1),c=r(n.getFullYear(),n.getMonth()-1);_(s(i)),$(s(c));return}if(t==="THIS_QUARTER"){const i=Math.floor(n.getMonth()/3),c=h(n.getFullYear(),i),g=d(n.getFullYear(),i);_(s(c)),$(s(g));return}if(t==="LAST_QUARTER"){let i=Math.floor(n.getMonth()/3)-1,c=n.getFullYear();i<0&&(i=3,c-=1);const g=h(c,i),w=d(c,i);_(s(g)),$(s(w));return}if(t==="YTD"){const i=new Date(n.getFullYear(),0,1),c=n;_(s(i)),$(s(c));return}if(t==="LAST_YEAR"){const i=n.getFullYear()-1,c=new Date(i,0,1),g=new Date(i,11,31);_(s(c)),$(s(g));return}},We=async()=>{try{localStorage.setItem("filing_company_default",JSON.stringify(o))}catch{}try{await v.post(R.admin.companyFilingSave(),o)}catch{}},ze=()=>{try{const t=localStorage.getItem("filing_company_default");t&&T(JSON.parse(t))}catch{}},ae=async()=>{var n,s;const t=await v.get(R.accounting.payments(),{params:{limit:50}});fe(((s=(n=t.data)==null?void 0:n.data)==null?void 0:s.payments)||[])};j.useEffect(()=>{(async()=>{var i,c,g,w,D,le,ce,de,he,xe,me,ue;ae();const[n,s,l,r,h]=await Promise.all([v.get("accounting/overview"),v.get("accounting/tax/summary"),v.get("accounting/kyc"),v.get("accounting/compliance-events"),v.get(R.accounting.consentsLatest())]);Ae(((i=n.data)==null?void 0:i.data)||null),ee(((c=s.data)==null?void 0:c.data)||null),Ie(((w=(g=l.data)==null?void 0:g.data)==null?void 0:w.users)||[]),$e(((le=(D=r.data)==null?void 0:D.data)==null?void 0:le.events)||[]),Re(((de=(ce=h.data)==null?void 0:ce.data)==null?void 0:de.users)||[]);const d=(((xe=(he=l.data)==null?void 0:he.data)==null?void 0:xe.users)||[]).filter(je=>String(je.kycStatus||"").toUpperCase()!=="COMPLETED").length;Oe(d);try{const pe=(ue=(me=(await v.get(R.admin.companyFilingGet())).data)==null?void 0:me.data)==null?void 0:ue.company;pe&&T(qe=>({...qe,...pe}))}catch{}})()},[]);const He=async()=>{var c,g;const t={from:H,to:V,includePII:!1},s=((g=(c=(await v.post(R.accounting.exportPayments(),t)).data)==null?void 0:c.data)==null?void 0:g.rows)||[],r=[Object.keys(s[0]||{}).join(","),...s.map(w=>Object.values(w).map(D=>JSON.stringify(D??"")).join(","))].join(`
`),h=new Blob([r],{type:"text/csv"}),d=URL.createObjectURL(h),i=document.createElement("a");i.href=d,i.download=`payments_${H||"all"}_${V||"all"}.csv`,i.click(),URL.revokeObjectURL(d)},Ve=async()=>{var c,g;const t={from:L,to:I,includePII:!1},s=((g=(c=(await v.post(R.accounting.exportPayments(),t)).data)==null?void 0:c.data)==null?void 0:g.rows)||[],r=[Object.keys(s[0]||{}).join(","),...s.map(w=>Object.values(w).map(D=>JSON.stringify(D??"")).join(","))].join(`
`),h=new Blob([r],{type:"text/csv"}),d=URL.createObjectURL(h),i=document.createElement("a");i.href=d,i.download=`payments_${L||"all"}_${I||"all"}.csv`,i.click(),URL.revokeObjectURL(d)},Be=async()=>{var s,l,r;const t=await v.get("accounting/tax/summary",{params:{from:L||void 0,to:I||void 0}});ee(((s=t.data)==null?void 0:s.data)||null);const n=await v.get(R.accounting.payments(),{params:{from:L||void 0,to:I||void 0,limit:500}});ke(((r=(l=n.data)==null?void 0:l.data)==null?void 0:r.payments)||[])},Je=()=>{if(!x)return;const t=[];if(U==="US_SALES_TAX"){const d=(x==null?void 0:x.byJurisdiction)||{};for(const[i,c]of Object.entries(d))t.push({jurisdiction:i,tax_cents:c.tax_cents??0,taxable_cents:c.taxable_cents??0,count:c.count??0})}else{const d=(x==null?void 0:x.byCountry)||{};for(const[i,c]of Object.entries(d))t.push({country:i,tax_cents:c.tax_cents??0,taxable_cents:c.taxable_cents??0,count:c.count??0})}const s=[Object.keys(t[0]||{}).join(","),...t.map(d=>Object.values(d).map(i=>JSON.stringify(i??"")).join(","))].join(`
`),l=new Blob([s],{type:"text/csv"}),r=URL.createObjectURL(l),h=document.createElement("a");h.href=r,h.download=`filing_summary_${U}_${L||"all"}_${I||"all"}.csv`,h.click(),URL.revokeObjectURL(r)},Ke=()=>{const t=window.open("","PRINT","height=800,width=800");if(!t)return;const n=`${L||"Start"} to ${I||"End"}`,s=U==="US_SALES_TAX"?(x==null?void 0:x.byJurisdiction)||{}:(x==null?void 0:x.byCountry)||{},l=Object.values(s).reduce((h,d)=>({tax:h.tax+((d==null?void 0:d.tax_cents)||0),taxable:h.taxable+((d==null?void 0:d.taxable_cents)||0),count:h.count+((d==null?void 0:d.count)||0)}),{tax:0,taxable:0,count:0}),r=`<!doctype html><html><head><meta charset="utf-8"><title>Filing Cover Sheet</title>
      <style>body{font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding:24px;} h1,h2{margin:0 0 8px;} table{border-collapse: collapse; width:100%; margin-top:16px;} th,td{border:1px solid #ccc; padding:8px; text-align:left;} small{color:#666}</style>
    </head><body>
      <h1>Tax Filing Cover Sheet</h1>
      <small>Generated by Accounting Dashboard</small>
      <h2>Company</h2>
      <div>${o.legalName||"-"}</div>
      <div>${o.addressLine1||""} ${o.addressLine2||""}</div>
      <div>${o.city||""} ${o.region||""} ${o.postalCode||""} ${o.country||""}</div>
      <div>Tax ID: ${o.taxId||"-"}</div>
      <div>Contact: ${o.contactEmail||"-"}</div>
      <h2>Filing</h2>
      <div>Scheme: ${U}</div>
      <div>Period: ${n}</div>
      <table>
        <tr><th>Total Taxable</th><th>Total Tax</th><th>Transactions</th></tr>
        <tr><td>${(l.taxable/100).toLocaleString()}</td><td>${(l.tax/100).toLocaleString()}</td><td>${l.count}</td></tr>
      </table>
      <p style="margin-top:16px">Attach the jurisdiction/member-state summary CSV and payments CSV for the filing period when submitting via your tax portal or provider.</p>
      <script>window.onload=function(){window.print(); setTimeout(()=>window.close(), 300);}<\/script>
    </body></html>`;t.document.write(r),t.document.close(),t.focus()},Ge=()=>{var n;const t={};for(const s of Me){if(String(s.status).toUpperCase()!=="SUCCEEDED")continue;const l=((n=s.billingAddress)==null?void 0:n.state)||"UNKNOWN",r=s.taxAmount??0,h=(s.amount??0)-r;t[l]=t[l]||{taxable_cents:0,tax_cents:0,count:0},t[l].taxable_cents+=h,t[l].tax_cents+=r,t[l].count+=1}return t},Qe=t=>{const s=Ge()[t]||{taxable_cents:0,tax_cents:0,count:0},l=`${L||"Start"} to ${I||"End"}`,r=Y.find(i=>i.code===t),h=window.open("","PRINT","height=900,width=1000");if(!h)return;const d=`<!doctype html><html><head><meta charset="utf-8"><title>${t} Sales Tax Worksheet</title>
      <style>body{font-family:-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;padding:24px;} h1{margin:0 0 8px} table{border-collapse:collapse;width:100%;margin-top:16px;} th,td{border:1px solid #ccc;padding:8px;text-align:left;} small{color:#666}</style>
    </head><body>
      <h1>${(r==null?void 0:r.name)||t} Sales and Use Tax Return (Worksheet)</h1>
      <small>For reference only. Most states require e-filing via their tax portal.</small>
      <h2>Company</h2>
      <div>${o.legalName||"-"}</div>
      <div>${o.addressLine1||""} ${o.addressLine2||""}</div>
      <div>${o.city||""} ${o.region||""} ${o.postalCode||""} ${o.country||""}</div>
      <div>Tax ID: ${o.taxId||"-"}</div>
      <div>Contact: ${o.contactEmail||"-"}</div>
      <h2>Period: ${l}</h2>
      <table>
        <tr><th>Taxable sales (${t})</th><td>${(s.taxable_cents/100).toLocaleString()}</td></tr>
        <tr><th>Sales and use tax due (${t})</th><td>${(s.tax_cents/100).toLocaleString()}</td></tr>
        <tr><th>Transactions</th><td>${s.count}</td></tr>
      </table>
      ${r!=null&&r.portal?`<p style="margin-top:16px">Portal: <a href="${r.portal}" target="_blank" rel="noreferrer">${r.portal}</a></p>`:""}
      <script>window.onload=function(){window.print(); setTimeout(()=>window.close(), 300);}<\/script>
    </body></html>`;h.document.write(d),h.document.close(),h.focus()},Xe=t=>{const n=`${L||"Start"} to ${I||"End"}`,l=((x==null?void 0:x.byCountry)||{})[t]||{tax_cents:0,taxable_cents:0,count:0},r=window.open("","PRINT","height=900,width=1000");if(!r)return;const h=`<!doctype html><html><head><meta charset="utf-8"><title>${t} VAT/Sales Worksheet</title>
      <style>body{font-family:-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;padding:24px;} h1{margin:0 0 8px} table{border-collapse:collapse;width:100%;margin-top:16px;} th,td{border:1px solid #ccc;padding:8px;text-align:left;} small{color:#666}</style>
    </head><body>
      <h1>${t} Indirect Tax Worksheet</h1>
      <small>For reference only. File via your national portal (e.g., EU OSS, CRA GST/HST).</small>
      <h2>Company</h2>
      <div>${o.legalName||"-"}</div>
      <div>${o.addressLine1||""} ${o.addressLine2||""}</div>
      <div>${o.city||""} ${o.region||""} ${o.postalCode||""} ${o.country||""}</div>
      <div>Tax ID: ${o.taxId||"-"}</div>
      <div>Contact: ${o.contactEmail||"-"}</div>
      <h2>Period: ${n}</h2>
      <table>
        <tr><th>Taxable amount (${t})</th><td>${(l.taxable_cents/100).toLocaleString()}</td></tr>
        <tr><th>Tax due (${t})</th><td>${(l.tax_cents/100).toLocaleString()}</td></tr>
        <tr><th>Transactions</th><td>${l.count||0}</td></tr>
      </table>
      <script>window.onload=function(){window.print(); setTimeout(()=>window.close(), 300);}<\/script>
    </body></html>`;r.document.write(h),r.document.close(),r.focus()};return e.jsxs(A,{sx:{p:3},children:[e.jsx(m,{variant:"h4",fontWeight:700,gutterBottom:!0,children:"Accounting & Compliance"}),e.jsx(m,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Financial reporting, tax, KYC/AML, and regulatory oversight snapshot."}),J>0&&e.jsxs(K,{severity:"warning",sx:{mb:2},children:[J," user",J===1?"":"s"," require KYC verification. Review the KYC tab for details."]}),e.jsxs(Ze,{value:C,onChange:we,sx:{mb:2},children:[e.jsx(O,{label:"Overview"}),e.jsx(O,{label:"Payments"}),e.jsx(O,{label:"Tax"}),e.jsx(O,{label:"Filings"}),e.jsx(O,{label:"KYC"}),e.jsx(O,{label:"Compliance"}),e.jsx(O,{label:"Terms"})]}),C===3&&e.jsx(A,{children:e.jsxs(f,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Filing Packet"}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"Filing Period"}),e.jsxs(G,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(y,{label:"From (YYYY-MM-DD)",placeholder:"2025-01-01",value:L,onChange:t=>_(t.target.value),size:"small"}),e.jsx(y,{label:"To (YYYY-MM-DD)",placeholder:"2025-12-31",value:I,onChange:t=>$(t.target.value),size:"small"})]}),e.jsxs(et,{exclusive:!0,size:"small",value:Ue,onChange:(t,n)=>{if(Ye(n),!n)return;Fe({THIS_MONTH:"THIS_MONTH",LAST_MONTH:"LAST_MONTH",THIS_QUARTER:"THIS_QUARTER",LAST_QUARTER:"LAST_QUARTER",YTD:"YTD",LAST_YEAR:"LAST_YEAR"}[n])},sx:{mb:2,flexWrap:"wrap"},children:[e.jsx(N,{value:"THIS_MONTH",children:"This Month"}),e.jsx(N,{value:"LAST_MONTH",children:"Last Month"}),e.jsx(N,{value:"THIS_QUARTER",children:"This Quarter"}),e.jsx(N,{value:"LAST_QUARTER",children:"Last Quarter"}),e.jsx(N,{value:"YTD",children:"YTD"}),e.jsx(N,{value:"LAST_YEAR",children:"Last Year"})]}),e.jsxs(tt,{size:"small",sx:{minWidth:240},children:[e.jsx(at,{id:"scheme-label",children:"Scheme"}),e.jsxs(nt,{labelId:"scheme-label",id:"scheme",value:U,label:"Scheme",onChange:t=>Ee(t.target.value),children:[e.jsx(ge,{value:"US_SALES_TAX",children:"US Sales Tax (state/county)"}),e.jsx(ge,{value:"EU_OSS",children:"EU OSS VAT (member state)"})]})]}),e.jsxs(z,{variant:"contained",size:"small",sx:{mt:2,flexWrap:"wrap"},children:[e.jsx(S,{color:"inherit",startIcon:e.jsx(st,{}),onClick:Be,children:"Refresh"}),e.jsx(S,{color:"primary",startIcon:e.jsx(ye,{}),onClick:Je,children:"Summary CSV"}),e.jsx(S,{color:"secondary",startIcon:e.jsx(ye,{}),onClick:Ve,children:"Payments CSV"})]})]}),e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"Company Info (for cover sheet)"}),e.jsxs(u,{container:!0,spacing:1,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Legal Name",value:o.legalName,onChange:t=>T({...o,legalName:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Tax ID / VAT",value:o.taxId,onChange:t=>T({...o,taxId:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Contact Email",value:o.contactEmail,onChange:t=>T({...o,contactEmail:t.target.value})})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Address Line 1",value:o.addressLine1,onChange:t=>T({...o,addressLine1:t.target.value})})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Address Line 2",value:o.addressLine2,onChange:t=>T({...o,addressLine2:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:4,children:e.jsx(y,{fullWidth:!0,size:"small",label:"City",value:o.city,onChange:t=>T({...o,city:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:4,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Region/State",value:o.region,onChange:t=>T({...o,region:t.target.value})})}),e.jsx(u,{item:!0,xs:12,sm:4,children:e.jsx(y,{fullWidth:!0,size:"small",label:"Postal Code",value:o.postalCode,onChange:t=>T({...o,postalCode:t.target.value})})})]}),e.jsxs(z,{variant:"outlined",size:"small",sx:{mt:2,flexWrap:"wrap"},children:[e.jsx(S,{startIcon:e.jsx(it,{}),onClick:Ke,children:"Cover Sheet"}),e.jsx(S,{startIcon:e.jsx(ot,{}),onClick:We,children:"Save Defaults"}),e.jsx(S,{startIcon:e.jsx(rt,{}),onClick:ze,children:"Load Defaults"})]}),e.jsx(E,{sx:{my:2}}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"US State Worksheets"}),e.jsx(lt,{options:Y,getOptionLabel:t=>`${t.code} â€” ${t.name}`,value:Y.find(t=>t.code===W)||null,onChange:(t,n)=>Pe((n==null?void 0:n.code)||"NY"),renderInput:t=>e.jsx(y,{...t,label:"Select State",size:"small"}),sx:{maxWidth:400,mt:1}}),e.jsxs(z,{size:"small",sx:{mt:2,flexWrap:"wrap"},children:[e.jsx(S,{variant:"contained",startIcon:e.jsx(ct,{}),onClick:()=>Qe(W),children:"Print State Worksheet"}),((ne=Y.find(t=>t.code===W))==null?void 0:ne.portal)&&e.jsx(S,{variant:"outlined",startIcon:e.jsx(dt,{}),onClick:()=>window.open(Y.find(t=>t.code===W).portal,"_blank","noreferrer"),children:"Open Portal"})]})]}),e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"International (Country) Worksheets"}),e.jsx(y,{label:"Country Code (ISO alpha-2)",size:"small",value:te,onChange:t=>Ne(t.target.value.toUpperCase()),sx:{maxWidth:240,mt:1}}),e.jsx(z,{size:"small",sx:{mt:2,flexWrap:"wrap"},children:e.jsx(S,{variant:"contained",startIcon:e.jsx(ht,{}),onClick:()=>Xe(te),children:"Print Country Worksheet"})}),e.jsx(K,{severity:"info",sx:{mt:2},children:"For EU OSS, use scheme EU_OSS and the jurisdiction summary CSV; for Canada, file GST/HST per CRA portal."})]})]})]})]}),e.jsx(K,{severity:"info",sx:{mt:2},children:"This packet mirrors common filings used by SaaS: US Sales Tax returns (state/county totals) and EU OSS VAT returns (member-state totals). Attach the CSV summaries and payments export when filing via your tax portal or provider."})]})}),C===0&&e.jsxs(A,{children:[e.jsxs(u,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(f,{sx:{p:2},children:[e.jsx(m,{variant:"overline",children:"Revenue (USD)"}),e.jsx(m,{variant:"h5",children:((((se=p==null?void 0:p.totals)==null?void 0:se.revenue_cents)||0)/100).toLocaleString()})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(f,{sx:{p:2},children:[e.jsx(m,{variant:"overline",children:"Tax Collected"}),e.jsx(m,{variant:"h5",children:((((ie=p==null?void 0:p.totals)==null?void 0:ie.tax_cents)||0)/100).toLocaleString()})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(f,{sx:{p:2},children:[e.jsx(m,{variant:"overline",children:"Payments"}),e.jsx(m,{variant:"h5",children:((oe=p==null?void 0:p.totals)==null?void 0:oe.paymentsCount)||0})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(f,{sx:{p:2},children:[e.jsx(m,{variant:"overline",children:"KYC Completed"}),e.jsx(m,{variant:"h5",children:((re=p==null?void 0:p.kycCounts)==null?void 0:re.COMPLETED)||0})]})})]}),e.jsxs(f,{sx:{p:2,mb:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Recent Payments"}),e.jsx(E,{sx:{mb:1}}),e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Invoice"}),e.jsx(a,{align:"right",children:"Amount"}),e.jsx(a,{children:"Tax"}),e.jsx(a,{children:"Jurisdiction"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(P,{children:((p==null?void 0:p.recentPayments)||[]).map(t=>e.jsxs(b,{children:[e.jsx(a,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(a,{children:t.stripeInvoiceId}),e.jsx(a,{align:"right",children:(t.amount??0)/100}),e.jsxs(a,{children:[((t.taxAmount??0)/100).toFixed(2)," (",((t.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(a,{children:t.jurisdiction}),e.jsx(a,{children:e.jsx(A,{sx:{display:"flex",gap:1},children:t.stripeInvoiceId&&e.jsx(Q,{title:"View in Stripe Dashboard",children:e.jsx(X,{size:"small",color:"primary",onClick:()=>window.open(`https://dashboard.stripe.com/invoices/${t.stripeInvoiceId}`,"_blank"),children:e.jsx(be,{fontSize:"small"})})})})})]},t.id))})]})]}),e.jsxs(f,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Tax by Jurisdiction"}),e.jsx(E,{sx:{mb:1}}),e.jsx(G,{direction:"row",spacing:1,flexWrap:"wrap",children:(p==null?void 0:p.taxByJurisdiction)&&Object.entries(p.taxByJurisdiction).map(([t,n])=>e.jsx(xt,{label:`${t}: ${(n/100).toLocaleString()}`},t))})]})]}),C===1&&e.jsxs(A,{children:[e.jsxs(G,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(y,{label:"From (YYYY-MM-DD)",placeholder:"2025-01-01",value:H,onChange:t=>Se(t.target.value),size:"small"}),e.jsx(y,{label:"To (YYYY-MM-DD)",placeholder:"2025-12-31",value:V,onChange:t=>Te(t.target.value),size:"small"}),e.jsx(S,{variant:"contained",onClick:He,children:"Export CSV"}),e.jsx(S,{variant:"outlined",onClick:ae,children:"Refresh"})]}),e.jsx(mt,{component:f,children:e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Invoice"}),e.jsx(a,{align:"right",children:"Amount"}),e.jsx(a,{children:"Currency"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Tax"}),e.jsx(a,{children:"Jurisdiction"}),e.jsx(a,{children:"User Email"}),e.jsx(a,{children:"Residency"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(P,{children:ve.map(t=>{var n,s,l;return e.jsxs(b,{children:[e.jsx(a,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(a,{children:t.stripeInvoiceId}),e.jsx(a,{align:"right",children:(t.amount??0)/100}),e.jsx(a,{children:t.currency}),e.jsx(a,{children:t.status}),e.jsxs(a,{children:[((t.taxAmount??0)/100).toFixed(2)," (",((t.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(a,{children:t.taxJurisdiction}),e.jsx(a,{children:(n=t.user)==null?void 0:n.email}),e.jsx(a,{children:(l=(s=t.user)==null?void 0:s.taxInformation)==null?void 0:l.taxResidency}),e.jsx(a,{children:e.jsxs(A,{sx:{display:"flex",gap:1},children:[t.stripeInvoiceId&&e.jsx(Q,{title:"View in Stripe Dashboard",children:e.jsx(X,{size:"small",color:"primary",onClick:()=>window.open(`https://dashboard.stripe.com/invoices/${t.stripeInvoiceId}`,"_blank"),sx:{"&:hover":{transform:"translateY(-1px)",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"},children:e.jsx(be,{})})}),e.jsx(Q,{title:"View Payment Details",children:e.jsx(X,{size:"small",color:"info",onClick:()=>{alert(`Payment Details for ${t.id}`)},sx:{"&:hover":{transform:"translateY(-1px)",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"},children:e.jsx(ut,{})})})]})})]},t.id)})})]})})]}),C===2&&e.jsx(A,{children:e.jsxs(f,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Tax Summary"}),e.jsx(E,{sx:{mb:1}}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"By Jurisdiction"}),e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Jurisdiction"}),e.jsx(a,{align:"right",children:"Tax"}),e.jsx(a,{align:"right",children:"Taxable"}),e.jsx(a,{align:"right",children:"Count"})]})}),e.jsx(P,{children:(x==null?void 0:x.byJurisdiction)&&Object.entries(x.byJurisdiction).map(([t,n])=>e.jsxs(b,{children:[e.jsx(a,{children:t}),e.jsx(a,{align:"right",children:((n.tax_cents||0)/100).toLocaleString()}),e.jsx(a,{align:"right",children:((n.taxable_cents||0)/100).toLocaleString()}),e.jsx(a,{align:"right",children:n.count})]},t))})]})]}),e.jsxs(u,{item:!0,xs:12,md:6,children:[e.jsx(m,{variant:"overline",children:"By Country"}),e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Country"}),e.jsx(a,{align:"right",children:"Tax"}),e.jsx(a,{align:"right",children:"Taxable"}),e.jsx(a,{align:"right",children:"Count"})]})}),e.jsx(P,{children:(x==null?void 0:x.byCountry)&&Object.entries(x.byCountry).map(([t,n])=>e.jsxs(b,{children:[e.jsx(a,{children:t}),e.jsx(a,{align:"right",children:((n.tax_cents||0)/100).toLocaleString()}),e.jsx(a,{align:"right",children:((n.taxable_cents||0)/100).toLocaleString()}),e.jsx(a,{align:"right",children:n.count})]},t))})]})]})]})]})}),C===4&&e.jsx(A,{children:e.jsxs(f,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"KYC Overview"}),e.jsx(E,{sx:{mb:1}}),e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Email"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Completed At"}),e.jsx(a,{children:"Name"}),e.jsx(a,{children:"Nationality"}),e.jsx(a,{children:"Residence"}),e.jsx(a,{children:"Company"})]})}),e.jsx(P,{children:Le.map(t=>{var n,s,l,r,h;return e.jsxs(b,{children:[e.jsx(a,{children:t.email}),e.jsx(a,{children:t.kycStatus}),e.jsx(a,{children:t.kycCompletedAt?new Date(t.kycCompletedAt).toLocaleDateString():"-"}),e.jsxs(a,{children:[(n=t.complianceProfile)==null?void 0:n.firstName," ",(s=t.complianceProfile)==null?void 0:s.lastName]}),e.jsx(a,{children:(l=t.complianceProfile)==null?void 0:l.nationality}),e.jsx(a,{children:(r=t.complianceProfile)==null?void 0:r.countryOfResidence}),e.jsx(a,{children:(h=t.businessProfile)==null?void 0:h.companyName})]},t.id)})})]})]})}),C===5&&e.jsx(A,{children:e.jsxs(f,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Compliance Events"}),e.jsx(E,{sx:{mb:1}}),e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Type"}),e.jsx(a,{children:"Severity"}),e.jsx(a,{children:"Description"})]})}),e.jsx(P,{children:_e.map(t=>e.jsxs(b,{children:[e.jsx(a,{children:t.eventType}),e.jsx(a,{children:t.severity}),e.jsx(a,{children:t.description})]},t.id))})]})]})}),C===6&&e.jsx(A,{children:e.jsxs(f,{sx:{p:2},children:[e.jsx(m,{variant:"subtitle1",gutterBottom:!0,children:"Terms & Privacy Acceptance"}),e.jsx(E,{sx:{mb:1}}),e.jsxs(M,{size:"small",children:[e.jsx(k,{children:e.jsxs(b,{children:[e.jsx(a,{children:"Email"}),e.jsx(a,{children:"Terms Version"}),e.jsx(a,{children:"Terms Accepted At"}),e.jsx(a,{children:"Privacy Version"}),e.jsx(a,{children:"Privacy Accepted At"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(P,{children:De.map(t=>e.jsxs(b,{children:[e.jsx(a,{children:t.email}),e.jsx(a,{children:t.termsVersionAccepted||"-"}),e.jsx(a,{children:t.termsAcceptedAt?new Date(t.termsAcceptedAt).toLocaleString():"-"}),e.jsx(a,{children:t.privacyPolicyVersionAccepted||"-"}),e.jsx(a,{children:t.privacyPolicyAcceptedAt?new Date(t.privacyPolicyAcceptedAt).toLocaleString():"-"}),e.jsx(a,{children:e.jsx(S,{size:"small",onClick:async()=>{var c,g;const s=((g=(c=(await v.get(R.accounting.userConsentHistory(t.id),{params:{includePII:!1}})).data)==null?void 0:c.data)==null?void 0:g.consents)||[],r=[Object.keys(s[0]||{}).join(","),...s.map(w=>Object.values(w).map(D=>JSON.stringify(D??"")).join(","))].join(`
`),h=new Blob([r],{type:"text/csv"}),d=URL.createObjectURL(h),i=document.createElement("a");i.href=d,i.download=`consent_history_${t.email}.csv`,i.click(),URL.revokeObjectURL(d)},children:"Export History"})})]},t.id))})]})]})})]})};export{ft as default};
