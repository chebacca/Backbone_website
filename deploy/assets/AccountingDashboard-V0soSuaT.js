import{j as e,a as T,T as c,t as X,b9 as be,ba as O,c as y,G as o,S as U,u as b,aR as pe,aS as ye,aT as ve,a4 as H,d as R,D as $,aC as D,aD as E,aE as p,aF as s,aG as P,h as Ce,aB as Se}from"./mui-pHPyF4nf.js";import{r as m}from"./vendor-DIxetjBo.js";import{c as S,e as z}from"./index-DASWX0Ac.js";import"./stripe-B5n5czio.js";const _e=()=>{var N,M,W,V;const[q,Q]=m.useState([]),[k,Z]=m.useState(""),[I,ee]=m.useState(""),[f,te]=m.useState(0),[d,se]=m.useState(null),[l,B]=m.useState(null),[ne,ie]=m.useState([]),[ae,le]=m.useState([]),[Y,re]=m.useState(0),[L,ce]=m.useState(""),[w,oe]=m.useState(""),[F,de]=m.useState("US_SALES_TAX"),[i,v]=m.useState({legalName:"",taxId:"",addressLine1:"",addressLine2:"",city:"",region:"",postalCode:"",country:"US",contactEmail:""}),J=async()=>{var n,r;const t=await S.get(z.accounting.payments(),{params:{limit:50}});Q(((r=(n=t.data)==null?void 0:n.data)==null?void 0:r.payments)||[])};m.useEffect(()=>{(async()=>{var a,j,u,C,_,A,K,G;J();const[n,r,x,g]=await Promise.all([S.get("accounting/overview"),S.get("accounting/tax/summary"),S.get("accounting/kyc"),S.get("accounting/compliance-events")]);se(((a=n.data)==null?void 0:a.data)||null),B(((j=r.data)==null?void 0:j.data)||null),ie(((C=(u=x.data)==null?void 0:u.data)==null?void 0:C.users)||[]),le(((A=(_=g.data)==null?void 0:_.data)==null?void 0:A.events)||[]);const h=(((G=(K=x.data)==null?void 0:K.data)==null?void 0:G.users)||[]).filter(ge=>String(ge.kycStatus||"").toUpperCase()!=="COMPLETED").length;re(h)})()},[]);const xe=async()=>{var u,C;const t={from:k,to:I,includePII:!1},r=((C=(u=(await S.post(z.accounting.exportPayments(),t)).data)==null?void 0:u.data)==null?void 0:C.rows)||[],g=[Object.keys(r[0]||{}).join(","),...r.map(_=>Object.values(_).map(A=>JSON.stringify(A??"")).join(","))].join(`
`),h=new Blob([g],{type:"text/csv"}),a=URL.createObjectURL(h),j=document.createElement("a");j.href=a,j.download=`payments_${k||"all"}_${I||"all"}.csv`,j.click(),URL.revokeObjectURL(a)},he=async()=>{var u,C;const t={from:L,to:w,includePII:!1},r=((C=(u=(await S.post(z.accounting.exportPayments(),t)).data)==null?void 0:u.data)==null?void 0:C.rows)||[],g=[Object.keys(r[0]||{}).join(","),...r.map(_=>Object.values(_).map(A=>JSON.stringify(A??"")).join(","))].join(`
`),h=new Blob([g],{type:"text/csv"}),a=URL.createObjectURL(h),j=document.createElement("a");j.href=a,j.download=`payments_${L||"all"}_${w||"all"}.csv`,j.click(),URL.revokeObjectURL(a)},je=async()=>{var n;const t=await S.get("accounting/tax/summary",{params:{from:L||void 0,to:w||void 0}});B(((n=t.data)==null?void 0:n.data)||null)},ue=()=>{if(!l)return;const t=[];if(F==="US_SALES_TAX"){const a=(l==null?void 0:l.byJurisdiction)||{};for(const[j,u]of Object.entries(a))t.push({jurisdiction:j,tax_cents:u.tax_cents??0,taxable_cents:u.taxable_cents??0,count:u.count??0})}else{const a=(l==null?void 0:l.byCountry)||{};for(const[j,u]of Object.entries(a))t.push({country:j,tax_cents:u.tax_cents??0,taxable_cents:u.taxable_cents??0,count:u.count??0})}const r=[Object.keys(t[0]||{}).join(","),...t.map(a=>Object.values(a).map(j=>JSON.stringify(j??"")).join(","))].join(`
`),x=new Blob([r],{type:"text/csv"}),g=URL.createObjectURL(x),h=document.createElement("a");h.href=g,h.download=`filing_summary_${F}_${L||"all"}_${w||"all"}.csv`,h.click(),URL.revokeObjectURL(g)},me=()=>{const t=window.open("","PRINT","height=800,width=800");if(!t)return;const n=`${L||"Start"} to ${w||"End"}`,r=F==="US_SALES_TAX"?(l==null?void 0:l.byJurisdiction)||{}:(l==null?void 0:l.byCountry)||{},x=Object.values(r).reduce((h,a)=>({tax:h.tax+((a==null?void 0:a.tax_cents)||0),taxable:h.taxable+((a==null?void 0:a.taxable_cents)||0),count:h.count+((a==null?void 0:a.count)||0)}),{tax:0,taxable:0,count:0}),g=`<!doctype html><html><head><meta charset="utf-8"><title>Filing Cover Sheet</title>
      <style>body{font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding:24px;} h1,h2{margin:0 0 8px;} table{border-collapse: collapse; width:100%; margin-top:16px;} th,td{border:1px solid #ccc; padding:8px; text-align:left;} small{color:#666}</style>
    </head><body>
      <h1>Tax Filing Cover Sheet</h1>
      <small>Generated by Accounting Dashboard</small>
      <h2>Company</h2>
      <div>${i.legalName||"-"}</div>
      <div>${i.addressLine1||""} ${i.addressLine2||""}</div>
      <div>${i.city||""} ${i.region||""} ${i.postalCode||""} ${i.country||""}</div>
      <div>Tax ID: ${i.taxId||"-"}</div>
      <div>Contact: ${i.contactEmail||"-"}</div>
      <h2>Filing</h2>
      <div>Scheme: ${F}</div>
      <div>Period: ${n}</div>
      <table>
        <tr><th>Total Taxable</th><th>Total Tax</th><th>Transactions</th></tr>
        <tr><td>${(x.taxable/100).toLocaleString()}</td><td>${(x.tax/100).toLocaleString()}</td><td>${x.count}</td></tr>
      </table>
      <p style="margin-top:16px">Attach the jurisdiction/member-state summary CSV and payments CSV for the filing period when submitting via your tax portal or provider.</p>
      <script>window.onload=function(){window.print(); setTimeout(()=>window.close(), 300);}<\/script>
    </body></html>`;t.document.write(g),t.document.close(),t.focus()};return e.jsxs(T,{sx:{p:3},children:[e.jsx(c,{variant:"h4",fontWeight:700,gutterBottom:!0,children:"Accounting & Compliance"}),e.jsx(c,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Financial reporting, tax, KYC/AML, and regulatory oversight snapshot."}),Y>0&&e.jsxs(X,{severity:"warning",sx:{mb:2},children:[Y," user",Y===1?"":"s"," require KYC verification. Review the KYC tab for details."]}),e.jsxs(be,{value:f,onChange:(t,n)=>te(n),sx:{mb:2},children:[e.jsx(O,{label:"Overview"}),e.jsx(O,{label:"Payments"}),e.jsx(O,{label:"Tax"}),e.jsx(O,{label:"Filings"}),e.jsx(O,{label:"KYC"}),e.jsx(O,{label:"Compliance"})]}),f===3&&e.jsx(T,{children:e.jsxs(y,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"Filing Packet"}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(c,{variant:"overline",children:"Filing Period"}),e.jsxs(U,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(b,{label:"From (YYYY-MM-DD)",placeholder:"2025-01-01",value:L,onChange:t=>ce(t.target.value),size:"small"}),e.jsx(b,{label:"To (YYYY-MM-DD)",placeholder:"2025-12-31",value:w,onChange:t=>oe(t.target.value),size:"small"})]}),e.jsxs(pe,{size:"small",sx:{minWidth:240},children:[e.jsx(ye,{id:"scheme-label",children:"Scheme"}),e.jsxs(ve,{labelId:"scheme-label",id:"scheme",value:F,label:"Scheme",onChange:t=>de(t.target.value),children:[e.jsx(H,{value:"US_SALES_TAX",children:"US Sales Tax (state/county)"}),e.jsx(H,{value:"EU_OSS",children:"EU OSS VAT (member state)"})]})]}),e.jsxs(U,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mt:2},children:[e.jsx(R,{variant:"outlined",onClick:je,children:"Refresh Summary"}),e.jsx(R,{variant:"contained",onClick:ue,children:"Download Summary CSV"}),e.jsx(R,{variant:"outlined",onClick:he,children:"Download Payments CSV"})]})]}),e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(c,{variant:"overline",children:"Company Info (for cover sheet)"}),e.jsxs(o,{container:!0,spacing:1,children:[e.jsx(o,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Legal Name",value:i.legalName,onChange:t=>v({...i,legalName:t.target.value})})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Tax ID / VAT",value:i.taxId,onChange:t=>v({...i,taxId:t.target.value})})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Contact Email",value:i.contactEmail,onChange:t=>v({...i,contactEmail:t.target.value})})}),e.jsx(o,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Address Line 1",value:i.addressLine1,onChange:t=>v({...i,addressLine1:t.target.value})})}),e.jsx(o,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Address Line 2",value:i.addressLine2,onChange:t=>v({...i,addressLine2:t.target.value})})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsx(b,{fullWidth:!0,size:"small",label:"City",value:i.city,onChange:t=>v({...i,city:t.target.value})})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Region/State",value:i.region,onChange:t=>v({...i,region:t.target.value})})}),e.jsx(o,{item:!0,xs:12,sm:4,children:e.jsx(b,{fullWidth:!0,size:"small",label:"Postal Code",value:i.postalCode,onChange:t=>v({...i,postalCode:t.target.value})})})]}),e.jsx(U,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mt:2},children:e.jsx(R,{variant:"outlined",onClick:me,children:"Print Filing Cover Sheet"})})]})]}),e.jsx(X,{severity:"info",sx:{mt:2},children:"This packet mirrors common filings used by SaaS: US Sales Tax returns (state/county totals) and EU OSS VAT returns (member-state totals). Attach the CSV summaries and payments export when filing via your tax portal or provider."})]})}),f===0&&e.jsxs(T,{children:[e.jsxs(o,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(o,{item:!0,xs:12,md:3,children:e.jsxs(y,{sx:{p:2},children:[e.jsx(c,{variant:"overline",children:"Revenue (USD)"}),e.jsx(c,{variant:"h5",children:((((N=d==null?void 0:d.totals)==null?void 0:N.revenue_cents)||0)/100).toLocaleString()})]})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsxs(y,{sx:{p:2},children:[e.jsx(c,{variant:"overline",children:"Tax Collected"}),e.jsx(c,{variant:"h5",children:((((M=d==null?void 0:d.totals)==null?void 0:M.tax_cents)||0)/100).toLocaleString()})]})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsxs(y,{sx:{p:2},children:[e.jsx(c,{variant:"overline",children:"Payments"}),e.jsx(c,{variant:"h5",children:((W=d==null?void 0:d.totals)==null?void 0:W.paymentsCount)||0})]})}),e.jsx(o,{item:!0,xs:12,md:3,children:e.jsxs(y,{sx:{p:2},children:[e.jsx(c,{variant:"overline",children:"KYC Completed"}),e.jsx(c,{variant:"h5",children:((V=d==null?void 0:d.kycCounts)==null?void 0:V.COMPLETED)||0})]})})]}),e.jsxs(y,{sx:{p:2,mb:2},children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"Recent Payments"}),e.jsx($,{sx:{mb:1}}),e.jsxs(D,{size:"small",children:[e.jsx(E,{children:e.jsxs(p,{children:[e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Invoice"}),e.jsx(s,{align:"right",children:"Amount"}),e.jsx(s,{children:"Tax"}),e.jsx(s,{children:"Jurisdiction"})]})}),e.jsx(P,{children:((d==null?void 0:d.recentPayments)||[]).map(t=>e.jsxs(p,{children:[e.jsx(s,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(s,{children:t.stripeInvoiceId}),e.jsx(s,{align:"right",children:(t.amount??0)/100}),e.jsxs(s,{children:[((t.taxAmount??0)/100).toFixed(2)," (",((t.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(s,{children:t.jurisdiction})]},t.id))})]})]}),e.jsxs(y,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"Tax by Jurisdiction"}),e.jsx($,{sx:{mb:1}}),e.jsx(U,{direction:"row",spacing:1,flexWrap:"wrap",children:(d==null?void 0:d.taxByJurisdiction)&&Object.entries(d.taxByJurisdiction).map(([t,n])=>e.jsx(Ce,{label:`${t}: ${(n/100).toLocaleString()}`},t))})]})]}),f===1&&e.jsxs(T,{children:[e.jsxs(U,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(b,{label:"From (YYYY-MM-DD)",placeholder:"2025-01-01",value:k,onChange:t=>Z(t.target.value),size:"small"}),e.jsx(b,{label:"To (YYYY-MM-DD)",placeholder:"2025-12-31",value:I,onChange:t=>ee(t.target.value),size:"small"}),e.jsx(R,{variant:"contained",onClick:xe,children:"Export CSV"}),e.jsx(R,{variant:"outlined",onClick:J,children:"Refresh"})]}),e.jsx(Se,{component:y,children:e.jsxs(D,{size:"small",children:[e.jsx(E,{children:e.jsxs(p,{children:[e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Invoice"}),e.jsx(s,{align:"right",children:"Amount"}),e.jsx(s,{children:"Currency"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Tax"}),e.jsx(s,{children:"Jurisdiction"}),e.jsx(s,{children:"User Email"}),e.jsx(s,{children:"Residency"})]})}),e.jsx(P,{children:q.map(t=>{var n,r,x;return e.jsxs(p,{children:[e.jsx(s,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(s,{children:t.stripeInvoiceId}),e.jsx(s,{align:"right",children:(t.amount??0)/100}),e.jsx(s,{children:t.currency}),e.jsx(s,{children:t.status}),e.jsxs(s,{children:[((t.taxAmount??0)/100).toFixed(2)," (",((t.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(s,{children:t.taxJurisdiction}),e.jsx(s,{children:(n=t.user)==null?void 0:n.email}),e.jsx(s,{children:(x=(r=t.user)==null?void 0:r.taxInformation)==null?void 0:x.taxResidency})]},t.id)})})]})})]}),f===2&&e.jsx(T,{children:e.jsxs(y,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"Tax Summary"}),e.jsx($,{sx:{mb:1}}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(c,{variant:"overline",children:"By Jurisdiction"}),e.jsxs(D,{size:"small",children:[e.jsx(E,{children:e.jsxs(p,{children:[e.jsx(s,{children:"Jurisdiction"}),e.jsx(s,{align:"right",children:"Tax"}),e.jsx(s,{align:"right",children:"Taxable"}),e.jsx(s,{align:"right",children:"Count"})]})}),e.jsx(P,{children:(l==null?void 0:l.byJurisdiction)&&Object.entries(l.byJurisdiction).map(([t,n])=>e.jsxs(p,{children:[e.jsx(s,{children:t}),e.jsx(s,{align:"right",children:((n.tax_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:((n.taxable_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:n.count})]},t))})]})]}),e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(c,{variant:"overline",children:"By Country"}),e.jsxs(D,{size:"small",children:[e.jsx(E,{children:e.jsxs(p,{children:[e.jsx(s,{children:"Country"}),e.jsx(s,{align:"right",children:"Tax"}),e.jsx(s,{align:"right",children:"Taxable"}),e.jsx(s,{align:"right",children:"Count"})]})}),e.jsx(P,{children:(l==null?void 0:l.byCountry)&&Object.entries(l.byCountry).map(([t,n])=>e.jsxs(p,{children:[e.jsx(s,{children:t}),e.jsx(s,{align:"right",children:((n.tax_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:((n.taxable_cents||0)/100).toLocaleString()}),e.jsx(s,{align:"right",children:n.count})]},t))})]})]})]})]})}),f===4&&e.jsx(T,{children:e.jsxs(y,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"KYC Overview"}),e.jsx($,{sx:{mb:1}}),e.jsxs(D,{size:"small",children:[e.jsx(E,{children:e.jsxs(p,{children:[e.jsx(s,{children:"Email"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Completed At"}),e.jsx(s,{children:"Name"}),e.jsx(s,{children:"Nationality"}),e.jsx(s,{children:"Residence"}),e.jsx(s,{children:"Company"})]})}),e.jsx(P,{children:ne.map(t=>{var n,r,x,g,h;return e.jsxs(p,{children:[e.jsx(s,{children:t.email}),e.jsx(s,{children:t.kycStatus}),e.jsx(s,{children:t.kycCompletedAt?new Date(t.kycCompletedAt).toLocaleDateString():"-"}),e.jsxs(s,{children:[(n=t.complianceProfile)==null?void 0:n.firstName," ",(r=t.complianceProfile)==null?void 0:r.lastName]}),e.jsx(s,{children:(x=t.complianceProfile)==null?void 0:x.nationality}),e.jsx(s,{children:(g=t.complianceProfile)==null?void 0:g.countryOfResidence}),e.jsx(s,{children:(h=t.businessProfile)==null?void 0:h.companyName})]},t.id)})})]})]})}),f===5&&e.jsx(T,{children:e.jsxs(y,{sx:{p:2},children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,children:"Compliance Events"}),e.jsx($,{sx:{mb:1}}),e.jsxs(D,{size:"small",children:[e.jsx(E,{children:e.jsxs(p,{children:[e.jsx(s,{children:"Type"}),e.jsx(s,{children:"Severity"}),e.jsx(s,{children:"Description"})]})}),e.jsx(P,{children:ae.map(t=>e.jsxs(p,{children:[e.jsx(s,{children:t.eventType}),e.jsx(s,{children:t.severity}),e.jsx(s,{children:t.description})]},t.id))})]})]})})]})};export{_e as default};
