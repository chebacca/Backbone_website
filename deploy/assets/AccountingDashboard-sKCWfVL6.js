import{j as e,a as B,T as j,S as E,u,d as y,aB as k,c as A,aC as F,aD as I,aE as p,aF as a,aG as P}from"./mui-pHPyF4nf.js";import{r}from"./vendor-DIxetjBo.js";import{c as g,e as b}from"./index-BAzszt6O.js";import"./stripe-B5n5czio.js";const z=()=>{const[v,f]=r.useState([]),[o,T]=r.useState(""),[c,w]=r.useState(""),d=async()=>{var n,s;const t=await g.get(b.accounting.payments(),{params:{limit:50}});f(((s=(n=t.data)==null?void 0:n.data)==null?void 0:s.payments)||[])};r.useEffect(()=>{d()},[]);const R=async()=>{var h,m;const t={from:o,to:c,includePII:!1},s=((m=(h=(await g.post(b.accounting.exportPayments(),t)).data)==null?void 0:h.data)==null?void 0:m.rows)||[],C=[Object.keys(s[0]||{}).join(","),...s.map(S=>Object.values(S).map(Y=>JSON.stringify(Y??"")).join(","))].join(`
`),D=new Blob([C],{type:"text/csv"}),x=URL.createObjectURL(D),l=document.createElement("a");l.href=x,l.download=`payments_${o||"all"}_${c||"all"}.csv`,l.click(),URL.revokeObjectURL(x)};return e.jsxs(B,{sx:{p:3},children:[e.jsx(j,{variant:"h4",fontWeight:700,gutterBottom:!0,children:"Accounting Dashboard"}),e.jsx(j,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Restricted to Accounting role. Shows payments with tax and KYC context only."}),e.jsxs(E,{direction:{xs:"column",sm:"row"},spacing:2,sx:{mb:2},children:[e.jsx(u,{label:"From (YYYY-MM-DD)",placeholder:"2025-01-01",value:o,onChange:t=>T(t.target.value),size:"small"}),e.jsx(u,{label:"To (YYYY-MM-DD)",placeholder:"2025-12-31",value:c,onChange:t=>w(t.target.value),size:"small"}),e.jsx(y,{variant:"contained",onClick:R,children:"Export CSV"}),e.jsx(y,{variant:"outlined",onClick:d,children:"Refresh"})]}),e.jsx(k,{component:A,children:e.jsxs(F,{size:"small",children:[e.jsx(I,{children:e.jsxs(p,{children:[e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Invoice"}),e.jsx(a,{align:"right",children:"Amount"}),e.jsx(a,{children:"Currency"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Tax"}),e.jsx(a,{children:"Jurisdiction"}),e.jsx(a,{children:"User Email"}),e.jsx(a,{children:"Residency"})]})}),e.jsx(P,{children:v.map(t=>{var n,s,i;return e.jsxs(p,{children:[e.jsx(a,{children:new Date(t.createdAt).toLocaleDateString()}),e.jsx(a,{children:t.stripeInvoiceId}),e.jsx(a,{align:"right",children:(t.amount??0)/100}),e.jsx(a,{children:t.currency}),e.jsx(a,{children:t.status}),e.jsxs(a,{children:[((t.taxAmount??0)/100).toFixed(2)," (",((t.taxRate??0)*100).toFixed(2),"%)"]}),e.jsx(a,{children:t.taxJurisdiction}),e.jsx(a,{children:(n=t.user)==null?void 0:n.email}),e.jsx(a,{children:(i=(s=t.user)==null?void 0:s.taxInformation)==null?void 0:i.taxResidency})]},t.id)})})]})})]})};export{z as default};
