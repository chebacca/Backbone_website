import{j as e,a as i,b as Ms,an as Os,T as o,h as m,G as u,k as _,l as K,av as Bs,bT as Vs,aa as Ys,aR as Me,c as M,ba as Gs,bb as de,u as g,v as G,I as k,bV as Oe,aA as Be,d as f,a4 as c,aC as xe,aD as he,aE as ue,aF as A,aG as a,aH as me,aL as xs,b2 as _s,F as Ks,a1 as Hs,bW as Xs,y as qs,as as Qs,aN as je,aO as pe,aP as ge,aS as hs,aT as us,aU as ms,aQ as fe,O as Js,n as Zs,t as et}from"./mui-BGhK1avx.js";import{u as st,h as tt,r as d}from"./vendor-OeuszDaU.js";import{u as at}from"./notistack.esm-CcFOI6Un.js";import{u as nt,c as S,e as C}from"./index-Dhg3bDfa.js";import"./stripe-B34TymDN.js";const be=({title:O,data:n})=>{const ve=(n==null?void 0:n.status)==="healthy"?"success":(n==null?void 0:n.status)==="degraded"?"warning":(n==null?void 0:n.status)==="unhealthy"?"error":"default";return e.jsx(_,{variant:"outlined",children:e.jsxs(K,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(o,{variant:"subtitle1",children:O}),e.jsx(m,{size:"small",label:((n==null?void 0:n.status)||"unknown").toUpperCase(),color:ve})]}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Response time: ",(n==null?void 0:n.responseTimeMs)!=null?`${n.responseTimeMs} ms`:"â€”"]})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(o,{variant:"body2",color:"text.secondary",children:(n==null?void 0:n.message)||""})}),(n==null?void 0:n.error)&&e.jsx(u,{item:!0,xs:12,children:e.jsx(et,{severity:"warning",children:n.error})})]})]})})},xt=()=>{var as,ns;const{enqueueSnackbar:O}=at(),{user:n}=nt(),ve=st(),ye=tt(),[w,Ve]=d.useState(0),[N,H]=d.useState({totalUsers:0,activeSubscriptions:0,totalRevenue:0,pendingApprovals:0,systemHealth:"healthy"}),[B,Se]=d.useState([]),[Ce,X]=d.useState([]),[D,ee]=d.useState({}),[T,Ie]=d.useState({}),[rt,Ye]=d.useState([]),[se,js]=d.useState([]),[q,we]=d.useState(1),[De,ps]=d.useState(1),[y,te]=d.useState({}),[gs,Ae]=d.useState(!1),[E,fs]=d.useState({}),[V,Ge]=d.useState(null),[bs,ae]=d.useState(!1),[vs,Ee]=d.useState(!1),[ys,ne]=d.useState(!1),[z,re]=d.useState({userId:"",subscriptionId:"",tier:"PRO",seats:1}),[_e,Ke]=d.useState([]),[x,ie]=d.useState(null),[He,Xe]=d.useState(!1),[Y,qe]=d.useState(""),[U,Qe]=d.useState(""),[W,Je]=d.useState(""),[Ze,Ss]=d.useState(new Set),[Le,Cs]=d.useState(!1),Ue=d.useMemo(()=>{const s=Y.trim().toLowerCase();return B.filter(t=>s?t.firstName.toLowerCase().includes(s)||t.lastName.toLowerCase().includes(s)||t.email.toLowerCase().includes(s)||t.role.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||t.subscription&&t.subscription.toLowerCase().includes(s):!0).filter(t=>D.role?t.role===D.role:!0).filter(t=>D.status?t.status===D.status.toLowerCase():!0).filter(t=>D.tier?(t.subscription||"").toUpperCase()===D.tier:!0)},[B,Y,D]),Pe=d.useMemo(()=>{if(!U.trim())return Ce;const s=U.toLowerCase();return Ce.filter(t=>t.key.toLowerCase().includes(s)||t.userEmail.toLowerCase().includes(s)||t.tier.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||new Date(t.expiresAt).toLocaleDateString().includes(s)||new Date(t.activatedAt).toLocaleDateString().includes(s))},[Ce,U]),Re=d.useMemo(()=>{const s=new Map;Pe.forEach(l=>{const r=s.get(l.userId)||[];r.push(l),s.set(l.userId,r)});const t=B.map(l=>{const r=s.get(l.id)||[],j=r.filter(b=>b.status==="active").length;return{userId:l.id,userEmail:l.email,licenses:r,totalLicenses:r.length,activeLicenses:j}});return(Le?t:t.filter(l=>l.totalLicenses>0)).sort((l,r)=>l.userEmail.localeCompare(r.userEmail))},[B,Pe,Le]),Q=s=>{if(!s)return new Date(NaN);if(typeof s=="string")return new Date(s);if(s instanceof Date)return s;if(typeof s=="object"&&s!==null){if(typeof s._seconds=="number")return new Date(s._seconds*1e3);if(typeof s.seconds=="number")return new Date(s.seconds*1e3);if(typeof s.toDate=="function")try{return s.toDate()}catch{}}return new Date(s)},es=s=>`$${((typeof s=="number"?s:0)/100).toFixed(2)}`,ke=d.useMemo(()=>{if(!W.trim())return se;const s=W.toLowerCase();return se.filter(t=>{var h,l;return t.id.toLowerCase().includes(s)||((h=t.user)==null?void 0:h.email)&&t.user.email.toLowerCase().includes(s)||((l=t.subscription)==null?void 0:l.tier)&&t.subscription.tier.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||Q(t.createdAt).toLocaleDateString().toLowerCase().includes(s)||es(t.amount).toLowerCase().includes(s)})},[se,W]),Is=()=>qe(""),ss=()=>Qe(""),ws=()=>Je(""),Ds=s=>{Ss(t=>{const h=new Set(t);return h.has(s)?h.delete(s):h.add(s),h})};d.useEffect(()=>{let s=!0;return(async()=>{var t,h,l,r,j,b,P,R,J;try{if(String((n==null?void 0:n.role)||"").toUpperCase()!=="SUPERADMIN"){Se([]),X([]),H(I=>({...I,systemHealth:"warning"}));return}const[v,$,le,$e,Z]=await Promise.all([S.get(`${C.admin.users()}?page=1&limit=100`),S.get(`${C.admin.licenses()}?page=1&limit=100`),S.get(C.admin.paymentAnalytics()),S.get(C.admin.systemHealth()),S.get(C.admin.dashboardStats())]),ce=((h=(t=v.data)==null?void 0:t.data)==null?void 0:h.users)??[],Fe=((r=(l=$.data)==null?void 0:l.data)==null?void 0:r.licenses)??[],L=((b=(j=Z.data)==null?void 0:j.data)==null?void 0:b.stats)??{totalRevenue:0,activeSubscriptions:0},Fs=(L==null?void 0:L.recentPayments)??[],F=((R=(P=$e.data)==null?void 0:P.data)==null?void 0:R.health)||((J=$e.data)==null?void 0:J.data),rs=(F==null?void 0:F.overall)||(F==null?void 0:F.status)||"healthy";if(!s)return;Se(ce.map(I=>{var is,ls,oe,cs,os,ds;return{id:I.id,email:I.email,firstName:((is=I.name)==null?void 0:is.split(" ")[0])??"",lastName:((ls=I.name)==null?void 0:ls.split(" ").slice(1).join(" "))??"",role:I.role,status:((cs=(oe=I.status)==null?void 0:oe.toLowerCase)==null?void 0:cs.call(oe))||"active",subscription:((ds=(os=I.subscriptions)==null?void 0:os[0])==null?void 0:ds.tier)??void 0,lastLogin:I.lastLoginAt||new Date().toISOString(),createdAt:I.createdAt||new Date().toISOString()}})),X([]),H({totalUsers:Number(L.totalUsers||ce.length)||0,activeSubscriptions:L.activeSubscriptions??0,totalRevenue:Math.round(L.totalRevenue??0)/100,pendingApprovals:0,systemHealth:rs==="healthy"?"healthy":rs==="degraded"?"warning":"error"}),ie(F||null),Ye(Fs)}catch{if(!s)return;Se([]),X([]),H(v=>({...v,systemHealth:"error"})),Ye([]),ie(null)}})(),()=>{s=!1}},[n==null?void 0:n.role]);const Ne=async()=>{var b,P,R,J;const s=p=>{const v=new URLSearchParams;return v.set("page",String(p)),v.set("limit","100"),T.tier&&v.set("tier",String(T.tier)),T.status&&v.set("status",String(T.status)),v.toString()},t=await S.get(`${C.admin.licenses()}?${s(1)}`),h=((P=(b=t.data)==null?void 0:b.data)==null?void 0:P.licenses)??[],l=((J=(R=t.data)==null?void 0:R.data)==null?void 0:J.pagination)??{pages:1},r=Math.max(1,Number(l.pages)||1);let j=[...h];if(r>1){const p=Array.from({length:r-1},($,le)=>le+2),v=5;for(let $=0;$<p.length;$+=v){const le=p.slice($,$+v);(await Promise.all(le.map(Z=>S.get(`${C.admin.licenses()}?${s(Z)}`)))).forEach(Z=>{var Fe,L;const ce=((L=(Fe=Z.data)==null?void 0:Fe.data)==null?void 0:L.licenses)??[];j=j.concat(ce)})}}X(j.map(p=>{var v;return{id:p.id,key:p.key,userId:p.userId,userEmail:((v=p.user)==null?void 0:v.email)??"",tier:p.tier,status:String(p.status||"").toLowerCase(),activatedAt:new Date(Q(p.activatedAt||p.createdAt)).toISOString(),expiresAt:new Date(Q(p.expiresAt||p.createdAt)).toISOString(),lastUsed:new Date(Q(p.updatedAt||p.createdAt)).toISOString()}}))};d.useEffect(()=>{String((n==null?void 0:n.role)||"").toUpperCase()==="SUPERADMIN"&&w===1&&Ne().catch(()=>{})},[w,T,n==null?void 0:n.role]);const As=async()=>{var s,t,h;try{Xe(!0);const l=await S.get(C.admin.systemHealth()),r=((t=(s=l.data)==null?void 0:s.data)==null?void 0:t.health)||((h=l.data)==null?void 0:h.data);ie(r||null);const j=(r==null?void 0:r.overall)||"healthy";H(b=>({...b,systemHealth:j==="healthy"?"healthy":j==="degraded"?"warning":"error"}))}catch{ie(null),H(l=>({...l,systemHealth:"error"}))}finally{Xe(!1)}},ts=async(s=1)=>{var j,b,P,R;const t=new URLSearchParams;t.set("page",String(s)),t.set("limit","100"),y.status&&t.set("status",y.status),y.email&&t.set("email",y.email),y.from&&t.set("from",y.from),y.to&&t.set("to",y.to);const h=await S.get(`${C.admin.payments()}?${t.toString()}`),l=((b=(j=h.data)==null?void 0:j.data)==null?void 0:b.payments)??[],r=((R=(P=h.data)==null?void 0:P.data)==null?void 0:R.pagination)??{pages:1,page:1};js(l),we(r.page||s),ps(r.pages||1)};d.useEffect(()=>{String((n==null?void 0:n.role)||"").toUpperCase()==="SUPERADMIN"&&w===2&&ts(q).catch(()=>{})},[w,q,y,n==null?void 0:n.role]);const Es=async s=>{var t;try{const l=((t=(await S.get(C.admin.paymentDetails(s))).data)==null?void 0:t.data)||{};fs({payment:l.payment,licenses:l.licenses||[]}),Ae(!0)}catch{O("Failed to load payment details",{variant:"error"})}},Ls=s=>{Ge(s),ae(!0)},Us=()=>{O("User updated successfully",{variant:"success"}),ae(!1),Ge(null)},Ps=()=>{Ee(!0)},Rs=async()=>{ne(!0)},ks=async s=>{var t,h,l;if(re(r=>({...r,userId:s,subscriptionId:""})),s){const j=((l=(h=(t=(await S.get(C.admin.userDetails(s))).data)==null?void 0:t.data)==null?void 0:h.user)==null?void 0:l.subscriptions)||[];Ke(j.filter(b=>b.status==="ACTIVE"))}else Ke([])},Ns=async()=>{var s,t;try{await S.post(C.admin.createLicense(),z),O("License(s) created",{variant:"success"}),ne(!1);const l=((t=(s=(await S.get(C.admin.licenses())).data)==null?void 0:s.data)==null?void 0:t.licenses)??[];X(l.map(r=>{var j;return{id:r.id,key:r.key,userId:r.userId,userEmail:((j=r.user)==null?void 0:j.email)??"",tier:r.tier,status:(r.status||"").toLowerCase(),activatedAt:r.activatedAt||r.createdAt,expiresAt:r.expiresAt||r.createdAt,lastUsed:r.updatedAt||r.createdAt}}))}catch(h){O((h==null?void 0:h.message)||"Failed to create license",{variant:"error"})}},Te=s=>{switch(s){case"active":return"success";case"pending":return"warning";case"suspended":return"error";default:return"default"}},Ts=s=>{switch(String(s||"").toUpperCase()){case"SUPERADMIN":return"secondary";case"ADMIN":return"primary";default:return"default"}},ze=s=>{switch(String(s||"").toUpperCase()){case"ENTERPRISE":return"secondary";case"PRO":return"success";case"BASIC":return"default";default:return"default"}},We=s=>String(s||"").toUpperCase()==="BASIC"?"outlined":"filled",zs=s=>{switch(s){case"healthy":return"success";case"warning":return"warning";case"error":return"error";default:return"default"}},Ws=s=>{switch(s){case"healthy":return e.jsx(Zs,{});case"warning":return e.jsx(Me,{});case"error":return e.jsx(Js,{});default:return e.jsx(Me,{})}};d.useEffect(()=>{const s=(ye.hash||"").toLowerCase(),t={"#users":0,"#licenses":1,"#invoices":2,"#system":3,"#system-health":3};s&&t[s]!=null&&t[s]!==w&&Ve(t[s])},[ye.hash]);const $s=(s,t)=>{Ve(t);const l={0:"users",1:"licenses",2:"invoices",3:"system"}[t]||"users";(ye.hash||"").toLowerCase()!==`#${l}`&&ve(`/admin#${l}`,{replace:!0})};return e.jsx(e.Fragment,{children:e.jsx(i,{sx:{pb:4},children:e.jsxs(Ms,{maxWidth:"xl",children:[e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards","@keyframes fadeInUp":{"0%":{opacity:0,transform:"translateY(20px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:4},children:[e.jsx(Os,{sx:{fontSize:32,color:"primary.main"}}),e.jsx(o,{variant:"h4",sx:{fontWeight:700},children:"Admin Dashboard"}),e.jsx(m,{icon:Ws(N.systemHealth),label:`System ${N.systemHealth}`,color:zs(N.systemHealth),size:"small"})]}),e.jsxs(u,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(u,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.1s forwards"},children:e.jsx(_,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(K,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Bs,{sx:{color:"primary.main"}}),e.jsx(o,{variant:"h6",color:"text.secondary",children:"Total Users"})]}),e.jsx(o,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:N.totalUsers.toLocaleString()})]})})})}),e.jsx(u,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.2s forwards"},children:e.jsx(_,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(K,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Vs,{sx:{color:"secondary.main"}}),e.jsx(o,{variant:"h6",color:"text.secondary",children:"Active Subscriptions"})]}),e.jsx(o,{variant:"h3",sx:{fontWeight:700},children:N.activeSubscriptions.toLocaleString()})]})})})}),e.jsx(u,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.3s forwards"},children:e.jsx(_,{sx:{background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(139, 195, 74, 0.1) 100%)",border:"1px solid rgba(76, 175, 80, 0.2)"},children:e.jsxs(K,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Ys,{sx:{color:"success.main"}}),e.jsx(o,{variant:"h6",color:"text.secondary",children:"Total Revenue"})]}),e.jsxs(o,{variant:"h3",sx:{fontWeight:700,color:"success.main"},children:["$",N.totalRevenue.toLocaleString()]})]})})})}),e.jsx(u,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.4s forwards"},children:e.jsx(_,{sx:{background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 193, 7, 0.1) 100%)",border:"1px solid rgba(255, 152, 0, 0.2)"},children:e.jsxs(K,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Me,{sx:{color:"warning.main"}}),e.jsx(o,{variant:"h6",color:"text.secondary",children:"Pending Approvals"})]}),e.jsx(o,{variant:"h3",sx:{fontWeight:700,color:"warning.main"},children:N.pendingApprovals})]})})})})]}),e.jsx(M,{sx:{mb:3},children:e.jsxs(Gs,{value:w,onChange:$s,sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontWeight:600}},children:[e.jsx(de,{label:"Users"}),e.jsx(de,{label:"Licenses"}),e.jsx(de,{label:"Invoices"}),e.jsx(de,{label:"System Health"})]})}),w===0&&e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(g,{placeholder:"Search users by name, email, role, status, or subscription...",value:Y,onChange:s=>qe(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(G,{position:"start",children:e.jsx(Be,{})}),endAdornment:Y&&e.jsx(G,{position:"end",children:e.jsx(k,{size:"small",onClick:Is,children:e.jsx(Oe,{})})})}}),Y&&e.jsx(m,{label:`${Ue.length} of ${B.length} users found`,color:"primary",variant:"outlined"}),e.jsx(f,{variant:"contained",onClick:Rs,children:"Add License"})]}),e.jsxs(i,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsxs(g,{label:"Role",select:!0,size:"small",value:D.role||"",onChange:s=>ee(t=>({...t,role:s.target.value||void 0})),children:[e.jsx(c,{value:"",children:"All"}),e.jsx(c,{value:"USER",children:"USER"}),e.jsx(c,{value:"ADMIN",children:"ADMIN"}),e.jsx(c,{value:"SUPERADMIN",children:"SUPERADMIN"})]}),e.jsxs(g,{label:"Status",select:!0,size:"small",value:D.status||"",onChange:s=>ee(t=>({...t,status:s.target.value||void 0})),children:[e.jsx(c,{value:"",children:"All"}),e.jsx(c,{value:"active",children:"ACTIVE"}),e.jsx(c,{value:"suspended",children:"SUSPENDED"})]}),e.jsxs(g,{label:"Subscription Tier",select:!0,size:"small",value:D.tier||"",onChange:s=>ee(t=>({...t,tier:s.target.value||void 0})),children:[e.jsx(c,{value:"",children:"All"}),e.jsx(c,{value:"BASIC",children:"BASIC"}),e.jsx(c,{value:"PRO",children:"PRO"}),e.jsx(c,{value:"ENTERPRISE",children:"ENTERPRISE"})]}),e.jsx(f,{variant:"outlined",children:"Apply Filters"}),e.jsx(f,{onClick:()=>ee({}),children:"Clear"})]})]}),e.jsx(xe,{component:M,children:e.jsxs(he,{children:[e.jsx(ue,{children:e.jsxs(A,{children:[e.jsx(a,{children:"User"}),e.jsx(a,{children:"Role"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Subscription"}),e.jsx(a,{children:"Last Login"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(me,{children:Ue.length>0?Ue.map(s=>e.jsxs(A,{children:[e.jsx(a,{children:e.jsxs(i,{children:[e.jsxs(o,{variant:"subtitle2",children:[s.firstName," ",s.lastName]}),e.jsx(o,{variant:"body2",color:"text.secondary",children:s.email})]})}),e.jsx(a,{children:e.jsx(m,{label:s.role,size:"small",color:Ts(s.role)})}),e.jsx(a,{children:e.jsx(m,{label:s.status,size:"small",color:Te(s.status)})}),e.jsx(a,{children:s.subscription&&e.jsx(m,{label:s.subscription,size:"small",color:ze(s.subscription),variant:We(s.subscription)})}),e.jsx(a,{children:e.jsx(o,{variant:"body2",children:new Date(s.lastLogin).toLocaleDateString()})}),e.jsxs(a,{children:[e.jsx(k,{size:"small",onClick:()=>Ls(s),children:e.jsx(xs,{})}),e.jsx(k,{size:"small",color:"error",children:e.jsx(_s,{})})]})]},s.id)):e.jsx(A,{children:e.jsx(a,{colSpan:6,align:"center",children:e.jsx(i,{sx:{py:4},children:e.jsx(o,{variant:"body1",color:"text.secondary",children:Y?"No users found matching your search criteria.":"No users available."})})})})})]})})]}),w===1&&e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(g,{placeholder:"Search licenses by key, user email, tier, status, or dates...",value:U,onChange:s=>Qe(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(G,{position:"start",children:e.jsx(Be,{})}),endAdornment:U&&e.jsx(G,{position:"end",children:e.jsx(k,{size:"small",onClick:ss,children:e.jsx(Oe,{})})})}}),e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsxs(g,{select:!0,size:"small",label:"Tier",sx:{minWidth:140},value:T.tier||"",onChange:s=>Ie(t=>({...t,tier:s.target.value||void 0})),children:[e.jsx(c,{value:"",children:"All"}),e.jsx(c,{value:"BASIC",children:"BASIC"}),e.jsx(c,{value:"PRO",children:"PRO"}),e.jsx(c,{value:"ENTERPRISE",children:"ENTERPRISE"})]}),e.jsx(m,{size:"small",label:Le?"Showing users with 0 licenses":"Hiding users with 0 licenses",onClick:()=>Cs(s=>!s),variant:"outlined"}),e.jsxs(g,{select:!0,size:"small",label:"Status",sx:{minWidth:160},value:T.status||"",onChange:s=>Ie(t=>({...t,status:s.target.value||void 0})),children:[e.jsx(c,{value:"",children:"All"}),e.jsx(c,{value:"ACTIVE",children:"ACTIVE"}),e.jsx(c,{value:"PENDING",children:"PENDING"}),e.jsx(c,{value:"SUSPENDED",children:"SUSPENDED"}),e.jsx(c,{value:"EXPIRED",children:"EXPIRED"}),e.jsx(c,{value:"REVOKED",children:"REVOKED"})]}),e.jsx(f,{variant:"outlined",onClick:()=>Ne(),children:"Apply"}),e.jsx(f,{onClick:()=>{Ie({}),Ne().catch(()=>{})},children:"Clear"})]})]}),e.jsxs(i,{sx:{mb:2,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(m,{label:`${Re.length} Users with Licenses`,color:"primary",variant:"outlined"}),e.jsx(m,{label:`${Pe.length} Total Licenses`,color:"secondary",variant:"outlined"}),U&&e.jsx(m,{label:`Search: ${U}`,color:"info",variant:"outlined",onDelete:ss})]}),e.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:Re.length>0?Re.map(s=>e.jsx(_,{variant:"outlined",children:e.jsxs(K,{sx:{p:0},children:[e.jsx(i,{sx:{p:2,backgroundColor:"background.default",borderBottom:"1px solid",borderColor:"divider",cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>Ds(s.userEmail),children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ks,{color:"primary"}),e.jsxs(i,{children:[e.jsx(o,{variant:"h6",component:"div",children:s.userEmail}),e.jsxs(i,{sx:{display:"flex",gap:1,mt:.5},children:[e.jsx(m,{size:"small",label:`${s.totalLicenses} Total Licenses`,color:"primary",variant:"outlined"}),e.jsx(m,{size:"small",label:`${s.activeLicenses} Active`,color:"success",variant:"outlined"})]})]})]}),e.jsx(i,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(Hs,{sx:{transform:Ze.has(s.userEmail)?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})})]})}),e.jsx(Xs,{in:Ze.has(s.userEmail),children:e.jsx(xe,{component:M,sx:{borderRadius:0},children:e.jsxs(he,{size:"small",children:[e.jsx(ue,{children:e.jsxs(A,{children:[e.jsx(a,{children:"License Key"}),e.jsx(a,{children:"Tier"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Expires"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(me,{children:s.licenses.map(t=>e.jsxs(A,{children:[e.jsx(a,{children:e.jsx(o,{variant:"body2",fontFamily:"monospace",children:t.key})}),e.jsx(a,{children:e.jsx(m,{label:t.tier,size:"small",color:ze(t.tier),variant:We(t.tier)})}),e.jsx(a,{children:e.jsx(m,{label:t.status,size:"small",color:Te(String(t.status).toLowerCase())})}),e.jsx(a,{children:e.jsx(o,{variant:"body2",children:new Date(t.expiresAt).toLocaleDateString()})}),e.jsxs(a,{children:[e.jsx(k,{size:"small",onClick:()=>Ps(),children:e.jsx(xs,{})}),e.jsx(k,{size:"small",children:e.jsx(qs,{})}),e.jsx(k,{size:"small",children:e.jsx(Qs,{})})]})]},t.id))})]})})})]})},s.userEmail)):e.jsx(i,{sx:{py:4,textAlign:"center"},children:e.jsx(o,{variant:"body1",color:"text.secondary",children:U?"No licenses found matching your search criteria.":"No licenses available."})})})]}),w===2&&e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(g,{placeholder:"Search payments by ID, email, tier, status, amount, or date...",value:W,onChange:s=>Je(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(G,{position:"start",children:e.jsx(Be,{})}),endAdornment:W&&e.jsx(G,{position:"end",children:e.jsx(k,{size:"small",onClick:ws,children:e.jsx(Oe,{})})})}}),W&&e.jsx(m,{label:`${ke.length} of ${se.length} payments found`,color:"primary",variant:"outlined"})]}),e.jsxs(i,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(g,{label:"Filter by Email",size:"small",value:y.email||"",onChange:s=>te(t=>({...t,email:s.target.value}))}),e.jsx(g,{label:"From",size:"small",type:"date",InputLabelProps:{shrink:!0},value:y.from||"",onChange:s=>te(t=>({...t,from:s.target.value}))}),e.jsx(g,{label:"To",size:"small",type:"date",InputLabelProps:{shrink:!0},value:y.to||"",onChange:s=>te(t=>({...t,to:s.target.value}))}),e.jsxs(g,{label:"Status",select:!0,size:"small",value:y.status||"",onChange:s=>te(t=>({...t,status:s.target.value||void 0})),sx:{minWidth:160},children:[e.jsx(c,{value:"",children:"All"}),e.jsx(c,{value:"SUCCEEDED",children:"SUCCEEDED"}),e.jsx(c,{value:"PENDING",children:"PENDING"}),e.jsx(c,{value:"FAILED",children:"FAILED"}),e.jsx(c,{value:"REFUNDED",children:"REFUNDED"})]}),e.jsx(f,{variant:"outlined",onClick:()=>ts(1),children:"Apply Filters"})]})]}),e.jsx(xe,{component:M,children:e.jsxs(he,{children:[e.jsx(ue,{children:e.jsxs(A,{children:[e.jsx(a,{children:"Payment ID"}),e.jsx(a,{children:"User"}),e.jsx(a,{children:"Tier"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Invoice"}),e.jsx(a,{children:"Details"})]})}),e.jsx(me,{children:ke.length>0?ke.map(s=>{var t,h,l,r;return e.jsxs(A,{children:[e.jsx(a,{children:e.jsx(o,{variant:"body2",fontFamily:"monospace",children:s.id})}),e.jsx(a,{children:e.jsx(o,{variant:"body2",children:((t=s.user)==null?void 0:t.email)||"â€”"})}),e.jsx(a,{children:e.jsx(m,{size:"small",label:((h=s.subscription)==null?void 0:h.tier)||"â€”",color:ze((l=s.subscription)==null?void 0:l.tier),variant:We((r=s.subscription)==null?void 0:r.tier)})}),e.jsx(a,{children:e.jsx(o,{variant:"body2",children:es(s.amount)})}),e.jsx(a,{children:e.jsx(m,{size:"small",label:s.status,color:s.status==="SUCCEEDED"?"success":s.status==="FAILED"?"error":"default"})}),e.jsx(a,{children:e.jsx(o,{variant:"body2",children:Q(s.createdAt).toLocaleDateString()})}),e.jsx(a,{children:s.stripeInvoiceId?e.jsx(f,{size:"small",variant:"outlined",onClick:()=>{const j=localStorage.getItem("auth_token"),b=`/api/invoices/${s.stripeInvoiceId}/pdf${j?`?token=${encodeURIComponent(j)}`:""}`;window.open(b,"_blank")},children:"View"}):s.receiptUrl?e.jsx(f,{size:"small",variant:"outlined",onClick:()=>window.open(s.receiptUrl,"_blank"),children:"View"}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"N/A"})}),e.jsx(a,{children:e.jsx(f,{size:"small",onClick:()=>Es(s.id),children:"Open"})})]},s.id)}):e.jsx(A,{children:e.jsx(a,{colSpan:8,align:"center",children:e.jsx(i,{sx:{py:4},children:e.jsx(o,{variant:"body1",color:"text.secondary",children:W?"No payments found matching your search criteria.":"No payments available."})})})})})]})}),e.jsxs(i,{sx:{display:"flex",gap:1,justifyContent:"flex-end",mt:2},children:[e.jsx(f,{disabled:q<=1,onClick:()=>we(s=>Math.max(1,s-1)),children:"Prev"}),e.jsx(m,{label:`Page ${q} of ${De}`}),e.jsx(f,{disabled:q>=De,onClick:()=>we(s=>Math.min(De,s+1)),children:"Next"})]})]}),w===3&&e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:e.jsxs(u,{container:!0,spacing:3,children:[e.jsx(u,{item:!0,xs:12,md:6,children:e.jsxs(M,{sx:{p:3},children:[e.jsx(o,{variant:"h6",sx:{mb:2},children:"System Status"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(m,{label:`Overall: ${((x==null?void 0:x.overall)||"unknown").toUpperCase()}`,color:(x==null?void 0:x.overall)==="healthy"?"success":(x==null?void 0:x.overall)==="degraded"?"warning":(x==null?void 0:x.overall)==="unhealthy"?"error":"default"}),e.jsx(f,{size:"small",onClick:As,disabled:He,children:He?"Refreshingâ€¦":"Refresh"})]}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(be,{title:"Database",data:x==null?void 0:x.database})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(be,{title:"Email (SendGrid)",data:x==null?void 0:x.email})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(be,{title:"Payments (Stripe)",data:x==null?void 0:x.payment})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(be,{title:"Webhooks",data:x==null?void 0:x.webhooks})})]})]})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsxs(M,{sx:{p:3},children:[e.jsx(o,{variant:"h6",sx:{mb:2},children:"Recent Activity"}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Checked at: ",x!=null&&x.checkedAt?new Date(x.checkedAt).toLocaleString():"â€”"]}),(as=x==null?void 0:x.webhooks)!=null&&as.metrics?e.jsxs(e.Fragment,{children:[e.jsxs(o,{variant:"body2",children:["Recent webhooks (24h): ",x.webhooks.metrics.recentWebhooks]}),e.jsxs(o,{variant:"body2",children:["Failed webhooks: ",x.webhooks.metrics.failedWebhooks]})]}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"No metrics available"})]})]})})]})})]}),e.jsxs(je,{open:bs,onClose:()=>ae(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(pe,{children:"Edit User"}),e.jsx(ge,{children:V&&e.jsxs(u,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,label:"First Name",value:V.firstName})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,label:"Last Name",value:V.lastName})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(g,{fullWidth:!0,label:"Email",value:V.email})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsxs(hs,{fullWidth:!0,children:[e.jsx(us,{children:"Role"}),e.jsxs(ms,{value:V.role,label:"Role",inputProps:{"aria-label":"Select user role",title:"Choose the user role"},children:[e.jsx(c,{value:"USER",children:"User"}),e.jsx(c,{value:"ADMIN",children:"Admin"})]})]})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsxs(hs,{fullWidth:!0,children:[e.jsx(us,{children:"Status"}),e.jsxs(ms,{value:V.status,label:"Status",inputProps:{"aria-label":"Select user status",title:"Choose the user status"},children:[e.jsx(c,{value:"active",children:"Active"}),e.jsx(c,{value:"suspended",children:"Suspended"}),e.jsx(c,{value:"pending",children:"Pending"})]})]})})]})}),e.jsxs(fe,{children:[e.jsx(f,{onClick:()=>ae(!1),children:"Cancel"}),e.jsx(f,{onClick:Us,variant:"contained",children:"Save Changes"})]})]}),e.jsxs(je,{open:gs,onClose:()=>Ae(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(pe,{children:"Payment Details"}),e.jsx(ge,{children:E.payment?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(m,{label:`ID: ${E.payment.id}`}),e.jsx(m,{label:`User: ${((ns=E.payment.user)==null?void 0:ns.email)||"â€”"}`}),e.jsx(m,{label:`Amount: $${(E.payment.amount/100).toFixed(2)}`}),e.jsx(m,{label:`Status: ${E.payment.status}`}),e.jsx(m,{label:`Date: ${new Date(E.payment.createdAt).toLocaleString()}`}),E.payment.receiptUrl&&e.jsx(f,{size:"small",variant:"outlined",onClick:()=>window.open(E.payment.receiptUrl,"_blank"),children:"View Invoice"})]}),e.jsx(o,{variant:"subtitle2",children:"Related Licenses"}),e.jsx(xe,{component:M,children:e.jsxs(he,{size:"small",children:[e.jsx(ue,{children:e.jsxs(A,{children:[e.jsx(a,{children:"License Key"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Activated"}),e.jsx(a,{children:"Expires"})]})}),e.jsx(me,{children:(E.licenses||[]).map(s=>e.jsxs(A,{children:[e.jsx(a,{children:e.jsx(o,{variant:"body2",fontFamily:"monospace",children:s.key})}),e.jsx(a,{children:e.jsx(m,{size:"small",label:s.status,color:Te(String(s.status).toLowerCase())})}),e.jsx(a,{children:s.activatedAt?new Date(s.activatedAt).toLocaleDateString():"â€”"}),e.jsx(a,{children:s.expiresAt?new Date(s.expiresAt).toLocaleDateString():"â€”"})]},s.id))})]})})]}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"No details."})}),e.jsx(fe,{children:e.jsx(f,{onClick:()=>Ae(!1),children:"Close"})})]}),e.jsxs(je,{open:vs,onClose:()=>Ee(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(pe,{children:"Edit License"}),e.jsx(ge,{children:e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"License management options will be available here."})}),e.jsx(fe,{children:e.jsx(f,{onClick:()=>Ee(!1),children:"Close"})})]}),e.jsxs(je,{open:ys,onClose:()=>ne(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(pe,{children:"Add License"}),e.jsx(ge,{children:e.jsxs(u,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(g,{select:!0,fullWidth:!0,label:"User",value:z.userId,onChange:s=>ks(s.target.value),children:B.map(s=>e.jsx(c,{value:s.id,children:s.email},s.id))})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(g,{select:!0,fullWidth:!0,label:"Subscription",value:z.subscriptionId,onChange:s=>re(t=>({...t,subscriptionId:s.target.value})),disabled:!_e.length,children:_e.map(s=>e.jsxs(c,{value:s.id,children:[s.tier," â€” seats ",s.seats]},s.id))})}),e.jsx(u,{item:!0,xs:6,children:e.jsxs(g,{select:!0,fullWidth:!0,label:"Tier",value:z.tier,onChange:s=>re(t=>({...t,tier:s.target.value})),children:[e.jsx(c,{value:"BASIC",children:"BASIC"}),e.jsx(c,{value:"PRO",children:"PRO"}),e.jsx(c,{value:"ENTERPRISE",children:"ENTERPRISE"})]})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(g,{fullWidth:!0,type:"number",label:"Seats",inputProps:{min:1,max:1e3},value:z.seats,onChange:s=>re(t=>({...t,seats:Math.max(1,Math.min(1e3,parseInt(s.target.value)||1))}))})})]})}),e.jsxs(fe,{children:[e.jsx(f,{onClick:()=>ne(!1),children:"Cancel"}),e.jsx(f,{variant:"contained",onClick:Ns,disabled:!z.userId||!z.subscriptionId,children:"Create"})]})]})]})})})};export{xt as default};
