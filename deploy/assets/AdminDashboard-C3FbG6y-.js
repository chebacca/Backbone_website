import{j as e,a as i,b as ks,an as Rs,T as r,h as j,G as d,k as X,l as Q,au as Ns,bN as Ts,aa as Ws,aQ as ke,c as $,b9 as zs,ba as le,u as b,v as B,I as U,bO as Re,az as Ne,d as g,aB as ce,aC as oe,aD as de,aE as w,aF as a,aG as xe,aK as ss,b1 as $s,a4 as u,y as Fs,aq as Os,aM as he,aN as ue,aO as me,aR as ts,aS as as,aT as ns,aP as je,O as Ms,n as Bs,t as Ys}from"./mui-BmK9T4iY.js";import{u as Vs,r as o}from"./vendor-DIxetjBo.js";import{u as Gs}from"./notistack.esm-Bg0Tn0tt.js";import{u as _s,c as S,e as C}from"./index-Copays0o.js";import{N as Ks}from"./Navigation-CRoe9kx_.js";import{F as qs}from"./Footer-CFQhTI6x.js";import"./stripe-6nutOR1s.js";const pe=({title:F,data:n})=>{const I=(n==null?void 0:n.status)==="healthy"?"success":(n==null?void 0:n.status)==="degraded"?"warning":(n==null?void 0:n.status)==="unhealthy"?"error":"default";return e.jsx(X,{variant:"outlined",children:e.jsxs(Q,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(r,{variant:"subtitle1",children:F}),e.jsx(j,{size:"small",label:((n==null?void 0:n.status)||"unknown").toUpperCase(),color:I})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Response time: ",(n==null?void 0:n.responseTimeMs)!=null?`${n.responseTimeMs} ms`:"â€”"]})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(r,{variant:"body2",color:"text.secondary",children:(n==null?void 0:n.message)||""})}),(n==null?void 0:n.error)&&e.jsx(d,{item:!0,xs:12,children:e.jsx(Ys,{severity:"warning",children:n.error})})]})]})})},nt=()=>{var _e,Ke;const{enqueueSnackbar:F}=Gs(),{user:n}=_s();Vs();const[I,rs]=o.useState(0),[P,Y]=o.useState({totalUsers:0,activeSubscriptions:0,totalRevenue:0,pendingApprovals:0,systemHealth:"healthy"}),[V,ge]=o.useState([]),[H,G]=o.useState([]),[_,J]=o.useState(1),[be,is]=o.useState(1),[k,fe]=o.useState({}),[Xs,Te]=o.useState([]),[Z,ls]=o.useState([]),[K,ye]=o.useState(1),[ve,cs]=o.useState(1),[v,ee]=o.useState({}),[os,Se]=o.useState(!1),[D,ds]=o.useState({}),[O,We]=o.useState(null),[xs,se]=o.useState(!1),[hs,Ce]=o.useState(!1),[us,te]=o.useState(!1),[R,ae]=o.useState({userId:"",subscriptionId:"",tier:"PRO",seats:1}),[ze,$e]=o.useState([]),[l,ne]=o.useState(null),[Fe,Oe]=o.useState(!1),[N,Me]=o.useState(""),[T,Be]=o.useState(""),[W,Ye]=o.useState(""),Ie=o.useMemo(()=>{if(!N.trim())return V;const s=N.toLowerCase();return V.filter(t=>t.firstName.toLowerCase().includes(s)||t.lastName.toLowerCase().includes(s)||t.email.toLowerCase().includes(s)||t.role.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||t.subscription&&t.subscription.toLowerCase().includes(s))},[V,N]),we=o.useMemo(()=>{if(!T.trim())return H;const s=T.toLowerCase();return H.filter(t=>t.key.toLowerCase().includes(s)||t.userEmail.toLowerCase().includes(s)||t.tier.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||new Date(t.expiresAt).toLocaleDateString().includes(s)||new Date(t.activatedAt).toLocaleDateString().includes(s))},[H,T]),A=s=>{if(!s)return new Date(NaN);if(typeof s=="string")return new Date(s);if(s instanceof Date)return s;if(typeof s=="object"&&s!==null){if(typeof s._seconds=="number")return new Date(s._seconds*1e3);if(typeof s.seconds=="number")return new Date(s.seconds*1e3);if(typeof s.toDate=="function")try{return s.toDate()}catch{}}return new Date(s)},Ve=s=>`$${((typeof s=="number"?s:0)/100).toFixed(2)}`,De=o.useMemo(()=>{if(!W.trim())return Z;const s=W.toLowerCase();return Z.filter(t=>{var x,h;return t.id.toLowerCase().includes(s)||((x=t.user)==null?void 0:x.email)&&t.user.email.toLowerCase().includes(s)||((h=t.subscription)==null?void 0:h.tier)&&t.subscription.tier.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||A(t.createdAt).toLocaleDateString().toLowerCase().includes(s)||Ve(t.amount).toLowerCase().includes(s)})},[Z,W]),ms=()=>Me(""),js=()=>Be(""),ps=()=>Ye("");o.useEffect(()=>{let s=!0;return(async()=>{var t,x,h,c,p,y,E,L,f;try{if(String((n==null?void 0:n.role)||"").toUpperCase()!=="SUPERADMIN"){ge([]),G([]),Y(m=>({...m,systemHealth:"warning"}));return}const[Pe,Es,Qs,qe,Ls]=await Promise.all([S.get(`${C.admin.users()}?page=1&limit=100`),S.get(`${C.admin.licenses()}?page=1&limit=100`),S.get(C.admin.paymentAnalytics()),S.get(C.admin.systemHealth()),S.get(C.admin.dashboardStats())]),Xe=((x=(t=Pe.data)==null?void 0:t.data)==null?void 0:x.users)??[],Us=((c=(h=Es.data)==null?void 0:h.data)==null?void 0:c.licenses)??[],M=((y=(p=Ls.data)==null?void 0:p.data)==null?void 0:y.stats)??{totalRevenue:0,activeSubscriptions:0},Ps=(M==null?void 0:M.recentPayments)??[],z=((L=(E=qe.data)==null?void 0:E.data)==null?void 0:L.health)||((f=qe.data)==null?void 0:f.data),Qe=(z==null?void 0:z.overall)||(z==null?void 0:z.status)||"healthy";if(!s)return;ge(Xe.map(m=>{var q,He,ie,Je,Ze,es;return{id:m.id,email:m.email,firstName:((q=m.name)==null?void 0:q.split(" ")[0])??"",lastName:((He=m.name)==null?void 0:He.split(" ").slice(1).join(" "))??"",role:m.role,status:((Je=(ie=m.status)==null?void 0:ie.toLowerCase)==null?void 0:Je.call(ie))||"active",subscription:((es=(Ze=m.subscriptions)==null?void 0:Ze[0])==null?void 0:es.tier)??void 0,lastLogin:m.lastLoginAt||new Date().toISOString(),createdAt:m.createdAt||new Date().toISOString()}})),G(Us.map(m=>{var q;return{id:m.id,key:m.key,userId:m.userId,userEmail:((q=m.user)==null?void 0:q.email)??"",tier:m.tier,status:String(m.status||"").toLowerCase(),activatedAt:new Date(A(m.activatedAt||m.createdAt)).toISOString(),expiresAt:new Date(A(m.expiresAt||m.createdAt)).toISOString(),lastUsed:new Date(A(m.updatedAt||m.createdAt)).toISOString()}})),Y({totalUsers:Number(M.totalUsers||Xe.length)||0,activeSubscriptions:M.activeSubscriptions??0,totalRevenue:Math.round(M.totalRevenue??0)/100,pendingApprovals:0,systemHealth:Qe==="healthy"?"healthy":Qe==="degraded"?"warning":"error"}),ne(z||null),Te(Ps)}catch{if(!s)return;ge([]),G([]),Y(Pe=>({...Pe,systemHealth:"error"})),Te([]),ne(null)}})(),()=>{s=!1}},[n==null?void 0:n.role]);const Ae=async(s=1)=>{var p,y,E,L;const t=new URLSearchParams;t.set("page",String(s)),t.set("limit","100"),k.tier&&t.set("tier",String(k.tier)),k.status&&t.set("status",String(k.status));const x=await S.get(`${C.admin.licenses()}?${t.toString()}`),h=((y=(p=x.data)==null?void 0:p.data)==null?void 0:y.licenses)??[],c=((L=(E=x.data)==null?void 0:E.data)==null?void 0:L.pagination)??{pages:1,page:1};G(h.map(f=>{var re;return{id:f.id,key:f.key,userId:f.userId,userEmail:((re=f.user)==null?void 0:re.email)??"",tier:f.tier,status:String(f.status||"").toLowerCase(),activatedAt:new Date(A(f.activatedAt||f.createdAt)).toISOString(),expiresAt:new Date(A(f.expiresAt||f.createdAt)).toISOString(),lastUsed:new Date(A(f.updatedAt||f.createdAt)).toISOString()}})),J(c.page||s),is(c.pages||1)};o.useEffect(()=>{String((n==null?void 0:n.role)||"").toUpperCase()==="SUPERADMIN"&&I===1&&Ae(_).catch(()=>{})},[I,_,k,n==null?void 0:n.role]);const gs=async()=>{var s,t,x;try{Oe(!0);const h=await S.get(C.admin.systemHealth()),c=((t=(s=h.data)==null?void 0:s.data)==null?void 0:t.health)||((x=h.data)==null?void 0:x.data);ne(c||null);const p=(c==null?void 0:c.overall)||"healthy";Y(y=>({...y,systemHealth:p==="healthy"?"healthy":p==="degraded"?"warning":"error"}))}catch{ne(null),Y(h=>({...h,systemHealth:"error"}))}finally{Oe(!1)}},Ge=async(s=1)=>{var p,y,E,L;const t=new URLSearchParams;t.set("page",String(s)),t.set("limit","100"),v.status&&t.set("status",v.status),v.email&&t.set("email",v.email),v.from&&t.set("from",v.from),v.to&&t.set("to",v.to);const x=await S.get(`${C.admin.payments()}?${t.toString()}`),h=((y=(p=x.data)==null?void 0:p.data)==null?void 0:y.payments)??[],c=((L=(E=x.data)==null?void 0:E.data)==null?void 0:L.pagination)??{pages:1,page:1};ls(h),ye(c.page||s),cs(c.pages||1)};o.useEffect(()=>{String((n==null?void 0:n.role)||"").toUpperCase()==="SUPERADMIN"&&I===2&&Ge(K).catch(()=>{})},[I,K,v,n==null?void 0:n.role]);const bs=async s=>{var t;try{const h=((t=(await S.get(C.admin.paymentDetails(s))).data)==null?void 0:t.data)||{};ds({payment:h.payment,licenses:h.licenses||[]}),Se(!0)}catch{F("Failed to load payment details",{variant:"error"})}},fs=s=>{We(s),se(!0)},ys=()=>{F("User updated successfully",{variant:"success"}),se(!1),We(null)},vs=()=>{Ce(!0)},Ss=async()=>{te(!0)},Cs=async s=>{var t,x,h;if(ae(c=>({...c,userId:s,subscriptionId:""})),s){const p=((h=(x=(t=(await S.get(C.admin.userDetails(s))).data)==null?void 0:t.data)==null?void 0:x.user)==null?void 0:h.subscriptions)||[];$e(p.filter(y=>y.status==="ACTIVE"))}else $e([])},Is=async()=>{var s,t;try{await S.post(C.admin.createLicense(),R),F("License(s) created",{variant:"success"}),te(!1);const h=((t=(s=(await S.get(C.admin.licenses())).data)==null?void 0:s.data)==null?void 0:t.licenses)??[];G(h.map(c=>{var p;return{id:c.id,key:c.key,userId:c.userId,userEmail:((p=c.user)==null?void 0:p.email)??"",tier:c.tier,status:(c.status||"").toLowerCase(),activatedAt:c.activatedAt||c.createdAt,expiresAt:c.expiresAt||c.createdAt,lastUsed:c.updatedAt||c.createdAt}}))}catch(x){F((x==null?void 0:x.message)||"Failed to create license",{variant:"error"})}},Ee=s=>{switch(s){case"active":return"success";case"pending":return"warning";case"suspended":return"error";default:return"default"}},ws=s=>{switch(String(s||"").toUpperCase()){case"SUPERADMIN":return"secondary";case"ADMIN":return"primary";default:return"default"}},Le=s=>{switch(String(s||"").toUpperCase()){case"ENTERPRISE":return"secondary";case"PRO":return"success";case"BASIC":return"default";default:return"default"}},Ue=s=>String(s||"").toUpperCase()==="BASIC"?"outlined":"filled",Ds=s=>{switch(s){case"healthy":return"success";case"warning":return"warning";case"error":return"error";default:return"default"}},As=s=>{switch(s){case"healthy":return e.jsx(Bs,{});case"warning":return e.jsx(ke,{});case"error":return e.jsx(Ms,{});default:return e.jsx(ke,{})}};return e.jsxs(e.Fragment,{children:[e.jsx(Ks,{}),e.jsx(i,{sx:{pt:8,pb:4},children:e.jsxs(ks,{maxWidth:"xl",children:[e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards","@keyframes fadeInUp":{"0%":{opacity:0,transform:"translateY(20px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:4},children:[e.jsx(Rs,{sx:{fontSize:32,color:"primary.main"}}),e.jsx(r,{variant:"h4",sx:{fontWeight:700},children:"Admin Dashboard"}),e.jsx(j,{icon:As(P.systemHealth),label:`System ${P.systemHealth}`,color:Ds(P.systemHealth),size:"small"})]}),e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.1s forwards"},children:e.jsx(X,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(Q,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Ns,{sx:{color:"primary.main"}}),e.jsx(r,{variant:"h6",color:"text.secondary",children:"Total Users"})]}),e.jsx(r,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:P.totalUsers.toLocaleString()})]})})})}),e.jsx(d,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.2s forwards"},children:e.jsx(X,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(Q,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Ts,{sx:{color:"secondary.main"}}),e.jsx(r,{variant:"h6",color:"text.secondary",children:"Active Subscriptions"})]}),e.jsx(r,{variant:"h3",sx:{fontWeight:700},children:P.activeSubscriptions.toLocaleString()})]})})})}),e.jsx(d,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.3s forwards"},children:e.jsx(X,{sx:{background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(139, 195, 74, 0.1) 100%)",border:"1px solid rgba(76, 175, 80, 0.2)"},children:e.jsxs(Q,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Ws,{sx:{color:"success.main"}}),e.jsx(r,{variant:"h6",color:"text.secondary",children:"Total Revenue"})]}),e.jsxs(r,{variant:"h3",sx:{fontWeight:700,color:"success.main"},children:["$",P.totalRevenue.toLocaleString()]})]})})})}),e.jsx(d,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.4s forwards"},children:e.jsx(X,{sx:{background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 193, 7, 0.1) 100%)",border:"1px solid rgba(255, 152, 0, 0.2)"},children:e.jsxs(Q,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(ke,{sx:{color:"warning.main"}}),e.jsx(r,{variant:"h6",color:"text.secondary",children:"Pending Approvals"})]}),e.jsx(r,{variant:"h3",sx:{fontWeight:700,color:"warning.main"},children:P.pendingApprovals})]})})})})]}),e.jsx($,{sx:{mb:3},children:e.jsxs(zs,{value:I,onChange:(s,t)=>rs(t),sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontWeight:600}},children:[e.jsx(le,{label:"Users"}),e.jsx(le,{label:"Licenses"}),e.jsx(le,{label:"Invoices"}),e.jsx(le,{label:"System Health"})]})}),I===0&&e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(b,{placeholder:"Search users by name, email, role, status, or subscription...",value:N,onChange:s=>Me(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(B,{position:"start",children:e.jsx(Ne,{})}),endAdornment:N&&e.jsx(B,{position:"end",children:e.jsx(U,{size:"small",onClick:ms,children:e.jsx(Re,{})})})}}),e.jsx(g,{variant:"contained",onClick:Ss,children:"Add License"})]}),N&&e.jsx(i,{sx:{mb:2},children:e.jsx(j,{label:`${Ie.length} of ${V.length} users found`,color:"primary",variant:"outlined"})}),e.jsx(ce,{component:$,children:e.jsxs(oe,{children:[e.jsx(de,{children:e.jsxs(w,{children:[e.jsx(a,{children:"User"}),e.jsx(a,{children:"Role"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Subscription"}),e.jsx(a,{children:"Last Login"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(xe,{children:Ie.length>0?Ie.map(s=>e.jsxs(w,{children:[e.jsx(a,{children:e.jsxs(i,{children:[e.jsxs(r,{variant:"subtitle2",children:[s.firstName," ",s.lastName]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:s.email})]})}),e.jsx(a,{children:e.jsx(j,{label:s.role,size:"small",color:ws(s.role)})}),e.jsx(a,{children:e.jsx(j,{label:s.status,size:"small",color:Ee(s.status)})}),e.jsx(a,{children:s.subscription&&e.jsx(j,{label:s.subscription,size:"small",color:Le(s.subscription),variant:Ue(s.subscription)})}),e.jsx(a,{children:e.jsx(r,{variant:"body2",children:new Date(s.lastLogin).toLocaleDateString()})}),e.jsxs(a,{children:[e.jsx(U,{size:"small",onClick:()=>fs(s),children:e.jsx(ss,{})}),e.jsx(U,{size:"small",color:"error",children:e.jsx($s,{})})]})]},s.id)):e.jsx(w,{children:e.jsx(a,{colSpan:6,align:"center",children:e.jsx(i,{sx:{py:4},children:e.jsx(r,{variant:"body1",color:"text.secondary",children:N?"No users found matching your search criteria.":"No users available."})})})})})]})})]}),I===1&&e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(b,{placeholder:"Search licenses by key, user email, tier, status, or dates...",value:T,onChange:s=>Be(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(B,{position:"start",children:e.jsx(Ne,{})}),endAdornment:T&&e.jsx(B,{position:"end",children:e.jsx(U,{size:"small",onClick:js,children:e.jsx(Re,{})})})}}),e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsxs(b,{select:!0,size:"small",label:"Tier",sx:{minWidth:140},value:k.tier||"",onChange:s=>fe(t=>({...t,tier:s.target.value||void 0})),children:[e.jsx(u,{value:"",children:"All"}),e.jsx(u,{value:"BASIC",children:"BASIC"}),e.jsx(u,{value:"PRO",children:"PRO"}),e.jsx(u,{value:"ENTERPRISE",children:"ENTERPRISE"})]}),e.jsxs(b,{select:!0,size:"small",label:"Status",sx:{minWidth:160},value:k.status||"",onChange:s=>fe(t=>({...t,status:s.target.value||void 0})),children:[e.jsx(u,{value:"",children:"All"}),e.jsx(u,{value:"ACTIVE",children:"ACTIVE"}),e.jsx(u,{value:"PENDING",children:"PENDING"}),e.jsx(u,{value:"SUSPENDED",children:"SUSPENDED"}),e.jsx(u,{value:"EXPIRED",children:"EXPIRED"}),e.jsx(u,{value:"REVOKED",children:"REVOKED"})]}),e.jsx(g,{variant:"outlined",onClick:()=>Ae(1),children:"Apply"}),e.jsx(g,{onClick:()=>{fe({}),J(1),Ae(1).catch(()=>{})},children:"Clear"})]})]}),T&&e.jsx(i,{sx:{mb:2},children:e.jsx(j,{label:`${we.length} of ${H.length} licenses found`,color:"primary",variant:"outlined"})}),e.jsx(ce,{component:$,children:e.jsxs(oe,{children:[e.jsx(de,{children:e.jsxs(w,{children:[e.jsx(a,{children:"License Key"}),e.jsx(a,{children:"User"}),e.jsx(a,{children:"Tier"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Expires"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(xe,{children:we.length>0?we.map(s=>e.jsxs(w,{children:[e.jsx(a,{children:e.jsx(r,{variant:"body2",fontFamily:"monospace",children:s.key})}),e.jsx(a,{children:e.jsx(r,{variant:"body2",children:s.userEmail})}),e.jsx(a,{children:e.jsx(j,{label:s.tier,size:"small",color:Le(s.tier),variant:Ue(s.tier)})}),e.jsx(a,{children:e.jsx(j,{label:s.status,size:"small",color:Ee(String(s.status).toLowerCase())})}),e.jsx(a,{children:e.jsx(r,{variant:"body2",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsxs(a,{children:[e.jsx(U,{size:"small",onClick:()=>vs(),children:e.jsx(ss,{})}),e.jsx(U,{size:"small",children:e.jsx(Fs,{})}),e.jsx(U,{size:"small",children:e.jsx(Os,{})})]})]},s.id)):e.jsx(w,{children:e.jsx(a,{colSpan:6,align:"center",children:e.jsx(i,{sx:{py:4},children:e.jsx(r,{variant:"body1",color:"text.secondary",children:T?"No licenses found matching your search criteria.":"No licenses available."})})})})})]})}),e.jsxs(i,{sx:{display:"flex",gap:1,justifyContent:"flex-end",mt:2},children:[e.jsx(g,{disabled:_<=1,onClick:()=>J(s=>Math.max(1,s-1)),children:"Prev"}),e.jsx(j,{label:`Page ${_} of ${be}`}),e.jsx(g,{disabled:_>=be,onClick:()=>J(s=>Math.min(be,s+1)),children:"Next"})]})]}),I===2&&e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{placeholder:"Search payments by ID, email, tier, status, amount, or date...",value:W,onChange:s=>Ye(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(B,{position:"start",children:e.jsx(Ne,{})}),endAdornment:W&&e.jsx(B,{position:"end",children:e.jsx(U,{size:"small",onClick:ps,children:e.jsx(Re,{})})})}}),W&&e.jsx(j,{label:`${De.length} of ${Z.length} payments found`,color:"primary",variant:"outlined"})]}),e.jsxs(i,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(b,{label:"Filter by Email",size:"small",value:v.email||"",onChange:s=>ee(t=>({...t,email:s.target.value}))}),e.jsx(b,{label:"From",size:"small",type:"date",InputLabelProps:{shrink:!0},value:v.from||"",onChange:s=>ee(t=>({...t,from:s.target.value}))}),e.jsx(b,{label:"To",size:"small",type:"date",InputLabelProps:{shrink:!0},value:v.to||"",onChange:s=>ee(t=>({...t,to:s.target.value}))}),e.jsxs(b,{label:"Status",select:!0,size:"small",value:v.status||"",onChange:s=>ee(t=>({...t,status:s.target.value||void 0})),sx:{minWidth:160},children:[e.jsx(u,{value:"",children:"All"}),e.jsx(u,{value:"SUCCEEDED",children:"SUCCEEDED"}),e.jsx(u,{value:"PENDING",children:"PENDING"}),e.jsx(u,{value:"FAILED",children:"FAILED"}),e.jsx(u,{value:"REFUNDED",children:"REFUNDED"})]}),e.jsx(g,{variant:"outlined",onClick:()=>Ge(1),children:"Apply Filters"})]})]}),e.jsx(ce,{component:$,children:e.jsxs(oe,{children:[e.jsx(de,{children:e.jsxs(w,{children:[e.jsx(a,{children:"Payment ID"}),e.jsx(a,{children:"User"}),e.jsx(a,{children:"Tier"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Invoice"}),e.jsx(a,{children:"Details"})]})}),e.jsx(xe,{children:De.length>0?De.map(s=>{var t,x,h,c;return e.jsxs(w,{children:[e.jsx(a,{children:e.jsx(r,{variant:"body2",fontFamily:"monospace",children:s.id})}),e.jsx(a,{children:e.jsx(r,{variant:"body2",children:((t=s.user)==null?void 0:t.email)||"â€”"})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:((x=s.subscription)==null?void 0:x.tier)||"â€”",color:Le((h=s.subscription)==null?void 0:h.tier),variant:Ue((c=s.subscription)==null?void 0:c.tier)})}),e.jsx(a,{children:e.jsx(r,{variant:"body2",children:Ve(s.amount)})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:s.status,color:s.status==="SUCCEEDED"?"success":s.status==="FAILED"?"error":"default"})}),e.jsx(a,{children:e.jsx(r,{variant:"body2",children:A(s.createdAt).toLocaleDateString()})}),e.jsx(a,{children:s.stripeInvoiceId?e.jsx(g,{size:"small",variant:"outlined",onClick:()=>{const p=localStorage.getItem("auth_token"),y=`/api/invoices/${s.stripeInvoiceId}/pdf${p?`?token=${encodeURIComponent(p)}`:""}`;window.open(y,"_blank")},children:"View"}):s.receiptUrl?e.jsx(g,{size:"small",variant:"outlined",onClick:()=>window.open(s.receiptUrl,"_blank"),children:"View"}):e.jsx(r,{variant:"body2",color:"text.secondary",children:"N/A"})}),e.jsx(a,{children:e.jsx(g,{size:"small",onClick:()=>bs(s.id),children:"Open"})})]},s.id)}):e.jsx(w,{children:e.jsx(a,{colSpan:8,align:"center",children:e.jsx(i,{sx:{py:4},children:e.jsx(r,{variant:"body1",color:"text.secondary",children:W?"No payments found matching your search criteria.":"No payments available."})})})})})]})}),e.jsxs(i,{sx:{display:"flex",gap:1,justifyContent:"flex-end",mt:2},children:[e.jsx(g,{disabled:K<=1,onClick:()=>ye(s=>Math.max(1,s-1)),children:"Prev"}),e.jsx(j,{label:`Page ${K} of ${ve}`}),e.jsx(g,{disabled:K>=ve,onClick:()=>ye(s=>Math.min(ve,s+1)),children:"Next"})]})]}),I===3&&e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs($,{sx:{p:3},children:[e.jsx(r,{variant:"h6",sx:{mb:2},children:"System Status"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(j,{label:`Overall: ${((l==null?void 0:l.overall)||"unknown").toUpperCase()}`,color:(l==null?void 0:l.overall)==="healthy"?"success":(l==null?void 0:l.overall)==="degraded"?"warning":(l==null?void 0:l.overall)==="unhealthy"?"error":"default"}),e.jsx(g,{size:"small",onClick:gs,disabled:Fe,children:Fe?"Refreshingâ€¦":"Refresh"})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(pe,{title:"Database",data:l==null?void 0:l.database})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(pe,{title:"Email (SendGrid)",data:l==null?void 0:l.email})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(pe,{title:"Payments (Stripe)",data:l==null?void 0:l.payment})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(pe,{title:"Webhooks",data:l==null?void 0:l.webhooks})})]})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs($,{sx:{p:3},children:[e.jsx(r,{variant:"h6",sx:{mb:2},children:"Recent Activity"}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Checked at: ",l!=null&&l.checkedAt?new Date(l.checkedAt).toLocaleString():"â€”"]}),(_e=l==null?void 0:l.webhooks)!=null&&_e.metrics?e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"body2",children:["Recent webhooks (24h): ",l.webhooks.metrics.recentWebhooks]}),e.jsxs(r,{variant:"body2",children:["Failed webhooks: ",l.webhooks.metrics.failedWebhooks]})]}):e.jsx(r,{variant:"body2",color:"text.secondary",children:"No metrics available"})]})]})})]})})]}),e.jsxs(he,{open:xs,onClose:()=>se(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:"Edit User"}),e.jsx(me,{children:O&&e.jsxs(d,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,label:"First Name",value:O.firstName})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,label:"Last Name",value:O.lastName})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,label:"Email",value:O.email})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(ts,{fullWidth:!0,children:[e.jsx(as,{children:"Role"}),e.jsxs(ns,{value:O.role,label:"Role",inputProps:{"aria-label":"Select user role",title:"Choose the user role"},children:[e.jsx(u,{value:"USER",children:"User"}),e.jsx(u,{value:"ADMIN",children:"Admin"})]})]})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(ts,{fullWidth:!0,children:[e.jsx(as,{children:"Status"}),e.jsxs(ns,{value:O.status,label:"Status",inputProps:{"aria-label":"Select user status",title:"Choose the user status"},children:[e.jsx(u,{value:"active",children:"Active"}),e.jsx(u,{value:"suspended",children:"Suspended"}),e.jsx(u,{value:"pending",children:"Pending"})]})]})})]})}),e.jsxs(je,{children:[e.jsx(g,{onClick:()=>se(!1),children:"Cancel"}),e.jsx(g,{onClick:ys,variant:"contained",children:"Save Changes"})]})]}),e.jsxs(he,{open:os,onClose:()=>Se(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(ue,{children:"Payment Details"}),e.jsx(me,{children:D.payment?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(j,{label:`ID: ${D.payment.id}`}),e.jsx(j,{label:`User: ${((Ke=D.payment.user)==null?void 0:Ke.email)||"â€”"}`}),e.jsx(j,{label:`Amount: $${(D.payment.amount/100).toFixed(2)}`}),e.jsx(j,{label:`Status: ${D.payment.status}`}),e.jsx(j,{label:`Date: ${new Date(D.payment.createdAt).toLocaleString()}`}),D.payment.receiptUrl&&e.jsx(g,{size:"small",variant:"outlined",onClick:()=>window.open(D.payment.receiptUrl,"_blank"),children:"View Invoice"})]}),e.jsx(r,{variant:"subtitle2",children:"Related Licenses"}),e.jsx(ce,{component:$,children:e.jsxs(oe,{size:"small",children:[e.jsx(de,{children:e.jsxs(w,{children:[e.jsx(a,{children:"License Key"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Activated"}),e.jsx(a,{children:"Expires"})]})}),e.jsx(xe,{children:(D.licenses||[]).map(s=>e.jsxs(w,{children:[e.jsx(a,{children:e.jsx(r,{variant:"body2",fontFamily:"monospace",children:s.key})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:s.status,color:Ee(String(s.status).toLowerCase())})}),e.jsx(a,{children:s.activatedAt?new Date(s.activatedAt).toLocaleDateString():"â€”"}),e.jsx(a,{children:s.expiresAt?new Date(s.expiresAt).toLocaleDateString():"â€”"})]},s.id))})]})})]}):e.jsx(r,{variant:"body2",color:"text.secondary",children:"No details."})}),e.jsx(je,{children:e.jsx(g,{onClick:()=>Se(!1),children:"Close"})})]}),e.jsxs(he,{open:hs,onClose:()=>Ce(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:"Edit License"}),e.jsx(me,{children:e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"License management options will be available here."})}),e.jsx(je,{children:e.jsx(g,{onClick:()=>Ce(!1),children:"Close"})})]}),e.jsxs(he,{open:us,onClose:()=>te(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:"Add License"}),e.jsx(me,{children:e.jsxs(d,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(b,{select:!0,fullWidth:!0,label:"User",value:R.userId,onChange:s=>Cs(s.target.value),children:V.map(s=>e.jsx(u,{value:s.id,children:s.email},s.id))})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(b,{select:!0,fullWidth:!0,label:"Subscription",value:R.subscriptionId,onChange:s=>ae(t=>({...t,subscriptionId:s.target.value})),disabled:!ze.length,children:ze.map(s=>e.jsxs(u,{value:s.id,children:[s.tier," â€” seats ",s.seats]},s.id))})}),e.jsx(d,{item:!0,xs:6,children:e.jsxs(b,{select:!0,fullWidth:!0,label:"Tier",value:R.tier,onChange:s=>ae(t=>({...t,tier:s.target.value})),children:[e.jsx(u,{value:"BASIC",children:"BASIC"}),e.jsx(u,{value:"PRO",children:"PRO"}),e.jsx(u,{value:"ENTERPRISE",children:"ENTERPRISE"})]})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(b,{fullWidth:!0,type:"number",label:"Seats",inputProps:{min:1,max:1e3},value:R.seats,onChange:s=>ae(t=>({...t,seats:Math.max(1,Math.min(1e3,parseInt(s.target.value)||1))}))})})]})}),e.jsxs(je,{children:[e.jsx(g,{onClick:()=>te(!1),children:"Cancel"}),e.jsx(g,{variant:"contained",onClick:Is,disabled:!R.userId||!R.subscriptionId,children:"Create"})]})]})]})}),e.jsx(qs,{})]})};export{nt as default};
