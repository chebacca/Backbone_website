import{j as e,a as x,b as Fs,an as Ms,T as i,h as j,G as d,k as G,l as q,av as $s,bV as Ue,aa as is,aY as Ee,c as $,aA as Os,aB as Le,u as b,v as le,I as O,bX as ls,aL as os,d as p,a4 as u,aN as Pe,aO as oe,aP as ce,aQ as U,aR as a,aS as de,aW as Bs,b8 as Ys,aD as xe,aE as ue,aG as he,aZ as cs,a_ as ds,a$ as xs,aJ as me,bY as Vs,t as us,O as _s,n as Gs}from"./mui-T5zcPaKR.js";import{u as qs,h as Ks,r as c}from"./vendor-OeuszDaU.js";import{u as Js}from"./notistack.esm-CcFOI6Un.js";import{u as Qs,c as S,e as C}from"./index-qIQj-L8L.js";import"./stripe-Bd-xCkZF.js";const pe=({title:f,data:l})=>{const je=(l==null?void 0:l.status)==="healthy"?"success":(l==null?void 0:l.status)==="degraded"?"warning":(l==null?void 0:l.status)==="unhealthy"?"error":"default";return e.jsx(G,{variant:"outlined",children:e.jsxs(q,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(i,{variant:"subtitle1",children:f}),e.jsx(j,{size:"small",label:((l==null?void 0:l.status)||"unknown").toUpperCase(),color:je})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Response time: ",(l==null?void 0:l.responseTimeMs)!=null?`${l.responseTimeMs} ms`:"â€”"]})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(i,{variant:"body2",color:"text.secondary",children:(l==null?void 0:l.message)||""})}),(l==null?void 0:l.error)&&e.jsx(d,{item:!0,xs:12,children:e.jsx(us,{severity:"warning",children:l.error})})]})]})})},at=()=>{var Xe,Ze;const{enqueueSnackbar:f}=Js(),{user:l}=Qs(),je=qs(),ge=Ks(),[R,Re]=c.useState(0),[k,B]=c.useState({totalUsers:0,activeSubscriptions:0,totalRevenue:0,pendingApprovals:0,systemHealth:"healthy"}),[K,be]=c.useState([]),[D,J]=c.useState({}),[Xs,ke]=c.useState([]),[Q,hs]=c.useState([]),[Y,fe]=c.useState(1),[ve,ms]=c.useState(1),[y,X]=c.useState({}),[ps,ye]=c.useState(!1),[E,js]=c.useState({}),[I,Z]=c.useState(null),[gs,H]=c.useState(!1),[bs,ee]=c.useState(!1),[L,Ne]=c.useState(null),[Te,We]=c.useState(0),[fs,se]=c.useState(!1),[N,te]=c.useState({userId:"",subscriptionId:"",tier:"PRO",seats:1}),[ze,Fe]=c.useState([]),[o,ae]=c.useState(null),[Me,$e]=c.useState(!1),[z,Oe]=c.useState(""),[T,Be]=c.useState(""),[Ye,Ve]=c.useState(null),[Se,_e]=c.useState(null),[Ge,re]=c.useState([]),[vs,qe]=c.useState(!1),Ce=c.useMemo(()=>{const s=z.trim().toLowerCase();return K.filter(t=>s?t.firstName.toLowerCase().includes(s)||t.lastName.toLowerCase().includes(s)||t.email.toLowerCase().includes(s)||t.role.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||t.subscription&&t.subscription.toLowerCase().includes(s):!0).filter(t=>D.role?t.role===D.role:!0).filter(t=>D.status?t.status===D.status.toLowerCase():!0).filter(t=>D.tier?(t.subscription||"").toUpperCase()===D.tier:!0)},[K,z,D]),V=s=>{if(!s)return new Date(NaN);if(typeof s=="string")return new Date(s);if(s instanceof Date)return s;if(typeof s=="object"&&s!==null){if(typeof s._seconds=="number")return new Date(s._seconds*1e3);if(typeof s.seconds=="number")return new Date(s.seconds*1e3);if(typeof s.toDate=="function")try{return s.toDate()}catch{}}return new Date(s)},Ke=s=>`$${((typeof s=="number"?s:0)/100).toFixed(2)}`,Ie=c.useMemo(()=>{if(!T.trim())return Q;const s=T.toLowerCase();return Q.filter(t=>{var r,n;return t.id.toLowerCase().includes(s)||((r=t.user)==null?void 0:r.email)&&t.user.email.toLowerCase().includes(s)||((n=t.subscription)==null?void 0:n.tier)&&t.subscription.tier.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||V(t.createdAt).toLocaleDateString().toLowerCase().includes(s)||Ke(t.amount).toLowerCase().includes(s)})},[Q,T]),ys=()=>Oe(""),Ss=()=>Be(""),Cs=async(s,t)=>{var r,n,h;Ve(s.currentTarget),_e(t),re([]),qe(!0);try{const F=(((h=(n=(r=(await S.get(C.admin.userDetails(t.id))).data)==null?void 0:r.data)==null?void 0:n.user)==null?void 0:h.subscriptions)||[]).flatMap(P=>(P.licenses||[]).map(v=>({id:v.id,key:v.key,userId:v.userId||t.id,userEmail:t.email,tier:v.tier,status:String(v.status||"").toLowerCase(),activatedAt:new Date(V(v.activatedAt||v.createdAt)).toISOString(),expiresAt:new Date(V(v.expiresAt||v.createdAt)).toISOString(),lastUsed:new Date(V(v.updatedAt||v.createdAt)).toISOString()}))).sort((P,v)=>{const _=P.status==="active"?0:1,ne=v.status==="active"?0:1;return _!==ne?_-ne:new Date(v.activatedAt).getTime()-new Date(P.activatedAt).getTime()});re(F)}catch(m){f((m==null?void 0:m.message)||"Failed to load licenses",{variant:"error"}),re([])}finally{qe(!1)}},Is=()=>{Ve(null),_e(null),re([])};c.useEffect(()=>{let s=!0;return(async()=>{var t,r,n,h,m,g,A;try{if(String((l==null?void 0:l.role)||"").toUpperCase()!=="SUPERADMIN"){be([]),B(w=>({...w,systemHealth:"warning"}));return}const[P,v,_,ne]=await Promise.all([S.get(`${C.admin.users()}?page=1&limit=100`),S.get(C.admin.paymentAnalytics()),S.get(C.admin.systemHealth()),S.get(C.admin.dashboardStats())]),He=((r=(t=P.data)==null?void 0:t.data)==null?void 0:r.users)??[],M=((h=(n=ne.data)==null?void 0:n.data)==null?void 0:h.stats)??{totalRevenue:0,activeSubscriptions:0},zs=(M==null?void 0:M.recentPayments)??[],W=((g=(m=_.data)==null?void 0:m.data)==null?void 0:g.health)||((A=_.data)==null?void 0:A.data),es=(W==null?void 0:W.overall)||(W==null?void 0:W.status)||"healthy";if(!s)return;be(He.map(w=>{var ss,ts,ie,as,rs,ns;return{id:w.id,email:w.email,firstName:((ss=w.name)==null?void 0:ss.split(" ")[0])??"",lastName:((ts=w.name)==null?void 0:ts.split(" ").slice(1).join(" "))??"",role:w.role,status:((as=(ie=w.status)==null?void 0:ie.toLowerCase)==null?void 0:as.call(ie))||"active",subscription:((ns=(rs=w.subscriptions)==null?void 0:rs[0])==null?void 0:ns.tier)??void 0,lastLogin:w.lastLoginAt||new Date().toISOString(),createdAt:w.createdAt||new Date().toISOString()}})),B({totalUsers:Number(M.totalUsers||He.length)||0,activeSubscriptions:M.activeSubscriptions??0,totalRevenue:Math.round(M.totalRevenue??0)/100,pendingApprovals:0,systemHealth:es==="healthy"?"healthy":es==="degraded"?"warning":"error"}),ae(W||null),ke(zs)}catch{if(!s)return;be([]),B(P=>({...P,systemHealth:"error"})),ke([]),ae(null)}})(),()=>{s=!1}},[l==null?void 0:l.role]);const ws=async()=>{var s,t,r;try{$e(!0);const n=await S.get(C.admin.systemHealth()),h=((t=(s=n.data)==null?void 0:s.data)==null?void 0:t.health)||((r=n.data)==null?void 0:r.data);ae(h||null);const m=(h==null?void 0:h.overall)||"healthy";B(g=>({...g,systemHealth:m==="healthy"?"healthy":m==="degraded"?"warning":"error"}))}catch{ae(null),B(n=>({...n,systemHealth:"error"}))}finally{$e(!1)}},Je=async(s=1)=>{var m,g,A,F;const t=new URLSearchParams;t.set("page",String(s)),t.set("limit","100"),y.status&&t.set("status",y.status),y.email&&t.set("email",y.email),y.from&&t.set("from",y.from),y.to&&t.set("to",y.to);const r=await S.get(`${C.admin.payments()}?${t.toString()}`),n=((g=(m=r.data)==null?void 0:m.data)==null?void 0:g.payments)??[],h=((F=(A=r.data)==null?void 0:A.data)==null?void 0:F.pagination)??{pages:1,page:1};hs(n),fe(h.page||s),ms(h.pages||1)};c.useEffect(()=>{String((l==null?void 0:l.role)||"").toUpperCase()==="SUPERADMIN"&&R===1&&Je(Y).catch(()=>{})},[R,Y,y,l==null?void 0:l.role]);const Ds=async s=>{var t;try{const n=((t=(await S.get(C.admin.paymentDetails(s))).data)==null?void 0:t.data)||{};js({payment:n.payment,licenses:n.licenses||[]}),ye(!0)}catch{f("Failed to load payment details",{variant:"error"})}},As=s=>{Z(s),H(!0)},Us=async()=>{var s,t;try{if(!I)return;await S.put(C.admin.updateUser(I.id),{role:I.role,status:I.status.toUpperCase()}),f("User updated successfully",{variant:"success"}),H(!1),Z(null)}catch(r){f(((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Failed to update user",{variant:"error"})}},Qe=async s=>{var t,r,n;try{const g=(((n=(r=(t=(await S.get(C.admin.userDetails(s.id))).data)==null?void 0:t.data)==null?void 0:r.user)==null?void 0:n.subscriptions)||[]).find(A=>A.status==="ACTIVE"&&(String(A.tier).toUpperCase()==="PRO"||String(A.tier).toUpperCase()==="ENTERPRISE"));if(!g){f("No active PRO/ENTERPRISE subscription for this user",{variant:"warning"});return}Ne({id:g.id,tier:String(g.tier).toUpperCase(),seats:Number(g.seats||0)}),We(Number(g.seats||0)),ee(!0)}catch(h){f((h==null?void 0:h.message)||"Failed to load subscription",{variant:"error"})}},Es=async()=>{var s,t;if(L)try{const r=L.tier,n=Number(Te||0);if(r==="BASIC"&&n!==1){f("Basic plan supports exactly 1 seat.",{variant:"warning"});return}if(r==="PRO"&&(n<1||n>50)){f("Pro plan seats must be between 1 and 50.",{variant:"warning"});return}if(r==="ENTERPRISE"&&n<10){f("Enterprise requires minimum 10 seats.",{variant:"warning"});return}await S.put(C.subscriptions.update(L.id),{seats:n}),Ne({...L,seats:n}),f("Seats updated successfully",{variant:"success"}),ee(!1)}catch(r){f(((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Failed to update seats",{variant:"error"})}},Ls=async()=>{se(!0)},Ps=async s=>{var t,r,n;if(te(h=>({...h,userId:s,subscriptionId:""})),s){const m=((n=(r=(t=(await S.get(C.admin.userDetails(s))).data)==null?void 0:t.data)==null?void 0:r.user)==null?void 0:n.subscriptions)||[];Fe(m.filter(g=>g.status==="ACTIVE"))}else Fe([])},Rs=async()=>{try{await S.post(C.admin.createLicense(),N),f("License(s) created",{variant:"success"}),se(!1)}catch(s){f((s==null?void 0:s.message)||"Failed to create license",{variant:"error"})}},we=s=>{switch(s){case"active":return"success";case"pending":return"warning";case"suspended":return"error";default:return"default"}},ks=s=>{switch(String(s||"").toUpperCase()){case"SUPERADMIN":return"secondary";case"ADMIN":return"primary";default:return"default"}},De=s=>{switch(String(s||"").toUpperCase()){case"ENTERPRISE":return"secondary";case"PRO":return"success";case"BASIC":return"default";default:return"default"}},Ae=s=>String(s||"").toUpperCase()==="BASIC"?"outlined":"filled",Ns=s=>{switch(s){case"healthy":return"success";case"warning":return"warning";case"error":return"error";default:return"default"}},Ts=s=>{switch(s){case"healthy":return e.jsx(Gs,{});case"warning":return e.jsx(Ee,{});case"error":return e.jsx(_s,{});default:return e.jsx(Ee,{})}};c.useEffect(()=>{const s=(ge.hash||"").toLowerCase(),t={"#users":0,"#licenses":0,"#invoices":1,"#system":2,"#system-health":2};s&&t[s]!=null&&t[s]!==R&&Re(t[s])},[ge.hash]);const Ws=(s,t)=>{Re(t);const n={0:"users",1:"invoices",2:"system"}[t]||"users";(ge.hash||"").toLowerCase()!==`#${n}`&&je(`/admin#${n}`,{replace:!0})};return e.jsx(e.Fragment,{children:e.jsx(x,{sx:{pb:4},children:e.jsxs(Fs,{maxWidth:"xl",children:[e.jsxs(x,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards","@keyframes fadeInUp":{"0%":{opacity:0,transform:"translateY(20px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:4},children:[e.jsx(Ms,{sx:{fontSize:32,color:"primary.main"}}),e.jsx(i,{variant:"h4",sx:{fontWeight:700},children:"Admin Dashboard"}),e.jsx(j,{icon:Ts(k.systemHealth),label:`System ${k.systemHealth}`,color:Ns(k.systemHealth),size:"small"})]}),e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(x,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.1s forwards"},children:e.jsx(G,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(q,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx($s,{sx:{color:"primary.main"}}),e.jsx(i,{variant:"h6",color:"text.secondary",children:"Total Users"})]}),e.jsx(i,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:k.totalUsers.toLocaleString()})]})})})}),e.jsx(d,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(x,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.2s forwards"},children:e.jsx(G,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(q,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Ue,{sx:{color:"secondary.main"}}),e.jsx(i,{variant:"h6",color:"text.secondary",children:"Active Subscriptions"})]}),e.jsx(i,{variant:"h3",sx:{fontWeight:700},children:k.activeSubscriptions.toLocaleString()})]})})})}),e.jsx(d,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(x,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.3s forwards"},children:e.jsx(G,{sx:{background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(139, 195, 74, 0.1) 100%)",border:"1px solid rgba(76, 175, 80, 0.2)"},children:e.jsxs(q,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(is,{sx:{color:"success.main"}}),e.jsx(i,{variant:"h6",color:"text.secondary",children:"Total Revenue"})]}),e.jsxs(i,{variant:"h3",sx:{fontWeight:700,color:"success.main"},children:["$",k.totalRevenue.toLocaleString()]})]})})})}),e.jsx(d,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(x,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.4s forwards"},children:e.jsx(G,{sx:{background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 193, 7, 0.1) 100%)",border:"1px solid rgba(255, 152, 0, 0.2)"},children:e.jsxs(q,{children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Ee,{sx:{color:"warning.main"}}),e.jsx(i,{variant:"h6",color:"text.secondary",children:"Pending Approvals"})]}),e.jsx(i,{variant:"h3",sx:{fontWeight:700,color:"warning.main"},children:k.pendingApprovals})]})})})})]}),e.jsx($,{sx:{mb:3},children:e.jsxs(Os,{value:R,onChange:Ws,sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontWeight:600}},children:[e.jsx(Le,{label:"Users/Licenses"}),e.jsx(Le,{label:"Invoices"}),e.jsx(Le,{label:"System Health"})]})}),R===0&&e.jsxs(x,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{placeholder:"Search users by name, email, role, status, or subscription...",value:z,onChange:s=>Oe(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(le,{position:"start",children:e.jsx(os,{})}),endAdornment:z&&e.jsx(le,{position:"end",children:e.jsx(O,{size:"small",onClick:ys,children:e.jsx(ls,{})})})}}),z&&e.jsx(j,{label:`${Ce.length} of ${K.length} users found`,color:"primary",variant:"outlined"}),e.jsx(p,{variant:"contained",onClick:Ls,children:"Add License"})]}),e.jsxs(x,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsxs(b,{label:"Role",select:!0,size:"small",value:D.role||"",onChange:s=>J(t=>({...t,role:s.target.value||void 0})),children:[e.jsx(u,{value:"",children:"All"}),e.jsx(u,{value:"USER",children:"USER"}),e.jsx(u,{value:"ADMIN",children:"ADMIN"}),e.jsx(u,{value:"SUPERADMIN",children:"SUPERADMIN"})]}),e.jsxs(b,{label:"Status",select:!0,size:"small",value:D.status||"",onChange:s=>J(t=>({...t,status:s.target.value||void 0})),children:[e.jsx(u,{value:"",children:"All"}),e.jsx(u,{value:"active",children:"ACTIVE"}),e.jsx(u,{value:"suspended",children:"SUSPENDED"})]}),e.jsxs(b,{label:"Subscription Tier",select:!0,size:"small",value:D.tier||"",onChange:s=>J(t=>({...t,tier:s.target.value||void 0})),children:[e.jsx(u,{value:"",children:"All"}),e.jsx(u,{value:"BASIC",children:"BASIC"}),e.jsx(u,{value:"PRO",children:"PRO"}),e.jsx(u,{value:"ENTERPRISE",children:"ENTERPRISE"})]}),e.jsx(p,{variant:"outlined",children:"Apply Filters"}),e.jsx(p,{onClick:()=>J({}),children:"Clear"})]})]}),e.jsx(Pe,{component:$,children:e.jsxs(oe,{children:[e.jsx(ce,{children:e.jsxs(U,{children:[e.jsx(a,{children:"User"}),e.jsx(a,{children:"Role"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Subscription"}),e.jsx(a,{children:"Last Login"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(de,{children:Ce.length>0?Ce.map(s=>e.jsxs(U,{children:[e.jsx(a,{children:e.jsxs(x,{children:[e.jsxs(i,{variant:"subtitle2",children:[s.firstName," ",s.lastName]}),e.jsx(i,{variant:"body2",color:"text.secondary",children:s.email})]})}),e.jsx(a,{children:e.jsx(j,{label:s.role,size:"small",color:ks(s.role)})}),e.jsx(a,{children:e.jsx(j,{label:s.status,size:"small",color:we(s.status)})}),e.jsx(a,{children:s.subscription&&e.jsx(j,{label:s.subscription,size:"small",color:De(s.subscription),variant:Ae(s.subscription)})}),e.jsx(a,{children:e.jsx(i,{variant:"body2",children:new Date(s.lastLogin).toLocaleDateString()})}),e.jsxs(a,{children:[e.jsx(O,{size:"small",onClick:()=>As(s),children:e.jsx(Bs,{})}),e.jsx(O,{size:"small",onClick:t=>Cs(t,s),title:"View user licenses",children:e.jsx(Ue,{})}),e.jsx(O,{size:"small",onClick:()=>Qe(s),title:"Manage seats",children:e.jsx(is,{})}),e.jsx(O,{size:"small",color:"error",children:e.jsx(Ys,{})})]})]},s.id)):e.jsx(U,{children:e.jsx(a,{colSpan:6,align:"center",children:e.jsx(x,{sx:{py:4},children:e.jsx(i,{variant:"body1",color:"text.secondary",children:z?"No users found matching your search criteria.":"No users available."})})})})})]})})]}),R===1&&e.jsxs(x,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{placeholder:"Search payments by ID, email, tier, status, amount, or date...",value:T,onChange:s=>Be(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(le,{position:"start",children:e.jsx(os,{})}),endAdornment:T&&e.jsx(le,{position:"end",children:e.jsx(O,{size:"small",onClick:Ss,children:e.jsx(ls,{})})})}}),T&&e.jsx(j,{label:`${Ie.length} of ${Q.length} payments found`,color:"primary",variant:"outlined"})]}),e.jsxs(x,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(b,{label:"Filter by Email",size:"small",value:y.email||"",onChange:s=>X(t=>({...t,email:s.target.value}))}),e.jsx(b,{label:"From",size:"small",type:"date",InputLabelProps:{shrink:!0},value:y.from||"",onChange:s=>X(t=>({...t,from:s.target.value}))}),e.jsx(b,{label:"To",size:"small",type:"date",InputLabelProps:{shrink:!0},value:y.to||"",onChange:s=>X(t=>({...t,to:s.target.value}))}),e.jsxs(b,{label:"Status",select:!0,size:"small",value:y.status||"",onChange:s=>X(t=>({...t,status:s.target.value||void 0})),sx:{minWidth:160},children:[e.jsx(u,{value:"",children:"All"}),e.jsx(u,{value:"SUCCEEDED",children:"SUCCEEDED"}),e.jsx(u,{value:"PENDING",children:"PENDING"}),e.jsx(u,{value:"FAILED",children:"FAILED"}),e.jsx(u,{value:"REFUNDED",children:"REFUNDED"})]}),e.jsx(p,{variant:"outlined",onClick:()=>Je(1),children:"Apply Filters"})]})]}),e.jsx(Pe,{component:$,children:e.jsxs(oe,{children:[e.jsx(ce,{children:e.jsxs(U,{children:[e.jsx(a,{children:"Payment ID"}),e.jsx(a,{children:"User"}),e.jsx(a,{children:"Tier"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Invoice"}),e.jsx(a,{children:"Details"})]})}),e.jsx(de,{children:Ie.length>0?Ie.map(s=>{var t,r,n,h;return e.jsxs(U,{children:[e.jsx(a,{children:e.jsx(i,{variant:"body2",fontFamily:"monospace",children:s.id})}),e.jsx(a,{children:e.jsx(i,{variant:"body2",children:((t=s.user)==null?void 0:t.email)||"â€”"})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:((r=s.subscription)==null?void 0:r.tier)||"â€”",color:De((n=s.subscription)==null?void 0:n.tier),variant:Ae((h=s.subscription)==null?void 0:h.tier)})}),e.jsx(a,{children:e.jsx(i,{variant:"body2",children:Ke(s.amount)})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:s.status,color:s.status==="SUCCEEDED"?"success":s.status==="FAILED"?"error":"default"})}),e.jsx(a,{children:e.jsx(i,{variant:"body2",children:V(s.createdAt).toLocaleDateString()})}),e.jsx(a,{children:s.stripeInvoiceId?e.jsx(p,{size:"small",variant:"outlined",onClick:()=>{const m=localStorage.getItem("auth_token"),g=`/api/invoices/${s.stripeInvoiceId}/pdf${m?`?token=${encodeURIComponent(m)}`:""}`;window.open(g,"_blank")},children:"View"}):s.receiptUrl?e.jsx(p,{size:"small",variant:"outlined",onClick:()=>window.open(s.receiptUrl,"_blank"),children:"View"}):e.jsx(i,{variant:"body2",color:"text.secondary",children:"N/A"})}),e.jsx(a,{children:e.jsx(p,{size:"small",onClick:()=>Ds(s.id),children:"Open"})})]},s.id)}):e.jsx(U,{children:e.jsx(a,{colSpan:8,align:"center",children:e.jsx(x,{sx:{py:4},children:e.jsx(i,{variant:"body1",color:"text.secondary",children:T?"No payments found matching your search criteria.":"No payments available."})})})})})]})}),e.jsxs(x,{sx:{display:"flex",gap:1,justifyContent:"flex-end",mt:2},children:[e.jsx(p,{disabled:Y<=1,onClick:()=>fe(s=>Math.max(1,s-1)),children:"Prev"}),e.jsx(j,{label:`Page ${Y} of ${ve}`}),e.jsx(p,{disabled:Y>=ve,onClick:()=>fe(s=>Math.min(ve,s+1)),children:"Next"})]})]}),R===2&&e.jsx(x,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs($,{sx:{p:3},children:[e.jsx(i,{variant:"h6",sx:{mb:2},children:"System Status"}),e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(j,{label:`Overall: ${((o==null?void 0:o.overall)||"unknown").toUpperCase()}`,color:(o==null?void 0:o.overall)==="healthy"?"success":(o==null?void 0:o.overall)==="degraded"?"warning":(o==null?void 0:o.overall)==="unhealthy"?"error":"default"}),e.jsx(p,{size:"small",onClick:ws,disabled:Me,children:Me?"Refreshingâ€¦":"Refresh"})]}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(pe,{title:"Database",data:o==null?void 0:o.database})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(pe,{title:"Email (SendGrid)",data:o==null?void 0:o.email})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(pe,{title:"Payments (Stripe)",data:o==null?void 0:o.payment})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(pe,{title:"Webhooks",data:o==null?void 0:o.webhooks})})]})]})}),e.jsx(d,{item:!0,xs:12,md:6,children:e.jsxs($,{sx:{p:3},children:[e.jsx(i,{variant:"h6",sx:{mb:2},children:"Recent Activity"}),e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Checked at: ",o!=null&&o.checkedAt?new Date(o.checkedAt).toLocaleString():"â€”"]}),(Xe=o==null?void 0:o.webhooks)!=null&&Xe.metrics?e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"body2",children:["Recent webhooks (24h): ",o.webhooks.metrics.recentWebhooks]}),e.jsxs(i,{variant:"body2",children:["Failed webhooks: ",o.webhooks.metrics.failedWebhooks]})]}):e.jsx(i,{variant:"body2",color:"text.secondary",children:"No metrics available"})]})]})})]})})]}),e.jsxs(xe,{open:gs,onClose:()=>H(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:"Edit User"}),e.jsx(he,{children:I&&e.jsxs(d,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,label:"First Name",value:I.firstName,disabled:!0})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,label:"Last Name",value:I.lastName,disabled:!0})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,label:"Email",value:I.email,disabled:!0})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(cs,{fullWidth:!0,children:[e.jsx(ds,{children:"Role"}),e.jsxs(xs,{value:I.role,label:"Role",inputProps:{"aria-label":"Select user role",title:"Choose the user role"},onChange:s=>Z(t=>t&&{...t,role:String(s.target.value)}),children:[e.jsx(u,{value:"USER",children:"User"}),e.jsx(u,{value:"ADMIN",children:"Admin"}),e.jsx(u,{value:"SUPERADMIN",children:"SUPERADMIN"})]})]})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(cs,{fullWidth:!0,children:[e.jsx(ds,{children:"Status"}),e.jsxs(xs,{value:I.status,label:"Status",inputProps:{"aria-label":"Select user status",title:"Choose the user status"},onChange:s=>Z(t=>t&&{...t,status:String(s.target.value)}),children:[e.jsx(u,{value:"active",children:"Active"}),e.jsx(u,{value:"suspended",children:"Suspended"}),e.jsx(u,{value:"pending",children:"Pending"})]})]})})]})}),e.jsxs(me,{children:[e.jsx(p,{onClick:()=>H(!1),children:"Cancel"}),I&&e.jsx(p,{onClick:()=>Qe(I),children:"Manage Seats"}),e.jsx(p,{onClick:Us,variant:"contained",children:"Save Changes"})]})]}),e.jsxs(xe,{open:ps,onClose:()=>ye(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(ue,{children:"Payment Details"}),e.jsx(he,{children:E.payment?e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(x,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(j,{label:`ID: ${E.payment.id}`}),e.jsx(j,{label:`User: ${((Ze=E.payment.user)==null?void 0:Ze.email)||"â€”"}`}),e.jsx(j,{label:`Amount: $${(E.payment.amount/100).toFixed(2)}`}),e.jsx(j,{label:`Status: ${E.payment.status}`}),e.jsx(j,{label:`Date: ${new Date(E.payment.createdAt).toLocaleString()}`}),E.payment.receiptUrl&&e.jsx(p,{size:"small",variant:"outlined",onClick:()=>window.open(E.payment.receiptUrl,"_blank"),children:"View Invoice"})]}),e.jsx(i,{variant:"subtitle2",children:"Related Licenses"}),e.jsx(Pe,{component:$,children:e.jsxs(oe,{size:"small",children:[e.jsx(ce,{children:e.jsxs(U,{children:[e.jsx(a,{children:"License Key"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Activated"}),e.jsx(a,{children:"Expires"})]})}),e.jsx(de,{children:(E.licenses||[]).map(s=>e.jsxs(U,{children:[e.jsx(a,{children:e.jsx(i,{variant:"body2",fontFamily:"monospace",children:s.key})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:s.status,color:we(String(s.status).toLowerCase())})}),e.jsx(a,{children:s.activatedAt?new Date(s.activatedAt).toLocaleDateString():"â€”"}),e.jsx(a,{children:s.expiresAt?new Date(s.expiresAt).toLocaleDateString():"â€”"})]},s.id))})]})})]}):e.jsx(i,{variant:"body2",color:"text.secondary",children:"No details."})}),e.jsx(me,{children:e.jsx(p,{onClick:()=>ye(!1),children:"Close"})})]}),e.jsxs(Vs,{open:!!Ye,anchorEl:Ye,onClose:Is,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{p:2,maxWidth:560}},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(Ue,{fontSize:"small",color:"action"}),e.jsx(i,{variant:"subtitle1",children:(Se==null?void 0:Se.email)||"Licenses"})]}),vs?e.jsx(i,{variant:"body2",color:"text.secondary",children:"Loading..."}):Ge.length>0?e.jsxs(oe,{size:"small",children:[e.jsx(ce,{children:e.jsxs(U,{children:[e.jsx(a,{children:"License Key"}),e.jsx(a,{children:"Tier"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Expires"})]})}),e.jsx(de,{children:Ge.map(s=>e.jsxs(U,{children:[e.jsx(a,{children:e.jsx(i,{variant:"body2",fontFamily:"monospace",children:s.key})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:s.tier,color:De(s.tier),variant:Ae(s.tier)})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:s.status,color:we(s.status)})}),e.jsx(a,{children:e.jsx(i,{variant:"body2",children:new Date(s.expiresAt).toLocaleDateString()})})]},s.id))})]}):e.jsx(i,{variant:"body2",color:"text.secondary",children:"No licenses found for this user."})]}),e.jsxs(xe,{open:fs,onClose:()=>se(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:"Add License"}),e.jsx(he,{children:e.jsxs(d,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(d,{item:!0,xs:12,children:e.jsx(b,{select:!0,fullWidth:!0,label:"User",value:N.userId,onChange:s=>Ps(s.target.value),children:K.map(s=>e.jsx(u,{value:s.id,children:s.email},s.id))})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(b,{select:!0,fullWidth:!0,label:"Subscription",value:N.subscriptionId,onChange:s=>te(t=>({...t,subscriptionId:s.target.value})),disabled:!ze.length,children:ze.map(s=>e.jsxs(u,{value:s.id,children:[s.tier," â€” seats ",s.seats]},s.id))})}),e.jsx(d,{item:!0,xs:6,children:e.jsxs(b,{select:!0,fullWidth:!0,label:"Tier",value:N.tier,onChange:s=>te(t=>({...t,tier:s.target.value})),children:[e.jsx(u,{value:"BASIC",children:"BASIC"}),e.jsx(u,{value:"PRO",children:"PRO"}),e.jsx(u,{value:"ENTERPRISE",children:"ENTERPRISE"})]})}),e.jsx(d,{item:!0,xs:6,children:e.jsx(b,{fullWidth:!0,type:"number",label:"Seats",inputProps:{min:1,max:1e3},value:N.seats,onChange:s=>te(t=>({...t,seats:Math.max(1,Math.min(1e3,parseInt(s.target.value)||1))}))})})]})}),e.jsxs(me,{children:[e.jsx(p,{onClick:()=>se(!1),children:"Cancel"}),e.jsx(p,{variant:"contained",onClick:Rs,disabled:!N.userId||!N.subscriptionId,children:"Create"})]})]}),e.jsxs(xe,{open:bs,onClose:()=>ee(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(ue,{children:"Manage Seats"}),e.jsx(he,{children:L?e.jsxs(d,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(d,{item:!0,xs:12,children:e.jsxs(us,{severity:"info",children:[L.tier," subscription"]})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,type:"number",label:"Total Seats",value:Te,onChange:s=>We(parseInt(s.target.value||"0",10)),inputProps:{min:1,max:L.tier==="PRO"?50:1e3}})})]}):e.jsx(i,{variant:"body2",color:"text.secondary",children:"No active subscription found."})}),e.jsxs(me,{children:[e.jsx(p,{onClick:()=>ee(!1),children:"Cancel"}),e.jsx(p,{onClick:Es,variant:"contained",disabled:!L,children:"Save"})]})]})]})})})};export{at as default};
