import{j as e,a as c,b as Hs,an as Js,T as x,h as m,G as h,k as K,l as q,av as Qs,bV as Zs,aa as js,aY as Be,c as Y,aA as et,aB as je,u as b,v as G,I as k,bX as Ye,aL as Ve,d as g,a4 as o,aN as ge,aO as be,aP as fe,aQ as L,aR as n,aS as ve,aW as gs,b8 as st,w as tt,a1 as at,bY as rt,z as nt,as as it,aD as se,aE as te,aG as ae,aZ as bs,a_ as fs,a$ as vs,aJ as re,t as ys,O as lt,n as ct}from"./mui-DfoTb_nB.js";import{u as ot,h as dt,r as d}from"./vendor-OeuszDaU.js";import{u as xt}from"./notistack.esm-CcFOI6Un.js";import{u as ut,c as v,e as y}from"./index-Bmi2br--.js";import"./stripe-DEPCLfU9.js";const ye=({title:C,data:l})=>{const Se=(l==null?void 0:l.status)==="healthy"?"success":(l==null?void 0:l.status)==="degraded"?"warning":(l==null?void 0:l.status)==="unhealthy"?"error":"default";return e.jsx(K,{variant:"outlined",children:e.jsxs(q,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(x,{variant:"subtitle1",children:C}),e.jsx(m,{size:"small",label:((l==null?void 0:l.status)||"unknown").toUpperCase(),color:Se})]}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Response time: ",(l==null?void 0:l.responseTimeMs)!=null?`${l.responseTimeMs} ms`:"—"]})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(x,{variant:"body2",color:"text.secondary",children:(l==null?void 0:l.message)||""})}),(l==null?void 0:l.error)&&e.jsx(h,{item:!0,xs:12,children:e.jsx(ys,{severity:"warning",children:l.error})})]})]})})},ft=()=>{var cs,os;const{enqueueSnackbar:C}=xt(),{user:l}=ut(),Se=ot(),Ce=dt(),[E,_e]=d.useState(0),[W,X]=d.useState({totalUsers:0,activeSubscriptions:0,totalRevenue:0,pendingApprovals:0,systemHealth:"healthy"}),[V,Ie]=d.useState([]),[we,H]=d.useState([]),[A,ne]=d.useState({}),[$,De]=d.useState({}),[ht,Ge]=d.useState([]),[ie,Ss]=d.useState([]),[J,Ee]=d.useState(1),[Ae,Cs]=d.useState(1),[I,le]=d.useState({}),[Is,Ue]=d.useState(!1),[R,ws]=d.useState({}),[U,Ke]=d.useState(null),[Ds,ce]=d.useState(!1),[Es,Le]=d.useState(!1),[As,oe]=d.useState(!1),[N,qe]=d.useState(null),[Xe,He]=d.useState(0),[Us,de]=d.useState(!1),[F,xe]=d.useState({userId:"",subscriptionId:"",tier:"PRO",seats:1}),[Je,Qe]=d.useState([]),[u,ue]=d.useState(null),[Ze,es]=d.useState(!1),[_,ss]=d.useState(""),[T,ts]=d.useState(""),[M,as]=d.useState(""),[rs,Ls]=d.useState(new Set),[Re,Rs]=d.useState(!1),Pe=d.useMemo(()=>{const s=_.trim().toLowerCase();return V.filter(t=>s?t.firstName.toLowerCase().includes(s)||t.lastName.toLowerCase().includes(s)||t.email.toLowerCase().includes(s)||t.role.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||t.subscription&&t.subscription.toLowerCase().includes(s):!0).filter(t=>A.role?t.role===A.role:!0).filter(t=>A.status?t.status===A.status.toLowerCase():!0).filter(t=>A.tier?(t.subscription||"").toUpperCase()===A.tier:!0)},[V,_,A]),ke=d.useMemo(()=>{if(!T.trim())return we;const s=T.toLowerCase();return we.filter(t=>t.key.toLowerCase().includes(s)||t.userEmail.toLowerCase().includes(s)||t.tier.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||new Date(t.expiresAt).toLocaleDateString().includes(s)||new Date(t.activatedAt).toLocaleDateString().includes(s))},[we,T]),Ne=d.useMemo(()=>{const s=new Map;ke.forEach(r=>{const i=s.get(r.userId)||[];i.push(r),s.set(r.userId,i)});const t=V.map(r=>{const i=s.get(r.id)||[],p=i.filter(j=>j.status==="active").length;return{userId:r.id,userEmail:r.email,licenses:i,totalLicenses:i.length,activeLicenses:p}});return(Re?t:t.filter(r=>r.totalLicenses>0)).sort((r,i)=>r.userEmail.localeCompare(i.userEmail))},[V,ke,Re]),Q=s=>{if(!s)return new Date(NaN);if(typeof s=="string")return new Date(s);if(s instanceof Date)return s;if(typeof s=="object"&&s!==null){if(typeof s._seconds=="number")return new Date(s._seconds*1e3);if(typeof s.seconds=="number")return new Date(s.seconds*1e3);if(typeof s.toDate=="function")try{return s.toDate()}catch{}}return new Date(s)},ns=s=>`$${((typeof s=="number"?s:0)/100).toFixed(2)}`,Te=d.useMemo(()=>{if(!M.trim())return ie;const s=M.toLowerCase();return ie.filter(t=>{var a,r;return t.id.toLowerCase().includes(s)||((a=t.user)==null?void 0:a.email)&&t.user.email.toLowerCase().includes(s)||((r=t.subscription)==null?void 0:r.tier)&&t.subscription.tier.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||Q(t.createdAt).toLocaleDateString().toLowerCase().includes(s)||ns(t.amount).toLowerCase().includes(s)})},[ie,M]),Ps=()=>ss(""),is=()=>ts(""),ks=()=>as(""),Ns=s=>{Ls(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})};d.useEffect(()=>{let s=!0;return(async()=>{var t,a,r,i,p,j,w,z,Z;try{if(String((l==null?void 0:l.role)||"").toUpperCase()!=="SUPERADMIN"){Ie([]),H([]),X(D=>({...D,systemHealth:"warning"}));return}const[S,O,he,Me,ee]=await Promise.all([v.get(`${y.admin.users()}?page=1&limit=100`),v.get(`${y.admin.licenses()}?page=1&limit=100`),v.get(y.admin.paymentAnalytics()),v.get(y.admin.systemHealth()),v.get(y.admin.dashboardStats())]),me=((a=(t=S.data)==null?void 0:t.data)==null?void 0:a.users)??[],Oe=((i=(r=O.data)==null?void 0:r.data)==null?void 0:i.licenses)??[],P=((j=(p=ee.data)==null?void 0:p.data)==null?void 0:j.stats)??{totalRevenue:0,activeSubscriptions:0},Xs=(P==null?void 0:P.recentPayments)??[],B=((z=(w=Me.data)==null?void 0:w.data)==null?void 0:z.health)||((Z=Me.data)==null?void 0:Z.data),ds=(B==null?void 0:B.overall)||(B==null?void 0:B.status)||"healthy";if(!s)return;Ie(me.map(D=>{var xs,us,pe,hs,ms,ps;return{id:D.id,email:D.email,firstName:((xs=D.name)==null?void 0:xs.split(" ")[0])??"",lastName:((us=D.name)==null?void 0:us.split(" ").slice(1).join(" "))??"",role:D.role,status:((hs=(pe=D.status)==null?void 0:pe.toLowerCase)==null?void 0:hs.call(pe))||"active",subscription:((ps=(ms=D.subscriptions)==null?void 0:ms[0])==null?void 0:ps.tier)??void 0,lastLogin:D.lastLoginAt||new Date().toISOString(),createdAt:D.createdAt||new Date().toISOString()}})),H([]),X({totalUsers:Number(P.totalUsers||me.length)||0,activeSubscriptions:P.activeSubscriptions??0,totalRevenue:Math.round(P.totalRevenue??0)/100,pendingApprovals:0,systemHealth:ds==="healthy"?"healthy":ds==="degraded"?"warning":"error"}),ue(B||null),Ge(Xs)}catch{if(!s)return;Ie([]),H([]),X(S=>({...S,systemHealth:"error"})),Ge([]),ue(null)}})(),()=>{s=!1}},[l==null?void 0:l.role]);const ze=async()=>{var j,w,z,Z;const s=f=>{const S=new URLSearchParams;return S.set("page",String(f)),S.set("limit","100"),$.tier&&S.set("tier",String($.tier)),$.status&&S.set("status",String($.status)),S.toString()},t=await v.get(`${y.admin.licenses()}?${s(1)}`),a=((w=(j=t.data)==null?void 0:j.data)==null?void 0:w.licenses)??[],r=((Z=(z=t.data)==null?void 0:z.data)==null?void 0:Z.pagination)??{pages:1},i=Math.max(1,Number(r.pages)||1);let p=[...a];if(i>1){const f=Array.from({length:i-1},(O,he)=>he+2),S=5;for(let O=0;O<f.length;O+=S){const he=f.slice(O,O+S);(await Promise.all(he.map(ee=>v.get(`${y.admin.licenses()}?${s(ee)}`)))).forEach(ee=>{var Oe,P;const me=((P=(Oe=ee.data)==null?void 0:Oe.data)==null?void 0:P.licenses)??[];p=p.concat(me)})}}H(p.map(f=>{var S;return{id:f.id,key:f.key,userId:f.userId,userEmail:((S=f.user)==null?void 0:S.email)??"",tier:f.tier,status:String(f.status||"").toLowerCase(),activatedAt:new Date(Q(f.activatedAt||f.createdAt)).toISOString(),expiresAt:new Date(Q(f.expiresAt||f.createdAt)).toISOString(),lastUsed:new Date(Q(f.updatedAt||f.createdAt)).toISOString()}}))};d.useEffect(()=>{String((l==null?void 0:l.role)||"").toUpperCase()==="SUPERADMIN"&&E===1&&ze().catch(()=>{})},[E,$,l==null?void 0:l.role]);const Ts=async()=>{var s,t,a;try{es(!0);const r=await v.get(y.admin.systemHealth()),i=((t=(s=r.data)==null?void 0:s.data)==null?void 0:t.health)||((a=r.data)==null?void 0:a.data);ue(i||null);const p=(i==null?void 0:i.overall)||"healthy";X(j=>({...j,systemHealth:p==="healthy"?"healthy":p==="degraded"?"warning":"error"}))}catch{ue(null),X(r=>({...r,systemHealth:"error"}))}finally{es(!1)}},ls=async(s=1)=>{var p,j,w,z;const t=new URLSearchParams;t.set("page",String(s)),t.set("limit","100"),I.status&&t.set("status",I.status),I.email&&t.set("email",I.email),I.from&&t.set("from",I.from),I.to&&t.set("to",I.to);const a=await v.get(`${y.admin.payments()}?${t.toString()}`),r=((j=(p=a.data)==null?void 0:p.data)==null?void 0:j.payments)??[],i=((z=(w=a.data)==null?void 0:w.data)==null?void 0:z.pagination)??{pages:1,page:1};Ss(r),Ee(i.page||s),Cs(i.pages||1)};d.useEffect(()=>{String((l==null?void 0:l.role)||"").toUpperCase()==="SUPERADMIN"&&E===2&&ls(J).catch(()=>{})},[E,J,I,l==null?void 0:l.role]);const zs=async s=>{var t;try{const r=((t=(await v.get(y.admin.paymentDetails(s))).data)==null?void 0:t.data)||{};ws({payment:r.payment,licenses:r.licenses||[]}),Ue(!0)}catch{C("Failed to load payment details",{variant:"error"})}},Ws=s=>{Ke(s),ce(!0)},$s=async()=>{var s,t;try{if(!U)return;await v.put(y.admin.updateUser(U.id),{role:U.role,status:U.status.toUpperCase()}),C("User updated successfully",{variant:"success"}),ce(!1),Ke(null)}catch(a){C(((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Failed to update user",{variant:"error"})}},Fs=async s=>{var t,a,r;try{const j=(((r=(a=(t=(await v.get(y.admin.userDetails(s.id))).data)==null?void 0:t.data)==null?void 0:a.user)==null?void 0:r.subscriptions)||[]).find(w=>w.status==="ACTIVE"&&(String(w.tier).toUpperCase()==="PRO"||String(w.tier).toUpperCase()==="ENTERPRISE"));if(!j){C("No active PRO/ENTERPRISE subscription for this user",{variant:"warning"});return}qe({id:j.id,tier:String(j.tier).toUpperCase(),seats:Number(j.seats||0)}),He(Number(j.seats||0)),oe(!0)}catch(i){C((i==null?void 0:i.message)||"Failed to load subscription",{variant:"error"})}},Ms=async()=>{var s,t;if(N)try{const a=N.tier,r=Number(Xe||0);if(a==="BASIC"&&r!==1){C("Basic plan supports exactly 1 seat.",{variant:"warning"});return}if(a==="PRO"&&(r<1||r>50)){C("Pro plan seats must be between 1 and 50.",{variant:"warning"});return}if(a==="ENTERPRISE"&&r<10){C("Enterprise requires minimum 10 seats.",{variant:"warning"});return}await v.put(y.subscriptions.update(N.id),{seats:r}),qe({...N,seats:r}),C("Seats updated successfully",{variant:"success"}),oe(!1)}catch(a){C(((t=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:t.message)||(a==null?void 0:a.message)||"Failed to update seats",{variant:"error"})}},Os=()=>{Le(!0)},Bs=async()=>{de(!0)},Ys=async s=>{var t,a,r;if(xe(i=>({...i,userId:s,subscriptionId:""})),s){const p=((r=(a=(t=(await v.get(y.admin.userDetails(s))).data)==null?void 0:t.data)==null?void 0:a.user)==null?void 0:r.subscriptions)||[];Qe(p.filter(j=>j.status==="ACTIVE"))}else Qe([])},Vs=async()=>{var s,t;try{await v.post(y.admin.createLicense(),F),C("License(s) created",{variant:"success"}),de(!1);const r=((t=(s=(await v.get(y.admin.licenses())).data)==null?void 0:s.data)==null?void 0:t.licenses)??[];H(r.map(i=>{var p;return{id:i.id,key:i.key,userId:i.userId,userEmail:((p=i.user)==null?void 0:p.email)??"",tier:i.tier,status:(i.status||"").toLowerCase(),activatedAt:i.activatedAt||i.createdAt,expiresAt:i.expiresAt||i.createdAt,lastUsed:i.updatedAt||i.createdAt}}))}catch(a){C((a==null?void 0:a.message)||"Failed to create license",{variant:"error"})}},We=s=>{switch(s){case"active":return"success";case"pending":return"warning";case"suspended":return"error";default:return"default"}},_s=s=>{switch(String(s||"").toUpperCase()){case"SUPERADMIN":return"secondary";case"ADMIN":return"primary";default:return"default"}},$e=s=>{switch(String(s||"").toUpperCase()){case"ENTERPRISE":return"secondary";case"PRO":return"success";case"BASIC":return"default";default:return"default"}},Fe=s=>String(s||"").toUpperCase()==="BASIC"?"outlined":"filled",Gs=s=>{switch(s){case"healthy":return"success";case"warning":return"warning";case"error":return"error";default:return"default"}},Ks=s=>{switch(s){case"healthy":return e.jsx(ct,{});case"warning":return e.jsx(Be,{});case"error":return e.jsx(lt,{});default:return e.jsx(Be,{})}};d.useEffect(()=>{const s=(Ce.hash||"").toLowerCase(),t={"#users":0,"#licenses":1,"#invoices":2,"#system":3,"#system-health":3};s&&t[s]!=null&&t[s]!==E&&_e(t[s])},[Ce.hash]);const qs=(s,t)=>{_e(t);const r={0:"users",1:"licenses",2:"invoices",3:"system"}[t]||"users";(Ce.hash||"").toLowerCase()!==`#${r}`&&Se(`/admin#${r}`,{replace:!0})};return e.jsx(e.Fragment,{children:e.jsx(c,{sx:{pb:4},children:e.jsxs(Hs,{maxWidth:"xl",children:[e.jsxs(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards","@keyframes fadeInUp":{"0%":{opacity:0,transform:"translateY(20px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:4},children:[e.jsx(Js,{sx:{fontSize:32,color:"primary.main"}}),e.jsx(x,{variant:"h4",sx:{fontWeight:700},children:"Admin Dashboard"}),e.jsx(m,{icon:Ks(W.systemHealth),label:`System ${W.systemHealth}`,color:Gs(W.systemHealth),size:"small"})]}),e.jsxs(h,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(h,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.1s forwards"},children:e.jsx(K,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(q,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Qs,{sx:{color:"primary.main"}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"Total Users"})]}),e.jsx(x,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:W.totalUsers.toLocaleString()})]})})})}),e.jsx(h,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.2s forwards"},children:e.jsx(K,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(q,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Zs,{sx:{color:"secondary.main"}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"Active Subscriptions"})]}),e.jsx(x,{variant:"h3",sx:{fontWeight:700},children:W.activeSubscriptions.toLocaleString()})]})})})}),e.jsx(h,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.3s forwards"},children:e.jsx(K,{sx:{background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(139, 195, 74, 0.1) 100%)",border:"1px solid rgba(76, 175, 80, 0.2)"},children:e.jsxs(q,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(js,{sx:{color:"success.main"}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"Total Revenue"})]}),e.jsxs(x,{variant:"h3",sx:{fontWeight:700,color:"success.main"},children:["$",W.totalRevenue.toLocaleString()]})]})})})}),e.jsx(h,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.4s forwards"},children:e.jsx(K,{sx:{background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 193, 7, 0.1) 100%)",border:"1px solid rgba(255, 152, 0, 0.2)"},children:e.jsxs(q,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Be,{sx:{color:"warning.main"}}),e.jsx(x,{variant:"h6",color:"text.secondary",children:"Pending Approvals"})]}),e.jsx(x,{variant:"h3",sx:{fontWeight:700,color:"warning.main"},children:W.pendingApprovals})]})})})})]}),e.jsx(Y,{sx:{mb:3},children:e.jsxs(et,{value:E,onChange:qs,sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontWeight:600}},children:[e.jsx(je,{label:"Users"}),e.jsx(je,{label:"Licenses"}),e.jsx(je,{label:"Invoices"}),e.jsx(je,{label:"System Health"})]})}),E===0&&e.jsxs(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{placeholder:"Search users by name, email, role, status, or subscription...",value:_,onChange:s=>ss(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(G,{position:"start",children:e.jsx(Ve,{})}),endAdornment:_&&e.jsx(G,{position:"end",children:e.jsx(k,{size:"small",onClick:Ps,children:e.jsx(Ye,{})})})}}),_&&e.jsx(m,{label:`${Pe.length} of ${V.length} users found`,color:"primary",variant:"outlined"}),e.jsx(g,{variant:"contained",onClick:Bs,children:"Add License"})]}),e.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsxs(b,{label:"Role",select:!0,size:"small",value:A.role||"",onChange:s=>ne(t=>({...t,role:s.target.value||void 0})),children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"USER",children:"USER"}),e.jsx(o,{value:"ADMIN",children:"ADMIN"}),e.jsx(o,{value:"SUPERADMIN",children:"SUPERADMIN"})]}),e.jsxs(b,{label:"Status",select:!0,size:"small",value:A.status||"",onChange:s=>ne(t=>({...t,status:s.target.value||void 0})),children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"active",children:"ACTIVE"}),e.jsx(o,{value:"suspended",children:"SUSPENDED"})]}),e.jsxs(b,{label:"Subscription Tier",select:!0,size:"small",value:A.tier||"",onChange:s=>ne(t=>({...t,tier:s.target.value||void 0})),children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"BASIC",children:"BASIC"}),e.jsx(o,{value:"PRO",children:"PRO"}),e.jsx(o,{value:"ENTERPRISE",children:"ENTERPRISE"})]}),e.jsx(g,{variant:"outlined",children:"Apply Filters"}),e.jsx(g,{onClick:()=>ne({}),children:"Clear"})]})]}),e.jsx(ge,{component:Y,children:e.jsxs(be,{children:[e.jsx(fe,{children:e.jsxs(L,{children:[e.jsx(n,{children:"User"}),e.jsx(n,{children:"Role"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Subscription"}),e.jsx(n,{children:"Last Login"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(ve,{children:Pe.length>0?Pe.map(s=>e.jsxs(L,{children:[e.jsx(n,{children:e.jsxs(c,{children:[e.jsxs(x,{variant:"subtitle2",children:[s.firstName," ",s.lastName]}),e.jsx(x,{variant:"body2",color:"text.secondary",children:s.email})]})}),e.jsx(n,{children:e.jsx(m,{label:s.role,size:"small",color:_s(s.role)})}),e.jsx(n,{children:e.jsx(m,{label:s.status,size:"small",color:We(s.status)})}),e.jsx(n,{children:s.subscription&&e.jsx(m,{label:s.subscription,size:"small",color:$e(s.subscription),variant:Fe(s.subscription)})}),e.jsx(n,{children:e.jsx(x,{variant:"body2",children:new Date(s.lastLogin).toLocaleDateString()})}),e.jsxs(n,{children:[e.jsx(k,{size:"small",onClick:()=>Ws(s),children:e.jsx(gs,{})}),e.jsx(k,{size:"small",onClick:()=>Fs(s),children:e.jsx(js,{})}),e.jsx(k,{size:"small",color:"error",children:e.jsx(st,{})})]})]},s.id)):e.jsx(L,{children:e.jsx(n,{colSpan:6,align:"center",children:e.jsx(c,{sx:{py:4},children:e.jsx(x,{variant:"body1",color:"text.secondary",children:_?"No users found matching your search criteria.":"No users available."})})})})})]})})]}),E===1&&e.jsxs(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(b,{placeholder:"Search licenses by key, user email, tier, status, or dates...",value:T,onChange:s=>ts(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(G,{position:"start",children:e.jsx(Ve,{})}),endAdornment:T&&e.jsx(G,{position:"end",children:e.jsx(k,{size:"small",onClick:is,children:e.jsx(Ye,{})})})}}),e.jsxs(c,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsxs(b,{select:!0,size:"small",label:"Tier",sx:{minWidth:140},value:$.tier||"",onChange:s=>De(t=>({...t,tier:s.target.value||void 0})),children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"BASIC",children:"BASIC"}),e.jsx(o,{value:"PRO",children:"PRO"}),e.jsx(o,{value:"ENTERPRISE",children:"ENTERPRISE"})]}),e.jsx(m,{size:"small",label:Re?"Showing users with 0 licenses":"Hiding users with 0 licenses",onClick:()=>Rs(s=>!s),variant:"outlined"}),e.jsxs(b,{select:!0,size:"small",label:"Status",sx:{minWidth:160},value:$.status||"",onChange:s=>De(t=>({...t,status:s.target.value||void 0})),children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"ACTIVE",children:"ACTIVE"}),e.jsx(o,{value:"PENDING",children:"PENDING"}),e.jsx(o,{value:"SUSPENDED",children:"SUSPENDED"}),e.jsx(o,{value:"EXPIRED",children:"EXPIRED"}),e.jsx(o,{value:"REVOKED",children:"REVOKED"})]}),e.jsx(g,{variant:"outlined",onClick:()=>ze(),children:"Apply"}),e.jsx(g,{onClick:()=>{De({}),ze().catch(()=>{})},children:"Clear"})]})]}),e.jsxs(c,{sx:{mb:2,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(m,{label:`${Ne.length} Users with Licenses`,color:"primary",variant:"outlined"}),e.jsx(m,{label:`${ke.length} Total Licenses`,color:"secondary",variant:"outlined"}),T&&e.jsx(m,{label:`Search: ${T}`,color:"info",variant:"outlined",onDelete:is})]}),e.jsx(c,{sx:{display:"flex",flexDirection:"column",gap:2},children:Ne.length>0?Ne.map(s=>e.jsx(K,{variant:"outlined",children:e.jsxs(q,{sx:{p:0},children:[e.jsx(c,{sx:{p:2,backgroundColor:"background.default",borderBottom:"1px solid",borderColor:"divider",cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>Ns(s.userEmail),children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(tt,{color:"primary"}),e.jsxs(c,{children:[e.jsx(x,{variant:"h6",component:"div",children:s.userEmail}),e.jsxs(c,{sx:{display:"flex",gap:1,mt:.5},children:[e.jsx(m,{size:"small",label:`${s.totalLicenses} Total Licenses`,color:"primary",variant:"outlined"}),e.jsx(m,{size:"small",label:`${s.activeLicenses} Active`,color:"success",variant:"outlined"})]})]})]}),e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(at,{sx:{transform:rs.has(s.userEmail)?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})})]})}),e.jsx(rt,{in:rs.has(s.userEmail),children:e.jsx(ge,{component:Y,sx:{borderRadius:0},children:e.jsxs(be,{size:"small",children:[e.jsx(fe,{children:e.jsxs(L,{children:[e.jsx(n,{children:"License Key"}),e.jsx(n,{children:"Tier"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Expires"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(ve,{children:s.licenses.map(t=>e.jsxs(L,{children:[e.jsx(n,{children:e.jsx(x,{variant:"body2",fontFamily:"monospace",children:t.key})}),e.jsx(n,{children:e.jsx(m,{label:t.tier,size:"small",color:$e(t.tier),variant:Fe(t.tier)})}),e.jsx(n,{children:e.jsx(m,{label:t.status,size:"small",color:We(String(t.status).toLowerCase())})}),e.jsx(n,{children:e.jsx(x,{variant:"body2",children:new Date(t.expiresAt).toLocaleDateString()})}),e.jsxs(n,{children:[e.jsx(k,{size:"small",onClick:()=>Os(),children:e.jsx(gs,{})}),e.jsx(k,{size:"small",children:e.jsx(nt,{})}),e.jsx(k,{size:"small",children:e.jsx(it,{})})]})]},t.id))})]})})})]})},s.userEmail)):e.jsx(c,{sx:{py:4,textAlign:"center"},children:e.jsx(x,{variant:"body1",color:"text.secondary",children:T?"No licenses found matching your search criteria.":"No licenses available."})})})]}),E===2&&e.jsxs(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{placeholder:"Search payments by ID, email, tier, status, amount, or date...",value:M,onChange:s=>as(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(G,{position:"start",children:e.jsx(Ve,{})}),endAdornment:M&&e.jsx(G,{position:"end",children:e.jsx(k,{size:"small",onClick:ks,children:e.jsx(Ye,{})})})}}),M&&e.jsx(m,{label:`${Te.length} of ${ie.length} payments found`,color:"primary",variant:"outlined"})]}),e.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(b,{label:"Filter by Email",size:"small",value:I.email||"",onChange:s=>le(t=>({...t,email:s.target.value}))}),e.jsx(b,{label:"From",size:"small",type:"date",InputLabelProps:{shrink:!0},value:I.from||"",onChange:s=>le(t=>({...t,from:s.target.value}))}),e.jsx(b,{label:"To",size:"small",type:"date",InputLabelProps:{shrink:!0},value:I.to||"",onChange:s=>le(t=>({...t,to:s.target.value}))}),e.jsxs(b,{label:"Status",select:!0,size:"small",value:I.status||"",onChange:s=>le(t=>({...t,status:s.target.value||void 0})),sx:{minWidth:160},children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"SUCCEEDED",children:"SUCCEEDED"}),e.jsx(o,{value:"PENDING",children:"PENDING"}),e.jsx(o,{value:"FAILED",children:"FAILED"}),e.jsx(o,{value:"REFUNDED",children:"REFUNDED"})]}),e.jsx(g,{variant:"outlined",onClick:()=>ls(1),children:"Apply Filters"})]})]}),e.jsx(ge,{component:Y,children:e.jsxs(be,{children:[e.jsx(fe,{children:e.jsxs(L,{children:[e.jsx(n,{children:"Payment ID"}),e.jsx(n,{children:"User"}),e.jsx(n,{children:"Tier"}),e.jsx(n,{children:"Amount"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Invoice"}),e.jsx(n,{children:"Details"})]})}),e.jsx(ve,{children:Te.length>0?Te.map(s=>{var t,a,r,i;return e.jsxs(L,{children:[e.jsx(n,{children:e.jsx(x,{variant:"body2",fontFamily:"monospace",children:s.id})}),e.jsx(n,{children:e.jsx(x,{variant:"body2",children:((t=s.user)==null?void 0:t.email)||"—"})}),e.jsx(n,{children:e.jsx(m,{size:"small",label:((a=s.subscription)==null?void 0:a.tier)||"—",color:$e((r=s.subscription)==null?void 0:r.tier),variant:Fe((i=s.subscription)==null?void 0:i.tier)})}),e.jsx(n,{children:e.jsx(x,{variant:"body2",children:ns(s.amount)})}),e.jsx(n,{children:e.jsx(m,{size:"small",label:s.status,color:s.status==="SUCCEEDED"?"success":s.status==="FAILED"?"error":"default"})}),e.jsx(n,{children:e.jsx(x,{variant:"body2",children:Q(s.createdAt).toLocaleDateString()})}),e.jsx(n,{children:s.stripeInvoiceId?e.jsx(g,{size:"small",variant:"outlined",onClick:()=>{const p=localStorage.getItem("auth_token"),j=`/api/invoices/${s.stripeInvoiceId}/pdf${p?`?token=${encodeURIComponent(p)}`:""}`;window.open(j,"_blank")},children:"View"}):s.receiptUrl?e.jsx(g,{size:"small",variant:"outlined",onClick:()=>window.open(s.receiptUrl,"_blank"),children:"View"}):e.jsx(x,{variant:"body2",color:"text.secondary",children:"N/A"})}),e.jsx(n,{children:e.jsx(g,{size:"small",onClick:()=>zs(s.id),children:"Open"})})]},s.id)}):e.jsx(L,{children:e.jsx(n,{colSpan:8,align:"center",children:e.jsx(c,{sx:{py:4},children:e.jsx(x,{variant:"body1",color:"text.secondary",children:M?"No payments found matching your search criteria.":"No payments available."})})})})})]})}),e.jsxs(c,{sx:{display:"flex",gap:1,justifyContent:"flex-end",mt:2},children:[e.jsx(g,{disabled:J<=1,onClick:()=>Ee(s=>Math.max(1,s-1)),children:"Prev"}),e.jsx(m,{label:`Page ${J} of ${Ae}`}),e.jsx(g,{disabled:J>=Ae,onClick:()=>Ee(s=>Math.min(Ae,s+1)),children:"Next"})]})]}),E===3&&e.jsx(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,md:6,children:e.jsxs(Y,{sx:{p:3},children:[e.jsx(x,{variant:"h6",sx:{mb:2},children:"System Status"}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(m,{label:`Overall: ${((u==null?void 0:u.overall)||"unknown").toUpperCase()}`,color:(u==null?void 0:u.overall)==="healthy"?"success":(u==null?void 0:u.overall)==="degraded"?"warning":(u==null?void 0:u.overall)==="unhealthy"?"error":"default"}),e.jsx(g,{size:"small",onClick:Ts,disabled:Ze,children:Ze?"Refreshing…":"Refresh"})]}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,children:e.jsx(ye,{title:"Database",data:u==null?void 0:u.database})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(ye,{title:"Email (SendGrid)",data:u==null?void 0:u.email})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(ye,{title:"Payments (Stripe)",data:u==null?void 0:u.payment})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(ye,{title:"Webhooks",data:u==null?void 0:u.webhooks})})]})]})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsxs(Y,{sx:{p:3},children:[e.jsx(x,{variant:"h6",sx:{mb:2},children:"Recent Activity"}),e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(x,{variant:"body2",color:"text.secondary",children:["Checked at: ",u!=null&&u.checkedAt?new Date(u.checkedAt).toLocaleString():"—"]}),(cs=u==null?void 0:u.webhooks)!=null&&cs.metrics?e.jsxs(e.Fragment,{children:[e.jsxs(x,{variant:"body2",children:["Recent webhooks (24h): ",u.webhooks.metrics.recentWebhooks]}),e.jsxs(x,{variant:"body2",children:["Failed webhooks: ",u.webhooks.metrics.failedWebhooks]})]}):e.jsx(x,{variant:"body2",color:"text.secondary",children:"No metrics available"})]})]})})]})})]}),e.jsxs(se,{open:Ds,onClose:()=>ce(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(te,{children:"Edit User"}),e.jsx(ae,{children:U&&e.jsxs(h,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,label:"First Name",value:U.firstName,disabled:!0})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,label:"Last Name",value:U.lastName,disabled:!0})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,label:"Email",value:U.email,disabled:!0})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(bs,{fullWidth:!0,children:[e.jsx(fs,{children:"Role"}),e.jsxs(vs,{value:U.role,label:"Role",inputProps:{"aria-label":"Select user role",title:"Choose the user role"},children:[e.jsx(o,{value:"USER",children:"User"}),e.jsx(o,{value:"ADMIN",children:"Admin"}),e.jsx(o,{value:"SUPERADMIN",children:"SUPERADMIN"})]})]})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(bs,{fullWidth:!0,children:[e.jsx(fs,{children:"Status"}),e.jsxs(vs,{value:U.status,label:"Status",inputProps:{"aria-label":"Select user status",title:"Choose the user status"},children:[e.jsx(o,{value:"active",children:"Active"}),e.jsx(o,{value:"suspended",children:"Suspended"}),e.jsx(o,{value:"pending",children:"Pending"})]})]})})]})}),e.jsxs(re,{children:[e.jsx(g,{onClick:()=>ce(!1),children:"Cancel"}),e.jsx(g,{onClick:$s,variant:"contained",children:"Save Changes"})]})]}),e.jsxs(se,{open:Is,onClose:()=>Ue(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(te,{children:"Payment Details"}),e.jsx(ae,{children:R.payment?e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(m,{label:`ID: ${R.payment.id}`}),e.jsx(m,{label:`User: ${((os=R.payment.user)==null?void 0:os.email)||"—"}`}),e.jsx(m,{label:`Amount: $${(R.payment.amount/100).toFixed(2)}`}),e.jsx(m,{label:`Status: ${R.payment.status}`}),e.jsx(m,{label:`Date: ${new Date(R.payment.createdAt).toLocaleString()}`}),R.payment.receiptUrl&&e.jsx(g,{size:"small",variant:"outlined",onClick:()=>window.open(R.payment.receiptUrl,"_blank"),children:"View Invoice"})]}),e.jsx(x,{variant:"subtitle2",children:"Related Licenses"}),e.jsx(ge,{component:Y,children:e.jsxs(be,{size:"small",children:[e.jsx(fe,{children:e.jsxs(L,{children:[e.jsx(n,{children:"License Key"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Activated"}),e.jsx(n,{children:"Expires"})]})}),e.jsx(ve,{children:(R.licenses||[]).map(s=>e.jsxs(L,{children:[e.jsx(n,{children:e.jsx(x,{variant:"body2",fontFamily:"monospace",children:s.key})}),e.jsx(n,{children:e.jsx(m,{size:"small",label:s.status,color:We(String(s.status).toLowerCase())})}),e.jsx(n,{children:s.activatedAt?new Date(s.activatedAt).toLocaleDateString():"—"}),e.jsx(n,{children:s.expiresAt?new Date(s.expiresAt).toLocaleDateString():"—"})]},s.id))})]})})]}):e.jsx(x,{variant:"body2",color:"text.secondary",children:"No details."})}),e.jsx(re,{children:e.jsx(g,{onClick:()=>Ue(!1),children:"Close"})})]}),e.jsxs(se,{open:Es,onClose:()=>Le(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(te,{children:"Edit License"}),e.jsx(ae,{children:e.jsx(x,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"License management options will be available here."})}),e.jsx(re,{children:e.jsx(g,{onClick:()=>Le(!1),children:"Close"})})]}),e.jsxs(se,{open:Us,onClose:()=>de(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(te,{children:"Add License"}),e.jsx(ae,{children:e.jsxs(h,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(h,{item:!0,xs:12,children:e.jsx(b,{select:!0,fullWidth:!0,label:"User",value:F.userId,onChange:s=>Ys(s.target.value),children:V.map(s=>e.jsx(o,{value:s.id,children:s.email},s.id))})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(b,{select:!0,fullWidth:!0,label:"Subscription",value:F.subscriptionId,onChange:s=>xe(t=>({...t,subscriptionId:s.target.value})),disabled:!Je.length,children:Je.map(s=>e.jsxs(o,{value:s.id,children:[s.tier," — seats ",s.seats]},s.id))})}),e.jsx(h,{item:!0,xs:6,children:e.jsxs(b,{select:!0,fullWidth:!0,label:"Tier",value:F.tier,onChange:s=>xe(t=>({...t,tier:s.target.value})),children:[e.jsx(o,{value:"BASIC",children:"BASIC"}),e.jsx(o,{value:"PRO",children:"PRO"}),e.jsx(o,{value:"ENTERPRISE",children:"ENTERPRISE"})]})}),e.jsx(h,{item:!0,xs:6,children:e.jsx(b,{fullWidth:!0,type:"number",label:"Seats",inputProps:{min:1,max:1e3},value:F.seats,onChange:s=>xe(t=>({...t,seats:Math.max(1,Math.min(1e3,parseInt(s.target.value)||1))}))})})]})}),e.jsxs(re,{children:[e.jsx(g,{onClick:()=>de(!1),children:"Cancel"}),e.jsx(g,{variant:"contained",onClick:Vs,disabled:!F.userId||!F.subscriptionId,children:"Create"})]})]}),e.jsxs(se,{open:As,onClose:()=>oe(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(te,{children:"Manage Seats"}),e.jsx(ae,{children:N?e.jsxs(h,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(h,{item:!0,xs:12,children:e.jsxs(ys,{severity:"info",children:[N.tier," subscription"]})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,type:"number",label:"Total Seats",value:Xe,onChange:s=>He(parseInt(s.target.value||"0",10)),inputProps:{min:1,max:N.tier==="PRO"?50:1e3}})})]}):e.jsx(x,{variant:"body2",color:"text.secondary",children:"No active subscription found."})}),e.jsxs(re,{children:[e.jsx(g,{onClick:()=>oe(!1),children:"Cancel"}),e.jsx(g,{onClick:Ms,variant:"contained",disabled:!N,children:"Save"})]})]})]})})})};export{ft as default};
