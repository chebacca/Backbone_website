import{j as e,a as c,b as Gs,aw as qs,T as n,m as j,G as u,z as ae,J as re,aH as Xs,bb as ve,ak as Oe,bj as Be,c as Y,a_ as Ks,a$ as ye,n as b,X as K,I as k,cd as _e,b0 as Ye,d as p,ae as o,b1 as Se,b2 as ee,b3 as se,b4 as E,b5 as a,b6 as te,bh as bs,ba as Hs,D as Ce,k as Ie,l as we,aN as fs,b8 as vs,b9 as ys,v as Ae,ce as Js,A as Ss,a4 as Qs,w as Zs}from"./mui-Ilj8o9AZ.js";import{u as et,h as st,r as d}from"./vendor-OeuszDaU.js";import{u as tt}from"./notistack.esm-CcFOI6Un.js";import{u as at,d as C,e as I}from"./index-D7118k3b.js";import"./stripe-BKUR_tcx.js";const De=({title:S,data:l})=>{const Ee=(l==null?void 0:l.status)==="healthy"?"success":(l==null?void 0:l.status)==="degraded"?"warning":(l==null?void 0:l.status)==="unhealthy"?"error":"default";return e.jsx(ae,{variant:"outlined",children:e.jsxs(re,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(n,{variant:"subtitle1",children:S}),e.jsx(j,{size:"small",label:((l==null?void 0:l.status)||"unknown").toUpperCase(),color:Ee})]}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Response time: ",(l==null?void 0:l.responseTimeMs)!=null?`${l.responseTimeMs} ms`:"â€”"]})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(n,{variant:"body2",color:"text.secondary",children:(l==null?void 0:l.message)||""})}),(l==null?void 0:l.error)&&e.jsx(u,{item:!0,xs:12,children:e.jsx(Ss,{severity:"warning",children:l.error})})]})]})})},dt=()=>{var hs,ps;const{enqueueSnackbar:S}=tt(),{user:l}=at(),Ee=et(),Ue=st(),[T,Ve]=d.useState(0),[F,H]=d.useState({totalUsers:0,activeSubscriptions:0,totalRevenue:0,pendingApprovals:0,systemHealth:"healthy"}),[$,Le]=d.useState([]),[P,ne]=d.useState({}),[rt,Ge]=d.useState([]),[ie,Cs]=d.useState([]),[J,Pe]=d.useState(1),[Re,Is]=d.useState(1),[w,le]=d.useState({}),[ws,ke]=d.useState(!1),[N,As]=d.useState({}),[U,ce]=d.useState(null),[Ds,oe]=d.useState(!1),[Es,de]=d.useState(!1),[z,qe]=d.useState(null),[Xe,Ke]=d.useState(0),[Us,xe]=d.useState(!1),[M,ue]=d.useState({userId:"",subscriptionId:"",tier:"PRO",seats:1}),[He,Je]=d.useState([]),[x,he]=d.useState(null),[Qe,Ze]=d.useState(!1),[V,es]=d.useState(""),[O,ss]=d.useState(""),[G,ts]=d.useState(""),[B,Ne]=d.useState({}),[as,rs]=d.useState(null),[Te,ns]=d.useState(null),[is,pe]=d.useState([]),[Ls,ls]=d.useState(!1),Ps=5,ze=d.useMemo(()=>{const s=V.trim().toLowerCase();return $.filter(t=>s?t.firstName.toLowerCase().includes(s)||t.lastName.toLowerCase().includes(s)||t.email.toLowerCase().includes(s)||t.role.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||t.subscription&&t.subscription.toLowerCase().includes(s):!0).filter(t=>P.role?t.role===P.role:!0).filter(t=>P.status?t.status===P.status.toLowerCase():!0).filter(t=>P.tier?(t.subscription||"").toUpperCase()===P.tier:!0)},[$,V,P]),We=d.useMemo(()=>{const s=G.trim().toLowerCase();return $.filter(t=>t.subscription).filter(t=>s?t.firstName.toLowerCase().includes(s)||t.lastName.toLowerCase().includes(s)||t.email.toLowerCase().includes(s)||t.subscription&&t.subscription.toLowerCase().includes(s):!0).filter(t=>B.tier?(t.subscription||"").toUpperCase()===B.tier:!0).filter(t=>B.status?t.status===B.status:!0)},[$,G,B]),W=s=>{if(!s)return new Date(NaN);if(typeof s=="string")return new Date(s);if(s instanceof Date)return s;if(typeof s=="object"&&s!==null){if(typeof s._seconds=="number")return new Date(s._seconds*1e3);if(typeof s.seconds=="number")return new Date(s.seconds*1e3);if(typeof s.toDate=="function")try{return s.toDate()}catch{}}return new Date(s)},cs=s=>`$${((typeof s=="number"?s:0)/100).toFixed(2)}`,Fe=d.useMemo(()=>{if(!O.trim())return ie;const s=O.toLowerCase();return ie.filter(t=>{var r,i;return t.id.toLowerCase().includes(s)||((r=t.user)==null?void 0:r.email)&&t.user.email.toLowerCase().includes(s)||((i=t.subscription)==null?void 0:i.tier)&&t.subscription.tier.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||W(t.createdAt).toLocaleDateString().toLowerCase().includes(s)||cs(t.amount).toLowerCase().includes(s)})},[ie,O]),Rs=()=>es(""),ks=()=>ss(""),Ns=()=>ts(""),os=async(s,t)=>{var r,i,h,f,m,L,_,q;s.stopPropagation(),s.preventDefault(),rs(s.currentTarget),ns(t),pe([]),ls(!0);try{let Z=(((h=(i=(r=(await C.get(I.admin.userDetails(t.id))).data)==null?void 0:r.data)==null?void 0:i.user)==null?void 0:h.subscriptions)||[]).flatMap(y=>(y.licenses||[]).map(g=>({id:g.id,key:g.key,userId:g.userId||t.id,userEmail:t.email,tier:g.tier,status:String(g.status||"").toLowerCase(),activatedAt:new Date(W(g.activatedAt||g.createdAt)).toISOString(),expiresAt:new Date(W(g.expiresAt||g.createdAt)).toISOString(),lastUsed:new Date(W(g.updatedAt||g.createdAt)).toISOString()})));if(Z.length===0)try{let y=1,g=[];for(;y<=Ps;){const A=await C.get(`${I.admin.licenses()}?page=${y}&limit=100`),D=(((m=(f=A.data)==null?void 0:f.data)==null?void 0:m.licenses)||[]).filter(v=>{var R;return(((R=v.user)==null?void 0:R.email)||"").toLowerCase()===t.email.toLowerCase()}).map(v=>{var R;return{id:v.id,key:v.key,userId:v.userId||t.id,userEmail:((R=v.user)==null?void 0:R.email)||t.email,tier:v.tier,status:String(v.status||"").toLowerCase(),activatedAt:new Date(W(v.activatedAt||v.createdAt)).toISOString(),expiresAt:new Date(W(v.expiresAt||v.createdAt)).toISOString(),lastUsed:new Date(W(v.updatedAt||v.createdAt)).toISOString()}});g=g.concat(D);const fe=Number(((q=(_=(L=A.data)==null?void 0:L.data)==null?void 0:_.pagination)==null?void 0:q.pages)||1);if(y>=fe)break;y+=1}Z=g}catch{}const be=Z.sort((y,g)=>{const A=y.status==="active"?0:1,X=g.status==="active"?0:1;return A!==X?A-X:new Date(g.activatedAt).getTime()-new Date(y.activatedAt).getTime()});pe(be)}catch(Q){S((Q==null?void 0:Q.message)||"Failed to load licenses",{variant:"error"}),pe([])}finally{ls(!1)}},Ts=()=>{rs(null),ns(null),pe([])};d.useEffect(()=>{let s=!0;return(async()=>{var t,r,i,h,f,m,L;try{if(String((l==null?void 0:l.role)||"").toUpperCase()!=="SUPERADMIN"){Le([]),H(D=>({...D,systemHealth:"warning"}));return}const[q,Q,Me,Z]=await Promise.all([C.get(`${I.admin.users()}?page=1&limit=100`),C.get(I.admin.paymentAnalytics()),C.get(I.admin.systemHealth()),C.get(I.admin.dashboardStats())]),be=((r=(t=q.data)==null?void 0:t.data)==null?void 0:r.users)??[],y=((h=(i=Z.data)==null?void 0:i.data)==null?void 0:h.stats)??{totalRevenue:0,activeSubscriptions:0},g=(y==null?void 0:y.recentPayments)??[],A=((m=(f=Me.data)==null?void 0:f.data)==null?void 0:m.health)||((L=Me.data)==null?void 0:L.data),X=(A==null?void 0:A.overall)||(A==null?void 0:A.status)||"healthy";if(!s)return;Le(be.map(D=>{var fe,v,R,js,ms,gs;return{id:D.id,email:D.email,firstName:((fe=D.name)==null?void 0:fe.split(" ")[0])??"",lastName:((v=D.name)==null?void 0:v.split(" ").slice(1).join(" "))??"",role:D.role,status:((js=(R=D.status)==null?void 0:R.toLowerCase)==null?void 0:js.call(R))||"active",subscription:((gs=(ms=D.subscriptions)==null?void 0:ms[0])==null?void 0:gs.tier)??void 0,lastLogin:D.lastLoginAt||new Date().toISOString(),createdAt:D.createdAt||new Date().toISOString()}})),H({totalUsers:Number(y.totalUsers||be.length)||0,activeSubscriptions:y.activeSubscriptions??0,totalRevenue:Math.round(y.totalRevenue??0)/100,pendingApprovals:0,systemHealth:X==="healthy"?"healthy":X==="degraded"?"warning":"error"}),he(A||null),Ge(g)}catch{if(!s)return;Le([]),H(q=>({...q,systemHealth:"error"})),Ge([]),he(null)}})(),()=>{s=!1}},[l==null?void 0:l.role]);const zs=async()=>{var s,t,r;try{Ze(!0);const i=await C.get(I.admin.systemHealth()),h=((t=(s=i.data)==null?void 0:s.data)==null?void 0:t.health)||((r=i.data)==null?void 0:r.data);he(h||null);const f=(h==null?void 0:h.overall)||"healthy";H(m=>({...m,systemHealth:f==="healthy"?"healthy":f==="degraded"?"warning":"error"}))}catch{he(null),H(i=>({...i,systemHealth:"error"}))}finally{Ze(!1)}},ds=async(s=1)=>{var f,m,L,_;const t=new URLSearchParams;t.set("page",String(s)),t.set("limit","100"),w.status&&t.set("status",w.status),w.email&&t.set("email",w.email),w.from&&t.set("from",w.from),w.to&&t.set("to",w.to);const r=await C.get(`${I.admin.payments()}?${t.toString()}`),i=((m=(f=r.data)==null?void 0:f.data)==null?void 0:m.payments)??[],h=((_=(L=r.data)==null?void 0:L.data)==null?void 0:_.pagination)??{pages:1,page:1};Cs(i),Pe(h.page||s),Is(h.pages||1)};d.useEffect(()=>{String((l==null?void 0:l.role)||"").toUpperCase()==="SUPERADMIN"&&T===1&&ds(J).catch(()=>{})},[T,J,w,l==null?void 0:l.role]);const Ws=async s=>{var t;try{const i=((t=(await C.get(I.admin.paymentDetails(s))).data)==null?void 0:t.data)||{};As({payment:i.payment,licenses:i.licenses||[]}),ke(!0)}catch{S("Failed to load payment details",{variant:"error"})}},xs=s=>{ce(s),oe(!0)},Fs=async()=>{var s,t;try{if(!U)return;await C.put(I.admin.updateUser(U.id),{role:U.role,status:U.status.toUpperCase()}),S("User updated successfully",{variant:"success"}),oe(!1),ce(null)}catch(r){S(((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Failed to update user",{variant:"error"})}},$e=async s=>{var t,r,i;try{const m=(((i=(r=(t=(await C.get(I.admin.userDetails(s.id))).data)==null?void 0:t.data)==null?void 0:r.user)==null?void 0:i.subscriptions)||[]).find(L=>L.status==="ACTIVE"&&(String(L.tier).toUpperCase()==="PRO"||String(L.tier).toUpperCase()==="ENTERPRISE"));if(!m){S("No active PRO/ENTERPRISE subscription for this user",{variant:"warning"});return}qe({id:m.id,tier:String(m.tier).toUpperCase(),seats:Number(m.seats||0)}),Ke(Number(m.seats||0)),de(!0)}catch(h){S((h==null?void 0:h.message)||"Failed to load subscription",{variant:"error"})}},$s=async()=>{var s,t;if(z)try{const r=z.tier,i=Number(Xe||0);if(r==="BASIC"&&i!==1){S("Basic plan supports exactly 1 seat.",{variant:"warning"});return}if(r==="PRO"&&(i<1||i>50)){S("Pro plan seats must be between 1 and 50.",{variant:"warning"});return}if(r==="ENTERPRISE"&&i<10){S("Enterprise requires minimum 10 seats.",{variant:"warning"});return}await C.put(I.subscriptions.update(z.id),{seats:i}),qe({...z,seats:i}),S("Seats updated successfully",{variant:"success"}),de(!1)}catch(r){S(((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||(r==null?void 0:r.message)||"Failed to update seats",{variant:"error"})}},us=async()=>{xe(!0)},Ms=async s=>{var t,r,i;if(ue(h=>({...h,userId:s,subscriptionId:""})),s){const f=((i=(r=(t=(await C.get(I.admin.userDetails(s))).data)==null?void 0:t.data)==null?void 0:r.user)==null?void 0:i.subscriptions)||[];Je(f.filter(m=>m.status==="ACTIVE"))}else Je([])},Os=async()=>{try{await C.post(I.admin.createLicense(),M),S("License(s) created",{variant:"success"}),xe(!1)}catch(s){S((s==null?void 0:s.message)||"Failed to create license",{variant:"error"})}},je=s=>{switch(s){case"active":return"success";case"pending":return"warning";case"suspended":return"error";default:return"default"}},Bs=s=>{switch(String(s||"").toUpperCase()){case"SUPERADMIN":return"secondary";case"ADMIN":return"primary";default:return"default"}},me=s=>{switch(String(s||"").toUpperCase()){case"ENTERPRISE":return"secondary";case"PRO":return"success";case"BASIC":return"default";default:return"default"}},ge=s=>String(s||"").toUpperCase()==="BASIC"?"outlined":"filled",_s=s=>{switch(s){case"healthy":return"success";case"warning":return"warning";case"error":return"error";default:return"default"}},Ys=s=>{switch(s){case"healthy":return e.jsx(Zs,{});case"warning":return e.jsx(Be,{});case"error":return e.jsx(Qs,{});default:return e.jsx(Be,{})}};d.useEffect(()=>{const s=(Ue.hash||"").toLowerCase(),t={"#users":0,"#licenses":1,"#invoices":2,"#system":3,"#system-health":3};s&&t[s]!=null&&t[s]!==T&&Ve(t[s])},[Ue.hash]);const Vs=(s,t)=>{Ve(t);const i={0:"users",1:"licenses",2:"invoices",3:"system"}[t]||"users";(Ue.hash||"").toLowerCase()!==`#${i}`&&Ee(`/admin#${i}`,{replace:!0})};return e.jsx(e.Fragment,{children:e.jsx(c,{sx:{pb:4},children:e.jsxs(Gs,{maxWidth:"xl",children:[e.jsxs(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards","@keyframes fadeInUp":{"0%":{opacity:0,transform:"translateY(20px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:4},children:[e.jsx(qs,{sx:{fontSize:32,color:"primary.main"}}),e.jsx(n,{variant:"h4",sx:{fontWeight:700},children:"Admin Dashboard"}),e.jsx(j,{icon:Ys(F.systemHealth),label:`System ${F.systemHealth}`,color:_s(F.systemHealth),size:"small"})]}),e.jsxs(u,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(u,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.1s forwards"},children:e.jsx(ae,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(re,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Xs,{sx:{color:"primary.main"}}),e.jsx(n,{variant:"h6",color:"text.secondary",children:"Total Users"})]}),e.jsx(n,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:F.totalUsers.toLocaleString()})]})})})}),e.jsx(u,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.2s forwards"},children:e.jsx(ae,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(re,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(ve,{sx:{color:"secondary.main"}}),e.jsx(n,{variant:"h6",color:"text.secondary",children:"Active Subscriptions"})]}),e.jsx(n,{variant:"h3",sx:{fontWeight:700},children:F.activeSubscriptions.toLocaleString()})]})})})}),e.jsx(u,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.3s forwards"},children:e.jsx(ae,{sx:{background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(139, 195, 74, 0.1) 100%)",border:"1px solid rgba(76, 175, 80, 0.2)"},children:e.jsxs(re,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Oe,{sx:{color:"success.main"}}),e.jsx(n,{variant:"h6",color:"text.secondary",children:"Total Revenue"})]}),e.jsxs(n,{variant:"h3",sx:{fontWeight:700,color:"success.main"},children:["$",F.totalRevenue.toLocaleString()]})]})})})}),e.jsx(u,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.4s forwards"},children:e.jsx(ae,{sx:{background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 193, 7, 0.1) 100%)",border:"1px solid rgba(255, 152, 0, 0.2)"},children:e.jsxs(re,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Be,{sx:{color:"warning.main"}}),e.jsx(n,{variant:"h6",color:"text.secondary",children:"Pending Approvals"})]}),e.jsx(n,{variant:"h3",sx:{fontWeight:700,color:"warning.main"},children:F.pendingApprovals})]})})})})]}),e.jsx(Y,{sx:{mb:3},children:e.jsxs(Ks,{value:T,onChange:Vs,sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontWeight:600}},children:[e.jsx(ye,{label:"Users"}),e.jsx(ye,{label:"Licenses"}),e.jsx(ye,{label:"Invoices"}),e.jsx(ye,{label:"System Health"})]})}),T===0&&e.jsxs(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{placeholder:"Search users by name, email, role, status, or subscription...",value:V,onChange:s=>es(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(Ye,{})}),endAdornment:V&&e.jsx(K,{position:"end",children:e.jsx(k,{size:"small",onClick:Rs,children:e.jsx(_e,{})})})}}),V&&e.jsx(j,{label:`${ze.length} of ${$.length} users found`,color:"primary",variant:"outlined"}),e.jsx(p,{variant:"contained",onClick:us,children:"Add License"})]}),e.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsxs(b,{label:"Role",select:!0,size:"small",value:P.role||"",onChange:s=>ne(t=>({...t,role:s.target.value||void 0})),children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"USER",children:"USER"}),e.jsx(o,{value:"ADMIN",children:"ADMIN"}),e.jsx(o,{value:"SUPERADMIN",children:"SUPERADMIN"})]}),e.jsxs(b,{label:"Status",select:!0,size:"small",value:P.status||"",onChange:s=>ne(t=>({...t,status:s.target.value||void 0})),children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"active",children:"ACTIVE"}),e.jsx(o,{value:"suspended",children:"SUSPENDED"})]}),e.jsxs(b,{label:"Subscription Tier",select:!0,size:"small",value:P.tier||"",onChange:s=>ne(t=>({...t,tier:s.target.value||void 0})),children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"BASIC",children:"BASIC"}),e.jsx(o,{value:"PRO",children:"PRO"}),e.jsx(o,{value:"ENTERPRISE",children:"ENTERPRISE"})]}),e.jsx(p,{variant:"outlined",children:"Apply Filters"}),e.jsx(p,{onClick:()=>ne({}),children:"Clear"})]})]}),e.jsx(Se,{component:Y,children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(E,{children:[e.jsx(a,{children:"User"}),e.jsx(a,{children:"Role"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Subscription"}),e.jsx(a,{children:"Last Login"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(te,{children:ze.length>0?ze.map(s=>e.jsxs(E,{children:[e.jsx(a,{children:e.jsxs(c,{children:[e.jsxs(n,{variant:"subtitle2",children:[s.firstName," ",s.lastName]}),e.jsx(n,{variant:"body2",color:"text.secondary",children:s.email})]})}),e.jsx(a,{children:e.jsx(j,{label:s.role,size:"small",color:Bs(s.role)})}),e.jsx(a,{children:e.jsx(j,{label:s.status,size:"small",color:je(s.status)})}),e.jsx(a,{children:s.subscription&&e.jsx(j,{label:s.subscription,size:"small",color:me(s.subscription),variant:ge(s.subscription)})}),e.jsx(a,{children:e.jsx(n,{variant:"body2",children:new Date(s.lastLogin).toLocaleDateString()})}),e.jsxs(a,{children:[e.jsx(k,{size:"small",onClick:()=>xs(s),children:e.jsx(bs,{})}),e.jsx(k,{size:"small",onClick:t=>os(t,s),title:"View user licenses",children:e.jsx(ve,{})}),e.jsx(k,{size:"small",onClick:t=>{t.stopPropagation(),$e(s)},title:"Manage seats",children:e.jsx(Oe,{})}),e.jsx(k,{size:"small",color:"error",children:e.jsx(Hs,{})})]})]},s.id)):e.jsx(E,{children:e.jsx(a,{colSpan:6,align:"center",children:e.jsx(c,{sx:{py:4},children:e.jsx(n,{variant:"body1",color:"text.secondary",children:V?"No users found matching your search criteria.":"No users available."})})})})})]})})]}),T===1&&e.jsxs(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{placeholder:"Search licenses by user, tier, status, or subscription...",value:G,onChange:s=>ts(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(Ye,{})}),endAdornment:G&&e.jsx(K,{position:"end",children:e.jsx(k,{size:"small",onClick:Ns,children:e.jsx(_e,{})})})}}),G&&e.jsx(j,{label:`${We.length} of ${$.filter(s=>s.subscription).length} licenses found`,color:"primary",variant:"outlined"}),e.jsx(p,{variant:"contained",onClick:us,children:"Add License"})]}),e.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsxs(b,{label:"Subscription Tier",select:!0,size:"small",value:B.tier||"",onChange:s=>Ne(t=>({...t,tier:s.target.value||void 0})),sx:{minWidth:160},children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"BASIC",children:"BASIC"}),e.jsx(o,{value:"PRO",children:"PRO"}),e.jsx(o,{value:"ENTERPRISE",children:"ENTERPRISE"})]}),e.jsxs(b,{label:"Status",select:!0,size:"small",value:B.status||"",onChange:s=>Ne(t=>({...t,status:s.target.value||void 0})),sx:{minWidth:160},children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"active",children:"ACTIVE"}),e.jsx(o,{value:"expired",children:"EXPIRED"}),e.jsx(o,{value:"suspended",children:"SUSPENDED"}),e.jsx(o,{value:"pending",children:"PENDING"})]}),e.jsx(p,{variant:"outlined",children:"Apply Filters"}),e.jsx(p,{onClick:()=>Ne({}),children:"Clear"})]})]}),e.jsx(Se,{component:Y,children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(E,{children:[e.jsx(a,{children:"User"}),e.jsx(a,{children:"Subscription Tier"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Seats"}),e.jsx(a,{children:"Activated"}),e.jsx(a,{children:"Expires"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(te,{children:We.length>0?We.map(s=>e.jsxs(E,{children:[e.jsx(a,{children:e.jsxs(c,{children:[e.jsxs(n,{variant:"subtitle2",children:[s.firstName," ",s.lastName]}),e.jsx(n,{variant:"body2",color:"text.secondary",children:s.email})]})}),e.jsx(a,{children:e.jsx(j,{label:s.subscription,size:"small",color:me(s.subscription),variant:ge(s.subscription)})}),e.jsx(a,{children:e.jsx(j,{label:s.status,size:"small",color:je(s.status)})}),e.jsx(a,{children:e.jsx(n,{variant:"body2",children:"-"})}),e.jsx(a,{children:e.jsx(n,{variant:"body2",children:new Date(s.lastLogin).toLocaleDateString()})}),e.jsx(a,{children:e.jsx(n,{variant:"body2",children:"-"})}),e.jsxs(a,{children:[e.jsx(k,{size:"small",onClick:()=>xs(s),children:e.jsx(bs,{})}),e.jsx(k,{size:"small",onClick:t=>os(t,s),title:"View user licenses",children:e.jsx(ve,{})}),e.jsx(k,{size:"small",onClick:t=>{t.stopPropagation(),$e(s)},title:"Manage seats",children:e.jsx(Oe,{})})]})]},s.id)):e.jsx(E,{children:e.jsx(a,{colSpan:7,align:"center",children:e.jsx(c,{sx:{py:4},children:e.jsx(n,{variant:"body1",color:"text.secondary",children:G?"No licenses found matching your search criteria.":"No users with subscriptions found."})})})})})]})})]}),T===2&&e.jsxs(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{placeholder:"Search payments by ID, email, tier, status, amount, or date...",value:O,onChange:s=>ss(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(K,{position:"start",children:e.jsx(Ye,{})}),endAdornment:O&&e.jsx(K,{position:"end",children:e.jsx(k,{size:"small",onClick:ks,children:e.jsx(_e,{})})})}}),O&&e.jsx(j,{label:`${Fe.length} of ${ie.length} payments found`,color:"primary",variant:"outlined"})]}),e.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(b,{label:"Filter by Email",size:"small",value:w.email||"",onChange:s=>le(t=>({...t,email:s.target.value}))}),e.jsx(b,{label:"From",size:"small",type:"date",InputLabelProps:{shrink:!0},value:w.from||"",onChange:s=>le(t=>({...t,from:s.target.value}))}),e.jsx(b,{label:"To",size:"small",type:"date",InputLabelProps:{shrink:!0},value:w.to||"",onChange:s=>le(t=>({...t,to:s.target.value}))}),e.jsxs(b,{label:"Status",select:!0,size:"small",value:w.status||"",onChange:s=>le(t=>({...t,status:s.target.value||void 0})),sx:{minWidth:160},children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"SUCCEEDED",children:"SUCCEEDED"}),e.jsx(o,{value:"PENDING",children:"PENDING"}),e.jsx(o,{value:"FAILED",children:"FAILED"}),e.jsx(o,{value:"REFUNDED",children:"REFUNDED"})]}),e.jsx(p,{variant:"outlined",onClick:()=>ds(1),children:"Apply Filters"})]})]}),e.jsx(Se,{component:Y,children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(E,{children:[e.jsx(a,{children:"Payment ID"}),e.jsx(a,{children:"User"}),e.jsx(a,{children:"Tier"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Invoice"}),e.jsx(a,{children:"Details"})]})}),e.jsx(te,{children:Fe.length>0?Fe.map(s=>{var t,r,i,h;return e.jsxs(E,{children:[e.jsx(a,{children:e.jsx(n,{variant:"body2",fontFamily:"monospace",children:s.id})}),e.jsx(a,{children:e.jsx(n,{variant:"body2",children:((t=s.user)==null?void 0:t.email)||"â€”"})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:((r=s.subscription)==null?void 0:r.tier)||"â€”",color:me((i=s.subscription)==null?void 0:i.tier),variant:ge((h=s.subscription)==null?void 0:h.tier)})}),e.jsx(a,{children:e.jsx(n,{variant:"body2",children:cs(s.amount)})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:s.status,color:s.status==="SUCCEEDED"?"success":s.status==="FAILED"?"error":"default"})}),e.jsx(a,{children:e.jsx(n,{variant:"body2",children:W(s.createdAt).toLocaleDateString()})}),e.jsx(a,{children:s.stripeInvoiceId?e.jsx(p,{size:"small",variant:"outlined",onClick:()=>{const f=localStorage.getItem("auth_token"),m=`/api/invoices/${s.stripeInvoiceId}/pdf${f?`?token=${encodeURIComponent(f)}`:""}`;window.open(m,"_blank")},children:"View"}):s.receiptUrl?e.jsx(p,{size:"small",variant:"outlined",onClick:()=>window.open(s.receiptUrl,"_blank"),children:"View"}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"N/A"})}),e.jsx(a,{children:e.jsx(p,{size:"small",onClick:()=>Ws(s.id),children:"Open"})})]},s.id)}):e.jsx(E,{children:e.jsx(a,{colSpan:8,align:"center",children:e.jsx(c,{sx:{py:4},children:e.jsx(n,{variant:"body1",color:"text.secondary",children:O?"No payments found matching your search criteria.":"No payments available."})})})})})]})}),e.jsxs(c,{sx:{display:"flex",gap:1,justifyContent:"flex-end",mt:2},children:[e.jsx(p,{disabled:J<=1,onClick:()=>Pe(s=>Math.max(1,s-1)),children:"Prev"}),e.jsx(j,{label:`Page ${J} of ${Re}`}),e.jsx(p,{disabled:J>=Re,onClick:()=>Pe(s=>Math.min(Re,s+1)),children:"Next"})]})]}),T===3&&e.jsx(c,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:e.jsxs(u,{container:!0,spacing:3,children:[e.jsx(u,{item:!0,xs:12,md:6,children:e.jsxs(Y,{sx:{p:3},children:[e.jsx(n,{variant:"h6",sx:{mb:2},children:"System Status"}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(j,{label:`Overall: ${((x==null?void 0:x.overall)||"unknown").toUpperCase()}`,color:(x==null?void 0:x.overall)==="healthy"?"success":(x==null?void 0:x.overall)==="degraded"?"warning":(x==null?void 0:x.overall)==="unhealthy"?"error":"default"}),e.jsx(p,{size:"small",onClick:zs,disabled:Qe,children:Qe?"Refreshingâ€¦":"Refresh"})]}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(De,{title:"Database",data:x==null?void 0:x.database})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(De,{title:"Email (SendGrid)",data:x==null?void 0:x.email})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(De,{title:"Payments (Stripe)",data:x==null?void 0:x.payment})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(De,{title:"Webhooks",data:x==null?void 0:x.webhooks})})]})]})}),e.jsx(u,{item:!0,xs:12,md:6,children:e.jsxs(Y,{sx:{p:3},children:[e.jsx(n,{variant:"h6",sx:{mb:2},children:"Recent Activity"}),e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Checked at: ",x!=null&&x.checkedAt?new Date(x.checkedAt).toLocaleString():"â€”"]}),(hs=x==null?void 0:x.webhooks)!=null&&hs.metrics?e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"body2",children:["Recent webhooks (24h): ",x.webhooks.metrics.recentWebhooks]}),e.jsxs(n,{variant:"body2",children:["Failed webhooks: ",x.webhooks.metrics.failedWebhooks]})]}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"No metrics available"})]})]})})]})})]}),e.jsxs(Ce,{open:Ds,onClose:()=>oe(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ie,{children:"Edit User"}),e.jsx(we,{children:U&&e.jsxs(u,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,label:"First Name",value:U.firstName,disabled:!0})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,label:"Last Name",value:U.lastName,disabled:!0})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,label:"Email",value:U.email,disabled:!0})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsxs(fs,{fullWidth:!0,children:[e.jsx(vs,{children:"Role"}),e.jsxs(ys,{value:U.role,label:"Role",inputProps:{"aria-label":"Select user role",title:"Choose the user role"},onChange:s=>ce(t=>t&&{...t,role:String(s.target.value)}),children:[e.jsx(o,{value:"USER",children:"User"}),e.jsx(o,{value:"ADMIN",children:"Admin"})]})]})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(n,{variant:"caption",color:"text.secondary",children:"Role is enforced by active subscription tier: BASIC â†’ User; PRO/ENTERPRISE â†’ Admin. Elevation to SuperAdmin is not allowed via UI."})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsxs(fs,{fullWidth:!0,children:[e.jsx(vs,{children:"Status"}),e.jsxs(ys,{value:U.status,label:"Status",inputProps:{"aria-label":"Select user status",title:"Choose the user status"},onChange:s=>ce(t=>t&&{...t,status:String(s.target.value)}),children:[e.jsx(o,{value:"active",children:"Active"}),e.jsx(o,{value:"suspended",children:"Suspended"}),e.jsx(o,{value:"pending",children:"Pending"})]})]})})]})}),e.jsxs(Ae,{children:[e.jsx(p,{onClick:()=>oe(!1),children:"Cancel"}),U&&e.jsx(p,{onClick:()=>$e(U),children:"Manage Seats"}),e.jsx(p,{onClick:Fs,variant:"contained",children:"Save Changes"})]})]}),e.jsxs(Ce,{open:ws,onClose:()=>ke(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Ie,{children:"Payment Details"}),e.jsx(we,{children:N.payment?e.jsxs(c,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(c,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(j,{label:`ID: ${N.payment.id}`}),e.jsx(j,{label:`User: ${((ps=N.payment.user)==null?void 0:ps.email)||"â€”"}`}),e.jsx(j,{label:`Amount: $${(N.payment.amount/100).toFixed(2)}`}),e.jsx(j,{label:`Status: ${N.payment.status}`}),e.jsx(j,{label:`Date: ${new Date(N.payment.createdAt).toLocaleString()}`}),N.payment.receiptUrl&&e.jsx(p,{size:"small",variant:"outlined",onClick:()=>window.open(N.payment.receiptUrl,"_blank"),children:"View Invoice"})]}),e.jsx(n,{variant:"subtitle2",children:"Related Licenses"}),e.jsx(Se,{component:Y,children:e.jsxs(ee,{size:"small",children:[e.jsx(se,{children:e.jsxs(E,{children:[e.jsx(a,{children:"License Key"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Activated"}),e.jsx(a,{children:"Expires"})]})}),e.jsx(te,{children:(N.licenses||[]).map(s=>e.jsxs(E,{children:[e.jsx(a,{children:e.jsx(n,{variant:"body2",fontFamily:"monospace",children:s.key})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:s.status,color:je(String(s.status).toLowerCase())})}),e.jsx(a,{children:s.activatedAt?new Date(s.activatedAt).toLocaleDateString():"â€”"}),e.jsx(a,{children:s.expiresAt?new Date(s.expiresAt).toLocaleDateString():"â€”"})]},s.id))})]})})]}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"No details."})}),e.jsx(Ae,{children:e.jsx(p,{onClick:()=>ke(!1),children:"Close"})})]}),e.jsxs(Js,{open:!!as,anchorEl:as,onClose:Ts,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{p:2,maxWidth:560}},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(ve,{fontSize:"small",color:"action"}),e.jsx(n,{variant:"subtitle1",children:(Te==null?void 0:Te.email)||"Licenses"})]}),Ls?e.jsx(n,{variant:"body2",color:"text.secondary",children:"Loading..."}):is.length>0?e.jsxs(ee,{size:"small",children:[e.jsx(se,{children:e.jsxs(E,{children:[e.jsx(a,{children:"License Key"}),e.jsx(a,{children:"Tier"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Expires"})]})}),e.jsx(te,{children:is.map(s=>e.jsxs(E,{children:[e.jsx(a,{children:e.jsx(n,{variant:"body2",fontFamily:"monospace",children:s.key})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:s.tier,color:me(s.tier),variant:ge(s.tier)})}),e.jsx(a,{children:e.jsx(j,{size:"small",label:s.status,color:je(s.status)})}),e.jsx(a,{children:e.jsx(n,{variant:"body2",children:new Date(s.expiresAt).toLocaleDateString()})})]},s.id))})]}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"No licenses found for this user."})]}),e.jsxs(Ce,{open:Us,onClose:()=>xe(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Ie,{children:"Add License"}),e.jsx(we,{children:e.jsxs(u,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(b,{select:!0,fullWidth:!0,label:"User",value:M.userId,onChange:s=>Ms(s.target.value),children:$.map(s=>e.jsx(o,{value:s.id,children:s.email},s.id))})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(b,{select:!0,fullWidth:!0,label:"Subscription",value:M.subscriptionId,onChange:s=>ue(t=>({...t,subscriptionId:s.target.value})),disabled:!He.length,children:He.map(s=>e.jsxs(o,{value:s.id,children:[s.tier," â€” seats ",s.seats]},s.id))})}),e.jsx(u,{item:!0,xs:6,children:e.jsxs(b,{select:!0,fullWidth:!0,label:"Tier",value:M.tier,onChange:s=>ue(t=>({...t,tier:s.target.value})),children:[e.jsx(o,{value:"BASIC",children:"BASIC"}),e.jsx(o,{value:"PRO",children:"PRO"}),e.jsx(o,{value:"ENTERPRISE",children:"ENTERPRISE"})]})}),e.jsx(u,{item:!0,xs:6,children:e.jsx(b,{fullWidth:!0,type:"number",label:"Seats",inputProps:{min:1,max:1e3},value:M.seats,onChange:s=>ue(t=>({...t,seats:Math.max(1,Math.min(1e3,parseInt(s.target.value)||1))}))})})]})}),e.jsxs(Ae,{children:[e.jsx(p,{onClick:()=>xe(!1),children:"Cancel"}),e.jsx(p,{variant:"contained",onClick:Os,disabled:!M.userId||!M.subscriptionId,children:"Create"})]})]}),e.jsxs(Ce,{open:Es,onClose:()=>de(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(Ie,{children:"Manage Seats"}),e.jsx(we,{children:z?e.jsxs(u,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(u,{item:!0,xs:12,children:e.jsxs(Ss,{severity:"info",children:[z.tier," subscription"]})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,type:"number",label:"Total Seats",value:Xe,onChange:s=>Ke(parseInt(s.target.value||"0",10)),inputProps:{min:1,max:z.tier==="PRO"?50:1e3}})})]}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"No active subscription found."})}),e.jsxs(Ae,{children:[e.jsx(p,{onClick:()=>de(!1),children:"Cancel"}),e.jsx(p,{onClick:$s,variant:"contained",disabled:!z,children:"Save"})]})]})]})})})};export{dt as default};
