import{j as e,a as i,b as Ts,an as zs,T as o,h as m,G as h,k as _,l as K,au as Ws,bN as $s,aa as Fs,aQ as We,c as B,b9 as Os,ba as de,u as y,v as G,I as R,bO as $e,az as Fe,d as b,aB as xe,aC as he,aD as ue,aE as D,aF as a,aG as me,aK as is,b1 as Ms,a4 as u,F as Bs,a1 as Ys,bP as Vs,y as Gs,aq as _s,aM as je,aN as pe,aO as ge,aR as ls,aS as os,aT as cs,aP as be,O as Ks,n as qs,t as Xs}from"./mui-BQ0lC4VB.js";import{u as Hs,r as x}from"./vendor-DIxetjBo.js";import{u as Qs}from"./notistack.esm-Bg0Tn0tt.js";import{u as Js,c as C,e as w}from"./index-CBNusD3z.js";import{N as Zs}from"./Navigation-Bxz4zsfj.js";import{F as et}from"./Footer-DGNohavT.js";import"./stripe-0lUOqiTp.js";const fe=({title:Y,data:n})=>{const I=(n==null?void 0:n.status)==="healthy"?"success":(n==null?void 0:n.status)==="degraded"?"warning":(n==null?void 0:n.status)==="unhealthy"?"error":"default";return e.jsx(_,{variant:"outlined",children:e.jsxs(K,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsx(o,{variant:"subtitle1",children:Y}),e.jsx(m,{size:"small",label:((n==null?void 0:n.status)||"unknown").toUpperCase(),color:I})]}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Response time: ",(n==null?void 0:n.responseTimeMs)!=null?`${n.responseTimeMs} ms`:"â€”"]})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(o,{variant:"body2",color:"text.secondary",children:(n==null?void 0:n.message)||""})}),(n==null?void 0:n.error)&&e.jsx(h,{item:!0,xs:12,children:e.jsx(Xs,{severity:"warning",children:n.error})})]})]})})},ct=()=>{var Ze,es;const{enqueueSnackbar:Y}=Qs(),{user:n}=Js();Hs();const[I,ds]=x.useState(0),[N,q]=x.useState({totalUsers:0,activeSubscriptions:0,totalRevenue:0,pendingApprovals:0,systemHealth:"healthy"}),[T,ye]=x.useState([]),[ve,X]=x.useState([]),[z,Se]=x.useState({}),[st,Oe]=x.useState([]),[ee,xs]=x.useState([]),[H,Ce]=x.useState(1),[we,hs]=x.useState(1),[S,se]=x.useState({}),[us,Ie]=x.useState(!1),[A,ms]=x.useState({}),[V,Me]=x.useState(null),[js,te]=x.useState(!1),[ps,De]=x.useState(!1),[gs,ae]=x.useState(!1),[W,ne]=x.useState({userId:"",subscriptionId:"",tier:"PRO",seats:1}),[Be,Ye]=x.useState([]),[c,re]=x.useState(null),[Ve,Ge]=x.useState(!1),[$,_e]=x.useState(""),[L,Ke]=x.useState(""),[F,qe]=x.useState(""),[Xe,bs]=x.useState(new Set),[Ae,fs]=x.useState(!0),Ee=x.useMemo(()=>{if(!$.trim())return T;const s=$.toLowerCase();return T.filter(t=>t.firstName.toLowerCase().includes(s)||t.lastName.toLowerCase().includes(s)||t.email.toLowerCase().includes(s)||t.role.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||t.subscription&&t.subscription.toLowerCase().includes(s))},[T,$]),Le=x.useMemo(()=>{if(!L.trim())return ve;const s=L.toLowerCase();return ve.filter(t=>t.key.toLowerCase().includes(s)||t.userEmail.toLowerCase().includes(s)||t.tier.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||new Date(t.expiresAt).toLocaleDateString().includes(s)||new Date(t.activatedAt).toLocaleDateString().includes(s))},[ve,L]),Ue=x.useMemo(()=>{const s=new Map;Le.forEach(l=>{const r=s.get(l.userId)||[];r.push(l),s.set(l.userId,r)});const t=T.map(l=>{const r=s.get(l.id)||[],p=r.filter(f=>f.status==="active").length;return{userId:l.id,userEmail:l.email,licenses:r,totalLicenses:r.length,activeLicenses:p}});return(Ae?t:t.filter(l=>l.totalLicenses>0)).sort((l,r)=>l.userEmail.localeCompare(r.userEmail))},[T,Le,Ae]),U=s=>{if(!s)return new Date(NaN);if(typeof s=="string")return new Date(s);if(s instanceof Date)return s;if(typeof s=="object"&&s!==null){if(typeof s._seconds=="number")return new Date(s._seconds*1e3);if(typeof s.seconds=="number")return new Date(s.seconds*1e3);if(typeof s.toDate=="function")try{return s.toDate()}catch{}}return new Date(s)},He=s=>`$${((typeof s=="number"?s:0)/100).toFixed(2)}`,ke=x.useMemo(()=>{if(!F.trim())return ee;const s=F.toLowerCase();return ee.filter(t=>{var d,l;return t.id.toLowerCase().includes(s)||((d=t.user)==null?void 0:d.email)&&t.user.email.toLowerCase().includes(s)||((l=t.subscription)==null?void 0:l.tier)&&t.subscription.tier.toLowerCase().includes(s)||t.status.toLowerCase().includes(s)||U(t.createdAt).toLocaleDateString().toLowerCase().includes(s)||He(t.amount).toLowerCase().includes(s)})},[ee,F]),ys=()=>_e(""),Qe=()=>Ke(""),vs=()=>qe(""),Ss=s=>{bs(t=>{const d=new Set(t);return d.has(s)?d.delete(s):d.add(s),d})};x.useEffect(()=>{let s=!0;return(async()=>{var t,d,l,r,p,f,k,P,Q;try{if(String((n==null?void 0:n.role)||"").toUpperCase()!=="SUPERADMIN"){ye([]),X([]),q(j=>({...j,systemHealth:"warning"}));return}const[v,O,ie,ze,J]=await Promise.all([C.get(`${w.admin.users()}?page=1&limit=100`),C.get(`${w.admin.licenses()}?page=1&limit=100`),C.get(w.admin.paymentAnalytics()),C.get(w.admin.systemHealth()),C.get(w.admin.dashboardStats())]),le=((d=(t=v.data)==null?void 0:t.data)==null?void 0:d.users)??[],oe=((r=(l=O.data)==null?void 0:l.data)==null?void 0:r.licenses)??[],E=((f=(p=J.data)==null?void 0:p.data)==null?void 0:f.stats)??{totalRevenue:0,activeSubscriptions:0},Ns=(E==null?void 0:E.recentPayments)??[],M=((P=(k=ze.data)==null?void 0:k.data)==null?void 0:P.health)||((Q=ze.data)==null?void 0:Q.data),ss=(M==null?void 0:M.overall)||(M==null?void 0:M.status)||"healthy";if(!s)return;ye(le.map(j=>{var Z,ts,ce,as,ns,rs;return{id:j.id,email:j.email,firstName:((Z=j.name)==null?void 0:Z.split(" ")[0])??"",lastName:((ts=j.name)==null?void 0:ts.split(" ").slice(1).join(" "))??"",role:j.role,status:((as=(ce=j.status)==null?void 0:ce.toLowerCase)==null?void 0:as.call(ce))||"active",subscription:((rs=(ns=j.subscriptions)==null?void 0:ns[0])==null?void 0:rs.tier)??void 0,lastLogin:j.lastLoginAt||new Date().toISOString(),createdAt:j.createdAt||new Date().toISOString()}})),X(oe.map(j=>{var Z;return{id:j.id,key:j.key,userId:j.userId,userEmail:((Z=j.user)==null?void 0:Z.email)??"",tier:j.tier,status:String(j.status||"").toLowerCase(),activatedAt:new Date(U(j.activatedAt||j.createdAt)).toISOString(),expiresAt:new Date(U(j.expiresAt||j.createdAt)).toISOString(),lastUsed:new Date(U(j.updatedAt||j.createdAt)).toISOString()}})),q({totalUsers:Number(E.totalUsers||le.length)||0,activeSubscriptions:E.activeSubscriptions??0,totalRevenue:Math.round(E.totalRevenue??0)/100,pendingApprovals:0,systemHealth:ss==="healthy"?"healthy":ss==="degraded"?"warning":"error"}),re(M||null),Oe(Ns)}catch{if(!s)return;ye([]),X([]),q(v=>({...v,systemHealth:"error"})),Oe([]),re(null)}})(),()=>{s=!1}},[n==null?void 0:n.role]);const Pe=async()=>{var f,k,P,Q;const s=g=>{const v=new URLSearchParams;return v.set("page",String(g)),v.set("limit","100"),z.tier&&v.set("tier",String(z.tier)),z.status&&v.set("status",String(z.status)),v.toString()},t=await C.get(`${w.admin.licenses()}?${s(1)}`),d=((k=(f=t.data)==null?void 0:f.data)==null?void 0:k.licenses)??[],l=((Q=(P=t.data)==null?void 0:P.data)==null?void 0:Q.pagination)??{pages:1},r=Math.max(1,Number(l.pages)||1);let p=[...d];if(r>1){const g=Array.from({length:r-1},(O,ie)=>ie+2),v=5;for(let O=0;O<g.length;O+=v){const ie=g.slice(O,O+v);(await Promise.all(ie.map(J=>C.get(`${w.admin.licenses()}?${s(J)}`)))).forEach(J=>{var oe,E;const le=((E=(oe=J.data)==null?void 0:oe.data)==null?void 0:E.licenses)??[];p=p.concat(le)})}}X(p.map(g=>{var v;return{id:g.id,key:g.key,userId:g.userId,userEmail:((v=g.user)==null?void 0:v.email)??"",tier:g.tier,status:String(g.status||"").toLowerCase(),activatedAt:new Date(U(g.activatedAt||g.createdAt)).toISOString(),expiresAt:new Date(U(g.expiresAt||g.createdAt)).toISOString(),lastUsed:new Date(U(g.updatedAt||g.createdAt)).toISOString()}}))};x.useEffect(()=>{String((n==null?void 0:n.role)||"").toUpperCase()==="SUPERADMIN"&&I===1&&Pe().catch(()=>{})},[I,z,n==null?void 0:n.role]);const Cs=async()=>{var s,t,d;try{Ge(!0);const l=await C.get(w.admin.systemHealth()),r=((t=(s=l.data)==null?void 0:s.data)==null?void 0:t.health)||((d=l.data)==null?void 0:d.data);re(r||null);const p=(r==null?void 0:r.overall)||"healthy";q(f=>({...f,systemHealth:p==="healthy"?"healthy":p==="degraded"?"warning":"error"}))}catch{re(null),q(l=>({...l,systemHealth:"error"}))}finally{Ge(!1)}},Je=async(s=1)=>{var p,f,k,P;const t=new URLSearchParams;t.set("page",String(s)),t.set("limit","100"),S.status&&t.set("status",S.status),S.email&&t.set("email",S.email),S.from&&t.set("from",S.from),S.to&&t.set("to",S.to);const d=await C.get(`${w.admin.payments()}?${t.toString()}`),l=((f=(p=d.data)==null?void 0:p.data)==null?void 0:f.payments)??[],r=((P=(k=d.data)==null?void 0:k.data)==null?void 0:P.pagination)??{pages:1,page:1};xs(l),Ce(r.page||s),hs(r.pages||1)};x.useEffect(()=>{String((n==null?void 0:n.role)||"").toUpperCase()==="SUPERADMIN"&&I===2&&Je(H).catch(()=>{})},[I,H,S,n==null?void 0:n.role]);const ws=async s=>{var t;try{const l=((t=(await C.get(w.admin.paymentDetails(s))).data)==null?void 0:t.data)||{};ms({payment:l.payment,licenses:l.licenses||[]}),Ie(!0)}catch{Y("Failed to load payment details",{variant:"error"})}},Is=s=>{Me(s),te(!0)},Ds=()=>{Y("User updated successfully",{variant:"success"}),te(!1),Me(null)},As=()=>{De(!0)},Es=async()=>{ae(!0)},Ls=async s=>{var t,d,l;if(ne(r=>({...r,userId:s,subscriptionId:""})),s){const p=((l=(d=(t=(await C.get(w.admin.userDetails(s))).data)==null?void 0:t.data)==null?void 0:d.user)==null?void 0:l.subscriptions)||[];Ye(p.filter(f=>f.status==="ACTIVE"))}else Ye([])},Us=async()=>{var s,t;try{await C.post(w.admin.createLicense(),W),Y("License(s) created",{variant:"success"}),ae(!1);const l=((t=(s=(await C.get(w.admin.licenses())).data)==null?void 0:s.data)==null?void 0:t.licenses)??[];X(l.map(r=>{var p;return{id:r.id,key:r.key,userId:r.userId,userEmail:((p=r.user)==null?void 0:p.email)??"",tier:r.tier,status:(r.status||"").toLowerCase(),activatedAt:r.activatedAt||r.createdAt,expiresAt:r.expiresAt||r.createdAt,lastUsed:r.updatedAt||r.createdAt}}))}catch(d){Y((d==null?void 0:d.message)||"Failed to create license",{variant:"error"})}},Re=s=>{switch(s){case"active":return"success";case"pending":return"warning";case"suspended":return"error";default:return"default"}},ks=s=>{switch(String(s||"").toUpperCase()){case"SUPERADMIN":return"secondary";case"ADMIN":return"primary";default:return"default"}},Ne=s=>{switch(String(s||"").toUpperCase()){case"ENTERPRISE":return"secondary";case"PRO":return"success";case"BASIC":return"default";default:return"default"}},Te=s=>String(s||"").toUpperCase()==="BASIC"?"outlined":"filled",Ps=s=>{switch(s){case"healthy":return"success";case"warning":return"warning";case"error":return"error";default:return"default"}},Rs=s=>{switch(s){case"healthy":return e.jsx(qs,{});case"warning":return e.jsx(We,{});case"error":return e.jsx(Ks,{});default:return e.jsx(We,{})}};return e.jsxs(e.Fragment,{children:[e.jsx(Zs,{}),e.jsx(i,{sx:{pt:8,pb:4},children:e.jsxs(Ts,{maxWidth:"xl",children:[e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards","@keyframes fadeInUp":{"0%":{opacity:0,transform:"translateY(20px)"},"100%":{opacity:1,transform:"translateY(0)"}}},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:4},children:[e.jsx(zs,{sx:{fontSize:32,color:"primary.main"}}),e.jsx(o,{variant:"h4",sx:{fontWeight:700},children:"Admin Dashboard"}),e.jsx(m,{icon:Rs(N.systemHealth),label:`System ${N.systemHealth}`,color:Ps(N.systemHealth),size:"small"})]}),e.jsxs(h,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(h,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.1s forwards"},children:e.jsx(_,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(K,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Ws,{sx:{color:"primary.main"}}),e.jsx(o,{variant:"h6",color:"text.secondary",children:"Total Users"})]}),e.jsx(o,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:N.totalUsers.toLocaleString()})]})})})}),e.jsx(h,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.2s forwards"},children:e.jsx(_,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(K,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx($s,{sx:{color:"secondary.main"}}),e.jsx(o,{variant:"h6",color:"text.secondary",children:"Active Subscriptions"})]}),e.jsx(o,{variant:"h3",sx:{fontWeight:700},children:N.activeSubscriptions.toLocaleString()})]})})})}),e.jsx(h,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.3s forwards"},children:e.jsx(_,{sx:{background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(139, 195, 74, 0.1) 100%)",border:"1px solid rgba(76, 175, 80, 0.2)"},children:e.jsxs(K,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(Fs,{sx:{color:"success.main"}}),e.jsx(o,{variant:"h6",color:"text.secondary",children:"Total Revenue"})]}),e.jsxs(o,{variant:"h3",sx:{fontWeight:700,color:"success.main"},children:["$",N.totalRevenue.toLocaleString()]})]})})})}),e.jsx(h,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out 0.4s forwards"},children:e.jsx(_,{sx:{background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 193, 7, 0.1) 100%)",border:"1px solid rgba(255, 152, 0, 0.2)"},children:e.jsxs(K,{children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(We,{sx:{color:"warning.main"}}),e.jsx(o,{variant:"h6",color:"text.secondary",children:"Pending Approvals"})]}),e.jsx(o,{variant:"h3",sx:{fontWeight:700,color:"warning.main"},children:N.pendingApprovals})]})})})})]}),e.jsx(B,{sx:{mb:3},children:e.jsxs(Os,{value:I,onChange:(s,t)=>ds(t),sx:{borderBottom:1,borderColor:"divider","& .MuiTab-root":{textTransform:"none",fontWeight:600}},children:[e.jsx(de,{label:"Users"}),e.jsx(de,{label:"Licenses"}),e.jsx(de,{label:"Invoices"}),e.jsx(de,{label:"System Health"})]})}),I===0&&e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(y,{placeholder:"Search users by name, email, role, status, or subscription...",value:$,onChange:s=>_e(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(G,{position:"start",children:e.jsx(Fe,{})}),endAdornment:$&&e.jsx(G,{position:"end",children:e.jsx(R,{size:"small",onClick:ys,children:e.jsx($e,{})})})}}),e.jsx(b,{variant:"contained",onClick:Es,children:"Add License"})]}),$&&e.jsx(i,{sx:{mb:2},children:e.jsx(m,{label:`${Ee.length} of ${T.length} users found`,color:"primary",variant:"outlined"})}),e.jsx(xe,{component:B,children:e.jsxs(he,{children:[e.jsx(ue,{children:e.jsxs(D,{children:[e.jsx(a,{children:"User"}),e.jsx(a,{children:"Role"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Subscription"}),e.jsx(a,{children:"Last Login"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(me,{children:Ee.length>0?Ee.map(s=>e.jsxs(D,{children:[e.jsx(a,{children:e.jsxs(i,{children:[e.jsxs(o,{variant:"subtitle2",children:[s.firstName," ",s.lastName]}),e.jsx(o,{variant:"body2",color:"text.secondary",children:s.email})]})}),e.jsx(a,{children:e.jsx(m,{label:s.role,size:"small",color:ks(s.role)})}),e.jsx(a,{children:e.jsx(m,{label:s.status,size:"small",color:Re(s.status)})}),e.jsx(a,{children:s.subscription&&e.jsx(m,{label:s.subscription,size:"small",color:Ne(s.subscription),variant:Te(s.subscription)})}),e.jsx(a,{children:e.jsx(o,{variant:"body2",children:new Date(s.lastLogin).toLocaleDateString()})}),e.jsxs(a,{children:[e.jsx(R,{size:"small",onClick:()=>Is(s),children:e.jsx(is,{})}),e.jsx(R,{size:"small",color:"error",children:e.jsx(Ms,{})})]})]},s.id)):e.jsx(D,{children:e.jsx(a,{colSpan:6,align:"center",children:e.jsx(i,{sx:{py:4},children:e.jsx(o,{variant:"body1",color:"text.secondary",children:$?"No users found matching your search criteria.":"No users available."})})})})})]})})]}),I===1&&e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(y,{placeholder:"Search licenses by key, user email, tier, status, or dates...",value:L,onChange:s=>Ke(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(G,{position:"start",children:e.jsx(Fe,{})}),endAdornment:L&&e.jsx(G,{position:"end",children:e.jsx(R,{size:"small",onClick:Qe,children:e.jsx($e,{})})})}}),e.jsxs(i,{sx:{display:"flex",gap:1,alignItems:"center"},children:[e.jsxs(y,{select:!0,size:"small",label:"Tier",sx:{minWidth:140},value:z.tier||"",onChange:s=>Se(t=>({...t,tier:void 0})),children:[e.jsx(u,{value:"",children:"All"}),e.jsx(u,{value:"BASIC",children:"BASIC"}),e.jsx(u,{value:"PRO",children:"PRO"}),e.jsx(u,{value:"ENTERPRISE",children:"ENTERPRISE"})]}),e.jsx(m,{size:"small",label:Ae?"Showing users with 0 licenses":"Hiding users with 0 licenses",onClick:()=>fs(s=>!s),variant:"outlined"}),e.jsxs(y,{select:!0,size:"small",label:"Status",sx:{minWidth:160},value:z.status||"",onChange:s=>Se(t=>({...t,status:s.target.value||void 0})),children:[e.jsx(u,{value:"",children:"All"}),e.jsx(u,{value:"ACTIVE",children:"ACTIVE"}),e.jsx(u,{value:"PENDING",children:"PENDING"}),e.jsx(u,{value:"SUSPENDED",children:"SUSPENDED"}),e.jsx(u,{value:"EXPIRED",children:"EXPIRED"}),e.jsx(u,{value:"REVOKED",children:"REVOKED"})]}),e.jsx(b,{variant:"outlined",onClick:()=>Pe(),children:"Apply"}),e.jsx(b,{onClick:()=>{Se({}),Pe().catch(()=>{})},children:"Clear"})]})]}),e.jsxs(i,{sx:{mb:2,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(m,{label:`${Ue.length} Users with Licenses`,color:"primary",variant:"outlined"}),e.jsx(m,{label:`${Le.length} Total Licenses`,color:"secondary",variant:"outlined"}),L&&e.jsx(m,{label:`Search: ${L}`,color:"info",variant:"outlined",onDelete:Qe})]}),e.jsx(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:Ue.length>0?Ue.map(s=>e.jsx(_,{variant:"outlined",children:e.jsxs(K,{sx:{p:0},children:[e.jsx(i,{sx:{p:2,backgroundColor:"background.default",borderBottom:"1px solid",borderColor:"divider",cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>Ss(s.userEmail),children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Bs,{color:"primary"}),e.jsxs(i,{children:[e.jsx(o,{variant:"h6",component:"div",children:s.userEmail}),e.jsxs(i,{sx:{display:"flex",gap:1,mt:.5},children:[e.jsx(m,{size:"small",label:`${s.totalLicenses} Total Licenses`,color:"primary",variant:"outlined"}),e.jsx(m,{size:"small",label:`${s.activeLicenses} Active`,color:"success",variant:"outlined"})]})]})]}),e.jsx(i,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(Ys,{sx:{transform:Xe.has(s.userEmail)?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"}})})]})}),e.jsx(Vs,{in:Xe.has(s.userEmail),children:e.jsx(xe,{component:B,sx:{borderRadius:0},children:e.jsxs(he,{size:"small",children:[e.jsx(ue,{children:e.jsxs(D,{children:[e.jsx(a,{children:"License Key"}),e.jsx(a,{children:"Tier"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Expires"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(me,{children:s.licenses.map(t=>e.jsxs(D,{children:[e.jsx(a,{children:e.jsx(o,{variant:"body2",fontFamily:"monospace",children:t.key})}),e.jsx(a,{children:e.jsx(m,{label:t.tier,size:"small",color:Ne(t.tier),variant:Te(t.tier)})}),e.jsx(a,{children:e.jsx(m,{label:t.status,size:"small",color:Re(String(t.status).toLowerCase())})}),e.jsx(a,{children:e.jsx(o,{variant:"body2",children:new Date(t.expiresAt).toLocaleDateString()})}),e.jsxs(a,{children:[e.jsx(R,{size:"small",onClick:()=>As(),children:e.jsx(is,{})}),e.jsx(R,{size:"small",children:e.jsx(Gs,{})}),e.jsx(R,{size:"small",children:e.jsx(_s,{})})]})]},t.id))})]})})})]})},s.userEmail)):e.jsx(i,{sx:{py:4,textAlign:"center"},children:e.jsx(o,{variant:"body1",color:"text.secondary",children:L?"No licenses found matching your search criteria.":"No licenses available."})})})]}),I===2&&e.jsxs(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:[e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(y,{placeholder:"Search payments by ID, email, tier, status, amount, or date...",value:F,onChange:s=>qe(s.target.value),size:"small",sx:{minWidth:400},InputProps:{startAdornment:e.jsx(G,{position:"start",children:e.jsx(Fe,{})}),endAdornment:F&&e.jsx(G,{position:"end",children:e.jsx(R,{size:"small",onClick:vs,children:e.jsx($e,{})})})}}),F&&e.jsx(m,{label:`${ke.length} of ${ee.length} payments found`,color:"primary",variant:"outlined"})]}),e.jsxs(i,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(y,{label:"Filter by Email",size:"small",value:S.email||"",onChange:s=>se(t=>({...t,email:s.target.value}))}),e.jsx(y,{label:"From",size:"small",type:"date",InputLabelProps:{shrink:!0},value:S.from||"",onChange:s=>se(t=>({...t,from:s.target.value}))}),e.jsx(y,{label:"To",size:"small",type:"date",InputLabelProps:{shrink:!0},value:S.to||"",onChange:s=>se(t=>({...t,to:s.target.value}))}),e.jsxs(y,{label:"Status",select:!0,size:"small",value:S.status||"",onChange:s=>se(t=>({...t,status:s.target.value||void 0})),sx:{minWidth:160},children:[e.jsx(u,{value:"",children:"All"}),e.jsx(u,{value:"SUCCEEDED",children:"SUCCEEDED"}),e.jsx(u,{value:"PENDING",children:"PENDING"}),e.jsx(u,{value:"FAILED",children:"FAILED"}),e.jsx(u,{value:"REFUNDED",children:"REFUNDED"})]}),e.jsx(b,{variant:"outlined",onClick:()=>Je(1),children:"Apply Filters"})]})]}),e.jsx(xe,{component:B,children:e.jsxs(he,{children:[e.jsx(ue,{children:e.jsxs(D,{children:[e.jsx(a,{children:"Payment ID"}),e.jsx(a,{children:"User"}),e.jsx(a,{children:"Tier"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Invoice"}),e.jsx(a,{children:"Details"})]})}),e.jsx(me,{children:ke.length>0?ke.map(s=>{var t,d,l,r;return e.jsxs(D,{children:[e.jsx(a,{children:e.jsx(o,{variant:"body2",fontFamily:"monospace",children:s.id})}),e.jsx(a,{children:e.jsx(o,{variant:"body2",children:((t=s.user)==null?void 0:t.email)||"â€”"})}),e.jsx(a,{children:e.jsx(m,{size:"small",label:((d=s.subscription)==null?void 0:d.tier)||"â€”",color:Ne((l=s.subscription)==null?void 0:l.tier),variant:Te((r=s.subscription)==null?void 0:r.tier)})}),e.jsx(a,{children:e.jsx(o,{variant:"body2",children:He(s.amount)})}),e.jsx(a,{children:e.jsx(m,{size:"small",label:s.status,color:s.status==="SUCCEEDED"?"success":s.status==="FAILED"?"error":"default"})}),e.jsx(a,{children:e.jsx(o,{variant:"body2",children:U(s.createdAt).toLocaleDateString()})}),e.jsx(a,{children:s.stripeInvoiceId?e.jsx(b,{size:"small",variant:"outlined",onClick:()=>{const p=localStorage.getItem("auth_token"),f=`/api/invoices/${s.stripeInvoiceId}/pdf${p?`?token=${encodeURIComponent(p)}`:""}`;window.open(f,"_blank")},children:"View"}):s.receiptUrl?e.jsx(b,{size:"small",variant:"outlined",onClick:()=>window.open(s.receiptUrl,"_blank"),children:"View"}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"N/A"})}),e.jsx(a,{children:e.jsx(b,{size:"small",onClick:()=>ws(s.id),children:"Open"})})]},s.id)}):e.jsx(D,{children:e.jsx(a,{colSpan:8,align:"center",children:e.jsx(i,{sx:{py:4},children:e.jsx(o,{variant:"body1",color:"text.secondary",children:F?"No payments found matching your search criteria.":"No payments available."})})})})})]})}),e.jsxs(i,{sx:{display:"flex",gap:1,justifyContent:"flex-end",mt:2},children:[e.jsx(b,{disabled:H<=1,onClick:()=>Ce(s=>Math.max(1,s-1)),children:"Prev"}),e.jsx(m,{label:`Page ${H} of ${we}`}),e.jsx(b,{disabled:H>=we,onClick:()=>Ce(s=>Math.min(we,s+1)),children:"Next"})]})]}),I===3&&e.jsx(i,{sx:{opacity:0,transform:"translateY(20px)",animation:"fadeInUp 0.6s ease-out forwards"},children:e.jsxs(h,{container:!0,spacing:3,children:[e.jsx(h,{item:!0,xs:12,md:6,children:e.jsxs(B,{sx:{p:3},children:[e.jsx(o,{variant:"h6",sx:{mb:2},children:"System Status"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(m,{label:`Overall: ${((c==null?void 0:c.overall)||"unknown").toUpperCase()}`,color:(c==null?void 0:c.overall)==="healthy"?"success":(c==null?void 0:c.overall)==="degraded"?"warning":(c==null?void 0:c.overall)==="unhealthy"?"error":"default"}),e.jsx(b,{size:"small",onClick:Cs,disabled:Ve,children:Ve?"Refreshingâ€¦":"Refresh"})]}),e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,children:e.jsx(fe,{title:"Database",data:c==null?void 0:c.database})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(fe,{title:"Email (SendGrid)",data:c==null?void 0:c.email})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(fe,{title:"Payments (Stripe)",data:c==null?void 0:c.payment})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(fe,{title:"Webhooks",data:c==null?void 0:c.webhooks})})]})]})}),e.jsx(h,{item:!0,xs:12,md:6,children:e.jsxs(B,{sx:{p:3},children:[e.jsx(o,{variant:"h6",sx:{mb:2},children:"Recent Activity"}),e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Checked at: ",c!=null&&c.checkedAt?new Date(c.checkedAt).toLocaleString():"â€”"]}),(Ze=c==null?void 0:c.webhooks)!=null&&Ze.metrics?e.jsxs(e.Fragment,{children:[e.jsxs(o,{variant:"body2",children:["Recent webhooks (24h): ",c.webhooks.metrics.recentWebhooks]}),e.jsxs(o,{variant:"body2",children:["Failed webhooks: ",c.webhooks.metrics.failedWebhooks]})]}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"No metrics available"})]})]})})]})})]}),e.jsxs(je,{open:js,onClose:()=>te(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(pe,{children:"Edit User"}),e.jsx(ge,{children:V&&e.jsxs(h,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(y,{fullWidth:!0,label:"First Name",value:V.firstName})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(y,{fullWidth:!0,label:"Last Name",value:V.lastName})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Email",value:V.email})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(ls,{fullWidth:!0,children:[e.jsx(os,{children:"Role"}),e.jsxs(cs,{value:V.role,label:"Role",inputProps:{"aria-label":"Select user role",title:"Choose the user role"},children:[e.jsx(u,{value:"USER",children:"User"}),e.jsx(u,{value:"ADMIN",children:"Admin"})]})]})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(ls,{fullWidth:!0,children:[e.jsx(os,{children:"Status"}),e.jsxs(cs,{value:V.status,label:"Status",inputProps:{"aria-label":"Select user status",title:"Choose the user status"},children:[e.jsx(u,{value:"active",children:"Active"}),e.jsx(u,{value:"suspended",children:"Suspended"}),e.jsx(u,{value:"pending",children:"Pending"})]})]})})]})}),e.jsxs(be,{children:[e.jsx(b,{onClick:()=>te(!1),children:"Cancel"}),e.jsx(b,{onClick:Ds,variant:"contained",children:"Save Changes"})]})]}),e.jsxs(je,{open:us,onClose:()=>Ie(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(pe,{children:"Payment Details"}),e.jsx(ge,{children:A.payment?e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(i,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(m,{label:`ID: ${A.payment.id}`}),e.jsx(m,{label:`User: ${((es=A.payment.user)==null?void 0:es.email)||"â€”"}`}),e.jsx(m,{label:`Amount: $${(A.payment.amount/100).toFixed(2)}`}),e.jsx(m,{label:`Status: ${A.payment.status}`}),e.jsx(m,{label:`Date: ${new Date(A.payment.createdAt).toLocaleString()}`}),A.payment.receiptUrl&&e.jsx(b,{size:"small",variant:"outlined",onClick:()=>window.open(A.payment.receiptUrl,"_blank"),children:"View Invoice"})]}),e.jsx(o,{variant:"subtitle2",children:"Related Licenses"}),e.jsx(xe,{component:B,children:e.jsxs(he,{size:"small",children:[e.jsx(ue,{children:e.jsxs(D,{children:[e.jsx(a,{children:"License Key"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Activated"}),e.jsx(a,{children:"Expires"})]})}),e.jsx(me,{children:(A.licenses||[]).map(s=>e.jsxs(D,{children:[e.jsx(a,{children:e.jsx(o,{variant:"body2",fontFamily:"monospace",children:s.key})}),e.jsx(a,{children:e.jsx(m,{size:"small",label:s.status,color:Re(String(s.status).toLowerCase())})}),e.jsx(a,{children:s.activatedAt?new Date(s.activatedAt).toLocaleDateString():"â€”"}),e.jsx(a,{children:s.expiresAt?new Date(s.expiresAt).toLocaleDateString():"â€”"})]},s.id))})]})})]}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"No details."})}),e.jsx(be,{children:e.jsx(b,{onClick:()=>Ie(!1),children:"Close"})})]}),e.jsxs(je,{open:ps,onClose:()=>De(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(pe,{children:"Edit License"}),e.jsx(ge,{children:e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"License management options will be available here."})}),e.jsx(be,{children:e.jsx(b,{onClick:()=>De(!1),children:"Close"})})]}),e.jsxs(je,{open:gs,onClose:()=>ae(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(pe,{children:"Add License"}),e.jsx(ge,{children:e.jsxs(h,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(h,{item:!0,xs:12,children:e.jsx(y,{select:!0,fullWidth:!0,label:"User",value:W.userId,onChange:s=>Ls(s.target.value),children:T.map(s=>e.jsx(u,{value:s.id,children:s.email},s.id))})}),e.jsx(h,{item:!0,xs:12,children:e.jsx(y,{select:!0,fullWidth:!0,label:"Subscription",value:W.subscriptionId,onChange:s=>ne(t=>({...t,subscriptionId:s.target.value})),disabled:!Be.length,children:Be.map(s=>e.jsxs(u,{value:s.id,children:[s.tier," â€” seats ",s.seats]},s.id))})}),e.jsx(h,{item:!0,xs:6,children:e.jsxs(y,{select:!0,fullWidth:!0,label:"Tier",value:W.tier,onChange:s=>ne(t=>({...t,tier:s.target.value})),children:[e.jsx(u,{value:"BASIC",children:"BASIC"}),e.jsx(u,{value:"PRO",children:"PRO"}),e.jsx(u,{value:"ENTERPRISE",children:"ENTERPRISE"})]})}),e.jsx(h,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,type:"number",label:"Seats",inputProps:{min:1,max:1e3},value:W.seats,onChange:s=>ne(t=>({...t,seats:Math.max(1,Math.min(1e3,parseInt(s.target.value)||1))}))})})]})}),e.jsxs(be,{children:[e.jsx(b,{onClick:()=>ae(!1),children:"Cancel"}),e.jsx(b,{variant:"contained",onClick:Us,disabled:!W.userId||!W.subscriptionId,children:"Create"})]})]})]})}),e.jsx(et,{})]})};export{ct as default};
