import{j as e,a as n,A as ne,d as j,R as N,T as l,aG as re,b4 as le,b5 as oe,a6 as R,bg as ce,C as ee,G as o,aq as de,s as xe,bh as E,aE as M,l as v,m as f,av as H,bi as C,F as P,X as Y,Y as q,Z as X,_ as Z,O as J,bj as ge,bk as K,r as Q}from"./mui-Bfk3EfzY.js";import{r as g,b as V}from"./vendor-OeuszDaU.js";import{u as he,c as D,e as A}from"./index-DXZxefko.js";import{M as T}from"./MetricCard-D0ZJbbIx.js";import{S as pe}from"./StorageWarningCard-C5BrfZKy.js";import"./stripe-CV5HSYwT.js";const U=[{label:"Mon",value:0},{label:"Tue",value:0},{label:"Wed",value:0},{label:"Thu",value:0},{label:"Fri",value:0},{label:"Sat",value:0},{label:"Sun",value:0}],L={totalApiCalls:0,responseTime:0,activeDevices:0,dataTransfer:0,dailyUsage:U,topEndpoints:[],geographicData:[],usageMetrics:[]},ue=({data:c,loading:p=!1})=>p?e.jsx(n,{sx:{height:200,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ee,{})}):(Math.max(...c.map(h=>h.value)),e.jsx(n,{sx:{height:200,display:"flex",alignItems:"end",gap:1,px:2},children:c.map(h=>e.jsx(n,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx(l,{variant:"caption",color:"text.secondary",children:h.label})},h.label))})),De=()=>{const{user:c}=he(),[p,h]=g.useState("7d"),[S,ae]=g.useState("api_calls"),[r,w]=g.useState(L),[t,W]=g.useState(!1),[F,G]=g.useState(null),B=async()=>{var a,d,O,$,z;try{W(!0),G(null);const y=String((c==null?void 0:c.role)||"").toUpperCase(),ie=y==="ADMIN"||y==="SUPERADMIN";let u;if(ie)try{const[x,s,m]=await Promise.allSettled([D.get(`${A.admin.licenseAnalytics()}?period=${p}`),D.get(A.admin.systemHealth()),D.get(A.admin.dashboardStats())]),i=x.status==="fulfilled"?((d=(a=x.value.data)==null?void 0:a.data)==null?void 0:d.analytics)||{}:{},b=s.status==="fulfilled"?((O=s.value.data)==null?void 0:O.data)||{}:{},me=m.status==="fulfilled"?(($=m.value.data)==null?void 0:$.data)||{}:{};u={totalApiCalls:i.totalApiCalls||i.activeLicenses||0,responseTime:b.averageResponseTime||98.7,activeDevices:i.activeDevices||i.newLicenses||0,dataTransfer:(i.totalDataTransfer||i.totalLicenses||0)/1e3,dailyUsage:(i.dailyCounts||[]).map(I=>({label:I.date,value:I.count,change:I.change||0}))||U,topEndpoints:i.topEndpoints||[],geographicData:i.geographicDistribution||[],usageMetrics:[{name:"API Calls",value:i.totalApiCalls||i.activeLicenses||0,limit:1e5,unit:"calls",icon:e.jsx(K,{}),color:"#00d4ff"},{name:"Data Transfer",value:(i.totalDataTransfer||i.totalLicenses||0)/1e3,limit:100,unit:"GB",icon:e.jsx(M,{}),color:"#667eea"},{name:"Active Devices",value:i.activeDevices||i.newLicenses||0,limit:50,unit:"devices",icon:e.jsx(E,{}),color:"#f093fb"},{name:"Uptime",value:b.uptimePercentage||99.8,limit:100,unit:"%",icon:e.jsx(Q,{}),color:"#4facfe"}]}}catch(x){console.warn("Admin analytics failed, falling back to basic data:",x),u=L}else try{const s=((z=(await D.get(A.licenses.analytics())).data)==null?void 0:z.data)||{};u={totalApiCalls:s.totalEvents||s.totalApiCalls||0,responseTime:s.averageResponseTime||98.7,activeDevices:s.activeDevices||Object.keys(s.eventTypes||{}).length,dataTransfer:(s.totalDataTransfer||s.totalEvents||0)/1e3,dailyUsage:Object.entries(s.dailyUsage||s.eventTypes||{}).map(([m,i])=>{var b;return{label:m,value:i,change:((b=s.dailyChanges)==null?void 0:b[m])||0}})||U,topEndpoints:s.topEndpoints||[],geographicData:s.geographicData||[],usageMetrics:[{name:"API Calls",value:s.totalEvents||s.totalApiCalls||0,limit:1e5,unit:"calls",icon:e.jsx(K,{}),color:"#00d4ff"},{name:"Data Transfer",value:(s.totalDataTransfer||s.totalEvents||0)/1e3,limit:100,unit:"GB",icon:e.jsx(M,{}),color:"#667eea"},{name:"Active Devices",value:s.activeDevices||Object.keys(s.eventTypes||{}).length,limit:50,unit:"devices",icon:e.jsx(E,{}),color:"#f093fb"},{name:"Uptime",value:s.uptimePercentage||99.8,limit:100,unit:"%",icon:e.jsx(Q,{}),color:"#4facfe"}]}}catch(x){console.warn("User analytics failed, using default data:",x),u=L}w(u)}catch(y){console.error("Failed to fetch analytics data:",y),G("Failed to load analytics data. Please try again."),w(L)}finally{W(!1)}};g.useEffect(()=>{B()},[c==null?void 0:c.role,p]);const se=a=>{h(a.target.value)},k=a=>{ae(a)},_=()=>{B()},te=g.useMemo(()=>r.dailyUsage.length?r.dailyUsage.reduce((a,d)=>a+(d.change||0),0)/r.dailyUsage.length:0,[r.dailyUsage]);return F?e.jsxs(n,{sx:{p:3},children:[e.jsx(ne,{severity:"error",sx:{mb:3},children:F}),e.jsx(j,{variant:"contained",onClick:_,startIcon:e.jsx(N,{}),children:"Retry"})]}):e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(n,{children:[e.jsx(l,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Usage Analytics"}),e.jsx(l,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Monitor your BackboneLogic, Inc. usage patterns and performance"})]}),e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsxs(re,{size:"small",sx:{minWidth:120},children:[e.jsx(le,{children:"Time Range"}),e.jsxs(oe,{value:p,label:"Time Range",onChange:se,disabled:t,inputProps:{"aria-label":"Select time range for analytics",title:"Choose the time period for analytics data"},children:[e.jsx(R,{value:"7d",children:"Last 7 days"}),e.jsx(R,{value:"30d",children:"Last 30 days"}),e.jsx(R,{value:"90d",children:"Last 90 days"})]})]}),e.jsxs(ce,{variant:"outlined",size:"small",children:[e.jsx(j,{variant:S==="api_calls"?"contained":"outlined",onClick:()=>k("api_calls"),disabled:t,children:"API Calls"}),e.jsx(j,{variant:S==="data_transfer"?"contained":"outlined",onClick:()=>k("data_transfer"),disabled:t,children:"Data Transfer"}),e.jsx(j,{variant:S==="devices"?"contained":"outlined",onClick:()=>k("devices"),disabled:t,children:"Devices"})]}),e.jsx(j,{variant:"outlined",onClick:_,disabled:t,startIcon:t?e.jsx(ee,{size:16}):e.jsx(N,{}),children:t?"Loading...":"Refresh"})]})]}),e.jsx(pe,{onUpgrade:()=>window.open("/pricing","_blank"),compact:!1}),e.jsxs(o,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(o,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(T,{title:"Total API Calls",value:t?"Loading...":r.totalApiCalls.toLocaleString(),icon:e.jsx(de,{}),trend:{value:te,direction:"up"},color:"primary"})}),e.jsx(o,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(T,{title:"Response Time",value:t?"Loading...":`${r.responseTime}%`,icon:e.jsx(xe,{}),trend:{value:2.3,direction:"up"},color:"secondary"})}),e.jsx(o,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(T,{title:"Active Devices",value:t?"Loading...":r.activeDevices.toString(),icon:e.jsx(E,{}),trend:{value:12,direction:"up"},color:"warning"})}),e.jsx(o,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(T,{title:"Data Transfer",value:t?"Loading...":`${r.dataTransfer.toFixed(1)} GB`,icon:e.jsx(M,{}),trend:{value:.2,direction:"down"},color:"error"})})]}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,lg:8,children:e.jsx(v,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",mb:3},children:e.jsxs(f,{children:[e.jsx(l,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Usage Trends"}),e.jsx(ue,{data:r.dailyUsage,loading:t})]})})}),e.jsx(o,{item:!0,xs:12,lg:4,children:e.jsx(v,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",mb:3,height:"fit-content"},children:e.jsxs(f,{children:[e.jsx(l,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Real-time Status"}),e.jsx(o,{container:!0,spacing:2,children:r.usageMetrics.map(a=>e.jsx(o,{item:!0,xs:12,children:e.jsx(n,{children:e.jsx(v,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 32px rgba(0,0,0,0.3)"},transition:"all 0.3s ease"},children:e.jsxs(f,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(H,{sx:{bgcolor:a.color,width:40,height:40},children:a.icon}),e.jsx(l,{variant:"h6",sx:{fontWeight:700},children:t?e.jsx(C,{width:80,height:32}):e.jsxs(e.Fragment,{children:[a.value.toLocaleString(),e.jsx(l,{component:"span",variant:"body2",color:"text.secondary",sx:{ml:.5},children:a.unit})]})})]}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:1},children:a.name}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(P,{variant:"determinate",value:t?0:a.value/a.limit*100,sx:{flex:1,height:6,borderRadius:3,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:3,backgroundColor:a.color}}}),e.jsx(l,{variant:"caption",color:"text.secondary",sx:{minWidth:40},children:t?e.jsx(C,{width:30,height:16}):`${(a.value/a.limit*100).toFixed(1)}%`})]})]})})})},a.name))})]})})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(v,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(f,{children:[e.jsx(l,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Top API Endpoints"}),t?e.jsx(n,{children:[1,2,3,4,5].map(a=>e.jsx(n,{sx:{mb:2},children:e.jsx(C,{variant:"rectangular",height:40})},a))}):r.topEndpoints.length>0?e.jsx(Y,{dense:!0,children:r.topEndpoints.map((a,d)=>e.jsxs(V.Fragment,{children:[e.jsxs(q,{sx:{px:0},children:[e.jsx(X,{sx:{minWidth:40},children:e.jsx(H,{sx:{width:32,height:32,bgcolor:"primary.main",fontSize:"0.875rem",fontWeight:600},children:d+1})}),e.jsx(Z,{primary:a.name,secondary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(P,{variant:"determinate",value:a.percentage,sx:{flex:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}}),e.jsxs(l,{variant:"caption",sx:{minWidth:60},children:[a.calls.toLocaleString()," calls"]})]}),primaryTypographyProps:{variant:"body2",fontWeight:500,sx:{fontFamily:"monospace"}}})]}),d<r.topEndpoints.length-1&&e.jsx(J,{sx:{borderColor:"rgba(255,255,255,0.1)"}})]},a.name))}):e.jsx(l,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No endpoint data available"})]})})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(v,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(f,{children:[e.jsx(l,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Geographic Distribution"}),t?e.jsx(n,{children:[1,2,3,4,5].map(a=>e.jsx(n,{sx:{mb:2},children:e.jsx(C,{variant:"rectangular",height:40})},a))}):r.geographicData.length>0?e.jsx(Y,{dense:!0,children:r.geographicData.map((a,d)=>e.jsxs(V.Fragment,{children:[e.jsxs(q,{sx:{px:0},children:[e.jsx(X,{sx:{minWidth:40},children:e.jsx(ge,{sx:{color:"primary.main"}})}),e.jsx(Z,{primary:a.region,secondary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(P,{variant:"determinate",value:a.percentage,sx:{flex:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:"linear-gradient(90deg, #f093fb 0%, #f5576c 100%)"}}}),e.jsxs(l,{variant:"caption",sx:{minWidth:60},children:[a.users," users"]})]}),primaryTypographyProps:{variant:"body2",fontWeight:500}})]}),d<r.geographicData.length-1&&e.jsx(J,{sx:{borderColor:"rgba(255,255,255,0.1)"}})]},a.region))}):e.jsx(l,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No geographic data available"})]})})})]})]})};export{De as default};
