import{j as e,B as r,d as ie,a as j,R as O,T as o,aG as ne,aH as re,aI as le,a5 as I,aJ as oe,C as Z,G as l,ab as ce,aK as de,aL as S,aM as P,H as k,t as E,v as R,aN as $,w as H,x as J,y as K,ag as xe,z as q,i as Q,D as V,aO as ge,aP as X}from"./mui-D8UjIA2s.js";import{r as g,b as Y}from"./vendor-CjD1bmmO.js";import{u as pe,c as y,e as C}from"./index-xoVlIEtl.js";import{M as b}from"./MetricCard-B_DL-kwb.js";import{S as ue}from"./StorageWarningCard-CqUoG3dl.js";import"./stripe-CUttI3Gx.js";const U=[{label:"Mon",value:0},{label:"Tue",value:0},{label:"Wed",value:0},{label:"Thu",value:0},{label:"Fri",value:0},{label:"Sat",value:0},{label:"Sun",value:0}],D={totalApiCalls:0,responseTime:0,activeDevices:0,dataTransfer:0,uptime:99.8,dailyUsage:U,topEndpoints:[],geographicData:[],usageMetrics:[]},he=({data:c,loading:h=!1})=>h?e.jsx(r,{sx:{height:200,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Z,{})}):(Math.max(...c.map(p=>p.value)),e.jsx(r,{sx:{height:200,display:"flex",alignItems:"end",gap:1,px:2},children:c.map(p=>e.jsx(r,{sx:{flex:1,display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx(o,{variant:"caption",color:"text.secondary",children:p.label})},p.label))})),De=()=>{const{user:c}=pe(),[h,p]=g.useState("7d"),[T,ee]=g.useState("api_calls"),[i,M]=g.useState(D),[n,w]=g.useState(!1),[W,F]=g.useState(null),G=async()=>{var t,d,_,z,N;try{w(!0),F(null);const f=String((c==null?void 0:c.role)||"").toUpperCase(),se=f==="ADMIN"||f==="SUPERADMIN";let m;if(se)try{const[x,a,v]=await Promise.allSettled([y.get(`${C.admin.licenseAnalytics()}?period=${h}`),y.get(C.admin.systemHealth()),y.get(C.admin.dashboardStats())]),s=x.status==="fulfilled"?((d=(t=x.value.data)==null?void 0:t.data)==null?void 0:d.analytics)||{}:{},u=a.status==="fulfilled"?((_=a.value.data)==null?void 0:_.data)||{}:{},me=v.status==="fulfilled"?((z=v.value.data)==null?void 0:z.data)||{}:{};m={totalApiCalls:s.totalApiCalls||s.activeLicenses||0,responseTime:u.averageResponseTime||98.7,activeDevices:s.activeDevices||s.newLicenses||0,dataTransfer:(s.totalDataTransfer||s.totalLicenses||0)/1e3,uptime:u.uptimePercentage||99.8,dailyUsage:(s.dailyCounts||[]).map(L=>({label:L.date,value:L.count,change:L.change||0}))||U,topEndpoints:s.topEndpoints||[],geographicData:s.geographicDistribution||[],usageMetrics:[{name:"API Calls",value:s.totalApiCalls||s.activeLicenses||0,limit:1e5,unit:"calls",icon:e.jsx(X,{}),color:"#00d4ff"},{name:"Data Transfer",value:(s.totalDataTransfer||s.totalLicenses||0)/1e3,limit:100,unit:"GB",icon:e.jsx(P,{}),color:"#667eea"},{name:"Active Devices",value:s.activeDevices||s.newLicenses||0,limit:50,unit:"devices",icon:e.jsx(S,{}),color:"#f093fb"},{name:"Uptime",value:u.uptimePercentage||99.8,limit:100,unit:"%",icon:e.jsx(k,{}),color:"#4facfe"}]}}catch(x){console.warn("Admin analytics failed, falling back to basic data:",x),m=D}else try{const a=((N=(await y.get(C.licenses.analytics())).data)==null?void 0:N.data)||{};m={totalApiCalls:a.totalEvents||a.totalApiCalls||0,responseTime:a.averageResponseTime||98.7,activeDevices:a.activeDevices||Object.keys(a.eventTypes||{}).length,dataTransfer:(a.totalDataTransfer||a.totalEvents||0)/1e3,uptime:a.uptimePercentage||99.8,dailyUsage:Object.entries(a.dailyUsage||a.eventTypes||{}).map(([v,s])=>{var u;return{label:v,value:s,change:((u=a.dailyChanges)==null?void 0:u[v])||0}})||U,topEndpoints:a.topEndpoints||[],geographicData:a.geographicData||[],usageMetrics:[{name:"API Calls",value:a.totalEvents||a.totalApiCalls||0,limit:1e5,unit:"calls",icon:e.jsx(X,{}),color:"#00d4ff"},{name:"Data Transfer",value:(a.totalDataTransfer||a.totalEvents||0)/1e3,limit:100,unit:"GB",icon:e.jsx(P,{}),color:"#667eea"},{name:"Active Devices",value:a.activeDevices||Object.keys(a.eventTypes||{}).length,limit:50,unit:"devices",icon:e.jsx(S,{}),color:"#f093fb"},{name:"Uptime",value:a.uptimePercentage||99.8,limit:100,unit:"%",icon:e.jsx(k,{}),color:"#4facfe"}]}}catch(x){console.warn("User analytics failed, using default data:",x),m=D}M(m)}catch(f){console.error("Failed to fetch analytics data:",f),F("Failed to load analytics data. Please try again."),M(D)}finally{w(!1)}};g.useEffect(()=>{G()},[c==null?void 0:c.role,h]);const ae=t=>{p(t.target.value)},A=t=>{ee(t)},B=()=>{G()},te=g.useMemo(()=>i.dailyUsage.length?i.dailyUsage.reduce((t,d)=>t+(d.change||0),0)/i.dailyUsage.length:0,[i.dailyUsage]);return W?e.jsxs(r,{sx:{p:3},children:[e.jsx(ie,{severity:"error",sx:{mb:3},children:W}),e.jsx(j,{variant:"contained",onClick:B,startIcon:e.jsx(O,{}),children:"Retry"})]}):e.jsxs(r,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(r,{children:[e.jsx(o,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Usage Analytics"}),e.jsx(o,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Monitor your BackboneLogic, Inc. usage patterns and performance"})]}),e.jsxs(r,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsxs(ne,{size:"small",sx:{minWidth:120},children:[e.jsx(re,{children:"Time Range"}),e.jsxs(le,{value:h,label:"Time Range",onChange:ae,disabled:n,inputProps:{"aria-label":"Select time range for analytics",title:"Choose the time period for analytics data"},children:[e.jsx(I,{value:"7d",children:"Last 7 days"}),e.jsx(I,{value:"30d",children:"Last 30 days"}),e.jsx(I,{value:"90d",children:"Last 90 days"})]})]}),e.jsxs(oe,{variant:"outlined",size:"small",children:[e.jsx(j,{variant:T==="api_calls"?"contained":"outlined",onClick:()=>A("api_calls"),disabled:n,children:"API Calls"}),e.jsx(j,{variant:T==="data_transfer"?"contained":"outlined",onClick:()=>A("data_transfer"),disabled:n,children:"Data Transfer"}),e.jsx(j,{variant:T==="devices"?"contained":"outlined",onClick:()=>A("devices"),disabled:n,children:"Devices"})]}),e.jsx(j,{variant:"outlined",onClick:B,disabled:n,startIcon:n?e.jsx(Z,{size:16}):e.jsx(O,{}),children:n?"Loading...":"Refresh"})]})]}),e.jsx(ue,{onUpgrade:()=>window.open("/pricing","_blank"),compact:!1}),e.jsxs(l,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(l,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(b,{title:"Total API Calls",value:n?"Loading...":i.totalApiCalls.toLocaleString(),icon:e.jsx(ce,{}),trend:{value:te,direction:"up"},color:"primary"})}),e.jsx(l,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(b,{title:"Response Time",value:n?"Loading...":`${i.responseTime}%`,icon:e.jsx(de,{}),trend:{value:2.3,direction:"up"},color:"secondary"})}),e.jsx(l,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(b,{title:"Active Devices",value:n?"Loading...":i.activeDevices.toString(),icon:e.jsx(S,{}),trend:{value:12,direction:"up"},color:"warning"})}),e.jsx(l,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(b,{title:"Data Transfer",value:n?"Loading...":`${i.dataTransfer.toFixed(1)} GB`,icon:e.jsx(P,{}),trend:{value:.2,direction:"down"},color:"error"})}),e.jsx(l,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(b,{title:"Uptime",value:n?"Loading...":`${i.uptime}%`,icon:e.jsx(k,{}),trend:{value:.1,direction:"up"},color:"success"})})]}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,lg:12,children:e.jsx(E,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",mb:3},children:e.jsxs(R,{children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Usage Trends"}),e.jsx(he,{data:i.dailyUsage,loading:n})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(E,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(R,{children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Top API Endpoints"}),n?e.jsx(r,{children:[1,2,3,4,5].map(t=>e.jsx(r,{sx:{mb:2},children:e.jsx($,{variant:"rectangular",height:40})},t))}):i.topEndpoints.length>0?e.jsx(H,{dense:!0,children:i.topEndpoints.map((t,d)=>e.jsxs(Y.Fragment,{children:[e.jsxs(J,{sx:{px:0},children:[e.jsx(K,{sx:{minWidth:40},children:e.jsx(xe,{sx:{width:32,height:32,bgcolor:"primary.main",fontSize:"0.875rem",fontWeight:600},children:d+1})}),e.jsx(q,{primary:t.name,secondary:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(Q,{variant:"determinate",value:t.percentage,sx:{flex:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}}),e.jsxs(o,{variant:"caption",sx:{minWidth:60},children:[t.calls.toLocaleString()," calls"]})]}),primaryTypographyProps:{variant:"body2",fontWeight:500,sx:{fontFamily:"monospace"}}})]}),d<i.topEndpoints.length-1&&e.jsx(V,{sx:{borderColor:"rgba(255,255,255,0.1)"}})]},t.name))}):e.jsx(o,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No endpoint data available"})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(E,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(R,{children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Geographic Distribution"}),n?e.jsx(r,{children:[1,2,3,4,5].map(t=>e.jsx(r,{sx:{mb:2},children:e.jsx($,{variant:"rectangular",height:40})},t))}):i.geographicData.length>0?e.jsx(H,{dense:!0,children:i.geographicData.map((t,d)=>e.jsxs(Y.Fragment,{children:[e.jsxs(J,{sx:{px:0},children:[e.jsx(K,{sx:{minWidth:40},children:e.jsx(ge,{sx:{color:"primary.main"}})}),e.jsx(q,{primary:t.region,secondary:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5},children:[e.jsx(Q,{variant:"determinate",value:t.percentage,sx:{flex:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:"linear-gradient(90deg, #f093fb 0%, #f5576c 100%)"}}}),e.jsxs(o,{variant:"caption",sx:{minWidth:60},children:[t.users," users"]})]}),primaryTypographyProps:{variant:"body2",fontWeight:500}})]}),d<i.geographicData.length-1&&e.jsx(V,{sx:{borderColor:"rgba(255,255,255,0.1)"}})]},t.region))}):e.jsx(o,{variant:"body2",color:"text.secondary",sx:{textAlign:"center",py:2},children:"No geographic data available"})]})})})]})]})};export{De as default};
