import{j as e,a as r,T as s,d,m as E,k as M,l as L,G as n,h as C,c as S,az as re,at as ne,a6 as ae,I as ie,aI as le,aL as oe,ar as T,q as ce,aC as de,aD as xe,aE as ue,aF as v,aG as i,aH as he,aN as R,aO as B,aP as F,u as pe,v as b,aQ as N,aS as je,aT as ge,aU as ye,a5 as j,F as me,ak as be,ab as fe,a$ as Ce,aR as ve,ax as Se,o as Pe}from"./mui-B8PGH2kt.js";import{r as c}from"./vendor-DIxetjBo.js";import{u as Ie}from"./notistack.esm-Bg0Tn0tt.js";import{p as O}from"./paymentService-TRfclJaX.js";import{c as De,e as ke}from"./index-pxvdrNnu.js";import"./stripe-CUnmz-K2.js";const we=[{id:"1",type:"card",last4:"4242",brand:"Visa",expiryMonth:12,expiryYear:2025,isDefault:!0},{id:"2",type:"card",last4:"5555",brand:"Mastercard",expiryMonth:8,expiryYear:2026,isDefault:!1}],P=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(l/100),Y=l=>{switch(l.toLowerCase()){case"succeeded":case"paid":case"active":return"success";case"pending":case"processing":return"warning";case"failed":case"cancelled":case"canceled":return"error";case"refunded":return"info";default:return"default"}},$=l=>{switch(l.toLowerCase()){case"succeeded":case"paid":case"active":return e.jsx(Pe,{});case"pending":case"processing":return e.jsx(Se,{});case"failed":case"cancelled":case"canceled":return e.jsx(ve,{});case"refunded":return e.jsx(Ce,{});default:return e.jsx(fe,{})}},Te=()=>{const{enqueueSnackbar:l}=Ie(),[z]=c.useState(we),[o,H]=c.useState(null),[I,D]=c.useState([]),[G,k]=c.useState(!1),[V,w]=c.useState(!1),[q,f]=c.useState(!1),[Q,g]=c.useState(!1),[W,J]=c.useState("PRO"),[U,_]=c.useState(3),[A,y]=c.useState(null),K=()=>{l("Payment method added successfully",{variant:"success"}),f(!1)},X=()=>{l("Subscription updated successfully",{variant:"success"}),g(!1)},Z=t=>{t.receiptUrl?window.open(t.receiptUrl,"_blank"):l("No receipt available for this payment",{variant:"info"})};c.useEffect(()=>{(async()=>{var t,h,a,p;try{w(!0);const m=((h=(t=(await De.get(ke.subscriptions.mySubscriptions())).data)==null?void 0:t.data)==null?void 0:h.subscriptions)||[];if(m.length>0){const x=m[0];H({id:x.id,plan:((a=x.tier)==null?void 0:a.toUpperCase())||"PRO",status:((p=x.status)==null?void 0:p.toLowerCase())||"active",currentPeriodStart:x.currentPeriodStart,currentPeriodEnd:x.currentPeriodEnd,seats:x.seats||1,amount:x.amount||0,nextPaymentDate:x.currentPeriodEnd,tier:x.tier})}}catch(u){console.error("Failed to load subscription:",u),l((u==null?void 0:u.message)||"Failed to load subscription",{variant:"error"})}finally{w(!1)}})()},[l]),c.useEffect(()=>{(async()=>{try{k(!0);let t;try{t=await O.getUserInvoices({limit:25})}catch{console.log("Invoice endpoint not available, falling back to payment history"),t=(await O.getPaymentHistory({limit:25})).payments||[]}const h=t.map(a=>{var p,u,m;return{id:a.id,stripeInvoiceId:a.stripeInvoiceId,number:a.stripeInvoiceId||`PAY-${a.id.substring(0,8).toUpperCase()}`,date:a.createdAt,amount:a.amount,status:(p=a.status)==null?void 0:p.toLowerCase(),description:a.description||`${((u=a.subscription)==null?void 0:u.tier)||"Subscription"} Plan - ${((m=a.subscription)==null?void 0:m.seats)||1} seat(s)`,downloadUrl:a.receiptUrl,receiptUrl:a.receiptUrl,currency:a.currency,createdAt:a.createdAt}});D(h),console.log("Billing history loaded:",t)}catch(t){console.error("Failed to load billing history:",t),l((t==null?void 0:t.message)||"Failed to load billing history",{variant:"error"}),D([])}finally{k(!1)}})()},[l]);const ee=()=>({BASIC:2900,PRO:9900,ENTERPRISE:19900})[W]*U;if(V)return e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(s,{variant:"h6",color:"text.secondary",children:"Loading billing information..."})});if(!o)return e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(s,{variant:"h6",color:"text.secondary",children:"No subscription found. Please contact support."})});const te=P(o.amount),se=Math.ceil((new Date(o.nextPaymentDate).getTime()-new Date().getTime())/(1e3*60*60*24));return e.jsxs(r,{children:[e.jsx(r,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(r,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Billing & Payments"}),e.jsx(s,{variant:"body1",color:"text.secondary",children:"Manage your subscription, payment methods, and billing history"})]}),e.jsx(d,{variant:"contained",startIcon:e.jsx(E,{}),onClick:()=>g(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Upgrade Plan"})]})}),e.jsx(r,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:e.jsx(M,{sx:{mb:4,background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsx(L,{sx:{p:4},children:e.jsxs(n,{container:!0,spacing:4,alignItems:"center",children:[e.jsxs(n,{item:!0,xs:12,md:8,children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(C,{label:o.plan,color:"primary",sx:{fontWeight:600,fontSize:"1rem",px:2,py:1}}),e.jsx(C,{icon:$(o.status),label:o.status.toUpperCase(),color:Y(o.status),sx:{fontWeight:500}})]}),e.jsxs(s,{variant:"h5",sx:{fontWeight:600,mb:1},children:[P(o.amount)," / month"]}),e.jsxs(s,{variant:"body1",color:"text.secondary",sx:{mb:2},children:[o.seats," seats • Next payment in ",se," days"]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Current period: ",new Date(o.currentPeriodStart).toLocaleDateString()," - ",new Date(o.currentPeriodEnd).toLocaleDateString()]})]}),e.jsx(n,{item:!0,xs:12,md:4,children:e.jsxs(r,{sx:{textAlign:"right"},children:[e.jsx(s,{variant:"h6",color:"text.secondary",sx:{mb:1},children:"Next Payment"}),e.jsx(s,{variant:"h4",sx:{fontWeight:700,mb:1},children:te}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["on ",new Date(o.nextPaymentDate).toLocaleDateString()]})]})})]})})})}),e.jsxs(n,{container:!0,spacing:4,children:[e.jsx(n,{item:!0,xs:12,md:8,children:e.jsx(r,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsxs(S,{sx:{p:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600},children:"Payment Methods"}),e.jsx(d,{variant:"outlined",startIcon:e.jsx(re,{}),onClick:()=>f(!0),children:"+ Add Method"})]}),e.jsx(r,{sx:{display:"flex",flexDirection:"column",gap:2},children:z.map(t=>e.jsx(M,{sx:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsx(L,{sx:{p:2},children:e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ne,{sx:{bgcolor:"primary.main"},children:e.jsx(ae,{})}),e.jsxs(r,{children:[e.jsxs(s,{variant:"body1",sx:{fontWeight:500},children:[t.brand," •••• ",t.last4]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Expires ",t.expiryMonth.toString().padStart(2,"0"),"/",t.expiryYear]})]})]}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.isDefault&&e.jsx(C,{label:"Default",size:"small",color:"primary"}),e.jsx(ie,{size:"small",onClick:h=>y(h.currentTarget),children:e.jsx(le,{})})]})]})})},t.id))})]})})}),e.jsx(n,{item:!0,xs:12,md:4,children:e.jsx(r,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsxs(S,{sx:{p:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Quick Actions"}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,children:e.jsx(d,{variant:"outlined",startIcon:e.jsx(E,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},onClick:()=>g(!0),children:"Upgrade Plan"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(d,{variant:"outlined",startIcon:e.jsx(oe,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},children:"Update Billing Info"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(d,{variant:"outlined",startIcon:e.jsx(T,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},children:"Download All Invoices"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(d,{variant:"outlined",startIcon:e.jsx(ce,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},children:"Billing Security Settings"})})]})]})})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(r,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:e.jsxs(S,{sx:{p:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Billing History"}),e.jsx(de,{children:e.jsxs(xe,{children:[e.jsx(ue,{children:e.jsxs(v,{children:[e.jsx(i,{sx:{fontWeight:600},children:"Invoice"}),e.jsx(i,{sx:{fontWeight:600},children:"Date"}),e.jsx(i,{sx:{fontWeight:600},children:"Description"}),e.jsx(i,{sx:{fontWeight:600},children:"Amount"}),e.jsx(i,{sx:{fontWeight:600},children:"Status"}),e.jsx(i,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(he,{children:G?e.jsx(v,{children:e.jsx(i,{colSpan:6,align:"center",children:e.jsx(r,{sx:{py:4},children:e.jsx(s,{variant:"body1",color:"text.secondary",children:"Loading billing history..."})})})}):I.length>0?I.map(t=>e.jsxs(v,{hover:!0,children:[e.jsx(i,{children:e.jsx(s,{variant:"body2",sx:{fontWeight:500,fontFamily:"monospace"},children:t.number})}),e.jsx(i,{children:e.jsx(s,{variant:"body2",children:new Date(t.createdAt||t.date).toLocaleDateString()})}),e.jsx(i,{children:e.jsx(s,{variant:"body2",children:t.description})}),e.jsx(i,{children:e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:new Intl.NumberFormat("en-US",{style:"currency",currency:(t.currency||"USD").toUpperCase()}).format((t.amount||0)/100)})}),e.jsx(i,{children:e.jsx(C,{icon:$(String(t.status).toLowerCase()),label:String(t.status).toUpperCase(),color:Y(String(t.status).toLowerCase()),size:"small"})}),e.jsx(i,{children:e.jsx(d,{variant:"outlined",size:"small",startIcon:e.jsx(T,{}),onClick:()=>Z(t),children:"Receipt"})})]},t.id)):e.jsx(v,{children:e.jsx(i,{colSpan:6,align:"center",children:e.jsxs(r,{sx:{py:4},children:[e.jsx(s,{variant:"body1",color:"text.secondary",sx:{mb:1},children:"No billing history found"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Your payment history will appear here once you have completed transactions."})]})})})})]})})]})})})]}),e.jsxs(R,{open:q,onClose:()=>f(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(B,{children:"Add Payment Method"}),e.jsxs(F,{children:[e.jsx(pe,{severity:"info",sx:{mb:3},children:"Your payment information is securely processed by Stripe and never stored on our servers."}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,label:"Card Number",placeholder:"1234 5678 9012 3456",sx:{mt:1}})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(b,{fullWidth:!0,label:"Expiry Date",placeholder:"MM/YY"})}),e.jsx(n,{item:!0,xs:6,children:e.jsx(b,{fullWidth:!0,label:"CVC",placeholder:"123"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(b,{fullWidth:!0,label:"Cardholder Name",placeholder:"John Doe"})})]})]}),e.jsxs(N,{children:[e.jsx(d,{onClick:()=>f(!1),children:"Cancel"}),e.jsx(d,{onClick:K,variant:"contained",children:"Add Payment Method"})]})]}),e.jsxs(R,{open:Q,onClose:()=>g(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(B,{children:"Upgrade Your Plan"}),e.jsx(F,{children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(je,{fullWidth:!0,children:[e.jsx(ge,{children:"Select Plan"}),e.jsxs(ye,{value:W,label:"Select Plan",onChange:t=>J(t.target.value),inputProps:{"aria-label":"Select subscription plan",title:"Choose your subscription plan"},children:[e.jsx(j,{value:"BASIC",children:"Basic - $29/month"}),e.jsx(j,{value:"PRO",children:"Pro - $99/month"}),e.jsx(j,{value:"ENTERPRISE",children:"Enterprise - $199/month"})]})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(b,{fullWidth:!0,label:"Number of Seats",type:"number",value:U,onChange:t=>_(parseInt(t.target.value)),inputProps:{min:1,max:100}})}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx(me,{sx:{my:2}}),e.jsx(r,{sx:{display:"flex",justifyContent:"between",alignItems:"center"},children:e.jsxs(s,{variant:"h6",children:["Total: ",P(ee())," / month"]})})]})]})}),e.jsxs(N,{children:[e.jsx(d,{onClick:()=>g(!1),children:"Cancel"}),e.jsx(d,{onClick:X,variant:"contained",children:"Upgrade Now"})]})]}),e.jsxs(be,{anchorEl:A,open:!!A,onClose:()=>y(null),PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(j,{onClick:()=>y(null),children:"Set as Default"}),e.jsx(j,{onClick:()=>y(null),children:"Edit"}),e.jsx(j,{onClick:()=>y(null),sx:{color:"error.main"},children:"Remove"})]})]})};export{Te as default};
