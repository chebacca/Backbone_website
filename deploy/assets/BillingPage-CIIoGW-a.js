import{j as e,a as n,T as r,d,n as L,G as s,bj as ae,ar as ie,aA as V,bk as le,l as T,m as R,i as v,c as w,aO as oe,av as ce,a7 as de,I as xe,b8 as ue,bb as he,au as B,r as pe,aW as je,aX as ge,aY as me,aZ as C,a_ as l,a$ as be,aI as N,aJ as F,aM as O,A as ye,v as y,aN as Y,aE as fe,b2 as ve,b3 as Ce,a6 as j,O as Se,al as Pe,ac as Ie,bl as De,bd as we,p as ke}from"./mui-DyxhGdz_.js";import{r as c}from"./vendor-OeuszDaU.js";import{u as We}from"./notistack.esm-CcFOI6Un.js";import{p as $}from"./paymentService-Dl04Jzar.js";import{c as Ae,e as Ue}from"./index-CRzCTCol.js";import{M as S}from"./MetricCard-d3d6ShfY.js";import"./stripe-Bg_wjrrQ.js";const Me=[{id:"1",type:"card",last4:"4242",brand:"Visa",expiryMonth:12,expiryYear:2025,isDefault:!0},{id:"2",type:"card",last4:"5555",brand:"Mastercard",expiryMonth:8,expiryYear:2026,isDefault:!1}],P=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o/100),z=o=>{switch(o.toLowerCase()){case"succeeded":case"paid":case"active":return"success";case"pending":case"processing":return"warning";case"failed":case"cancelled":case"canceled":return"error";case"refunded":return"info";default:return"default"}},H=o=>{switch(o.toLowerCase()){case"succeeded":case"paid":case"active":return e.jsx(ke,{});case"pending":case"processing":return e.jsx(V,{});case"failed":case"cancelled":case"canceled":return e.jsx(we,{});case"refunded":return e.jsx(De,{});default:return e.jsx(Ie,{})}},Oe=()=>{const{enqueueSnackbar:o}=We(),[G]=c.useState(Me),[i,J]=c.useState(null),[I,k]=c.useState([]),[_,W]=c.useState(!1),[q,A]=c.useState(!1),[Q,f]=c.useState(!1),[X,g]=c.useState(!1),[U,Z]=c.useState("PRO"),[M,K]=c.useState(3),[E,m]=c.useState(null),ee=()=>{o("Payment method added successfully",{variant:"success"}),f(!1)},te=()=>{o("Subscription updated successfully",{variant:"success"}),g(!1)},se=t=>{t.receiptUrl?window.open(t.receiptUrl,"_blank"):o("No receipt available for this payment",{variant:"info"})};c.useEffect(()=>{(async()=>{var t,h,a,p;try{A(!0);const b=((h=(t=(await Ae.get(Ue.subscriptions.mySubscriptions())).data)==null?void 0:t.data)==null?void 0:h.subscriptions)||[];if(b.length>0){const x=b[0];J({id:x.id,plan:((a=x.tier)==null?void 0:a.toUpperCase())||"PRO",status:((p=x.status)==null?void 0:p.toLowerCase())||"active",currentPeriodStart:x.currentPeriodStart,currentPeriodEnd:x.currentPeriodEnd,seats:x.seats||1,amount:x.amount||0,nextPaymentDate:x.currentPeriodEnd,tier:x.tier})}}catch(u){console.error("Failed to load subscription:",u),o((u==null?void 0:u.message)||"Failed to load subscription",{variant:"error"})}finally{A(!1)}})()},[o]),c.useEffect(()=>{(async()=>{try{W(!0);let t;try{t=await $.getUserInvoices({limit:25})}catch{console.log("Invoice endpoint not available, falling back to payment history"),t=(await $.getPaymentHistory({limit:25})).payments||[]}const h=t.map(a=>{var p,u,b;return{id:a.id,stripeInvoiceId:a.stripeInvoiceId,number:a.stripeInvoiceId||`PAY-${a.id.substring(0,8).toUpperCase()}`,date:a.createdAt,amount:a.amount,status:(p=a.status)==null?void 0:p.toLowerCase(),description:a.description||`${((u=a.subscription)==null?void 0:u.tier)||"Subscription"} Plan - ${((b=a.subscription)==null?void 0:b.seats)||1} seat(s)`,downloadUrl:a.receiptUrl,receiptUrl:a.receiptUrl,currency:a.currency,createdAt:a.createdAt}});k(h),console.log("Billing history loaded:",t)}catch(t){console.error("Failed to load billing history:",t),o((t==null?void 0:t.message)||"Failed to load billing history",{variant:"error"}),k([])}finally{W(!1)}})()},[o]);const re=()=>({BASIC:2900,PRO:9900,ENTERPRISE:19900})[U]*M;if(q)return e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(r,{variant:"h6",color:"text.secondary",children:"Loading billing information..."})});if(!i)return e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(r,{variant:"h6",color:"text.secondary",children:"No subscription found. Please contact support."})});const ne=P(i.amount),D=Math.ceil((new Date(i.nextPaymentDate).getTime()-new Date().getTime())/(1e3*60*60*24));return e.jsxs(n,{children:[e.jsx(n,{children:e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(n,{children:[e.jsx(r,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Billing & Payments"}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Manage your subscription, payment methods, and billing history"})]}),e.jsx(d,{variant:"contained",startIcon:e.jsx(L,{}),onClick:()=>g(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Upgrade Plan"})]})}),e.jsxs(s,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{title:"Monthly Cost",value:P(i.amount),icon:e.jsx(ae,{}),color:"primary"})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{title:"Total Seats",value:i.seats,icon:e.jsx(ie,{}),color:"secondary"})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{title:"Days to Renewal",value:D,icon:e.jsx(V,{}),color:"warning",trend:{value:Math.max(0,30-D),direction:"down"}})}),e.jsx(s,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{title:"Active Invoices",value:I.filter(t=>t.status==="paid"||t.status==="pending").length,icon:e.jsx(le,{}),color:"success"})})]}),e.jsx(n,{children:e.jsx(T,{sx:{mb:4,background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsx(R,{sx:{p:4},children:e.jsxs(s,{container:!0,spacing:4,alignItems:"center",children:[e.jsxs(s,{item:!0,xs:12,md:8,children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(v,{label:i.plan,color:"primary",sx:{fontWeight:600,fontSize:"1rem",px:2,py:1}}),e.jsx(v,{icon:H(i.status),label:i.status.toUpperCase(),color:z(i.status),sx:{fontWeight:500}})]}),e.jsxs(r,{variant:"h5",sx:{fontWeight:600,mb:1},children:[P(i.amount)," / month"]}),e.jsxs(r,{variant:"body1",color:"text.secondary",sx:{mb:2},children:[i.seats," seats • Next payment in ",D," days"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Current period: ",new Date(i.currentPeriodStart).toLocaleDateString()," - ",new Date(i.currentPeriodEnd).toLocaleDateString()]})]}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsxs(n,{sx:{textAlign:"right"},children:[e.jsx(r,{variant:"h6",color:"text.secondary",sx:{mb:1},children:"Next Payment"}),e.jsx(r,{variant:"h4",sx:{fontWeight:700,mb:1},children:ne}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["on ",new Date(i.nextPaymentDate).toLocaleDateString()]})]})})]})})})}),e.jsxs(s,{container:!0,spacing:4,children:[e.jsx(s,{item:!0,xs:12,md:8,children:e.jsx(n,{children:e.jsxs(w,{sx:{p:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:600},children:"Payment Methods"}),e.jsx(d,{variant:"outlined",startIcon:e.jsx(oe,{}),onClick:()=>f(!0),children:"+ Add Method"})]}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:G.map(t=>e.jsx(T,{sx:{background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsx(R,{sx:{p:2},children:e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ce,{sx:{bgcolor:"primary.main"},children:e.jsx(de,{})}),e.jsxs(n,{children:[e.jsxs(r,{variant:"body1",sx:{fontWeight:500},children:[t.brand," •••• ",t.last4]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Expires ",t.expiryMonth.toString().padStart(2,"0"),"/",t.expiryYear]})]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.isDefault&&e.jsx(v,{label:"Default",size:"small",color:"primary"}),e.jsx(xe,{size:"small",onClick:h=>m(h.currentTarget),children:e.jsx(ue,{})})]})]})})},t.id))})]})})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(n,{children:e.jsxs(w,{sx:{p:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Quick Actions"}),e.jsxs(s,{container:!0,spacing:2,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(d,{variant:"outlined",startIcon:e.jsx(L,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},onClick:()=>g(!0),children:"Upgrade Plan"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(d,{variant:"outlined",startIcon:e.jsx(he,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},children:"Update Billing Info"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(d,{variant:"outlined",startIcon:e.jsx(B,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},children:"Download All Invoices"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(d,{variant:"outlined",startIcon:e.jsx(pe,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},children:"Billing Security Settings"})})]})]})})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(n,{children:e.jsxs(w,{sx:{p:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Billing History"}),e.jsx(je,{children:e.jsxs(ge,{children:[e.jsx(me,{children:e.jsxs(C,{children:[e.jsx(l,{sx:{fontWeight:600},children:"Invoice"}),e.jsx(l,{sx:{fontWeight:600},children:"Date"}),e.jsx(l,{sx:{fontWeight:600},children:"Description"}),e.jsx(l,{sx:{fontWeight:600},children:"Amount"}),e.jsx(l,{sx:{fontWeight:600},children:"Status"}),e.jsx(l,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(be,{children:_?e.jsx(C,{children:e.jsx(l,{colSpan:6,align:"center",children:e.jsx(n,{sx:{py:4},children:e.jsx(r,{variant:"body1",color:"text.secondary",children:"Loading billing history..."})})})}):I.length>0?I.map(t=>e.jsxs(C,{hover:!0,children:[e.jsx(l,{children:e.jsx(r,{variant:"body2",sx:{fontWeight:500,fontFamily:"monospace"},children:t.number})}),e.jsx(l,{children:e.jsx(r,{variant:"body2",children:new Date(t.createdAt||t.date).toLocaleDateString()})}),e.jsx(l,{children:e.jsx(r,{variant:"body2",children:t.description})}),e.jsx(l,{children:e.jsx(r,{variant:"body2",sx:{fontWeight:500},children:new Intl.NumberFormat("en-US",{style:"currency",currency:(t.currency||"USD").toUpperCase()}).format((t.amount||0)/100)})}),e.jsx(l,{children:e.jsx(v,{icon:H(String(t.status).toLowerCase()),label:String(t.status).toUpperCase(),color:z(String(t.status).toLowerCase()),size:"small"})}),e.jsx(l,{children:e.jsx(d,{variant:"outlined",size:"small",startIcon:e.jsx(B,{}),onClick:()=>se(t),children:"Receipt"})})]},t.id)):e.jsx(C,{children:e.jsx(l,{colSpan:6,align:"center",children:e.jsxs(n,{sx:{py:4},children:[e.jsx(r,{variant:"body1",color:"text.secondary",sx:{mb:1},children:"No billing history found"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Your payment history will appear here once you have completed transactions."})]})})})})]})})]})})})]}),e.jsxs(N,{open:Q,onClose:()=>f(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(F,{children:"Add Payment Method"}),e.jsxs(O,{children:[e.jsx(ye,{severity:"info",sx:{mb:3},children:"Your payment information is securely processed by Stripe and never stored on our servers."}),e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Card Number",placeholder:"1234 5678 9012 3456",sx:{mt:1}})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,label:"Expiry Date",placeholder:"MM/YY"})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(y,{fullWidth:!0,label:"CVC",placeholder:"123"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(y,{fullWidth:!0,label:"Cardholder Name",placeholder:"John Doe"})})]})]}),e.jsxs(Y,{children:[e.jsx(d,{onClick:()=>f(!1),children:"Cancel"}),e.jsx(d,{onClick:ee,variant:"contained",children:"Add Payment Method"})]})]}),e.jsxs(N,{open:X,onClose:()=>g(!1),maxWidth:"md",fullWidth:!0,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(F,{children:"Upgrade Your Plan"}),e.jsx(O,{children:e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(fe,{fullWidth:!0,children:[e.jsx(ve,{children:"Select Plan"}),e.jsxs(Ce,{value:U,label:"Select Plan",onChange:t=>Z(t.target.value),inputProps:{"aria-label":"Select subscription plan",title:"Choose your subscription plan"},children:[e.jsx(j,{value:"BASIC",children:"Basic - $29/month"}),e.jsx(j,{value:"PRO",children:"Pro - $99/month"}),e.jsx(j,{value:"ENTERPRISE",children:"Enterprise - $199/month"})]})]})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(y,{fullWidth:!0,label:"Number of Seats",type:"number",value:M,onChange:t=>K(parseInt(t.target.value)),inputProps:{min:1,max:100}})}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(Se,{sx:{my:2}}),e.jsx(n,{sx:{display:"flex",justifyContent:"between",alignItems:"center"},children:e.jsxs(r,{variant:"h6",children:["Total: ",P(re())," / month"]})})]})]})}),e.jsxs(Y,{children:[e.jsx(d,{onClick:()=>g(!1),children:"Cancel"}),e.jsx(d,{onClick:te,variant:"contained",children:"Upgrade Now"})]})]}),e.jsxs(Pe,{anchorEl:E,open:!!E,onClose:()=>m(null),PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(j,{onClick:()=>m(null),children:"Set as Default"}),e.jsx(j,{onClick:()=>m(null),children:"Edit"}),e.jsx(j,{onClick:()=>m(null),sx:{color:"error.main"},children:"Remove"})]})]})};export{Oe as default};
