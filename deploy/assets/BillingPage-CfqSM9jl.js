import{j as e,B as a,C as me,T as r,d as I,ai as L,w as ge,x as O,y as N,aj as Z,z,H as $,a as i,u as Y,G as t,aR as ye,ac as fe,am as ee,aS as be,t as F,v as V,r as b,c as D,ap as ve,ag as Ce,aT as Pe,g as Se,aw as Ie,aJ as De,af as H,aq as we,ar as Ae,as as Ee,at as G,au as l,av as Re,ay as q,az as J,aA as _,e as m,aE as Q,aB as We,aC as Me,aD as Te,a5 as x,D as Ue,a4 as ke,aa as Be,aU as Le,p as Oe}from"./mui-BEXhTKQE.js";import{r as u}from"./vendor-CjD1bmmO.js";import{u as Ne}from"./notistack.esm-Ca-E78ev.js";import{u as ze,a as $e,g as Ye}from"./useStreamlinedData-DPgLnQ54.js";import{M as v}from"./MetricCard-COkCYmW-.js";import"./UnifiedDataService-BCo-qj1X.js";import"./index-Yho81KnV.js";import"./stripe-BgsnbYLP.js";import"./index.esm-DonjM_pP.js";import"./index.esm-D7ujsXeY.js";const w=[{id:"1",type:"card",last4:"4242",brand:"Visa",expiryMonth:12,expiryYear:2025,isDefault:!0},{id:"2",type:"card",last4:"5555",brand:"Mastercard",expiryMonth:8,expiryYear:2026,isDefault:!1}],g=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o),K=o=>{switch(o.toLowerCase()){case"succeeded":case"paid":case"active":return"success";case"pending":case"processing":return"warning";case"failed":case"cancelled":case"canceled":return"error";case"refunded":return"info";default:return"default"}},X=o=>{switch(o.toLowerCase()){case"succeeded":case"paid":case"active":return e.jsx(Oe,{});case"pending":case"processing":return e.jsx(ee,{});case"failed":case"cancelled":case"canceled":return e.jsx(Z,{});case"refunded":return e.jsx(Le,{});default:return e.jsx(Be,{})}},Ze=()=>{var U;const{enqueueSnackbar:o}=Ne(),{data:A,loading:se,error:te}=ze(),{data:C,loading:ne,error:re}=$e(),{loading:ae,error:ie}=Ye(),[le,y]=u.useState(!1),[oe,h]=u.useState(!1),[E,f]=u.useState("PRO"),[R,W]=u.useState(1),[M,p]=u.useState(null),ce=se||ne||ae,de=te||re||ie,n=u.useMemo(()=>{if(!A||!C)return{subscription:null,invoices:[],paymentMethods:w,nextPaymentAmount:0,daysUntilRenewal:0};const s=C.subscription;if(!s)return{subscription:null,invoices:[],paymentMethods:w,nextPaymentAmount:0,daysUntilRenewal:0};let j=0;if(s.currentPeriodEnd){const k=new Date(s.currentPeriodEnd),d=new Date,c=k.getTime()-d.getTime();j=Math.max(0,Math.ceil(c/(1e3*60*60*24)))}const S=Array.from({length:6},(k,d)=>{var B;const c=new Date;return c.setMonth(c.getMonth()-d),{id:`inv_${d+1}`,number:`INV-${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(d+1).padStart(3,"0")}`,date:c.toISOString(),amount:s.plan.pricePerSeat||99,status:d===0?"pending":"paid",description:`${((B=s.plan)==null?void 0:B.tier)||"PRO"} Plan - ${s.plan.seats||1} seat(s)`,currency:"USD"}});return{subscription:s,invoices:S,paymentMethods:w,nextPaymentAmount:s.plan.pricePerSeat*s.plan.seats||0,daysUntilRenewal:j}},[A,C]),xe=()=>{o("Payment method added successfully",{variant:"success"}),y(!1)},ue=()=>{o("Subscription updated successfully",{variant:"success"}),h(!1)},T=()=>{var s;n.subscription&&(W(n.subscription.plan.seats||1),f(((s=n.subscription.plan)==null?void 0:s.tier)||"PRO")),h(!0)},he=s=>{o(`Downloading invoice ${s.number}...`,{variant:"info"})},pe=()=>({BASIC:29,PRO:99,ENTERPRISE:199})[E]*R,je=s=>{W(s),s<=50?f("PRO"):f("ENTERPRISE")},P=s=>{const S={BASIC:29,PRO:99,ENTERPRISE:199}[s];return`${s} - $${S}/seat/month`};return ce?e.jsx(a,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(a,{textAlign:"center",children:[e.jsx(me,{size:60}),e.jsx(r,{variant:"h6",sx:{mt:2},children:"Loading Billing Information..."}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Fetching your subscription and payment details"})]})}):de?e.jsx(a,{sx:{p:3},children:e.jsxs(I,{severity:"error",children:[e.jsx(L,{children:"Unable to Load Billing Data"}),e.jsx(r,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your billing information. This could be due to:"}),e.jsxs(ge,{dense:!0,children:[e.jsxs(O,{children:[e.jsx(N,{children:e.jsx(Z,{fontSize:"small"})}),e.jsx(z,{primary:"Network connectivity issues"})]}),e.jsxs(O,{children:[e.jsx(N,{children:e.jsx($,{fontSize:"small"})}),e.jsx(z,{primary:"Authentication token expired"})]})]}),e.jsx(a,{sx:{mt:2},children:e.jsx(i,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):n.subscription?e.jsxs(a,{children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(a,{children:[e.jsx(r,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Billing & Payments"}),e.jsx(r,{variant:"body1",color:"text.secondary",children:"Manage your subscription, payment methods, and billing history"})]}),e.jsx(i,{variant:"contained",startIcon:e.jsx(Y,{}),onClick:T,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Upgrade Plan"})]}),e.jsxs(t,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{title:"Monthly Cost",value:g(n.nextPaymentAmount),icon:e.jsx(ye,{}),color:"primary"})}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{title:"Total Seats",value:n.subscription.plan.seats||1,icon:e.jsx(fe,{}),color:"secondary"})}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{title:"Days to Renewal",value:n.daysUntilRenewal,icon:e.jsx(ee,{}),color:"warning",trend:{value:Math.max(0,30-n.daysUntilRenewal),direction:"down"}})}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{title:"Active Invoices",value:n.invoices.filter(s=>s.status==="paid"||s.status==="pending").length,icon:e.jsx(be,{}),color:"success"})})]}),e.jsx(F,{sx:{mb:4,background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsx(V,{sx:{p:4},children:e.jsxs(t,{container:!0,spacing:4,alignItems:"center",children:[e.jsxs(t,{item:!0,xs:12,md:8,children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(b,{label:((U=n.subscription.plan)==null?void 0:U.tier)||"PRO",color:"primary",sx:{fontWeight:600,fontSize:"1rem",px:2,py:1}}),e.jsx(b,{icon:X(n.subscription.status||"active"),label:(n.subscription.status||"ACTIVE").toUpperCase(),color:K(n.subscription.status||"active"),sx:{fontWeight:500}})]}),e.jsxs(r,{variant:"h5",sx:{fontWeight:600,mb:1},children:[g(n.nextPaymentAmount)," / month"]}),e.jsxs(r,{variant:"body1",color:"text.secondary",sx:{mb:2},children:[n.subscription.plan.seats||1," seats • Next payment in ",n.daysUntilRenewal," days"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Current period: ",new Date(n.subscription.currentPeriodStart||Date.now()).toLocaleDateString()," - ",new Date(n.subscription.currentPeriodEnd||Date.now()).toLocaleDateString()]})]}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsxs(a,{sx:{textAlign:"right"},children:[e.jsx(r,{variant:"h6",color:"text.secondary",sx:{mb:1},children:"Next Payment"}),e.jsx(r,{variant:"h4",sx:{fontWeight:700,mb:1},children:g(n.nextPaymentAmount)}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["on ",new Date(n.subscription.currentPeriodEnd||Date.now()).toLocaleDateString()]})]})})]})})}),e.jsxs(t,{container:!0,spacing:4,children:[e.jsx(t,{item:!0,xs:12,md:8,children:e.jsxs(D,{sx:{p:3},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:600},children:"Payment Methods"}),e.jsx(i,{variant:"outlined",startIcon:e.jsx(ve,{}),onClick:()=>y(!0),children:"Add Method"})]}),e.jsx(a,{sx:{display:"flex",flexDirection:"column",gap:2},children:n.paymentMethods.map(s=>e.jsx(F,{sx:{border:"1px solid rgba(255,255,255,0.1)"},children:e.jsx(V,{sx:{p:2},children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ce,{sx:{bgcolor:"primary.main"},children:e.jsx(Pe,{})}),e.jsxs(a,{children:[e.jsxs(r,{variant:"body1",sx:{fontWeight:500},children:[s.brand," •••• ",s.last4]}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["Expires ",s.expiryMonth.toString().padStart(2,"0"),"/",s.expiryYear]})]})]}),e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.isDefault&&e.jsx(b,{label:"Default",size:"small",color:"primary"}),e.jsx(Se,{size:"small",onClick:j=>p(j.currentTarget),children:e.jsx(Ie,{})})]})]})})},s.id))})]})}),e.jsx(t,{item:!0,xs:12,md:4,children:e.jsxs(D,{sx:{p:3},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Quick Actions"}),e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,children:e.jsx(i,{variant:"outlined",startIcon:e.jsx(Y,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},onClick:()=>h(!0),children:"Upgrade Plan"})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(i,{variant:"outlined",startIcon:e.jsx(De,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},children:"Update Billing Info"})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(i,{variant:"outlined",startIcon:e.jsx(H,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},children:"Download All Invoices"})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(i,{variant:"outlined",startIcon:e.jsx($,{}),fullWidth:!0,sx:{justifyContent:"flex-start",py:1.5},children:"Billing Security Settings"})})]})]})}),e.jsx(t,{item:!0,xs:12,children:e.jsxs(D,{sx:{p:3},children:[e.jsx(r,{variant:"h6",sx:{fontWeight:600,mb:3},children:"Billing History"}),e.jsx(we,{children:e.jsxs(Ae,{children:[e.jsx(Ee,{children:e.jsxs(G,{children:[e.jsx(l,{sx:{fontWeight:600},children:"Invoice"}),e.jsx(l,{sx:{fontWeight:600},children:"Date"}),e.jsx(l,{sx:{fontWeight:600},children:"Description"}),e.jsx(l,{sx:{fontWeight:600},children:"Amount"}),e.jsx(l,{sx:{fontWeight:600},children:"Status"}),e.jsx(l,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Re,{children:n.invoices.map(s=>e.jsxs(G,{hover:!0,children:[e.jsx(l,{children:e.jsx(r,{variant:"body2",sx:{fontWeight:500,fontFamily:"monospace"},children:s.number})}),e.jsx(l,{children:e.jsx(r,{variant:"body2",children:new Date(s.date).toLocaleDateString()})}),e.jsx(l,{children:e.jsx(r,{variant:"body2",children:s.description})}),e.jsx(l,{children:e.jsx(r,{variant:"body2",sx:{fontWeight:500},children:g(s.amount)})}),e.jsx(l,{children:e.jsx(b,{icon:X(s.status),label:s.status.toUpperCase(),color:K(s.status),size:"small"})}),e.jsx(l,{children:e.jsx(i,{variant:"contained",size:"small",startIcon:e.jsx(H,{}),onClick:()=>he(s),children:"Receipt"})})]},s.id))})]})})]})})]}),e.jsxs(q,{open:le,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(J,{children:"Add Payment Method"}),e.jsxs(_,{children:[e.jsx(I,{severity:"info",sx:{mb:3},children:"Your payment information is securely processed by Stripe and never stored on our servers."}),e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"Card Number",placeholder:"1234 5678 9012 3456",sx:{mt:1}})}),e.jsx(t,{item:!0,xs:6,children:e.jsx(m,{fullWidth:!0,label:"Expiry Date",placeholder:"MM/YY"})}),e.jsx(t,{item:!0,xs:6,children:e.jsx(m,{fullWidth:!0,label:"CVC",placeholder:"123"})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"Cardholder Name",placeholder:"John Doe"})})]})]}),e.jsxs(Q,{children:[e.jsx(i,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(i,{onClick:xe,variant:"contained",children:"Add Payment Method"})]})]}),e.jsxs(q,{open:oe,onClose:()=>h(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(J,{children:"Upgrade Your Plan"}),e.jsx(_,{children:e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(We,{fullWidth:!0,children:[e.jsx(Me,{children:"Select Plan"}),e.jsxs(Te,{value:E,label:"Select Plan",onChange:s=>f(s.target.value),children:[e.jsx(x,{value:"BASIC",children:P("BASIC")}),e.jsx(x,{value:"PRO",children:P("PRO")}),e.jsx(x,{value:"ENTERPRISE",children:P("ENTERPRISE")})]})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Number of Seats",type:"number",value:R,onChange:s=>je(parseInt(s.target.value)),inputProps:{min:1,max:100},helperText:"Up to 50 seats: Pro plan. 51+ seats: Enterprise plan."})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(Ue,{sx:{my:2}}),e.jsxs(r,{variant:"h6",children:["Total: ",g(pe())," / month"]})]})]})}),e.jsxs(Q,{children:[e.jsx(i,{onClick:()=>h(!1),children:"Cancel"}),e.jsx(i,{onClick:ue,variant:"contained",children:"Upgrade Now"})]})]}),e.jsxs(ke,{anchorEl:M,open:!!M,onClose:()=>p(null),children:[e.jsx(x,{onClick:()=>p(null),children:"Set as Default"}),e.jsx(x,{onClick:()=>p(null),children:"Edit"}),e.jsx(x,{onClick:()=>p(null),sx:{color:"error.main"},children:"Remove"})]})]}):e.jsx(a,{sx:{p:3},children:e.jsxs(I,{severity:"info",children:[e.jsx(L,{children:"No Active Subscription"}),e.jsx(r,{variant:"body2",sx:{mb:2},children:"You don't have an active subscription yet. Get started with one of our plans:"}),e.jsx(a,{sx:{mt:2},children:e.jsx(i,{variant:"contained",onClick:T,children:"Choose Plan"})})]})})};export{Ze as default};
