import{ab as S,j as e,a as k,T as v,d as p,bb as se,bc as L,U as q,aO as re,aP as ie,aQ as oe,u as P,aT as B,bU as M,aV as T,a4 as h,aR as le,W as ce,X as ne,Y as de,h as O,I as R}from"./mui-BeS5Ygr6.js";import{r as c}from"./vendor-OeuszDaU.js";import{r as _}from"./createSvgIcon-DUz8CuB7.js";import{c as x,d as ue}from"./index-Ww0PAbpr.js";import"./stripe-TmI1MsK7.js";var I={},ge=S;Object.defineProperty(I,"__esModule",{value:!0});var H=I.default=void 0,he=ge(_()),xe=e;H=I.default=(0,he.default)((0,xe.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96"}),"Cloud");var $={},me=S;Object.defineProperty($,"__esModule",{value:!0});var V=$.default=void 0,ve=me(_()),je=e;V=$.default=(0,ve.default)((0,je.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");var D={},pe=S;Object.defineProperty(D,"__esModule",{value:!0});var N=D.default=void 0,fe=pe(_()),ye=e;N=D.default=(0,fe.default)((0,ye.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"Restore");var A={},be=S;Object.defineProperty(A,"__esModule",{value:!0});var Q=A.default=void 0,Ce=be(_()),we=e;Q=A.default=(0,Ce.default)((0,we.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");const G={async getSignedUrl(u,o,g,i){var f,m;const n=await x.post(`projects/${u}/storage/signed-url`,{filename:o,operation:g,contentType:i});if(!((f=n.data)!=null&&f.success))throw new Error(((m=n.data)==null?void 0:m.error)||"Failed to get signed URL");return n.data.data},async uploadAsset(u,o){const g=await this.getSignedUrl(u,o.name,"upload",o.type||"application/octet-stream"),i=await fetch(g.url,{method:"PUT",headers:{"Content-Type":o.type||"application/octet-stream",...g.headers||{}},body:o});if(!i.ok){const n=await i.text().catch(()=>"");throw new Error(n||`Upload failed with status ${i.status}`)}},async downloadAsset(u,o){const g=await this.getSignedUrl(u,o,"download"),i=document.createElement("a");i.href=g.url,i.download=o,document.body.appendChild(i),i.click(),document.body.removeChild(i)}},Me=()=>{const[u,o]=c.useState(0),[g,i]=c.useState(!1),[n,f]=c.useState([]),[m,X]=c.useState([]),[y,l]=c.useState(null),[Y,j]=c.useState(!1),[b,E]=c.useState(!1),[F,U]=c.useState(null),[s,d]=c.useState({name:"",description:"",visibility:"private",storageMode:"cloud",cloudType:"firestore",gcsBucket:"",gcsPrefix:""}),C=async()=>{try{l(null);const t=await ue.withLoading(()=>x.get("projects"),i);f(Array.isArray(t)?t:[])}catch(t){l((t==null?void 0:t.message)||"Failed to load projects")}},w=async()=>{var t;try{l(null);const r=((t=(await x.get("projects/archived/list")).data)==null?void 0:t.data)||[];X(Array.isArray(r)?r:[])}catch(a){l((a==null?void 0:a.message)||"Failed to load archived projects")}};c.useEffect(()=>{C(),w()},[]);const J=()=>{E(!1),U(null),d({name:"",description:"",visibility:"private",storageMode:"cloud",cloudType:"firestore",gcsBucket:"",gcsPrefix:""}),j(!0)},K=t=>{E(!0),U(t.id),d({name:t.name||"",description:t.description||"",visibility:t.visibility||"private",storageMode:t.storageBackend?"cloud":"local",cloudType:t.storageBackend||"firestore",gcsBucket:t.gcsBucket||"",gcsPrefix:t.gcsPrefix||""}),j(!0)},Z=()=>s.name.trim()?s.storageMode==="cloud"&&s.cloudType==="gcs"&&!s.gcsBucket.trim()?"GCS Bucket is required for GCS storage":null:"Project name is required",ee=async()=>{const t=Z();if(t){l(t);return}try{l(null),b&&F?await x.patch(`projects/${F}`,{name:s.name,description:s.description,visibility:s.visibility}):await x.post("projects",{name:s.name,description:s.description,type:"network",applicationMode:"shared_network",visibility:s.visibility,storageBackend:s.storageMode==="cloud"?s.cloudType:void 0,gcsBucket:s.storageMode==="cloud"&&s.cloudType==="gcs"&&s.gcsBucket||void 0,gcsPrefix:s.storageMode==="cloud"&&s.cloudType==="gcs"&&s.gcsPrefix||void 0}),j(!1),await Promise.all([C(),w()])}catch(a){l((a==null?void 0:a.message)||"Save failed")}},te=async t=>{try{await x.delete(`projects/${t}`),await Promise.all([C(),w()])}catch(a){l((a==null?void 0:a.message)||"Delete failed")}},ae=async t=>{try{await x.post(`projects/${t}/restore`,{}),await Promise.all([C(),w()])}catch(a){l((a==null?void 0:a.message)||"Restore failed")}},W=(t,a)=>e.jsxs(ce,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1},secondaryAction:a?e.jsx(R,{onClick:()=>ae(t.id),"aria-label":"Restore project",children:e.jsx(N,{})}):e.jsxs(k,{children:[e.jsx(R,{onClick:()=>K(t),"aria-label":"Edit project",sx:{mr:1},children:e.jsx("span",{role:"img","aria-label":"edit",children:"✏️"})}),e.jsx(R,{onClick:()=>te(t.id),"aria-label":"Delete project",children:e.jsx(V,{})}),t.storageBackend==="gcs"&&e.jsxs(e.Fragment,{children:[e.jsx(p,{size:"small",sx:{ml:1},onClick:async()=>{try{const r=document.createElement("input");r.type="file",r.onchange=async()=>{const z=r.files&&r.files[0]||null;z&&await G.uploadAsset(t.id,z)},r.click()}catch(r){l((r==null?void 0:r.message)||"Upload failed")}},children:"Upload"}),e.jsx(p,{size:"small",onClick:async()=>{try{const r=window.prompt("Enter filename to download (exact match):");if(!r)return;await G.downloadAsset(t.id,r)}catch(r){l((r==null?void 0:r.message)||"Download failed")}},children:"Download"})]})]}),children:[e.jsx(ne,{children:e.jsx(H,{color:a?"disabled":"primary"})}),e.jsx(de,{primary:e.jsxs(k,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(v,{variant:"subtitle2",sx:{flexGrow:1},children:t.name}),t.storageBackend&&e.jsx(O,{size:"small",variant:"outlined",label:t.storageBackend==="gcs"?"GCS":"Firestore",color:t.storageBackend==="gcs"?"secondary":"primary"}),e.jsx(O,{size:"small",variant:"outlined",label:t.visibility})]}),secondary:t.description||""})]},t.id);return e.jsxs(k,{children:[e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(v,{variant:"h5",sx:{fontWeight:700},children:"Cloud Projects"}),e.jsx(p,{variant:"contained",startIcon:e.jsx(Q,{}),onClick:J,children:"Create Project"})]}),e.jsxs(se,{value:u,onChange:(t,a)=>o(a),sx:{mb:2},children:[e.jsx(L,{label:`Active (${n.length})`}),e.jsx(L,{label:`Recycle Bin (${m.length})`})]}),y&&e.jsx(v,{color:"error",sx:{mb:2},children:y}),u===0?e.jsx(q,{children:n.length===0?e.jsx(v,{variant:"body2",color:"text.secondary",children:"No projects yet."}):n.map(t=>W(t,!1))}):e.jsx(q,{children:m.length===0?e.jsx(v,{variant:"body2",color:"text.secondary",children:"Recycle Bin is empty."}):m.map(t=>W(t,!0))}),e.jsxs(re,{open:Y,onClose:()=>j(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(ie,{children:b?"Edit Project":"Create Project"}),e.jsxs(oe,{children:[y&&e.jsx(v,{color:"error",sx:{mb:2},children:y}),e.jsx(P,{fullWidth:!0,label:"Project Name",value:s.name,onChange:t=>d(a=>({...a,name:t.target.value})),sx:{mt:1,mb:2}}),e.jsx(P,{fullWidth:!0,label:"Description",value:s.description,onChange:t=>d(a=>({...a,description:t.target.value})),multiline:!0,rows:3,sx:{mb:2}}),e.jsxs(B,{fullWidth:!0,sx:{mb:2},children:[e.jsx(M,{children:"Visibility"}),e.jsxs(T,{value:s.visibility,onChange:t=>d(a=>({...a,visibility:t.target.value})),children:[e.jsx(h,{value:"private",children:"Private"}),e.jsx(h,{value:"organization",children:"Organization"}),e.jsx(h,{value:"public",children:"Public"})]})]}),!b&&e.jsxs(e.Fragment,{children:[e.jsxs(B,{fullWidth:!0,sx:{mb:2},children:[e.jsx(M,{children:"Storage Location"}),e.jsxs(T,{value:s.storageMode,onChange:t=>d(a=>({...a,storageMode:t.target.value})),children:[e.jsx(h,{value:"cloud",children:"Cloud"}),e.jsx(h,{value:"local",children:"Local (.dbproj)"})]})]}),s.storageMode==="cloud"&&e.jsxs(B,{fullWidth:!0,sx:{mb:2},children:[e.jsx(M,{children:"Cloud Type"}),e.jsxs(T,{value:s.cloudType,onChange:t=>d(a=>({...a,cloudType:t.target.value})),children:[e.jsx(h,{value:"firestore",children:"Firestore (metadata)"}),e.jsx(h,{value:"gcs",children:"Google Cloud Storage (assets)"})]})]}),s.storageMode==="cloud"&&s.cloudType==="gcs"&&e.jsxs(e.Fragment,{children:[e.jsx(P,{fullWidth:!0,label:"GCS Bucket",value:s.gcsBucket,onChange:t=>d(a=>({...a,gcsBucket:t.target.value})),sx:{mb:2}}),e.jsx(P,{fullWidth:!0,label:"GCS Prefix (optional)",value:s.gcsPrefix,onChange:t=>d(a=>({...a,gcsPrefix:t.target.value})),sx:{mb:2}})]})]})]}),e.jsxs(le,{children:[e.jsx(p,{onClick:()=>j(!1),children:"Cancel"}),e.jsx(p,{variant:"contained",onClick:ee,children:b?"Save":"Create"})]})]})]})};export{Me as default};
