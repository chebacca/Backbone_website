import{bR as m,j as e,a as h,T as c,d as y,ba as ee,bb as A,U as E,aN as te,aO as ae,aP as se,u as j,aS as C,bU as P,aU as _,a4 as o,aQ as re,W as ie,X as le,Y as oe,h as W,I as k}from"./mui-CQSqhP_x.js";import{r}from"./vendor-OeuszDaU.js";import{r as p}from"./createSvgIcon-BOZMuKnM.js";import{d as ce,c as n}from"./index-DBB8tDui.js";import"./stripe-DtF9vOHr.js";var S={},ne=m;Object.defineProperty(S,"__esModule",{value:!0});var L=S.default=void 0,de=ne(p()),ue=e;L=S.default=(0,de.default)((0,ue.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96"}),"Cloud");var B={},xe=m;Object.defineProperty(B,"__esModule",{value:!0});var q=B.default=void 0,ve=xe(p()),ge=e;q=B.default=(0,ve.default)((0,ge.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");var M={},he=m;Object.defineProperty(M,"__esModule",{value:!0});var z=M.default=void 0,je=he(p()),me=e;z=M.default=(0,je.default)((0,me.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"Restore");var I={},pe=m;Object.defineProperty(I,"__esModule",{value:!0});var O=I.default=void 0,fe=pe(p()),be=e;O=I.default=(0,fe.default)((0,be.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");const Be=()=>{const[R,G]=r.useState(0),[ye,H]=r.useState(!1),[f,U]=r.useState([]),[b,V]=r.useState([]),[u,i]=r.useState(null),[N,d]=r.useState(!1),[x,T]=r.useState(!1),[$,D]=r.useState(null),[s,l]=r.useState({name:"",description:"",visibility:"private",storageMode:"cloud",cloudType:"firestore",gcsBucket:"",gcsPrefix:""}),v=async()=>{try{i(null);const t=await ce.withLoading(()=>n.get("projects"),H);U(Array.isArray(t)?t:[])}catch(t){i((t==null?void 0:t.message)||"Failed to load projects")}},g=async()=>{var t;try{i(null);const F=((t=(await n.get("projects/archived/list")).data)==null?void 0:t.data)||[];V(Array.isArray(F)?F:[])}catch(a){i((a==null?void 0:a.message)||"Failed to load archived projects")}};r.useEffect(()=>{v(),g()},[]);const Q=()=>{T(!1),D(null),l({name:"",description:"",visibility:"private",storageMode:"cloud",cloudType:"firestore",gcsBucket:"",gcsPrefix:""}),d(!0)},X=t=>{T(!0),D(t.id),l({name:t.name||"",description:t.description||"",visibility:t.visibility||"private",storageMode:t.storageBackend?"cloud":"local",cloudType:t.storageBackend||"firestore",gcsBucket:t.gcsBucket||"",gcsPrefix:t.gcsPrefix||""}),d(!0)},Y=()=>s.name.trim()?s.storageMode==="cloud"&&s.cloudType==="gcs"&&!s.gcsBucket.trim()?"GCS Bucket is required for GCS storage":null:"Project name is required",J=async()=>{const t=Y();if(t){i(t);return}try{i(null),x&&$?await n.patch(`projects/${$}`,{name:s.name,description:s.description,visibility:s.visibility}):await n.post("projects",{name:s.name,description:s.description,type:"network",applicationMode:"shared_network",visibility:s.visibility,storageBackend:s.storageMode==="cloud"?s.cloudType:void 0,gcsBucket:s.storageMode==="cloud"&&s.cloudType==="gcs"&&s.gcsBucket||void 0,gcsPrefix:s.storageMode==="cloud"&&s.cloudType==="gcs"&&s.gcsPrefix||void 0}),d(!1),await Promise.all([v(),g()])}catch(a){i((a==null?void 0:a.message)||"Save failed")}},K=async t=>{try{await n.delete(`projects/${t}`),await Promise.all([v(),g()])}catch(a){i((a==null?void 0:a.message)||"Delete failed")}},Z=async t=>{try{await n.post(`projects/${t}/restore`,{}),await Promise.all([v(),g()])}catch(a){i((a==null?void 0:a.message)||"Restore failed")}},w=(t,a)=>e.jsxs(ie,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1},secondaryAction:a?e.jsx(k,{onClick:()=>Z(t.id),"aria-label":"Restore project",children:e.jsx(z,{})}):e.jsxs(h,{children:[e.jsx(k,{onClick:()=>X(t),"aria-label":"Edit project",sx:{mr:1},children:e.jsx("span",{role:"img","aria-label":"edit",children:"✏️"})}),e.jsx(k,{onClick:()=>K(t.id),"aria-label":"Delete project",children:e.jsx(q,{})})]}),children:[e.jsx(le,{children:e.jsx(L,{color:a?"disabled":"primary"})}),e.jsx(oe,{primary:e.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{variant:"subtitle2",sx:{flexGrow:1},children:t.name}),t.storageBackend&&e.jsx(W,{size:"small",variant:"outlined",label:t.storageBackend==="gcs"?"GCS":"Firestore",color:t.storageBackend==="gcs"?"secondary":"primary"}),e.jsx(W,{size:"small",variant:"outlined",label:t.visibility})]}),secondary:t.description||""})]},t.id);return e.jsxs(h,{children:[e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(c,{variant:"h5",sx:{fontWeight:700},children:"Cloud Projects"}),e.jsx(y,{variant:"contained",startIcon:e.jsx(O,{}),onClick:Q,children:"Create Project"})]}),e.jsxs(ee,{value:R,onChange:(t,a)=>G(a),sx:{mb:2},children:[e.jsx(A,{label:`Active (${f.length})`}),e.jsx(A,{label:`Recycle Bin (${b.length})`})]}),u&&e.jsx(c,{color:"error",sx:{mb:2},children:u}),R===0?e.jsx(E,{children:f.length===0?e.jsx(c,{variant:"body2",color:"text.secondary",children:"No projects yet."}):f.map(t=>w(t,!1))}):e.jsx(E,{children:b.length===0?e.jsx(c,{variant:"body2",color:"text.secondary",children:"Recycle Bin is empty."}):b.map(t=>w(t,!0))}),e.jsxs(te,{open:N,onClose:()=>d(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(ae,{children:x?"Edit Project":"Create Project"}),e.jsxs(se,{children:[u&&e.jsx(c,{color:"error",sx:{mb:2},children:u}),e.jsx(j,{fullWidth:!0,label:"Project Name",value:s.name,onChange:t=>l(a=>({...a,name:t.target.value})),sx:{mt:1,mb:2}}),e.jsx(j,{fullWidth:!0,label:"Description",value:s.description,onChange:t=>l(a=>({...a,description:t.target.value})),multiline:!0,rows:3,sx:{mb:2}}),e.jsxs(C,{fullWidth:!0,sx:{mb:2},children:[e.jsx(P,{children:"Visibility"}),e.jsxs(_,{value:s.visibility,onChange:t=>l(a=>({...a,visibility:t.target.value})),children:[e.jsx(o,{value:"private",children:"Private"}),e.jsx(o,{value:"organization",children:"Organization"}),e.jsx(o,{value:"public",children:"Public"})]})]}),!x&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{fullWidth:!0,sx:{mb:2},children:[e.jsx(P,{children:"Storage Location"}),e.jsxs(_,{value:s.storageMode,onChange:t=>l(a=>({...a,storageMode:t.target.value})),children:[e.jsx(o,{value:"cloud",children:"Cloud"}),e.jsx(o,{value:"local",children:"Local (.dbproj)"})]})]}),s.storageMode==="cloud"&&e.jsxs(C,{fullWidth:!0,sx:{mb:2},children:[e.jsx(P,{children:"Cloud Type"}),e.jsxs(_,{value:s.cloudType,onChange:t=>l(a=>({...a,cloudType:t.target.value})),children:[e.jsx(o,{value:"firestore",children:"Firestore (metadata)"}),e.jsx(o,{value:"gcs",children:"Google Cloud Storage (assets)"})]})]}),s.storageMode==="cloud"&&s.cloudType==="gcs"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{fullWidth:!0,label:"GCS Bucket",value:s.gcsBucket,onChange:t=>l(a=>({...a,gcsBucket:t.target.value})),sx:{mb:2}}),e.jsx(j,{fullWidth:!0,label:"GCS Prefix (optional)",value:s.gcsPrefix,onChange:t=>l(a=>({...a,gcsPrefix:t.target.value})),sx:{mb:2}})]})]})]}),e.jsxs(re,{children:[e.jsx(y,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(y,{variant:"contained",onClick:J,children:x?"Save":"Create"})]})]})]})};export{Be as default};
