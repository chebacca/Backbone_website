import{ab as B,j as e,a as S,T as j,d as f,bb as ie,bc as G,U as H,aO as oe,aP as le,aQ as ce,u as _,aT as T,bU as R,aV as A,a4 as v,aR as ne,W as de,X as ue,Y as he,h as V,I}from"./mui-BeS5Ygr6.js";import{r as c}from"./vendor-OeuszDaU.js";import{r as M}from"./createSvgIcon-DUz8CuB7.js";import{c as h,d as ge}from"./index-DbP9TrF4.js";import"./stripe-TmI1MsK7.js";var $={},xe=B;Object.defineProperty($,"__esModule",{value:!0});var Q=$.default=void 0,ve=xe(M()),me=e;Q=$.default=(0,ve.default)((0,me.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96"}),"Cloud");var D={},je=B;Object.defineProperty(D,"__esModule",{value:!0});var X=D.default=void 0,pe=je(M()),fe=e;X=D.default=(0,pe.default)((0,fe.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");var E={},ye=B;Object.defineProperty(E,"__esModule",{value:!0});var Y=E.default=void 0,be=ye(M()),Ce=e;Y=E.default=(0,be.default)((0,Ce.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"Restore");var F={},we=B;Object.defineProperty(F,"__esModule",{value:!0});var J=F.default=void 0,ke=we(M()),Pe=e;J=F.default=(0,ke.default)((0,Pe.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");const N={async getSignedUrl(u,o,g,i){var y,m;const n=await h.post(`projects/${u}/storage/signed-url`,{filename:o,operation:g,contentType:i});if(!((y=n.data)!=null&&y.success))throw new Error(((m=n.data)==null?void 0:m.error)||"Failed to get signed URL");return n.data.data},async uploadAsset(u,o){const g=await this.getSignedUrl(u,o.name,"upload",o.type||"application/octet-stream"),i=await fetch(g.url,{method:"PUT",headers:{"Content-Type":o.type||"application/octet-stream",...g.headers||{}},body:o});if(!i.ok){const n=await i.text().catch(()=>"");throw new Error(n||`Upload failed with status ${i.status}`)}},async downloadAsset(u,o){const g=await this.getSignedUrl(u,o,"download"),i=document.createElement("a");i.href=g.url,i.download=o,document.body.appendChild(i),i.click(),document.body.removeChild(i)}},Re=()=>{const[u,o]=c.useState(0),[g,i]=c.useState(!1),[n,y]=c.useState([]),[m,U]=c.useState([]),[b,l]=c.useState(null),[K,p]=c.useState(!1),[C,W]=c.useState(!1),[z,L]=c.useState(null),[s,d]=c.useState({name:"",description:"",visibility:"private",storageMode:"cloud",cloudType:"firestore",gcsBucket:"",gcsPrefix:""}),w=async()=>{try{l(null);const t=await ge.withLoading(()=>h.get("projects"),i);y(Array.isArray(t)?t:[])}catch(t){l((t==null?void 0:t.message)||"Failed to load projects")}},k=async()=>{var t,a;try{l(null);try{const O=((t=(await h.get("projects/archived/list")).data)==null?void 0:t.data)||[];U(Array.isArray(O)?O:[]);return}catch(x){if((x==null?void 0:x.status)!==404)throw x}const P=((a=(await h.get("projects",{params:{includeArchived:!0}})).data)==null?void 0:a.data)||[];U(P.filter(x=>x.isArchived))}catch(r){l((r==null?void 0:r.message)||"Failed to load archived projects")}};c.useEffect(()=>{w(),k()},[]);const Z=()=>{W(!1),L(null),d({name:"",description:"",visibility:"private",storageMode:"cloud",cloudType:"firestore",gcsBucket:"",gcsPrefix:""}),p(!0)},ee=t=>{W(!0),L(t.id),d({name:t.name||"",description:t.description||"",visibility:t.visibility||"private",storageMode:t.storageBackend?"cloud":"local",cloudType:t.storageBackend||"firestore",gcsBucket:t.gcsBucket||"",gcsPrefix:t.gcsPrefix||""}),p(!0)},te=()=>s.name.trim()?s.storageMode==="cloud"&&s.cloudType==="gcs"&&!s.gcsBucket.trim()?"GCS Bucket is required for GCS storage":null:"Project name is required",ae=async()=>{const t=te();if(t){l(t);return}try{l(null),C&&z?await h.patch(`projects/${z}`,{name:s.name,description:s.description,visibility:s.visibility}):await h.post("projects",{name:s.name,description:s.description,type:"network",applicationMode:"shared_network",visibility:s.visibility,storageBackend:s.storageMode==="cloud"?s.cloudType:void 0,gcsBucket:s.storageMode==="cloud"&&s.cloudType==="gcs"&&s.gcsBucket||void 0,gcsPrefix:s.storageMode==="cloud"&&s.cloudType==="gcs"&&s.gcsPrefix||void 0}),p(!1),await Promise.all([w(),k()])}catch(a){l((a==null?void 0:a.message)||"Save failed")}},se=async t=>{try{await h.delete(`projects/${t}`),await Promise.all([w(),k()])}catch(a){l((a==null?void 0:a.message)||"Delete failed")}},re=async t=>{try{await h.post(`projects/${t}/restore`,{}),await Promise.all([w(),k()])}catch(a){l((a==null?void 0:a.message)||"Restore failed")}},q=(t,a)=>e.jsxs(de,{sx:{border:"1px solid",borderColor:"divider",borderRadius:1,mb:1},secondaryAction:a?e.jsx(I,{onClick:()=>re(t.id),"aria-label":"Restore project",children:e.jsx(Y,{})}):e.jsxs(S,{children:[e.jsx(I,{onClick:()=>ee(t),"aria-label":"Edit project",sx:{mr:1},children:e.jsx("span",{role:"img","aria-label":"edit",children:"✏️"})}),e.jsx(I,{onClick:()=>se(t.id),"aria-label":"Delete project",children:e.jsx(X,{})}),t.storageBackend==="gcs"&&e.jsxs(e.Fragment,{children:[e.jsx(f,{size:"small",sx:{ml:1},onClick:async()=>{try{const r=document.createElement("input");r.type="file",r.onchange=async()=>{const P=r.files&&r.files[0]||null;P&&await N.uploadAsset(t.id,P)},r.click()}catch(r){l((r==null?void 0:r.message)||"Upload failed")}},children:"Upload"}),e.jsx(f,{size:"small",onClick:async()=>{try{const r=window.prompt("Enter filename to download (exact match):");if(!r)return;await N.downloadAsset(t.id,r)}catch(r){l((r==null?void 0:r.message)||"Download failed")}},children:"Download"})]})]}),children:[e.jsx(ue,{children:e.jsx(Q,{color:a?"disabled":"primary"})}),e.jsx(he,{primary:e.jsxs(S,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(j,{variant:"subtitle2",sx:{flexGrow:1},children:t.name}),t.storageBackend&&e.jsx(V,{size:"small",variant:"outlined",label:t.storageBackend==="gcs"?"GCS":"Firestore",color:t.storageBackend==="gcs"?"secondary":"primary"}),e.jsx(V,{size:"small",variant:"outlined",label:t.visibility})]}),secondary:t.description||""})]},t.id);return e.jsxs(S,{children:[e.jsxs(S,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(j,{variant:"h5",sx:{fontWeight:700},children:"Cloud Projects"}),e.jsx(f,{variant:"contained",startIcon:e.jsx(J,{}),onClick:Z,children:"Create Project"})]}),e.jsxs(ie,{value:u,onChange:(t,a)=>o(a),sx:{mb:2},children:[e.jsx(G,{label:`Active (${n.length})`}),e.jsx(G,{label:`Recycle Bin (${m.length})`})]}),b&&e.jsx(j,{color:"error",sx:{mb:2},children:b}),u===0?e.jsx(H,{children:n.length===0?e.jsx(j,{variant:"body2",color:"text.secondary",children:"No projects yet."}):n.map(t=>q(t,!1))}):e.jsx(H,{children:m.length===0?e.jsx(j,{variant:"body2",color:"text.secondary",children:"Recycle Bin is empty."}):m.map(t=>q(t,!0))}),e.jsxs(oe,{open:K,onClose:()=>p(!1),fullWidth:!0,maxWidth:"sm",children:[e.jsx(le,{children:C?"Edit Project":"Create Project"}),e.jsxs(ce,{children:[b&&e.jsx(j,{color:"error",sx:{mb:2},children:b}),e.jsx(_,{fullWidth:!0,label:"Project Name",value:s.name,onChange:t=>d(a=>({...a,name:t.target.value})),sx:{mt:1,mb:2}}),e.jsx(_,{fullWidth:!0,label:"Description",value:s.description,onChange:t=>d(a=>({...a,description:t.target.value})),multiline:!0,rows:3,sx:{mb:2}}),e.jsxs(T,{fullWidth:!0,sx:{mb:2},children:[e.jsx(R,{children:"Visibility"}),e.jsxs(A,{value:s.visibility,onChange:t=>d(a=>({...a,visibility:t.target.value})),children:[e.jsx(v,{value:"private",children:"Private"}),e.jsx(v,{value:"organization",children:"Organization"}),e.jsx(v,{value:"public",children:"Public"})]})]}),!C&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{fullWidth:!0,sx:{mb:2},children:[e.jsx(R,{children:"Storage Location"}),e.jsxs(A,{value:s.storageMode,onChange:t=>d(a=>({...a,storageMode:t.target.value})),children:[e.jsx(v,{value:"cloud",children:"Cloud"}),e.jsx(v,{value:"local",children:"Local (.dbproj)"})]})]}),s.storageMode==="cloud"&&e.jsxs(T,{fullWidth:!0,sx:{mb:2},children:[e.jsx(R,{children:"Cloud Type"}),e.jsxs(A,{value:s.cloudType,onChange:t=>d(a=>({...a,cloudType:t.target.value})),children:[e.jsx(v,{value:"firestore",children:"Firestore (metadata)"}),e.jsx(v,{value:"gcs",children:"Google Cloud Storage (assets)"})]})]}),s.storageMode==="cloud"&&s.cloudType==="gcs"&&e.jsxs(e.Fragment,{children:[e.jsx(_,{fullWidth:!0,label:"GCS Bucket",value:s.gcsBucket,onChange:t=>d(a=>({...a,gcsBucket:t.target.value})),sx:{mb:2}}),e.jsx(_,{fullWidth:!0,label:"GCS Prefix (optional)",value:s.gcsPrefix,onChange:t=>d(a=>({...a,gcsPrefix:t.target.value})),sx:{mb:2}})]})]})]}),e.jsxs(ne,{children:[e.jsx(f,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(f,{variant:"contained",onClick:ae,children:C?"Save":"Create"})]})]})]})};export{Re as default};
