import{j as e,b as ee,a as o,T as i,d,az as N,t as E,aA as te,aB as W,G as _,k as ae,l as se,I as re,ak as ne,h as P,aC as oe,Z as $,aD as ie,aE as le,aF as ce,aG as de,U,W as j,X as b,Y as u,aH as Y,aI as R,aJ as xe,aK as q}from"./mui-T5zcPaKR.js";import{r as n}from"./vendor-OeuszDaU.js";import{cloudProjectIntegration as h}from"./CloudProjectIntegration-BsY9yppQ.js";import{U as he,s as je}from"./UnifiedProjectCreationDialog-C0wvm7kt.js";import"./index-B_8VhmJv.js";import"./stripe-Bd-xCkZF.js";import"./proxy-Bigtmpzy.js";const we=({onProjectLaunch:C})=>{const[v,H]=n.useState([]),[A,B]=n.useState(!0),[L,g]=n.useState(null),[x,J]=n.useState(0),[K,w]=n.useState(!1),[ue,ge]=n.useState(!1),[a,m]=n.useState(null),[F,S]=n.useState([]),[X,T]=n.useState(!1),[Z,O]=n.useState([]),[p,z]=n.useState("");n.useEffect(()=>{D();const t=s=>{D()};return window.addEventListener("project:created",t),()=>window.removeEventListener("project:created",t)},[]);const D=async()=>{try{g(null),B(!0);const t=await h.getUserProjects();H(t)}catch(t){g((t==null?void 0:t.message)||"Failed to load projects")}finally{B(!1)}},I=async t=>{try{await je.selectProject(t.id),C==null||C(t.id)}catch(s){console.error("Failed to launch project:",s),g("Failed to launch project")}},G=()=>{w(!0)},Q=async t=>{w(!1),await D(),setTimeout(()=>{const s=(x===0?y:f).find(r=>r.id===t)||v.find(r=>r.id===t);s&&I(s)},0)},M=t=>{switch(t){case"firestore":return e.jsx($,{});case"gcs":return e.jsx(Y,{});default:return e.jsx(q,{})}},k=t=>t==="standalone"?e.jsx(q,{}):e.jsx(R,{}),V=t=>{const s=new Date(t),c=new Date().getTime()-s.getTime(),l=Math.floor(c/(1e3*60*60*24));return l===0?"Today":l===1?"Yesterday":l<7?`${l} days ago`:s.toLocaleDateString()},y=v.filter(t=>t.isActive),f=v.filter(t=>!t.isActive);return e.jsxs(ee,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(o,{children:[e.jsx(i,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"Cloud Projects"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Manage your projects with Firebase and Google Cloud Storage integration"})]}),e.jsx(d,{variant:"contained",startIcon:e.jsx(N,{}),onClick:G,size:"large",children:"Create Project"})]}),e.jsx(E,{severity:"info",sx:{mb:3},children:e.jsxs(i,{variant:"body2",children:[e.jsx("strong",{children:"Integrated Startup System:"})," Projects created here will automatically integrate with the unified startup flow and support both standalone and network modes with Firebase/GCS storage options."]})}),L&&e.jsx(E,{severity:"error",sx:{mb:3},onClose:()=>g(null),children:L}),e.jsxs(te,{value:x,onChange:(t,s)=>J(s),sx:{borderBottom:1,borderColor:"divider",mb:3},children:[e.jsx(W,{label:`Active Projects (${y.length})`}),e.jsx(W,{label:`Archived (${f.length})`})]}),e.jsxs(o,{children:[A?e.jsx(o,{sx:{textAlign:"center",py:4},children:e.jsx(i,{children:"Loading projects..."})}):e.jsx(_,{container:!0,spacing:3,children:(x===0?y:f).map(t=>e.jsx(_,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ae,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease","&:hover":{transform:"translateY(-2px)",boxShadow:s=>s.shadows[4]}},children:[e.jsxs(se,{sx:{flexGrow:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[k(t.applicationMode),e.jsx(i,{variant:"h6",component:"h3",sx:{ml:1,flexGrow:1},children:t.name}),e.jsx(re,{size:"small",onClick:()=>m(t),children:e.jsx(ne,{})})]}),t.description&&e.jsx(i,{variant:"body2",color:"text.secondary",paragraph:!0,children:t.description}),e.jsxs(o,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:[e.jsx(P,{size:"small",icon:k(t.applicationMode),label:t.applicationMode==="standalone"?"Standalone":"Network",color:"primary",variant:"outlined"}),e.jsx(P,{size:"small",icon:M(t.storageBackend),label:t.storageBackend,variant:"outlined"}),t.allowCollaboration&&e.jsx(P,{size:"small",label:`${t.maxCollaborators} users`,variant:"outlined"})]}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["Last accessed: ",V(t.lastAccessedAt)]})]}),e.jsx(o,{sx:{p:2,pt:0},children:e.jsx(d,{fullWidth:!0,variant:"contained",startIcon:e.jsx(oe,{}),onClick:()=>I(t),disabled:!t.isActive,children:t.isActive?"Launch Project":"Archived"})})]})},t.id))}),!A&&(x===0?y:f).length===0&&e.jsxs(o,{sx:{textAlign:"center",py:8},children:[e.jsx($,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:x===0?"No active projects yet":"No archived projects"}),e.jsx(i,{variant:"body2",color:"text.secondary",paragraph:!0,children:x===0?"Create your first cloud project to get started with Firebase and GCS integration":"Archived projects will appear here"}),x===0&&e.jsx(d,{variant:"contained",startIcon:e.jsx(N,{}),onClick:G,size:"large",children:"Create Your First Project"})]})]}),e.jsx(he,{open:K,onClose:()=>w(!1),mode:"shared_network",onSuccess:Q,onCreate:async t=>{var r,c;try{const l=localStorage.getItem("auth_token");l&&((c=(r=window.cloudProjectIntegration)==null?void 0:r.setAuthToken)==null||c.call(r,l))}catch{}return await h.createCloudProject(t)}}),e.jsxs(ie,{open:!!a,onClose:()=>m(null),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ce,{}),"Project Details"]})}),e.jsxs(de,{children:[a&&e.jsxs(U,{children:[e.jsxs(j,{children:[e.jsx(b,{children:k(a.applicationMode)}),e.jsx(u,{primary:"Mode",secondary:a.applicationMode==="standalone"?"Standalone":"Network"})]}),e.jsxs(j,{children:[e.jsx(b,{children:M(a.storageBackend)}),e.jsx(u,{primary:"Storage Backend",secondary:a.storageBackend})]}),a.gcsBucket&&e.jsxs(j,{children:[e.jsx(b,{children:e.jsx(Y,{})}),e.jsx(u,{primary:"GCS Bucket",secondary:a.gcsBucket})]}),a.allowCollaboration&&e.jsxs(j,{children:[e.jsx(b,{children:e.jsx(R,{})}),e.jsx(u,{primary:"Collaboration",secondary:`Up to ${a.maxCollaborators} users`})]})]}),a&&e.jsxs(o,{sx:{mt:2},children:[e.jsx(i,{variant:"subtitle1",sx:{mb:1},children:"Assigned Datasets"}),e.jsx(d,{size:"small",variant:"outlined",onClick:async()=>{if(a)try{T(!0);const t=await h.getProjectDatasets(a.id);S(t);const r=(await h.listDatasets()).map(c=>{var l;return{...c,__label:`${c.name} ${((l=c.storage)==null?void 0:l.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});O(r)}catch(t){console.error("Failed to load datasets",t)}finally{T(!1)}},sx:{mb:1},children:X?"Loading...":"Refresh"}),e.jsxs(o,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsx("label",{htmlFor:"dataset-select",className:"visually-hidden",children:"Select dataset"}),e.jsxs("select",{id:"dataset-select","aria-label":"Select dataset",value:p,onChange:t=>z(t.target.value),className:"dataset-select-input",children:[e.jsx("option",{value:"",children:"Select datasetâ€¦"}),Z.map(t=>e.jsx("option",{value:t.id,children:t.__label||t.name},t.id))]}),e.jsx(d,{size:"small",variant:"contained",disabled:!p,onClick:async()=>{if(!(!a||!p))try{await h.assignDatasetToProject(a.id,p);const t=await h.getProjectDatasets(a.id);S(t),z("")}catch(t){console.error("Failed to assign dataset",t)}},children:"Assign"})]}),F.length===0?e.jsx(i,{variant:"body2",color:"text.secondary",children:"No datasets assigned"}):e.jsx(U,{children:F.map(t=>e.jsx(j,{secondaryAction:e.jsx(d,{size:"small",color:"error",onClick:async()=>{try{await h.unassignDatasetFromProject(a.id,t.id),S(s=>s.filter(r=>r.id!==t.id))}catch(s){console.error("Failed to unassign dataset",s)}},children:"Remove"}),children:e.jsx(u,{primary:t.name,secondary:t.description})},t.id))})]})]}),e.jsxs(xe,{children:[e.jsx(d,{onClick:()=>m(null),children:"Close"}),a&&e.jsx(d,{variant:"contained",onClick:()=>{I(a),m(null)},children:"Launch Project"})]})]})]})};export{we as DashboardCloudProjectsBridge,we as default};
