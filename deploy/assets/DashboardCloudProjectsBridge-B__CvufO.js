const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firebase-irz6tycV.js","assets/index-BFq2WZdE.js","assets/mui-B0Fi-Ngj.js","assets/vendor-CjD1bmmO.js","assets/stripe-DCrHNGRE.js","assets/index-CBai7h7s.css","assets/index.esm-BANGvNYi.js","assets/index.esm-9jaBBmwp.js","assets/index.esm-CiRfLMBX.js"])))=>i.map(i=>d[i]);
var sa=Object.defineProperty;var ta=(u,a,t)=>a in u?sa(u,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[a]=t;var Me=(u,a,t)=>ta(u,typeof a!="symbol"?a+"":a,t);import{u as Dr,b as ra,a as aa,_ as br,E as oa}from"./index-BFq2WZdE.js";import{j as e,B as n,T as o,c as Ke,G as p,r as z,cj as $e,d as he,F as Ie,s as Fe,g as _s,R as bt,a as F,ap as Ge,m as ft,C as ds,aj as yt,e as ce,I as Er,V as na,h as Ir,K as et,b9 as Bt,t as ue,v as ye,ar as He,c3 as ia,c4 as la,c5 as Et,aI as ns,aJ as is,bG as st,aK as ls,bZ as Pr,b_ as kr,b$ as Mr,i as ca,aL as cs,aS as Ds,aW as jt,ak as zs,as as Ye,at as Qe,M as k,bQ as da,D as Lt,p as Zt,ck as ua,bO as ga,H as Bs,aP as _r,a9 as ma,cl as ha,w as Ft,x as Wt,z as Ut,aN as $t,aO as Qs,X as Ns,ag as Js,c1 as pa,bp as Ct,A as xa,q as ba,u as fr,cm as fa,Y as ya,cn as ja,bf as Ca,co as va,cp as Sa,cq as Aa,cr as wa,cs as Ra,l as Ta,f as yr,ct as Da,an as Os,aA as Gt,cu as Ht,b4 as Ea,b5 as jr,aH as Cr,a5 as vr,bS as Sr,aB as Ia,aC as Pa,aD as ka,aE as Ar,aF as we,cv as Ks,aG as Ma,bj as It,cw as _a,cx as Oa,a6 as Na,c0 as Pt,am as za}from"./mui-B0Fi-Ngj.js";import{r as m,b as Or}from"./vendor-CjD1bmmO.js";import{c as le,T as Xe,a as wr}from"./CloudProjectIntegration-Df4EsBTp.js";import{U as Ba,s as La}from"./UnifiedProjectCreationDialog-BosuD2gg.js";import{unifiedDataService as Rr}from"./UnifiedDataService-Ch9psGJD.js";import{collection as kt,onSnapshot as Fa,addDoc as Wa,Timestamp as os,doc as mt,getDoc as Tr,updateDoc as Ys,query as Ua,where as Mt,getDocs as $a,setDoc as Ga}from"./index.esm-9jaBBmwp.js";import{db as Ts}from"./firebase-irz6tycV.js";import"./stripe-DCrHNGRE.js";import"./FirestoreCollectionManager-B6PSldwX.js";import"./index.esm-BANGvNYi.js";import"./index.esm-CiRfLMBX.js";const Es=class Es{static getInstance(){return Es.instance||(Es.instance=new Es),Es.instance}async analyzeOrganizationDatasets(a,t){console.log("ðŸ” [DatasetConflictAnalyzer] Analyzing datasets for organization:",a);const r=t.filter(w=>{var C,D,E;return((C=w.storage)==null?void 0:C.backend)==="firestore"&&((E=(D=w.collectionAssignment)==null?void 0:D.selectedCollections)==null?void 0:E.length)>0}),c=this.buildCollectionUsageMap(r),l=this.detectCollectionOverlaps(c,r),h=this.generateGlobalInsights(c,r),i=this.calculateHealthScore(l,h),j={organizationId:a,totalDatasets:r.length,totalCollections:Object.keys(c).length,overlaps:l,globalInsights:h,healthScore:i};return console.log("âœ… [DatasetConflictAnalyzer] Analysis complete:",{datasets:j.totalDatasets,overlaps:j.overlaps.length,healthScore:j.healthScore}),j}async checkDatasetCreationConflicts(a,t){var j,w;console.log("ðŸ” [DatasetConflictAnalyzer] Checking conflicts for new dataset:",a.name);const r=[],c=[];if(!((w=(j=a.collectionAssignment)==null?void 0:j.selectedCollections)!=null&&w.length))return{hasConflicts:!1,warnings:[],suggestions:[]};const l=a.collectionAssignment.selectedCollections;for(const C of l){const D=t.filter(E=>{var _,Q;return(Q=(_=E.collectionAssignment)==null?void 0:_.selectedCollections)==null?void 0:Q.includes(C)});if(D.length>0){const E=this.assessConflictLevel(C,D,a);E!=="none"&&r.push({type:"overlap",severity:E==="high"?"error":E==="medium"?"warning":"info",message:`Collection "${C}" is already used by ${D.length} other dataset(s)`,affectedCollections:[C],affectedDatasets:D.map(_=>_.name),recommendation:this.getConflictRecommendation(C,D,a)}),E==="high"?c.push({type:"filter",message:"Consider adding data filters to differentiate from existing datasets",collections:[C]}):D.length>=3&&c.push({type:"merge",message:`Collection "${C}" is heavily used. Consider merging with existing dataset "${D[0].name}"`,collections:[C]})}}const h=this.checkRedundancyPatterns(l,t);r.push(...h.warnings),c.push(...h.suggestions);const i=this.checkPerformanceImplications(l,t);return r.push(...i),{hasConflicts:r.some(C=>C.severity==="error"),warnings:r,suggestions:c}}getConflictResolutionRecommendations(a){const t=[],r=a.overlaps.filter(c=>c.conflictLevel==="high");for(const c of r)t.push({type:"merge",priority:"high",title:`Merge datasets using "${c.collection}"`,description:`Collection "${c.collection}" is used by ${c.datasets.length} datasets with high conflict potential`,affectedDatasets:c.datasets.map(l=>l.name),estimatedImpact:"Reduces data redundancy and improves query performance",steps:["Review data usage patterns for each dataset","Identify common use cases and data access patterns","Create a unified dataset with appropriate data filters","Migrate existing queries to use the new unified dataset"]});for(const c of a.globalInsights.redundantAssignments)t.push({type:"filter",priority:"medium",title:`Add data filters for "${c.collection}"`,description:c.reason,affectedDatasets:c.affectedDatasets,estimatedImpact:"Improves data organization and reduces confusion",steps:["Analyze data access patterns for each dataset","Define specific filter criteria for each use case","Update dataset configurations with appropriate filters","Test data access to ensure proper isolation"]});if(a.globalInsights.mostUsedCollections.length>0){const c=a.globalInsights.mostUsedCollections[0];c.count>3&&t.push({type:"reorganize",priority:"low",title:`Optimize "${c.collection}" usage`,description:`This collection is used by ${c.count} datasets, consider optimization`,affectedDatasets:c.datasets,estimatedImpact:"Improves query performance and reduces resource usage",steps:["Review query patterns for this collection","Consider creating specialized views or indexes","Implement caching strategies for frequently accessed data","Monitor performance improvements"]})}return t.sort((c,l)=>{const h={high:3,medium:2,low:1};return h[l.priority]-h[c.priority]})}buildCollectionUsageMap(a){var r;const t={};for(const c of a)if((r=c.collectionAssignment)!=null&&r.selectedCollections)for(const l of c.collectionAssignment.selectedCollections)t[l]||(t[l]=[]),t[l].push(c);return t}detectCollectionOverlaps(a,t){const r=[];for(const[c,l]of Object.entries(a))if(l.length>1){const h=this.assessOverlapConflictLevel(c,l),i=this.getConflictReasons(c,l),j=this.getOverlapRecommendations(c,l);r.push({collection:c,datasets:l.map(w=>{var C,D,E;return{id:w.id,name:w.name,visibility:w.visibility||"private",organizationScope:((C=w.collectionAssignment)==null?void 0:C.organizationScope)!==!1,filters:(E=(D=w.collectionAssignment)==null?void 0:D.dataFilters)==null?void 0:E.filter(_=>_.collection===c)}}),conflictLevel:h,conflictReasons:i,recommendations:j})}return r.sort((c,l)=>{const h={high:4,medium:3,low:2,none:1};return h[l.conflictLevel]-h[c.conflictLevel]})}generateGlobalInsights(a,t){var i;const r=Object.entries(a).map(([j,w])=>({collection:j,count:w.length,datasets:w.map(C=>C.name)})).sort((j,w)=>w.count-j.count).slice(0,10),c=Object.entries(a).filter(([j,w])=>w.length>1).map(([j,w])=>w.some(D=>{var E,_;return(_=(E=D.collectionAssignment)==null?void 0:E.dataFilters)==null?void 0:_.some(Q=>Q.collection===j)})?null:{collection:j,reason:`Used by ${w.length} datasets without data filters - potential redundancy`,affectedDatasets:w.map(D=>D.name)}).filter(Boolean),l=[],h=[];return c.length>0&&h.push("Consider adding data filters to datasets with overlapping collections"),((i=r[0])==null?void 0:i.count)>3&&h.push(`Collection "${r[0].collection}" is heavily used - consider optimization`),t.length>10&&h.push("Large number of datasets detected - consider consolidation opportunities"),{mostUsedCollections:r,redundantAssignments:c,schemaConflicts:l,recommendations:h}}calculateHealthScore(a,t){let r=100;for(const c of a)switch(c.conflictLevel){case"high":r-=15;break;case"medium":r-=8;break;case"low":r-=3;break}return r-=t.redundantAssignments.length*5,r-=t.schemaConflicts.length*10,Math.max(0,Math.min(100,r))}assessOverlapConflictLevel(a,t){if(new Set(t.map(l=>l.visibility)).size>1)return"high";const c=t.some(l=>{var h,i;return(i=(h=l.collectionAssignment)==null?void 0:h.dataFilters)==null?void 0:i.some(j=>j.collection===a)});return!c&&t.length>2?"medium":!c&&t.length===2?"low":"none"}assessConflictLevel(a,t,r){var i,j;if(new Set(t.map(w=>w.visibility)).has("public")&&r.visibility!=="public")return"high";const l=t.some(w=>{var C,D;return(D=(C=w.collectionAssignment)==null?void 0:C.dataFilters)==null?void 0:D.some(E=>E.collection===a)}),h=(j=(i=r.collectionAssignment)==null?void 0:i.dataFilters)==null?void 0:j.some(w=>w.collection===a);return!l&&!h?t.length>1?"high":"medium":"low"}getConflictReasons(a,t){const r=[];return new Set(t.map(h=>h.visibility)).size>1&&r.push("Datasets have different visibility levels"),t.some(h=>{var i,j;return(j=(i=h.collectionAssignment)==null?void 0:i.dataFilters)==null?void 0:j.some(w=>w.collection===a)})||r.push("No data filters defined - potential data redundancy"),t.length>3&&r.push("Collection used by many datasets - consider consolidation"),r}getOverlapRecommendations(a,t){const r=[];return t.some(h=>{var i,j;return(j=(i=h.collectionAssignment)==null?void 0:i.dataFilters)==null?void 0:j.some(w=>w.collection===a)})||r.push("Add data filters to differentiate dataset purposes"),t.length>2&&r.push("Consider merging similar datasets to reduce redundancy"),new Set(t.map(h=>h.visibility)).size>1&&r.push("Standardize visibility levels across related datasets"),r}getConflictRecommendation(a,t,r){return t.some(l=>{var h,i;return(i=(h=l.collectionAssignment)==null?void 0:h.dataFilters)==null?void 0:i.some(j=>j.collection===a)})?t.length>2?`Consider merging with existing dataset "${t[0].name}"`:"Review existing usage to avoid data redundancy":"Add data filters to differentiate from existing datasets"}checkRedundancyPatterns(a,t){var l;const r=[],c=[];for(const h of t)if((l=h.collectionAssignment)!=null&&l.selectedCollections){const j=a.filter(w=>h.collectionAssignment.selectedCollections.includes(w)).length/a.length;j>.7&&(r.push({type:"redundancy",severity:"warning",message:`${Math.round(j*100)}% overlap with existing dataset "${h.name}"`,affectedCollections:a,affectedDatasets:[h.name],recommendation:"Consider extending the existing dataset instead of creating a new one"}),c.push({type:"merge",message:`Merge with "${h.name}" to avoid redundancy`,collections:a}))}return{warnings:r,suggestions:c}}checkPerformanceImplications(a,t){const r=[],c=["users","activities","sessions","audit_log"];return a.some(h=>c.includes(h))&&a.length>5&&r.push({type:"performance",severity:"info",message:"Dataset includes large collections - consider performance implications",affectedCollections:a.filter(h=>c.includes(h)),affectedDatasets:[],recommendation:"Add data filters or consider splitting into smaller datasets"}),r}};Me(Es,"instance");let Vt=Es;const er=Vt.getInstance(),ht={"Core System":{icon:"ðŸ‘¥",description:"User management, organizations, and core system data",collections:["users","teamMembers","organizations","roles","projects","projectTeamMembers","clients","contacts","test"],isSystem:!0},"Sessions & Workflows":{icon:"ðŸŽ¬",description:"Production sessions, workflows, and task management",collections:["sessions","sessionWorkflows","sessionAssignments","sessionParticipants","workflowTemplates","workflowDiagrams","workflowInstances","workflowSteps","workflowAssignments","sessionPhaseTransitions","sessionReviews","sessionQc","sessionTasks","demoSessions"],isSystem:!0},"Inventory & Equipment":{icon:"ðŸ“¦",description:"Equipment tracking, network management, and inventory systems",collections:["inventoryItems","inventory","networkIPAssignments","networkIPRanges","networks","inventoryHistory","setupProfiles","schemas","schemaFields","mapLayouts","mapLocations","inventoryMaps","mapData"],isSystem:!0},"Timecards & Scheduling":{icon:"â°",description:"Time tracking, approvals, and scheduling systems",collections:["timecard_entries","user_timecards","timecard_approvals","timecard_templates"],isSystem:!0},"Media & Content":{icon:"ðŸŽ¥",description:"Media files, production tasks, and content management",collections:["mediaFiles","postProductionTasks","stages","notes","reports","callSheets"],isSystem:!0},"AI & Automation":{icon:"ðŸ¤–",description:"AI agents, messaging, and automated systems",collections:["aiAgents","messages","chats","messageSessions"],isSystem:!0},"Business & Licensing":{icon:"ðŸ’¼",description:"Licenses, subscriptions, payments, and business data",collections:["licenses","subscriptions","payments","userPreferences"],isSystem:!0},"Production Budget Management":{icon:"ðŸ’°",description:"Budget tracking, schedules, and financial management",collections:["pbmProjects","pbmSchedules","pbmPayscales","pbmDailyStatus"],isSystem:!0},"Network Delivery & Deliverables":{icon:"ðŸ“¡",description:"Network delivery bibles, deliverables, and post-production workflows",collections:["networkDeliveryBibles","deliverables","networkDeliveryChats","deliverySpecs","deliveryTemplates","deliveryTracking"],isSystem:!0,isDynamic:!0}},Is=class Is{constructor(){Me(this,"cache",new Map);Me(this,"CACHE_TTL",5*60*1e3);Me(this,"DISCOVERY_ENDPOINT","https://us-central1-backbone-logic.cloudfunctions.net/api/collections/discover")}static getInstance(){return Is.instance||(Is.instance=new Is),Is.instance}async discoverCollections(a,t){const r=`collections_${a||"global"}`,c=this.getCachedResult(r);if(c)return console.log("ðŸŽ¯ [DynamicCollectionDiscovery] Using cached collections"),c;try{if(t){const h=await this.discoverFromFirebase(a,t);if(h)return this.setCachedResult(r,h),h}}catch(h){console.warn("âš ï¸ [DynamicCollectionDiscovery] Dynamic discovery failed, falling back to static:",h)}const l={collections:ht,totalCollections:this.getTotalCollectionCount(ht),lastUpdated:new Date,source:"static"};return this.setCachedResult(r,l),l}async discoverFromFirebase(a,t){try{if(console.log("ðŸ” [DynamicCollectionDiscovery] Discovering collections from Firebase..."),!t)return console.warn("âš ï¸ [DynamicCollectionDiscovery] No auth token provided for collection discovery"),null;const r=await fetch(this.DISCOVERY_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({organizationId:a,includeMetadata:!0,categorize:!0})});if(!r.ok)throw new Error(`Collection discovery API failed: ${r.status}`);const c=await r.json();if(!c.success)throw new Error(`Collection discovery failed: ${c.error}`);const l=this.processDiscoveredCollections(c.collections),h={collections:l,totalCollections:this.getTotalCollectionCount(l),lastUpdated:new Date,source:"dynamic"};return console.log(`âœ… [DynamicCollectionDiscovery] Discovered ${h.totalCollections} collections across ${Object.keys(l).length} categories`),h}catch(r){return console.error("âŒ [DynamicCollectionDiscovery] Firebase discovery failed:",r),null}}processDiscoveredCollections(a){const t={};for(const[l,h]of Object.entries(ht))t[l]={...h,collections:[...h.collections]};const r=new Set(Object.values(t).flatMap(l=>l.collections)),c=a.filter(l=>!r.has(l)&&this.isValidCollectionName(l));for(const l of c){const h=this.categorizeCollection(l);t[h]?(t[h].collections.push(l),t[h].isDynamic=!0):t["Custom Collections"]={icon:"ðŸ”§",description:"Custom and dynamically discovered collections",collections:[l],isDynamic:!0}}return t}categorizeCollection(a){const t=a.toLowerCase();return t.includes("delivery")||t.includes("deliverable")||t.includes("bible")||t.includes("network")&&(t.includes("delivery")||t.includes("spec"))?"Network Delivery & Deliverables":t.includes("session")||t.includes("workflow")||t.includes("task")||t.includes("assignment")&&t.includes("session")?"Sessions & Workflows":t.includes("media")||t.includes("video")||t.includes("audio")||t.includes("production")||t.includes("stage")||t.includes("call")||t.includes("post")&&t.includes("production")?"Media & Content":t.includes("inventory")||t.includes("equipment")||t.includes("network")||t.includes("ip")||t.includes("map")||t.includes("location")||t.includes("setup")||t.includes("schema")?"Inventory & Equipment":t.includes("user")||t.includes("team")||t.includes("member")||t.includes("role")||t.includes("organization")||t.includes("client")||t.includes("contact")?"Core System":t.includes("timecard")||t.includes("schedule")||t.includes("time")||t.includes("approval")||t.includes("template")&&t.includes("time")?"Timecards & Scheduling":t.includes("ai")||t.includes("agent")||t.includes("message")||t.includes("chat")||t.includes("bot")?"AI & Automation":t.includes("license")||t.includes("subscription")||t.includes("payment")||t.includes("billing")||t.includes("invoice")?"Business & Licensing":t.includes("pbm")||t.includes("budget")||t.includes("payscale")||t.includes("daily")&&t.includes("status")?"Production Budget Management":"Custom Collections"}isValidCollectionName(a){return!a.startsWith("_")&&!a.includes("_backup")&&!a.includes("_temp")&&!a.includes("_cache")&&!a.startsWith("firebase-")&&a.length>0}getCachedResult(a){const t=this.cache.get(a);return t&&Date.now()-t.lastUpdated.getTime()<this.CACHE_TTL?{...t,source:"cached"}:null}setCachedResult(a,t){this.cache.set(a,t)}clearCache(){this.cache.clear(),console.log("ðŸ—‘ï¸ [DynamicCollectionDiscovery] Cache cleared")}getTotalCollectionCount(a){return Object.values(a).reduce((t,r)=>t+r.collections.length,0)}getStaticCollections(){return ht}};Me(Is,"instance");let qt=Is;const pt=qt.getInstance(),Kt=u=>Object.values(u).flatMap(a=>a.collections),Ha=(u,a)=>{var t;return((t=u[a])==null?void 0:t.collections)||[]},Va=(u,a)=>{for(const[t,r]of Object.entries(u))if(r.collections.includes(a))return t;return null},qa=(u,a)=>Kt(u).includes(a),Nr=u=>{const{user:a}=Dr(),[t,r]=m.useState(null),[c,l]=m.useState(!0),[h,i]=m.useState(null),j=m.useCallback(async()=>{if(!a){l(!1);return}try{l(!0),i(null),console.log("ðŸ” [useDynamicCollections] Discovering collections...");const Q=ra.getStoredToken()||void 0,oe=await pt.discoverCollections(u||a.organizationId||a.id,Q);r(oe),console.log(`âœ… [useDynamicCollections] Loaded ${oe.totalCollections} collections from ${oe.source} source`)}catch(Q){const oe=Q instanceof Error?Q.message:"Failed to discover collections";console.error("âŒ [useDynamicCollections] Discovery failed:",Q),i(oe);const je=pt.getStaticCollections();r({collections:je,totalCollections:Kt(je).length,lastUpdated:new Date,source:"static"})}finally{l(!1)}},[a,u]);m.useEffect(()=>{j()},[j]);const w=m.useCallback(async()=>{pt.clearCache(),await j()},[j]),C=m.useCallback(()=>{pt.clearCache()},[]),D=m.useCallback(Q=>t?Ha(t.collections,Q):[],[t]),E=m.useCallback(Q=>t?Va(t.collections,Q):null,[t]),_=m.useCallback(Q=>t?qa(t.collections,Q):!1,[t]);return{collections:(t==null?void 0:t.collections)||{},allCollections:t?Kt(t.collections):[],totalCount:(t==null?void 0:t.totalCollections)||0,loading:c,error:h,lastUpdated:(t==null?void 0:t.lastUpdated)||null,source:(t==null?void 0:t.source)||"static",refresh:w,clearCache:C,getCollectionsByCategory:D,getCategoryForCollection:E,isValidCollection:_}},_t=["Basic Information","Cloud Provider Selection","Authentication Setup","Storage Configuration","Collection Assignment","Advanced Options","Review & Create"],Ot={name:"",description:"",visibility:"private",tags:[],cloudProvider:"firestore",authentication:{},storage:{backend:"firestore"},schema:{template:"custom",customFields:[]},collectionAssignment:{selectedCollections:[],includeSubcollections:!1,dataFilters:[],organizationScope:!0},advanced:{encryption:!1,compression:!1,backup:!0,versioning:!1,accessLogging:!1}},Ka=Or.memo(({open:u,onClose:a,onSuccess:t,preselectedProvider:r,assignToProject:c})=>{var V;const[l,h]=m.useState(0),[i,j]=m.useState(Ot),[w,C]=m.useState(!1),[D,E]=m.useState(null),[_,Q]=m.useState({}),[oe,je]=m.useState({}),[Ce,R]=m.useState(!1),[J,ve]=m.useState(null),[se,pe]=m.useState(null),[te,xe]=m.useState([]),[re,ie]=m.useState(!1),{collections:ge,allCollections:_e,loading:O,source:W,refresh:q}=Nr(),K=m.useCallback(()=>{const I=r||"firestore",Y=I==="azure-blob"?"azure":I;j({...Ot,cloudProvider:I,storage:{...Ot.storage,backend:Y}}),h(0),E(null),Q({}),je({}),ve(null)},[r]);m.useEffect(()=>{u&&K()},[u,K]);const U=m.useCallback(I=>{j(be=>({...be,...I}));const Y={..._};Object.keys(I).forEach(be=>{delete Y[be]}),Q(Y)},[_]),Se=m.useCallback(I=>{var be,x,P,y,f,L,v,de,Ne;const Y={};switch(I){case 0:i.name.trim()||(Y.name="Dataset name is required"),i.name.length>100&&(Y.name="Dataset name must be 100 characters or less");break;case 1:i.cloudProvider||(Y.cloudProvider="Please select a cloud provider");break;case 2:(i.cloudProvider==="firestore"||i.cloudProvider==="gcs")&&((be=i.authentication.projectId)!=null&&be.trim()||(Y.projectId="Project ID is required for Google Cloud services")),(i.cloudProvider==="s3"||i.cloudProvider==="aws")&&((x=i.authentication.accessKeyId)!=null&&x.trim()||(Y.accessKeyId="Access Key ID is required for AWS services"),(P=i.authentication.secretAccessKey)!=null&&P.trim()||(Y.secretAccessKey="Secret Access Key is required for AWS services")),i.cloudProvider==="azure-blob"&&((y=i.authentication.connectionString)!=null&&y.trim()||(Y.connectionString="Connection string is required for Azure services"));break;case 3:i.cloudProvider==="gcs"&&!((f=i.storage.gcsBucket)!=null&&f.trim())&&(Y.gcsBucket="GCS bucket name is required"),i.cloudProvider==="s3"&&!((L=i.storage.s3Bucket)!=null&&L.trim())&&(Y.s3Bucket="S3 bucket name is required"),i.cloudProvider==="azure-blob"&&!((v=i.storage.azureContainer)!=null&&v.trim())&&(Y.azureContainer="Azure container name is required");break;case 4:i.cloudProvider==="firestore"&&((Ne=(de=i.collectionAssignment)==null?void 0:de.selectedCollections)!=null&&Ne.length||(Y.collections="Please select at least one Firestore collection for this dataset"));break}return Q(Y),Object.keys(Y).length===0},[i]),Oe=m.useCallback(()=>{Se(l)&&h(I=>Math.min(I+1,_t.length-1))},[l,Se]),Ae=m.useCallback(()=>{h(I=>Math.max(I-1,0))},[]),De=m.useCallback(I=>{I<l&&h(I)},[l]),Pe=m.useCallback(I=>{je(Y=>({...Y,[I]:!Y[I]}))},[]),b=m.useCallback(async()=>{if(i.cloudProvider){R(!0),ve(null);try{await new Promise(I=>setTimeout(I,2e3)),ve({success:!0,message:"Connection test successful!"})}catch(I){ve({success:!1,message:`Connection test failed: ${I instanceof Error?I.message:"Unknown error"}`})}finally{R(!1)}}},[i.cloudProvider]),B=m.useCallback(async()=>{if(Se(l)){C(!0),E(null);try{const I=await le.createDataset({name:i.name,description:i.description,visibility:i.visibility,tags:i.tags,storage:i.storage,schema:i.schema,projectId:c||"default-project",collectionAssignment:i.cloudProvider==="firestore"?i.collectionAssignment:void 0});I?(t==null||t(I),a==null||a()):E("Failed to create dataset: No dataset returned")}catch(I){E(`Failed to create dataset: ${I instanceof Error?I.message:"Unknown error"}`)}finally{C(!1)}}},[l,Se,i,t,a]),$=m.useCallback(async()=>{try{const I=await le.listDatasets();xe(I),console.log("âœ… [DatasetCreationWizard] Loaded existing datasets for conflict analysis:",I.length)}catch(I){console.warn("âš ï¸ [DatasetCreationWizard] Failed to load existing datasets:",I),xe([])}},[]),H=m.useCallback(async()=>{var I,Y;if(i.cloudProvider!=="firestore"||!((Y=(I=i.collectionAssignment)==null?void 0:I.selectedCollections)!=null&&Y.length)){pe(null);return}ie(!0);try{const be=await er.checkDatasetCreationConflicts({name:i.name,collectionAssignment:i.collectionAssignment},te);pe(be),console.log("âœ… [DatasetCreationWizard] Conflict check complete:",be)}catch(be){console.error("âŒ [DatasetCreationWizard] Failed to check conflicts:",be),pe(null)}finally{ie(!1)}},[i.cloudProvider,i.name,i.collectionAssignment,te]);m.useEffect(()=>{u&&$()},[u,$]),m.useEffect(()=>{var I,Y;if(l===4&&((Y=(I=i.collectionAssignment)==null?void 0:I.selectedCollections)!=null&&Y.length)){const be=setTimeout(()=>{H()},500);return()=>clearTimeout(be)}},[l,(V=i.collectionAssignment)==null?void 0:V.selectedCollections,H]);const ne=m.useCallback(I=>{var Y,be,x,P,y,f,L,v,de,Ne,Re,Ze,us,fe,ys,rt,js;switch(I){case 0:return e.jsxs(n,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Basic Information"}),e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Dataset Name",value:i.name,onChange:T=>U({name:T.target.value}),error:!!_.name,helperText:_.name,required:!0})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Description (Optional)",value:i.description||"",onChange:T=>U({description:T.target.value}),multiline:!0,rows:3})}),e.jsx(p,{item:!0,xs:12,children:e.jsxs(He,{fullWidth:!0,children:[e.jsx(ia,{children:"Visibility"}),e.jsxs(la,{value:i.visibility,onChange:T=>U({visibility:T.target.value}),row:!0,children:[e.jsx(Ie,{value:"private",control:e.jsx(Et,{}),label:"Private"}),e.jsx(Ie,{value:"organization",control:e.jsx(Et,{}),label:"Organization"}),e.jsx(Ie,{value:"public",control:e.jsx(Et,{}),label:"Public"})]})]})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Tags (Optional)",value:((Y=i.tags)==null?void 0:Y.join(", "))||"",onChange:T=>U({tags:T.target.value.split(",").map(me=>me.trim()).filter(me=>me.length>0)}),placeholder:"tag1, tag2, tag3",helperText:"Comma-separated tags for organization"})})]})]});case 1:return e.jsxs(n,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Cloud Provider Selection"}),e.jsx(p,{container:!0,spacing:2,children:[{value:"firestore",label:"Firestore",icon:e.jsx(et,{}),description:"Google Cloud Firestore"},{value:"gcs",label:"Google Cloud Storage",icon:e.jsx(Ge,{}),description:"Google Cloud Storage"},{value:"s3",label:"Amazon S3",icon:e.jsx(et,{}),description:"Amazon S3"},{value:"aws",label:"AWS Services",icon:e.jsx(et,{}),description:"AWS Services"},{value:"azure-blob",label:"Azure Blob Storage",icon:e.jsx(Ge,{}),description:"Microsoft Azure"},{value:"local",label:"Local Storage",icon:e.jsx(Bt,{}),description:"Local file system"}].map(T=>e.jsx(p,{item:!0,xs:12,sm:6,md:4,children:e.jsx(ue,{sx:{cursor:"pointer",border:i.cloudProvider===T.value?"2px solid":"1px solid",borderColor:i.cloudProvider===T.value?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>{const me=T.value,ze=me==="azure-blob"?"azure":me;U({cloudProvider:me,storage:{...i.storage,backend:ze}})},children:e.jsxs(ye,{sx:{textAlign:"center",p:2},children:[e.jsx(n,{sx:{mb:1},children:T.icon}),e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600},children:T.label}),e.jsx(o,{variant:"body2",color:"text.secondary",children:T.description})]})})},T.value))})]});case 2:return e.jsxs(n,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Authentication Setup"}),i.cloudProvider==="firestore"||i.cloudProvider==="gcs"?e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Project ID",value:i.authentication.projectId||"",onChange:T=>U({authentication:{...i.authentication,projectId:T.target.value}}),error:!!_.projectId,helperText:_.projectId,required:!0})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Service Account Key (Optional)",value:i.authentication.serviceAccountKey||"",onChange:T=>U({authentication:{...i.authentication,serviceAccountKey:T.target.value}}),multiline:!0,rows:4,placeholder:"Paste your service account JSON key here..."})})]}):i.cloudProvider==="s3"||i.cloudProvider==="aws"?e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Access Key ID",value:i.authentication.accessKeyId||"",onChange:T=>U({authentication:{...i.authentication,accessKeyId:T.target.value}}),error:!!_.accessKeyId,helperText:_.accessKeyId,required:!0})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Secret Access Key",value:i.authentication.secretAccessKey||"",onChange:T=>U({authentication:{...i.authentication,secretAccessKey:T.target.value}}),error:!!_.secretAccessKey,helperText:_.secretAccessKey,required:!0,type:oe.secretAccessKey?"text":"password",InputProps:{endAdornment:e.jsx(Er,{position:"end",children:e.jsx(_s,{onClick:()=>Pe("secretAccessKey"),edge:"end",children:oe.secretAccessKey?e.jsx(na,{}):e.jsx(Ir,{})})})}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Region",value:i.authentication.region||"",onChange:T=>U({authentication:{...i.authentication,region:T.target.value}}),placeholder:"us-east-1"})})]}):i.cloudProvider==="azure-blob"?e.jsx(p,{container:!0,spacing:3,children:e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Connection String",value:i.authentication.connectionString||"",onChange:T=>U({authentication:{...i.authentication,connectionString:T.target.value}}),error:!!_.connectionString,helperText:_.connectionString,required:!0,multiline:!0,rows:3,placeholder:"DefaultEndpointsProtocol=https;AccountName=..."})})}):e.jsx(o,{color:"text.secondary",children:"No authentication required for local storage."}),i.cloudProvider!=="local"&&e.jsxs(n,{sx:{mt:3},children:[e.jsx(F,{variant:"outlined",onClick:b,disabled:Ce,startIcon:Ce?e.jsx(ds,{size:16}):e.jsx(ft,{}),children:Ce?"Testing Connection...":"Test Connection"}),J&&e.jsx(he,{severity:J.success?"success":"error",sx:{mt:2},children:J.message})]})]});case 3:return e.jsxs(n,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Storage Configuration"}),i.cloudProvider==="gcs"&&e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"GCS Bucket Name",value:i.storage.gcsBucket||"",onChange:T=>U({storage:{...i.storage,gcsBucket:T.target.value}}),error:!!_.gcsBucket,helperText:_.gcsBucket,required:!0,placeholder:"my-dataset-bucket"})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Prefix (Optional)",value:i.storage.gcsPrefix||"",onChange:T=>U({storage:{...i.storage,gcsPrefix:T.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),i.cloudProvider==="s3"&&e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"S3 Bucket Name",value:i.storage.s3Bucket||"",onChange:T=>U({storage:{...i.storage,s3Bucket:T.target.value}}),error:!!_.s3Bucket,helperText:_.s3Bucket,required:!0,placeholder:"my-dataset-bucket"})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Region",value:i.storage.s3Region||"",onChange:T=>U({storage:{...i.storage,s3Region:T.target.value}}),placeholder:"us-east-1"})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Prefix (Optional)",value:i.storage.s3Prefix||"",onChange:T=>U({storage:{...i.storage,s3Prefix:T.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),i.cloudProvider==="azure-blob"&&e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Container Name",value:i.storage.azureContainer||"",onChange:T=>U({storage:{...i.storage,azureContainer:T.target.value}}),error:!!_.azureContainer,helperText:_.azureContainer,required:!0,placeholder:"datasets"})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,label:"Prefix (Optional)",value:i.storage.azurePrefix||"",onChange:T=>U({storage:{...i.storage,azurePrefix:T.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),i.cloudProvider==="local"&&e.jsx(o,{color:"text.secondary",children:"Local storage will be configured automatically based on your system settings."}),e.jsxs(he,{severity:"info",sx:{mt:3},children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:600,mb:.5},children:"Using Backbone Logic Unified Schema"}),e.jsx(o,{variant:"body2",children:"The standard Backbone Logic schema will be automatically applied to this dataset. This ensures full compatibility with all application features and provides a consistent data structure."})]})]});case 4:return e.jsxs(n,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Collection Assignment"}),i.cloudProvider==="firestore"?e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(he,{severity:"info",sx:{mb:2},children:e.jsx(o,{variant:"body2",children:"Select which Firestore collections this dataset should include. Data will be automatically scoped to your organization for security."})})}),e.jsx(p,{item:!0,xs:12,children:e.jsxs(n,{sx:{mb:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsx(o,{variant:"subtitle2",sx:{color:"white"},children:"Select Collections by Category"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(z,{size:"small",label:O?"Loading...":`${_e.length} collections`,color:W==="dynamic"?"success":W==="cached"?"info":"default",variant:"outlined",sx:{color:"white",borderColor:"rgba(255, 255, 255, 0.3)","& .MuiChip-label":{fontSize:"0.75rem"}}}),W==="dynamic"&&e.jsx(_s,{size:"small",onClick:q,sx:{color:"rgba(255, 255, 255, 0.7)"},title:"Refresh collections",children:e.jsx(bt,{fontSize:"small"})})]})]}),Object.entries(ge).map(([T,me])=>{var Je;const ze=((Je=i.collectionAssignment)==null?void 0:Je.selectedCollections)||[],Be=me.collections,es=Be.filter(ke=>ze.includes(ke)),ss=es.length===Be.length,Cs=es.length>0,Ls=()=>{var Ee,ts,gs;let ke;if(ss)ke=ze.filter(Ve=>!Be.includes(Ve));else{const Ve=Be.filter(ms=>!ze.includes(ms));ke=[...ze,...Ve]}U({collectionAssignment:{...i.collectionAssignment,selectedCollections:ke,includeSubcollections:((Ee=i.collectionAssignment)==null?void 0:Ee.includeSubcollections)||!1,dataFilters:((ts=i.collectionAssignment)==null?void 0:ts.dataFilters)||[],organizationScope:((gs=i.collectionAssignment)==null?void 0:gs.organizationScope)!==!1}})};return e.jsxs(n,{sx:{mb:3},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,mb:1,p:1,bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:1,border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(o,{sx:{fontSize:"1.2rem"},children:me.icon}),e.jsxs(n,{children:[e.jsx(o,{variant:"subtitle2",sx:{color:"white",fontWeight:600},children:T}),e.jsx(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:me.description})]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",minWidth:"80px",textAlign:"right"},children:[es.length,"/",Be.length," selected"]}),e.jsx(F,{variant:ss?"outlined":"contained",size:"small",onClick:Ls,sx:{minWidth:"100px",textTransform:"none",fontSize:"0.75rem",py:.5,px:1.5,...ss?{borderColor:"rgba(239, 68, 68, 0.5)",color:"#ef4444","&:hover":{borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)"}}:{background:Cs?"linear-gradient(135deg, #f59e0b, #f97316)":"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white","&:hover":{background:Cs?"linear-gradient(135deg, #d97706, #ea580c)":"linear-gradient(135deg, #7c3aed, #9333ea)",transform:"translateY(-1px)"}}},children:ss?"Remove All":Cs?"Add Remaining":"Add All"})]})]}),e.jsx(n,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:1,pl:2},children:me.collections.map(ke=>{var ts,gs;const Ee=((gs=(ts=i.collectionAssignment)==null?void 0:ts.selectedCollections)==null?void 0:gs.includes(ke))||!1;return e.jsx(n,{onClick:()=>{var vs,Ss,Fs,hs;const Ve=((vs=i.collectionAssignment)==null?void 0:vs.selectedCollections)||[],ms=Ee?Ve.filter(Ws=>Ws!==ke):[...Ve,ke];U({collectionAssignment:{...i.collectionAssignment,selectedCollections:ms,includeSubcollections:((Ss=i.collectionAssignment)==null?void 0:Ss.includeSubcollections)||!1,dataFilters:((Fs=i.collectionAssignment)==null?void 0:Fs.dataFilters)||[],organizationScope:((hs=i.collectionAssignment)==null?void 0:hs.organizationScope)!==!1}})},sx:{p:1.5,border:Ee?"2px solid #8b5cf6":"1px solid rgba(255, 255, 255, 0.2)",borderRadius:1,bgcolor:Ee?"rgba(139, 92, 246, 0.1)":"rgba(255, 255, 255, 0.02)",cursor:"pointer",transition:"all 0.2s ease","&:hover":{bgcolor:Ee?"rgba(139, 92, 246, 0.2)":"rgba(255, 255, 255, 0.05)",borderColor:Ee?"#8b5cf6":"rgba(255, 255, 255, 0.4)",transform:"translateY(-1px)"}},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{fontSize:"small",sx:{color:Ee?"#8b5cf6":"rgba(255, 255, 255, 0.7)"}}),e.jsx(o,{variant:"body2",sx:{color:Ee?"#8b5cf6":"white",fontWeight:Ee?600:400,fontSize:"0.85rem"},children:ke}),Ee&&e.jsx(ft,{fontSize:"small",sx:{color:"#8b5cf6",ml:"auto"}})]})},ke)})})]},T)})]})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(Ie,{control:e.jsx(Fe,{checked:((be=i.collectionAssignment)==null?void 0:be.includeSubcollections)||!1,onChange:T=>{var me,ze,Be;return U({collectionAssignment:{selectedCollections:((me=i.collectionAssignment)==null?void 0:me.selectedCollections)||[],includeSubcollections:T.target.checked,dataFilters:((ze=i.collectionAssignment)==null?void 0:ze.dataFilters)||[],organizationScope:((Be=i.collectionAssignment)==null?void 0:Be.organizationScope)||!1}})}}),label:"Include Subcollections"})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(Ie,{control:e.jsx(Fe,{checked:((x=i.collectionAssignment)==null?void 0:x.organizationScope)!==!1,onChange:T=>{var me,ze,Be;return U({collectionAssignment:{selectedCollections:((me=i.collectionAssignment)==null?void 0:me.selectedCollections)||[],includeSubcollections:((ze=i.collectionAssignment)==null?void 0:ze.includeSubcollections)||!1,dataFilters:((Be=i.collectionAssignment)==null?void 0:Be.dataFilters)||[],organizationScope:T.target.checked}})}}),label:"Organization Scoped Data (Recommended for Multi-Tenancy)"})}),(((y=(P=i.collectionAssignment)==null?void 0:P.selectedCollections)==null?void 0:y.length)||0)>0&&e.jsxs(p,{item:!0,xs:12,children:[e.jsxs(o,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:["Selected Collections Preview",e.jsx(z,{label:`${((L=(f=i.collectionAssignment)==null?void 0:f.selectedCollections)==null?void 0:L.length)||0} selected`,size:"small",color:"primary",variant:"outlined"})]}),e.jsx(Ke,{sx:{p:2,bgcolor:"rgba(25, 118, 210, 0.04)",border:"1px solid rgba(25, 118, 210, 0.12)",borderRadius:2},children:e.jsxs(n,{sx:{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center"},children:[(de=(v=i.collectionAssignment)==null?void 0:v.selectedCollections)==null?void 0:de.map(T=>e.jsx(z,{icon:e.jsx($e,{fontSize:"small"}),label:T,variant:"filled",color:"primary",size:"small",sx:{bgcolor:"rgba(25, 118, 210, 0.08)",color:"primary.main",border:"1px solid rgba(25, 118, 210, 0.2)","& .MuiChip-icon":{color:"primary.main"},"&:hover":{bgcolor:"rgba(25, 118, 210, 0.12)"}}},T)),((Ne=i.collectionAssignment)==null?void 0:Ne.organizationScope)&&e.jsx(z,{label:"Organization Scoped",size:"small",color:"success",variant:"outlined",sx:{ml:1,fontWeight:600,bgcolor:"rgba(46, 125, 50, 0.04)"}})]})})]}),re&&e.jsx(p,{item:!0,xs:12,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:1},children:[e.jsx(ds,{size:20}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Analyzing collection conflicts..."})]})}),se&&(se.warnings.length>0||se.suggestions.length>0)&&e.jsx(p,{item:!0,xs:12,children:e.jsxs(n,{sx:{mt:2},children:[e.jsxs(o,{variant:"subtitle2",gutterBottom:!0,sx:{color:"white",display:"flex",alignItems:"center",gap:1},children:[e.jsx(yt,{fontSize:"small",color:"warning"}),"Smart Analysis Results"]}),se.warnings.map((T,me)=>e.jsx(he,{severity:T.severity,sx:{mb:1,bgcolor:"rgba(255, 255, 255, 0.05)"},children:e.jsxs(n,{children:[e.jsx(o,{variant:"body2",sx:{fontWeight:500,mb:.5},children:T.message}),T.affectedDatasets.length>0&&e.jsxs(o,{variant:"caption",sx:{display:"block",mb:.5},children:["Affected datasets: ",T.affectedDatasets.join(", ")]}),e.jsxs(o,{variant:"caption",sx:{fontStyle:"italic"},children:["ðŸ’¡ ",T.recommendation]})]})},me)),se.suggestions.length>0&&e.jsxs(n,{sx:{mt:2},children:[e.jsx(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)",display:"block",mb:1},children:"ðŸ’¡ Smart Suggestions:"}),se.suggestions.map((T,me)=>e.jsx(Ke,{sx:{p:2,mb:1,bgcolor:"rgba(79, 70, 229, 0.1)",border:"1px solid rgba(79, 70, 229, 0.3)"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(z,{label:T.type.toUpperCase(),size:"small",sx:{bgcolor:"rgba(79, 70, 229, 0.2)",color:"#8b5cf6",fontWeight:600,fontSize:"0.65rem"}}),e.jsx(o,{variant:"body2",sx:{color:"white"},children:T.message})]})},me))]}),se.hasConflicts&&e.jsx(he,{severity:"error",sx:{mt:2,bgcolor:"rgba(239, 68, 68, 0.1)"},children:e.jsx(o,{variant:"body2",sx:{fontWeight:500},children:"âš ï¸ High-priority conflicts detected. Please review and resolve before proceeding."})})]})})]}):e.jsx(he,{severity:"warning",children:"Collection assignment is only available for Firestore datasets. Please select Firestore as your cloud provider to configure collection assignment."})]});case 5:return e.jsxs(n,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Advanced Options"}),e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(Ie,{control:e.jsx(Fe,{checked:((Re=i.advanced)==null?void 0:Re.encryption)||!1,onChange:T=>U({advanced:{...i.advanced,encryption:T.target.checked}})}),label:"Enable Encryption"})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(Ie,{control:e.jsx(Fe,{checked:((Ze=i.advanced)==null?void 0:Ze.compression)||!1,onChange:T=>U({advanced:{...i.advanced,compression:T.target.checked}})}),label:"Enable Compression"})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(Ie,{control:e.jsx(Fe,{checked:((us=i.advanced)==null?void 0:us.backup)||!1,onChange:T=>U({advanced:{...i.advanced,backup:T.target.checked}})}),label:"Enable Backup"})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(Ie,{control:e.jsx(Fe,{checked:((fe=i.advanced)==null?void 0:fe.versioning)||!1,onChange:T=>U({advanced:{...i.advanced,versioning:T.target.checked}})}),label:"Enable Versioning"})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(Ie,{control:e.jsx(Fe,{checked:((ys=i.advanced)==null?void 0:ys.accessLogging)||!1,onChange:T=>U({advanced:{...i.advanced,accessLogging:T.target.checked}})}),label:"Enable Access Logging"})})]})]});case 6:return e.jsxs(n,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Review & Create"}),e.jsxs(Ke,{sx:{p:3,mb:3},children:[e.jsx(o,{variant:"subtitle1",gutterBottom:!0,children:"Dataset Configuration Summary"}),e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Name: ",e.jsx("strong",{children:i.name})]})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Provider: ",e.jsx("strong",{children:i.cloudProvider})]})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Visibility: ",e.jsx("strong",{children:i.visibility})]})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Schema: ",e.jsx("strong",{children:"Backbone Logic Unified Schema"})]})}),i.cloudProvider==="firestore"&&((js=(rt=i.collectionAssignment)==null?void 0:rt.selectedCollections)==null?void 0:js.length)&&e.jsxs(p,{item:!0,xs:12,children:[e.jsx(o,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.jsx("strong",{children:"Assigned Collections:"})}),e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:i.collectionAssignment.selectedCollections.map(T=>e.jsx(z,{label:T,size:"small",color:"primary",icon:e.jsx($e,{})},T))}),i.collectionAssignment.organizationScope&&e.jsx(o,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"âœ“ Data will be automatically scoped to your organization for security"})]})]})]}),e.jsx(he,{severity:"info",children:"Please review your configuration before creating the dataset. You can go back to any step to make changes."})]});default:return null}},[i,_,oe,U,Pe,b]);return m.useMemo(()=>u?e.jsxs(ns,{open:u,onClose:a,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)",maxHeight:"90vh"}},children:[e.jsxs(is,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"background.paper",borderBottom:"1px solid",borderColor:"divider",pb:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($e,{color:"primary"}),e.jsx(o,{variant:"h6",sx:{fontWeight:600},children:"Create Dataset"})]}),e.jsx(_s,{onClick:a,size:"small",children:e.jsx(st,{})})]}),e.jsxs(ls,{sx:{p:3},children:[D&&e.jsx(he,{severity:"error",sx:{mb:3},children:D}),e.jsx(Pr,{activeStep:l,orientation:"horizontal",sx:{mb:3},children:_t.map((I,Y)=>e.jsx(kr,{children:e.jsx(Mr,{onClick:()=>De(Y),sx:{cursor:"pointer"},children:I})},I))}),ne(l),w&&e.jsx(ca,{sx:{mt:2}})]}),e.jsxs(cs,{sx:{px:3,pb:3,pt:2,backgroundColor:"background.paper",borderTop:"1px solid",borderColor:"divider",justifyContent:"space-between"},children:[e.jsx(F,{onClick:a,variant:"outlined",disabled:w,sx:{borderColor:"primary.main",color:"primary.main"},children:"Cancel"}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(F,{onClick:Ae,disabled:l===0||w,variant:"outlined",children:"Back"}),l===_t.length-1?e.jsx(F,{onClick:B,variant:"contained",disabled:w||!i.name.trim(),startIcon:e.jsx(Ds,{}),sx:{backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:w?"Creating Dataset...":"Create Dataset"}):e.jsx(F,{onClick:Oe,variant:"contained",disabled:w,children:"Next"})]})]})]}):null,[u,a,i,l,w,D,_,oe,Ce,J,Ae,Oe,De,B,ne])}),Ya={"Core System":{icon:"ðŸ‘¥",description:"User management, organizations, and core system data",collections:["users","teamMembers","organizations","roles","projects","projectTeamMembers","clients","contacts","test"]},"Sessions & Workflows":{icon:"ðŸŽ¬",description:"Production sessions, workflows, and task management",collections:["sessions","sessionWorkflows","sessionAssignments","sessionParticipants","workflowTemplates","workflowDiagrams","workflowInstances","workflowSteps","workflowAssignments","sessionPhaseTransitions","sessionReviews","sessionQc","sessionTasks","demoSessions"]},"Inventory & Equipment":{icon:"ðŸ“¦",description:"Equipment tracking, network management, and inventory systems",collections:["inventoryItems","inventory","networkIPAssignments","networkIPRanges","networks","inventoryHistory","setupProfiles","schemas","schemaFields","mapLayouts","mapLocations","inventoryMaps","mapData"]},"Timecards & Scheduling":{icon:"â°",description:"Time tracking, approvals, and scheduling systems",collections:["timecard_entries","user_timecards","timecard_approvals","timecard_templates"]},"Media & Content":{icon:"ðŸŽ¥",description:"Media files, production tasks, and content management",collections:["mediaFiles","postProductionTasks","stages","notes","reports","callSheets"]},"AI & Automation":{icon:"ðŸ¤–",description:"AI agents, messaging, and automated systems",collections:["aiAgents","messages","chats","messageSessions"]},"Business & Licensing":{icon:"ðŸ’¼",description:"Licenses, subscriptions, payments, and business data",collections:["licenses","subscriptions","payments","userPreferences"]},"Production Budget Management":{icon:"ðŸ’°",description:"Budget tracking, schedules, and financial management",collections:["pbmProjects","pbmSchedules","pbmPayscales","pbmDailyStatus"]},"Network Delivery & Deliverables":{icon:"ðŸ“¡",description:"Network delivery bibles, deliverables, and post-production workflows",collections:["networkDeliveryBibles","deliverables","networkDeliveryChats","deliverySpecs","deliveryTemplates","deliveryTracking"]}};Object.values(Ya).flatMap(u=>u.collections);const Qa=({open:u,onClose:a,dataset:t,onDatasetUpdated:r,existingDatasets:c=[]})=>{var te,xe,re,ie,ge,_e;const[l,h]=m.useState({}),[i,j]=m.useState(!1),[w,C]=m.useState(null),[D,E]=m.useState({}),[_,Q]=m.useState(null),[oe,je]=m.useState(!1),{collections:Ce}=Nr();m.useEffect(()=>{t&&u&&(h({name:t.name,description:t.description,visibility:t.visibility,tags:t.tags||[],collectionAssignment:t.collectionAssignment||{selectedCollections:[],includeSubcollections:!1,dataFilters:[],organizationScope:!0}}),C(null),E({}),Q(null))},[t,u]);const R=m.useCallback(O=>{h(W=>({...W,...O}))},[]),J=m.useCallback(async()=>{var O,W;if(!t||!((W=(O=l.collectionAssignment)==null?void 0:O.selectedCollections)!=null&&W.length)){Q(null);return}je(!0);try{const q=c.filter(U=>U.id!==t.id),K=await er.checkDatasetCreationConflicts({name:l.name||t.name,collectionAssignment:l.collectionAssignment},q);Q(K),console.log("âœ… [EditDatasetDialog] Conflict check complete:",K)}catch(q){console.error("âŒ [EditDatasetDialog] Failed to check conflicts:",q),Q(null)}finally{je(!1)}},[t,l.name,l.collectionAssignment,c]);m.useEffect(()=>{var O,W;if(u&&((W=(O=l.collectionAssignment)==null?void 0:O.selectedCollections)!=null&&W.length)){const q=setTimeout(()=>{J()},500);return()=>clearTimeout(q)}},[u,(te=l.collectionAssignment)==null?void 0:te.selectedCollections,J]);const ve=m.useCallback(()=>{var W,q,K,U;const O={};return(W=l.name)!=null&&W.trim()||(O.name="Dataset name is required"),((q=t==null?void 0:t.storage)==null?void 0:q.backend)==="firestore"&&!((U=(K=l.collectionAssignment)==null?void 0:K.selectedCollections)!=null&&U.length)&&(O.collections="At least one collection must be selected for Firestore datasets"),E(O),Object.keys(O).length===0},[l,t]),se=m.useCallback(async()=>{if(!(!t||!ve())){if(_!=null&&_.hasConflicts){C("Please resolve high-priority conflicts before saving");return}j(!0),C(null);try{console.log("ðŸ’¾ [EditDatasetDialog] Saving dataset updates:",l);const O=await le.updateDataset(t.id,{name:l.name,description:l.description,visibility:l.visibility,tags:l.tags,collectionAssignment:l.collectionAssignment});O?(console.log("âœ… [EditDatasetDialog] Dataset updated successfully"),r==null||r(O),a()):C("Failed to update dataset: No response from server")}catch(O){console.error("âŒ [EditDatasetDialog] Failed to update dataset:",O),C(`Failed to update dataset: ${O instanceof Error?O.message:"Unknown error"}`)}finally{j(!1)}}},[t,l,ve,_,r,a]),pe=m.useCallback(O=>{var W,q,K;R({collectionAssignment:{...l.collectionAssignment,selectedCollections:O,includeSubcollections:((W=l.collectionAssignment)==null?void 0:W.includeSubcollections)||!1,dataFilters:((q=l.collectionAssignment)==null?void 0:q.dataFilters)||[],organizationScope:((K=l.collectionAssignment)==null?void 0:K.organizationScope)!==!1}})},[l.collectionAssignment,R]);return t?e.jsxs(ns,{open:u,onClose:a,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",maxHeight:"90vh"}},children:[e.jsxs(is,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",pb:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(jt,{sx:{color:"#8b5cf6"}}),e.jsxs(n,{children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600},children:"Edit Dataset"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Update dataset information and collection assignments"})]})]}),e.jsxs(ls,{sx:{p:3,overflow:"auto"},children:[w&&e.jsx(he,{severity:"error",sx:{mb:3,bgcolor:"rgba(239, 68, 68, 0.1)"},children:w}),e.jsxs(p,{container:!0,spacing:3,children:[e.jsx(p,{item:!0,xs:12,children:e.jsxs(o,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(zs,{color:"primary"}),"Basic Information"]})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(ce,{fullWidth:!0,label:"Dataset Name",value:l.name||"",onChange:O=>R({name:O.target.value}),error:!!D.name,helperText:D.name,sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#8b5cf6"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)"}}})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsxs(He,{fullWidth:!0,children:[e.jsx(Ye,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Visibility"}),e.jsxs(Qe,{value:l.visibility||"private",onChange:O=>R({visibility:O.target.value}),sx:{color:"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#8b5cf6"}},children:[e.jsx(k,{value:"private",children:"Private"}),e.jsx(k,{value:"organization",children:"Organization"}),e.jsx(k,{value:"public",children:"Public"})]})]})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(ce,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:l.description||"",onChange:O=>R({description:O.target.value}),sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#8b5cf6"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)"}}})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(da,{multiple:!0,freeSolo:!0,options:[],value:l.tags||[],onChange:(O,W)=>R({tags:W}),renderTags:(O,W)=>O.map((q,K)=>e.jsx(z,{variant:"outlined",label:q,...W({index:K}),sx:{color:"white",borderColor:"rgba(255, 255, 255, 0.3)"}})),renderInput:O=>e.jsx(ce,{...O,label:"Tags",placeholder:"Add tags...",sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#8b5cf6"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)"}}})})}),((xe=t.storage)==null?void 0:xe.backend)==="firestore"&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{item:!0,xs:12,children:[e.jsx(Lt,{sx:{my:2,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsxs(o,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{color:"primary"}),"Collection Assignment"]})]}),e.jsx(p,{item:!0,xs:12,children:e.jsxs(n,{sx:{mb:2},children:[e.jsx(o,{variant:"subtitle2",sx:{color:"white",mb:2},children:"Select Collections by Category"}),D.collections&&e.jsx(he,{severity:"error",sx:{mb:2,bgcolor:"rgba(239, 68, 68, 0.1)"},children:D.collections}),Object.entries(Ce).map(([O,W])=>{var Ae,De;const q=W.collections,K=((De=(Ae=l.collectionAssignment)==null?void 0:Ae.selectedCollections)==null?void 0:De.filter(Pe=>q.includes(Pe)))||[],U=K.length===q.length,Se=K.length>0&&K.length<q.length,Oe=()=>{var B;const b=(((B=l.collectionAssignment)==null?void 0:B.selectedCollections)||[]).filter($=>!q.includes($));pe(U?b:[...b,...q])};return e.jsxs(n,{sx:{mb:3},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,mb:1,p:1,bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:1,border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(o,{sx:{fontSize:"1.2rem"},children:W.icon}),e.jsxs(n,{children:[e.jsx(o,{variant:"subtitle2",sx:{color:"white",fontWeight:600},children:O}),e.jsx(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:W.description})]})]}),e.jsx(F,{size:"small",variant:"outlined",onClick:Oe,sx:{borderColor:U?"rgba(255, 255, 255, 0.3)":"#8b5cf6",color:U?"rgba(255, 255, 255, 0.8)":"#8b5cf6",bgcolor:U?"rgba(255, 255, 255, 0.05)":"rgba(139, 92, 246, 0.1)","&:hover":{borderColor:U?"rgba(255, 255, 255, 0.5)":"#7c3aed",bgcolor:U?"rgba(255, 255, 255, 0.1)":"rgba(139, 92, 246, 0.2)"},fontSize:"0.75rem",px:1.5,py:.5,minWidth:"auto"},children:U?"Remove All":Se?"Add Remaining":"Add All"})]}),e.jsx(n,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:1,pl:2},children:W.collections.map(Pe=>{var B,$;const b=(($=(B=l.collectionAssignment)==null?void 0:B.selectedCollections)==null?void 0:$.includes(Pe))||!1;return e.jsx(n,{onClick:()=>{var Z;const H=((Z=l.collectionAssignment)==null?void 0:Z.selectedCollections)||[],ne=b?H.filter(V=>V!==Pe):[...H,Pe];pe(ne)},sx:{p:1.5,border:b?"2px solid #8b5cf6":"1px solid rgba(255, 255, 255, 0.2)",borderRadius:1,bgcolor:b?"rgba(139, 92, 246, 0.1)":"rgba(255, 255, 255, 0.02)",cursor:"pointer",transition:"all 0.2s ease","&:hover":{bgcolor:b?"rgba(139, 92, 246, 0.2)":"rgba(255, 255, 255, 0.05)",borderColor:b?"#8b5cf6":"rgba(255, 255, 255, 0.4)",transform:"translateY(-1px)"}},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{fontSize:"small",sx:{color:b?"#8b5cf6":"rgba(255, 255, 255, 0.7)"}}),e.jsx(o,{variant:"body2",sx:{color:b?"#8b5cf6":"white",fontWeight:b?600:400,fontSize:"0.85rem"},children:Pe}),b&&e.jsx(Zt,{fontSize:"small",sx:{color:"#8b5cf6",ml:"auto"}})]})},Pe)})})]},O)})]})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(Ie,{control:e.jsx(Fe,{checked:((re=l.collectionAssignment)==null?void 0:re.organizationScope)!==!1,onChange:O=>{var W,q,K;return R({collectionAssignment:{...l.collectionAssignment,organizationScope:O.target.checked,selectedCollections:((W=l.collectionAssignment)==null?void 0:W.selectedCollections)||[],includeSubcollections:((q=l.collectionAssignment)==null?void 0:q.includeSubcollections)||!1,dataFilters:((K=l.collectionAssignment)==null?void 0:K.dataFilters)||[]}})},sx:{color:"#8b5cf6"}}),label:e.jsxs(n,{children:[e.jsx(o,{variant:"body2",sx:{color:"white"},children:"Organization Scoped Data"}),e.jsx(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Automatically filter data to current organization for multi-tenant isolation"})]})})}),((ge=(ie=l.collectionAssignment)==null?void 0:ie.selectedCollections)==null?void 0:ge.length)>0&&e.jsxs(p,{item:!0,xs:12,children:[e.jsxs(o,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"white"},children:["Selected Collections Preview",e.jsx(z,{label:`${l.collectionAssignment.selectedCollections.length} selected`,size:"small",color:"primary",variant:"outlined"})]}),e.jsx(Ke,{sx:{p:2,bgcolor:"rgba(139, 92, 246, 0.08)",border:"1px solid rgba(139, 92, 246, 0.2)",borderRadius:2},children:e.jsxs(n,{sx:{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center"},children:[l.collectionAssignment.selectedCollections.map(O=>e.jsx(z,{icon:e.jsx($e,{fontSize:"small"}),label:O,variant:"filled",color:"secondary",size:"small",sx:{bgcolor:"rgba(139, 92, 246, 0.12)",color:"secondary.main",border:"1px solid rgba(139, 92, 246, 0.3)","& .MuiChip-icon":{color:"secondary.main"},"&:hover":{bgcolor:"rgba(139, 92, 246, 0.16)"}}},O)),((_e=l.collectionAssignment)==null?void 0:_e.organizationScope)&&e.jsx(z,{label:"Organization Scoped",size:"small",color:"success",variant:"outlined",sx:{ml:1,fontWeight:600,bgcolor:"rgba(46, 125, 50, 0.04)"}})]})})]}),oe&&e.jsx(p,{item:!0,xs:12,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:1},children:[e.jsx(ds,{size:20}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Analyzing collection conflicts..."})]})}),_&&(_.warnings.length>0||_.suggestions.length>0)&&e.jsx(p,{item:!0,xs:12,children:e.jsx(ue,{sx:{bgcolor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(ye,{children:[e.jsxs(o,{variant:"subtitle2",gutterBottom:!0,sx:{color:"white",display:"flex",alignItems:"center",gap:1},children:[e.jsx(yt,{fontSize:"small",color:"warning"}),"Smart Analysis Results"]}),_.warnings.map((O,W)=>e.jsxs(he,{severity:O.severity,sx:{mb:1,bgcolor:"rgba(255, 255, 255, 0.05)"},children:[e.jsx(o,{variant:"body2",sx:{fontWeight:500},children:O.message}),e.jsxs(o,{variant:"caption",sx:{fontStyle:"italic",display:"block",mt:.5},children:["ðŸ’¡ ",O.recommendation]})]},W)),_.suggestions.map((O,W)=>e.jsx(he,{severity:"info",sx:{mb:1,bgcolor:"rgba(79, 70, 229, 0.1)"},children:e.jsxs(o,{variant:"body2",children:[e.jsxs("strong",{children:[O.type.toUpperCase(),":"]})," ",O.message]})},W))]})})})]})]})]}),e.jsxs(cs,{sx:{p:3,borderTop:"1px solid rgba(255, 255, 255, 0.1)",justifyContent:"space-between"},children:[e.jsx(F,{onClick:a,variant:"outlined",startIcon:e.jsx(ua,{}),sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Cancel"}),e.jsx(F,{onClick:se,variant:"contained",startIcon:i?e.jsx(ds,{size:16}):e.jsx(ga,{}),disabled:i||(_==null?void 0:_.hasConflicts),sx:{bgcolor:"#8b5cf6","&:hover":{bgcolor:"#7c3aed"},"&:disabled":{bgcolor:"rgba(139, 92, 246, 0.3)",color:"rgba(255, 255, 255, 0.5)"}},children:i?"Saving...":"Save Changes"})]})]}):null};var Te=(u=>(u.ADMIN="ADMIN",u.GUEST="GUEST",u.MANAGER="MANAGER",u.EXEC="EXEC",u.POST_COORDINATOR="POST_COORDINATOR",u.POST_PRODUCTION_SUPERVISOR="POST_PRODUCTION_SUPERVISOR",u.MEDIA_MANAGER="MEDIA_MANAGER",u.PRODUCER="PRODUCER",u.ASSOCIATE_PRODUCER="ASSOCIATE_PRODUCER",u.POST_PRODUCER="POST_PRODUCER",u.LINE_PRODUCER="LINE_PRODUCER",u.KEYNOTE_PRODUCER="KEYNOTE_PRODUCER",u.KEYNOTE_PROD="KEYNOTE_PROD",u.PRODUCTION_ASSISTANT="PRODUCTION_ASSISTANT",u.POST_PA="POST_PA",u.DIRECTOR="DIRECTOR",u.ART_DIRECTOR="ART_DIRECTOR",u.ASSIST_DIRECTOR="ASSIST_DIRECTOR",u.EDITOR="EDITOR",u.ASSISTANT_EDITOR="ASSISTANT_EDITOR",u.CAMERA_OPERATOR="CAMERA_OPERATOR",u.SOUND_ENGINEER="SOUND_ENGINEER",u.LIGHTING_TECHNICIAN="LIGHTING_TECHNICIAN",u.DIT="DIT",u.TECH="TECH",u.NETWORKING="NETWORKING",u.COLORIST="COLORIST",u.AUDIO_PRODUCTION="AUDIO_PRODUCTION",u.AUDIO_POST="AUDIO_POST",u.GFX_ARTIST="GFX_ARTIST",u.KEYNOTE_POST="KEYNOTE_POST",u.QC_SPECIALIST="QC_SPECIALIST",u))(Te||{});const Ja={FILM_TV:[{id:"executive-producer",name:"EXECUTIVE_PRODUCER",displayName:"Executive Producer",description:"Oversees entire production from development to distribution, manages financing and high-level creative decisions",industry:"FILM_TV",eventTypes:["FEATURE_FILM","TV_SERIES","DOCUMENTARY"],category:"Executive Leadership",hierarchy:95,baseRole:Te.EXEC,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0,manage_post_tasks:!0,access_media_library:!0},postProduction:{manage_tasks:!0,assign_post_roles:!0,approve_final_cuts:!0,manage_review_cycles:!0,access_color_tools:!0,manage_audio_tools:!0,export_final_media:!0},userManagement:{create_users:!0,edit_users:!0,delete_users:!0,manage_roles:!0,assign_permissions:!0,view_user_activity:!0},system:{access_settings:!0,manage_integrations:!0,view_system_logs:!0,manage_ai_agents:!0},reports:{create_reports:!0,edit_reports:!0,delete_reports:!0,access_analytics:!0,export_reports:!0,manage_templates:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Secure financing and manage budgets","Oversee creative vision and final approval","Manage distribution and marketing strategy","Coordinate with studios and investors","Ensure legal compliance and contracts"],requiredSkills:["Leadership","Finance","Negotiation","Strategic Planning","Industry Knowledge"],reportingStructure:{manages:["Producer","Line Producer","Director"]},tags:["executive","finance","leadership","strategy","high-level"],isPopular:!0,usageCount:450,icon:"ðŸ‘‘",color:"#1a237e",salaryRange:{min:15e4,max:5e5,currency:"USD"},experienceLevel:"Executive"},{id:"showrunner",name:"SHOWRUNNER",displayName:"Showrunner",description:"Head writer and executive producer for TV series, manages creative direction and day-to-day operations",industry:"FILM_TV",eventTypes:["TV_SERIES"],category:"Creative Leadership",hierarchy:90,baseRole:Te.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0,manage_post_tasks:!0,access_media_library:!0},postProduction:{manage_tasks:!0,assign_post_roles:!0,approve_final_cuts:!0,manage_review_cycles:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Oversee writing room and story development","Manage creative vision for entire series","Coordinate with network executives","Supervise all aspects of production","Ensure continuity across episodes"],requiredSkills:["Writing","Leadership","Creative Vision","Team Management","Industry Knowledge"],reportingStructure:{reportsTo:"Executive Producer",manages:["Writer","Director","Producer"]},tags:["creative","writing","tv","leadership","storytelling"],isPopular:!0,usageCount:280,icon:"ðŸ“",color:"#3f51b5",salaryRange:{min:2e5,max:1e6,currency:"USD"},experienceLevel:"Executive"},{id:"cinematographer-dp",name:"CINEMATOGRAPHER_DP",displayName:"Cinematographer (Director of Photography)",description:"Responsible for visual storytelling, camera work, lighting design, and overall visual aesthetic",industry:"FILM_TV",eventTypes:["FEATURE_FILM","TV_SERIES","COMMERCIAL","MUSIC_VIDEO"],category:"Creative Technical",hierarchy:75,baseRole:Te.CAMERA_OPERATOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,access_media_library:!0},postProduction:{access_color_tools:!0,manage_review_cycles:!0},inventory:{create_assets:!0,edit_assets:!0,manage_checkouts:!0,view_asset_reports:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Design visual style and cinematography","Manage camera department and equipment","Collaborate with director on visual storytelling","Oversee lighting design and execution","Ensure technical quality of footage"],requiredSkills:["Cinematography","Lighting","Camera Operation","Visual Storytelling","Technical Expertise"],reportingStructure:{reportsTo:"Director",manages:["Camera Operator","Gaffer","1st AC","2nd AC"]},tags:["cinematography","visual","camera","lighting","technical"],isPopular:!0,usageCount:890,icon:"ðŸ“¹",color:"#795548",salaryRange:{min:8e4,max:3e5,currency:"USD"},experienceLevel:"Senior"}],CORPORATE_EVENTS:[{id:"event-director",name:"EVENT_DIRECTOR",displayName:"Event Director",description:"Oversees all aspects of corporate event planning, execution, and management",industry:"CORPORATE_EVENTS",eventTypes:["CONFERENCE","TRADE_SHOW","PRODUCT_LAUNCH","CORPORATE_VIDEO"],category:"Event Leadership",hierarchy:85,baseRole:Te.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Develop event strategy and objectives","Manage event budget and resources","Coordinate with vendors and stakeholders","Oversee event logistics and execution","Ensure ROI and success metrics"],requiredSkills:["Event Planning","Project Management","Budget Management","Vendor Relations","Strategic Planning"],reportingStructure:{manages:["Event Coordinator","AV Technician","Registration Manager"]},tags:["events","corporate","planning","management","strategy"],isPopular:!0,usageCount:650,icon:"ðŸŽ¯",color:"#1976d2",salaryRange:{min:7e4,max:15e4,currency:"USD"},experienceLevel:"Senior"},{id:"av-production-manager",name:"AV_PRODUCTION_MANAGER",displayName:"AV Production Manager",description:"Manages all audio-visual aspects of corporate events including streaming, recording, and live production",industry:"CORPORATE_EVENTS",eventTypes:["CONFERENCE","WEBINAR","VIRTUAL_EVENT","PRODUCT_LAUNCH"],category:"Technical Production",hierarchy:70,baseRole:Te.TECH,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,access_media_library:!0},postProduction:{manage_tasks:!0,access_color_tools:!0,manage_audio_tools:!0,export_final_media:!0},inventory:{create_assets:!0,edit_assets:!0,manage_checkouts:!0,manage_ip_addresses:!0},system:{access_settings:!0,manage_integrations:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Design and implement AV systems","Manage live streaming and recording","Coordinate technical rehearsals","Troubleshoot technical issues","Ensure broadcast quality standards"],requiredSkills:["AV Technology","Live Streaming","Technical Troubleshooting","Equipment Management","Broadcast Standards"],reportingStructure:{reportsTo:"Event Director",manages:["AV Technician","Camera Operator","Audio Engineer"]},tags:["av","technical","streaming","production","broadcast"],isPopular:!0,usageCount:520,icon:"ðŸŽ›ï¸",color:"#546e7a",salaryRange:{min:55e3,max:12e4,currency:"USD"},experienceLevel:"Mid"}],LIVE_EVENTS:[{id:"concert-director",name:"CONCERT_DIRECTOR",displayName:"Concert Director",description:"Oversees creative and technical direction for live concert productions and music events",industry:"LIVE_EVENTS",eventTypes:["CONCERT","FESTIVAL","AWARDS_SHOW"],category:"Live Production",hierarchy:88,baseRole:Te.DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},automation:{view_all_sessions:!0,view_all_alerts:!0,manage_automation:!0,configure_settings:!0},system:{access_settings:!0,manage_integrations:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Direct live concert performances","Coordinate with artists and management","Oversee stage design and production","Manage live broadcast elements","Ensure audience experience quality"],requiredSkills:["Live Direction","Music Industry Knowledge","Stage Production","Artist Relations","Broadcast Direction"],reportingStructure:{manages:["Stage Manager","Technical Director","Lighting Designer"]},tags:["concert","live","music","performance","broadcast"],isPopular:!0,usageCount:380,icon:"ðŸŽ¤",color:"#d32f2f",salaryRange:{min:8e4,max:25e4,currency:"USD"},experienceLevel:"Senior"},{id:"festival-producer",name:"FESTIVAL_PRODUCER",displayName:"Festival Producer",description:"Manages multi-day festival productions including logistics, talent coordination, and audience experience",industry:"LIVE_EVENTS",eventTypes:["FESTIVAL","CONCERT"],category:"Festival Management",hierarchy:82,baseRole:Te.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Coordinate multiple stages and venues","Manage artist logistics and hospitality","Oversee festival operations and security","Coordinate with local authorities","Ensure festival brand and experience"],requiredSkills:["Festival Management","Logistics Coordination","Vendor Management","Crisis Management","Entertainment Industry"],reportingStructure:{manages:["Stage Producer","Operations Manager","Artist Liaison"]},tags:["festival","multi-day","logistics","entertainment","coordination"],isPopular:!1,usageCount:180,icon:"ðŸŽª",color:"#e91e63",salaryRange:{min:6e4,max:18e4,currency:"USD"},experienceLevel:"Senior"}],SPORTS_BROADCAST:[{id:"sports-director",name:"SPORTS_DIRECTOR",displayName:"Sports Broadcast Director",description:"Directs live sports broadcasts, manages camera coverage, and coordinates real-time production decisions",industry:"SPORTS_BROADCAST",eventTypes:["SPORTS_BROADCAST","SPORTS_EVENT","OLYMPICS"],category:"Sports Production",hierarchy:85,baseRole:Te.DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},automation:{view_all_sessions:!0,view_all_alerts:!0,manage_automation:!0,configure_settings:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Direct live sports coverage","Coordinate multiple camera angles","Manage instant replay systems","Work with commentary teams","Ensure broadcast quality and timing"],requiredSkills:["Sports Broadcasting","Live Direction","Multi-Camera Production","Sports Knowledge","Real-time Decision Making"],reportingStructure:{manages:["Camera Operator","Replay Operator","Graphics Operator"]},tags:["sports","live","broadcast","real-time","multi-camera"],isPopular:!0,usageCount:320,icon:"ðŸ†",color:"#ff5722",salaryRange:{min:7e4,max:2e5,currency:"USD"},experienceLevel:"Senior"},{id:"sports-producer",name:"SPORTS_PRODUCER",displayName:"Sports Producer",description:"Produces sports content including pre-game, live coverage, and post-game analysis",industry:"SPORTS_BROADCAST",eventTypes:["SPORTS_BROADCAST","SPORTS_EVENT"],category:"Sports Production",hierarchy:75,baseRole:Te.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},postProduction:{manage_tasks:!0,approve_final_cuts:!0,export_final_media:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Plan sports broadcast content","Coordinate with sports organizations","Manage highlight packages","Oversee graphics and statistics","Coordinate talent and commentary"],requiredSkills:["Sports Production","Content Planning","Sports Industry Knowledge","Broadcast Standards","Team Coordination"],reportingStructure:{reportsTo:"Sports Director",manages:["Associate Producer","Graphics Coordinator","Statistics Coordinator"]},tags:["sports","production","content","highlights","coordination"],isPopular:!0,usageCount:420,icon:"âš½",color:"#4caf50",salaryRange:{min:5e4,max:15e4,currency:"USD"},experienceLevel:"Mid"}],GAMING_ESPORTS:[{id:"esports-director",name:"ESPORTS_DIRECTOR",displayName:"Esports Tournament Director",description:"Oversees esports tournament production, player coordination, and broadcast management",industry:"GAMING_ESPORTS",eventTypes:["ESPORTS_TOURNAMENT","GAMING_STREAM","GAME_LAUNCH"],category:"Esports Production",hierarchy:80,baseRole:Te.DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},automation:{view_all_sessions:!0,manage_automation:!0,configure_settings:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Direct esports tournament broadcasts","Coordinate with game developers","Manage player and team logistics","Oversee tournament format and rules","Ensure competitive integrity"],requiredSkills:["Esports Knowledge","Tournament Management","Gaming Industry","Broadcast Production","Player Relations"],reportingStructure:{manages:["Tournament Producer","Broadcast Producer","Player Coordinator"]},tags:["esports","gaming","tournament","competitive","broadcast"],isPopular:!0,usageCount:250,icon:"ðŸŽ®",color:"#673ab7",salaryRange:{min:6e4,max:18e4,currency:"USD"},experienceLevel:"Senior"},{id:"stream-producer",name:"STREAM_PRODUCER",displayName:"Gaming Stream Producer",description:"Produces gaming content for streaming platforms, manages creator partnerships, and audience engagement",industry:"GAMING_ESPORTS",eventTypes:["GAMING_STREAM","LIVE_STREAM"],category:"Content Production",hierarchy:65,baseRole:Te.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0},automation:{view_all_sessions:!0,manage_automation:!0},reports:{create_reports:!0,access_analytics:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Produce gaming content for streams","Manage creator relationships","Coordinate sponsored content","Analyze audience engagement","Develop content strategies"],requiredSkills:["Content Production","Gaming Knowledge","Streaming Platforms","Creator Relations","Audience Analytics"],reportingStructure:{reportsTo:"Esports Director",manages:["Content Creator","Community Manager"]},tags:["streaming","content","gaming","creators","engagement"],isPopular:!1,usageCount:180,icon:"ðŸ“¹",color:"#9c27b0",salaryRange:{min:4e4,max:1e5,currency:"USD"},experienceLevel:"Mid"}],HEALTHCARE:[{id:"healthcare-project-manager",name:"HEALTHCARE_PROJECT_MANAGER",displayName:"Healthcare Project Manager",description:"Manages healthcare-related projects ensuring compliance with medical regulations and patient care standards",industry:"HEALTHCARE",eventTypes:["TRAINING_VIDEO","WEBINAR","CONFERENCE"],category:"Healthcare Management",hierarchy:75,baseRole:Te.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure HIPAA compliance in all projects","Manage medical content accuracy","Coordinate with healthcare professionals","Oversee patient safety protocols","Manage regulatory approvals"],requiredSkills:["Healthcare Regulations","HIPAA Compliance","Medical Knowledge","Project Management","Risk Management"],reportingStructure:{manages:["Clinical Coordinator","Compliance Officer"]},tags:["healthcare","compliance","medical","regulations","safety"],isPopular:!1,usageCount:120,icon:"ðŸ¥",color:"#4caf50",salaryRange:{min:7e4,max:16e4,currency:"USD"},experienceLevel:"Senior"}],IT_TECHNOLOGY:[{id:"it-project-manager",name:"IT_PROJECT_MANAGER",displayName:"IT Project Manager",description:"Manages technology projects including software development, system implementations, and digital transformations",industry:"IT_TECHNOLOGY",eventTypes:["TRAINING_VIDEO","WEBINAR","PRODUCT_LAUNCH"],category:"Technology Management",hierarchy:75,baseRole:Te.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},system:{access_settings:!0,manage_integrations:!0,view_system_logs:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Manage software development lifecycles","Coordinate technical teams and resources","Ensure system security and compliance","Oversee technology implementations","Manage stakeholder communications"],requiredSkills:["Project Management","Software Development","System Architecture","Agile Methodologies","Technical Leadership"],reportingStructure:{manages:["Software Developer","System Administrator","QA Engineer"]},tags:["technology","software","development","systems","digital"],isPopular:!0,usageCount:680,icon:"ðŸ’»",color:"#2196f3",salaryRange:{min:8e4,max:18e4,currency:"USD"},experienceLevel:"Senior"}],MARKETING_ADVERTISING:[{id:"creative-director",name:"CREATIVE_DIRECTOR",displayName:"Creative Director",description:"Leads creative vision for marketing campaigns, oversees creative teams, and ensures brand consistency",industry:"MARKETING_ADVERTISING",eventTypes:["COMMERCIAL","CORPORATE_VIDEO","PRODUCT_LAUNCH"],category:"Creative Leadership",hierarchy:85,baseRole:Te.ART_DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},postProduction:{manage_tasks:!0,approve_final_cuts:!0,access_color_tools:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Develop creative concepts and campaigns","Lead creative team and vision","Ensure brand consistency across projects","Present concepts to clients","Oversee creative production process"],requiredSkills:["Creative Leadership","Brand Strategy","Design Thinking","Team Management","Client Relations"],reportingStructure:{manages:["Art Director","Copywriter","Designer"]},tags:["creative","marketing","branding","campaigns","leadership"],isPopular:!0,usageCount:540,icon:"ðŸŽ¨",color:"#ff9800",salaryRange:{min:9e4,max:25e4,currency:"USD"},experienceLevel:"Senior"}],EDUCATION_TRAINING:[{id:"instructional-designer",name:"INSTRUCTIONAL_DESIGNER",displayName:"Instructional Designer",description:"Designs educational content and learning experiences for training videos and e-learning platforms",industry:"EDUCATION_TRAINING",eventTypes:["TRAINING_VIDEO","WEBINAR","VIRTUAL_EVENT"],category:"Educational Design",hierarchy:65,baseRole:Te.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0},postProduction:{manage_tasks:!0,manage_review_cycles:!0},reports:{create_reports:!0,access_analytics:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Design learning objectives and outcomes","Create educational content structure","Develop assessment strategies","Ensure pedagogical best practices","Analyze learning effectiveness"],requiredSkills:["Instructional Design","Educational Theory","Content Development","Learning Analytics","Curriculum Design"],reportingStructure:{manages:["Content Developer","Educational Technologist"]},tags:["education","learning","instructional","content","pedagogy"],isPopular:!1,usageCount:220,icon:"ðŸ“š",color:"#4caf50",salaryRange:{min:55e3,max:12e4,currency:"USD"},experienceLevel:"Mid"}],CONSTRUCTION_ENGINEERING:[{id:"construction-project-manager",name:"CONSTRUCTION_PROJECT_MANAGER",displayName:"Construction Project Manager",description:"Manages construction and engineering projects including documentation, safety compliance, and progress tracking",industry:"CONSTRUCTION_ENGINEERING",eventTypes:["TRAINING_VIDEO","CORPORATE_VIDEO","DOCUMENTARY"],category:"Construction Management",hierarchy:80,baseRole:Te.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure safety compliance and protocols","Manage construction documentation","Coordinate with engineering teams","Oversee project timelines and budgets","Ensure regulatory compliance"],requiredSkills:["Construction Management","Safety Regulations","Engineering Knowledge","Project Planning","Risk Management"],reportingStructure:{manages:["Site Supervisor","Safety Coordinator","Documentation Specialist"]},tags:["construction","engineering","safety","compliance","documentation"],isPopular:!1,usageCount:95,icon:"ðŸ—ï¸",color:"#795548",salaryRange:{min:75e3,max:17e4,currency:"USD"},experienceLevel:"Senior"}],FINANCE_BANKING:[{id:"financial-project-manager",name:"FINANCIAL_PROJECT_MANAGER",displayName:"Financial Project Manager",description:"Manages financial services projects ensuring regulatory compliance and risk management",industry:"FINANCE_BANKING",eventTypes:["TRAINING_VIDEO","WEBINAR","CORPORATE_VIDEO"],category:"Financial Management",hierarchy:80,baseRole:Te.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure financial regulatory compliance","Manage risk assessment and mitigation","Oversee financial data security","Coordinate with compliance teams","Manage stakeholder communications"],requiredSkills:["Financial Regulations","Risk Management","Compliance","Financial Analysis","Project Management"],reportingStructure:{manages:["Compliance Analyst","Risk Analyst","Financial Analyst"]},tags:["finance","banking","compliance","risk","regulations"],isPopular:!1,usageCount:85,icon:"ðŸ¦",color:"#4caf50",salaryRange:{min:85e3,max:2e5,currency:"USD"},experienceLevel:"Senior"}],GOVERNMENT_PUBLIC:[{id:"public-affairs-manager",name:"PUBLIC_AFFAIRS_MANAGER",displayName:"Public Affairs Manager",description:"Manages government and public sector communication projects ensuring transparency and public engagement",industry:"GOVERNMENT_PUBLIC",eventTypes:["CORPORATE_VIDEO","WEBINAR","CONFERENCE"],category:"Public Communications",hierarchy:75,baseRole:Te.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure public transparency requirements","Manage government communications","Coordinate with public stakeholders","Ensure accessibility compliance","Manage public information requests"],requiredSkills:["Public Administration","Government Regulations","Public Communications","Transparency Laws","Stakeholder Management"],reportingStructure:{manages:["Communications Specialist","Public Information Officer"]},tags:["government","public","transparency","communications","civic"],isPopular:!1,usageCount:65,icon:"ðŸ›ï¸",color:"#3f51b5",salaryRange:{min:6e4,max:14e4,currency:"USD"},experienceLevel:"Senior"}]},tt=()=>Object.values(Ja).flat(),Xa=()=>tt().filter(u=>u.isPopular),Za=u=>{const a=u.toLowerCase();return tt().filter(t=>t.displayName.toLowerCase().includes(a)||t.description.toLowerCase().includes(a)||t.tags.some(r=>r.toLowerCase().includes(a))||t.keyResponsibilities.some(r=>r.toLowerCase().includes(a)))},eo=({open:u,onClose:a,projectId:t,projectName:r,organizationId:c})=>{const[l,h]=m.useState("overview"),[i,j]=m.useState(!1),[w,C]=m.useState(null),[D,E]=m.useState(null),[_,Q]=m.useState([]),[oe,je]=m.useState([]),[Ce,R]=m.useState([]),[J,ve]=m.useState(""),[se,pe]=m.useState("all"),[te,xe]=m.useState(!1),[re,ie]=m.useState({name:"",displayName:"",description:"",category:"PRODUCTION",hierarchy:50,permissions:{}});m.useEffect(()=>{u&&(ge(),_e(),O())},[u,t]);const ge=async()=>{var b,B;try{j(!0),console.log("ðŸ” [RoleManagement] Loading project roles for project:",t);const $=(b=window.firebase)==null?void 0:b.auth(),H=$==null?void 0:$.currentUser;if(!H){console.log("âš ï¸ [RoleManagement] No authenticated user"),C("Please log in to manage roles");return}const ne=await H.getIdToken();console.log("âœ… [RoleManagement] Got auth token for roles");const Z=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/roles`,{headers:{Authorization:`Bearer ${ne}`,"Content-Type":"application/json"}});if(Z.ok){const V=await Z.json();console.log("âœ… [RoleManagement] Loaded project roles:",((B=V.roles)==null?void 0:B.length)||0),Q(V.roles||[])}else{const V=await Z.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to load roles:",Z.status,V),C(`Failed to load project roles: ${V.error||"API Error"}`),Q([])}}catch($){console.log("âŒ [RoleManagement] Error loading roles:",$),C("Failed to load project roles"),Q([])}finally{j(!1)}},_e=async()=>{var b,B;try{j(!0),console.log("ðŸ” [RoleManagement] Loading team members for project:",t);const $=(b=window.firebase)==null?void 0:b.auth(),H=$==null?void 0:$.currentUser;if(!H){console.log("âš ï¸ [RoleManagement] No authenticated user"),C("Please log in to manage roles");return}const ne=await H.getIdToken();console.log("âœ… [RoleManagement] Got auth token for user:",H.email);const Z=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/team-members`,{headers:{Authorization:`Bearer ${ne}`,"Content-Type":"application/json"}});if(Z.ok){const V=await Z.json();console.log("âœ… [RoleManagement] Loaded team members:",((B=V.teamMembers)==null?void 0:B.length)||0),je(V.teamMembers||[])}else{const V=await Z.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to load team members:",Z.status,V),C(`Failed to load team members: ${V.error||"API Error"}`),je([])}}catch($){console.log("âš ï¸ [RoleManagement] Error loading team members:",$),C("Failed to load team members"),je([])}finally{j(!1)}},O=async()=>{var b,B;try{console.log("ðŸ” [RoleManagement] Loading user created roles");const $=(b=window.firebase)==null?void 0:b.auth(),H=$==null?void 0:$.currentUser;if(!H){console.log("âš ï¸ [RoleManagement] No authenticated user for user roles"),R([]);return}const ne=await H.getIdToken(),Z=await fetch("https://us-central1-backbone-logic.cloudfunctions.net/api/user/custom-roles",{headers:{Authorization:`Bearer ${ne}`,"Content-Type":"application/json"}});if(Z.ok){const V=await Z.json();console.log("âœ… [RoleManagement] Loaded user created roles:",((B=V.roles)==null?void 0:B.length)||0),R(V.roles||[])}else{const V=await Z.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to load user roles:",Z.status,V),R([])}}catch($){console.log("âŒ [RoleManagement] Error loading user roles:",$),R([])}},W=async()=>{var b;try{j(!0),console.log("ðŸ” [RoleManagement] Creating custom role:",re);const B=(b=window.firebase)==null?void 0:b.auth(),$=B==null?void 0:B.currentUser;if(!$){C("Please log in to create roles");return}const H=await $.getIdToken(),ne=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/roles`,{method:"POST",headers:{Authorization:`Bearer ${H}`,"Content-Type":"application/json"},body:JSON.stringify(re)});if(ne.ok){const Z=await ne.json();console.log("âœ… [RoleManagement] Role created successfully:",Z),E("Role created successfully!"),h("overview"),ge(),O(),ie({name:"",displayName:"",description:"",category:"PRODUCTION",hierarchy:50,permissions:{}})}else{const Z=await ne.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to create role:",Z),C(Z.error||"Failed to create role")}}catch(B){console.log("âŒ [RoleManagement] Error creating role:",B),C("Failed to create role")}finally{j(!1)}},q=async b=>{var B;try{j(!0),console.log("ðŸ” [RoleManagement] Using template:",b.displayName);const $={name:b.name,displayName:b.displayName,description:b.description,category:b.category,hierarchy:b.hierarchy,permissions:b.permissions,isCustom:!1,baseRole:b.baseRole},H=(B=window.firebase)==null?void 0:B.auth(),ne=H==null?void 0:H.currentUser;if(!ne){C("Please log in to add roles");return}const Z=await ne.getIdToken(),V=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/roles`,{method:"POST",headers:{Authorization:`Bearer ${Z}`,"Content-Type":"application/json"},body:JSON.stringify($)});if(V.ok){const I=await V.json();console.log("âœ… [RoleManagement] Template role created successfully:",I),E(`Role "${b.displayName}" added to project!`),h("overview"),ge()}else{const I=await V.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to create template role:",I),C(I.error||"Failed to add role from template")}}catch($){console.log("âŒ [RoleManagement] Error using template:",$),C("Failed to add role from template")}finally{j(!1)}},K=async(b,B)=>{var $;try{j(!0),console.log("ðŸ” [RoleManagement] Assigning role:",{memberId:b,roleId:B});const H=($=window.firebase)==null?void 0:$.auth(),ne=H==null?void 0:H.currentUser;if(!ne){C("Please log in to assign roles");return}const Z=await ne.getIdToken(),V=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/team-members/${b}/role`,{method:"PUT",headers:{Authorization:`Bearer ${Z}`,"Content-Type":"application/json"},body:JSON.stringify({roleId:B})});if(V.ok){const I=await V.json();console.log("âœ… [RoleManagement] Role assigned successfully:",I),E("Role assigned successfully!"),_e()}else{const I=await V.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to assign role:",I),C(I.error||"Failed to assign role")}}catch(H){console.log("âŒ [RoleManagement] Error assigning role:",H),C("Failed to assign role")}finally{j(!1)}},U=async b=>{var B;try{j(!0),console.log("ðŸ” [RoleManagement] Using user created role:",b.displayName);const $=(B=window.firebase)==null?void 0:B.auth(),H=$==null?void 0:$.currentUser;if(!H){C("Please log in to add roles");return}const ne=await H.getIdToken(),Z={name:b.name,displayName:b.displayName,description:b.description,category:b.category,hierarchy:b.hierarchy,permissions:b.permissions,isCustom:!0,baseRole:b.baseRole},V=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/roles`,{method:"POST",headers:{Authorization:`Bearer ${ne}`,"Content-Type":"application/json"},body:JSON.stringify(Z)});if(V.ok){const I=await V.json();console.log("âœ… [RoleManagement] User role added successfully:",I),E(`Role "${b.displayName}" added to project!`),h("overview"),ge()}else{const I=await V.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to add user role:",I),C(I.error||"Failed to add role to project")}}catch($){console.log("âŒ [RoleManagement] Error using user role:",$),C("Failed to add role to project")}finally{j(!1)}},Se=Or.useMemo(()=>{let b=tt();if(console.log("ðŸ” [RoleTemplates] Total templates available:",b.length),console.log("ðŸ” [RoleTemplates] Selected industry:",se),te&&(b=Xa(),console.log("ðŸ” [RoleTemplates] Popular templates:",b.length)),se!=="all"){const B=b.length;b=b.filter(H=>H.industry===se),console.log(`ðŸ” [RoleTemplates] Filtered by industry ${se}: ${B} â†’ ${b.length}`);const $=tt().reduce((H,ne)=>(H[ne.industry]=(H[ne.industry]||0)+1,H),{});console.log("ðŸ” [RoleTemplates] Available industries:",$)}if(J.trim()){const B=Za(J);b=b.filter($=>B.some(H=>H.id===$.id)),console.log("ðŸ” [RoleTemplates] After search filter:",b.length)}return b},[J,se,te]),Oe=()=>e.jsxs(n,{children:[e.jsxs(p,{container:!0,spacing:2,sx:{mb:4},children:[e.jsx(p,{item:!0,xs:12,md:4,children:e.jsx(ue,{sx:{cursor:"pointer",border:"2px solid transparent","&:hover":{boxShadow:4,borderColor:"primary.main"}},onClick:()=>h("create-custom"),children:e.jsxs(ye,{sx:{textAlign:"center",py:3},children:[e.jsx(_r,{sx:{fontSize:40,color:"primary.main",mb:2}}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Create Custom Role"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Define a new role with specific permissions"})]})})}),e.jsx(p,{item:!0,xs:12,md:4,children:e.jsx(ue,{sx:{cursor:"pointer",border:"2px solid transparent","&:hover":{boxShadow:4,borderColor:"secondary.main"}},onClick:()=>h("browse-templates"),children:e.jsxs(ye,{sx:{textAlign:"center",py:3},children:[e.jsx(ma,{sx:{fontSize:40,color:"secondary.main",mb:2}}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Use Role Template"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Choose from 70+ pre-defined roles"})]})})}),e.jsx(p,{item:!0,xs:12,md:4,children:e.jsx(ue,{sx:{cursor:"pointer",border:"2px solid transparent","&:hover":{boxShadow:4,borderColor:"success.main"},opacity:Ce.length===0?.6:1},onClick:()=>Ce.length>0&&h("user-created"),children:e.jsxs(ye,{sx:{textAlign:"center",py:3},children:[e.jsx(ha,{sx:{fontSize:40,color:"success.main",mb:2}}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Your Created Roles"}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Reuse roles you've created (",Ce.length,")"]})]})})})]}),e.jsx(Lt,{sx:{my:3}}),e.jsxs(n,{sx:{mb:3},children:[e.jsxs(o,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Bs,{}),"Current Project Roles (",_.length,")"]}),_.length===0?e.jsx(Ke,{sx:{p:3,textAlign:"center",bgcolor:"grey.50"},children:e.jsx(o,{variant:"body2",color:"text.secondary",children:"No roles defined yet. Create a custom role or use a template to get started."})}):e.jsx(Ft,{children:_.map(b=>e.jsxs(Wt,{divider:!0,children:[e.jsx(Ut,{primary:b.displayName,secondary:e.jsxs(n,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",children:b.description}),e.jsxs(n,{sx:{mt:1,display:"flex",gap:1,alignItems:"center"},children:[e.jsx(z,{size:"small",label:b.category,variant:"outlined"}),e.jsx(z,{size:"small",label:`Level ${b.hierarchy}`,color:"primary",variant:"outlined"}),b.isCustom&&e.jsx(z,{size:"small",label:"Custom",color:"secondary",variant:"outlined"})]})]})}),e.jsxs($t,{children:[e.jsx(_s,{size:"small",children:e.jsx(jt,{})}),e.jsx(_s,{size:"small",color:"error",children:e.jsx(Qs,{})})]})]},b.id))})]}),e.jsx(Lt,{sx:{my:3}}),e.jsxs(n,{children:[e.jsxs(o,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ns,{}),"Team Member Assignments (",oe.length,")"]}),oe.length===0?e.jsx(Ke,{sx:{p:3,textAlign:"center",bgcolor:"grey.50"},children:e.jsx(o,{variant:"body2",color:"text.secondary",children:"No team members found. Invite members to your project first."})}):e.jsx(Ft,{children:oe.map(b=>e.jsxs(Wt,{divider:!0,children:[e.jsx(Js,{sx:{mr:2},children:b.displayName.charAt(0).toUpperCase()}),e.jsx(Ut,{primary:b.displayName,secondary:b.email}),e.jsx($t,{children:e.jsxs(He,{size:"small",sx:{minWidth:150},children:[e.jsx(Ye,{children:"Role"}),e.jsxs(Qe,{value:b.projectRoleId||"",label:"Role",onChange:B=>K(b.id,B.target.value),children:[e.jsx(k,{value:"",children:e.jsx("em",{children:"No Role"})}),_.map(B=>e.jsx(k,{value:B.id,children:B.displayName},B.id))]})]})})]},b.id))})]})]}),Ae=()=>e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{startIcon:e.jsx(st,{}),onClick:()=>h("overview"),variant:"outlined",size:"small",children:"Back"}),e.jsx(o,{variant:"h6",children:"Create Custom Role"})]}),e.jsxs(p,{container:!0,spacing:3,children:[e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(ce,{fullWidth:!0,label:"Role Name",value:re.displayName||"",onChange:b=>ie(B=>({...B,displayName:b.target.value})),placeholder:"e.g., Senior Editor",sx:{mb:2}}),e.jsx(ce,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:re.description||"",onChange:b=>ie(B=>({...B,description:b.target.value})),placeholder:"Describe the role's responsibilities...",sx:{mb:2}}),e.jsxs(He,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Ye,{children:"Category"}),e.jsxs(Qe,{value:re.category||"PRODUCTION",label:"Category",onChange:b=>ie(B=>({...B,category:b.target.value})),children:[e.jsx(k,{value:"PRODUCTION",children:"Production"}),e.jsx(k,{value:"POST_PRODUCTION",children:"Post-Production"}),e.jsx(k,{value:"ADMINISTRATIVE",children:"Administrative"}),e.jsx(k,{value:"CREATIVE",children:"Creative"}),e.jsx(k,{value:"TECHNICAL",children:"Technical"})]})]}),e.jsxs(n,{sx:{mb:2},children:[e.jsxs(o,{gutterBottom:!0,children:["Hierarchy Level: ",re.hierarchy]}),e.jsx(pa,{value:re.hierarchy||50,onChange:(b,B)=>ie($=>({...$,hierarchy:B})),min:1,max:100,marks:[{value:1,label:"Basic"},{value:50,label:"Standard"},{value:100,label:"Admin"}]})]})]}),e.jsxs(p,{item:!0,xs:12,md:6,children:[e.jsx(o,{variant:"subtitle1",gutterBottom:!0,children:"Permissions"}),e.jsxs(Ke,{sx:{p:2,maxHeight:400,overflow:"auto"},children:[e.jsx(Ie,{control:e.jsx(Fe,{}),label:"Create & Edit Sessions"}),e.jsx(Ie,{control:e.jsx(Fe,{}),label:"Manage Post-Production"}),e.jsx(Ie,{control:e.jsx(Fe,{}),label:"Access Analytics"}),e.jsx(Ie,{control:e.jsx(Fe,{}),label:"Manage Team"}),e.jsx(Ie,{control:e.jsx(Fe,{}),label:"Project Settings"})]})]})]}),e.jsxs(n,{sx:{mt:3,textAlign:"right"},children:[e.jsx(F,{variant:"outlined",onClick:()=>h("overview"),sx:{mr:2},children:"Cancel"}),e.jsx(F,{variant:"contained",onClick:W,disabled:!re.displayName||i,children:"Create Role"})]})]}),De=()=>e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{startIcon:e.jsx(st,{}),onClick:()=>h("overview"),variant:"outlined",size:"small",children:"Back"}),e.jsx(o,{variant:"h6",children:"Browse Role Templates"})]}),e.jsx(Ke,{sx:{p:2,mb:3},children:e.jsxs(p,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(p,{item:!0,xs:12,md:4,children:e.jsx(ce,{fullWidth:!0,size:"small",placeholder:"Search roles...",value:J,onChange:b=>ve(b.target.value),InputProps:{startAdornment:e.jsx(Ct,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(p,{item:!0,xs:12,md:3,children:e.jsxs(He,{fullWidth:!0,size:"small",children:[e.jsx(Ye,{children:"Industry"}),e.jsxs(Qe,{value:se,label:"Industry",onChange:b=>pe(b.target.value),children:[e.jsx(k,{value:"all",children:"All Industries"}),e.jsx(k,{value:"FILM_TV",children:"Film & TV"}),e.jsx(k,{value:"CORPORATE_EVENTS",children:"Corporate Events"}),e.jsx(k,{value:"LIVE_EVENTS",children:"Live Events"}),e.jsx(k,{value:"SPORTS_BROADCAST",children:"Sports Broadcasting"}),e.jsx(k,{value:"GAMING_ESPORTS",children:"Gaming & Esports"}),e.jsx(k,{value:"HEALTHCARE",children:"Healthcare"}),e.jsx(k,{value:"IT_TECHNOLOGY",children:"IT & Technology"}),e.jsx(k,{value:"MARKETING_ADVERTISING",children:"Marketing & Advertising"}),e.jsx(k,{value:"EDUCATION_TRAINING",children:"Education & Training"}),e.jsx(k,{value:"CONSTRUCTION_ENGINEERING",children:"Construction & Engineering"}),e.jsx(k,{value:"FINANCE_BANKING",children:"Finance & Banking"}),e.jsx(k,{value:"GOVERNMENT_PUBLIC",children:"Government & Public"})]})]})}),e.jsx(p,{item:!0,xs:12,md:3,children:e.jsx(Ie,{control:e.jsx(Fe,{checked:te,onChange:b=>xe(b.target.checked)}),label:"Popular Only"})}),e.jsx(p,{item:!0,xs:12,md:2,children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:[Se.length," roles"]})})]})}),e.jsx(p,{container:!0,spacing:2,children:Se.map(b=>e.jsx(p,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ue,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(ye,{sx:{flexGrow:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(o,{variant:"h6",component:"div",noWrap:!0,children:b.name}),b.isPopular&&e.jsx(z,{size:"small",label:"Popular",color:"primary"})]}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:b.description}),e.jsxs(n,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(z,{size:"small",label:b.industry,variant:"outlined"}),e.jsx(z,{size:"small",label:`Level ${b.hierarchy}`,variant:"outlined"}),e.jsx(z,{size:"small",label:b.experienceLevel,variant:"outlined"})]}),e.jsxs(o,{variant:"caption",color:"text.secondary",children:["Used ",b.usageCount||0," times"]})]}),e.jsx(n,{sx:{p:2,pt:0},children:e.jsx(F,{fullWidth:!0,variant:"contained",size:"small",onClick:()=>q(b),disabled:i,children:"Add to Project"})})]})},b.id))}),Se.length===0&&e.jsxs(Ke,{sx:{p:4,textAlign:"center"},children:[e.jsx(o,{variant:"body1",color:"text.secondary",children:"No templates found matching your criteria."}),e.jsx(F,{variant:"outlined",onClick:()=>{ve(""),pe("all"),xe(!1)},sx:{mt:2},children:"Clear Filters"})]})]}),Pe=()=>e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{startIcon:e.jsx(st,{}),onClick:()=>h("overview"),variant:"outlined",size:"small",children:"Back"}),e.jsx(o,{variant:"h6",children:"Your Created Roles"})]}),e.jsx(p,{container:!0,spacing:2,children:Ce.map(b=>e.jsx(p,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ue,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(ye,{sx:{flexGrow:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(o,{variant:"h6",component:"div",noWrap:!0,children:b.displayName}),e.jsx(z,{size:"small",label:"Custom",color:"success"})]}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:b.description}),e.jsxs(n,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(z,{size:"small",label:b.category,variant:"outlined"}),e.jsx(z,{size:"small",label:`Level ${b.hierarchy}`,variant:"outlined"})]})]}),e.jsx(n,{sx:{p:2,pt:0},children:e.jsx(F,{fullWidth:!0,variant:"contained",size:"small",onClick:()=>U(b),disabled:i,children:"Add to Project"})})]})},b.id))}),Ce.length===0&&e.jsxs(Ke,{sx:{p:4,textAlign:"center"},children:[e.jsx(o,{variant:"body1",color:"text.secondary",children:"You haven't created any custom roles yet."}),e.jsx(F,{variant:"outlined",onClick:()=>h("create-custom"),sx:{mt:2},children:"Create Your First Role"})]})]});return e.jsxs(ns,{open:u,onClose:a,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{minHeight:"70vh"}},children:[e.jsx(is,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Bs,{}),"Role Management - ",r]})}),e.jsxs(ls,{children:[w&&e.jsx(he,{severity:"error",sx:{mb:2},onClose:()=>C(null),children:w}),D&&e.jsx(he,{severity:"success",sx:{mb:2},onClose:()=>E(null),children:D}),i&&e.jsx(n,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(ds,{})}),l==="overview"&&Oe(),l==="create-custom"&&Ae(),l==="browse-templates"&&De(),l==="user-created"&&Pe()]}),e.jsx(cs,{children:e.jsx(F,{onClick:a,children:"Close"})})]})},Nt={ADMIN:100,GUEST:10,EXEC:95,ACCOUNT_MANAGER:75,PROJECT_MANAGER:70,PRODUCTION_MANAGER:65,MANAGER:60,BUSINESS_ANALYST:55,DEVOPS_ENGINEER:50,NETWORK_ENGINEER:45,SOUND_ENGINEER:40,LIGHTING_TECHNICIAN:35,DIT:35,TECH:30,NETWORKING:30,ART_DIRECTOR:60,VFX_ARTIST:40,MOTION_GRAPHICS_ARTIST:40,GFX_ARTIST:35,COLORIST:35,DIRECTOR:65,ASSIST_DIRECTOR:30,PRODUCER:55,ASSOCIATE_PRODUCER:45,POST_PRODUCER:50,LINE_PRODUCER:50,KEYNOTE_PRODUCER:45,KEYNOTE_PROD:40,PRODUCTION_ASSISTANT:25,POST_PA:25,EDITOR:45,ASSISTANT_EDITOR:30,POST_COORDINATOR:50,POST_PRODUCTION_SUPERVISOR:55,KEYNOTE_POST:40,AUDIO_PRODUCTION:40,AUDIO_POST:35,MEDIA_MANAGER:50,CAMERA_OPERATOR:35,QC_SPECIALIST:30},Ps=class Ps{constructor(){Me(this,"roleMappingCache",new Map)}static getInstance(){return Ps.instance||(Ps.instance=new Ps),Ps.instance}mapLicensingRoleToDashboard(a,t,r="PRO"){console.log(`ðŸ”„ [RoleBridge] Mapping licensing role: ${a}${t?` with template: ${t.displayName}`:""}`);const c=`${a}-${(t==null?void 0:t.id)||"basic"}-${r}`;if(this.roleMappingCache.has(c))return this.roleMappingCache.get(c);let l,h,i=!1;if(t){const C=this.mapTemplateRoleToDashboard(t,a);l=C.dashboardRole,h=C.effectiveHierarchy,i=C.isCustomMapping}else{const C=this.mapBasicLicensingRole(a);l=C.dashboardRole,h=C.effectiveHierarchy}h=this.applyTierRestrictions(h,r);const j=this.generateRolePermissions(l,h,r),w={licensingRole:a,templateRole:t,dashboardRole:l,effectiveHierarchy:h,permissions:j,isCustomMapping:i};return this.roleMappingCache.set(c,w),console.log(`âœ… [RoleBridge] Mapped to Dashboard role: ${l} (hierarchy: ${h})`),w}mapTemplateRoleToDashboard(a,t){const r=a.name.toUpperCase();a.displayName.toUpperCase();for(const[l,h]of Object.entries(Nt))if(r.includes(l)||l.includes(r))return{dashboardRole:l,effectiveHierarchy:Math.max(a.hierarchy,h),isCustomMapping:!1};const c=this.getSemanticRoleMapping(a,t);return c||this.getHierarchyBasedMapping(a,t)}getSemanticRoleMapping(a,t){const r=a.displayName.toLowerCase();a.keyResponsibilities.join(" ").toLowerCase();const c=a.hierarchy;return c>=80||r.includes("manager")||r.includes("supervisor")||r.includes("director")?c>=90?{dashboardRole:"EXEC",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("post")||r.includes("production")?{dashboardRole:"POST_PRODUCTION_SUPERVISOR",effectiveHierarchy:c,isCustomMapping:!0}:{dashboardRole:"MANAGER",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("director")&&!r.includes("assistant")?{dashboardRole:"DIRECTOR",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("editor")?r.includes("assistant")?{dashboardRole:"ASSISTANT_EDITOR",effectiveHierarchy:c,isCustomMapping:!0}:{dashboardRole:"EDITOR",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("producer")?r.includes("associate")?{dashboardRole:"ASSOCIATE_PRODUCER",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("line")?{dashboardRole:"LINE_PRODUCER",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("post")?{dashboardRole:"POST_PRODUCER",effectiveHierarchy:c,isCustomMapping:!0}:{dashboardRole:"PRODUCER",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("camera")?{dashboardRole:"CAMERA_OPERATOR",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("sound")||r.includes("audio")?{dashboardRole:"SOUND_ENGINEER",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("lighting")?{dashboardRole:"LIGHTING_TECHNICIAN",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("color")?{dashboardRole:"COLORIST",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("graphics")||r.includes("gfx")?{dashboardRole:"GFX_ARTIST",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("qc")||r.includes("quality")?{dashboardRole:"QC_SPECIALIST",effectiveHierarchy:c,isCustomMapping:!0}:r.includes("assistant")||r.includes("support")||c<=20?{dashboardRole:"PRODUCTION_ASSISTANT",effectiveHierarchy:c,isCustomMapping:!0}:null}getHierarchyBasedMapping(a,t){const r=a.hierarchy;return r>=90?{dashboardRole:"EXEC",effectiveHierarchy:r,isCustomMapping:!0}:r>=80?{dashboardRole:"MANAGER",effectiveHierarchy:r,isCustomMapping:!0}:r>=60?{dashboardRole:"PRODUCER",effectiveHierarchy:r,isCustomMapping:!0}:r>=40?{dashboardRole:"EDITOR",effectiveHierarchy:r,isCustomMapping:!0}:r>=20?{dashboardRole:"PRODUCTION_ASSISTANT",effectiveHierarchy:r,isCustomMapping:!0}:{dashboardRole:"GUEST",effectiveHierarchy:r,isCustomMapping:!0}}mapBasicLicensingRole(a){switch(a){case Xe.ADMIN:return{dashboardRole:"ADMIN",effectiveHierarchy:100};case Xe.MEMBER:return{dashboardRole:"PRODUCER",effectiveHierarchy:60};default:return{dashboardRole:"GUEST",effectiveHierarchy:10}}}applyTierRestrictions(a,t){switch(t){case"BASIC":return Math.min(a,40);case"PRO":return Math.min(a,80);case"ENTERPRISE":return a;default:return Math.min(a,40)}}generateRolePermissions(a,t,r){const c={canManageTeam:t>=80,canManageProjects:t>=60,canViewFinancials:t>=70&&(r==="PRO"||r==="ENTERPRISE"),canEditContent:t>=25,canApproveContent:t>=40,canAccessReports:t>=30,canManageSettings:t>=90,hierarchyLevel:t};return r==="BASIC"&&(c.canViewFinancials=!1,c.canManageSettings=!1),c}getAvailableDashboardRoles(a,t){const r=this.applyTierRestrictions(100,t);return Object.entries(Nt).filter(([c,l])=>l<=r).map(([c,l])=>c)}validateRoleAssignment(a,t,r){const c=Nt[t],l=this.applyTierRestrictions(100,r);return c>l?{isValid:!1,reason:`Role ${t} (hierarchy ${c}) exceeds maximum allowed for ${r} tier (${l})`}:{isValid:!0}}clearCache(){this.roleMappingCache.clear(),console.log("ðŸ§¹ [RoleBridge] Role mapping cache cleared")}};Me(Ps,"instance");let vt=Ps;const ks=class ks{constructor(){Me(this,"roleBridgeService");Me(this,"syncListeners",new Map);Me(this,"syncQueue",[]);Me(this,"isProcessingQueue",!1);Me(this,"config",{enableRealTimeSync:!0,enableBidirectionalSync:!0,conflictResolution:"hierarchy-based",batchSize:10,retryAttempts:3,syncTimeout:3e4});this.roleBridgeService=vt.getInstance(),this.initializeSyncListeners()}static getInstance(){return ks.instance||(ks.instance=new ks),ks.instance}initializeSyncListeners(){if(!this.config.enableRealTimeSync)return;console.log("ðŸ”„ [CrossAppSync] Initializing real-time sync listeners");const a=kt(Ts,"roleSyncEvents"),t=Fa(a,r=>{r.docChanges().forEach(c=>{if(c.type==="added"){const l={id:c.doc.id,...c.doc.data()};this.handleIncomingSyncEvent(l)}})});this.syncListeners.set("roleSyncEvents",t)}async syncRoleToLicensing(a,t,r,c,l,h){if(!this.config.enableRealTimeSync){console.log(`â¸ï¸ [CrossAppSync] Sync disabled, skipping role sync for: ${a}`);return}console.log(`ðŸ”„ [CrossAppSync] Syncing role to licensing: ${a} -> ${c}`);try{const i=this.roleBridgeService.mapLicensingRoleToDashboard(c,l,"PRO"),j={type:"ROLE_ASSIGNED",sourceApp:"licensing",targetApp:"dashboard",timestamp:new Date,userId:a,projectId:t,organizationId:r,data:{licensingRole:c,templateRole:l,dashboardRole:i.dashboardRole,hierarchy:i.effectiveHierarchy,permissions:i.permissions,roleMapping:i,assignedBy:h,reason:"Role assigned via licensing website wizard"},status:"pending"};await this.addToSyncQueue(j),await this.updateUserRoleMapping(a,t,i),console.log(`âœ… [CrossAppSync] Role sync initiated for user: ${a}`)}catch(i){throw console.error("âŒ [CrossAppSync] Error syncing role to licensing:",i),i}}async syncRoleFromDashboard(a,t,r,c,l,h){if(!this.config.enableRealTimeSync){console.log(`â¸ï¸ [CrossAppSync] Sync disabled, skipping Dashboard role sync for: ${a}`);return}console.log(`ðŸ”„ [CrossAppSync] Syncing role from Dashboard: ${a} -> ${c}`);try{const i={type:"ROLE_ASSIGNED",sourceApp:"dashboard",targetApp:"licensing",timestamp:new Date,userId:a,projectId:t,organizationId:r,data:{dashboardRole:c,hierarchy:l,assignedBy:h,reason:"Role assigned via Dashboard application"},status:"pending"};await this.addToSyncQueue(i),console.log(`âœ… [CrossAppSync] Dashboard role sync initiated for user: ${a}`)}catch(i){throw console.error("âŒ [CrossAppSync] Error syncing role from Dashboard:",i),i}}async addToSyncQueue(a){try{const t=await Wa(kt(Ts,"roleSyncEvents"),{...a,timestamp:os.fromDate(a.timestamp)});a.id=t.id,this.syncQueue.push(a),this.isProcessingQueue||this.processSyncQueue()}catch(t){throw console.error("âŒ [CrossAppSync] Error adding to sync queue:",t),t}}async processSyncQueue(){if(!(this.isProcessingQueue||this.syncQueue.length===0)){this.isProcessingQueue=!0,console.log(`ðŸ”„ [CrossAppSync] Processing sync queue: ${this.syncQueue.length} events`);try{for(;this.syncQueue.length>0;){const a=this.syncQueue.splice(0,this.config.batchSize);await Promise.all(a.map(t=>this.processSyncEvent(t)))}}catch(a){console.error("âŒ [CrossAppSync] Error processing sync queue:",a)}finally{this.isProcessingQueue=!1}}}async processSyncEvent(a){console.log(`ðŸ”„ [CrossAppSync] Processing sync event: ${a.type} for user ${a.userId}`);try{switch(await this.updateSyncEventStatus(a.id,"processing"),a.type){case"ROLE_ASSIGNED":await this.processRoleAssignment(a);break;case"ROLE_UPDATED":await this.processRoleUpdate(a);break;case"ROLE_REMOVED":await this.processRoleRemoval(a);break;case"HIERARCHY_CHANGED":await this.processHierarchyChange(a);break;case"PERMISSIONS_UPDATED":await this.processPermissionsUpdate(a);break}await this.updateSyncEventStatus(a.id,"completed"),console.log(`âœ… [CrossAppSync] Sync event completed: ${a.id}`)}catch(t){console.error(`âŒ [CrossAppSync] Error processing sync event ${a.id}:`,t);const r=t instanceof Error?t.message:"Unknown error";await this.updateSyncEventStatus(a.id,"failed",r)}}async processRoleAssignment(a){const{userId:t,projectId:r,data:c}=a;a.targetApp==="dashboard"?await this.syncToDashboardApp(t,r,c.roleMapping):a.targetApp==="licensing"&&await this.syncToLicensingApp(t,r,c.dashboardRole,c.hierarchy)}async syncToDashboardApp(a,t,r){var c;console.log(`ðŸŽ¯ [CrossAppSync] Syncing to existing collections: ${a} -> ${r.dashboardRole}`);try{const l=mt(Ts,"users",a),h=await Tr(l),i={[t]:{dashboardRole:r.dashboardRole,hierarchy:r.effectiveHierarchy,permissions:r.permissions,licensingRole:r.licensingRole,templateRole:((c=r.templateRole)==null?void 0:c.id)||null,syncedAt:os.now(),syncSource:"licensing"}};if(h.exists())await Ys(l,{[`dashboardRoleMappings.${t}`]:i[t],lastRoleSync:os.now(),roleSystemVersion:"2.0"}),console.log(`âœ… [CrossAppSync] Updated user Dashboard role mapping: ${a}`);else{console.warn(`âš ï¸ [CrossAppSync] User document not found: ${a}`);return}const j=Ua(kt(Ts,"projectAssignments"),Mt("projectId","==",t),Mt("userId","==",a),Mt("isActive","==",!0)),w=await $a(j);if(w.empty)console.warn(`âš ï¸ [CrossAppSync] No active project assignment found for user ${a} in project ${t}`);else{const C=w.docs[0];await Ys(C.ref,{dashboardRole:r.dashboardRole,hierarchyLevel:r.effectiveHierarchy,enhancedPermissions:r.permissions,syncMetadata:{lastSyncedAt:os.now(),syncSource:"licensing",syncVersion:"2.0"}}),console.log(`âœ… [CrossAppSync] Updated project assignment with Dashboard role: ${a}`)}}catch(l){throw console.error(`âŒ [CrossAppSync] Error syncing to existing collections for user ${a}:`,l),l}}async syncToLicensingApp(a,t,r,c){console.log(`ðŸŽ¯ [CrossAppSync] Syncing to Licensing: ${a} -> ${r}`);const l=mt(Ts,"projectAssignments",`${t}-${a}`);await Ys(l,{dashboardRole:r,hierarchy:c,syncedAt:os.now(),syncSource:"dashboard"})}async handleIncomingSyncEvent(a){a.status==="pending"&&(this.syncQueue.push(a),this.isProcessingQueue||this.processSyncQueue())}async updateUserRoleMapping(a,t,r){try{const c=mt(Ts,"users",a),l=await Tr(c),h={...r,updatedAt:os.now()};l.exists()?(await Ys(c,{[`roleMappings.${t}`]:h}),console.log(`âœ… [CrossAppSync] Updated role mapping for user: ${a}`)):(await Ga(c,{id:a,roleMappings:{[t]:h},createdAt:os.now(),updatedAt:os.now()}),console.log(`âœ… [CrossAppSync] Created user with role mapping: ${a}`))}catch(c){console.error(`âŒ [CrossAppSync] Error updating role mapping for user ${a}:`,c)}}async updateSyncEventStatus(a,t,r){const c=mt(Ts,"roleSyncEvents",a),l={status:t,updatedAt:os.now()};r&&(l.error=r),await Ys(c,l)}async processRoleUpdate(a){console.log("ðŸ”„ [CrossAppSync] Processing role update:",a.id)}async processRoleRemoval(a){console.log("ðŸ”„ [CrossAppSync] Processing role removal:",a.id)}async processHierarchyChange(a){console.log("ðŸ”„ [CrossAppSync] Processing hierarchy change:",a.id)}async processPermissionsUpdate(a){console.log("ðŸ”„ [CrossAppSync] Processing permissions update:",a.id)}configureSyncSettings(a){this.config={...this.config,...a},console.log("âš™ï¸ [CrossAppSync] Sync configuration updated:",this.config),a.enableRealTimeSync&&!this.syncListeners.has("roleSyncEvents")&&this.initializeSyncListeners()}enableSync(){this.configureSyncSettings({enableRealTimeSync:!0}),console.log("âœ… [CrossAppSync] Cross-app synchronization enabled")}disableSync(){this.configureSyncSettings({enableRealTimeSync:!1}),console.log("â¸ï¸ [CrossAppSync] Cross-app synchronization disabled")}async getSyncStatus(a,t){return[]}cleanup(){this.syncListeners.forEach(a=>{a()}),this.syncListeners.clear(),console.log("ðŸ§¹ [CrossAppSync] Sync listeners cleaned up")}};Me(ks,"instance");let Yt=ks;const zt=["Choose Action","Select Members","Assign Roles","Review & Confirm"],so=({open:u,onClose:a,projectId:t,projectName:r,organizationId:c,onTeamMembersUpdated:l,existingProjectTeamMembers:h})=>{const[i,j]=m.useState(0),[w,C]=m.useState(!1),[D,E]=m.useState(null),[_,Q]=m.useState(null),[oe,je]=m.useState(null),[Ce,R]=m.useState([]),[J,ve]=m.useState([]),[se,pe]=m.useState([]),[te,xe]=m.useState([]),[re,ie]=m.useState([]),[ge,_e]=m.useState(!1),O=vt.getInstance(),W=Yt.getInstance(),[q,K]=m.useState(""),[U,Se]=m.useState("popular"),[Oe,Ae]=m.useState("all");m.useEffect(()=>{u&&t&&De()},[u,t]);const De=async()=>{C(!0),E(null);try{await Pe(),await Promise.all([b(),B()])}catch(x){console.error("âŒ [TeamRoleWizard] Error loading data:",x),E("Failed to load data. Please try again.")}finally{C(!1)}},Pe=async()=>{try{if(console.log(`ðŸ” [TeamRoleWizard] Loading existing team members for project: ${t}`),h&&h.length>0){console.log(`âœ… [TeamRoleWizard] Using ${h.length} existing team members from parent component`),console.log("ðŸ” [TeamRoleWizard] Parent team members data:",h),ie(h);const P=h.some(y=>y.role==="ADMIN"||y.role===Xe.ADMIN||y.role==="ENTERPRISE");_e(P),console.log(`ðŸ›¡ï¸ [TeamRoleWizard] Project has admin: ${P}`);return}const x=wr.getInstance({isWebOnlyMode:!0,apiBaseUrl:"/api"});try{const P=await x.getProjectTeamMembers(t);console.log(`âœ… [TeamRoleWizard] Found ${P.length} existing team members from TeamMemberService`),console.log("ðŸ” [TeamRoleWizard] Service team members data:",P),ie(P);const y=P.some(f=>f.role==="ADMIN"||f.role===Xe.ADMIN||f.role==="ENTERPRISE");_e(y),console.log(`ðŸ›¡ï¸ [TeamRoleWizard] Project has admin: ${y}`)}catch(P){console.warn("âš ï¸ [TeamRoleWizard] TeamMemberService failed:",P),ie([]),_e(!1),console.log("âš ï¸ [TeamRoleWizard] Using empty team member list - filtering may not work correctly")}}catch(x){console.error("âŒ [TeamRoleWizard] Error loading existing team members:",x),ie([]),_e(!1)}},b=async()=>{try{console.log(`ðŸ” [TeamRoleWizard] Loading team members for project: ${t}`);const x=await Rr.getTeamMembersForOrganization(),P=re.map(v=>v.id||v.userId||v.memberId||v.firebaseUid),y=re.map(v=>v.email).filter(Boolean);console.log(`ðŸ” [TeamRoleWizard] Found ${P.length} already assigned member IDs:`,P),console.log(`ðŸ” [TeamRoleWizard] Found ${y.length} already assigned member emails:`,y),console.log("ðŸ” [TeamRoleWizard] Existing team members structure:",re);const f=x.filter(v=>{const de=P.includes(v.id),Ne=y.includes(v.email),Re=de||Ne;return Re&&console.log(`ðŸš« [TeamRoleWizard] Filtering out already assigned member: ${v.name||v.email} (ID: ${v.id}, Email: ${v.email})`),!Re}),L=f.map(v=>({id:v.id,name:v.name||`${v.firstName} ${v.lastName}`,email:v.email,tier:v.role||v.licenseType||"MEMBER",isSelected:!1}));R(L),console.log(`âœ… [TeamRoleWizard] Loaded ${L.length} available team members (filtered out ${x.length-f.length} already assigned)`)}catch(x){console.error("âŒ [TeamRoleWizard] Error loading members:",x),E(`Failed to load team members: ${x.message}`),R([])}},B=async()=>{try{console.log(`ðŸ” [TeamRoleWizard] Loading roles for project: ${t}`);let x=[{id:"basic-admin",name:"ADMIN",displayName:"Project Admin",description:"Full administrative access to the project",category:"MANAGEMENT",hierarchy:100,isTemplate:!1,isPopular:!0},{id:"basic-manager",name:"MANAGER",displayName:"Project Manager",description:"Manage project tasks and team members",category:"MANAGEMENT",hierarchy:80,isTemplate:!1,isPopular:!0},{id:"basic-doer",name:"MEMBER",displayName:"Team Member",description:"Standard team member with task execution access",category:"EXECUTION",hierarchy:60,isTemplate:!1,isPopular:!0},{id:"basic-viewer",name:"VIEWER",displayName:"Viewer",description:"Read-only access to project information",category:"ACCESS",hierarchy:20,isTemplate:!1,isPopular:!1}];const y=tt().map(f=>({id:`template-${f.id}`,name:f.name,displayName:f.displayName,description:f.description,category:f.category,hierarchy:f.hierarchy,isTemplate:!0,isPopular:f.isPopular,industry:f.industry,tags:f.tags,usageCount:f.usageCount,icon:f.icon,color:f.color}));console.log(`ðŸŽ­ [TeamRoleWizard] Loaded ${y.length} enhanced role templates`),pe([...x,...y])}catch(x){console.error("âŒ [TeamRoleWizard] Error loading roles:",x),pe([])}},$=()=>{if(i===0&&!oe){E("Please choose an action to continue");return}if(i===1&&J.length===0){E("Please select at least one team member");return}if(i===2){const x=J.filter(P=>!te.find(y=>y.memberId===P.id));if(x.length>0){E(`Please assign roles to: ${x.map(P=>P.name).join(", ")}`);return}if(!ge&&!te.some(y=>{const f=se.find(L=>L.id===y.roleId);return(f==null?void 0:f.name)==="ADMIN"})){E("âš ï¸ This project needs an ADMIN! Please assign the ADMIN role to at least one team member before proceeding.");return}}E(null),j(x=>Math.min(x+1,zt.length-1))},H=()=>{E(null),j(x=>Math.max(x-1,0))},ne=()=>{j(0),je(null),ve([]),xe([]),E(null),Q(null)},Z=x=>{ve(P=>P.some(f=>f.id===x.id)?(xe(f=>f.filter(L=>L.memberId!==x.id)),P.filter(f=>f.id!==x.id)):[...P,x])},V=(x,P)=>{xe(y=>{const f=y.find(de=>de.memberId===x);let L;f?L=y.map(de=>de.memberId===x?{...de,roleId:P}:de):L=[...y,{memberId:x,roleId:P}];const v=se.find(de=>de.id===P);return(v==null?void 0:v.name)==="ADMIN"&&console.log("ðŸ›¡ï¸ [TeamRoleWizard] ADMIN role assigned - updating project admin status"),L})},I=async()=>{C(!0),E(null);try{console.log(`ðŸš€ [TeamRoleWizard] Starting assignment process for ${te.length} assignments`);const x=wr.getInstance({isWebOnlyMode:!0,apiBaseUrl:"/api"});for(let P=0;P<te.length;P++){const y=te[P],f=se.find(Re=>Re.id===y.roleId),L=J.find(Re=>Re.id===y.memberId);console.log(`ðŸ“‹ [TeamRoleWizard] Processing assignment ${P+1}/${te.length}: ${L==null?void 0:L.name} -> ${f==null?void 0:f.displayName}`);let v=Xe.MEMBER,de=null,Ne=Xe.MEMBER;if((f==null?void 0:f.name)==="ADMIN"?(Ne=Xe.ADMIN,v=Xe.ADMIN):(Ne=Xe.MEMBER,v=Xe.MEMBER),f!=null&&f.isTemplate&&L){console.log(`ðŸŽ­ [TeamRoleWizard] Mapping template role: ${f.displayName}`);const Re={id:f.id,name:f.name,displayName:f.displayName,description:f.description,industry:"FILM_TV",eventTypes:[],category:f.category,hierarchy:f.hierarchy,baseRole:"PRODUCER",permissions:{},raciLevel:"RESPONSIBLE",keyResponsibilities:[],requiredSkills:[],reportingStructure:{},tags:f.tags||[],isPopular:f.isPopular||!1,usageCount:f.usageCount||0,icon:f.icon||"Person",color:f.color||"#1976d2",experienceLevel:"Mid"},Ze=O.mapLicensingRoleToDashboard(Ne,Re,"PRO");de=Ze.dashboardRole,console.log(`âœ… [TeamRoleWizard] Template mapped to Dashboard role: ${de} (hierarchy: ${Ze.effectiveHierarchy})`);try{await W.syncRoleToLicensing(L.id,t,c,Ne,Re,"licensing-wizard"),console.log(`ðŸ”„ [TeamRoleWizard] Role synced to Dashboard for: ${L.name}`)}catch(us){console.warn("âš ï¸ [TeamRoleWizard] Failed to sync role to Dashboard:",us)}}console.log(`ðŸ‘¥ [TeamRoleWizard] Adding team member to project: ${L==null?void 0:L.name} with role: ${v}`);try{if(!await x.addTeamMemberToProject(t,y.memberId,v))throw new Error(`Failed to add ${(L==null?void 0:L.name)||"team member"} to project`);console.log(`âœ… [TeamRoleWizard] Successfully added ${L==null?void 0:L.name} to project`)}catch(Re){console.warn("âš ï¸ [TeamRoleWizard] TeamMemberService failed, trying UnifiedDataService:",Re);try{await Rr.addTeamMemberToProject(t,y.memberId,v),console.log(`âœ… [TeamRoleWizard] Successfully added ${L==null?void 0:L.name} via UnifiedDataService`)}catch(Ze){throw new Error(`Failed to add ${(L==null?void 0:L.name)||"team member"}: ${Ze.message}`)}}}console.log("ðŸŽ‰ [TeamRoleWizard] All assignments completed successfully!"),Q(`Successfully added ${J.length} team member${J.length!==1?"s":""} to the project!`),l&&(console.log("ðŸ”„ [TeamRoleWizard] Notifying parent component to refresh team members"),l()),setTimeout(()=>{a(),ne()},2e3)}catch(x){console.error("âŒ [TeamRoleWizard] Error submitting:",x),E(x.message||"Failed to add team members")}finally{C(!1)}},Y=se.filter(x=>{var P;if(x.name==="ADMIN"){const y=te.some(f=>{const L=se.find(v=>v.id===f.roleId);return(L==null?void 0:L.name)==="ADMIN"});if(ge||y)return!1}if(U==="templates"){if(!x.isTemplate)return!1}else if(U==="custom"){if(x.isTemplate)return!1}else if(U==="popular"&&(!x.isTemplate||!x.isPopular))return!1;if(Oe!=="all"&&x.industry&&x.industry!==Oe)return!1;if(q.trim()){const y=q.toLowerCase(),f=x.displayName.toLowerCase().includes(y),L=x.description.toLowerCase().includes(y),v=((P=x.tags)==null?void 0:P.some(de=>de.toLowerCase().includes(y)))||!1;if(!f&&!L&&!v)return!1}return!0}),be=()=>{switch(i){case 0:return e.jsxs(n,{textAlign:"center",py:4,children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"What would you like to do?"}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:4},children:"Choose an action to get started with team management"}),e.jsxs(p,{container:!0,spacing:3,justifyContent:"center",children:[e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(ue,{sx:{cursor:"pointer",border:oe==="add-members"?2:1,borderColor:oe==="add-members"?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>je("add-members"),children:e.jsxs(ye,{sx:{textAlign:"center",py:4},children:[e.jsx(_r,{sx:{fontSize:48,color:"primary.main",mb:2}}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Add Team Members"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Add new team members to this project and assign them roles"})]})})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(ue,{sx:{cursor:"pointer",border:oe==="manage-roles"?2:1,borderColor:oe==="manage-roles"?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>je("manage-roles"),children:e.jsxs(ye,{sx:{textAlign:"center",py:4},children:[e.jsx(Bs,{sx:{fontSize:48,color:"primary.main",mb:2}}),e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Manage Roles"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:"Create custom roles or use templates for your project"})]})})})]})]});case 1:return e.jsxs(n,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Select Team Members"}),e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:['Choose team members to add to "',r,'"']}),re.length>0&&e.jsx(he,{severity:"info",sx:{mb:3},children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"Current Team:"})," This project already has ",re.length," team member",re.length!==1?"s":""," assigned.",ge&&e.jsx(e.Fragment,{children:" âœ… Project has an admin."}),!ge&&e.jsx(e.Fragment,{children:" âš ï¸ Project needs an admin to be assigned."})]})}),e.jsx(ce,{fullWidth:!0,placeholder:"Search team members...",value:q,onChange:x=>K(x.target.value),InputProps:{startAdornment:e.jsx(Ct,{sx:{mr:1,color:"text.secondary"}})},sx:{mb:3}}),e.jsx(ue,{children:e.jsxs(ye,{children:[e.jsxs(o,{variant:"subtitle1",gutterBottom:!0,children:["Available Team Members (",Ce.length,")"]}),Ce.length===0?e.jsx(he,{severity:"info",children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"No available team members found."}),re.length>0?e.jsx(e.Fragment,{children:" All organization members are already assigned to this project. To reassign a member, please remove them from the project first using the Project Details panel."}):e.jsx(e.Fragment,{children:" No team members are available in your organization. Please add team members to your organization first."})]})}):e.jsx(Ft,{children:Ce.filter(x=>{var P,y;return((P=x.name)==null?void 0:P.toLowerCase().includes(q.toLowerCase()))||((y=x.email)==null?void 0:y.toLowerCase().includes(q.toLowerCase()))}).map(x=>{var P,y;return e.jsxs(Wt,{divider:!0,children:[e.jsx(Ra,{children:e.jsx(Js,{src:x.avatar,children:((P=x.name)==null?void 0:P.charAt(0))||((y=x.email)==null?void 0:y.charAt(0))})}),e.jsx(Ut,{primary:x.name||x.email,secondary:e.jsxs(n,{children:[e.jsx(o,{variant:"body2",color:"text.secondary",children:x.email}),e.jsx(z,{label:x.tier,size:"small",sx:{mt:.5}})]})}),e.jsx($t,{children:e.jsx(Ta,{checked:J.some(f=>f.id===x.id),onChange:()=>Z(x)})})]},x.id)})})]})}),J.length>0&&e.jsx(ue,{sx:{mt:2},children:e.jsxs(ye,{children:[e.jsxs(o,{variant:"subtitle1",gutterBottom:!0,children:["Selected Members (",J.length,")"]}),e.jsx(n,{display:"flex",flexWrap:"wrap",gap:1,children:J.map(x=>{var P,y;return e.jsx(z,{label:x.name||x.email,onDelete:()=>Z(x),avatar:e.jsx(Js,{src:x.avatar,children:((P=x.name)==null?void 0:P.charAt(0))||((y=x.email)==null?void 0:y.charAt(0))})},x.id)})})]})})]});case 2:return e.jsxs(n,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Assign Roles"}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Assign roles to the selected team members from our comprehensive template library"}),!ge&&e.jsx(he,{severity:"warning",sx:{mb:2},children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"âš ï¸ ADMIN Required!"})," This project doesn't have an administrator yet. You must assign the ADMIN role to at least one team member to proceed."]})}),e.jsx(he,{severity:"info",sx:{mb:3},children:e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:"50+ Professional Role Templates Available!"})," Choose from industry-specific roles including Film & TV, Corporate, Live Events, Education, Sports, Streaming, Music, and Marketing. Popular templates are shown by default.",ge&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("strong",{children:"Note:"})," ADMIN role is not available as this project already has an administrator."]})]})}),e.jsxs(n,{sx:{mb:3},children:[e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:12,sm:4,children:e.jsxs(He,{fullWidth:!0,size:"small",children:[e.jsx(Ye,{children:"Role Type"}),e.jsxs(Qe,{value:U,onChange:x=>Se(x.target.value),label:"Role Type",children:[e.jsx(k,{value:"popular",children:"Popular Templates"}),e.jsx(k,{value:"templates",children:"All Templates"}),e.jsx(k,{value:"custom",children:"Custom Roles"}),e.jsx(k,{value:"all",children:"All Roles"})]})]})}),e.jsx(p,{item:!0,xs:12,sm:4,children:e.jsxs(He,{fullWidth:!0,size:"small",children:[e.jsx(Ye,{children:"Industry"}),e.jsxs(Qe,{value:Oe,onChange:x=>Ae(x.target.value),label:"Industry",children:[e.jsx(k,{value:"all",children:"All Industries"}),e.jsx(k,{value:"FILM_TV",children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(fa,{fontSize:"small"}),"Film & TV"]})}),e.jsx(k,{value:"CORPORATE",children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ya,{fontSize:"small"}),"Corporate"]})}),e.jsx(k,{value:"LIVE_EVENTS",children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ja,{fontSize:"small"}),"Live Events"]})}),e.jsx(k,{value:"EDUCATION",children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Ca,{fontSize:"small"}),"Education"]})}),e.jsx(k,{value:"SPORTS",children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(va,{fontSize:"small"}),"Sports"]})}),e.jsx(k,{value:"STREAMING",children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Sa,{fontSize:"small"}),"Streaming"]})}),e.jsx(k,{value:"MUSIC",children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Aa,{fontSize:"small"}),"Music"]})}),e.jsx(k,{value:"MARKETING",children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(wa,{fontSize:"small"}),"Marketing"]})})]})]})}),e.jsx(p,{item:!0,xs:12,sm:4,children:e.jsx(ce,{fullWidth:!0,size:"small",placeholder:"Search roles...",value:q,onChange:x=>K(x.target.value),InputProps:{startAdornment:e.jsx(Ct,{sx:{mr:1,color:"text.secondary"}})}})})]}),e.jsxs(n,{sx:{mt:2,display:"flex",alignItems:"center",gap:1},children:[e.jsxs(o,{variant:"caption",color:"text.secondary",children:["Showing ",Y.length," roles"]}),U==="popular"&&e.jsx(z,{label:"Popular",size:"small",color:"primary"}),Oe!=="all"&&e.jsx(z,{label:Oe.replace("_"," "),size:"small",variant:"outlined",onDelete:()=>Ae("all")}),q&&e.jsx(z,{label:`"${q}"`,size:"small",variant:"outlined",onDelete:()=>K("")})]})]}),J.map(x=>{var f,L;const P=te.find(v=>v.memberId===x.id),y=P?Y.find(v=>v.id===P.roleId):null;return e.jsx(ue,{sx:{mb:2},children:e.jsxs(ye,{children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(Js,{src:x.avatar,children:((f=x.name)==null?void 0:f.charAt(0))||((L=x.email)==null?void 0:L.charAt(0))}),e.jsxs(n,{flex:1,children:[e.jsx(o,{variant:"subtitle1",children:x.name||x.email}),e.jsx(o,{variant:"body2",color:"text.secondary",children:x.email})]})]}),e.jsxs(He,{fullWidth:!0,children:[e.jsx(Ye,{children:"Assign Role"}),e.jsx(Qe,{value:(P==null?void 0:P.roleId)||"",onChange:v=>V(x.id,v.target.value),label:"Assign Role",children:Y.map(v=>e.jsx(k,{value:v.id,sx:{...v.name==="ADMIN"&&!ge&&{backgroundColor:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)","&:hover":{backgroundColor:"rgba(255, 152, 0, 0.2)"}}},children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,width:"100%",children:[e.jsx(n,{sx:{minWidth:24},children:v.name==="ADMIN"?e.jsx(Bs,{fontSize:"small",color:"warning"}):v.icon?e.jsx(o,{sx:{fontSize:"1.2em"},children:v.icon}):e.jsx(Bs,{fontSize:"small",color:"action"})}),e.jsxs(n,{flex:1,children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,mb:.5,children:[e.jsxs(o,{variant:"body1",sx:{fontWeight:v.name==="ADMIN"?600:500,color:v.name==="ADMIN"&&!ge?"warning.main":"inherit"},children:[v.displayName,v.name==="ADMIN"&&!ge&&" âš ï¸ REQUIRED"]}),v.isPopular&&e.jsx(fr,{sx:{fontSize:16,color:"orange"}}),v.isTemplate&&e.jsx(z,{label:"Template",size:"small",sx:{height:16,fontSize:"0.65rem"}})]}),e.jsx(o,{variant:"caption",color:"text.secondary",display:"block",children:v.description}),v.industry&&e.jsxs(o,{variant:"caption",color:"primary.main",children:[v.industry.replace("_"," ")," â€¢ Level ",v.hierarchy]}),v.tags&&v.tags.length>0&&e.jsx(n,{sx:{mt:.5},children:v.tags.slice(0,3).map(de=>e.jsx(z,{label:de,size:"small",variant:"outlined",sx:{height:16,fontSize:"0.6rem",mr:.5,mb:.5}},de))})]}),e.jsxs(n,{textAlign:"right",children:[e.jsx(z,{label:v.category,size:"small",variant:"outlined",sx:{mb:.5}}),v.usageCount&&e.jsxs(o,{variant:"caption",color:"text.secondary",display:"block",children:[v.usageCount," uses"]})]})]})},v.id))})]}),y&&e.jsxs(he,{severity:"info",sx:{mt:2},children:[e.jsxs(o,{variant:"body2",children:[e.jsx("strong",{children:y.displayName})," - Level ",y.hierarchy]}),e.jsx(o,{variant:"caption",children:y.description})]})]})},x.id)})]});case 3:return e.jsxs(n,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Review & Confirm"}),e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Review the team member assignments before confirming"}),e.jsx(ue,{children:e.jsxs(ye,{children:[e.jsxs(o,{variant:"subtitle1",gutterBottom:!0,children:["Project: ",r]}),e.jsxs(o,{variant:"body2",color:"text.secondary",sx:{mb:3},children:["Adding ",J.length," team member",J.length!==1?"s":""]}),J.map(x=>{var f,L;const P=te.find(v=>v.memberId===x.id),y=P?se.find(v=>v.id===P.roleId):null;return e.jsxs(n,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(Js,{src:x.avatar,children:((f=x.name)==null?void 0:f.charAt(0))||((L=x.email)==null?void 0:L.charAt(0))}),e.jsxs(n,{flex:1,children:[e.jsx(o,{variant:"body1",children:x.name||x.email}),e.jsx(o,{variant:"body2",color:"text.secondary",children:x.email})]}),e.jsxs(n,{textAlign:"right",children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:1,justifyContent:"flex-end",mb:.5,children:[(y==null?void 0:y.icon)&&e.jsx(o,{sx:{fontSize:"1em"},children:y.icon}),e.jsx(z,{label:(y==null?void 0:y.displayName)||"No Role",color:y?"primary":"default",size:"small"}),(y==null?void 0:y.isPopular)&&e.jsx(fr,{sx:{fontSize:14,color:"orange"}})]}),e.jsxs(o,{variant:"caption",display:"block",color:"text.secondary",children:[y!=null&&y.isTemplate?"Template Role":"Custom Role"," â€¢ Level ",(y==null?void 0:y.hierarchy)||0]}),(y==null?void 0:y.industry)&&e.jsx(o,{variant:"caption",display:"block",color:"primary.main",children:y.industry.replace("_"," ")}),(y==null?void 0:y.tags)&&y.tags.length>0&&e.jsx(n,{sx:{mt:.5},children:y.tags.slice(0,2).map(v=>e.jsx(z,{label:v,size:"small",variant:"outlined",sx:{height:14,fontSize:"0.6rem",mr:.5}},v))})]})]},x.id)})]})})]});default:return null}};return e.jsxs(ns,{open:u,onClose:a,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsx(is,{children:e.jsxs(n,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(n,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(Ns,{color:"primary"}),e.jsxs(n,{children:[e.jsx(o,{variant:"h6",children:"Team & Role Management"}),e.jsx(o,{variant:"body2",color:"text.secondary",children:r})]})]}),e.jsx(_s,{onClick:a,size:"small",children:e.jsx(st,{})})]})}),e.jsxs(ls,{children:[e.jsx(Pr,{activeStep:i,sx:{mb:4},children:zt.map(x=>e.jsx(kr,{children:e.jsx(Mr,{children:x})},x))}),D&&e.jsx(he,{severity:"error",sx:{mb:3},onClose:()=>E(null),children:D}),_&&e.jsx(he,{severity:"success",sx:{mb:3},children:_}),w&&e.jsx(n,{display:"flex",justifyContent:"center",py:4,children:e.jsx(ds,{})}),!w&&be()]}),e.jsxs(cs,{sx:{p:3,pt:0},children:[e.jsx(F,{onClick:a,disabled:w,children:"Cancel"}),e.jsx(n,{flex:1}),i>0&&e.jsx(F,{onClick:H,disabled:w,startIcon:e.jsx(xa,{}),children:"Back"}),i<zt.length-1?e.jsx(F,{variant:"contained",onClick:$,disabled:w,endIcon:e.jsx(ba,{}),children:"Next"}):e.jsx(F,{variant:"contained",onClick:I,disabled:w||J.length===0,startIcon:e.jsx(ft,{}),children:w?"Adding...":"Add Team Members"})]})]})},Ms=class Ms{constructor(){Me(this,"baseUrl","https://us-central1-backbone-logic.cloudfunctions.net/api")}static getInstance(){return Ms.instance||(Ms.instance=new Ms),Ms.instance}async getAvailableRoles(a){var t,r;try{console.log(`ðŸŽ­ [ProjectRoleService] Fetching available roles for project: ${a}`);let c=0;const l=10;let h;for(;c<l;){const w=(t=window.firebase)==null?void 0:t.auth(),C=w==null?void 0:w.currentUser;if(C){h=await C.getIdToken();break}await new Promise(D=>setTimeout(D,100)),c++}if(!h)throw new Error("User not authenticated - Firebase not ready");const i=await fetch(`${this.baseUrl}/projects/${a}/available-roles`,{method:"GET",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}});if(!i.ok){const w=await i.json().catch(()=>({}));throw new Error(w.error||"Failed to fetch available roles")}const j=await i.json();return console.log(`âœ… [ProjectRoleService] Fetched ${((r=j.data)==null?void 0:r.length)||0} available roles`),j.data||[]}catch(c){throw console.error("âŒ [ProjectRoleService] Error fetching available roles:",c),c}}async addTeamMemberToProject(a,t,r){var c;try{console.log(`ðŸŽ­ [ProjectRoleService] Adding team member ${t} to project ${a} with role ${r}`);let l=0;const h=10;let i;for(;l<h;){const C=(c=window.firebase)==null?void 0:c.auth(),D=C==null?void 0:C.currentUser;if(D){i=await D.getIdToken();break}await new Promise(E=>setTimeout(E,100)),l++}if(!i)throw new Error("User not authenticated - Firebase not ready");const j=await fetch(`${this.baseUrl}/projects/${a}/team-members`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({teamMemberId:t,roleId:r})});if(!j.ok){const C=await j.json().catch(()=>({}));throw new Error(C.error||"Failed to add team member to project")}const w=await j.json();console.log("âœ… [ProjectRoleService] Successfully added team member to project:",w)}catch(l){throw console.error("âŒ [ProjectRoleService] Error adding team member to project:",l),l}}getRoleDisplayColor(a){const t={ADMINISTRATIVE:"#ef4444",PRODUCTION:"#3b82f6",EDITORIAL:"#10b981",TECHNICAL:"#f59e0b",CREATIVE:"#8b5cf6",MANAGEMENT:"#f97316",default:"#6b7280"};return t[a]||t.default}formatRoleDescription(a){const t=a.hierarchy>=80?"High-level":a.hierarchy>=50?"Mid-level":"Entry-level";return`${a.description} (${t} - ${a.hierarchy})`}};Me(Ms,"instance");let Qt=Ms;const xt=Qt.getInstance(),to=u=>{if(!u)return"draft";switch(u.toUpperCase()){case"ACTIVE":return"active";case"INACTIVE":return"draft";case"DRAFT":return"draft";case"COMPLETED":return"completed";case"ARCHIVED":return"archived";case"PAUSED":return"paused";default:return"draft"}},zr=(u,a=0,t=0)=>{var c;if((c=u.metadata)!=null&&c.extendedStatus){const l=u.metadata.extendedStatus;if(["draft","active","in-progress","completed","archived","paused"].includes(l))return l}const r=to(u.status);if(r==="archived"||u.isArchived)return"archived";if(r==="paused")return"paused";if(r==="completed")return"completed";if(r==="active"){const l=a>0,h=t>0,i=u.lastAccessedAt&&new Date().getTime()-new Date(u.lastAccessedAt).getTime()<7*24*60*60*1e3;return l&&h&&i?"in-progress":"active"}return"draft"},ro=u=>{switch(u){case"active":return"success";case"in-progress":return"info";case"completed":return"success";case"draft":return"warning";case"archived":return"default";case"paused":return"warning";default:return"default"}},ao=(u,a={},t={})=>{const r={draft:0,active:0,"in-progress":0,completed:0,archived:0,paused:0};return u.forEach(c=>{const l=a[c.id]||0,h=t[c.id]||0,i=zr(c,l,h);r[i]++}),r},Xs=u=>{var c;if(!u)return 1;let a=0;if(u.licenses&&Array.isArray(u.licenses)){const l=u.licenses.filter(h=>h.status==="ACTIVE"||h.status==="PENDING");a+=l.length}if((c=u.subscription)!=null&&c.plan){const l=u.subscription.plan.toUpperCase();l==="ENTERPRISE"?a+=u.subscription.seats||100:l==="PRO"||l==="PROFESSIONAL"?a+=u.subscription.seats||25:l==="BASIC"&&(a+=u.subscription.seats||5)}if(u.organizationId&&!u.isTeamMember){const l=u.organizationLicenseCount||a;a=Math.max(a,l)}return Math.max(1,Math.min(a,1e3))},Zs=(u,a=0,t=0)=>zr(u,a,t),Jt=(u,a=0)=>{var t;return u.applicationMode==="shared_network"||a>0||((t=u.settings)==null?void 0:t.autoEnableCollaboration)!==!1||u.allowCollaboration===!0?!0:u.allowCollaboration!==!1},Xt=(u,a=0,t=0)=>{let r=0,c=0;if(u.name&&u.description?r+=20:u.name&&(r+=10),c+=20,a>0&&(r+=Math.min(30,a*10)),c+=30,t>0&&(r+=Math.min(25,t*5)),c+=25,u.lastAccessedAt){const l=(new Date().getTime()-new Date(u.lastAccessedAt).getTime())/864e5;l<=1?r+=25:l<=7?r+=15:l<=30&&(r+=5)}return c+=25,Math.min(100,Math.round(r/c*100))},oo=u=>ro(u),no=u=>{switch(u){case"draft":return e.jsx(zs,{});case"active":return e.jsx(Gt,{});case"in-progress":return e.jsx(Os,{});case"completed":return e.jsx(Zt,{});case"archived":return e.jsx(Ht,{});case"paused":return e.jsx(za,{});default:return e.jsx(zs,{})}},io=(u,a=0,t=0,r)=>{var j,w,C,D,E,_,Q,oe,je,Ce,R,J,ve,se,pe,te,xe,re,ie,ge;console.log("ðŸ” [DashboardCloudProjectsBridge] Mapping project:",u.name),console.log("ðŸ” [DashboardCloudProjectsBridge] Raw project data:",u),console.log("ðŸ” [DashboardCloudProjectsBridge] Team member count:",a),console.log("ðŸ” [DashboardCloudProjectsBridge] Dataset count:",t);const c=Zs(u,a,t),l=Jt(u,a),h=Xt(u,a,t),i=u.lastActivityAt||u.lastAccessedAt||u.updatedAt;return console.log("ðŸ” [DashboardCloudProjectsBridge] Calculated status:",c),console.log("ðŸ” [DashboardCloudProjectsBridge] Collaboration enabled:",l),console.log("ðŸ” [DashboardCloudProjectsBridge] Completion percentage:",h),{id:u.id,name:u.name,description:u.description,applicationMode:((j=u.settings)==null?void 0:j.applicationMode)||"shared_network",storageBackend:((w=u.settings)==null?void 0:w.storageBackend)||"firestore",gcsBucket:(C=u.settings)==null?void 0:C.gcsBucket,gcsPrefix:(D=u.settings)==null?void 0:D.gcsPrefix,s3Bucket:(E=u.settings)==null?void 0:E.s3Bucket,s3Region:(_=u.settings)==null?void 0:_.s3Region,s3Prefix:(Q=u.settings)==null?void 0:Q.s3Prefix,azureStorageAccount:(oe=u.settings)==null?void 0:oe.azureStorageAccount,azureContainer:(je=u.settings)==null?void 0:je.azureContainer,azurePrefix:(Ce=u.settings)==null?void 0:Ce.azurePrefix,lastAccessedAt:u.lastAccessedAt||new Date().toISOString(),isActive:c!=="archived"&&c!=="paused",isArchived:c==="archived",allowCollaboration:l,maxCollaborators:((R=u.settings)==null?void 0:R.maxCollaborators)||Xs(r),realTimeEnabled:((J=u.settings)==null?void 0:J.realTimeEnabled)||l,status:c,completionPercentage:h,lastActivityAt:i,teamMemberCount:a,collaborationEnabled:l,settings:{...u.settings,autoEnableCollaboration:((ve=u.settings)==null?void 0:ve.autoEnableCollaboration)??!0,completionCriteria:{requiresDatasets:!0,requiresTeamMembers:!0,minimumActivity:1,...(se=u.settings)==null?void 0:se.completionCriteria}},teamMemberRole:(te=(pe=u.teamMembers)==null?void 0:pe[0])==null?void 0:te.role,role:(re=(xe=u.teamMembers)==null?void 0:xe[0])==null?void 0:re.role,assignedAt:(ge=(ie=u.teamMembers)==null?void 0:ie[0])==null?void 0:ge.assignedAt,projectOwner:u.ownerId}},vo=()=>{var mr,hr,pr,xr;const{user:u}=Dr(),{setLoading:a}=aa(),t=m.useCallback(()=>{if(!u)return null;const s=localStorage.getItem("auth_user");let d={...u};if(s)try{const g=JSON.parse(s);d={...u,...g,isTeamMember:g.isTeamMember||u.isTeamMember||g.role==="TEAM_MEMBER",organizationId:g.organizationId||u.organizationId,memberRole:g.memberRole||u.memberRole,memberStatus:g.memberStatus||u.memberStatus,teamMemberData:g.teamMemberData||u.teamMemberData}}catch(g){console.warn("Failed to parse stored user from localStorage:",g)}if(!d.subscription){const g=localStorage.getItem("user_subscription");if(g)try{const A=JSON.parse(g);d.subscription=A}catch(A){console.warn("Failed to parse subscription data from localStorage:",A)}const S=localStorage.getItem("user_billing");if(S&&!d.subscription)try{const A=JSON.parse(S);A.subscription&&(d.subscription=A.subscription)}catch(A){console.warn("Failed to parse billing data from localStorage:",A)}}return d},[u]),r=m.useMemo(()=>t(),[t]),c=m.useCallback(()=>{if(!r)return!1;if(r.memberRole==="OWNER"||r.role==="SUPERADMIN"||r.role==="ADMIN"||String(r.role).includes("ENTERPRISE"))return console.log("ðŸ” [DashboardCloudProjectsBridge] User is account owner - NOT a team member"),!1;const s=r.isTeamMember===!0||r.role==="TEAM_MEMBER";if(!s){const d=localStorage.getItem("team_member_data");if(d)try{const g=JSON.parse(d);if(g.memberRole==="OWNER"||g.role==="SUPERADMIN"||g.role==="ADMIN"||String(g.role).includes("ENTERPRISE"))return console.log("ðŸ” [DashboardCloudProjectsBridge] localStorage shows account owner - NOT a team member"),!1}catch(g){console.warn("Failed to parse team member data:",g)}}return console.log("ðŸ” [DashboardCloudProjectsBridge] User is team member:",s),s},[r]),l=m.useCallback(()=>{var d,g,S,A;if(!r)return console.log("ðŸ” [DashboardCloudProjectsBridge] No complete user data available"),!1;if(console.log("ðŸ” [DashboardCloudProjectsBridge] Checking permissions for user:",{id:r.id,email:r.email,role:r.role,memberRole:r.memberRole,isTeamMember:r.isTeamMember,organizationId:r.organizationId,subscription:r.subscription}),r.memberRole==="ENTERPRISE_ADMIN"||r.role==="ENTERPRISE_ADMIN"||String(r.role).includes("ENTERPRISE"))return console.log("âœ… [DashboardCloudProjectsBridge] User is enterprise user or admin, can create projects"),!0;if(!c())return((d=r.subscription)==null?void 0:d.status)==="ACTIVE"||((g=r.subscription)==null?void 0:g.status)==="TRIALING"||r.role==="SUPERADMIN"||r.role==="ADMIN"?(console.log("âœ… [DashboardCloudProjectsBridge] User is account owner with active subscription, can create projects"),!0):(S=r.subscription)!=null&&S.plan&&["BASIC","PRO","ENTERPRISE"].includes(r.subscription.plan)?(console.log("âœ… [DashboardCloudProjectsBridge] User is account owner with subscription plan, can create projects"),!0):r.isDemoUser||localStorage.getItem("demo_user_status")==="ACTIVE"?(console.log("âœ… [DashboardCloudProjectsBridge] User is demo user, can create projects"),!0):(console.log("âš ï¸ [DashboardCloudProjectsBridge] User is account owner but no active subscription or demo status"),!0);if(r.memberRole==="ADMIN"||r.role==="ADMIN")return console.log("âœ… [DashboardCloudProjectsBridge] Team member has ADMIN role, can create projects"),!0;const s=localStorage.getItem("team_member_data");if(s)try{const N=JSON.parse(s);if(console.log("ðŸ” [DashboardCloudProjectsBridge] Team member data from localStorage:",N),N.role==="ADMIN"||N.memberRole==="ADMIN"||N.role==="TEAM_ADMIN")return console.log("âœ… [DashboardCloudProjectsBridge] Team member data shows ADMIN role, can create projects"),!0}catch(N){console.warn("Failed to parse team member data for permissions check:",N)}return r.memberRole==="OWNER"||r.role==="OWNER"||String(r.memberRole).includes("OWNER")?(console.log("âœ… [DashboardCloudProjectsBridge] User has OWNER role, can create projects"),!0):r.role==="SUPERADMIN"?(console.log("âœ… [DashboardCloudProjectsBridge] User is SUPERADMIN, can create projects"),!0):(A=r.subscription)!=null&&A.plan&&["BASIC","PRO","ENTERPRISE"].includes(r.subscription.plan)?(console.log("âœ… [DashboardCloudProjectsBridge] User has subscription plan, allowing project creation"),!0):r.subscription?(console.log("âœ… [DashboardCloudProjectsBridge] User has subscription data, allowing project creation"),!0):(console.log("âŒ [DashboardCloudProjectsBridge] User cannot create projects - regular team member without admin privileges"),!1)},[r,c]),[h,i]=m.useState([]),[j,w]=m.useState(!0),[C,D]=m.useState(null),[E,_]=m.useState(0),[Q,oe]=m.useState(!1),[je,Ce]=m.useState(!1),[R,J]=m.useState(null),[ve,se]=m.useState([]),[pe,te]=m.useState(!1),[xe,re]=m.useState([]),[ie,ge]=m.useState([]),[_e,O]=m.useState(!1),[W,q]=m.useState(""),[K,U]=m.useState("all"),[Se,Oe]=m.useState(""),[Ae,De]=m.useState({}),[Pe,b]=m.useState(!1),[B,$]=m.useState(null),[H,ne]=m.useState(0),[Z,V]=m.useState(!1),[I,Y]=m.useState(null),[be,x]=m.useState(!1),[P,y]=m.useState(!1),[f,L]=m.useState(null),[v,de]=m.useState(!1),[Ne,Re]=m.useState(!1),[Ze,us]=m.useState(null),[fe,ys]=m.useState(null),[rt,js]=m.useState(!1),[T,me]=m.useState(!1),[ze,Be]=m.useState(!1),[es,ss]=m.useState([]),[Cs,Ls]=m.useState([]),[Je,ke]=m.useState(!1),[Ee,ts]=m.useState(""),[gs,Ve]=m.useState(""),[ms,vs]=m.useState([]),[Ss,Fs]=m.useState(!1),[hs,Ws]=m.useState(""),[Us,St]=m.useState(!1),[At,sr]=m.useState(!1),[tr,wt]=m.useState(null),[Le,at]=m.useState(""),[Rt,Tt]=m.useState(0),[ot,Br]=m.useState(10),[We,Lr]=m.useState("lastAccessedAt"),[ps,Fr]=m.useState("desc"),[xs,rr]=m.useState({}),[$s,nt]=m.useState({}),[ar,or]=m.useState({}),[nr,ir]=m.useState(null),it=m.useCallback(async s=>{try{te(!0),console.log("ðŸ” [DashboardCloudProjectsBridge] Loading datasets for project:",s.id);const d=await le.getProjectDatasets(s.id);console.log("âœ… [DashboardCloudProjectsBridge] Loaded assigned datasets:",d),se(d),De(g=>({...g,[s.id]:d.length}));try{const g=await le.listDatasets({backend:K==="all"?void 0:K,query:Se||void 0});console.log("âœ… [DashboardCloudProjectsBridge] Loaded available datasets:",g),console.log("ðŸ” [DashboardCloudProjectsBridge] === DATASET DEBUG INFO ==="),g.forEach((M,ee)=>{var X;console.log(`ðŸ” [DashboardCloudProjectsBridge] Dataset ${ee}:`,{id:M.id,name:M.name,organizationId:M.organizationId,storage:M.storage,idType:typeof M.id,idLength:(X=M.id)==null?void 0:X.length,fullDataset:M})}),console.log("ðŸ” [DashboardCloudProjectsBridge] === END DATASET DEBUG ===");const S=g.filter(M=>!M.id||typeof M.id!="string"||M.id.trim()==="");S.length>0&&console.warn("âš ï¸ [DashboardCloudProjectsBridge] Found datasets with invalid IDs:",S);const A=g.find(M=>M.id==="dataset-001");A?console.log("âœ… [DashboardCloudProjectsBridge] dataset-001 found:",A):(console.warn("âš ï¸ [DashboardCloudProjectsBridge] dataset-001 NOT found in available datasets!"),console.log("ðŸ” [DashboardCloudProjectsBridge] Available dataset IDs:",g.map(M=>M.id)));const N=g.map(M=>{var X;const ee=ae=>{switch(ae){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...M,__label:`${M.name} ${ee((X=M.storage)==null?void 0:X.backend)}`}});W&&!N.find(M=>M.id===W)&&(console.warn("âš ï¸ [DashboardCloudProjectsBridge] Clearing invalid selected dataset:",W),q("")),re(N)}catch(g){console.warn("âš ï¸ [DashboardCloudProjectsBridge] Failed to load available datasets, using empty list:",g),re([])}}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load datasets for project:",d),se([]),re([])}finally{te(!1)}},[K,Se]),As=m.useCallback(async s=>{try{ke(!0),console.log("ðŸ” [DashboardCloudProjectsBridge] Loading team members for project:",s.id);try{const d=await le.getProjectTeamMembers(s.id);console.log("âœ… [DashboardCloudProjectsBridge] Loaded assigned team members:",d),ss(d)}catch(d){console.warn("âš ï¸ [DashboardCloudProjectsBridge] Failed to load assigned team members, using empty list:",d),ss([])}try{const d=await le.getLicensedTeamMembers({search:hs||void 0,excludeProjectId:s.id});console.log("âœ… [DashboardCloudProjectsBridge] Loaded available team members:",d),Ls(d)}catch(d){console.warn("âš ï¸ [DashboardCloudProjectsBridge] Failed to load licensed team members, using empty list:",d),Ls([])}}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load team members for project:",d),ss([]),Ls([])}finally{ke(!1)}},[hs]);m.useEffect(()=>{R&&(console.log("ðŸ”„ [DashboardCloudProjectsBridge] Project selected, loading data..."),it(R),As(R))},[R,it,As]),m.useEffect(()=>{R&&Us&&!Ss&&ms.length===0&&(async()=>{try{Fs(!0),console.log("ðŸŽ­ [DashboardCloudProjectsBridge] Loading available roles for project:",R.id);const d=await xt.getAvailableRoles(R.id);if(console.log(`âœ… [DashboardCloudProjectsBridge] Found ${(d==null?void 0:d.length)||0} available roles`),vs(d||[]),d&&d.length>0){const g=d.find(S=>S.name==="DO_ER")||d[0];Ve(g.id)}}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load available roles:",d),vs([])}finally{Fs(!1)}})()},[R,Us,Ss,ms.length]),m.useEffect(()=>{rs();const s=d=>{rs()};return window.addEventListener("project:created",s),()=>window.removeEventListener("project:created",s)},[]);const Wr=(s,d)=>s==="desc"?(g,S)=>lr(g,S,d):(g,S)=>-lr(g,S,d),lr=(s,d,g)=>{const S=s[g],A=d[g];return S==null&&A==null?0:S==null?1:A==null||A<S?-1:A>S?1:0},Gs=s=>{Fr(We===s&&ps==="asc"?"desc":"asc"),Lr(s)},lt=m.useMemo(()=>{let s=h;if(Le.trim()){const d=Le.toLowerCase();s=h.filter(g=>g.name.toLowerCase().includes(d)||g.description&&g.description.toLowerCase().includes(d)||g.storageBackend.toLowerCase().includes(d)||g.applicationMode.toLowerCase().includes(d))}return s.sort(Wr(ps,We))},[h,Le,ps,We]);m.useEffect(()=>{Tt(0)},[Le]);const Hs=m.useMemo(()=>{console.log("ðŸ” [DashboardCloudProjectsBridge] Filtering projects for tab:",E),console.log("ðŸ” [DashboardCloudProjectsBridge] All filtered projects:",lt);const s=lt.filter(d=>{const g=E===0,S=g?d.isActive&&!d.isArchived:d.isArchived;return console.log(`ðŸ” [DashboardCloudProjectsBridge] Project "${d.name}":`,{isActive:d.isActive,isArchived:d.isArchived,isActiveTab:g,shouldShow:S}),S});return console.log("ðŸ” [DashboardCloudProjectsBridge] Filtered projects for display:",s),s},[lt,E]),Ur=m.useMemo(()=>{const s=Rt*ot;return Hs.slice(s,s+ot)},[Hs,Rt,ot]);m.useEffect(()=>{if(R&&Us){const s=setTimeout(()=>{console.log("ðŸ”„ [DashboardCloudProjectsBridge] Team member search changed, refreshing..."),As(R)},300);return()=>clearTimeout(s)}},[hs,R,Us,As]),m.useCallback(async s=>{try{console.log("ðŸ” [DashboardCloudProjectsBridge] Loading team member counts for all projects...");const d=s.map(async A=>{try{const N=await le.getProjectTeamMembers(A.id);return{projectId:A.id,count:N.length}}catch(N){return console.warn(`âš ï¸ [DashboardCloudProjectsBridge] Failed to load team members for project ${A.id}:`,N),{projectId:A.id,count:0}}}),g=await Promise.all(d),S={};g.forEach(({projectId:A,count:N})=>{S[A]=N}),rr(S),console.log("âœ… [DashboardCloudProjectsBridge] Loaded team member counts for all projects:",S)}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load team member counts for all projects:",d)}},[]);const ct=m.useCallback(async s=>{try{console.log("ðŸ” [DashboardCloudProjectsBridge] Loading dataset counts for all projects...");try{const g=(await le.getAllOrganizationDatasets()).length,S={};s.forEach(A=>{S[A.id]=g}),De(S),console.log(`âœ… [DashboardCloudProjectsBridge] Loaded total dataset count for organization: ${g}`)}catch{console.warn("âš ï¸ [DashboardCloudProjectsBridge] Failed to load organization datasets, falling back to per-project counts");const g=s.map(async N=>{try{const M=await le.getProjectDatasets(N.id);return{projectId:N.id,count:M.length}}catch(M){return console.warn(`âš ï¸ [DashboardCloudProjectsBridge] Failed to load datasets for project ${N.id}:`,M),{projectId:N.id,count:0}}}),S=await Promise.all(g),A={};S.forEach(({projectId:N,count:M})=>{A[N]=M}),De(A),console.log("âœ… [DashboardCloudProjectsBridge] Loaded dataset counts for all projects (fallback):",A)}}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load dataset counts for all projects:",d)}},[]),rs=async()=>{try{if(D(null),w(!0),c())try{console.log("ðŸ” [DashboardCloudProjectsBridge] Web-only mode: Fetching projects from Firestore...");const s=u;if(!(s!=null&&s.organizationId))throw console.warn("âš ï¸ [DashboardCloudProjectsBridge] No organization ID found for user"),new Error("No organization found for user");const{db:d}=await br(async()=>{const{db:G}=await import("./firebase-irz6tycV.js");return{db:G}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),{collection:g,query:S,where:A,getDocs:N}=await br(async()=>{const{collection:G,query:qe,where:Rs,getDocs:as}=await import("./index.esm-9jaBBmwp.js");return{collection:G,query:qe,where:Rs,getDocs:as}},__vite__mapDeps([7,6])),M=S(g(d,"projects"),A("organizationId","==",s.organizationId)),ee=await N(M);console.log(`ðŸ” [DashboardCloudProjectsBridge] Found ${ee.size} projects for organization: ${s.organizationId}`);const X=ee.docs.map(G=>({id:G.id,projectId:G.id,...G.data(),name:G.data().name||G.data().projectName||"Unnamed Project",projectName:G.data().name||G.data().projectName||"Unnamed Project",description:G.data().description||"",role:"MEMBER",teamMemberRole:"MEMBER",isActive:G.data().isActive!==!1,isArchived:G.data().isArchived===!0,assignedAt:G.data().createdAt||new Date().toISOString(),lastAccessed:G.data().lastAccessedAt||G.data().createdAt||new Date().toISOString(),ownerName:G.data().ownerName||"Organization Owner"}));console.log("ðŸ” [DashboardCloudProjectsBridge] Team member projects from Firestore:",X);const ae=X.map(G=>{console.log("ðŸ” [DashboardCloudProjectsBridge] Transforming project:",G);const qe=1,Rs=0,as=Zs(G,qe,Rs),Ue=Jt(G,qe),gt=Xt(G,qe,Rs),fs={id:G.projectId||G.id,name:G.projectName||G.name||"Unnamed Project",description:G.description||"",applicationMode:"shared_network",storageBackend:"firestore",lastAccessedAt:G.lastAccessed||G.assignedAt||new Date().toISOString(),isActive:as!=="archived"&&as!=="paused",isArchived:as==="archived",allowCollaboration:Ue,maxCollaborators:G.maxCollaborators||Xs(r),realTimeEnabled:Ue,status:as,completionPercentage:gt,lastActivityAt:G.lastAccessed||G.assignedAt||new Date().toISOString(),teamMemberCount:qe,collaborationEnabled:Ue,settings:{autoEnableCollaboration:!0,completionCriteria:{requiresDatasets:!0,requiresTeamMembers:!0,minimumActivity:1}},teamMemberRole:G.role||G.teamMemberRole||"MEMBER",role:G.role||G.teamMemberRole||"MEMBER",assignedAt:G.assignedAt,projectOwner:G.ownerName||"Organization Owner"};return console.log("ðŸ” [DashboardCloudProjectsBridge] Transformed to:",fs),fs});i(ae),await ct(ae)}catch(s){console.error("Failed to fetch team member projects:",s);const d=localStorage.getItem("team_member_data");if(d)try{const A=JSON.parse(d);if(A.projectAccess&&Array.isArray(A.projectAccess)){const N=A.projectAccess.map(M=>{const ae=Zs(M,1,0),G=Jt(M,1),qe=Xt(M,1,0);return{id:M.projectId,name:M.projectName||"Unnamed Project",description:M.description||"",applicationMode:"shared_network",storageBackend:"firestore",lastAccessedAt:M.lastAccessed||new Date().toISOString(),isActive:ae!=="archived"&&ae!=="paused",isArchived:ae==="archived",allowCollaboration:G,maxCollaborators:Xs(r),realTimeEnabled:G,status:ae,completionPercentage:qe,lastActivityAt:M.lastAccessed||new Date().toISOString(),teamMemberCount:1,collaborationEnabled:G,settings:{autoEnableCollaboration:!0,completionCriteria:{requiresDatasets:!0,requiresTeamMembers:!0,minimumActivity:1}},teamMemberRole:M.role||"MEMBER",assignedAt:M.assignedAt,projectOwner:"Organization Owner"}});i(N),await ct(N);return}}catch(A){console.warn("Failed to parse fallback team member data:",A)}const S=Object.keys(localStorage).filter(A=>A.includes("team")||A.includes("member")||A.includes("project")||A.includes("assignment"));for(const A of S)try{const N=localStorage.getItem(A);if(N){const M=JSON.parse(N);M.projects||M.projectAccess||M.assignments}}catch{}D("Unable to load your assigned projects. Please contact your administrator or try again later."),i([])}else{console.log("ðŸ” [DashboardCloudProjectsBridge] Loading projects for account owner...");const s=await le.getProjects();console.log("ðŸ” [DashboardCloudProjectsBridge] Raw service projects:",s),console.log("ðŸ” [DashboardCloudProjectsBridge] Service projects count:",s.length),console.log("ðŸ” [DashboardCloudProjectsBridge] Loading team member and dataset counts...");const d=s.map(async X=>{try{const ae=await le.getProjectTeamMembers(X.id);return{projectId:X.id,count:ae.length}}catch(ae){return console.warn(`âš ï¸ [DashboardCloudProjectsBridge] Failed to load team members for project ${X.id}:`,ae),{projectId:X.id,count:0}}}),g=s.map(async X=>{try{const ae=await le.getProjectDatasets(X.id);return{projectId:X.id,count:ae.length}}catch(ae){return console.warn(`âš ï¸ [DashboardCloudProjectsBridge] Failed to load datasets for project ${X.id}:`,ae),{projectId:X.id,count:0}}}),[S,A]=await Promise.all([Promise.all(d),Promise.all(g)]),N={},M={};S.forEach(({projectId:X,count:ae})=>{N[X]=ae}),A.forEach(({projectId:X,count:ae})=>{M[X]=ae}),rr(N),De(M);const ee=s.map(X=>io(X,N[X.id]||0,M[X.id]||0,r));console.log("ðŸ” [DashboardCloudProjectsBridge] Mapped cloud projects with enhanced data:",ee),console.log("ðŸ” [DashboardCloudProjectsBridge] Mapped projects count:",ee.length),i(ee),console.log("âœ… [DashboardCloudProjectsBridge] Projects set in state with enhanced status and collaboration logic")}}catch(s){console.error("Failed to load projects:",s),D((s==null?void 0:s.message)||"Failed to load projects"),i([])}finally{w(!1)}},$r=async()=>{try{const s="https://backbone-client.web.app/";let d=!1;try{const g=document.createElement("a");g.href=s,g.target="_blank",g.rel="noopener noreferrer",document.body.appendChild(g),g.click(),document.body.removeChild(g),d=!0}catch{}d||(window.location.href=s)}catch(s){console.error("Failed to launch web app",s),D("Unable to open web app. Please try again.")}},Gr=()=>{try{const g="dashboardv14://open-app";window.location.href=g}catch(s){console.error("Failed to open desktop deep link",s),D("Unable to open Desktop app. Please ensure it is installed.")}},cr=()=>{oe(!0),J(null)},Hr=(s,d)=>{Tt(d)},Vr=s=>{Br(parseInt(s.target.value,10)),Tt(0)},qr=(s,d)=>{or(g=>({...g,[d]:s.currentTarget}))},bs=s=>{or(d=>({...d,[s]:null}))},Kr=s=>{ir(s.currentTarget)},ws=()=>{ir(null)},Yr=async s=>{oe(!1),await rs()},Vs=m.useCallback(async(s,d)=>{try{nt(S=>({...S,[s]:!0}));let g;switch(d){case"draft":g="draft";break;case"active":case"in-progress":case"completed":g="active";break;case"archived":case"paused":g="archived";break;default:g="active"}await le.updateProject(s,{status:g,lastActivityAt:new Date().toISOString(),isActive:g!=="archived",isArchived:g==="archived",metadata:{extendedStatus:d,statusUpdatedAt:new Date().toISOString()}}),await rs(),console.log(`âœ… [DashboardCloudProjectsBridge] Project ${s} status updated to ${d} (mapped to ${g})`)}catch(g){console.error("âŒ [DashboardCloudProjectsBridge] Failed to update project status:",g),D(`Failed to update project status: ${g instanceof Error?g.message:"Unknown error"}`)}finally{nt(g=>({...g,[s]:!1}))}},[]),Qr=m.useCallback(async(s,d)=>{try{nt(S=>({...S,[s]:!0}));const g=Xs(r);await le.updateProject(s,{settings:{allowCollaboration:d,autoEnableCollaboration:d,realTimeEnabled:d,maxCollaborators:d?g:1},allowCollaboration:d,collaborationEnabled:d,realTimeEnabled:d,maxCollaborators:d?g:1,lastActivityAt:new Date().toISOString()}),await rs(),console.log(`âœ… [DashboardCloudProjectsBridge] Project ${s} collaboration ${d?"enabled":"disabled"}`)}catch(g){console.error("âŒ [DashboardCloudProjectsBridge] Failed to toggle collaboration:",g),D(`Failed to update collaboration settings: ${g instanceof Error?g.message:"Unknown error"}`)}finally{nt(g=>({...g,[s]:!1}))}},[]),Jr=s=>{switch(s){case"firestore":return e.jsx(et,{});case"gcs":return e.jsx(Ge,{});default:return e.jsx(Bt,{})}},Xr=s=>s==="standalone"?e.jsx(Bt,{}):e.jsx(Pt,{}),Zr=s=>{const d=new Date(s),S=new Date().getTime()-d.getTime(),A=Math.floor(S/(1e3*60*60*24));return A===0?"Today":A===1?"Yesterday":A<7?`${A} days ago`:d.toLocaleDateString()},Dt=ao(h,xs,Ae),dr=h.filter(s=>{const d=xs[s.id]||0,g=Ae[s.id]||0,S=Zs(s,d,g);return S==="active"||S==="in-progress"}),ur=h.filter(s=>{const d=xs[s.id]||0,g=Ae[s.id]||0;return Zs(s,d,g)==="archived"}),dt={totalProjects:h.length,activeProjects:Dt.active+Dt["in-progress"],archivedProjects:Dt.archived,collaborativeProjects:h.filter(s=>s.allowCollaboration).length,totalDatasets:Object.values(Ae).reduce((s,d)=>s+d,0),storageBreakdown:{firestore:h.filter(s=>s.storageBackend==="firestore").length,gcs:h.filter(s=>s.storageBackend==="gcs").length,s3:h.filter(s=>s.storageBackend==="s3").length,local:h.filter(s=>s.storageBackend==="local").length,azure:h.filter(s=>s.storageBackend==="azure-blob").length},modeBreakdown:{standalone:h.filter(s=>s.applicationMode==="standalone").length,network:h.filter(s=>s.applicationMode==="shared_network").length}},ea=m.useCallback(async()=>{h.length>0&&await ct(h)},[h,ct]),ut=m.useCallback(async()=>{try{O(!0),console.log("ðŸ” [DashboardCloudProjectsBridge] Loading organization datasets for management dialog...");const s=await le.getAllOrganizationDatasets();console.log("âœ… [DashboardCloudProjectsBridge] Loaded organization datasets:",s);const d=s.map(g=>{var A;const S=N=>{switch(N){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...g,__label:`${g.name} ${S((A=g.storage)==null?void 0:A.backend)}`}});ge(d)}catch(s){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load organization datasets:",s)}finally{O(!1)}},[]);m.useEffect(()=>{be&&ut()},[be,ut]);const qs=m.useCallback(async()=>{if(!(r!=null&&r.organizationId)){console.warn("âš ï¸ [DashboardCloudProjectsBridge] No organization ID for dataset analysis");return}de(!0);try{console.log("ðŸ” [DashboardCloudProjectsBridge] Loading dataset conflict analysis...");let s=ie;s.length===0&&(console.log("ðŸ”„ [DashboardCloudProjectsBridge] Loading organization datasets for analysis..."),s=await le.getAllOrganizationDatasets(),s=s.map(g=>{var A;const S=N=>{switch(N){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...g,__label:`${g.name} ${S((A=g.storage)==null?void 0:A.backend)}`}})),console.log("ðŸ“Š [DashboardCloudProjectsBridge] Analyzing datasets:",{totalDatasets:s.length,firestoreDatasets:s.filter(g=>{var S;return((S=g.storage)==null?void 0:S.backend)==="firestore"}).length,datasetsWithCollections:s.filter(g=>{var S,A;return((A=(S=g.collectionAssignment)==null?void 0:S.selectedCollections)==null?void 0:A.length)>0}).length});const d=await er.analyzeOrganizationDatasets(r.organizationId,s);L(d),console.log("âœ… [DashboardCloudProjectsBridge] Dataset analysis complete:",{datasets:d.totalDatasets,collections:d.totalCollections,overlaps:d.overlaps.length,healthScore:d.healthScore,recommendations:d.globalInsights.recommendations.length})}catch(s){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load dataset analysis:",s),L(null)}finally{de(!1)}},[r==null?void 0:r.organizationId,ie]);m.useEffect(()=>{P&&qs()},[P,qs]);const gr=m.useCallback(()=>{if(!r){console.log("ðŸ” [DashboardCloudProjectsBridge] No user data available for subscription debug");return}console.log("ðŸ” [DashboardCloudProjectsBridge] === SUBSCRIPTION DEBUG INFO ==="),console.log("User ID:",r.id),console.log("User Email:",r.email),console.log("User Role:",r.role),console.log("Member Role:",r.memberRole),console.log("Is Team Member:",r.isTeamMember),console.log("Organization ID:",r.organizationId),console.log("Subscription Data:",r.subscription),console.log("Demo User Status:",r.isDemoUser),console.log("LocalStorage Demo Status:",localStorage.getItem("demo_user_status")),console.log("LocalStorage Subscription:",localStorage.getItem("user_subscription")),console.log("LocalStorage Billing:",localStorage.getItem("user_billing")),console.log("==========================================")},[r]);return m.useEffect(()=>{if(r&&r.id){const s=`subscription_debug_${r.id}`;sessionStorage.getItem(s)||(gr(),sessionStorage.setItem(s,"true"))}},[r,gr]),e.jsxs(n,{sx:{py:4,px:3},children:[e.jsx(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:e.jsxs(n,{children:[e.jsx(o,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:c()?"My Assigned Projects":"Cloud Projects"}),e.jsx(o,{variant:"body1",color:"text.secondary",children:c()?l()?"Manage and collaborate on projects. As an admin, you can create new projects and access assigned ones.":"Access and collaborate on projects assigned to you by your team administrator":"Manage your projects with Firebase and Google Cloud Storage integration. Available for all license tiers: Basic, Pro, and Enterprise."}),c()&&r&&e.jsxs(n,{sx:{mt:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(z,{icon:e.jsx(yr,{}),label:`Team Member - ${r.memberRole||"MEMBER"}`,color:"primary",size:"small",sx:{backgroundColor:"rgba(0, 212, 255, 0.1)",border:"1px solid rgba(0, 212, 255, 0.3)",color:"primary.main"}}),r.organizationId&&e.jsx(z,{icon:e.jsx(Da,{}),label:"Organization Access",color:"secondary",size:"small",sx:{backgroundColor:"rgba(156, 39, 176, 0.1)",border:"1px solid rgba(156, 39, 176, 0.3)",color:"secondary.main"}})]})]})}),j?e.jsx(p,{container:!0,spacing:3,sx:{mb:4},children:[1,2,3,4].map(s=>e.jsx(p,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(ue,{sx:{height:"100%"},children:e.jsx(ye,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(n,{sx:{width:60,height:32,bgcolor:"grey.300",borderRadius:1,mb:1}}),e.jsx(n,{sx:{width:100,height:16,bgcolor:"grey.200",borderRadius:1}})]}),e.jsx(n,{sx:{width:40,height:40,bgcolor:"grey.200",borderRadius:"50%"}})]})})})},s))}):e.jsxs(p,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(p,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(ue,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(102, 126, 234, 0.3)"}},children:e.jsx(ye,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(o,{variant:"h4",fontWeight:"bold",children:dt.totalProjects}),e.jsx(o,{variant:"body2",sx:{opacity:.9},children:c()?"Assigned Projects":"Total Projects"})]}),e.jsx(Os,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(p,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(ue,{sx:{background:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(17, 153, 142, 0.3)"}},onClick:()=>_(0),children:e.jsx(ye,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(o,{variant:"h4",fontWeight:"bold",children:dt.activeProjects}),e.jsx(o,{variant:"body2",sx:{opacity:.9},children:"Active Projects"})]}),e.jsx(Gt,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(p,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(ue,{sx:{background:"linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(252, 74, 26, 0.3)"}},onClick:()=>_(1),children:e.jsx(ye,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(o,{variant:"h4",fontWeight:"bold",children:dt.archivedProjects}),e.jsx(o,{variant:"body2",sx:{opacity:.9},children:"Archived Projects"})]}),e.jsx(Ht,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(p,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(ue,{sx:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(79, 172, 254, 0.3)"}},children:e.jsx(ye,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{children:[e.jsx(o,{variant:"h4",fontWeight:"bold",children:c()&&r?(r.memberRole||"MEMBER").toUpperCase():dt.collaborativeProjects}),e.jsx(o,{variant:"body2",sx:{opacity:.9},children:c()?"Your Role":"Collaborative"})]}),e.jsx(Ns,{sx:{fontSize:40,opacity:.8}})]})})})})]}),j?e.jsx(p,{container:!0,spacing:3,sx:{mb:4},children:[1,2].map(s=>e.jsx(p,{item:!0,xs:12,lg:6,children:e.jsx(ue,{sx:{height:"100%"},children:e.jsxs(ye,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(n,{sx:{width:24,height:24,bgcolor:"grey.300",borderRadius:"50%"}}),e.jsx(n,{sx:{width:200,height:20,bgcolor:"grey.300",borderRadius:1}})]}),[1,2,3].map(d=>e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{sx:{width:20,height:20,bgcolor:"grey.200",borderRadius:"50%"}}),e.jsx(n,{sx:{width:80,height:16,bgcolor:"grey.200",borderRadius:1}})]}),e.jsx(n,{sx:{width:40,height:24,bgcolor:"grey.200",borderRadius:1}})]},d))]})})},s))}):null,C&&e.jsx(he,{severity:"error",sx:{mb:4},onClose:()=>D(null),children:C}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[e.jsxs(Ea,{value:E,onChange:(s,d)=>_(d),sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(jr,{label:`Active Projects (${dr.length})`}),e.jsx(jr,{label:`Archived (${ur.length})`})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[!l()&&r&&e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,px:2,py:1,backgroundColor:"warning.light",borderRadius:1,border:"1px solid",borderColor:"warning.main"},children:[e.jsx(zs,{color:"warning"}),e.jsx(o,{variant:"body2",color:"warning.dark",children:c()?"Contact your team administrator to create projects":"Active subscription required to create projects"})]}),e.jsx(F,{variant:"contained",startIcon:e.jsx(Cr,{}),onClick:Kr,sx:{background:"linear-gradient(135deg, #4f46e5, #7c3aed)",color:"white",borderRadius:2,px:3,py:1.5,textTransform:"none",fontWeight:600,boxShadow:"0 6px 20px rgba(79, 70, 229, 0.4)","&:hover":{background:"linear-gradient(135deg, #4338ca, #6d28d9)",boxShadow:"0 8px 25px rgba(79, 70, 229, 0.5)",transform:"translateY(-2px)"}},children:"Actions"}),e.jsxs(vr,{anchorEl:nr,open:!!nr,onClose:ws,PaperProps:{sx:{backgroundColor:"rgba(30, 30, 30, 0.95)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:2,minWidth:200,"& .MuiMenuItem-root":{color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}}}},children:[l()&&e.jsxs(k,{onClick:()=>{ws(),console.log("ðŸš€ [DashboardCloudProjectsBridge] Create Project button clicked"),cr()},children:[e.jsx(Ds,{sx:{mr:2}}),"Create Project"]}),l()&&e.jsxs(k,{onClick:()=>{ws(),console.log("ðŸš€ [DashboardCloudProjectsBridge] Create Dataset button clicked"),Y(null),V(!0)},children:[e.jsx($e,{sx:{mr:2}}),"Create Dataset"]}),l()&&e.jsxs(k,{onClick:()=>{ws(),console.log("ðŸš€ [DashboardCloudProjectsBridge] Manage Datasets button clicked"),x(!0)},children:[e.jsx(Ge,{sx:{mr:2}}),"Manage Datasets"]}),l()&&e.jsxs(k,{onClick:()=>{ws(),console.log("ðŸš€ [DashboardCloudProjectsBridge] Dataset Insights button clicked"),y(!0)},children:[e.jsx(Os,{sx:{mr:2}}),"Dataset Insights"]}),e.jsx(k,{disabled:!0,sx:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",my:1}}),e.jsxs(k,{onClick:()=>{ws(),$r()},children:[e.jsx(Sr,{sx:{mr:2}}),"Launch Web App"]}),e.jsxs(k,{onClick:()=>{ws(),Gr()},children:[e.jsx(Sr,{sx:{mr:2}}),"Launch Desktop App"]})]})]})]}),e.jsxs(n,{sx:{mb:4,display:"flex",gap:3,alignItems:"center"},children:[e.jsx(ce,{fullWidth:!0,placeholder:"Search projects by name, description, storage backend, or mode...",value:Le,onChange:s=>at(s.target.value),InputProps:{startAdornment:e.jsx(Er,{position:"start",children:e.jsx(Ct,{})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,"&:hover fieldset":{borderColor:"primary.main"}}}}),e.jsx(F,{variant:"outlined",onClick:rs,sx:{minWidth:"auto",px:3},title:"Refresh projects list",children:"Refresh"})]}),e.jsxs(n,{children:[c()&&h.length>0&&e.jsx(n,{sx:{mb:3,p:3,backgroundColor:"rgba(0, 212, 255, 0.1)",borderRadius:2,border:"1px solid rgba(0, 212, 255, 0.3)"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(yr,{sx:{color:"primary.main",fontSize:24}}),e.jsxs(n,{children:[e.jsx(o,{variant:"h6",color:"primary.main",sx:{fontWeight:600,mb:1},children:"Team Member Access"}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:["You have access to ",h.length," project",h.length!==1?"s":""," assigned by your team administrator. Click on any project to view details and launch the application."]})]})]})}),j?e.jsx(n,{sx:{textAlign:"center",py:4},children:e.jsx(o,{children:"Loading projects..."})}):e.jsxs(e.Fragment,{children:[Le&&e.jsx(n,{sx:{mb:2,p:2,backgroundColor:"primary.light",borderRadius:2,color:"white"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{variant:"body2",children:["Found ",lt.filter(s=>E===0?s.isActive&&!s.isArchived:s.isArchived).length,' projects matching "',Le,'"']}),e.jsx(F,{size:"small",variant:"text",onClick:()=>at(""),sx:{color:"white",textDecoration:"underline"},children:"Clear Search"})]})}),e.jsx(Ia,{component:Ke,sx:{borderRadius:2,overflow:"auto",boxShadow:2,maxHeight:"70vh",width:"100%"},children:e.jsxs(Pa,{sx:{width:"100%"},stickyHeader:!0,children:[e.jsx(ka,{children:e.jsxs(Ar,{sx:{backgroundColor:"primary.main"},children:[e.jsx(we,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:e.jsx(Ks,{active:We==="name",direction:We==="name"?ps:"asc",onClick:()=>Gs("name"),sx:{color:"white","& .MuiTableSortLabel-icon":{color:"white"}},children:"Project"})}),e.jsx(we,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:e.jsx(Ks,{active:We==="status",direction:We==="status"?ps:"asc",onClick:()=>Gs("status"),sx:{color:"white","& .MuiTableSortLabel-icon":{color:"white"}},children:"Status"})}),e.jsx(we,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:e.jsx(Ks,{active:We==="applicationMode",direction:We==="applicationMode"?ps:"asc",onClick:()=>Gs("applicationMode"),sx:{color:"white","& .MuiTableSortLabel-icon":{color:"white"}},children:"Mode"})}),e.jsx(we,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:e.jsx(Ks,{active:We==="storageBackend",direction:We==="storageBackend"?ps:"asc",onClick:()=>Gs("storageBackend"),sx:{color:"white","& .MuiTableSortLabel-icon":{color:"white"}},children:"Storage"})}),c()&&e.jsx(we,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Your Role"}),e.jsx(we,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Team"}),e.jsx(we,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Datasets"}),e.jsx(we,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Collaboration"}),e.jsx(we,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:e.jsx(Ks,{active:We==="lastAccessedAt",direction:We==="lastAccessedAt"?ps:"asc",onClick:()=>Gs("lastAccessedAt"),sx:{color:"white","& .MuiTableSortLabel-icon":{color:"white"}},children:"Last Accessed"})}),e.jsx(we,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Actions"})]})}),e.jsx(Ma,{children:Ur.map(s=>e.jsxs(Ar,{sx:{"&:hover":{backgroundColor:"action.hover",cursor:"pointer"},"&:nth-of-type(odd)":{backgroundColor:"action.hover"}},children:[e.jsx(we,{children:e.jsx(o,{variant:"subtitle1",fontWeight:600,children:s.name})}),e.jsx(we,{children:e.jsx(z,{size:"small",icon:no(s.status),label:s.status.charAt(0).toUpperCase()+s.status.slice(1).replace("-"," "),color:oo(s.status),variant:"filled",sx:{fontWeight:600}})}),e.jsx(we,{children:e.jsx(z,{size:"small",icon:Xr(s.applicationMode),label:s.applicationMode==="standalone"?"Standalone":"Network",color:"primary",variant:"outlined"})}),e.jsx(we,{children:e.jsx(z,{size:"small",icon:Jr(s.storageBackend),label:s.storageBackend,variant:"outlined"})}),c()&&e.jsx(we,{children:e.jsx(z,{size:"small",label:s.teamMemberRole||s.role||"MEMBER",color:"primary",variant:"outlined",sx:{backgroundColor:"rgba(0, 212, 255, 0.1)",borderColor:"rgba(0, 212, 255, 0.3)",color:"primary.main",fontWeight:600}})}),e.jsx(we,{children:typeof xs[s.id]=="number"?e.jsx(z,{size:"small",icon:e.jsx(Ns,{}),label:`${xs[s.id]} member${xs[s.id]!==1?"s":""}`,variant:"outlined",color:xs[s.id]>0?"primary":"default",title:`${xs[s.id]} team members assigned to this project`}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(we,{children:typeof Ae[s.id]=="number"?e.jsx(z,{size:"small",icon:e.jsx($e,{}),label:`${Ae[s.id]} dataset${Ae[s.id]!==1?"s":""}`,variant:"outlined",color:Ae[s.id]>0?"secondary":"default",title:`${Ae[s.id]} datasets assigned to this project`}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(we,{children:s.collaborationEnabled?e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(z,{size:"small",icon:e.jsx(Ns,{}),label:"Enabled",variant:"outlined",color:"success",sx:{fontWeight:600},title:"Collaboration is enabled for this project"}),s.realTimeEnabled&&e.jsx(z,{size:"small",label:"Real-time",variant:"filled",color:"info",sx:{fontSize:"0.7rem",height:"20px"}})]}):e.jsx(z,{size:"small",label:"Disabled",variant:"outlined",color:"default",sx:{color:"text.secondary"}})}),e.jsx(we,{children:e.jsx(o,{variant:"body2",children:Zr(s.lastAccessedAt)})}),e.jsx(we,{children:e.jsxs(n,{sx:{display:"flex",justifyContent:"center"},children:[e.jsx(_s,{size:"small",onClick:d=>qr(d,s.id),sx:{color:"text.secondary","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:e.jsx(Cr,{})}),e.jsxs(vr,{anchorEl:ar[s.id],open:!!ar[s.id],onClose:()=>bs(s.id),anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:2,minWidth:200,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)"}},children:[e.jsxs(k,{onClick:()=>{J(s),bs(s.id)},sx:{py:1.5},children:[e.jsx(Ir,{sx:{mr:2,fontSize:20}}),e.jsx(o,{variant:"body2",children:"Details"})]}),s.status==="draft"&&e.jsxs(k,{onClick:()=>{Vs(s.id,"active"),bs(s.id)},disabled:$s[s.id],sx:{py:1.5},children:[e.jsx(It,{sx:{mr:2,fontSize:20,color:"success.main"}}),e.jsx(o,{variant:"body2",children:"Activate"})]}),s.status==="active"&&e.jsxs(k,{onClick:()=>{Vs(s.id,"in-progress"),bs(s.id)},disabled:$s[s.id],sx:{py:1.5},children:[e.jsx(It,{sx:{mr:2,fontSize:20,color:"info.main"}}),e.jsx(o,{variant:"body2",children:"Start"})]}),s.status==="in-progress"&&e.jsxs(k,{onClick:()=>{Vs(s.id,"completed"),bs(s.id)},disabled:$s[s.id],sx:{py:1.5},children:[e.jsx(ft,{sx:{mr:2,fontSize:20,color:"success.main"}}),e.jsx(o,{variant:"body2",children:"Complete"})]}),e.jsxs(k,{onClick:()=>{Qr(s.id,!s.collaborationEnabled),bs(s.id)},disabled:$s[s.id],sx:{py:1.5},children:[s.collaborationEnabled?e.jsx(_a,{sx:{mr:2,fontSize:20,color:"warning.main"}}):e.jsx(It,{sx:{mr:2,fontSize:20,color:"success.main"}}),e.jsx(o,{variant:"body2",children:s.collaborationEnabled?"Disable Collab":"Enable Collab"})]}),e.jsxs(k,{onClick:async()=>{try{s.isArchived?await Vs(s.id,"active"):await Vs(s.id,"archived"),bs(s.id)}catch(d){console.error("Failed to toggle archive",d),D("Failed to update project")}},disabled:$s[s.id],sx:{py:1.5},children:[e.jsx(Ht,{sx:{mr:2,fontSize:20,color:s.isArchived?"success.main":"warning.main"}}),e.jsx(o,{variant:"body2",children:s.isArchived?"Restore":"Archive"})]}),e.jsxs(k,{onClick:async()=>{try{window.confirm(`Are you sure you want to permanently delete "${s.name}"? This action cannot be undone and will remove all project data, datasets, and team member assignments.`)&&(a(!0),await le.deleteProject(s.id)?(console.log(`âœ… [DashboardCloudProjectsBridge] Project "${s.name}" deleted successfully`),await rs(),D(null)):D(`Failed to delete project "${s.name}". Please try again.`)),bs(s.id)}catch(d){console.error("Failed to delete project:",d),D(`Failed to delete project "${s.name}": ${d instanceof Error?d.message:"Unknown error"}`)}finally{a(!1)}},sx:{py:1.5,color:"error.main","&:hover":{backgroundColor:"error.light",color:"error.dark"}},children:[e.jsx(Qs,{sx:{mr:2,fontSize:20}}),e.jsx(o,{variant:"body2",children:"Delete"})]})]})]})})]},s.id))})]})}),e.jsx(Oa,{component:"div",count:Hs.length,page:Rt,onPageChange:Hr,rowsPerPage:ot,onRowsPerPageChange:Vr,rowsPerPageOptions:[5,10,25,50],sx:{mt:2}})]}),!j&&Hs.length===0&&e.jsxs(n,{sx:{textAlign:"center",py:8},children:[e.jsx(et,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(o,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:Le?"No projects found matching your search":E===0?"No active projects yet":"No archived projects"}),e.jsx(o,{variant:"body2",color:"text.secondary",paragraph:!0,children:Le?"Try adjusting your search terms or browse all projects":E===0?c()?l()?"No projects assigned yet. As a team admin, you can create new projects or wait for assignments from your organization administrator.":"No projects have been assigned to you yet. Contact your team administrator to get access to projects.":l()?"Create your first cloud project to get started with Firebase and GCS integration":"You need an active subscription to create projects. Please upgrade your account or contact support.":"Archived projects will appear here"}),E===0&&!Le&&l()&&e.jsx(F,{variant:"contained",startIcon:e.jsx(Ds,{}),onClick:cr,size:"large",sx:{fontWeight:"bold",px:4,py:1.5,fontSize:"1.1rem",boxShadow:3,"&:hover":{boxShadow:6,transform:"translateY(-2px)"},transition:"all 0.3s ease-in-out"},children:"Create Your First Project"}),E===0&&!Le&&c()&&!l()&&e.jsxs(n,{sx:{mt:2},children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"ðŸ’¡ Team members without admin privileges cannot create projects. Projects must be assigned by your administrator."}),e.jsx(F,{variant:"outlined",onClick:rs,size:"large",sx:{mt:1},children:"Refresh Projects"})]}),E===0&&!Le&&!c()&&((r==null?void 0:r.memberRole)==="ENTERPRISE_ADMIN"||(r==null?void 0:r.role)==="ENTERPRISE_ADMIN")&&e.jsx(n,{sx:{mt:2},children:e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"ðŸŽ¯ As an Enterprise Admin, you can create new projects and manage your organization's project portfolio."})}),Le&&e.jsx(F,{variant:"outlined",onClick:()=>at(""),size:"large",sx:{mr:2},children:"Clear Search"})]}),!j&&Le&&Hs.length===0&&(E===0?dr:ur).length>0&&e.jsxs(n,{sx:{textAlign:"center",py:4},children:[e.jsx(o,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No projects match your search criteria"}),e.jsx(o,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Try different search terms or browse all projects in this tab"}),e.jsx(F,{variant:"outlined",onClick:()=>at(""),size:"large",children:"Clear Search"})]})]}),e.jsx(Ba,{open:Q,onClose:()=>{oe(!1)},mode:"shared_network",onSuccess:Yr,maxCollaborators:Xs(r),onCreate:async s=>await La.createProject(s)}),e.jsxs(ns,{open:!!R,onClose:()=>{J(null)},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)",overflow:"hidden"}},children:[e.jsx(is,{sx:{background:"linear-gradient(135deg, #0f3460 0%, #16213e 100%)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",p:3,position:"relative","&::after":{content:'""',position:"absolute",bottom:0,left:0,right:0,height:"2px",background:"linear-gradient(90deg, #4f46e5, #06b6d4, #3b82f6)",borderRadius:"1px"}},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(n,{sx:{width:48,height:48,borderRadius:"50%",background:"linear-gradient(135deg, #4f46e5, #06b6d4)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 16px rgba(79, 70, 229, 0.3)"},children:e.jsx(Na,{sx:{color:"white",fontSize:24}})}),e.jsxs(n,{children:[e.jsx(o,{variant:"h5",sx:{color:"white",fontWeight:700,textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)"},children:"Project Details"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:(R==null?void 0:R.name)||"Project Configuration"})]})]})}),e.jsx(ls,{sx:{p:0,background:"transparent"},children:R&&e.jsxs(n,{sx:{p:3},children:[e.jsxs(n,{sx:{mb:4},children:[e.jsxs(o,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",boxShadow:"0 0 8px rgba(139, 92, 246, 0.5)"}}),"Project Details"]}),e.jsx(n,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.2)",borderColor:"rgba(139, 92, 246, 0.3)"}},children:(R==null?void 0:R.description)&&e.jsxs(n,{sx:{mb:3},children:[e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)",mb:1,fontWeight:500},children:"Description"}),e.jsx(o,{variant:"body1",sx:{color:"white",lineHeight:1.6},children:R.description})]})})]}),e.jsxs(n,{children:[e.jsxs(o,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #f59e0b, #f97316)",boxShadow:"0 0 8px rgba(245, 158, 11, 0.5)"}}),"Assigned Datasets"]}),e.jsxs(n,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsx(n,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:e.jsx(F,{variant:"outlined",onClick:async()=>{if(R){console.log("ðŸ”„ [DashboardCloudProjectsBridge] Refreshing datasets for project:",R.id);try{te(!0),await it(R),console.log("âœ… [DashboardCloudProjectsBridge] Datasets refreshed successfully")}catch(s){console.error("âŒ [DashboardCloudProjectsBridge] Failed to refresh datasets:",s),D("Failed to refresh datasets")}finally{te(!1)}}},disabled:pe,sx:{borderColor:"rgba(79, 70, 229, 0.5)",color:"#4f46e5",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#4f46e5",backgroundColor:"rgba(79, 70, 229, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:pe?"Refreshing...":"Refresh"})}),e.jsxs(p,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(p,{item:!0,xs:12,sm:3,children:e.jsxs(He,{fullWidth:!0,size:"small",children:[e.jsx(Ye,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Backend"}),e.jsxs(Qe,{value:K==="all"?"firestore":K,onChange:s=>U(s.target.value),sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(79, 70, 229, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white","& .MuiMenuItem-root":{color:"white"}},children:[e.jsx(k,{value:"firestore",children:"Firestore"}),e.jsx(k,{value:"gcs",children:"Google Cloud Storage"}),e.jsx(k,{value:"s3",children:"Amazon S3"}),e.jsx(k,{value:"aws",children:"AWS Services"}),e.jsx(k,{value:"azure",children:"Microsoft Azure"})]})]})}),e.jsx(p,{item:!0,xs:12,sm:4,children:e.jsx(ce,{fullWidth:!0,size:"small",placeholder:"Search datasets...",value:Se,onChange:s=>Oe(s.target.value),sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(79, 70, 229, 0.5)"},"& input::placeholder":{color:"rgba(255, 255, 255, 0.5)",opacity:1}}}})}),e.jsx(p,{item:!0,xs:12,sm:3,children:e.jsxs(He,{fullWidth:!0,size:"small",children:[e.jsx(Ye,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Select dataset"}),e.jsxs(Qe,{value:W,onChange:s=>{const d=s.target.value;console.log("ðŸ” [DashboardCloudProjectsBridge] Dataset selection changed:",{oldValue:W,newValue:d,valueType:typeof d,availableDatasetIds:xe.map(g=>g.id)}),q(d)},sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(79, 70, 229, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white","& .MuiMenuItem-root":{color:"white"}},children:[e.jsx(k,{value:"",children:"Select dataset..."}),xe.map(s=>e.jsx(k,{value:s.id,children:s.__label||s.name},s.id))]})]})}),e.jsx(p,{item:!0,xs:12,sm:2,children:e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(F,{variant:"contained",size:"small",disabled:!W||pe,onClick:async()=>{if(!R||!W)return;const s=xe.find(d=>d.id===W);if(console.log("ðŸ” [DashboardCloudProjectsBridge] Selected dataset details:",{selectedDatasetId:W,selectedDataset:s,availableDatasetsCount:xe.length,availableDatasetIds:xe.map(d=>d.id)}),!s){console.error("âŒ [DashboardCloudProjectsBridge] Selected dataset not found in available datasets:",{selectedDatasetId:W,availableDatasetIds:xe.map(d=>d.id)}),D(`Selected dataset (${W}) not found. Please try selecting a different dataset.`);return}console.log("ðŸ”— [DashboardCloudProjectsBridge] Assigning dataset to project:",{projectId:R.id,datasetId:W});try{te(!0),await le.assignDatasetToProject(R.id,W),console.log("âœ… [DashboardCloudProjectsBridge] Dataset assigned successfully");const d=await le.getProjectDatasets(R.id);se(d),De(A=>({...A,[R.id]:d.length}));const S=(await le.listDatasets({backend:K==="all"?void 0:K,query:Se||void 0})).map(A=>{var M;const N=ee=>{switch(ee){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...A,__label:`${A.name} ${N((M=A.storage)==null?void 0:M.backend)}`}});re(S),q(""),console.log("âœ… [DashboardCloudProjectsBridge] Dataset assignment completed and lists refreshed")}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to assign dataset:",d),D("Failed to assign dataset to project")}finally{te(!1)}},sx:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",borderRadius:2,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)","&:hover":{background:"linear-gradient(135deg, #059669, #047857)",boxShadow:"0 6px 20px rgba(16, 185, 129, 0.4)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)",boxShadow:"none"}},children:pe?"Assigning...":"Assign"}),e.jsx(F,{variant:"outlined",size:"small",onClick:async()=>{if(R){console.log("ðŸ” [DashboardCloudProjectsBridge] Applying dataset filters:",{backend:K,search:Se});try{te(!0);const s=await le.listDatasets({backend:K==="all"?void 0:K,query:Se||void 0});console.log("âœ… [DashboardCloudProjectsBridge] Filtered datasets loaded:",s);const d=s.map(S=>{var N;const A=M=>{switch(M){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...S,__label:`${S.name} ${A((N=S.storage)==null?void 0:N.backend)}`}});re(d);const g=await le.getProjectDatasets(R.id);se(g),De(S=>({...S,[R.id]:g.length})),console.log("âœ… [DashboardCloudProjectsBridge] Filters applied successfully")}catch(s){console.error("âŒ [DashboardCloudProjectsBridge] Failed to apply filters:",s),D("Failed to apply dataset filters")}finally{te(!1)}}},disabled:pe,sx:{borderColor:"rgba(79, 70, 229, 0.5)",color:"#4f46e5",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#4f46e5",backgroundColor:"rgba(79, 70, 229, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:pe?"Applying...":"Apply Filters"})]})})]}),e.jsxs(n,{children:[e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2,fontWeight:500},children:"Currently Assigned Datasets"}),ve.length===0?e.jsxs(n,{sx:{p:4,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx($e,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No datasets assigned to this project"})]}):e.jsx(n,{sx:{borderRadius:2,overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.1)"},children:ve.map((s,d)=>{var g,S,A;return e.jsxs(n,{sx:{p:2,background:d%2===0?"rgba(255, 255, 255, 0.02)":"rgba(255, 255, 255, 0.05)",borderBottom:d<ve.length-1?"1px solid rgba(255, 255, 255, 0.1)":"none",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease","&:hover":{background:"rgba(79, 70, 229, 0.1)",transform:"translateX(4px)"}},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(n,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #f59e0b, #f97316)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx($e,{sx:{color:"white",fontSize:16}})}),e.jsxs(n,{children:[e.jsx(o,{variant:"body1",sx:{color:"white",fontWeight:500},children:s.name}),s.description&&e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:s.description}),((g=s.storage)==null?void 0:g.backend)==="firestore"&&((A=(S=s.collectionAssignment)==null?void 0:S.selectedCollections)==null?void 0:A.length)>0&&e.jsxs(n,{sx:{mt:1},children:[e.jsx(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",display:"block",mb:.5},children:"Assigned Collections:"}),e.jsxs(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[s.collectionAssignment.selectedCollections.slice(0,3).map(N=>e.jsx(z,{label:N,size:"small",sx:{height:18,fontSize:"0.65rem",backgroundColor:"rgba(245, 158, 11, 0.2)",color:"#fbbf24",border:"1px solid rgba(245, 158, 11, 0.3)"}},N)),s.collectionAssignment.selectedCollections.length>3&&e.jsx(z,{label:`+${s.collectionAssignment.selectedCollections.length-3} more`,size:"small",sx:{height:18,fontSize:"0.65rem",backgroundColor:"rgba(156, 163, 175, 0.2)",color:"#9ca3af"}})]}),s.collectionAssignment.organizationScope&&e.jsx(o,{variant:"caption",sx:{color:"rgba(16, 185, 129, 0.8)",display:"block",mt:.5,fontSize:"0.65rem"},children:"âœ“ Organization scoped for data isolation"})]})]})]}),e.jsx(n,{sx:{display:"flex",gap:1},children:e.jsx(F,{variant:"outlined",size:"small",startIcon:e.jsx(Qs,{}),onClick:async()=>{try{console.log("ðŸ—‘ï¸ [DashboardCloudProjectsBridge] Removing dataset from project:",{projectId:R.id,datasetId:s.id}),await le.unassignDatasetFromProject(R.id,s.id),console.log("âœ… [DashboardCloudProjectsBridge] Dataset removed successfully"),se(ee=>ee.filter(X=>X.id!==s.id)),De(ee=>({...ee,[R.id]:Math.max(0,(ee[R.id]||1)-1)}));const M=(await le.listDatasets({backend:K==="all"?void 0:K,query:Se||void 0})).map(ee=>{var ae;const X=G=>{switch(G){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...ee,__label:`${ee.name} ${X((ae=ee.storage)==null?void 0:ae.backend)}`}});re(M),console.log("âœ… [DashboardCloudProjectsBridge] Dataset removal completed and lists refreshed")}catch(N){console.error("âŒ [DashboardCloudProjectsBridge] Failed to remove dataset:",N),D("Failed to remove dataset from project")}},sx:{borderColor:"rgba(239, 68, 68, 0.5)",color:"#ef4444",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",transform:"scale(1.05)"}},children:"Remove"})})]},s.id)})})]})]})]}),e.jsxs(n,{sx:{mt:4},children:[e.jsxs(o,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(n,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",boxShadow:"0 0 8px rgba(139, 92, 246, 0.5)"}}),"Team Members"]}),e.jsxs(n,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsxs(n,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:[e.jsx(F,{variant:"contained",startIcon:e.jsx(Ns,{}),onClick:()=>Be(!0),sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(139, 92, 246, 0.3)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 6px 20px rgba(139, 92, 246, 0.4)",transform:"translateY(-1px)"}},children:"Team & Roles"}),e.jsx(F,{variant:"outlined",onClick:async()=>{if(R){console.log("ðŸ”„ [DashboardCloudProjectsBridge] Refreshing team members for project:",R.id);try{ke(!0),await As(R),console.log("âœ… [DashboardCloudProjectsBridge] Team members refreshed successfully")}catch(s){console.error("âŒ [DashboardCloudProjectsBridge] Failed to refresh team members:",s),D("Failed to refresh team members")}finally{ke(!1)}}},disabled:Je,sx:{borderColor:"rgba(139, 92, 246, 0.5)",color:"#8b5cf6",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:Je?"Refreshing...":"Refresh"})]}),e.jsxs(n,{children:[e.jsxs(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)",mb:2,fontWeight:500},children:["Project Team Members (",es.length,")"]}),es.length===0?e.jsxs(n,{sx:{p:4,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx(Pt,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No team members assigned to this project"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.4)",mt:1},children:"Add licensed team members to collaborate on this project"})]}):e.jsx(n,{sx:{borderRadius:2,overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.1)"},children:es.map((s,d)=>{var M,ee,X,ae,G,qe,Rs,as;console.log("ðŸ” [DashboardCloudProjectsBridge] Team member structure:",s);let g="Unnamed User";s.name&&s.name!=="Unnamed User"?(g=s.name,console.log("ðŸŽ¯ [DashboardCloudProjectsBridge] Using enriched name from TeamMemberService:",g)):(M=s.teamMember)!=null&&M.name&&s.teamMember.name!=="Unnamed User"?(g=s.teamMember.name,console.log("ðŸŽ¯ [DashboardCloudProjectsBridge] Using nested teamMember name:",g)):(ee=s.teamMember)!=null&&ee.firstName&&((X=s.teamMember)!=null&&X.lastName)?(g=`${s.teamMember.firstName} ${s.teamMember.lastName}`,console.log("ðŸŽ¯ [DashboardCloudProjectsBridge] Constructed from nested firstName + lastName:",g)):(ae=s.teamMember)!=null&&ae.firstName?(g=s.teamMember.firstName,console.log("ðŸŽ¯ [DashboardCloudProjectsBridge] Using nested firstName:",g)):(s.email||(G=s.teamMember)!=null&&G.email)&&(g=(s.email||s.teamMember.email).split("@")[0].replace(/[._-]/g," ").split(" ").map(fs=>fs.charAt(0).toUpperCase()+fs.slice(1).toLowerCase()).join(" "),console.log("ðŸŽ¯ [DashboardCloudProjectsBridge] Extracted from email:",g)),console.log("ðŸ” [DashboardCloudProjectsBridge] Final display name:",g);const S=s.email||((qe=s.teamMember)==null?void 0:qe.email)||"No email",A=s.role||((Rs=s.teamMember)==null?void 0:Rs.role)||"Member",N=((as=s.teamMember)==null?void 0:as.licenseType)||s.licenseType;return e.jsxs(n,{sx:{p:3,background:d%2===0?"rgba(255, 255, 255, 0.02)":"rgba(255, 255, 255, 0.05)",borderBottom:d<es.length-1?"1px solid rgba(255, 255, 255, 0.1)":"none",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease","&:hover":{background:"rgba(139, 92, 246, 0.1)",transform:"translateX(4px)"}},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(n,{sx:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",fontWeight:600,color:"white"},children:g.charAt(0).toUpperCase()}),e.jsxs(n,{children:[e.jsx(o,{variant:"body1",sx:{color:"white",fontWeight:500},children:g}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:S}),e.jsxs(n,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(z,{size:"small",label:A,sx:{backgroundColor:"rgba(139, 92, 246, 0.2)",color:"#c4b5fd",fontSize:"11px"}}),N&&e.jsx(z,{size:"small",label:N,sx:{backgroundColor:"rgba(16, 185, 129, 0.2)",color:"#6ee7b7",fontSize:"11px"}})]})]})]}),e.jsx(F,{variant:"outlined",size:"small",startIcon:e.jsx(Qs,{}),onClick:async()=>{try{const Ue=s.teamMemberId||s.id;if(!Ue){console.error("No valid team member ID found:",s),alert("Error: Invalid team member ID");return}await le.removeTeamMemberFromProject(R.id,Ue),ss(gt=>gt.filter(fs=>(fs.teamMemberId||fs.id)!==Ue))}catch(Ue){console.error("Failed to remove team member",Ue),alert(`Failed to remove team member: ${(Ue==null?void 0:Ue.message)||"Unknown error"}`)}},sx:{borderColor:"rgba(239, 68, 68, 0.5)",color:"#ef4444",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",transform:"scale(1.05)"}},children:"Remove"})]},s.id)})})]})]})]})]})}),e.jsx(cs,{sx:{p:3,background:"rgba(255, 255, 255, 0.02)",borderTop:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"space-between"},children:e.jsx(F,{onClick:()=>J(null),variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})})]}),e.jsx(oa,{children:e.jsx(Ka,{open:Z,onClose:()=>{V(!1),Y(null)},onSuccess:s=>{R&&it(R),rs()},assignToProject:I||void 0})}),e.jsxs(ns,{open:Us,onClose:()=>St(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"}},children:[e.jsx(is,{sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",p:3},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(n,{sx:{width:40,height:40,borderRadius:"50%",background:"rgba(255, 255, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ds,{sx:{color:"white"}})}),e.jsxs(n,{children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600},children:"Add Team Member"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:"Add licensed team members to this project"})]})]})}),e.jsxs(ls,{sx:{p:3,background:"transparent"},children:[tr&&e.jsx(he,{severity:"error",sx:{mb:3},children:tr}),e.jsxs(n,{sx:{mb:3},children:[e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2},children:"Search and select from your licensed team members:"}),e.jsx(ce,{fullWidth:!0,placeholder:"Search team members by name or email...",value:hs,onChange:s=>Ws(s.target.value),sx:{mb:2,"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(139, 92, 246, 0.5)"},"& input::placeholder":{color:"rgba(255, 255, 255, 0.5)",opacity:1}}}}),e.jsxs(He,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Ye,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Select Team Member"}),e.jsxs(Qe,{value:Ee,onChange:s=>ts(s.target.value),disabled:Je,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(139, 92, 246, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white"},children:[e.jsx(k,{value:"",children:e.jsx("em",{children:Je?"Loading team members...":"Select a team member..."})}),!Je&&Cs.length===0&&e.jsx(k,{disabled:!0,children:e.jsx(o,{component:"em",sx:{color:"rgba(255, 255, 255, 0.5)"},children:hs?"No team members found matching your search":"No available team members found"})}),!Je&&Cs.map(s=>{var g;let d="Unnamed User";return s.name?d=s.name:s.fullName?d=s.fullName:s.displayName?d=s.displayName:s.firstName&&s.lastName?d=`${s.firstName} ${s.lastName}`:s.firstName?d=s.firstName:s.lastName?d=s.lastName:s.email&&(d=s.email.split("@")[0]),e.jsx(k,{value:s.id,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[e.jsx(n,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:600,color:"white"},children:((g=d.charAt(0))==null?void 0:g.toUpperCase())||"U"}),e.jsxs(n,{sx:{flexGrow:1},children:[e.jsx(o,{variant:"body2",sx:{fontWeight:500,color:"white"},children:d}),e.jsxs(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:[s.email," â€¢ ",s.licenseType||"Licensed"]})]})]})},s.id)})]})]}),e.jsxs(He,{fullWidth:!0,children:[e.jsx(Ye,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Project Role"}),e.jsx(Qe,{value:gs,onChange:s=>Ve(s.target.value),disabled:Ss,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(139, 92, 246, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white"},children:Ss?e.jsx(k,{disabled:!0,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ds,{size:16,sx:{color:"rgba(255, 255, 255, 0.6)"}}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Loading roles..."})]})}):ms.length===0?e.jsx(k,{disabled:!0,children:e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"No roles available"})}):ms.map(s=>e.jsx(k,{value:s.id,children:e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(o,{variant:"body2",sx:{fontWeight:500,color:"white"},children:s.displayName}),e.jsx(z,{label:s.category,size:"small",sx:{height:16,fontSize:"0.65rem",backgroundColor:xt.getRoleDisplayColor(s.category),color:"white"}})]}),e.jsx(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)"},children:xt.formatRoleDescription(s)})]})},s.id))})]})]}),Cs.length===0&&!Je&&e.jsxs(n,{sx:{p:3,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx(Pt,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No available team members found"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.4)",mt:1},children:"Make sure team members have valid licenses and aren't already assigned to this project"})]})]}),e.jsxs(cs,{sx:{p:3,background:"rgba(255, 255, 255, 0.02)",borderTop:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"space-between"},children:[e.jsx(F,{onClick:()=>{St(!1),ts(""),Ve(""),vs([]),Ws(""),wt(null)},variant:"outlined",disabled:At,sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Cancel"}),e.jsx(F,{variant:"contained",disabled:At||!Ee,onClick:async()=>{if(!(!R||!Ee)){wt(null),sr(!0);try{await xt.addTeamMemberToProject(R.id,Ee,gs),await As(R),St(!1),ts(""),Ve(""),vs([]),Ws("")}catch(s){console.error("Failed to add team member:",s),wt((s==null?void 0:s.message)||"Failed to add team member")}finally{sr(!1)}}},sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,boxShadow:"0 6px 20px rgba(139, 92, 246, 0.4)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 8px 25px rgba(139, 92, 246, 0.5)",transform:"translateY(-2px)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)",boxShadow:"none"}},children:At?"Adding...":"Add Team Member"})]})]}),e.jsxs(ns,{open:be,onClose:()=>x(!1),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",maxHeight:"80vh"}},children:[e.jsxs(is,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",pb:2,fontSize:"1.5rem",fontWeight:600,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Dataset Management",e.jsx(F,{variant:"contained",startIcon:e.jsx(Ds,{}),onClick:()=>{x(!1),V(!0)},sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(139, 92, 246, 0.4)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 6px 16px rgba(139, 92, 246, 0.5)",transform:"translateY(-1px)"}},children:"Create Dataset"})]}),e.jsx(ls,{sx:{p:3,overflow:"auto"},children:_e?e.jsxs(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:4},children:[e.jsx(ds,{sx:{color:"rgba(255, 255, 255, 0.7)"}}),e.jsx(o,{variant:"body2",sx:{ml:2,color:"rgba(255, 255, 255, 0.7)"},children:"Loading datasets..."})]}):ie.length===0?e.jsxs(n,{sx:{textAlign:"center",py:4},children:[e.jsx(Ge,{sx:{fontSize:64,color:"rgba(255, 255, 255, 0.5)",mb:2}}),e.jsx(o,{variant:"h6",sx:{mb:2},children:"No Datasets Found"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:3},children:"Create your first dataset to get started with data management."})]}):e.jsxs(n,{children:[e.jsxs(o,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Ge,{sx:{mr:1}}),"Available Datasets (",ie.length,")"]}),e.jsx(p,{container:!0,spacing:2,children:ie.map(s=>{var d,g,S,A,N,M;return e.jsx(p,{item:!0,xs:12,sm:6,md:4,children:e.jsx(ue,{sx:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:2,color:"white",position:"relative","&:hover":{background:"rgba(255, 255, 255, 0.08)",borderColor:"rgba(255, 255, 255, 0.2)",transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.3)"},transition:"all 0.2s ease-in-out"},children:e.jsxs(ye,{sx:{p:2,pb:1},children:[e.jsx(o,{variant:"h6",sx:{fontSize:"1rem",fontWeight:600,mb:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2,minHeight:"2.5em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:s.description||"No description available"}),((d=s.storage)==null?void 0:d.backend)==="firestore"&&((S=(g=s.collectionAssignment)==null?void 0:g.selectedCollections)==null?void 0:S.length)>0&&e.jsxs(n,{sx:{mb:2},children:[e.jsxs(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",display:"block",mb:.5,fontWeight:500},children:["Collections (",s.collectionAssignment.selectedCollections.length,"):"]}),e.jsxs(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[s.collectionAssignment.selectedCollections.slice(0,2).map(ee=>e.jsx(z,{label:ee,size:"small",sx:{height:18,fontSize:"0.65rem",backgroundColor:"rgba(79, 70, 229, 0.2)",color:"#a5b4fc",border:"1px solid rgba(79, 70, 229, 0.3)"}},ee)),s.collectionAssignment.selectedCollections.length>2&&e.jsx(z,{label:`+${s.collectionAssignment.selectedCollections.length-2}`,size:"small",sx:{height:18,fontSize:"0.65rem",backgroundColor:"rgba(156, 163, 175, 0.2)",color:"#9ca3af"}})]})]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(z,{size:"small",label:((N=(A=s.__label)==null?void 0:A.match(/\((.*?)\)$/))==null?void 0:N[1])||"Firestore",variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",fontSize:"0.75rem"}}),e.jsx(z,{size:"small",label:s.visibility||"private",variant:"filled",sx:{backgroundColor:s.visibility==="public"?"rgba(34, 197, 94, 0.2)":s.visibility==="organization"?"rgba(59, 130, 246, 0.2)":"rgba(156, 163, 175, 0.2)",color:s.visibility==="public"?"#22c55e":s.visibility==="organization"?"#3b82f6":"#9ca3af",fontSize:"0.75rem"}})]}),e.jsxs(n,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(F,{variant:"outlined",size:"small",startIcon:e.jsx(jt,{}),onClick:ee=>{ee.stopPropagation(),console.log("âœï¸ [DashboardCloudProjectsBridge] Edit dataset clicked:",s.id),us(s),Re(!0)},sx:{borderColor:"rgba(139, 92, 246, 0.3)",color:"#8b5cf6",minWidth:"auto",px:1.5,py:.5,fontSize:"0.75rem","&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"}},children:"Edit"}),((M=s.storage)==null?void 0:M.backend)==="firestore"&&e.jsx(F,{variant:"outlined",size:"small",startIcon:e.jsx($e,{}),onClick:ee=>{ee.stopPropagation(),console.log("ðŸ“Š [DashboardCloudProjectsBridge] View collections clicked:",s.id),ys(s),js(!0)},sx:{borderColor:"rgba(59, 130, 246, 0.3)",color:"#3b82f6",minWidth:"auto",px:1.5,py:.5,fontSize:"0.75rem","&:hover":{borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)"}},children:"Collections"}),e.jsx(F,{variant:"outlined",size:"small",startIcon:e.jsx(Qs,{}),onClick:async ee=>{if(ee.stopPropagation(),window.confirm(`Are you sure you want to delete dataset "${s.name}"? This action cannot be undone and will remove the dataset from all projects.`))try{console.log("ðŸ—‘ï¸ [DashboardCloudProjectsBridge] Deleting dataset:",s.id),await le.deleteDataset(s.id),console.log("âœ… [DashboardCloudProjectsBridge] Dataset deleted successfully"),await ut(),await ea()}catch(ae){console.error("âŒ [DashboardCloudProjectsBridge] Failed to delete dataset:",ae),D(`Failed to delete dataset: ${ae instanceof Error?ae.message:"Unknown error"}`)}},sx:{borderColor:"rgba(239, 68, 68, 0.3)",color:"#ef4444",minWidth:"auto",px:1.5,py:.5,fontSize:"0.75rem","&:hover":{borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)"}},children:"Delete"})]}),e.jsxs(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)",mt:1,display:"block"},children:["ID: ",s.id]})]})})},s.id)})})]})}),e.jsxs(cs,{sx:{p:3,borderTop:"1px solid rgba(255, 255, 255, 0.1)",justifyContent:"space-between"},children:[e.jsx(F,{onClick:ut,variant:"outlined",startIcon:e.jsx(bt,{}),disabled:_e,sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:3,py:1,textTransform:"none","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Refresh"}),e.jsx(F,{onClick:()=>x(!1),variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:3,py:1,textTransform:"none","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})]})]}),R&&e.jsx(so,{open:ze,onClose:()=>Be(!1),projectId:R.id,projectName:R.name,organizationId:(r==null?void 0:r.organizationId)||"",existingProjectTeamMembers:es,onTeamMembersUpdated:()=>{console.log("ðŸ”„ [DashboardCloudProjectsBridge] Refreshing team members after wizard update"),R&&As(R)}}),R&&e.jsx(eo,{open:T,onClose:()=>me(!1),projectId:R.id,organizationId:(r==null?void 0:r.organizationId)||"",projectName:R.name}),e.jsxs(ns,{open:P,onClose:()=>y(!1),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",maxHeight:"90vh"}},children:[e.jsxs(is,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",pb:2,fontSize:"1.5rem",fontWeight:600,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Os,{sx:{fontSize:32,color:"#8b5cf6"}}),e.jsxs(n,{children:[e.jsx(o,{variant:"h5",sx:{fontWeight:700},children:"Dataset Insights & Analysis"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Global overview of dataset organization and conflicts"})]})]}),f&&e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx(o,{variant:"h4",sx:{color:f.healthScore>=80?"#10b981":f.healthScore>=60?"#f59e0b":"#ef4444",fontWeight:700},children:f.healthScore}),e.jsx(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Health Score"})]})]}),e.jsx(ls,{sx:{p:3,overflow:"auto"},children:v?e.jsxs(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:[e.jsx(ds,{sx:{color:"#8b5cf6",mr:2}}),e.jsx(o,{variant:"body1",children:"Analyzing dataset organization..."})]}):f?e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:4,p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs(o,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Os,{sx:{color:"#8b5cf6"}}),"Dataset Analysis Summary"]}),e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx(o,{variant:"h3",sx:{fontWeight:700,color:"#667eea"},children:f.totalDatasets}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Total Datasets"})]})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx(o,{variant:"h3",sx:{fontWeight:700,color:"#f093fb"},children:ie.filter(s=>{var d;return((d=s.storage)==null?void 0:d.backend)==="firestore"}).length}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Firestore Datasets"})]})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx(o,{variant:"h3",sx:{fontWeight:700,color:"#4facfe"},children:f.totalCollections}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Unique Collections"})]})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx(o,{variant:"h3",sx:{fontWeight:700,color:f.overlaps.length>0?"#fc4a1a":"#11998e"},children:f.overlaps.length}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Collection Overlaps"})]})})]})]}),e.jsxs(p,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(p,{item:!0,xs:12,sm:3,children:e.jsxs(ue,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(o,{variant:"h4",sx:{fontWeight:700},children:f.totalDatasets}),e.jsx(o,{variant:"body2",children:"Total Datasets"})]})}),e.jsx(p,{item:!0,xs:12,sm:3,children:e.jsxs(ue,{sx:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(o,{variant:"h4",sx:{fontWeight:700},children:f.totalCollections}),e.jsx(o,{variant:"body2",children:"Unique Collections"})]})}),e.jsx(p,{item:!0,xs:12,sm:3,children:e.jsxs(ue,{sx:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(o,{variant:"h4",sx:{fontWeight:700},children:f.overlaps.length}),e.jsx(o,{variant:"body2",children:"Collection Overlaps"})]})}),e.jsx(p,{item:!0,xs:12,sm:3,children:e.jsxs(ue,{sx:{background:f.globalInsights.redundantAssignments.length>0?"linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%)":"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(o,{variant:"h4",sx:{fontWeight:700},children:f.globalInsights.redundantAssignments.length}),e.jsx(o,{variant:"body2",children:"Redundancies"})]})})]}),f.overlaps.length>0&&e.jsxs(n,{sx:{mb:4},children:[e.jsxs(o,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(yt,{color:"warning"}),"Collection Overlaps"]}),f.overlaps.map((s,d)=>e.jsx(ue,{sx:{mb:2,bgcolor:"rgba(255, 255, 255, 0.05)",border:`2px solid ${s.conflictLevel==="high"?"#ef4444":s.conflictLevel==="medium"?"#f59e0b":"#10b981"}`},children:e.jsxs(ye,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(o,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{}),s.collection]}),e.jsx(z,{label:s.conflictLevel.toUpperCase(),color:s.conflictLevel==="high"?"error":s.conflictLevel==="medium"?"warning":"success",sx:{fontWeight:600}})]}),e.jsxs(o,{variant:"body2",sx:{mb:2},children:["Used by ",s.datasets.length," datasets: ",s.datasets.map(g=>g.name).join(", ")]}),s.conflictReasons.length>0&&e.jsxs(n,{sx:{mb:2},children:[e.jsx(o,{variant:"caption",sx:{fontWeight:600,display:"block",mb:1},children:"Issues:"}),s.conflictReasons.map((g,S)=>e.jsxs(o,{variant:"body2",sx:{color:"#ef4444",fontSize:"0.85rem"},children:["â€¢ ",g]},S))]}),s.recommendations.length>0&&e.jsxs(n,{children:[e.jsx(o,{variant:"caption",sx:{fontWeight:600,display:"block",mb:1},children:"Recommendations:"}),s.recommendations.map((g,S)=>e.jsxs(o,{variant:"body2",sx:{color:"#10b981",fontSize:"0.85rem"},children:["ðŸ’¡ ",g]},S))]})]})},d))]}),f.globalInsights.mostUsedCollections.length>0&&e.jsxs(n,{sx:{mb:4},children:[e.jsxs(o,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Gt,{color:"primary"}),"Most Used Collections"]}),e.jsx(p,{container:!0,spacing:2,children:f.globalInsights.mostUsedCollections.slice(0,6).map((s,d)=>e.jsx(p,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ue,{sx:{bgcolor:"rgba(255, 255, 255, 0.05)",p:2},children:[e.jsxs(o,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx($e,{color:"primary"}),s.collection]}),e.jsxs(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:["Used by ",s.count," dataset",s.count!==1?"s":""]}),e.jsxs(n,{sx:{mt:1},children:[s.datasets.slice(0,2).map((g,S)=>e.jsx(z,{label:g,size:"small",sx:{mr:.5,mb:.5,fontSize:"0.7rem"}},S)),s.datasets.length>2&&e.jsx(z,{label:`+${s.datasets.length-2} more`,size:"small",sx:{fontSize:"0.7rem"}})]})]})},d))})]}),f.globalInsights.recommendations.length>0&&e.jsxs(n,{children:[e.jsxs(o,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(zs,{color:"info"}),"Optimization Recommendations"]}),f.globalInsights.recommendations.map((s,d)=>e.jsx(he,{severity:"info",sx:{mb:1,bgcolor:"rgba(79, 70, 229, 0.1)"},children:s},d))]}),f.overlaps.length===0&&f.globalInsights.redundantAssignments.length===0&&f.totalDatasets>0&&e.jsxs(n,{sx:{textAlign:"center",py:4},children:[e.jsx(Zt,{sx:{fontSize:64,color:"#10b981",mb:2}}),e.jsx(o,{variant:"h5",sx:{color:"#10b981",mb:1},children:"Excellent Dataset Organization!"}),e.jsx(o,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"No conflicts or redundancies detected. Your datasets are well-organized."})]}),f.totalDatasets===0&&e.jsxs(n,{sx:{textAlign:"center",py:6},children:[e.jsx(Ge,{sx:{fontSize:80,color:"rgba(255, 255, 255, 0.3)",mb:3}}),e.jsx(o,{variant:"h5",sx:{mb:2,color:"rgba(255, 255, 255, 0.8)"},children:"No Datasets Found"}),e.jsx(o,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.6)",mb:3,maxWidth:400,mx:"auto"},children:"Create your first dataset to start organizing your data and see detailed insights about collection usage and potential conflicts."}),e.jsx(F,{variant:"contained",startIcon:e.jsx(Ds,{}),onClick:()=>{y(!1),V(!0)},sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(139, 92, 246, 0.4)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 6px 20px rgba(139, 92, 246, 0.5)",transform:"translateY(-2px)"}},children:"Create Your First Dataset"})]})]}):e.jsxs(n,{sx:{textAlign:"center",py:6},children:[e.jsx(Os,{sx:{fontSize:80,color:"rgba(255, 255, 255, 0.3)",mb:3}}),e.jsx(o,{variant:"h5",sx:{mb:2,color:"rgba(255, 255, 255, 0.8)"},children:"Dataset Analysis Unavailable"}),e.jsx(o,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.6)",mb:3,maxWidth:400,mx:"auto"},children:"Unable to load dataset analysis. This could be due to missing organization data or a temporary service issue."}),e.jsxs(n,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(F,{variant:"outlined",startIcon:e.jsx(bt,{}),onClick:qs,sx:{borderColor:"rgba(139, 92, 246, 0.3)",color:"#8b5cf6","&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"}},children:"Retry Analysis"}),e.jsx(F,{variant:"contained",startIcon:e.jsx(Ds,{}),onClick:()=>{y(!1),V(!0)},sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)"}},children:"Create Dataset"})]})]})}),e.jsxs(cs,{sx:{p:3,borderTop:"1px solid rgba(255, 255, 255, 0.1)",justifyContent:"space-between"},children:[e.jsx(F,{onClick:qs,variant:"outlined",startIcon:e.jsx(bt,{}),disabled:v,sx:{borderColor:"rgba(139, 92, 246, 0.3)",color:"#8b5cf6","&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"}},children:"Refresh Analysis"}),e.jsx(F,{onClick:()=>y(!1),variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})]})]}),e.jsxs(ns,{open:rt,onClose:()=>{js(!1),ys(null)},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",maxHeight:"80vh"}},children:[e.jsxs(is,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",pb:2,fontSize:"1.25rem",fontWeight:600,display:"flex",alignItems:"center",gap:2},children:[e.jsx($e,{sx:{color:"#3b82f6"}}),e.jsxs(n,{children:[e.jsx(o,{variant:"h6",sx:{fontWeight:700},children:"Dataset Collections"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:(fe==null?void 0:fe.name)||"Dataset"})]})]}),e.jsx(ls,{sx:{p:3},children:fe&&e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:3,p:2,borderRadius:2,background:"rgba(255, 255, 255, 0.05)"},children:[e.jsx(o,{variant:"body1",sx:{fontWeight:600,mb:1},children:fe.name}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2},children:fe.description||"No description available"}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(z,{size:"small",label:((mr=fe.storage)==null?void 0:mr.backend)||"firestore",sx:{backgroundColor:"rgba(79, 70, 229, 0.2)",color:"#a5b4fc"}}),e.jsx(z,{size:"small",label:fe.visibility||"private",sx:{backgroundColor:"rgba(59, 130, 246, 0.2)",color:"#60a5fa"}})]})]}),((hr=fe.storage)==null?void 0:hr.backend)==="firestore"?e.jsxs(n,{children:[e.jsxs(o,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{sx:{color:"#f59e0b"}}),"Firestore Collections"]}),((xr=(pr=fe.collectionAssignment)==null?void 0:pr.selectedCollections)==null?void 0:xr.length)>0?e.jsxs(n,{children:[e.jsxs(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2},children:["This dataset includes ",fe.collectionAssignment.selectedCollections.length," collection(s):"]}),e.jsx(p,{container:!0,spacing:1,children:fe.collectionAssignment.selectedCollections.map((s,d)=>e.jsx(p,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(n,{sx:{p:2,borderRadius:2,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",display:"flex",alignItems:"center",gap:1},children:[e.jsx($e,{sx:{color:"#f59e0b",fontSize:20}}),e.jsx(o,{variant:"body2",sx:{fontWeight:500},children:s})]})},d))}),fe.collectionAssignment.organizationScope&&e.jsx(n,{sx:{mt:2,p:2,borderRadius:2,background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)"},children:e.jsxs(o,{variant:"body2",sx:{color:"#10b981",display:"flex",alignItems:"center",gap:1},children:[e.jsx(Bs,{sx:{fontSize:16}}),"Organization scoped for data isolation"]})})]}):e.jsxs(n,{sx:{textAlign:"center",py:4},children:[e.jsx(yt,{sx:{fontSize:48,color:"rgba(245, 158, 11, 0.5)",mb:2}}),e.jsx(o,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.7)",mb:1},children:"No Collections Assigned"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"This Firestore dataset doesn't have any collections assigned yet."})]})]}):e.jsxs(n,{sx:{textAlign:"center",py:4},children:[e.jsx(zs,{sx:{fontSize:48,color:"rgba(59, 130, 246, 0.5)",mb:2}}),e.jsx(o,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.7)",mb:1},children:"Non-Firestore Dataset"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"Collection management is only available for Firestore datasets."})]})]})}),e.jsxs(cs,{sx:{p:3,borderTop:"1px solid rgba(255, 255, 255, 0.1)",justifyContent:"space-between"},children:[e.jsx(F,{onClick:()=>{fe&&(us(fe),Re(!0),js(!1))},variant:"outlined",startIcon:e.jsx(jt,{}),sx:{borderColor:"rgba(139, 92, 246, 0.3)",color:"#8b5cf6","&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"}},children:"Edit Dataset"}),e.jsx(F,{onClick:()=>{js(!1),ys(null)},variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})]})]}),e.jsx(Qa,{open:Ne,onClose:()=>{Re(!1),us(null)},dataset:Ze,existingDatasets:ie,onDatasetUpdated:s=>{console.log("âœ… [DashboardCloudProjectsBridge] Dataset updated:",s),R&&se(d=>d.map(g=>g.id===s.id?s:g)),ge(d=>d.map(g=>g.id===s.id?s:g)),(fe==null?void 0:fe.id)===s.id&&ys(s),P&&qs()}})]})};export{vo as DashboardCloudProjectsBridge,vo as default};
