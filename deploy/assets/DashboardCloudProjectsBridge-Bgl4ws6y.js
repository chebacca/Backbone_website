import{j as e,b as Se,a as d,T as u,d as x,az as ee,t as N,aA as we,aB as te,G as ae,k as De,l as Pe,I as Be,ak as Fe,h as E,aC as Ie,Z as se,aD as re,aE as ne,aF as Ae,aG as le,U as oe,W as C,X as A,Y as v,aH as ie,aI as ce,aJ as de,u as k,a4 as xe,F as Le,Q as Ge,aK as ue}from"./mui-T5zcPaKR.js";import{r as l}from"./vendor-OeuszDaU.js";import{cloudProjectIntegration as c}from"./CloudProjectIntegration-DJQpMSMF.js";import{U as Te,s as We}from"./UnifiedProjectCreationDialog-BZpTrpcP.js";import"./index-4FoLjB-L.js";import"./stripe-Bd-xCkZF.js";import"./proxy-Bigtmpzy.js";const Ye=({onProjectLaunch:L})=>{const[G,he]=l.useState([]),[q,U]=l.useState(!0),[R,S]=l.useState(null),[j,ge]=l.useState(0),[je,T]=l.useState(!1),[ze,_e]=l.useState(!1),[a,w]=l.useState(null),[Y,f]=l.useState([]),[me,p]=l.useState(!1),[fe,D]=l.useState([]),[P,H]=l.useState(""),[h,J]=l.useState("all"),[B,pe]=l.useState(""),[be,b]=l.useState(!1),[W,K]=l.useState(!1),[Q,z]=l.useState(null),[X,ye]=l.useState(!0),[r,m]=l.useState({name:"",description:"",backend:"firestore",gcsBucket:"",gcsPrefix:""}),Ce=async t=>{try{p(!0);const s=await c.getProjectDatasets(t.id);f(s);const n=h==="all"?t.storageBackend:h;h==="all"&&J(n);const o=(await c.listDatasets({backend:n,query:B||void 0})).map(y=>{var g;return{...y,__label:`${y.name} ${((g=y.storage)==null?void 0:g.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});D(o)}catch(s){console.error("Failed to load datasets for project",s)}finally{p(!1)}};l.useEffect(()=>{a&&(Ce(a),m(t=>({...t,backend:a.storageBackend||"firestore",gcsBucket:a.gcsBucket||"",gcsPrefix:a.gcsPrefix||""})))},[a]),l.useEffect(()=>{_();const t=s=>{_()};return window.addEventListener("project:created",t),()=>window.removeEventListener("project:created",t)},[]);const _=async()=>{try{S(null),U(!0);const t=await c.getUserProjects();he(t)}catch(t){S((t==null?void 0:t.message)||"Failed to load projects")}finally{U(!1)}},$=async t=>{try{await We.selectProject(t.id),L==null||L(t.id)}catch(s){console.error("Failed to launch project:",s),S("Failed to launch project")}},Z=()=>{T(!0)},ve=async t=>{T(!1),await _(),setTimeout(()=>{const s=(j===0?F:I).find(n=>n.id===t)||G.find(n=>n.id===t);s&&$(s)},0)},O=t=>{switch(t){case"firestore":return e.jsx(se,{});case"gcs":return e.jsx(ie,{});default:return e.jsx(ue,{})}},M=t=>t==="standalone"?e.jsx(ue,{}):e.jsx(ce,{}),ke=t=>{const s=new Date(t),i=new Date().getTime()-s.getTime(),o=Math.floor(i/(1e3*60*60*24));return o===0?"Today":o===1?"Yesterday":o<7?`${o} days ago`:s.toLocaleDateString()},F=G.filter(t=>t.isActive),I=G.filter(t=>!t.isActive);return e.jsxs(Se,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(d,{children:[e.jsx(u,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"Cloud Projects"}),e.jsx(u,{variant:"body1",color:"text.secondary",children:"Manage your projects with Firebase and Google Cloud Storage integration"})]}),e.jsx(x,{variant:"contained",startIcon:e.jsx(ee,{}),onClick:Z,size:"large",children:"Create Project"})]}),e.jsx(N,{severity:"info",sx:{mb:3},children:e.jsxs(u,{variant:"body2",children:[e.jsx("strong",{children:"Integrated Startup System:"})," Projects created here will automatically integrate with the unified startup flow and support both standalone and network modes with Firebase/GCS storage options."]})}),R&&e.jsx(N,{severity:"error",sx:{mb:3},onClose:()=>S(null),children:R}),e.jsxs(we,{value:j,onChange:(t,s)=>ge(s),sx:{borderBottom:1,borderColor:"divider",mb:3},children:[e.jsx(te,{label:`Active Projects (${F.length})`}),e.jsx(te,{label:`Archived (${I.length})`})]}),e.jsxs(d,{children:[q?e.jsx(d,{sx:{textAlign:"center",py:4},children:e.jsx(u,{children:"Loading projects..."})}):e.jsx(ae,{container:!0,spacing:3,children:(j===0?F:I).map(t=>e.jsx(ae,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(De,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease","&:hover":{transform:"translateY(-2px)",boxShadow:s=>s.shadows[4]}},children:[e.jsxs(Pe,{sx:{flexGrow:1},children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:2},children:[M(t.applicationMode),e.jsx(u,{variant:"h6",component:"h3",sx:{ml:1,flexGrow:1},children:t.name}),e.jsx(Be,{size:"small",onClick:()=>w(t),children:e.jsx(Fe,{})})]}),t.description&&e.jsx(u,{variant:"body2",color:"text.secondary",paragraph:!0,children:t.description}),e.jsxs(d,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:[e.jsx(E,{size:"small",icon:M(t.applicationMode),label:t.applicationMode==="standalone"?"Standalone":"Network",color:"primary",variant:"outlined"}),e.jsx(E,{size:"small",icon:O(t.storageBackend),label:t.storageBackend,variant:"outlined"}),t.allowCollaboration&&e.jsx(E,{size:"small",label:`${t.maxCollaborators} users`,variant:"outlined"})]}),e.jsxs(u,{variant:"caption",color:"text.secondary",children:["Last accessed: ",ke(t.lastAccessedAt)]})]}),e.jsx(d,{sx:{p:2,pt:0},children:e.jsx(x,{fullWidth:!0,variant:"contained",startIcon:e.jsx(Ie,{}),onClick:()=>$(t),disabled:!t.isActive,children:t.isActive?"Launch Project":"Archived"})})]})},t.id))}),!q&&(j===0?F:I).length===0&&e.jsxs(d,{sx:{textAlign:"center",py:8},children:[e.jsx(se,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(u,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:j===0?"No active projects yet":"No archived projects"}),e.jsx(u,{variant:"body2",color:"text.secondary",paragraph:!0,children:j===0?"Create your first cloud project to get started with Firebase and GCS integration":"Archived projects will appear here"}),j===0&&e.jsx(x,{variant:"contained",startIcon:e.jsx(ee,{}),onClick:Z,size:"large",children:"Create Your First Project"})]})]}),e.jsx(Te,{open:je,onClose:()=>T(!1),mode:"shared_network",onSuccess:ve,onCreate:async t=>{var n,i;try{const o=localStorage.getItem("auth_token");o&&((i=(n=window.cloudProjectIntegration)==null?void 0:n.setAuthToken)==null||i.call(n,o))}catch{}return await c.createCloudProject(t)}}),e.jsxs(re,{open:!!a,onClose:()=>w(null),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ne,{children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ae,{}),"Project Details"]})}),e.jsxs(le,{children:[a&&e.jsxs(oe,{children:[e.jsxs(C,{children:[e.jsx(A,{children:M(a.applicationMode)}),e.jsx(v,{primary:"Mode",secondary:a.applicationMode==="standalone"?"Standalone":"Network"})]}),e.jsxs(C,{children:[e.jsx(A,{children:O(a.storageBackend)}),e.jsx(v,{primary:"Storage Backend",secondary:a.storageBackend})]}),a.gcsBucket&&e.jsxs(C,{children:[e.jsx(A,{children:e.jsx(ie,{})}),e.jsx(v,{primary:"GCS Bucket",secondary:a.gcsBucket})]}),a.allowCollaboration&&e.jsxs(C,{children:[e.jsx(A,{children:e.jsx(ce,{})}),e.jsx(v,{primary:"Collaboration",secondary:`Up to ${a.maxCollaborators} users`})]})]}),a&&e.jsxs(d,{sx:{mt:2},children:[e.jsx(u,{variant:"subtitle1",sx:{mb:1},children:"Assigned Datasets"}),e.jsx(x,{size:"small",variant:"outlined",onClick:async()=>{if(a)try{p(!0);const t=await c.getProjectDatasets(a.id);f(t);const n=(await c.listDatasets({backend:h==="all"?void 0:h,query:B||void 0})).map(i=>{var o;return{...i,__label:`${i.name} ${((o=i.storage)==null?void 0:o.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});D(n)}catch(t){console.error("Failed to load datasets",t)}finally{p(!1)}},sx:{mb:1},children:me?"Loading...":"Refresh"}),e.jsx(x,{size:"small",variant:"contained",color:"primary",onClick:()=>{z(null),b(!0)},sx:{mb:1,ml:1},children:"New Dataset"}),e.jsxs(d,{sx:{display:"flex",gap:1,alignItems:"center",mb:1,flexWrap:"wrap"},children:[e.jsx("label",{htmlFor:"dataset-backend",className:"visually-hidden",children:"Backend"}),e.jsxs("select",{id:"dataset-backend","aria-label":"Backend filter",value:h,onChange:t=>J(t.target.value),children:[e.jsx("option",{value:"all",children:"All backends"}),e.jsx("option",{value:"firestore",children:"Firestore"}),e.jsx("option",{value:"gcs",children:"GCS"})]}),e.jsx("input",{type:"text",placeholder:"Search datasets…",value:B,onChange:t=>pe(t.target.value),"aria-label":"Search datasets",style:{padding:6}}),e.jsx("label",{htmlFor:"dataset-select",className:"visually-hidden",children:"Select dataset"}),e.jsxs("select",{id:"dataset-select","aria-label":"Select dataset",value:P,onChange:t=>H(t.target.value),className:"dataset-select-input",children:[e.jsx("option",{value:"",children:"Select dataset…"}),fe.map(t=>e.jsx("option",{value:t.id,children:t.__label||t.name},t.id))]}),e.jsx(x,{size:"small",variant:"contained",disabled:!P,onClick:async()=>{if(!(!a||!P))try{await c.assignDatasetToProject(a.id,P);const t=await c.getProjectDatasets(a.id);f(t),H("")}catch(t){console.error("Failed to assign dataset",t)}},children:"Assign"}),e.jsx(x,{size:"small",variant:"outlined",onClick:async()=>{if(a)try{p(!0);const t=await c.getProjectDatasets(a.id);f(t);const n=(await c.listDatasets({backend:h==="all"?void 0:h,query:B||void 0})).map(i=>{var o;return{...i,__label:`${i.name} ${((o=i.storage)==null?void 0:o.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});D(n)}catch(t){console.error("Failed to load datasets",t)}finally{p(!1)}},children:"Apply Filters"})]}),Y.length===0?e.jsx(u,{variant:"body2",color:"text.secondary",children:"No datasets assigned"}):e.jsx(oe,{children:Y.map(t=>e.jsx(C,{secondaryAction:e.jsx(x,{size:"small",color:"error",onClick:async()=>{try{await c.unassignDatasetFromProject(a.id,t.id),f(s=>s.filter(n=>n.id!==t.id))}catch(s){console.error("Failed to unassign dataset",s)}},children:"Remove"}),children:e.jsx(v,{primary:t.name,secondary:t.description})},t.id))})]})]}),e.jsxs(de,{children:[e.jsx(x,{onClick:()=>w(null),children:"Close"}),a&&e.jsx(x,{variant:"contained",onClick:()=>{$(a),w(null)},children:"Launch Project"})]})]}),e.jsxs(re,{open:be,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ne,{children:"Create Dataset"}),e.jsxs(le,{children:[Q&&e.jsx(N,{severity:"error",sx:{mb:2},children:Q}),e.jsxs(d,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(k,{label:"Name",value:r.name,onChange:t=>m({...r,name:t.target.value}),required:!0,fullWidth:!0}),e.jsx(k,{label:"Description",value:r.description,onChange:t=>m({...r,description:t.target.value}),multiline:!0,minRows:2,fullWidth:!0}),e.jsxs(k,{select:!0,label:"Storage Backend",value:r.backend,onChange:t=>m({...r,backend:t.target.value}),fullWidth:!0,children:[e.jsx(xe,{value:"firestore",children:"Firestore"}),e.jsx(xe,{value:"gcs",children:"Google Cloud Storage (GCS)"})]}),r.backend==="gcs"&&e.jsxs(e.Fragment,{children:[e.jsx(k,{label:"GCS Bucket",placeholder:"my-bucket",value:r.gcsBucket,onChange:t=>m({...r,gcsBucket:t.target.value}),fullWidth:!0}),e.jsx(k,{label:"GCS Prefix (optional)",placeholder:"datasets/project-123/",value:r.gcsPrefix,onChange:t=>m({...r,gcsPrefix:t.target.value}),fullWidth:!0})]}),e.jsx(Le,{control:e.jsx(Ge,{checked:X,onChange:(t,s)=>ye(s)}),label:"Assign to this project after creation"})]})]}),e.jsxs(de,{children:[e.jsx(x,{onClick:()=>b(!1),disabled:W,children:"Cancel"}),e.jsx(x,{variant:"contained",disabled:W||!r.name.trim(),onClick:async()=>{if(!a){b(!1);return}z(null),K(!0);try{const t={backend:r.backend};r.backend==="gcs"&&(r.gcsBucket&&(t.gcsBucket=r.gcsBucket),r.gcsPrefix&&(t.gcsPrefix=r.gcsPrefix));const s=await c.createDataset({name:r.name.trim(),description:r.description.trim()||void 0,visibility:"private",organizationId:null,tags:[],schema:{},storage:t});X&&await c.assignDatasetToProject(a.id,s.id);const n=await c.getProjectDatasets(a.id);f(n);const i=h==="all"?a.storageBackend:h,y=(await c.listDatasets({backend:i})).map(g=>{var V;return{...g,__label:`${g.name} ${((V=g.storage)==null?void 0:V.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});D(y),b(!1),m(g=>({...g,name:"",description:""}))}catch(t){z((t==null?void 0:t.message)||"Failed to create dataset")}finally{K(!1)}},children:W?"Creating…":"Create Dataset"})]})]})]})};export{Ye as DashboardCloudProjectsBridge,Ye as default};
