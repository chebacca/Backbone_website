import{j as e,b as ee,a as o,T as i,d as l,az as N,t as E,aA as te,aB as W,G as U,k as ae,l as se,I as re,ak as ne,h as P,aC as oe,Z as $,aD as ie,aE as le,aF as ce,aG as de,U as Y,W as h,X as C,Y as j,aH as R,aI as _,aJ as xe,aK as q}from"./mui-T5zcPaKR.js";import{r}from"./vendor-OeuszDaU.js";import{cloudProjectIntegration as x}from"./CloudProjectIntegration-BX9UxI47.js";import{U as he,s as je}from"./UnifiedProjectCreationDialog-YeWLf96H.js";import"./index-DhX1RZFp.js";import"./stripe-Bd-xCkZF.js";import"./proxy-Bigtmpzy.js";const we=({onProjectLaunch:b})=>{const[v,H]=r.useState([]),[A,B]=r.useState(!0),[L,u]=r.useState(null),[c,J]=r.useState(0),[K,w]=r.useState(!1),[ue,ge]=r.useState(!1),[a,g]=r.useState(null),[F,S]=r.useState([]),[X,T]=r.useState(!1),[Z,O]=r.useState([]),[m,z]=r.useState("");r.useEffect(()=>{D();const t=s=>{D()};return window.addEventListener("project:created",t),()=>window.removeEventListener("project:created",t)},[]);const D=async()=>{try{u(null),B(!0);const t=await x.getUserProjects();H(t)}catch(t){u((t==null?void 0:t.message)||"Failed to load projects")}finally{B(!1)}},I=async t=>{try{await je.selectProject(t.id),b==null||b(t.id)}catch(s){console.error("Failed to launch project:",s),u("Failed to launch project")}},M=()=>{w(!0)},Q=async t=>{w(!1),await D(),setTimeout(()=>{const s=(c===0?p:y).find(n=>n.id===t)||v.find(n=>n.id===t);s&&I(s)},0)},G=t=>{switch(t){case"firestore":return e.jsx($,{});case"gcs":return e.jsx(R,{});default:return e.jsx(q,{})}},k=t=>t==="standalone"?e.jsx(q,{}):e.jsx(_,{}),V=t=>{const s=new Date(t),f=new Date().getTime()-s.getTime(),d=Math.floor(f/(1e3*60*60*24));return d===0?"Today":d===1?"Yesterday":d<7?`${d} days ago`:s.toLocaleDateString()},p=v.filter(t=>t.isActive),y=v.filter(t=>!t.isActive);return e.jsxs(ee,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(o,{children:[e.jsx(i,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"Cloud Projects"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:"Manage your projects with Firebase and Google Cloud Storage integration"})]}),e.jsx(l,{variant:"contained",startIcon:e.jsx(N,{}),onClick:M,size:"large",children:"Create Project"})]}),e.jsx(E,{severity:"info",sx:{mb:3},children:e.jsxs(i,{variant:"body2",children:[e.jsx("strong",{children:"Integrated Startup System:"})," Projects created here will automatically integrate with the unified startup flow and support both standalone and network modes with Firebase/GCS storage options."]})}),L&&e.jsx(E,{severity:"error",sx:{mb:3},onClose:()=>u(null),children:L}),e.jsxs(te,{value:c,onChange:(t,s)=>J(s),sx:{borderBottom:1,borderColor:"divider",mb:3},children:[e.jsx(W,{label:`Active Projects (${p.length})`}),e.jsx(W,{label:`Archived (${y.length})`})]}),e.jsxs(o,{children:[A?e.jsx(o,{sx:{textAlign:"center",py:4},children:e.jsx(i,{children:"Loading projects..."})}):e.jsx(U,{container:!0,spacing:3,children:(c===0?p:y).map(t=>e.jsx(U,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ae,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease","&:hover":{transform:"translateY(-2px)",boxShadow:s=>s.shadows[4]}},children:[e.jsxs(se,{sx:{flexGrow:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",mb:2},children:[k(t.applicationMode),e.jsx(i,{variant:"h6",component:"h3",sx:{ml:1,flexGrow:1},children:t.name}),e.jsx(re,{size:"small",onClick:()=>g(t),children:e.jsx(ne,{})})]}),t.description&&e.jsx(i,{variant:"body2",color:"text.secondary",paragraph:!0,children:t.description}),e.jsxs(o,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:[e.jsx(P,{size:"small",icon:k(t.applicationMode),label:t.applicationMode==="standalone"?"Standalone":"Network",color:"primary",variant:"outlined"}),e.jsx(P,{size:"small",icon:G(t.storageBackend),label:t.storageBackend,variant:"outlined"}),t.allowCollaboration&&e.jsx(P,{size:"small",label:`${t.maxCollaborators} users`,variant:"outlined"})]}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["Last accessed: ",V(t.lastAccessedAt)]})]}),e.jsx(o,{sx:{p:2,pt:0},children:e.jsx(l,{fullWidth:!0,variant:"contained",startIcon:e.jsx(oe,{}),onClick:()=>I(t),disabled:!t.isActive,children:t.isActive?"Launch Project":"Archived"})})]})},t.id))}),!A&&(c===0?p:y).length===0&&e.jsxs(o,{sx:{textAlign:"center",py:8},children:[e.jsx($,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:c===0?"No active projects yet":"No archived projects"}),e.jsx(i,{variant:"body2",color:"text.secondary",paragraph:!0,children:c===0?"Create your first cloud project to get started with Firebase and GCS integration":"Archived projects will appear here"}),c===0&&e.jsx(l,{variant:"contained",startIcon:e.jsx(N,{}),onClick:M,size:"large",children:"Create Your First Project"})]})]}),e.jsx(he,{open:K,onClose:()=>w(!1),mode:"shared_network",onSuccess:Q,onCreate:async t=>{var n,f;try{const d=localStorage.getItem("auth_token");d&&((f=(n=window.cloudProjectIntegration)==null?void 0:n.setAuthToken)==null||f.call(n,d))}catch{}return await x.createCloudProject(t)}}),e.jsxs(ie,{open:!!a,onClose:()=>g(null),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ce,{}),"Project Details"]})}),e.jsxs(de,{children:[a&&e.jsxs(Y,{children:[e.jsxs(h,{children:[e.jsx(C,{children:k(a.applicationMode)}),e.jsx(j,{primary:"Mode",secondary:a.applicationMode==="standalone"?"Standalone":"Network"})]}),e.jsxs(h,{children:[e.jsx(C,{children:G(a.storageBackend)}),e.jsx(j,{primary:"Storage Backend",secondary:a.storageBackend})]}),a.gcsBucket&&e.jsxs(h,{children:[e.jsx(C,{children:e.jsx(R,{})}),e.jsx(j,{primary:"GCS Bucket",secondary:a.gcsBucket})]}),a.allowCollaboration&&e.jsxs(h,{children:[e.jsx(C,{children:e.jsx(_,{})}),e.jsx(j,{primary:"Collaboration",secondary:`Up to ${a.maxCollaborators} users`})]})]}),a&&e.jsxs(o,{sx:{mt:2},children:[e.jsx(i,{variant:"subtitle1",sx:{mb:1},children:"Assigned Datasets"}),e.jsx(l,{size:"small",variant:"outlined",onClick:async()=>{if(a)try{T(!0);const t=await x.getProjectDatasets(a.id);S(t);const s=await x.listDatasets();O(s)}catch(t){console.error("Failed to load datasets",t)}finally{T(!1)}},sx:{mb:1},children:X?"Loading...":"Refresh"}),e.jsxs(o,{sx:{display:"flex",gap:1,alignItems:"center",mb:1},children:[e.jsx("label",{htmlFor:"dataset-select",className:"visually-hidden",children:"Select dataset"}),e.jsxs("select",{id:"dataset-select","aria-label":"Select dataset",value:m,onChange:t=>z(t.target.value),className:"dataset-select-input",children:[e.jsx("option",{value:"",children:"Select datasetâ€¦"}),Z.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(l,{size:"small",variant:"contained",disabled:!m,onClick:async()=>{if(!(!a||!m))try{await x.assignDatasetToProject(a.id,m);const t=await x.getProjectDatasets(a.id);S(t),z("")}catch(t){console.error("Failed to assign dataset",t)}},children:"Assign"})]}),F.length===0?e.jsx(i,{variant:"body2",color:"text.secondary",children:"No datasets assigned"}):e.jsx(Y,{children:F.map(t=>e.jsx(h,{secondaryAction:e.jsx(l,{size:"small",color:"error",onClick:async()=>{try{await x.unassignDatasetFromProject(a.id,t.id),S(s=>s.filter(n=>n.id!==t.id))}catch(s){console.error("Failed to unassign dataset",s)}},children:"Remove"}),children:e.jsx(j,{primary:t.name,secondary:t.description})},t.id))})]})]}),e.jsxs(xe,{children:[e.jsx(l,{onClick:()=>g(null),children:"Close"}),a&&e.jsx(l,{variant:"contained",onClick:()=>{I(a),g(null)},children:"Launch Project"})]})]})]})};export{we as DashboardCloudProjectsBridge,we as default};
