const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firebase-DMZK7dif.js","assets/index-DBXufSE9.js","assets/mui-DkbfeYlB.js","assets/vendor-CjD1bmmO.js","assets/stripe-ByEW0BsT.js","assets/index-CBai7h7s.css","assets/index.esm-CuU9rz2o.js","assets/index.esm-DPzT-Jis.js","assets/index.esm-BXflmvX0.js"])))=>i.map(i=>d[i]);
var za=Object.defineProperty;var _a=(u,s,t)=>s in u?za(u,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[s]=t;var Ee=(u,s,t)=>_a(u,typeof s!="symbol"?s+"":s,t);import{u as yr,b as Vs,a as La,_ as Fr,E as qa}from"./index-DBXufSE9.js";import{j as e,aI as dt,aJ as ut,B as c,ck as jr,aK as mt,b_ as _s,b$ as Lt,c0 as qt,d as be,T as i,aL as gt,a as B,C as pt,t as ge,v as Ce,G as x,w as bt,x as Te,y as qe,ap as He,z as Ne,av as Ba,H as Wt,e as fe,aS as ft,ar as Fe,as as $e,at as Ge,M as w,g as et,aO as Vt,O as Wa,Q as Fa,U as Ua,W as $a,p as Cr,ak as It,r as F,Y as sa,X as Bt,bq as Ga,cl as ra,c as Ze,I as Os,bX as Ur,bp as us,cm as Va,a$ as rs,R as Ns,F as Be,l as ar,D as ms,cn as $r,co as Gr,cp as Vr,cq as Ha,cr as rt,s as Ye,aj as Ps,V as Ya,h as aa,m as vr,K as os,b9 as ir,c4 as Ka,c5 as Qa,c6 as Hs,bH as ls,i as Ja,aW as ks,cs as Xa,bP as Za,aP as ia,a9 as ei,ct as na,aN as nr,af as as,c2 as ti,A as si,q as ri,u as Hr,cu as ai,bf as oa,cv as ii,cw as ni,cx as oi,cy as li,cz as ci,f as Yr,cA as di,cB as ui,an as Gt,aA as or,cC as lr,b4 as mi,b5 as Kr,aH as Qr,a5 as Jr,bT as Xr,aB as gi,aC as pi,aD as hi,aE as Zr,aF as Pe,cD as ts,aG as xi,bj as Ys,cE as fi,cF as bi,a6 as yi,c1 as Ks,bZ as ji,ca as ws,cG as at,b3 as Ci,al as vi,bk as Si,am as Ai}from"./mui-DkbfeYlB.js";import{r as d,b as la}from"./vendor-CjD1bmmO.js";import{collection as cs,query as Ms,where as ds,limit as Qs,getDocs as cr,Timestamp as st,doc as Rt,setDoc as dr,getDoc as ur,onSnapshot as ca,addDoc as Ri,updateDoc as ss}from"./index.esm-DPzT-Jis.js";import{g as Ii,h as Js,d as Xe}from"./firebase-DMZK7dif.js";import{c as Re,T as ct,a as ea}from"./CloudProjectIntegration-Dg-Y3T98.js";import{U as Ei,s as wi}from"./UnifiedProjectCreationDialog-DXl3UIU4.js";import{unifiedDataService as ta}from"./UnifiedDataService-DnQqxkiz.js";import"./stripe-ByEW0BsT.js";import"./index.esm-CuU9rz2o.js";import"./index.esm-BXflmvX0.js";import"./FirestoreCollectionManager-BdF29D5Q.js";class Di{constructor(){Ee(this,"templates",new Map);this.initializeTemplates()}initializeTemplates(){this.templates.set("sessions",{name:"sessions",category:"sessions",displayName:"Sessions",description:"Production sessions with scheduling and status tracking",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0,description:"Unique session identifier"},{name:"organizationId",type:"string",required:!0,indexed:!0,description:"Organization ID for access control"},{name:"projectId",type:"string",required:!1,indexed:!0,description:"Associated project ID"},{name:"sessionName",type:"string",required:!0,indexed:!1,description:"Display name for the session"},{name:"description",type:"string",required:!1,indexed:!1,description:"Session description"},{name:"status",type:"string",required:!0,indexed:!0,description:"Session status",validation:{enum:["PLANNING","SCHEDULED","IN_PRODUCTION","POST_PRODUCTION","COMPLETED","CANCELLED"]}},{name:"sessionDate",type:"string",required:!1,indexed:!0,description:"Session date (YYYY-MM-DD)"},{name:"callTime",type:"timestamp",required:!1,indexed:!0,description:"Call time"},{name:"wrapTime",type:"timestamp",required:!1,indexed:!0,description:"Wrap time"},{name:"location",type:"string",required:!1,indexed:!1,description:"Session location"},{name:"assignedTo",type:"array",required:!1,indexed:!0,description:"Array of assigned user IDs"},{name:"createdBy",type:"string",required:!0,indexed:!0,description:"User ID who created the session"},{name:"createdAt",type:"timestamp",required:!0,indexed:!0,description:"Creation timestamp"},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0,description:"Last update timestamp"}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"status",order:"asc"},{field:"createdAt",order:"desc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"projectId",order:"asc"},{field:"createdAt",order:"desc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"assignedTo",order:"array-contains"},{field:"status",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","PRODUCER","DIRECTOR"],admin:["ADMIN","OWNER"]},relationships:[{collection:"projects",type:"many-to-many",field:"projectId"},{collection:"sessionTasks",type:"one-to-many",field:"sessionId"}]}),this.templates.set("sessionTasks",{name:"sessionTasks",category:"sessions",displayName:"Session Tasks",description:"Tasks associated with production sessions",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"sessionId",type:"string",required:!0,indexed:!0},{name:"taskName",type:"string",required:!0,indexed:!1},{name:"description",type:"string",required:!1,indexed:!1},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["TODO","IN_PROGRESS","COMPLETED","CANCELLED"]}},{name:"priority",type:"string",required:!1,indexed:!0,validation:{enum:["LOW","MEDIUM","HIGH","URGENT"]}},{name:"assignedTo",type:"string",required:!1,indexed:!0},{name:"dueDate",type:"timestamp",required:!1,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"sessionId",order:"asc"},{field:"status",order:"asc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"assignedTo",order:"asc"},{field:"dueDate",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","PRODUCER","COORDINATOR"],admin:["ADMIN","OWNER"]}}),this.templates.set("mediaFiles",{name:"mediaFiles",category:"media",displayName:"Media Files",description:"Media file tracking and management",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"sessionId",type:"string",required:!1,indexed:!0},{name:"fileName",type:"string",required:!0,indexed:!0},{name:"fileType",type:"string",required:!0,indexed:!0},{name:"fileSize",type:"number",required:!1,indexed:!1},{name:"duration",type:"number",required:!1,indexed:!1},{name:"resolution",type:"string",required:!1,indexed:!1},{name:"codec",type:"string",required:!1,indexed:!1},{name:"storageUrl",type:"string",required:!0,indexed:!1},{name:"thumbnailUrl",type:"string",required:!1,indexed:!1},{name:"tags",type:"array",required:!1,indexed:!0},{name:"uploadedBy",type:"string",required:!0,indexed:!0},{name:"uploadedAt",type:"timestamp",required:!0,indexed:!0},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["UPLOADING","PROCESSING","READY","ARCHIVED","ERROR"]}}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"sessionId",order:"asc"},{field:"fileType",order:"asc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"uploadedAt",order:"desc"},{field:"fileType",order:"asc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"tags",order:"array-contains"},{field:"uploadedAt",order:"desc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","MEDIA_MANAGER","EDITOR"],admin:["ADMIN","OWNER"]}}),this.templates.set("projects",{name:"projects",category:"business",displayName:"Projects",description:"Project management and tracking",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"name",type:"string",required:!0,indexed:!0},{name:"description",type:"string",required:!1,indexed:!1},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["PLANNING","ACTIVE","ON_HOLD","COMPLETED","CANCELLED"]}},{name:"priority",type:"string",required:!1,indexed:!0,validation:{enum:["LOW","MEDIUM","HIGH","URGENT"]}},{name:"startDate",type:"timestamp",required:!1,indexed:!0},{name:"endDate",type:"timestamp",required:!1,indexed:!0},{name:"budget",type:"number",required:!1,indexed:!1},{name:"clientId",type:"string",required:!1,indexed:!0},{name:"projectManager",type:"string",required:!1,indexed:!0},{name:"teamMembers",type:"array",required:!1,indexed:!0},{name:"tags",type:"array",required:!1,indexed:!0},{name:"isActive",type:"boolean",required:!0,indexed:!0,defaultValue:!0},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"isActive",order:"asc"},{field:"status",order:"asc"},{field:"createdAt",order:"desc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"projectManager",order:"asc"},{field:"status",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","PROJECT_MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("teamMembers",{name:"teamMembers",category:"team",displayName:"Team Members",description:"Team member management and roles",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"userId",type:"string",required:!0,indexed:!0},{name:"email",type:"string",required:!0,indexed:!0},{name:"firstName",type:"string",required:!0,indexed:!1},{name:"lastName",type:"string",required:!0,indexed:!1},{name:"role",type:"string",required:!0,indexed:!0},{name:"department",type:"string",required:!1,indexed:!0},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["ACTIVE","INACTIVE","PENDING","SUSPENDED"]}},{name:"permissions",type:"array",required:!1,indexed:!1},{name:"joinedAt",type:"timestamp",required:!0,indexed:!0},{name:"lastActiveAt",type:"timestamp",required:!1,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"email",order:"asc"},{field:"role",order:"asc"},{field:"status",order:"asc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"department",order:"asc"},{field:"status",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","HR_MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("inventoryItems",{name:"inventoryItems",category:"inventory",displayName:"Inventory Items",description:"Equipment and inventory tracking",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"itemName",type:"string",required:!0,indexed:!0},{name:"category",type:"string",required:!0,indexed:!0},{name:"subcategory",type:"string",required:!1,indexed:!0},{name:"serialNumber",type:"string",required:!1,indexed:!0},{name:"barcode",type:"string",required:!1,indexed:!0},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["AVAILABLE","IN_USE","MAINTENANCE","RETIRED","LOST"]}},{name:"condition",type:"string",required:!1,indexed:!0,validation:{enum:["EXCELLENT","GOOD","FAIR","POOR"]}},{name:"location",type:"string",required:!1,indexed:!0},{name:"assignedTo",type:"string",required:!1,indexed:!0},{name:"purchaseDate",type:"timestamp",required:!1,indexed:!0},{name:"purchasePrice",type:"number",required:!1,indexed:!1},{name:"warrantyExpiry",type:"timestamp",required:!1,indexed:!0},{name:"notes",type:"string",required:!1,indexed:!1},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"category",order:"asc"},{field:"status",order:"asc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"assignedTo",order:"asc"},{field:"status",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","INVENTORY_MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("reviews",{name:"reviews",category:"media",displayName:"Reviews",description:"Content review and approval system",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"sessionId",type:"string",required:!1,indexed:!0},{name:"mediaFileId",type:"string",required:!1,indexed:!0},{name:"reviewTitle",type:"string",required:!0,indexed:!1},{name:"reviewType",type:"string",required:!0,indexed:!0,validation:{enum:["CONTENT","TECHNICAL","CREATIVE","FINAL"]}},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["PENDING","IN_REVIEW","APPROVED","REJECTED","REVISION_NEEDED"]}},{name:"reviewerId",type:"string",required:!0,indexed:!0},{name:"reviewerName",type:"string",required:!1,indexed:!1},{name:"reviewNotes",type:"string",required:!1,indexed:!1},{name:"dueDate",type:"timestamp",required:!1,indexed:!0},{name:"completedAt",type:"timestamp",required:!1,indexed:!0},{name:"priority",type:"string",required:!1,indexed:!0,validation:{enum:["LOW","MEDIUM","HIGH","URGENT"]}},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"status",order:"asc"},{field:"dueDate",order:"asc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"reviewerId",order:"asc"},{field:"status",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","PRODUCER","DIRECTOR","POST_SUPERVISOR"],admin:["ADMIN","OWNER"]}}),this.templates.set("reports",{name:"reports",category:"media",displayName:"Reports",description:"Analytics and reporting system",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"reportTitle",type:"string",required:!0,indexed:!0},{name:"reportType",type:"string",required:!0,indexed:!0,validation:{enum:["ANALYTICS","PERFORMANCE","USAGE","FINANCIAL","OPERATIONAL"]}},{name:"description",type:"string",required:!1,indexed:!1},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["DRAFT","GENERATING","COMPLETED","FAILED","ARCHIVED"]}},{name:"generatedBy",type:"string",required:!0,indexed:!0},{name:"reportData",type:"object",required:!1,indexed:!1},{name:"parameters",type:"object",required:!1,indexed:!1},{name:"dateRange",type:"object",required:!1,indexed:!1},{name:"fileUrl",type:"string",required:!1,indexed:!1},{name:"tags",type:"array",required:!1,indexed:!0},{name:"isPublic",type:"boolean",required:!1,indexed:!0,defaultValue:!1},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"reportType",order:"asc"},{field:"createdAt",order:"desc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"generatedBy",order:"asc"},{field:"status",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("notes",{name:"notes",category:"media",displayName:"Notes",description:"General notes and comments",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"title",type:"string",required:!0,indexed:!0},{name:"content",type:"string",required:!0,indexed:!1},{name:"noteType",type:"string",required:!1,indexed:!0,validation:{enum:["GENERAL","PRODUCTION","TECHNICAL","CREATIVE","MEETING"]}},{name:"authorId",type:"string",required:!0,indexed:!0},{name:"authorName",type:"string",required:!1,indexed:!1},{name:"sessionId",type:"string",required:!1,indexed:!0},{name:"projectId",type:"string",required:!1,indexed:!0},{name:"tags",type:"array",required:!1,indexed:!0},{name:"isPrivate",type:"boolean",required:!1,indexed:!0,defaultValue:!1},{name:"attachments",type:"array",required:!1,indexed:!1},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"authorId",order:"asc"},{field:"createdAt",order:"desc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"noteType",order:"asc"},{field:"createdAt",order:"desc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["MEMBER","ADMIN","OWNER"],admin:["ADMIN","OWNER"]}}),this.templates.set("callSheets",{name:"callSheets",category:"media",displayName:"Call Sheets",description:"Production call sheets",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"sessionId",type:"string",required:!0,indexed:!0},{name:"callSheetNumber",type:"string",required:!0,indexed:!0},{name:"productionDate",type:"timestamp",required:!0,indexed:!0},{name:"location",type:"string",required:!1,indexed:!0},{name:"callTime",type:"timestamp",required:!1,indexed:!0},{name:"wrapTime",type:"timestamp",required:!1,indexed:!0},{name:"weather",type:"string",required:!1,indexed:!1},{name:"sunrise",type:"string",required:!1,indexed:!1},{name:"sunset",type:"string",required:!1,indexed:!1},{name:"crewList",type:"array",required:!1,indexed:!1},{name:"equipmentList",type:"array",required:!1,indexed:!1},{name:"specialNotes",type:"string",required:!1,indexed:!1},{name:"emergencyContacts",type:"array",required:!1,indexed:!1},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["DRAFT","PUBLISHED","REVISED","CANCELLED"]}},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"sessionId",order:"asc"},{field:"productionDate",order:"asc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"status",order:"asc"},{field:"productionDate",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","PRODUCER","COORDINATOR"],admin:["ADMIN","OWNER"]}}),this.templates.set("stages",{name:"stages",category:"media",displayName:"Stages",description:"Production stages and milestones",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"projectId",type:"string",required:!1,indexed:!0},{name:"stageName",type:"string",required:!0,indexed:!0},{name:"stageType",type:"string",required:!0,indexed:!0,validation:{enum:["PRE_PRODUCTION","PRODUCTION","POST_PRODUCTION","DELIVERY","ARCHIVE"]}},{name:"description",type:"string",required:!1,indexed:!1},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["NOT_STARTED","IN_PROGRESS","COMPLETED","ON_HOLD","CANCELLED"]}},{name:"startDate",type:"timestamp",required:!1,indexed:!0},{name:"endDate",type:"timestamp",required:!1,indexed:!0},{name:"estimatedDuration",type:"number",required:!1,indexed:!1},{name:"actualDuration",type:"number",required:!1,indexed:!1},{name:"assignedTo",type:"array",required:!1,indexed:!0},{name:"dependencies",type:"array",required:!1,indexed:!1},{name:"deliverables",type:"array",required:!1,indexed:!1},{name:"completionPercentage",type:"number",required:!1,indexed:!0,defaultValue:0},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"projectId",order:"asc"},{field:"stageType",order:"asc"}],queryScope:"COLLECTION"},{fields:[{field:"organizationId",order:"asc"},{field:"status",order:"asc"},{field:"startDate",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","PRODUCER","PROJECT_MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("inventory",{name:"inventory",category:"inventory",displayName:"Inventory",description:"General inventory management",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"inventoryName",type:"string",required:!0,indexed:!0},{name:"description",type:"string",required:!1,indexed:!1},{name:"location",type:"string",required:!1,indexed:!0},{name:"managedBy",type:"string",required:!1,indexed:!0},{name:"totalItems",type:"number",required:!1,indexed:!1,defaultValue:0},{name:"totalValue",type:"number",required:!1,indexed:!1,defaultValue:0},{name:"lastAuditDate",type:"timestamp",required:!1,indexed:!0},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["ACTIVE","INACTIVE","MAINTENANCE","ARCHIVED"]}},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"status",order:"asc"},{field:"createdAt",order:"desc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","INVENTORY_MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("networks",{name:"networks",category:"inventory",displayName:"Networks",description:"Network configuration and management",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"networkName",type:"string",required:!0,indexed:!0},{name:"networkType",type:"string",required:!0,indexed:!0,validation:{enum:["LAN","WAN","WIFI","VPN","CELLULAR"]}},{name:"ipRange",type:"string",required:!1,indexed:!0},{name:"subnet",type:"string",required:!1,indexed:!1},{name:"gateway",type:"string",required:!1,indexed:!1},{name:"dns",type:"array",required:!1,indexed:!1},{name:"vlan",type:"number",required:!1,indexed:!0},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["ACTIVE","INACTIVE","MAINTENANCE","ERROR"]}},{name:"location",type:"string",required:!1,indexed:!0},{name:"managedBy",type:"string",required:!1,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"networkType",order:"asc"},{field:"status",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","NETWORK_ADMIN"],admin:["ADMIN","OWNER"]}}),this.templates.set("networkIPAssignments",{name:"networkIPAssignments",category:"inventory",displayName:"Network IP Assignments",description:"IP address management and assignments",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"ipAddress",type:"string",required:!0,indexed:!0},{name:"networkId",type:"string",required:!0,indexed:!0},{name:"deviceName",type:"string",required:!1,indexed:!0},{name:"deviceType",type:"string",required:!1,indexed:!0},{name:"macAddress",type:"string",required:!1,indexed:!0},{name:"assignedTo",type:"string",required:!1,indexed:!0},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["ASSIGNED","AVAILABLE","RESERVED","BLOCKED"]}},{name:"assignedDate",type:"timestamp",required:!1,indexed:!0},{name:"notes",type:"string",required:!1,indexed:!1},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"networkId",order:"asc"},{field:"status",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","NETWORK_ADMIN"],admin:["ADMIN","OWNER"]}}),this.templates.set("roles",{name:"roles",category:"team",displayName:"Roles",description:"Role definitions and permissions",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"roleName",type:"string",required:!0,indexed:!0},{name:"description",type:"string",required:!1,indexed:!1},{name:"hierarchy",type:"number",required:!0,indexed:!0},{name:"permissions",type:"array",required:!1,indexed:!1},{name:"isActive",type:"boolean",required:!0,indexed:!0,defaultValue:!0},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"hierarchy",order:"asc"},{field:"isActive",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER"],admin:["ADMIN","OWNER"]}}),this.templates.set("permissions",{name:"permissions",category:"team",displayName:"Permissions",description:"Granular permission management",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"roleId",type:"string",required:!0,indexed:!0},{name:"resource",type:"string",required:!0,indexed:!0},{name:"action",type:"string",required:!0,indexed:!0},{name:"granted",type:"boolean",required:!0,indexed:!0},{name:"conditions",type:"object",required:!1,indexed:!1},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"roleId",order:"asc"},{field:"resource",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["ADMIN","OWNER"],write:["ADMIN","OWNER"],admin:["ADMIN","OWNER"]}}),this.templates.set("contacts",{name:"contacts",category:"team",displayName:"Contacts",description:"Contact management",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"firstName",type:"string",required:!0,indexed:!0},{name:"lastName",type:"string",required:!0,indexed:!0},{name:"email",type:"string",required:!1,indexed:!0},{name:"phone",type:"string",required:!1,indexed:!0},{name:"company",type:"string",required:!1,indexed:!0},{name:"title",type:"string",required:!1,indexed:!1},{name:"contactType",type:"string",required:!1,indexed:!0,validation:{enum:["CLIENT","VENDOR","CONTRACTOR","PARTNER","OTHER"]}},{name:"address",type:"object",required:!1,indexed:!1},{name:"notes",type:"string",required:!1,indexed:!1},{name:"tags",type:"array",required:!1,indexed:!0},{name:"isActive",type:"boolean",required:!0,indexed:!0,defaultValue:!0},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"contactType",order:"asc"},{field:"lastName",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","BUSINESS_MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("clients",{name:"clients",category:"business",displayName:"Clients",description:"Client relationship management",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"clientName",type:"string",required:!0,indexed:!0},{name:"companyName",type:"string",required:!1,indexed:!0},{name:"email",type:"string",required:!1,indexed:!0},{name:"phone",type:"string",required:!1,indexed:!0},{name:"address",type:"object",required:!1,indexed:!1},{name:"clientType",type:"string",required:!1,indexed:!0,validation:{enum:["INDIVIDUAL","BUSINESS","ENTERPRISE","GOVERNMENT"]}},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["ACTIVE","INACTIVE","PROSPECT","FORMER"]}},{name:"accountManager",type:"string",required:!1,indexed:!0},{name:"contractValue",type:"number",required:!1,indexed:!1},{name:"notes",type:"string",required:!1,indexed:!1},{name:"tags",type:"array",required:!1,indexed:!0},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"status",order:"asc"},{field:"clientName",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","BUSINESS_MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("mapLayouts",{name:"mapLayouts",category:"inventory",displayName:"Map Layouts",description:"Facility and equipment layouts",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"layoutName",type:"string",required:!0,indexed:!0},{name:"description",type:"string",required:!1,indexed:!1},{name:"layoutType",type:"string",required:!0,indexed:!0,validation:{enum:["FLOOR_PLAN","SITE_MAP","NETWORK_DIAGRAM","EQUIPMENT_LAYOUT"]}},{name:"imageUrl",type:"string",required:!1,indexed:!1},{name:"coordinates",type:"object",required:!1,indexed:!1},{name:"scale",type:"number",required:!1,indexed:!1},{name:"isActive",type:"boolean",required:!0,indexed:!0,defaultValue:!0},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"layoutType",order:"asc"},{field:"isActive",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","FACILITY_MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("mapLocations",{name:"mapLocations",category:"inventory",displayName:"Map Locations",description:"Location markers and points of interest",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"mapLayoutId",type:"string",required:!0,indexed:!0},{name:"locationName",type:"string",required:!0,indexed:!0},{name:"locationType",type:"string",required:!0,indexed:!0,validation:{enum:["EQUIPMENT","ROOM","EXIT","UTILITY","STORAGE","OFFICE"]}},{name:"coordinates",type:"object",required:!0,indexed:!1},{name:"description",type:"string",required:!1,indexed:!1},{name:"capacity",type:"number",required:!1,indexed:!1},{name:"isAccessible",type:"boolean",required:!1,indexed:!0,defaultValue:!0},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"mapLayoutId",order:"asc"},{field:"locationType",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","FACILITY_MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("setupProfiles",{name:"setupProfiles",category:"inventory",displayName:"Setup Profiles",description:"Equipment setup configurations",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"profileName",type:"string",required:!0,indexed:!0},{name:"description",type:"string",required:!1,indexed:!1},{name:"equipmentType",type:"string",required:!0,indexed:!0},{name:"configuration",type:"object",required:!0,indexed:!1},{name:"settings",type:"object",required:!1,indexed:!1},{name:"isDefault",type:"boolean",required:!1,indexed:!0,defaultValue:!1},{name:"isActive",type:"boolean",required:!0,indexed:!0,defaultValue:!0},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"equipmentType",order:"asc"},{field:"isActive",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","TECHNICAL_MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("schemas",{name:"schemas",category:"inventory",displayName:"Schemas",description:"Data schema definitions",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"schemaName",type:"string",required:!0,indexed:!0},{name:"version",type:"string",required:!0,indexed:!0},{name:"description",type:"string",required:!1,indexed:!1},{name:"schemaType",type:"string",required:!0,indexed:!0,validation:{enum:["DATABASE","API","FILE","MESSAGE"]}},{name:"definition",type:"object",required:!0,indexed:!1},{name:"isActive",type:"boolean",required:!0,indexed:!0,defaultValue:!0},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"schemaType",order:"asc"},{field:"version",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","DEVELOPER"],admin:["ADMIN","OWNER"]}}),this.templates.set("organizations",{name:"organizations",category:"team",displayName:"Organizations",description:"Organization metadata",organizationScoped:!1,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"name",type:"string",required:!0,indexed:!0},{name:"description",type:"string",required:!1,indexed:!1},{name:"type",type:"string",required:!1,indexed:!0,validation:{enum:["BUSINESS","NON_PROFIT","GOVERNMENT","EDUCATIONAL"]}},{name:"industry",type:"string",required:!1,indexed:!0},{name:"size",type:"string",required:!1,indexed:!0,validation:{enum:["STARTUP","SMALL","MEDIUM","LARGE","ENTERPRISE"]}},{name:"address",type:"object",required:!1,indexed:!1},{name:"website",type:"string",required:!1,indexed:!1},{name:"phone",type:"string",required:!1,indexed:!1},{name:"email",type:"string",required:!1,indexed:!0},{name:"settings",type:"object",required:!1,indexed:!1},{name:"isActive",type:"boolean",required:!0,indexed:!0,defaultValue:!0},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"name",order:"asc"},{field:"isActive",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER"],admin:["ADMIN","OWNER"]}}),this.templates.set("pbmProjects",{name:"pbmProjects",category:"business",displayName:"PBM Projects",description:"Project budget management projects",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"projectName",type:"string",required:!0,indexed:!0},{name:"projectCode",type:"string",required:!1,indexed:!0},{name:"description",type:"string",required:!1,indexed:!1},{name:"budget",type:"number",required:!1,indexed:!1},{name:"actualCost",type:"number",required:!1,indexed:!1,defaultValue:0},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["PLANNING","ACTIVE","ON_HOLD","COMPLETED","CANCELLED"]}},{name:"startDate",type:"timestamp",required:!1,indexed:!0},{name:"endDate",type:"timestamp",required:!1,indexed:!0},{name:"projectManager",type:"string",required:!1,indexed:!0},{name:"clientId",type:"string",required:!1,indexed:!0},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"status",order:"asc"},{field:"startDate",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","PROJECT_MANAGER"],admin:["ADMIN","OWNER"]}}),this.templates.set("pbmSchedules",{name:"pbmSchedules",category:"business",displayName:"PBM Schedules",description:"Scheduling and resource allocation",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"projectId",type:"string",required:!0,indexed:!0},{name:"scheduleName",type:"string",required:!0,indexed:!0},{name:"description",type:"string",required:!1,indexed:!1},{name:"startDate",type:"timestamp",required:!0,indexed:!0},{name:"endDate",type:"timestamp",required:!0,indexed:!0},{name:"resources",type:"array",required:!1,indexed:!1},{name:"milestones",type:"array",required:!1,indexed:!1},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["DRAFT","ACTIVE","COMPLETED","DELAYED","CANCELLED"]}},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"projectId",order:"asc"},{field:"startDate",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER","PROJECT_MANAGER","SCHEDULER"],admin:["ADMIN","OWNER"]}}),this.templates.set("licenses",{name:"licenses",category:"business",displayName:"Licenses",description:"License management",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"licenseKey",type:"string",required:!0,indexed:!0},{name:"licenseName",type:"string",required:!0,indexed:!0},{name:"licenseType",type:"string",required:!0,indexed:!0,validation:{enum:["BASIC","PRO","ENTERPRISE","TRIAL"]}},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["ACTIVE","INACTIVE","EXPIRED","SUSPENDED","REVOKED"]}},{name:"assignedTo",type:"string",required:!1,indexed:!0},{name:"issuedDate",type:"timestamp",required:!0,indexed:!0},{name:"expiryDate",type:"timestamp",required:!1,indexed:!0},{name:"maxUsers",type:"number",required:!1,indexed:!1},{name:"features",type:"array",required:!1,indexed:!1},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"status",order:"asc"},{field:"expiryDate",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER"],admin:["ADMIN","OWNER"]}}),this.templates.set("subscriptions",{name:"subscriptions",category:"business",displayName:"Subscriptions",description:"Subscription tracking",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0},{name:"organizationId",type:"string",required:!0,indexed:!0},{name:"subscriptionName",type:"string",required:!0,indexed:!0},{name:"plan",type:"string",required:!0,indexed:!0,validation:{enum:["BASIC","PRO","ENTERPRISE"]}},{name:"status",type:"string",required:!0,indexed:!0,validation:{enum:["ACTIVE","INACTIVE","CANCELLED","PAST_DUE","TRIALING"]}},{name:"billingCycle",type:"string",required:!1,indexed:!0,validation:{enum:["MONTHLY","YEARLY","QUARTERLY"]}},{name:"amount",type:"number",required:!1,indexed:!1},{name:"currency",type:"string",required:!1,indexed:!1,defaultValue:"USD"},{name:"startDate",type:"timestamp",required:!0,indexed:!0},{name:"endDate",type:"timestamp",required:!1,indexed:!0},{name:"nextBillingDate",type:"timestamp",required:!1,indexed:!0},{name:"paymentMethod",type:"string",required:!1,indexed:!1},{name:"createdBy",type:"string",required:!0,indexed:!0},{name:"createdAt",type:"timestamp",required:!0,indexed:!0},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"status",order:"asc"},{field:"nextBillingDate",order:"asc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER"],admin:["ADMIN","OWNER"]}}),this.templates.set("custom",{name:"custom",category:"custom",displayName:"Custom Collection",description:"Create a custom collection with your own fields",organizationScoped:!0,fields:[{name:"id",type:"string",required:!0,indexed:!0,description:"Unique document identifier"},{name:"organizationId",type:"string",required:!0,indexed:!0,description:"Organization ID for access control"},{name:"createdAt",type:"timestamp",required:!0,indexed:!0,description:"Creation timestamp"},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0,description:"Last update timestamp"}],indexes:[{fields:[{field:"organizationId",order:"asc"},{field:"createdAt",order:"desc"}],queryScope:"COLLECTION"}],securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER"],admin:["ADMIN","OWNER"]}})}async getCollectionTemplate(s){const t=this.templates.get(s);if(!t)throw new Error(`Template '${s}' not found`);return{...t}}getTemplatesByCategory(s){return Array.from(this.templates.values()).filter(t=>t.category===s)}getAllTemplates(){return Array.from(this.templates.values())}validateField(s){const t=[];if(!s.name||!s.name.trim()?t.push("Field name is required"):/^[a-zA-Z][a-zA-Z0-9_]*$/.test(s.name)||t.push("Field name must start with a letter and contain only letters, numbers, and underscores"),["id","organizationId","createdAt","updatedAt"].includes(s.name)&&t.push(`'${s.name}' is a reserved field name`),["string","number","boolean","timestamp","array","object","reference"].includes(s.type)||t.push("Invalid field type"),s.validation&&(s.type==="number"&&s.validation.min!==void 0&&s.validation.max!==void 0&&s.validation.min>=s.validation.max&&t.push("Minimum value must be less than maximum value"),s.type==="string"&&s.validation.pattern))try{new RegExp(s.validation.pattern)}catch{t.push("Invalid regex pattern")}return{valid:t.length===0,errors:t}}generateFirestoreIndexes(s){return{indexes:s.indexes.map(t=>({collectionGroup:s.name,queryScope:t.queryScope,fields:t.fields.map(a=>({fieldPath:a.field,order:a.order==="array-contains"?void 0:a.order.toUpperCase(),arrayConfig:a.order==="array-contains"?"CONTAINS":void 0})).filter(a=>a.order||a.arrayConfig)}))}}generateSecurityRules(s){const t=s.name,a=s.securityRules.read.map(l=>`'${l}'`).join(", "),o=s.securityRules.write.map(l=>`'${l}'`).join(", ");return`
    // ${s.displayName} Collection
    match /${t}/{docId} {
      allow read: if isAuthenticated() && 
        belongsToOrganization(resource.data.organizationId) &&
        hasAnyRole([${a}]);
      
      allow write: if isAuthenticated() && 
        belongsToOrganization(request.resource.data.organizationId) &&
        hasAnyRole([${o}]) &&
        request.resource.data.organizationId == getOrganizationId();
      
      allow create: if isAuthenticated() && 
        hasAnyRole([${o}]) &&
        request.resource.data.organizationId == getOrganizationId();
    }`}createCustomTemplate(s,t,a=!0){const o=[{name:"id",type:"string",required:!0,indexed:!0,description:"Unique document identifier"},{name:"createdAt",type:"timestamp",required:!0,indexed:!0,description:"Creation timestamp"},{name:"updatedAt",type:"timestamp",required:!0,indexed:!0,description:"Last update timestamp"}];a&&o.splice(1,0,{name:"organizationId",type:"string",required:!0,indexed:!0,description:"Organization ID for access control"});const l=[...o,...t],g=[{fields:a?[{field:"organizationId",order:"asc"},{field:"createdAt",order:"desc"}]:[{field:"createdAt",order:"desc"}],queryScope:"COLLECTION"}];return t.forEach(n=>{n.indexed&&a&&g.push({fields:[{field:"organizationId",order:"asc"},{field:n.name,order:"asc"}],queryScope:"COLLECTION"})}),{name:s,category:"custom",displayName:s,description:`Custom collection: ${s}`,organizationScoped:a,fields:l,indexes:g,securityRules:{read:["MEMBER","ADMIN","OWNER"],write:["ADMIN","OWNER"],admin:["ADMIN","OWNER"]}}}}class Ti{constructor(){Ee(this,"functions",Ii());Ee(this,"createCollectionFunction",Js(this.functions,"createCollection"));Ee(this,"updateSecurityRulesFunction",Js(this.functions,"updateSecurityRules"));Ee(this,"createFirestoreIndexesFunction",Js(this.functions,"createFirestoreIndexes"))}async checkCollectionExists(s,t){try{const a=cs(Xe,s);let o;return t?o=Ms(a,ds("organizationId","==",t),Qs(1)):o=Ms(a,Qs(1)),!(await cr(o)).empty}catch(a){return console.warn("Error checking collection existence:",a),!1}}async createCollection(s){try{console.log("🚀 Creating collection:",s.name);const t=this.validateCreationRequest(s);if(!t.valid)return{success:!1,error:t.errors.join(", ")};if(await this.checkCollectionExists(s.name,s.organizationId))return{success:!1,error:"Collection already exists"};const o=await this.createCollectionStructure(s);if(!o.success)return o;const l=await this.createFirestoreIndexes(s),g=await this.updateSecurityRules(s),n=await this.createInitialDocument(s);return{success:!0,collectionName:s.name,details:{collectionCreated:o.success,indexesCreated:l.success,securityRulesUpdated:g.success,initialDocumentCreated:n.success}}}catch(t){return console.error("Collection creation failed:",t),{success:!1,error:t.message||"Unknown error occurred"}}}validateCreationRequest(s){const t=[];return!s.name||!s.name.trim()?t.push("Collection name is required"):/^[a-zA-Z][a-zA-Z0-9_]*$/.test(s.name)||t.push("Collection name must start with a letter and contain only letters, numbers, and underscores"),s.template||t.push("Collection template is required"),s.organizationId||t.push("Organization ID is required"),s.createdBy||t.push("Creator user ID is required"),s.customFields&&s.customFields.forEach((a,o)=>{(!a.name||!a.name.trim())&&t.push(`Custom field ${o+1}: name is required`),a.type||t.push(`Custom field ${o+1}: type is required`)}),{valid:t.length===0,errors:t}}async createCollectionStructure(s){try{const a=(await this.createCollectionFunction({collectionName:s.name,template:s.template,organizationId:s.organizationId,createdBy:s.createdBy,customFields:s.customFields})).data;return a.success?(console.log("✅ Collection structure created successfully"),{success:!0}):(console.error("❌ Collection structure creation failed:",a.error),{success:!1,error:a.error||"Failed to create collection structure"})}catch(t){return console.error("❌ Collection structure creation error:",t),console.log("🔄 Attempting local collection creation as fallback..."),await this.createCollectionLocally(s)}}async createCollectionLocally(s){try{const t={collectionName:s.name,template:s.template.name,organizationId:s.organizationId,createdBy:s.createdBy,createdAt:st.now(),schema:{fields:s.template.fields,indexes:s.template.indexes,securityRules:s.template.securityRules},customFields:s.customFields||[],isActive:!0},a=Rt(Xe,"collectionRegistry",s.name);return await dr(a,t),console.log("✅ Collection metadata created locally"),{success:!0}}catch(t){return console.error("❌ Local collection creation failed:",t),{success:!1,error:t.message||"Failed to create collection locally"}}}async createFirestoreIndexes(s){try{const t={indexes:s.template.indexes.map(l=>({collectionGroup:s.name,queryScope:l.queryScope,fields:l.fields.map(g=>({fieldPath:g.field,order:g.order==="array-contains"?void 0:g.order.toUpperCase(),arrayConfig:g.order==="array-contains"?"CONTAINS":void 0})).filter(g=>g.order||g.arrayConfig)}))},o=(await this.createFirestoreIndexesFunction({collectionName:s.name,indexConfig:t,organizationId:s.organizationId})).data;return o.success?(console.log("✅ Firestore indexes created successfully"),{success:!0}):(console.warn("⚠️ Firestore indexes creation failed:",o.error),{success:!1,error:o.error||"Failed to create Firestore indexes"})}catch(t){return console.warn("⚠️ Firestore indexes creation error:",t),{success:!1,error:t.message||"Failed to create Firestore indexes"}}}async updateSecurityRules(s){try{const t=this.generateSecurityRules(s.name,s.template),o=(await this.updateSecurityRulesFunction({collectionName:s.name,securityRules:t,organizationId:s.organizationId})).data;return o.success?(console.log("✅ Security rules updated successfully"),{success:!0}):(console.warn("⚠️ Security rules update failed:",o.error),{success:!1,error:o.error||"Failed to update security rules"})}catch(t){return console.warn("⚠️ Security rules update error:",t),{success:!1,error:t.message||"Failed to update security rules"}}}async createInitialDocument(s){try{const t={id:"initial-doc",organizationId:s.organizationId,createdAt:st.now(),updatedAt:st.now(),createdBy:s.createdBy,isInitialDocument:!0,collectionTemplate:s.template.name};s.template.fields.forEach(o=>{o.required&&o.defaultValue!==void 0&&(t[o.name]=o.defaultValue)}),s.customFields&&s.customFields.forEach(o=>{o.required&&o.defaultValue!==void 0&&(t[o.name]=o.defaultValue)});const a=Rt(Xe,s.name,"initial-doc");return await dr(a,t),console.log("✅ Initial document created successfully"),{success:!0}}catch(t){return console.error("❌ Initial document creation failed:",t),{success:!1,error:t.message||"Failed to create initial document"}}}generateSecurityRules(s,t){const a=t.securityRules.read.map(l=>`'${l}'`).join(", "),o=t.securityRules.write.map(l=>`'${l}'`).join(", ");return`
    // ${t.displayName} Collection - Auto-generated
    match /${s}/{docId} {
      allow read: if isAuthenticated() && 
        belongsToOrganization(resource.data.organizationId) &&
        hasAnyRole([${a}]);
      
      allow write: if isAuthenticated() && 
        belongsToOrganization(request.resource.data.organizationId) &&
        hasAnyRole([${o}]) &&
        request.resource.data.organizationId == getOrganizationId();
      
      allow create: if isAuthenticated() && 
        hasAnyRole([${o}]) &&
        request.resource.data.organizationId == getOrganizationId();
    }`}async getCollectionStatus(s,t){try{const a=cs(Xe,s),o=Ms(a,ds("organizationId","==",t),Qs(10)),l=await cr(o),g=Rt(Xe,"collectionRegistry",s),n=await ur(g);return{exists:!l.empty||n.exists(),hasDocuments:!l.empty,hasMetadata:n.exists(),documentCount:l.size}}catch(a){return console.error("Error checking collection status:",a),{exists:!1,hasDocuments:!1,hasMetadata:!1}}}async deleteCollection(s,t){try{return console.warn("Collection deletion should be handled by Firebase Functions with admin permissions"),{success:!1,error:"Collection deletion must be performed by an administrator through Firebase Functions"}}catch(a){return{success:!1,error:a.message||"Failed to delete collection"}}}}const Xs={sessions:{icon:e.jsx(ra,{}),name:"Sessions & Workflows",description:"Production sessions, workflows, and task management",templates:["sessions","sessionWorkflows","sessionTasks","sessionAssignments","sessionReviews","postProductionTasks","workflowTemplates","workflowInstances"]},media:{icon:e.jsx(He,{}),name:"Media & Content",description:"Media files, reviews, and content management",templates:["mediaFiles","reviews","notes","reports","callSheets","stages"]},inventory:{icon:e.jsx(Ga,{}),name:"Inventory & Equipment",description:"Equipment tracking, network management, and inventory systems",templates:["inventoryItems","inventory","networks","networkIPAssignments","mapLayouts","mapLocations","setupProfiles","schemas"]},team:{icon:e.jsx(Bt,{}),name:"Team & Organization",description:"Team members, roles, and organizational data",templates:["teamMembers","roles","permissions","organizations","contacts"]},business:{icon:e.jsx(sa,{}),name:"Business & Projects",description:"Projects, clients, and business management",templates:["projects","clients","pbmProjects","pbmSchedules","licenses","subscriptions"]},custom:{icon:e.jsx(jr,{}),name:"Custom Collection",description:"Create a custom collection with guided schema builder",templates:["custom"]}},Zs=["Select Category","Choose Template","Configure Collection","Review & Create"],Ni=({open:u,onClose:s,onCollectionCreated:t})=>{const{user:a}=yr(),[o,l]=d.useState(0),[g,n]=d.useState(""),[y,j]=d.useState(""),[b,A]=d.useState(""),[v,S]=d.useState([]),[W,G]=d.useState(null),[X,ne]=d.useState(!1),[I,_]=d.useState(""),[ae,Y]=d.useState([]),[we]=d.useState(()=>new Di),[ee]=d.useState(()=>new Ti);d.useEffect(()=>{y&&y!=="custom"&&ve()},[y]);const ve=async()=>{try{const T=await we.getCollectionTemplate(y);G(T),A(y)}catch(T){console.error("Failed to load template:",T),_("Failed to load collection template")}},se=async()=>{o===Zs.length-1?await V():await q(o)&&l(h=>h+1)},de=()=>{l(T=>T-1)},q=async T=>{const h=[];switch(T){case 0:g||h.push("Please select a collection category");break;case 1:y||h.push("Please select a collection template");break;case 2:b.trim()?/^[a-zA-Z][a-zA-Z0-9_]*$/.test(b)||h.push("Collection name must start with a letter and contain only letters, numbers, and underscores"):h.push("Collection name is required"),y==="custom"&&v.length===0&&h.push("Custom collections must have at least one field"),await ee.checkCollectionExists(b,a==null?void 0:a.organizationId)&&h.push("A collection with this name already exists");break}return Y(h),h.length===0},V=async()=>{ne(!0),_("");try{if(!W||!(a!=null&&a.organizationId))throw new Error("Missing required data for collection creation");const T=await ee.createCollection({name:b,template:W,organizationId:a.organizationId,createdBy:a.firebaseUid||a.id,customFields:y==="custom"?v:void 0});T.success?(t(b,W),s(),je()):_(T.error||"Failed to create collection")}catch(T){console.error("Collection creation failed:",T),_(T.message||"Failed to create collection")}finally{ne(!1)}},je=()=>{l(0),n(""),j(""),A(""),S([]),G(null),_(""),Y([])},ie=()=>{S([...v,{name:"",type:"string",required:!1,indexed:!1}])},pe=(T,h)=>{const P=[...v];P[T]={...P[T],...h},S(P)},oe=T=>{S(v.filter((h,P)=>P!==T))},Se=T=>{switch(T){case 0:return Ae();case 1:return We();case 2:return Me();case 3:return J();default:return null}},Ae=()=>e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Select Collection Category"}),e.jsx(i,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Choose the type of collection you want to create. Each category provides templates that follow the Dashboard app's schema patterns."}),e.jsx(x,{container:!0,spacing:2,children:Object.entries(Xs).map(([T,h])=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(ge,{sx:{cursor:"pointer",border:g===T?2:1,borderColor:g===T?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>n(T),children:e.jsxs(Ce,{children:[e.jsxs(c,{display:"flex",alignItems:"center",mb:1,children:[h.icon,e.jsx(i,{variant:"h6",ml:1,children:h.name})]}),e.jsx(i,{variant:"body2",color:"text.secondary",children:h.description}),e.jsx(c,{mt:1,children:e.jsx(F,{size:"small",label:`${h.templates.length} templates`,color:g===T?"primary":"default"})})]})})},T))})]}),We=()=>{const T=Xs[g];return T?e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Choose Collection Template"}),e.jsxs(i,{variant:"body2",color:"text.secondary",paragraph:!0,children:["Select a template from the ",T.name," category. Templates include pre-configured fields, indexes, and security rules."]}),e.jsxs(Fe,{fullWidth:!0,children:[e.jsx($e,{children:"Template"}),e.jsx(Ge,{value:y,onChange:h=>j(h.target.value),label:"Template",children:T.templates.map(h=>e.jsx(w,{value:h,children:e.jsxs(c,{display:"flex",alignItems:"center",width:"100%",children:[e.jsx(i,{children:h}),h==="custom"&&e.jsx(F,{size:"small",label:"Custom",color:"secondary",sx:{ml:1}})]})},h))})]}),y&&y!=="custom"&&e.jsx(c,{mt:2,children:e.jsx(be,{severity:"info",icon:e.jsx(It,{}),children:"This template includes pre-configured fields, indexes, and security rules based on the Dashboard app's schema patterns."})})]}):null},Me=()=>e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Configure Collection"}),e.jsx(fe,{fullWidth:!0,label:"Collection Name",value:b,onChange:T=>A(T.target.value),margin:"normal",helperText:"Must start with a letter and contain only letters, numbers, and underscores",error:ae.some(T=>T.includes("Collection name"))}),y==="custom"&&e.jsxs(c,{mt:3,children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(i,{variant:"subtitle1",children:"Custom Fields"}),e.jsx(B,{startIcon:e.jsx(ft,{}),onClick:ie,variant:"outlined",size:"small",children:"Add Field"})]}),v.map((T,h)=>e.jsx(ge,{sx:{mb:2,p:2},children:e.jsxs(x,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(x,{item:!0,xs:3,children:e.jsx(fe,{fullWidth:!0,size:"small",label:"Field Name",value:T.name,onChange:P=>pe(h,{name:P.target.value})})}),e.jsx(x,{item:!0,xs:2,children:e.jsxs(Fe,{fullWidth:!0,size:"small",children:[e.jsx($e,{children:"Type"}),e.jsxs(Ge,{value:T.type,onChange:P=>pe(h,{type:P.target.value}),label:"Type",children:[e.jsx(w,{value:"string",children:"String"}),e.jsx(w,{value:"number",children:"Number"}),e.jsx(w,{value:"boolean",children:"Boolean"}),e.jsx(w,{value:"timestamp",children:"Timestamp"}),e.jsx(w,{value:"array",children:"Array"}),e.jsx(w,{value:"object",children:"Object"}),e.jsx(w,{value:"reference",children:"Reference"})]})]})}),e.jsx(x,{item:!0,xs:2,children:e.jsxs(Fe,{fullWidth:!0,size:"small",children:[e.jsx($e,{children:"Required"}),e.jsxs(Ge,{value:T.required?"true":"false",onChange:P=>pe(h,{required:P.target.value==="true"}),label:"Required",children:[e.jsx(w,{value:"false",children:"No"}),e.jsx(w,{value:"true",children:"Yes"})]})]})}),e.jsx(x,{item:!0,xs:2,children:e.jsxs(Fe,{fullWidth:!0,size:"small",children:[e.jsx($e,{children:"Indexed"}),e.jsxs(Ge,{value:T.indexed?"true":"false",onChange:P=>pe(h,{indexed:P.target.value==="true"}),label:"Indexed",children:[e.jsx(w,{value:"false",children:"No"}),e.jsx(w,{value:"true",children:"Yes"})]})]})}),e.jsx(x,{item:!0,xs:2,children:e.jsx(fe,{fullWidth:!0,size:"small",label:"Description",value:T.description||"",onChange:P=>pe(h,{description:P.target.value})})}),e.jsx(x,{item:!0,xs:1,children:e.jsx(et,{onClick:()=>oe(h),color:"error",size:"small",children:e.jsx(Vt,{})})})]})},h)),v.length===0&&e.jsx(be,{severity:"warning",children:'Custom collections require at least one field. Click "Add Field" to get started.'})]}),W&&e.jsx(c,{mt:3,children:e.jsxs(Wa,{children:[e.jsx(Fa,{expandIcon:e.jsx(Ua,{}),children:e.jsx(i,{children:"Template Preview"})}),e.jsx($a,{children:e.jsxs(c,{children:[e.jsx(i,{variant:"subtitle2",gutterBottom:!0,children:"Fields:"}),e.jsx(bt,{dense:!0,children:W.fields.map((T,h)=>e.jsxs(Te,{children:[e.jsx(qe,{children:T.required?e.jsx(Cr,{color:"success"}):e.jsx(It,{color:"info"})}),e.jsx(Ne,{primary:T.name,secondary:`${T.type}${T.required?" (required)":""}${T.indexed?" (indexed)":""}`})]},h))})]})})]})})]}),J=()=>{var T;return e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Review & Create Collection"}),W&&e.jsxs(c,{children:[e.jsx(ge,{sx:{mb:2},children:e.jsxs(Ce,{children:[e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Collection Details"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsxs(x,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Name:"}),e.jsx(i,{variant:"body1",children:b})]}),e.jsxs(x,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Category:"}),e.jsx(i,{variant:"body1",children:(T=Xs[g])==null?void 0:T.name})]}),e.jsxs(x,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Template:"}),e.jsx(i,{variant:"body1",children:y})]}),e.jsxs(x,{item:!0,xs:6,children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:"Organization Scoped:"}),e.jsx(i,{variant:"body1",children:W.organizationScoped?"Yes":"No"})]})]})]})}),e.jsx(ge,{sx:{mb:2},children:e.jsxs(Ce,{children:[e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"What will be created:"}),e.jsxs(bt,{children:[e.jsxs(Te,{children:[e.jsx(qe,{children:e.jsx(He,{color:"primary"})}),e.jsx(Ne,{primary:"Firestore Collection",secondary:`Collection '${b}' with ${W.fields.length} fields`})]}),e.jsxs(Te,{children:[e.jsx(qe,{children:e.jsx(Ba,{color:"primary"})}),e.jsx(Ne,{primary:"Firestore Indexes",secondary:`${W.indexes.length} optimized indexes for queries`})]}),e.jsxs(Te,{children:[e.jsx(qe,{children:e.jsx(Wt,{color:"primary"})}),e.jsx(Ne,{primary:"Security Rules",secondary:"Organization-scoped access control rules"})]})]})]})}),e.jsxs(be,{severity:"info",children:[e.jsx(i,{variant:"subtitle2",children:"Ready to Create"}),e.jsx(i,{variant:"body2",children:"This collection will be created in your organization's Firebase project with all necessary indexes and security rules. The collection will follow the Dashboard app's schema patterns for consistency."})]})]})]})};return e.jsxs(dt,{open:u,onClose:s,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsx(ut,{children:e.jsxs(c,{display:"flex",alignItems:"center",children:[e.jsx(jr,{sx:{mr:1}}),"Create New Collection"]})}),e.jsxs(mt,{children:[e.jsx(_s,{activeStep:o,sx:{mb:4},children:Zs.map(T=>e.jsx(Lt,{children:e.jsx(qt,{children:T})},T))}),I&&e.jsx(be,{severity:"error",sx:{mb:2},children:I}),ae.length>0&&e.jsxs(be,{severity:"warning",sx:{mb:2},children:[e.jsx(i,{variant:"subtitle2",children:"Please fix the following issues:"}),e.jsx("ul",{children:ae.map((T,h)=>e.jsx("li",{children:T},h))})]}),Se(o)]}),e.jsxs(gt,{children:[e.jsx(B,{onClick:s,disabled:X,children:"Cancel"}),e.jsx(B,{disabled:o===0||X,onClick:de,children:"Back"}),e.jsx(B,{variant:"contained",onClick:se,disabled:X,startIcon:X?e.jsx(pt,{size:20}):null,children:o===Zs.length-1?"Create Collection":"Next"})]})]})},Ot=class Ot{static getInstance(){return Ot.instance||(Ot.instance=new Ot),Ot.instance}async analyzeOrganizationDatasets(s,t){console.log("🔍 [DatasetConflictAnalyzer] Analyzing datasets for organization:",s);const a=t.filter(j=>{var b,A,v;return((b=j.storage)==null?void 0:b.backend)==="firestore"&&((v=(A=j.collectionAssignment)==null?void 0:A.selectedCollections)==null?void 0:v.length)>0}),o=this.buildCollectionUsageMap(a),l=this.detectCollectionOverlaps(o,a),g=this.generateGlobalInsights(o,a),n=this.calculateHealthScore(l,g),y={organizationId:s,totalDatasets:a.length,totalCollections:Object.keys(o).length,overlaps:l,globalInsights:g,healthScore:n};return console.log("✅ [DatasetConflictAnalyzer] Analysis complete:",{datasets:y.totalDatasets,overlaps:y.overlaps.length,healthScore:y.healthScore}),y}async checkDatasetCreationConflicts(s,t){var y,j;console.log("🔍 [DatasetConflictAnalyzer] Checking conflicts for new dataset:",s.name);const a=[],o=[];if(!((j=(y=s.collectionAssignment)==null?void 0:y.selectedCollections)!=null&&j.length))return{hasConflicts:!1,warnings:[],suggestions:[]};const l=s.collectionAssignment.selectedCollections;for(const b of l){const A=t.filter(v=>{var S,W;return(W=(S=v.collectionAssignment)==null?void 0:S.selectedCollections)==null?void 0:W.includes(b)});if(A.length>0){const v=this.assessConflictLevel(b,A,s);v!=="none"&&a.push({type:"overlap",severity:v==="high"?"error":v==="medium"?"warning":"info",message:`Collection "${b}" is already used by ${A.length} other dataset(s)`,affectedCollections:[b],affectedDatasets:A.map(S=>S.name),recommendation:this.getConflictRecommendation(b,A,s)}),v==="high"?o.push({type:"filter",message:"Consider adding data filters to differentiate from existing datasets",collections:[b]}):A.length>=3&&o.push({type:"merge",message:`Collection "${b}" is heavily used. Consider merging with existing dataset "${A[0].name}"`,collections:[b]})}}const g=this.checkRedundancyPatterns(l,t);a.push(...g.warnings),o.push(...g.suggestions);const n=this.checkPerformanceImplications(l,t);return a.push(...n),{hasConflicts:a.some(b=>b.severity==="error"),warnings:a,suggestions:o}}getConflictResolutionRecommendations(s){const t=[],a=s.overlaps.filter(o=>o.conflictLevel==="high");for(const o of a)t.push({type:"merge",priority:"high",title:`Merge datasets using "${o.collection}"`,description:`Collection "${o.collection}" is used by ${o.datasets.length} datasets with high conflict potential`,affectedDatasets:o.datasets.map(l=>l.name),estimatedImpact:"Reduces data redundancy and improves query performance",steps:["Review data usage patterns for each dataset","Identify common use cases and data access patterns","Create a unified dataset with appropriate data filters","Migrate existing queries to use the new unified dataset"]});for(const o of s.globalInsights.redundantAssignments)t.push({type:"filter",priority:"medium",title:`Add data filters for "${o.collection}"`,description:o.reason,affectedDatasets:o.affectedDatasets,estimatedImpact:"Improves data organization and reduces confusion",steps:["Analyze data access patterns for each dataset","Define specific filter criteria for each use case","Update dataset configurations with appropriate filters","Test data access to ensure proper isolation"]});if(s.globalInsights.mostUsedCollections.length>0){const o=s.globalInsights.mostUsedCollections[0];o.count>3&&t.push({type:"reorganize",priority:"low",title:`Optimize "${o.collection}" usage`,description:`This collection is used by ${o.count} datasets, consider optimization`,affectedDatasets:o.datasets,estimatedImpact:"Improves query performance and reduces resource usage",steps:["Review query patterns for this collection","Consider creating specialized views or indexes","Implement caching strategies for frequently accessed data","Monitor performance improvements"]})}return t.sort((o,l)=>{const g={high:3,medium:2,low:1};return g[l.priority]-g[o.priority]})}buildCollectionUsageMap(s){var a;const t={};for(const o of s)if((a=o.collectionAssignment)!=null&&a.selectedCollections)for(const l of o.collectionAssignment.selectedCollections)t[l]||(t[l]=[]),t[l].push(o);return t}detectCollectionOverlaps(s,t){const a=[];for(const[o,l]of Object.entries(s))if(l.length>1){const g=this.assessOverlapConflictLevel(o,l),n=this.getConflictReasons(o,l),y=this.getOverlapRecommendations(o,l);a.push({collection:o,datasets:l.map(j=>{var b,A,v;return{id:j.id,name:j.name,visibility:j.visibility||"private",organizationScope:((b=j.collectionAssignment)==null?void 0:b.organizationScope)!==!1,filters:(v=(A=j.collectionAssignment)==null?void 0:A.dataFilters)==null?void 0:v.filter(S=>S.collection===o)}}),conflictLevel:g,conflictReasons:n,recommendations:y})}return a.sort((o,l)=>{const g={high:4,medium:3,low:2,none:1};return g[l.conflictLevel]-g[o.conflictLevel]})}generateGlobalInsights(s,t){var n;const a=Object.entries(s).map(([y,j])=>({collection:y,count:j.length,datasets:j.map(b=>b.name)})).sort((y,j)=>j.count-y.count).slice(0,10),o=Object.entries(s).filter(([y,j])=>j.length>1).map(([y,j])=>j.some(A=>{var v,S;return(S=(v=A.collectionAssignment)==null?void 0:v.dataFilters)==null?void 0:S.some(W=>W.collection===y)})?null:{collection:y,reason:`Used by ${j.length} datasets without data filters - potential redundancy`,affectedDatasets:j.map(A=>A.name)}).filter(Boolean),l=[],g=[];return o.length>0&&g.push("Consider adding data filters to datasets with overlapping collections"),((n=a[0])==null?void 0:n.count)>3&&g.push(`Collection "${a[0].collection}" is heavily used - consider optimization`),t.length>10&&g.push("Large number of datasets detected - consider consolidation opportunities"),{mostUsedCollections:a,redundantAssignments:o,schemaConflicts:l,recommendations:g}}calculateHealthScore(s,t){let a=100;for(const o of s)switch(o.conflictLevel){case"high":a-=15;break;case"medium":a-=8;break;case"low":a-=3;break}return a-=t.redundantAssignments.length*5,a-=t.schemaConflicts.length*10,Math.max(0,Math.min(100,a))}assessOverlapConflictLevel(s,t){if(new Set(t.map(l=>l.visibility)).size>1)return"high";const o=t.some(l=>{var g,n;return(n=(g=l.collectionAssignment)==null?void 0:g.dataFilters)==null?void 0:n.some(y=>y.collection===s)});return!o&&t.length>2?"medium":!o&&t.length===2?"low":"none"}assessConflictLevel(s,t,a){var n,y;if(new Set(t.map(j=>j.visibility)).has("public")&&a.visibility!=="public")return"high";const l=t.some(j=>{var b,A;return(A=(b=j.collectionAssignment)==null?void 0:b.dataFilters)==null?void 0:A.some(v=>v.collection===s)}),g=(y=(n=a.collectionAssignment)==null?void 0:n.dataFilters)==null?void 0:y.some(j=>j.collection===s);return!l&&!g?t.length>1?"high":"medium":"low"}getConflictReasons(s,t){const a=[];return new Set(t.map(g=>g.visibility)).size>1&&a.push("Datasets have different visibility levels"),t.some(g=>{var n,y;return(y=(n=g.collectionAssignment)==null?void 0:n.dataFilters)==null?void 0:y.some(j=>j.collection===s)})||a.push("No data filters defined - potential data redundancy"),t.length>3&&a.push("Collection used by many datasets - consider consolidation"),a}getOverlapRecommendations(s,t){const a=[];return t.some(g=>{var n,y;return(y=(n=g.collectionAssignment)==null?void 0:n.dataFilters)==null?void 0:y.some(j=>j.collection===s)})||a.push("Add data filters to differentiate dataset purposes"),t.length>2&&a.push("Consider merging similar datasets to reduce redundancy"),new Set(t.map(g=>g.visibility)).size>1&&a.push("Standardize visibility levels across related datasets"),a}getConflictRecommendation(s,t,a){return t.some(l=>{var g,n;return(n=(g=l.collectionAssignment)==null?void 0:g.dataFilters)==null?void 0:n.some(y=>y.collection===s)})?t.length>2?`Consider merging with existing dataset "${t[0].name}"`:"Review existing usage to avoid data redundancy":"Add data filters to differentiate from existing datasets"}checkRedundancyPatterns(s,t){var l;const a=[],o=[];for(const g of t)if((l=g.collectionAssignment)!=null&&l.selectedCollections){const y=s.filter(j=>g.collectionAssignment.selectedCollections.includes(j)).length/s.length;y>.7&&(a.push({type:"redundancy",severity:"warning",message:`${Math.round(y*100)}% overlap with existing dataset "${g.name}"`,affectedCollections:s,affectedDatasets:[g.name],recommendation:"Consider extending the existing dataset instead of creating a new one"}),o.push({type:"merge",message:`Merge with "${g.name}" to avoid redundancy`,collections:s}))}return{warnings:a,suggestions:o}}checkPerformanceImplications(s,t){const a=[],o=["users","activities","sessions","audit_log"];return s.some(g=>o.includes(g))&&s.length>5&&a.push({type:"performance",severity:"info",message:"Dataset includes large collections - consider performance implications",affectedCollections:s.filter(g=>o.includes(g)),affectedDatasets:[],recommendation:"Add data filters or consider splitting into smaller datasets"}),a}};Ee(Ot,"instance");let mr=Ot;const Sr=mr.getInstance(),Ds={"Core System":{icon:"👥",description:"User management, organizations, and core system data",collections:["users","teamMembers","organizations","roles","projects","projectTeamMembers","clients","contacts","test"],isSystem:!0},"Sessions & Workflows":{icon:"🎬",description:"Production sessions, workflows, and task management",collections:["sessions","sessionWorkflows","sessionAssignments","sessionParticipants","workflowTemplates","workflowDiagrams","workflowInstances","workflowSteps","workflowAssignments","sessionPhaseTransitions","sessionReviews","sessionQc","sessionTasks","demoSessions"],isSystem:!0},"Inventory & Equipment":{icon:"📦",description:"Equipment tracking, network management, and inventory systems",collections:["inventoryItems","inventory","networkIPAssignments","networkIPRanges","networks","inventoryHistory","setupProfiles","schemas","schemaFields","mapLayouts","mapLocations","inventoryMaps","mapData"],isSystem:!0},"Timecards & Scheduling":{icon:"⏰",description:"Time tracking, approvals, and scheduling systems",collections:["timecard_entries","user_timecards","timecard_approvals","timecard_templates"],isSystem:!0},"Media & Content":{icon:"🎥",description:"Media files, production tasks, and content management",collections:["mediaFiles","postProductionTasks","stages","notes","reports","callSheets"],isSystem:!0},"AI & Automation":{icon:"🤖",description:"AI agents, messaging, and automated systems",collections:["aiAgents","messages","chats","messageSessions"],isSystem:!0},"Business & Licensing":{icon:"💼",description:"Licenses, subscriptions, payments, and business data",collections:["licenses","subscriptions","payments","userPreferences"],isSystem:!0},"Production Budget Management":{icon:"💰",description:"Budget tracking, schedules, and financial management",collections:["pbmProjects","pbmSchedules","pbmPayscales","pbmDailyStatus"],isSystem:!0},"Network Delivery & Deliverables":{icon:"📡",description:"Network delivery bibles, deliverables, and post-production workflows",collections:["networkDeliveryBibles","deliverables","networkDeliveryChats","deliverySpecs","deliveryTemplates","deliveryTracking"],isSystem:!0,isDynamic:!0}},Pt=class Pt{constructor(){Ee(this,"cache",new Map);Ee(this,"CACHE_TTL",5*60*1e3);Ee(this,"DISCOVERY_ENDPOINT","https://api-oup5qxogca-uc.a.run.app/collections/discover");Ee(this,"SYNC_ENDPOINT","https://api-oup5qxogca-uc.a.run.app/collections/sync-metadata");Ee(this,"listeners",new Map);Ee(this,"callbacks",new Map)}static getInstance(){return Pt.instance||(Pt.instance=new Pt),Pt.instance}async discoverCollections(s,t){const a=`collections_${s||"global"}`,o=this.getCachedResult(a);if(o)return console.log("🎯 [DynamicCollectionDiscovery] Using cached collections"),o;try{if(t){const g=await this.discoverFromFirebase(s,t);if(g)return this.setCachedResult(a,g),g}}catch(g){console.warn("⚠️ [DynamicCollectionDiscovery] Dynamic discovery failed, falling back to static:",g)}const l={collections:Ds,totalCollections:this.getTotalCollectionCount(Ds),lastUpdated:new Date,source:"static"};return this.setCachedResult(a,l),l}async discoverFromFirebase(s,t){try{if(console.log("🔍 [DynamicCollectionDiscovery] Discovering collections from Firebase Admin SDK..."),!t)return console.warn("⚠️ [DynamicCollectionDiscovery] No auth token provided for collection discovery"),null;const a=await fetch(this.DISCOVERY_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({organizationId:s,includeMetadata:!0,categorize:!0})});if(!a.ok)throw new Error(`Collection discovery API failed: ${a.status} ${a.statusText}`);const o=await a.json();if(!o.success)throw new Error(`Collection discovery failed: ${o.error}`);const l={collections:o.collections,totalCollections:o.totalCollections,lastUpdated:new Date(o.lastUpdated),source:"dynamic"};return console.log(`✅ [DynamicCollectionDiscovery] Discovered ${l.totalCollections} collections across ${Object.keys(o.collections).length} categories from Admin SDK`),l}catch(a){return console.error("❌ [DynamicCollectionDiscovery] Firebase Admin SDK discovery failed:",a),null}}processDiscoveredCollections(s){const t={};for(const[l,g]of Object.entries(Ds))t[l]={...g,collections:[...g.collections]};const a=new Set(Object.values(t).flatMap(l=>l.collections)),o=s.filter(l=>!a.has(l)&&this.isValidCollectionName(l));for(const l of o){const g=this.categorizeCollection(l);t[g]?(t[g].collections.push(l),t[g].isDynamic=!0):t["Custom Collections"]={icon:"🔧",description:"Custom and dynamically discovered collections",collections:[l],isDynamic:!0}}return t}categorizeCollection(s){const t=s.toLowerCase();return t.includes("delivery")||t.includes("deliverable")||t.includes("bible")||t.includes("network")&&(t.includes("delivery")||t.includes("spec"))?"Network Delivery & Deliverables":t.includes("session")||t.includes("workflow")||t.includes("task")||t.includes("assignment")&&t.includes("session")?"Sessions & Workflows":t.includes("media")||t.includes("video")||t.includes("audio")||t.includes("production")||t.includes("stage")||t.includes("call")||t.includes("post")&&t.includes("production")?"Media & Content":t.includes("inventory")||t.includes("equipment")||t.includes("network")||t.includes("ip")||t.includes("map")||t.includes("location")||t.includes("setup")||t.includes("schema")?"Inventory & Equipment":t.includes("user")||t.includes("team")||t.includes("member")||t.includes("role")||t.includes("organization")||t.includes("client")||t.includes("contact")?"Core System":t.includes("timecard")||t.includes("schedule")||t.includes("time")||t.includes("approval")||t.includes("template")&&t.includes("time")?"Timecards & Scheduling":t.includes("ai")||t.includes("agent")||t.includes("message")||t.includes("chat")||t.includes("bot")?"AI & Automation":t.includes("license")||t.includes("subscription")||t.includes("payment")||t.includes("billing")||t.includes("invoice")?"Business & Licensing":t.includes("pbm")||t.includes("budget")||t.includes("payscale")||t.includes("daily")&&t.includes("status")?"Production Budget Management":"Custom Collections"}isValidCollectionName(s){return!s.startsWith("_")&&!s.includes("_backup")&&!s.includes("_temp")&&!s.includes("_cache")&&!s.startsWith("firebase-")&&s.length>0}getCachedResult(s){const t=this.cache.get(s);return t&&Date.now()-t.lastUpdated.getTime()<this.CACHE_TTL?{...t,source:"cached"}:null}setCachedResult(s,t){this.cache.set(s,t)}clearCache(){this.cache.clear(),console.log("🗑️ [DynamicCollectionDiscovery] Cache cleared")}setupRealTimeMonitoring(s,t,a){const o=`${s||"global"}_${Date.now()}`;console.log(`🔄 [DynamicCollectionDiscovery] Setting up real-time listener: ${o}`),this.syncCollectionsMetadata(t).catch(n=>{console.warn("⚠️ [DynamicCollectionDiscovery] Initial metadata sync failed:",n)});const l=Rt(Xe,"_collections_metadata","current"),g=ca(l,async n=>{var y;try{if(console.log("🔄 [DynamicCollectionDiscovery] Collections metadata changed, updating..."),n.exists()){const j=n.data(),b=j.collections||[],A=this.processDiscoveredCollections(b),v={collections:A,totalCollections:this.getTotalCollectionCount(A),lastUpdated:((y=j.lastUpdated)==null?void 0:y.toDate())||new Date,source:"dynamic"},S=`collections_${s||"global"}`;this.setCachedResult(S,v),a&&a(v),console.log(`✅ [DynamicCollectionDiscovery] Updated ${v.totalCollections} collections via listener`)}else console.log("📋 [DynamicCollectionDiscovery] Collections metadata document does not exist, creating..."),await this.syncCollectionsMetadata(t)}catch(j){console.error("❌ [DynamicCollectionDiscovery] Error processing collections update:",j)}},n=>{console.error("❌ [DynamicCollectionDiscovery] Firestore listener error:",n)});return this.listeners.set(o,g),a&&this.callbacks.set(o,a),()=>{console.log(`🛑 [DynamicCollectionDiscovery] Stopping real-time listener: ${o}`);const n=this.listeners.get(o);n&&(n(),this.listeners.delete(o)),this.callbacks.delete(o)}}async syncCollectionsMetadata(s){if(!s){console.warn("⚠️ [DynamicCollectionDiscovery] No auth token for metadata sync");return}try{const t=await fetch(this.SYNC_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});t.ok?console.log("✅ [DynamicCollectionDiscovery] Collections metadata synced"):console.warn("⚠️ [DynamicCollectionDiscovery] Metadata sync failed:",t.status)}catch(t){console.error("❌ [DynamicCollectionDiscovery] Error syncing metadata:",t)}}getTotalCollectionCount(s){return Object.values(s).reduce((t,a)=>t+a.collections.length,0)}getStaticCollections(){return Ds}async triggerSync(s){console.log("🔄 [DynamicCollectionDiscovery] Manually triggering collection sync..."),await this.syncCollectionsMetadata(s)}cleanup(){console.log("🧹 [DynamicCollectionDiscovery] Cleaning up all listeners..."),this.listeners.forEach((s,t)=>{console.log(`🛑 [DynamicCollectionDiscovery] Cleaning up listener: ${t}`),s()}),this.listeners.clear(),this.callbacks.clear()}};Ee(Pt,"instance");let gr=Pt;const $t=gr.getInstance(),pr=u=>Object.values(u).flatMap(s=>s.collections),Mi=(u,s)=>{var t;return((t=u[s])==null?void 0:t.collections)||[]},Oi=(u,s)=>{for(const[t,a]of Object.entries(u))if(a.collections.includes(s))return t;return null},Pi=(u,s)=>pr(u).includes(s),da=u=>{const{user:s}=yr(),[t,a]=d.useState(null),[o,l]=d.useState(!0),[g,n]=d.useState(null),[y,j]=d.useState(null),b=d.useCallback(async()=>{if(!s){l(!1);return}try{l(!0),n(null),console.log("🔍 [useDynamicCollections] Discovering collections...");const _=Vs.getStoredToken()||void 0,ae=await $t.discoverCollections(u||s.organizationId||s.id,_);a(ae),console.log(`✅ [useDynamicCollections] Loaded ${ae.totalCollections} collections from ${ae.source} source`)}catch(_){const ae=_ instanceof Error?_.message:"Failed to discover collections";console.error("❌ [useDynamicCollections] Discovery failed:",_),n(ae);const Y=$t.getStaticCollections();a({collections:Y,totalCollections:pr(Y).length,lastUpdated:new Date,source:"static"})}finally{l(!1)}},[s,u]);d.useEffect(()=>{b()},[b]);const A=d.useCallback(async()=>{$t.clearCache(),await b()},[b]),v=d.useCallback(()=>{$t.clearCache()},[]),S=d.useCallback(()=>{if(y){console.log("🔄 [useDynamicCollections] Real-time monitoring already active");return}console.log("🔄 [useDynamicCollections] Starting real-time collection monitoring...");const _=Vs.getStoredToken()||void 0,ae=$t.setupRealTimeMonitoring((s==null?void 0:s.organizationId)||(s==null?void 0:s.id),_,Y=>{console.log("🔄 [useDynamicCollections] Collections updated via real-time monitoring"),a(Y),n(null)});j(()=>ae)},[y,u,s]),W=d.useCallback(()=>{y&&(console.log("🛑 [useDynamicCollections] Stopping real-time collection monitoring..."),y(),j(null))},[y]),G=d.useCallback(async()=>{console.log("🔄 [useDynamicCollections] Manually triggering collection sync...");const _=Vs.getStoredToken()||void 0;await $t.triggerSync(_)},[]),X=d.useCallback(_=>t?Mi(t.collections,_):[],[t]),ne=d.useCallback(_=>t?Oi(t.collections,_):null,[t]),I=d.useCallback(_=>t?Pi(t.collections,_):!1,[t]);return d.useEffect(()=>()=>{y&&y()},[y]),{collections:(t==null?void 0:t.collections)||{},allCollections:t?pr(t.collections):[],totalCount:(t==null?void 0:t.totalCollections)||0,loading:o,error:g,lastUpdated:(t==null?void 0:t.lastUpdated)||null,source:(t==null?void 0:t.source)||"static",refresh:A,clearCache:v,startRealTimeMonitoring:S,stopRealTimeMonitoring:W,triggerSync:G,getCollectionsByCategory:X,getCategoryForCollection:ne,isValidCollection:I}},ki=(u={})=>{const{initialSearchQuery:s="",initialCategory:t="all",initialShowSelectedOnly:a=!1,initialSortBy:o="name",initialSortOrder:l="asc",debounceMs:g=300}=u,[n,y]=d.useState(s),[j,b]=d.useState(t),[A,v]=d.useState(a),[S,W]=d.useState(o),[G,X]=d.useState(l),ne=d.useMemo(()=>n.trim()!==""||j!=="all"||A,[n,j,A]),I=d.useCallback(()=>{y(""),b("all"),v(!1)},[]),_=d.useCallback(()=>{y(s),b(t),v(a),W(o),X(l)},[s,t,a,o,l]);return{state:{searchQuery:n,selectedCategory:j,showSelectedOnly:A,sortBy:S,sortOrder:G},actions:{setSearchQuery:y,setSelectedCategory:b,setShowSelectedOnly:v,setSortBy:W,setSortOrder:X,clearFilters:I,resetToDefaults:_},isFiltered:ne}},ua=(u,s,t={})=>{const{state:a,actions:o,isFiltered:l}=ki(t),g=d.useMemo(()=>{const b={};return Object.entries(u).forEach(([A,v])=>{v.collections.forEach(S=>{[S.toLowerCase(),A.toLowerCase(),v.description.toLowerCase(),...S.toLowerCase().split("_"),...S.toLowerCase().split(/(?=[A-Z])/),...A.toLowerCase().split(" ")].forEach(G=>{G.length>1&&(b[G]||(b[G]=[]),b[G].includes(S)||b[G].push(S))})})}),b},[u]),n=d.useMemo(()=>{let b={};return Object.entries(u).forEach(([A,v])=>{let S=v.collections;if(a.searchQuery.trim()){const G=a.searchQuery.toLowerCase().trim().split(" ").filter(X=>X.length>0);S=S.filter(X=>G.every(ne=>{var I;return X.toLowerCase().includes(ne)||A.toLowerCase().includes(ne)||v.description.toLowerCase().includes(ne)?!0:((I=g[ne])==null?void 0:I.includes(X))||!1}))}a.selectedCategory&&a.selectedCategory!=="all"&&A!==a.selectedCategory||(a.showSelectedOnly&&(S=S.filter(W=>s.includes(W))),S.length>0&&(b[A]={...v,collections:S}))}),b},[u,a,s,g]),y=d.useCallback((b,A=10)=>{if(!b.trim())return[];const v=new Set;return b.toLowerCase().trim().split(" ").filter(W=>W.length>0).forEach(W=>{Object.values(u).forEach(G=>{G.collections.forEach(X=>{X.toLowerCase().startsWith(W)&&v.add(X)})}),Object.values(u).forEach(G=>{G.collections.forEach(X=>{X.toLowerCase().includes(W)&&!X.toLowerCase().startsWith(W)&&v.add(X)})})}),Array.from(v).slice(0,A)},[u]),j=d.useCallback(()=>{const b=Object.values(u).reduce((S,W)=>S+W.collections.length,0),A=Object.values(n).reduce((S,W)=>S+W.collections.length,0),v=Object.values(n).reduce((S,W)=>S+W.collections.filter(G=>s.includes(G)).length,0);return{totalAvailable:b,totalFiltered:A,selectedFiltered:v,totalSelected:s.length,isFiltered:l}},[u,n,s,l]);return{state:a,actions:o,filteredCollections:n,getSearchSuggestions:y,getStatistics:j,isFiltered:l}},ma=({collections:u,allCollections:s,selectedCollections:t,searchQuery:a,selectedCategory:o,showSelectedOnly:l,onSearchChange:g,onCategoryChange:n,onShowSelectedOnlyChange:y,onCollectionToggle:j,onSelectAll:b,onDeselectAll:A,onRefresh:v,onSelectAllInCategory:S,onDeselectAllInCategory:W,loading:G=!1,error:X=null,totalCount:ne=0,selectedCount:I=0,variant:_="wizard",compact:ae=!1})=>{const Y=d.useMemo(()=>{let q={};return Object.entries(u).forEach(([V,je])=>{let ie=je.collections;if(a.trim()){const pe=a.toLowerCase().trim();ie=ie.filter(oe=>oe.toLowerCase().includes(pe)||V.toLowerCase().includes(pe)||je.description.toLowerCase().includes(pe))}o&&o!=="all"&&V!==o||(l&&(ie=ie.filter(pe=>t.includes(pe))),ie.length>0&&(q[V]={...je,collections:ie}))}),q},[u,a,o,l,t]),we=d.useMemo(()=>Object.keys(u).map(q=>({value:q,label:q,count:u[q].collections.length})),[u]),ee=d.useMemo(()=>{const q=Object.values(Y).reduce((je,ie)=>je+ie.collections.length,0),V=Object.values(Y).reduce((je,ie)=>je+ie.collections.filter(pe=>t.includes(pe)).length,0);return{totalFiltered:q,selectedFiltered:V,totalAvailable:s.length,totalSelected:t.length}},[Y,t,s]),ve=d.useCallback(()=>{g(""),n("all"),y(!1)},[g,n,y]),se=d.useCallback(()=>{Object.values(Y).flatMap(V=>V.collections).forEach(V=>{t.includes(V)||j(V)})},[Y,t,j]),de=d.useCallback(()=>{Object.values(Y).flatMap(V=>V.collections).forEach(V=>{t.includes(V)&&j(V)})},[Y,t,j]);return e.jsxs(c,{sx:{width:"100%"},children:[e.jsxs(Ze,{elevation:_==="dialog"?2:0,sx:{p:ae?2:3,mb:2,backgroundColor:_==="dialog"?"background.paper":"transparent",borderRadius:_==="dialog"?2:0},children:[e.jsxs(x,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(x,{item:!0,xs:12,md:6,children:e.jsx(fe,{fullWidth:!0,placeholder:"Search collections by name, category, or description...",value:a,onChange:q=>g(q.target.value),InputProps:{startAdornment:e.jsx(Os,{position:"start",children:e.jsx(us,{sx:{color:"text.secondary"}})}),endAdornment:a&&e.jsx(Os,{position:"end",children:e.jsx(et,{size:"small",onClick:()=>g(""),edge:"end",children:e.jsx(Ur,{})})})},size:ae?"small":"medium",disabled:G})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsxs(Fe,{fullWidth:!0,size:ae?"small":"medium",children:[e.jsx($e,{children:"Category"}),e.jsxs(Ge,{value:o,onChange:q=>n(q.target.value),disabled:G,children:[e.jsx(w,{value:"all",children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Va,{fontSize:"small"}),"All Categories (",ne,")"]})}),we.map(q=>e.jsx(w,{value:q.value,children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(i,{variant:"body2",sx:{flex:1},children:q.label}),e.jsx(F,{label:q.count,size:"small",sx:{ml:"auto",height:20,fontSize:"0.7rem"}})]})},q.value))]})]})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsxs(c,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(rs,{title:"Refresh collections",children:e.jsx(et,{onClick:v,disabled:G,size:ae?"small":"medium",children:e.jsx(Ns,{})})}),e.jsx(rs,{title:"Clear all filters",children:e.jsx(et,{onClick:ve,disabled:!a&&o==="all"&&!l,size:ae?"small":"medium",children:e.jsx(Ur,{})})})]})})]}),e.jsxs(c,{sx:{mt:2,display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(Be,{control:e.jsx(ar,{checked:l,onChange:q=>y(q.target.checked),size:"small"}),label:"Show selected only"}),e.jsx(ms,{orientation:"vertical",flexItem:!0}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{size:"small",startIcon:e.jsx($r,{}),onClick:se,disabled:G||ee.selectedFiltered===ee.totalFiltered,children:"Select All Visible"}),e.jsx(B,{size:"small",startIcon:e.jsx(Gr,{}),onClick:de,disabled:G||ee.selectedFiltered===0,children:"Deselect All Visible"})]})]}),e.jsxs(c,{sx:{mt:2,display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(F,{icon:e.jsx(Vr,{}),label:`${ee.totalSelected} of ${ee.totalAvailable} selected`,color:"primary",variant:"outlined",size:"small"}),a||o!=="all"||l?e.jsx(F,{icon:e.jsx(Ha,{}),label:`${ee.selectedFiltered} of ${ee.totalFiltered} visible`,color:"secondary",variant:"outlined",size:"small"}):null]})]}),X&&e.jsx(be,{severity:"error",sx:{mb:2},children:X}),Object.keys(Y).length===0?e.jsxs(c,{sx:{textAlign:"center",py:4,color:"text.secondary"},children:[e.jsx(Vr,{sx:{fontSize:48,mb:2,opacity:.5}}),e.jsx(i,{variant:"h6",gutterBottom:!0,children:"No collections found"}),e.jsx(i,{variant:"body2",children:a||o!=="all"||l?"Try adjusting your search or filter criteria":"No collections are available for selection"})]}):e.jsx(c,{sx:{display:"flex",flexDirection:"column",gap:2},children:Object.entries(Y).map(([q,V])=>{const je=V.collections.filter(oe=>t.includes(oe)),ie=je.length===V.collections.length,pe=je.length>0&&je.length<V.collections.length;return e.jsxs(Ze,{elevation:1,sx:{p:2,backgroundColor:"background.paper",borderRadius:2,border:"1px solid",borderColor:"divider"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(i,{variant:"h6",sx:{fontSize:"1.1rem"},children:[V.icon," ",q]}),e.jsx(F,{label:`${je.length}/${V.collections.length}`,size:"small",color:ie?"success":pe?"warning":"default",variant:"outlined"})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"caption",sx:{color:"text.secondary",maxWidth:"300px",textAlign:"right"},children:V.description}),e.jsxs(c,{sx:{display:"flex",gap:.5,ml:1},children:[e.jsx(rs,{title:`Select all ${q} collections`,children:e.jsx(et,{size:"small",onClick:()=>{S&&S(q,V.collections)},disabled:ie||G,color:"primary",sx:{opacity:ie?.5:1,"&:hover":{backgroundColor:"primary.main",color:"primary.contrastText"}},children:e.jsx($r,{fontSize:"small"})})}),e.jsx(rs,{title:`Deselect all ${q} collections`,children:e.jsx(et,{size:"small",onClick:()=>{W&&W(q,V.collections)},disabled:je.length===0||G,color:"secondary",sx:{opacity:je.length===0?.5:1,"&:hover":{backgroundColor:"secondary.main",color:"secondary.contrastText"}},children:e.jsx(Gr,{fontSize:"small"})})})]})]})]}),e.jsx(x,{container:!0,spacing:1,children:V.collections.map(oe=>{const Se=t.includes(oe);return e.jsx(x,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(c,{onClick:()=>j(oe),sx:{p:1.5,border:"2px solid",borderColor:Se?"primary.main":"divider",borderRadius:1,backgroundColor:Se?"primary.main":"background.default",color:Se?"primary.contrastText":"text.primary",cursor:"pointer",transition:"all 0.2s ease-in-out","&:hover":{borderColor:Se?"primary.dark":"primary.light",backgroundColor:Se?"primary.dark":"action.hover",transform:"translateY(-1px)",boxShadow:2},display:"flex",alignItems:"center",gap:1},children:[e.jsx(ar,{checked:Se,size:"small",sx:{color:Se?"inherit":"text.secondary","&.Mui-checked":{color:"inherit"}}}),e.jsx(i,{variant:"body2",sx:{fontWeight:Se?600:400,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:oe})]})},oe)})})]},q)})})]})},er=["Basic Information","Cloud Provider Selection","Authentication Setup","Storage Configuration","Collection Assignment","Advanced Options","Review & Create"],tr={name:"",description:"",visibility:"private",tags:[],cloudProvider:"firestore",authentication:{},storage:{backend:"firestore"},schema:{template:"custom",customFields:[]},collectionAssignment:{selectedCollections:[],includeSubcollections:!1,dataFilters:[],organizationScope:!0},advanced:{encryption:!1,compression:!1,backup:!0,versioning:!1,accessLogging:!1}},zi=la.memo(({open:u,onClose:s,onSuccess:t,preselectedProvider:a,assignToProject:o})=>{var C,De;const[l,g]=d.useState(0),[n,y]=d.useState(tr),[j,b]=d.useState(!1),[A,v]=d.useState(null),[S,W]=d.useState({}),[G,X]=d.useState({}),[ne,I]=d.useState(!1),[_,ae]=d.useState(null),[Y,we]=d.useState(null),[ee,ve]=d.useState([]),[se,de]=d.useState(!1),{collections:q,allCollections:V,loading:je,error:ie,refresh:pe,startRealTimeMonitoring:oe,stopRealTimeMonitoring:Se}=da(),{state:Ae,actions:We}=ua(q,((C=n.collectionAssignment)==null?void 0:C.selectedCollections)||[],{initialSearchQuery:"",initialCategory:"all",initialShowSelectedOnly:!1}),Me=d.useCallback(()=>{const z=a||"firestore",L=z==="azure-blob"?"azure":z;y({...tr,cloudProvider:z,storage:{...tr.storage,backend:L}}),g(0),v(null),W({}),X({}),ae(null)},[a]);d.useEffect(()=>{u&&Me()},[u,Me]),d.useEffect(()=>{if(u)return console.log("🔄 [DatasetCreationWizard] Starting real-time collection monitoring..."),oe(),()=>{console.log("🛑 [DatasetCreationWizard] Stopping real-time collection monitoring..."),Se()}},[u,oe,Se]);const J=d.useCallback(z=>{y(ue=>({...ue,...z}));const L={...S};Object.keys(z).forEach(ue=>{delete L[ue]}),W(L)},[S]),T=d.useCallback(z=>{var ue,ze,Ue,_e,he,Le,ht,it,Et;const L={};switch(z){case 0:n.name.trim()||(L.name="Dataset name is required"),n.name.length>100&&(L.name="Dataset name must be 100 characters or less");break;case 1:n.cloudProvider||(L.cloudProvider="Please select a cloud provider");break;case 2:(n.cloudProvider==="firestore"||n.cloudProvider==="gcs")&&((ue=n.authentication.projectId)!=null&&ue.trim()||(L.projectId="Project ID is required for Google Cloud services")),(n.cloudProvider==="s3"||n.cloudProvider==="aws")&&((ze=n.authentication.accessKeyId)!=null&&ze.trim()||(L.accessKeyId="Access Key ID is required for AWS services"),(Ue=n.authentication.secretAccessKey)!=null&&Ue.trim()||(L.secretAccessKey="Secret Access Key is required for AWS services")),n.cloudProvider==="azure-blob"&&((_e=n.authentication.connectionString)!=null&&_e.trim()||(L.connectionString="Connection string is required for Azure services"));break;case 3:n.cloudProvider==="gcs"&&!((he=n.storage.gcsBucket)!=null&&he.trim())&&(L.gcsBucket="GCS bucket name is required"),n.cloudProvider==="s3"&&!((Le=n.storage.s3Bucket)!=null&&Le.trim())&&(L.s3Bucket="S3 bucket name is required"),n.cloudProvider==="azure-blob"&&!((ht=n.storage.azureContainer)!=null&&ht.trim())&&(L.azureContainer="Azure container name is required");break;case 4:n.cloudProvider==="firestore"&&((Et=(it=n.collectionAssignment)==null?void 0:it.selectedCollections)!=null&&Et.length||(L.collections="Please select at least one Firestore collection for this dataset"));break}return W(L),Object.keys(L).length===0},[n]),h=d.useCallback(()=>{T(l)&&g(z=>Math.min(z+1,er.length-1))},[l,T]),P=d.useCallback(()=>{g(z=>Math.max(z-1,0))},[]),K=d.useCallback(z=>{z<l&&g(z)},[l]),Z=d.useCallback(z=>{X(L=>({...L,[z]:!L[z]}))},[]),ye=d.useCallback(async()=>{if(n.cloudProvider){I(!0),ae(null);try{await new Promise(z=>setTimeout(z,2e3)),ae({success:!0,message:"Connection test successful!"})}catch(z){ae({success:!1,message:`Connection test failed: ${z instanceof Error?z.message:"Unknown error"}`})}finally{I(!1)}}},[n.cloudProvider]),le=d.useCallback(async()=>{if(T(l)){b(!0),v(null);try{const z=await Re.createDataset({name:n.name,description:n.description,visibility:n.visibility,tags:n.tags,storage:n.storage,schema:n.schema,projectId:o||"default-project",collectionAssignment:n.cloudProvider==="firestore"?n.collectionAssignment:void 0});z?(t==null||t(z),s==null||s()):v("Failed to create dataset: No dataset returned")}catch(z){v(`Failed to create dataset: ${z instanceof Error?z.message:"Unknown error"}`)}finally{b(!1)}}},[l,T,n,t,s]),re=d.useCallback(async()=>{try{const z=await Re.listDatasets();ve(z),console.log("✅ [DatasetCreationWizard] Loaded existing datasets for conflict analysis:",z.length)}catch(z){console.warn("⚠️ [DatasetCreationWizard] Failed to load existing datasets:",z),ve([])}},[]),k=d.useCallback(async()=>{var z,L;if(n.cloudProvider!=="firestore"||!((L=(z=n.collectionAssignment)==null?void 0:z.selectedCollections)!=null&&L.length)){we(null);return}de(!0);try{const ue=await Sr.checkDatasetCreationConflicts({name:n.name,collectionAssignment:n.collectionAssignment},ee);we(ue),console.log("✅ [DatasetCreationWizard] Conflict check complete:",ue)}catch(ue){console.error("❌ [DatasetCreationWizard] Failed to check conflicts:",ue),we(null)}finally{de(!1)}},[n.cloudProvider,n.name,n.collectionAssignment,ee]),te=d.useCallback(z=>{var ze,Ue,_e,he;const L=((ze=n.collectionAssignment)==null?void 0:ze.selectedCollections)||[],ue=L.includes(z)?L.filter(Le=>Le!==z):[...L,z];J({collectionAssignment:{...n.collectionAssignment,selectedCollections:ue,includeSubcollections:((Ue=n.collectionAssignment)==null?void 0:Ue.includeSubcollections)||!1,dataFilters:((_e=n.collectionAssignment)==null?void 0:_e.dataFilters)||[],organizationScope:((he=n.collectionAssignment)==null?void 0:he.organizationScope)!==!1}})},[n.collectionAssignment,J]),Ie=d.useCallback(()=>{var z,L,ue;J({collectionAssignment:{...n.collectionAssignment,selectedCollections:V,includeSubcollections:((z=n.collectionAssignment)==null?void 0:z.includeSubcollections)||!1,dataFilters:((L=n.collectionAssignment)==null?void 0:L.dataFilters)||[],organizationScope:((ue=n.collectionAssignment)==null?void 0:ue.organizationScope)!==!1}})},[n.collectionAssignment,J,V]),f=d.useCallback(()=>{var z,L,ue;J({collectionAssignment:{...n.collectionAssignment,selectedCollections:[],includeSubcollections:((z=n.collectionAssignment)==null?void 0:z.includeSubcollections)||!1,dataFilters:((L=n.collectionAssignment)==null?void 0:L.dataFilters)||[],organizationScope:((ue=n.collectionAssignment)==null?void 0:ue.organizationScope)!==!1}})},[n.collectionAssignment,J]),O=d.useCallback((z,L)=>{var Ue,_e,he,Le;const ue=((Ue=n.collectionAssignment)==null?void 0:Ue.selectedCollections)||[],ze=[...new Set([...ue,...L])];J({collectionAssignment:{...n.collectionAssignment,selectedCollections:ze,includeSubcollections:((_e=n.collectionAssignment)==null?void 0:_e.includeSubcollections)||!1,dataFilters:((he=n.collectionAssignment)==null?void 0:he.dataFilters)||[],organizationScope:((Le=n.collectionAssignment)==null?void 0:Le.organizationScope)!==!1}})},[n.collectionAssignment,J]),R=d.useCallback((z,L)=>{var Ue,_e,he,Le;const ze=(((Ue=n.collectionAssignment)==null?void 0:Ue.selectedCollections)||[]).filter(ht=>!L.includes(ht));J({collectionAssignment:{...n.collectionAssignment,selectedCollections:ze,includeSubcollections:((_e=n.collectionAssignment)==null?void 0:_e.includeSubcollections)||!1,dataFilters:((he=n.collectionAssignment)==null?void 0:he.dataFilters)||[],organizationScope:((Le=n.collectionAssignment)==null?void 0:Le.organizationScope)!==!1}})},[n.collectionAssignment,J]);d.useEffect(()=>{u&&re()},[u,re]),d.useEffect(()=>{var z,L;if(l===4&&((L=(z=n.collectionAssignment)==null?void 0:z.selectedCollections)!=null&&L.length)){const ue=setTimeout(()=>{k()},500);return()=>clearTimeout(ue)}},[l,(De=n.collectionAssignment)==null?void 0:De.selectedCollections,k]);const M=d.useCallback(z=>{var L,ue,ze,Ue,_e,he,Le,ht,it,Et,ps,hs,Ht,yt,wt,Ft,Ut,nt,Dt,Tt;switch(z){case 0:return e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Basic Information"}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Dataset Name",value:n.name,onChange:N=>J({name:N.target.value}),error:!!S.name,helperText:S.name,required:!0})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Description (Optional)",value:n.description||"",onChange:N=>J({description:N.target.value}),multiline:!0,rows:3})}),e.jsx(x,{item:!0,xs:12,children:e.jsxs(Fe,{fullWidth:!0,children:[e.jsx(Ka,{children:"Visibility"}),e.jsxs(Qa,{value:n.visibility,onChange:N=>J({visibility:N.target.value}),row:!0,children:[e.jsx(Be,{value:"private",control:e.jsx(Hs,{}),label:"Private"}),e.jsx(Be,{value:"organization",control:e.jsx(Hs,{}),label:"Organization"}),e.jsx(Be,{value:"public",control:e.jsx(Hs,{}),label:"Public"})]})]})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Tags (Optional)",value:((L=n.tags)==null?void 0:L.join(", "))||"",onChange:N=>J({tags:N.target.value.split(",").map(Oe=>Oe.trim()).filter(Oe=>Oe.length>0)}),placeholder:"tag1, tag2, tag3",helperText:"Comma-separated tags for organization"})})]})]});case 1:return e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Cloud Provider Selection"}),e.jsx(x,{container:!0,spacing:2,children:[{value:"firestore",label:"Firestore",icon:e.jsx(os,{}),description:"Google Cloud Firestore"},{value:"gcs",label:"Google Cloud Storage",icon:e.jsx(He,{}),description:"Google Cloud Storage"},{value:"s3",label:"Amazon S3",icon:e.jsx(os,{}),description:"Amazon S3"},{value:"aws",label:"AWS Services",icon:e.jsx(os,{}),description:"AWS Services"},{value:"azure-blob",label:"Azure Blob Storage",icon:e.jsx(He,{}),description:"Microsoft Azure"},{value:"local",label:"Local Storage",icon:e.jsx(ir,{}),description:"Local file system"}].map(N=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(ge,{sx:{cursor:"pointer",border:n.cloudProvider===N.value?"2px solid":"1px solid",borderColor:n.cloudProvider===N.value?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>{const Oe=N.value,tt=Oe==="azure-blob"?"azure":Oe;J({cloudProvider:Oe,storage:{...n.storage,backend:tt}})},children:e.jsxs(Ce,{sx:{textAlign:"center",p:2},children:[e.jsx(c,{sx:{mb:1},children:N.icon}),e.jsx(i,{variant:"subtitle1",sx:{fontWeight:600},children:N.label}),e.jsx(i,{variant:"body2",color:"text.secondary",children:N.description})]})})},N.value))})]});case 2:return e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Authentication Setup"}),n.cloudProvider==="firestore"||n.cloudProvider==="gcs"?e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Project ID",value:n.authentication.projectId||"",onChange:N=>J({authentication:{...n.authentication,projectId:N.target.value}}),error:!!S.projectId,helperText:S.projectId,required:!0})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Service Account Key (Optional)",value:n.authentication.serviceAccountKey||"",onChange:N=>J({authentication:{...n.authentication,serviceAccountKey:N.target.value}}),multiline:!0,rows:4,placeholder:"Paste your service account JSON key here..."})})]}):n.cloudProvider==="s3"||n.cloudProvider==="aws"?e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Access Key ID",value:n.authentication.accessKeyId||"",onChange:N=>J({authentication:{...n.authentication,accessKeyId:N.target.value}}),error:!!S.accessKeyId,helperText:S.accessKeyId,required:!0})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Secret Access Key",value:n.authentication.secretAccessKey||"",onChange:N=>J({authentication:{...n.authentication,secretAccessKey:N.target.value}}),error:!!S.secretAccessKey,helperText:S.secretAccessKey,required:!0,type:G.secretAccessKey?"text":"password",InputProps:{endAdornment:e.jsx(Os,{position:"end",children:e.jsx(et,{onClick:()=>Z("secretAccessKey"),edge:"end",children:G.secretAccessKey?e.jsx(Ya,{}):e.jsx(aa,{})})})}})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Region",value:n.authentication.region||"",onChange:N=>J({authentication:{...n.authentication,region:N.target.value}}),placeholder:"us-east-1"})})]}):n.cloudProvider==="azure-blob"?e.jsx(x,{container:!0,spacing:3,children:e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Connection String",value:n.authentication.connectionString||"",onChange:N=>J({authentication:{...n.authentication,connectionString:N.target.value}}),error:!!S.connectionString,helperText:S.connectionString,required:!0,multiline:!0,rows:3,placeholder:"DefaultEndpointsProtocol=https;AccountName=..."})})}):e.jsx(i,{color:"text.secondary",children:"No authentication required for local storage."}),n.cloudProvider!=="local"&&e.jsxs(c,{sx:{mt:3},children:[e.jsx(B,{variant:"outlined",onClick:ye,disabled:ne,startIcon:ne?e.jsx(pt,{size:16}):e.jsx(vr,{}),children:ne?"Testing Connection...":"Test Connection"}),_&&e.jsx(be,{severity:_.success?"success":"error",sx:{mt:2},children:_.message})]})]});case 3:return e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Storage Configuration"}),n.cloudProvider==="gcs"&&e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"GCS Bucket Name",value:n.storage.gcsBucket||"",onChange:N=>J({storage:{...n.storage,gcsBucket:N.target.value}}),error:!!S.gcsBucket,helperText:S.gcsBucket,required:!0,placeholder:"my-dataset-bucket"})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Prefix (Optional)",value:n.storage.gcsPrefix||"",onChange:N=>J({storage:{...n.storage,gcsPrefix:N.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),n.cloudProvider==="s3"&&e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"S3 Bucket Name",value:n.storage.s3Bucket||"",onChange:N=>J({storage:{...n.storage,s3Bucket:N.target.value}}),error:!!S.s3Bucket,helperText:S.s3Bucket,required:!0,placeholder:"my-dataset-bucket"})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Region",value:n.storage.s3Region||"",onChange:N=>J({storage:{...n.storage,s3Region:N.target.value}}),placeholder:"us-east-1"})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Prefix (Optional)",value:n.storage.s3Prefix||"",onChange:N=>J({storage:{...n.storage,s3Prefix:N.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),n.cloudProvider==="azure-blob"&&e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Container Name",value:n.storage.azureContainer||"",onChange:N=>J({storage:{...n.storage,azureContainer:N.target.value}}),error:!!S.azureContainer,helperText:S.azureContainer,required:!0,placeholder:"datasets"})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,label:"Prefix (Optional)",value:n.storage.azurePrefix||"",onChange:N=>J({storage:{...n.storage,azurePrefix:N.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),n.cloudProvider==="local"&&e.jsx(i,{color:"text.secondary",children:"Local storage will be configured automatically based on your system settings."}),e.jsxs(be,{severity:"info",sx:{mt:3},children:[e.jsx(i,{variant:"subtitle2",sx:{fontWeight:600,mb:.5},children:"Using Backbone Logic Unified Schema"}),e.jsx(i,{variant:"body2",children:"The standard Backbone Logic schema will be automatically applied to this dataset. This ensures full compatibility with all application features and provides a consistent data structure."})]})]});case 4:return e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Collection Assignment"}),n.cloudProvider==="firestore"?e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(be,{severity:"info",sx:{mb:2},children:e.jsx(i,{variant:"body2",children:"Select which Firestore collections this dataset should include. Data will be automatically scoped to your organization for security."})})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(ma,{collections:q,allCollections:V,selectedCollections:((ue=n.collectionAssignment)==null?void 0:ue.selectedCollections)||[],searchQuery:Ae.searchQuery,selectedCategory:Ae.selectedCategory,showSelectedOnly:Ae.showSelectedOnly,onSearchChange:We.setSearchQuery,onCategoryChange:We.setSelectedCategory,onShowSelectedOnlyChange:We.setShowSelectedOnly,onCollectionToggle:te,onSelectAll:Ie,onDeselectAll:f,onSelectAllInCategory:O,onDeselectAllInCategory:R,onRefresh:pe,loading:je,error:ie,totalCount:V.length,selectedCount:((Ue=(ze=n.collectionAssignment)==null?void 0:ze.selectedCollections)==null?void 0:Ue.length)||0,variant:"wizard",compact:!1})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(Be,{control:e.jsx(Ye,{checked:((_e=n.collectionAssignment)==null?void 0:_e.includeSubcollections)||!1,onChange:N=>{var Oe,tt,ot;return J({collectionAssignment:{selectedCollections:((Oe=n.collectionAssignment)==null?void 0:Oe.selectedCollections)||[],includeSubcollections:N.target.checked,dataFilters:((tt=n.collectionAssignment)==null?void 0:tt.dataFilters)||[],organizationScope:((ot=n.collectionAssignment)==null?void 0:ot.organizationScope)||!1}})}}),label:"Include Subcollections"})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(Be,{control:e.jsx(Ye,{checked:((he=n.collectionAssignment)==null?void 0:he.organizationScope)!==!1,onChange:N=>{var Oe,tt,ot;return J({collectionAssignment:{selectedCollections:((Oe=n.collectionAssignment)==null?void 0:Oe.selectedCollections)||[],includeSubcollections:((tt=n.collectionAssignment)==null?void 0:tt.includeSubcollections)||!1,dataFilters:((ot=n.collectionAssignment)==null?void 0:ot.dataFilters)||[],organizationScope:N.target.checked}})}}),label:"Organization Scoped Data (Recommended for Multi-Tenancy)"})}),(((ht=(Le=n.collectionAssignment)==null?void 0:Le.selectedCollections)==null?void 0:ht.length)||0)>0&&e.jsxs(x,{item:!0,xs:12,children:[e.jsxs(i,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:["Selected Collections Preview",e.jsx(F,{label:`${((Et=(it=n.collectionAssignment)==null?void 0:it.selectedCollections)==null?void 0:Et.length)||0} selected`,size:"small",color:"primary",variant:"outlined"})]}),e.jsx(Ze,{sx:{p:2,bgcolor:"rgba(25, 118, 210, 0.04)",border:"1px solid rgba(25, 118, 210, 0.12)",borderRadius:2},children:e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center"},children:[(hs=(ps=n.collectionAssignment)==null?void 0:ps.selectedCollections)==null?void 0:hs.map(N=>e.jsx(F,{icon:e.jsx(rt,{fontSize:"small"}),label:N,variant:"filled",color:"primary",size:"small",sx:{bgcolor:"rgba(25, 118, 210, 0.08)",color:"#ffffff",border:"1px solid rgba(25, 118, 210, 0.2)","& .MuiChip-icon":{color:"#ffffff"},"&:hover":{bgcolor:"rgba(25, 118, 210, 0.12)"}}},N)),((Ht=n.collectionAssignment)==null?void 0:Ht.organizationScope)&&e.jsx(F,{label:"Organization Scoped",size:"small",color:"success",variant:"outlined",sx:{ml:1,fontWeight:600,bgcolor:"rgba(46, 125, 50, 0.04)"}})]})})]}),se&&e.jsx(x,{item:!0,xs:12,children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:1},children:[e.jsx(pt,{size:20}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Analyzing collection conflicts..."})]})}),Y&&(Y.warnings.length>0||Y.suggestions.length>0)&&e.jsx(x,{item:!0,xs:12,children:e.jsxs(c,{sx:{mt:2},children:[e.jsxs(i,{variant:"subtitle2",gutterBottom:!0,sx:{color:"white",display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ps,{fontSize:"small",color:"warning"}),"Smart Analysis Results"]}),Y.warnings.map((N,Oe)=>e.jsx(be,{severity:N.severity,sx:{mb:1,bgcolor:"rgba(255, 255, 255, 0.05)"},children:e.jsxs(c,{children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500,mb:.5},children:N.message}),N.affectedDatasets.length>0&&e.jsxs(i,{variant:"caption",sx:{display:"block",mb:.5},children:["Affected datasets: ",N.affectedDatasets.join(", ")]}),e.jsxs(i,{variant:"caption",sx:{fontStyle:"italic"},children:["💡 ",N.recommendation]})]})},Oe)),Y.suggestions.length>0&&e.jsxs(c,{sx:{mt:2},children:[e.jsx(i,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)",display:"block",mb:1},children:"💡 Smart Suggestions:"}),Y.suggestions.map((N,Oe)=>e.jsx(Ze,{sx:{p:2,mb:1,bgcolor:"rgba(79, 70, 229, 0.1)",border:"1px solid rgba(79, 70, 229, 0.3)"},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{label:N.type.toUpperCase(),size:"small",sx:{bgcolor:"rgba(79, 70, 229, 0.2)",color:"#8b5cf6",fontWeight:600,fontSize:"0.65rem"}}),e.jsx(i,{variant:"body2",sx:{color:"white"},children:N.message})]})},Oe))]}),Y.hasConflicts&&e.jsx(be,{severity:"error",sx:{mt:2,bgcolor:"rgba(239, 68, 68, 0.1)"},children:e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:"⚠️ High-priority conflicts detected. Please review and resolve before proceeding."})})]})})]}):e.jsx(be,{severity:"warning",children:"Collection assignment is only available for Firestore datasets. Please select Firestore as your cloud provider to configure collection assignment."})]});case 5:return e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Advanced Options"}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(Be,{control:e.jsx(Ye,{checked:((yt=n.advanced)==null?void 0:yt.encryption)||!1,onChange:N=>J({advanced:{...n.advanced,encryption:N.target.checked}})}),label:"Enable Encryption"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(Be,{control:e.jsx(Ye,{checked:((wt=n.advanced)==null?void 0:wt.compression)||!1,onChange:N=>J({advanced:{...n.advanced,compression:N.target.checked}})}),label:"Enable Compression"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(Be,{control:e.jsx(Ye,{checked:((Ft=n.advanced)==null?void 0:Ft.backup)||!1,onChange:N=>J({advanced:{...n.advanced,backup:N.target.checked}})}),label:"Enable Backup"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(Be,{control:e.jsx(Ye,{checked:((Ut=n.advanced)==null?void 0:Ut.versioning)||!1,onChange:N=>J({advanced:{...n.advanced,versioning:N.target.checked}})}),label:"Enable Versioning"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(Be,{control:e.jsx(Ye,{checked:((nt=n.advanced)==null?void 0:nt.accessLogging)||!1,onChange:N=>J({advanced:{...n.advanced,accessLogging:N.target.checked}})}),label:"Enable Access Logging"})})]})]});case 6:return e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Review & Create"}),e.jsxs(Ze,{sx:{p:3,mb:3},children:[e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Dataset Configuration Summary"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Name: ",e.jsx("strong",{children:n.name})]})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Provider: ",e.jsx("strong",{children:n.cloudProvider})]})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Visibility: ",e.jsx("strong",{children:n.visibility})]})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Schema: ",e.jsx("strong",{children:"Backbone Logic Unified Schema"})]})}),n.cloudProvider==="firestore"&&((Tt=(Dt=n.collectionAssignment)==null?void 0:Dt.selectedCollections)==null?void 0:Tt.length)&&e.jsxs(x,{item:!0,xs:12,children:[e.jsx(i,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.jsx("strong",{children:"Assigned Collections:"})}),e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:n.collectionAssignment.selectedCollections.map(N=>e.jsx(F,{label:N,size:"small",color:"primary",icon:e.jsx(rt,{})},N))}),n.collectionAssignment.organizationScope&&e.jsx(i,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"✓ Data will be automatically scoped to your organization for security"})]})]})]}),e.jsx(be,{severity:"info",children:"Please review your configuration before creating the dataset. You can go back to any step to make changes."})]});default:return null}},[n,S,G,J,Z,ye]);return d.useMemo(()=>u?e.jsxs(dt,{open:u,onClose:s,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)",maxHeight:"90vh"}},children:[e.jsxs(ut,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"background.paper",borderBottom:"1px solid",borderColor:"divider",pb:2},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(rt,{color:"primary"}),e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:"Create Dataset"})]}),e.jsx(et,{onClick:s,size:"small",children:e.jsx(ls,{})})]}),e.jsxs(mt,{sx:{p:3},children:[A&&e.jsx(be,{severity:"error",sx:{mb:3},children:A}),e.jsx(_s,{activeStep:l,orientation:"horizontal",sx:{mb:3},children:er.map((z,L)=>e.jsx(Lt,{children:e.jsx(qt,{onClick:()=>K(L),sx:{cursor:"pointer"},children:z})},z))}),M(l),j&&e.jsx(Ja,{sx:{mt:2}})]}),e.jsxs(gt,{sx:{px:3,pb:3,pt:2,backgroundColor:"background.paper",borderTop:"1px solid",borderColor:"divider",justifyContent:"space-between"},children:[e.jsx(B,{onClick:s,variant:"outlined",disabled:j,sx:{borderColor:"primary.main",color:"primary.main"},children:"Cancel"}),e.jsxs(c,{sx:{display:"flex",gap:1},children:[e.jsx(B,{onClick:P,disabled:l===0||j,variant:"outlined",children:"Back"}),l===er.length-1?e.jsx(B,{onClick:le,variant:"contained",disabled:j||!n.name.trim(),startIcon:e.jsx(ft,{}),sx:{backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:j?"Creating Dataset...":"Create Dataset"}):e.jsx(B,{onClick:h,variant:"contained",disabled:j,children:"Next"})]})]})]}):null,[u,s,n,l,j,A,S,G,ne,_,P,h,K,le,M])}),_i={"Core System":{icon:"👥",description:"User management, organizations, and core system data",collections:["users","teamMembers","organizations","roles","projects","projectTeamMembers","clients","contacts","test"]},"Sessions & Workflows":{icon:"🎬",description:"Production sessions, workflows, and task management",collections:["sessions","sessionWorkflows","sessionAssignments","sessionParticipants","workflowTemplates","workflowDiagrams","workflowInstances","workflowSteps","workflowAssignments","sessionPhaseTransitions","sessionReviews","sessionQc","sessionTasks","demoSessions"]},"Inventory & Equipment":{icon:"📦",description:"Equipment tracking, network management, and inventory systems",collections:["inventoryItems","inventory","networkIPAssignments","networkIPRanges","networks","inventoryHistory","setupProfiles","schemas","schemaFields","mapLayouts","mapLocations","inventoryMaps","mapData"]},"Timecards & Scheduling":{icon:"⏰",description:"Time tracking, approvals, and scheduling systems",collections:["timecard_entries","user_timecards","timecard_approvals","timecard_templates"]},"Media & Content":{icon:"🎥",description:"Media files, production tasks, and content management",collections:["mediaFiles","postProductionTasks","stages","notes","reports","callSheets"]},"AI & Automation":{icon:"🤖",description:"AI agents, messaging, and automated systems",collections:["aiAgents","messages","chats","messageSessions"]},"Business & Licensing":{icon:"💼",description:"Licenses, subscriptions, payments, and business data",collections:["licenses","subscriptions","payments","userPreferences"]},"Production Budget Management":{icon:"💰",description:"Budget tracking, schedules, and financial management",collections:["pbmProjects","pbmSchedules","pbmPayscales","pbmDailyStatus"]},"Network Delivery & Deliverables":{icon:"📡",description:"Network delivery bibles, deliverables, and post-production workflows",collections:["networkDeliveryBibles","deliverables","networkDeliveryChats","deliverySpecs","deliveryTemplates","deliveryTracking"]}};Object.values(_i).flatMap(u=>u.collections);const Li=({open:u,onClose:s,dataset:t,onDatasetUpdated:a,existingDatasets:o=[]})=>{var Me,J,T,h,P,K,Z,ye,le,re;const[l,g]=d.useState({}),[n,y]=d.useState(!1),[j,b]=d.useState(null),[A,v]=d.useState({}),[S,W]=d.useState(null),[G,X]=d.useState(!1),{collections:ne,allCollections:I,loading:_,error:ae,refresh:Y,startRealTimeMonitoring:we,stopRealTimeMonitoring:ee}=da(),{state:ve,actions:se}=ua(ne,((Me=l.collectionAssignment)==null?void 0:Me.selectedCollections)||[],{initialSearchQuery:"",initialCategory:"all",initialShowSelectedOnly:!1});d.useEffect(()=>{t&&u&&(g({name:t.name,description:t.description,visibility:t.visibility,collectionAssignment:t.collectionAssignment||{selectedCollections:[],includeSubcollections:!1,dataFilters:[],organizationScope:!0}}),b(null),v({}),W(null))},[t,u]),d.useEffect(()=>{if(u&&t)return console.log("🔄 [EditDatasetDialog] Starting real-time collection monitoring..."),we(),()=>{console.log("🛑 [EditDatasetDialog] Stopping real-time collection monitoring..."),ee()}},[u,t,we,ee]);const de=d.useCallback(k=>{g(te=>({...te,...k}))},[]),q=d.useCallback(async()=>{var k,te;if(!t||!((te=(k=l.collectionAssignment)==null?void 0:k.selectedCollections)!=null&&te.length)){W(null);return}X(!0);try{const Ie=o.filter(O=>O.id!==t.id),f=await Sr.checkDatasetCreationConflicts({name:l.name||t.name,collectionAssignment:l.collectionAssignment},Ie);W(f),console.log("✅ [EditDatasetDialog] Conflict check complete:",f)}catch(Ie){console.error("❌ [EditDatasetDialog] Failed to check conflicts:",Ie),W(null)}finally{X(!1)}},[t,l.name,l.collectionAssignment,o]);d.useEffect(()=>{var k,te;if(u&&((te=(k=l.collectionAssignment)==null?void 0:k.selectedCollections)!=null&&te.length)){const Ie=setTimeout(()=>{q()},500);return()=>clearTimeout(Ie)}},[u,(J=l.collectionAssignment)==null?void 0:J.selectedCollections,q]);const V=d.useCallback(()=>{var te,Ie,f,O;const k={};return(te=l.name)!=null&&te.trim()||(k.name="Dataset name is required"),((Ie=t==null?void 0:t.storage)==null?void 0:Ie.backend)==="firestore"&&!((O=(f=l.collectionAssignment)==null?void 0:f.selectedCollections)!=null&&O.length)&&(k.collections="At least one collection must be selected for Firestore datasets"),v(k),Object.keys(k).length===0},[l,t]),je=d.useCallback(async()=>{if(!(!t||!V())){if(S!=null&&S.hasConflicts){b("Please resolve high-priority conflicts before saving");return}y(!0),b(null);try{console.log("💾 [EditDatasetDialog] Saving dataset updates:",l);const k=await Re.updateDataset(t.id,{name:l.name,description:l.description,visibility:l.visibility,collectionAssignment:l.collectionAssignment});k?(console.log("✅ [EditDatasetDialog] Dataset updated successfully"),a==null||a(k),s()):b("Failed to update dataset: No response from server")}catch(k){console.error("❌ [EditDatasetDialog] Failed to update dataset:",k),b(`Failed to update dataset: ${k instanceof Error?k.message:"Unknown error"}`)}finally{y(!1)}}},[t,l,V,S,a,s]),ie=d.useCallback(k=>{var te,Ie,f;de({collectionAssignment:{...l.collectionAssignment,selectedCollections:k,includeSubcollections:((te=l.collectionAssignment)==null?void 0:te.includeSubcollections)||!1,dataFilters:((Ie=l.collectionAssignment)==null?void 0:Ie.dataFilters)||[],organizationScope:((f=l.collectionAssignment)==null?void 0:f.organizationScope)!==!1}})},[l.collectionAssignment,de]),pe=d.useCallback(k=>{var f;const te=((f=l.collectionAssignment)==null?void 0:f.selectedCollections)||[],Ie=te.includes(k)?te.filter(O=>O!==k):[...te,k];ie(Ie)},[l.collectionAssignment,ie]),oe=d.useCallback(()=>{ie(I)},[ie,I]),Se=d.useCallback(()=>{ie([])},[ie]),Ae=d.useCallback((k,te)=>{var O;const Ie=((O=l.collectionAssignment)==null?void 0:O.selectedCollections)||[],f=[...new Set([...Ie,...te])];ie(f)},[l.collectionAssignment,ie]),We=d.useCallback((k,te)=>{var O;const f=(((O=l.collectionAssignment)==null?void 0:O.selectedCollections)||[]).filter(R=>!te.includes(R));ie(f)},[l.collectionAssignment,ie]);return t?e.jsxs(dt,{open:u,onClose:s,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",maxHeight:"90vh"}},children:[e.jsxs(ut,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",pb:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(ks,{sx:{color:"#8b5cf6"}}),e.jsxs(c,{children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:"Edit Dataset"}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Update dataset information and collection assignments"})]})]}),e.jsxs(mt,{sx:{p:3,overflow:"auto"},children:[j&&e.jsx(be,{severity:"error",sx:{mb:3,bgcolor:"rgba(239, 68, 68, 0.1)"},children:j}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsxs(i,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(It,{color:"primary"}),"Basic Information"]})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(fe,{fullWidth:!0,label:"Dataset Name",value:l.name||"",onChange:k=>de({name:k.target.value}),error:!!A.name,helperText:A.name,sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#8b5cf6"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)"}}})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(Fe,{fullWidth:!0,children:[e.jsx($e,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Visibility"}),e.jsxs(Ge,{value:l.visibility||"private",onChange:k=>de({visibility:k.target.value}),sx:{color:"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#8b5cf6"}},children:[e.jsx(w,{value:"private",children:"Private"}),e.jsx(w,{value:"organization",children:"Organization"}),e.jsx(w,{value:"public",children:"Public"})]})]})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(fe,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:l.description||"",onChange:k=>de({description:k.target.value}),sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#8b5cf6"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)"}}})}),((T=t.storage)==null?void 0:T.backend)==="firestore"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{item:!0,xs:12,children:[e.jsx(ms,{sx:{my:2,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsxs(i,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(He,{color:"primary"}),"Collection Assignment"]})]}),e.jsx(x,{item:!0,xs:12,children:e.jsxs(c,{sx:{mb:2},children:[e.jsx(i,{variant:"subtitle2",sx:{color:"white",mb:2},children:"Select Collections by Category"}),A.collections&&e.jsx(be,{severity:"error",sx:{mb:2,bgcolor:"rgba(239, 68, 68, 0.1)"},children:A.collections}),e.jsx(ma,{collections:ne,allCollections:I,selectedCollections:((h=l.collectionAssignment)==null?void 0:h.selectedCollections)||[],searchQuery:ve.searchQuery,selectedCategory:ve.selectedCategory,showSelectedOnly:ve.showSelectedOnly,onSearchChange:se.setSearchQuery,onCategoryChange:se.setSelectedCategory,onShowSelectedOnlyChange:se.setShowSelectedOnly,onCollectionToggle:pe,onSelectAll:oe,onDeselectAll:Se,onSelectAllInCategory:Ae,onDeselectAllInCategory:We,onRefresh:Y,loading:_,error:ae,totalCount:I.length,selectedCount:((K=(P=l.collectionAssignment)==null?void 0:P.selectedCollections)==null?void 0:K.length)||0,variant:"dialog",compact:!1})]})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(Be,{control:e.jsx(Ye,{checked:((Z=l.collectionAssignment)==null?void 0:Z.organizationScope)!==!1,onChange:k=>{var te,Ie,f;return de({collectionAssignment:{...l.collectionAssignment,organizationScope:k.target.checked,selectedCollections:((te=l.collectionAssignment)==null?void 0:te.selectedCollections)||[],includeSubcollections:((Ie=l.collectionAssignment)==null?void 0:Ie.includeSubcollections)||!1,dataFilters:((f=l.collectionAssignment)==null?void 0:f.dataFilters)||[]}})},sx:{color:"#8b5cf6"}}),label:e.jsxs(c,{children:[e.jsx(i,{variant:"body2",sx:{color:"white"},children:"Organization Scoped Data"}),e.jsx(i,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Automatically filter data to current organization for multi-tenant isolation"})]})})}),((le=(ye=l.collectionAssignment)==null?void 0:ye.selectedCollections)==null?void 0:le.length)>0&&e.jsxs(x,{item:!0,xs:12,children:[e.jsxs(i,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,color:"white"},children:["Selected Collections Preview",e.jsx(F,{label:`${l.collectionAssignment.selectedCollections.length} selected`,size:"small",color:"primary",variant:"outlined"})]}),e.jsx(Ze,{sx:{p:2,bgcolor:"rgba(139, 92, 246, 0.08)",border:"1px solid rgba(139, 92, 246, 0.2)",borderRadius:2},children:e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:1,alignItems:"center"},children:[l.collectionAssignment.selectedCollections.map(k=>e.jsx(F,{icon:e.jsx(rt,{fontSize:"small"}),label:k,variant:"filled",color:"secondary",size:"small",sx:{bgcolor:"rgba(139, 92, 246, 0.12)",color:"#ffffff",border:"1px solid rgba(139, 92, 246, 0.3)","& .MuiChip-icon":{color:"#ffffff"},"&:hover":{bgcolor:"rgba(139, 92, 246, 0.16)"}}},k)),((re=l.collectionAssignment)==null?void 0:re.organizationScope)&&e.jsx(F,{label:"Organization Scoped",size:"small",color:"success",variant:"outlined",sx:{ml:1,fontWeight:600,bgcolor:"rgba(46, 125, 50, 0.04)"}})]})})]}),G&&e.jsx(x,{item:!0,xs:12,children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:1},children:[e.jsx(pt,{size:20}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Analyzing collection conflicts..."})]})}),S&&(S.warnings.length>0||S.suggestions.length>0)&&e.jsx(x,{item:!0,xs:12,children:e.jsx(ge,{sx:{bgcolor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(Ce,{children:[e.jsxs(i,{variant:"subtitle2",gutterBottom:!0,sx:{color:"white",display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ps,{fontSize:"small",color:"warning"}),"Smart Analysis Results"]}),S.warnings.map((k,te)=>e.jsxs(be,{severity:k.severity,sx:{mb:1,bgcolor:"rgba(255, 255, 255, 0.05)"},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:k.message}),e.jsxs(i,{variant:"caption",sx:{fontStyle:"italic",display:"block",mt:.5},children:["💡 ",k.recommendation]})]},te)),S.suggestions.map((k,te)=>e.jsx(be,{severity:"info",sx:{mb:1,bgcolor:"rgba(79, 70, 229, 0.1)"},children:e.jsxs(i,{variant:"body2",children:[e.jsxs("strong",{children:[k.type.toUpperCase(),":"]})," ",k.message]})},te))]})})})]})]})]}),e.jsxs(gt,{sx:{p:3,borderTop:"1px solid rgba(255, 255, 255, 0.1)",justifyContent:"space-between"},children:[e.jsx(B,{onClick:s,variant:"outlined",startIcon:e.jsx(Xa,{}),sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Cancel"}),e.jsx(B,{onClick:je,variant:"contained",startIcon:n?e.jsx(pt,{size:16}):e.jsx(Za,{}),disabled:n||(S==null?void 0:S.hasConflicts),sx:{bgcolor:"#8b5cf6","&:hover":{bgcolor:"#7c3aed"},"&:disabled":{bgcolor:"rgba(139, 92, 246, 0.3)",color:"rgba(255, 255, 255, 0.5)"}},children:n?"Saving...":"Save Changes"})]})]}):null};var ke=(u=>(u.ADMIN="ADMIN",u.GUEST="GUEST",u.MANAGER="MANAGER",u.EXEC="EXEC",u.POST_COORDINATOR="POST_COORDINATOR",u.POST_PRODUCTION_SUPERVISOR="POST_PRODUCTION_SUPERVISOR",u.MEDIA_MANAGER="MEDIA_MANAGER",u.PRODUCER="PRODUCER",u.ASSOCIATE_PRODUCER="ASSOCIATE_PRODUCER",u.POST_PRODUCER="POST_PRODUCER",u.LINE_PRODUCER="LINE_PRODUCER",u.KEYNOTE_PRODUCER="KEYNOTE_PRODUCER",u.KEYNOTE_PROD="KEYNOTE_PROD",u.PRODUCTION_ASSISTANT="PRODUCTION_ASSISTANT",u.POST_PA="POST_PA",u.DIRECTOR="DIRECTOR",u.ART_DIRECTOR="ART_DIRECTOR",u.ASSIST_DIRECTOR="ASSIST_DIRECTOR",u.EDITOR="EDITOR",u.ASSISTANT_EDITOR="ASSISTANT_EDITOR",u.CAMERA_OPERATOR="CAMERA_OPERATOR",u.SOUND_ENGINEER="SOUND_ENGINEER",u.LIGHTING_TECHNICIAN="LIGHTING_TECHNICIAN",u.DIT="DIT",u.TECH="TECH",u.NETWORKING="NETWORKING",u.COLORIST="COLORIST",u.AUDIO_PRODUCTION="AUDIO_PRODUCTION",u.AUDIO_POST="AUDIO_POST",u.GFX_ARTIST="GFX_ARTIST",u.KEYNOTE_POST="KEYNOTE_POST",u.QC_SPECIALIST="QC_SPECIALIST",u))(ke||{});const qi={FILM_TV:[{id:"executive-producer",name:"EXECUTIVE_PRODUCER",displayName:"Executive Producer",description:"Oversees entire production from development to distribution, manages financing and high-level creative decisions",industry:"FILM_TV",eventTypes:["FEATURE_FILM","TV_SERIES","DOCUMENTARY"],category:"Executive Leadership",hierarchy:95,baseRole:ke.EXEC,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0,manage_post_tasks:!0,access_media_library:!0},postProduction:{manage_tasks:!0,assign_post_roles:!0,approve_final_cuts:!0,manage_review_cycles:!0,access_color_tools:!0,manage_audio_tools:!0,export_final_media:!0},userManagement:{create_users:!0,edit_users:!0,delete_users:!0,manage_roles:!0,assign_permissions:!0,view_user_activity:!0},system:{access_settings:!0,manage_integrations:!0,view_system_logs:!0,manage_ai_agents:!0},reports:{create_reports:!0,edit_reports:!0,delete_reports:!0,access_analytics:!0,export_reports:!0,manage_templates:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Secure financing and manage budgets","Oversee creative vision and final approval","Manage distribution and marketing strategy","Coordinate with studios and investors","Ensure legal compliance and contracts"],requiredSkills:["Leadership","Finance","Negotiation","Strategic Planning","Industry Knowledge"],reportingStructure:{manages:["Producer","Line Producer","Director"]},tags:["executive","finance","leadership","strategy","high-level"],isPopular:!0,usageCount:450,icon:"👑",color:"#1a237e",salaryRange:{min:15e4,max:5e5,currency:"USD"},experienceLevel:"Executive"},{id:"showrunner",name:"SHOWRUNNER",displayName:"Showrunner",description:"Head writer and executive producer for TV series, manages creative direction and day-to-day operations",industry:"FILM_TV",eventTypes:["TV_SERIES"],category:"Creative Leadership",hierarchy:90,baseRole:ke.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0,manage_post_tasks:!0,access_media_library:!0},postProduction:{manage_tasks:!0,assign_post_roles:!0,approve_final_cuts:!0,manage_review_cycles:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Oversee writing room and story development","Manage creative vision for entire series","Coordinate with network executives","Supervise all aspects of production","Ensure continuity across episodes"],requiredSkills:["Writing","Leadership","Creative Vision","Team Management","Industry Knowledge"],reportingStructure:{reportsTo:"Executive Producer",manages:["Writer","Director","Producer"]},tags:["creative","writing","tv","leadership","storytelling"],isPopular:!0,usageCount:280,icon:"📝",color:"#3f51b5",salaryRange:{min:2e5,max:1e6,currency:"USD"},experienceLevel:"Executive"},{id:"cinematographer-dp",name:"CINEMATOGRAPHER_DP",displayName:"Cinematographer (Director of Photography)",description:"Responsible for visual storytelling, camera work, lighting design, and overall visual aesthetic",industry:"FILM_TV",eventTypes:["FEATURE_FILM","TV_SERIES","COMMERCIAL","MUSIC_VIDEO"],category:"Creative Technical",hierarchy:75,baseRole:ke.CAMERA_OPERATOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,access_media_library:!0},postProduction:{access_color_tools:!0,manage_review_cycles:!0},inventory:{create_assets:!0,edit_assets:!0,manage_checkouts:!0,view_asset_reports:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Design visual style and cinematography","Manage camera department and equipment","Collaborate with director on visual storytelling","Oversee lighting design and execution","Ensure technical quality of footage"],requiredSkills:["Cinematography","Lighting","Camera Operation","Visual Storytelling","Technical Expertise"],reportingStructure:{reportsTo:"Director",manages:["Camera Operator","Gaffer","1st AC","2nd AC"]},tags:["cinematography","visual","camera","lighting","technical"],isPopular:!0,usageCount:890,icon:"📹",color:"#795548",salaryRange:{min:8e4,max:3e5,currency:"USD"},experienceLevel:"Senior"}],CORPORATE_EVENTS:[{id:"event-director",name:"EVENT_DIRECTOR",displayName:"Event Director",description:"Oversees all aspects of corporate event planning, execution, and management",industry:"CORPORATE_EVENTS",eventTypes:["CONFERENCE","TRADE_SHOW","PRODUCT_LAUNCH","CORPORATE_VIDEO"],category:"Event Leadership",hierarchy:85,baseRole:ke.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Develop event strategy and objectives","Manage event budget and resources","Coordinate with vendors and stakeholders","Oversee event logistics and execution","Ensure ROI and success metrics"],requiredSkills:["Event Planning","Project Management","Budget Management","Vendor Relations","Strategic Planning"],reportingStructure:{manages:["Event Coordinator","AV Technician","Registration Manager"]},tags:["events","corporate","planning","management","strategy"],isPopular:!0,usageCount:650,icon:"🎯",color:"#1976d2",salaryRange:{min:7e4,max:15e4,currency:"USD"},experienceLevel:"Senior"},{id:"av-production-manager",name:"AV_PRODUCTION_MANAGER",displayName:"AV Production Manager",description:"Manages all audio-visual aspects of corporate events including streaming, recording, and live production",industry:"CORPORATE_EVENTS",eventTypes:["CONFERENCE","WEBINAR","VIRTUAL_EVENT","PRODUCT_LAUNCH"],category:"Technical Production",hierarchy:70,baseRole:ke.TECH,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,access_media_library:!0},postProduction:{manage_tasks:!0,access_color_tools:!0,manage_audio_tools:!0,export_final_media:!0},inventory:{create_assets:!0,edit_assets:!0,manage_checkouts:!0,manage_ip_addresses:!0},system:{access_settings:!0,manage_integrations:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Design and implement AV systems","Manage live streaming and recording","Coordinate technical rehearsals","Troubleshoot technical issues","Ensure broadcast quality standards"],requiredSkills:["AV Technology","Live Streaming","Technical Troubleshooting","Equipment Management","Broadcast Standards"],reportingStructure:{reportsTo:"Event Director",manages:["AV Technician","Camera Operator","Audio Engineer"]},tags:["av","technical","streaming","production","broadcast"],isPopular:!0,usageCount:520,icon:"🎛️",color:"#546e7a",salaryRange:{min:55e3,max:12e4,currency:"USD"},experienceLevel:"Mid"}],LIVE_EVENTS:[{id:"concert-director",name:"CONCERT_DIRECTOR",displayName:"Concert Director",description:"Oversees creative and technical direction for live concert productions and music events",industry:"LIVE_EVENTS",eventTypes:["CONCERT","FESTIVAL","AWARDS_SHOW"],category:"Live Production",hierarchy:88,baseRole:ke.DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},automation:{view_all_sessions:!0,view_all_alerts:!0,manage_automation:!0,configure_settings:!0},system:{access_settings:!0,manage_integrations:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Direct live concert performances","Coordinate with artists and management","Oversee stage design and production","Manage live broadcast elements","Ensure audience experience quality"],requiredSkills:["Live Direction","Music Industry Knowledge","Stage Production","Artist Relations","Broadcast Direction"],reportingStructure:{manages:["Stage Manager","Technical Director","Lighting Designer"]},tags:["concert","live","music","performance","broadcast"],isPopular:!0,usageCount:380,icon:"🎤",color:"#d32f2f",salaryRange:{min:8e4,max:25e4,currency:"USD"},experienceLevel:"Senior"},{id:"festival-producer",name:"FESTIVAL_PRODUCER",displayName:"Festival Producer",description:"Manages multi-day festival productions including logistics, talent coordination, and audience experience",industry:"LIVE_EVENTS",eventTypes:["FESTIVAL","CONCERT"],category:"Festival Management",hierarchy:82,baseRole:ke.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Coordinate multiple stages and venues","Manage artist logistics and hospitality","Oversee festival operations and security","Coordinate with local authorities","Ensure festival brand and experience"],requiredSkills:["Festival Management","Logistics Coordination","Vendor Management","Crisis Management","Entertainment Industry"],reportingStructure:{manages:["Stage Producer","Operations Manager","Artist Liaison"]},tags:["festival","multi-day","logistics","entertainment","coordination"],isPopular:!1,usageCount:180,icon:"🎪",color:"#e91e63",salaryRange:{min:6e4,max:18e4,currency:"USD"},experienceLevel:"Senior"}],SPORTS_BROADCAST:[{id:"sports-director",name:"SPORTS_DIRECTOR",displayName:"Sports Broadcast Director",description:"Directs live sports broadcasts, manages camera coverage, and coordinates real-time production decisions",industry:"SPORTS_BROADCAST",eventTypes:["SPORTS_BROADCAST","SPORTS_EVENT","OLYMPICS"],category:"Sports Production",hierarchy:85,baseRole:ke.DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},automation:{view_all_sessions:!0,view_all_alerts:!0,manage_automation:!0,configure_settings:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Direct live sports coverage","Coordinate multiple camera angles","Manage instant replay systems","Work with commentary teams","Ensure broadcast quality and timing"],requiredSkills:["Sports Broadcasting","Live Direction","Multi-Camera Production","Sports Knowledge","Real-time Decision Making"],reportingStructure:{manages:["Camera Operator","Replay Operator","Graphics Operator"]},tags:["sports","live","broadcast","real-time","multi-camera"],isPopular:!0,usageCount:320,icon:"🏆",color:"#ff5722",salaryRange:{min:7e4,max:2e5,currency:"USD"},experienceLevel:"Senior"},{id:"sports-producer",name:"SPORTS_PRODUCER",displayName:"Sports Producer",description:"Produces sports content including pre-game, live coverage, and post-game analysis",industry:"SPORTS_BROADCAST",eventTypes:["SPORTS_BROADCAST","SPORTS_EVENT"],category:"Sports Production",hierarchy:75,baseRole:ke.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},postProduction:{manage_tasks:!0,approve_final_cuts:!0,export_final_media:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Plan sports broadcast content","Coordinate with sports organizations","Manage highlight packages","Oversee graphics and statistics","Coordinate talent and commentary"],requiredSkills:["Sports Production","Content Planning","Sports Industry Knowledge","Broadcast Standards","Team Coordination"],reportingStructure:{reportsTo:"Sports Director",manages:["Associate Producer","Graphics Coordinator","Statistics Coordinator"]},tags:["sports","production","content","highlights","coordination"],isPopular:!0,usageCount:420,icon:"⚽",color:"#4caf50",salaryRange:{min:5e4,max:15e4,currency:"USD"},experienceLevel:"Mid"}],GAMING_ESPORTS:[{id:"esports-director",name:"ESPORTS_DIRECTOR",displayName:"Esports Tournament Director",description:"Oversees esports tournament production, player coordination, and broadcast management",industry:"GAMING_ESPORTS",eventTypes:["ESPORTS_TOURNAMENT","GAMING_STREAM","GAME_LAUNCH"],category:"Esports Production",hierarchy:80,baseRole:ke.DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},automation:{view_all_sessions:!0,manage_automation:!0,configure_settings:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Direct esports tournament broadcasts","Coordinate with game developers","Manage player and team logistics","Oversee tournament format and rules","Ensure competitive integrity"],requiredSkills:["Esports Knowledge","Tournament Management","Gaming Industry","Broadcast Production","Player Relations"],reportingStructure:{manages:["Tournament Producer","Broadcast Producer","Player Coordinator"]},tags:["esports","gaming","tournament","competitive","broadcast"],isPopular:!0,usageCount:250,icon:"🎮",color:"#673ab7",salaryRange:{min:6e4,max:18e4,currency:"USD"},experienceLevel:"Senior"},{id:"stream-producer",name:"STREAM_PRODUCER",displayName:"Gaming Stream Producer",description:"Produces gaming content for streaming platforms, manages creator partnerships, and audience engagement",industry:"GAMING_ESPORTS",eventTypes:["GAMING_STREAM","LIVE_STREAM"],category:"Content Production",hierarchy:65,baseRole:ke.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0},automation:{view_all_sessions:!0,manage_automation:!0},reports:{create_reports:!0,access_analytics:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Produce gaming content for streams","Manage creator relationships","Coordinate sponsored content","Analyze audience engagement","Develop content strategies"],requiredSkills:["Content Production","Gaming Knowledge","Streaming Platforms","Creator Relations","Audience Analytics"],reportingStructure:{reportsTo:"Esports Director",manages:["Content Creator","Community Manager"]},tags:["streaming","content","gaming","creators","engagement"],isPopular:!1,usageCount:180,icon:"📹",color:"#9c27b0",salaryRange:{min:4e4,max:1e5,currency:"USD"},experienceLevel:"Mid"}],HEALTHCARE:[{id:"healthcare-project-manager",name:"HEALTHCARE_PROJECT_MANAGER",displayName:"Healthcare Project Manager",description:"Manages healthcare-related projects ensuring compliance with medical regulations and patient care standards",industry:"HEALTHCARE",eventTypes:["TRAINING_VIDEO","WEBINAR","CONFERENCE"],category:"Healthcare Management",hierarchy:75,baseRole:ke.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure HIPAA compliance in all projects","Manage medical content accuracy","Coordinate with healthcare professionals","Oversee patient safety protocols","Manage regulatory approvals"],requiredSkills:["Healthcare Regulations","HIPAA Compliance","Medical Knowledge","Project Management","Risk Management"],reportingStructure:{manages:["Clinical Coordinator","Compliance Officer"]},tags:["healthcare","compliance","medical","regulations","safety"],isPopular:!1,usageCount:120,icon:"🏥",color:"#4caf50",salaryRange:{min:7e4,max:16e4,currency:"USD"},experienceLevel:"Senior"}],IT_TECHNOLOGY:[{id:"it-project-manager",name:"IT_PROJECT_MANAGER",displayName:"IT Project Manager",description:"Manages technology projects including software development, system implementations, and digital transformations",industry:"IT_TECHNOLOGY",eventTypes:["TRAINING_VIDEO","WEBINAR","PRODUCT_LAUNCH"],category:"Technology Management",hierarchy:75,baseRole:ke.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},system:{access_settings:!0,manage_integrations:!0,view_system_logs:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Manage software development lifecycles","Coordinate technical teams and resources","Ensure system security and compliance","Oversee technology implementations","Manage stakeholder communications"],requiredSkills:["Project Management","Software Development","System Architecture","Agile Methodologies","Technical Leadership"],reportingStructure:{manages:["Software Developer","System Administrator","QA Engineer"]},tags:["technology","software","development","systems","digital"],isPopular:!0,usageCount:680,icon:"💻",color:"#2196f3",salaryRange:{min:8e4,max:18e4,currency:"USD"},experienceLevel:"Senior"}],MARKETING_ADVERTISING:[{id:"creative-director",name:"CREATIVE_DIRECTOR",displayName:"Creative Director",description:"Leads creative vision for marketing campaigns, oversees creative teams, and ensures brand consistency",industry:"MARKETING_ADVERTISING",eventTypes:["COMMERCIAL","CORPORATE_VIDEO","PRODUCT_LAUNCH"],category:"Creative Leadership",hierarchy:85,baseRole:ke.ART_DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},postProduction:{manage_tasks:!0,approve_final_cuts:!0,access_color_tools:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Develop creative concepts and campaigns","Lead creative team and vision","Ensure brand consistency across projects","Present concepts to clients","Oversee creative production process"],requiredSkills:["Creative Leadership","Brand Strategy","Design Thinking","Team Management","Client Relations"],reportingStructure:{manages:["Art Director","Copywriter","Designer"]},tags:["creative","marketing","branding","campaigns","leadership"],isPopular:!0,usageCount:540,icon:"🎨",color:"#ff9800",salaryRange:{min:9e4,max:25e4,currency:"USD"},experienceLevel:"Senior"}],EDUCATION_TRAINING:[{id:"instructional-designer",name:"INSTRUCTIONAL_DESIGNER",displayName:"Instructional Designer",description:"Designs educational content and learning experiences for training videos and e-learning platforms",industry:"EDUCATION_TRAINING",eventTypes:["TRAINING_VIDEO","WEBINAR","VIRTUAL_EVENT"],category:"Educational Design",hierarchy:65,baseRole:ke.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0},postProduction:{manage_tasks:!0,manage_review_cycles:!0},reports:{create_reports:!0,access_analytics:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Design learning objectives and outcomes","Create educational content structure","Develop assessment strategies","Ensure pedagogical best practices","Analyze learning effectiveness"],requiredSkills:["Instructional Design","Educational Theory","Content Development","Learning Analytics","Curriculum Design"],reportingStructure:{manages:["Content Developer","Educational Technologist"]},tags:["education","learning","instructional","content","pedagogy"],isPopular:!1,usageCount:220,icon:"📚",color:"#4caf50",salaryRange:{min:55e3,max:12e4,currency:"USD"},experienceLevel:"Mid"}],CONSTRUCTION_ENGINEERING:[{id:"construction-project-manager",name:"CONSTRUCTION_PROJECT_MANAGER",displayName:"Construction Project Manager",description:"Manages construction and engineering projects including documentation, safety compliance, and progress tracking",industry:"CONSTRUCTION_ENGINEERING",eventTypes:["TRAINING_VIDEO","CORPORATE_VIDEO","DOCUMENTARY"],category:"Construction Management",hierarchy:80,baseRole:ke.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure safety compliance and protocols","Manage construction documentation","Coordinate with engineering teams","Oversee project timelines and budgets","Ensure regulatory compliance"],requiredSkills:["Construction Management","Safety Regulations","Engineering Knowledge","Project Planning","Risk Management"],reportingStructure:{manages:["Site Supervisor","Safety Coordinator","Documentation Specialist"]},tags:["construction","engineering","safety","compliance","documentation"],isPopular:!1,usageCount:95,icon:"🏗️",color:"#795548",salaryRange:{min:75e3,max:17e4,currency:"USD"},experienceLevel:"Senior"}],FINANCE_BANKING:[{id:"financial-project-manager",name:"FINANCIAL_PROJECT_MANAGER",displayName:"Financial Project Manager",description:"Manages financial services projects ensuring regulatory compliance and risk management",industry:"FINANCE_BANKING",eventTypes:["TRAINING_VIDEO","WEBINAR","CORPORATE_VIDEO"],category:"Financial Management",hierarchy:80,baseRole:ke.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure financial regulatory compliance","Manage risk assessment and mitigation","Oversee financial data security","Coordinate with compliance teams","Manage stakeholder communications"],requiredSkills:["Financial Regulations","Risk Management","Compliance","Financial Analysis","Project Management"],reportingStructure:{manages:["Compliance Analyst","Risk Analyst","Financial Analyst"]},tags:["finance","banking","compliance","risk","regulations"],isPopular:!1,usageCount:85,icon:"🏦",color:"#4caf50",salaryRange:{min:85e3,max:2e5,currency:"USD"},experienceLevel:"Senior"}],GOVERNMENT_PUBLIC:[{id:"public-affairs-manager",name:"PUBLIC_AFFAIRS_MANAGER",displayName:"Public Affairs Manager",description:"Manages government and public sector communication projects ensuring transparency and public engagement",industry:"GOVERNMENT_PUBLIC",eventTypes:["CORPORATE_VIDEO","WEBINAR","CONFERENCE"],category:"Public Communications",hierarchy:75,baseRole:ke.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure public transparency requirements","Manage government communications","Coordinate with public stakeholders","Ensure accessibility compliance","Manage public information requests"],requiredSkills:["Public Administration","Government Regulations","Public Communications","Transparency Laws","Stakeholder Management"],reportingStructure:{manages:["Communications Specialist","Public Information Officer"]},tags:["government","public","transparency","communications","civic"],isPopular:!1,usageCount:65,icon:"🏛️",color:"#3f51b5",salaryRange:{min:6e4,max:14e4,currency:"USD"},experienceLevel:"Senior"}]},gs=()=>Object.values(qi).flat(),Bi=()=>gs().filter(u=>u.isPopular),Wi=u=>{const s=u.toLowerCase();return gs().filter(t=>t.displayName.toLowerCase().includes(s)||t.description.toLowerCase().includes(s)||t.tags.some(a=>a.toLowerCase().includes(s))||t.keyResponsibilities.some(a=>a.toLowerCase().includes(s)))},Fi=({open:u,onClose:s,projectId:t,projectName:a,organizationId:o})=>{const[l,g]=d.useState("overview"),[n,y]=d.useState(!1),[j,b]=d.useState(null),[A,v]=d.useState(null),[S,W]=d.useState([]),[G,X]=d.useState([]),[ne,I]=d.useState([]),[_,ae]=d.useState(""),[Y,we]=d.useState("all"),[ee,ve]=d.useState(!1),[se,de]=d.useState({name:"",displayName:"",description:"",category:"PRODUCTION",hierarchy:50,permissions:{}});d.useEffect(()=>{u&&(q(),V(),je())},[u,t]);const q=async()=>{var h,P;try{y(!0),console.log("🔍 [RoleManagement] Loading project roles for project:",t);const K=(h=window.firebase)==null?void 0:h.auth(),Z=K==null?void 0:K.currentUser;if(!Z){console.log("⚠️ [RoleManagement] No authenticated user"),b("Please log in to manage roles");return}const ye=await Z.getIdToken();console.log("✅ [RoleManagement] Got auth token for roles");const le=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/roles`,{headers:{Authorization:`Bearer ${ye}`,"Content-Type":"application/json"}});if(le.ok){const re=await le.json();console.log("✅ [RoleManagement] Loaded project roles:",((P=re.roles)==null?void 0:P.length)||0),W(re.roles||[])}else{const re=await le.json().catch(()=>({}));console.log("❌ [RoleManagement] Failed to load roles:",le.status,re),b(`Failed to load project roles: ${re.error||"API Error"}`),W([])}}catch(K){console.log("❌ [RoleManagement] Error loading roles:",K),b("Failed to load project roles"),W([])}finally{y(!1)}},V=async()=>{var h,P;try{y(!0),console.log("🔍 [RoleManagement] Loading team members for project:",t);const K=(h=window.firebase)==null?void 0:h.auth(),Z=K==null?void 0:K.currentUser;if(!Z){console.log("⚠️ [RoleManagement] No authenticated user"),b("Please log in to manage roles");return}const ye=await Z.getIdToken();console.log("✅ [RoleManagement] Got auth token for user:",Z.email);const le=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/team-members`,{headers:{Authorization:`Bearer ${ye}`,"Content-Type":"application/json"}});if(le.ok){const re=await le.json();console.log("✅ [RoleManagement] Loaded team members:",((P=re.teamMembers)==null?void 0:P.length)||0),X(re.teamMembers||[])}else{const re=await le.json().catch(()=>({}));console.log("❌ [RoleManagement] Failed to load team members:",le.status,re),b(`Failed to load team members: ${re.error||"API Error"}`),X([])}}catch(K){console.log("⚠️ [RoleManagement] Error loading team members:",K),b("Failed to load team members"),X([])}finally{y(!1)}},je=async()=>{var h,P;try{console.log("🔍 [RoleManagement] Loading user created roles");const K=(h=window.firebase)==null?void 0:h.auth(),Z=K==null?void 0:K.currentUser;if(!Z){console.log("⚠️ [RoleManagement] No authenticated user for user roles"),I([]);return}const ye=await Z.getIdToken(),le=await fetch("https://us-central1-backbone-logic.cloudfunctions.net/api/user/custom-roles",{headers:{Authorization:`Bearer ${ye}`,"Content-Type":"application/json"}});if(le.ok){const re=await le.json();console.log("✅ [RoleManagement] Loaded user created roles:",((P=re.roles)==null?void 0:P.length)||0),I(re.roles||[])}else{const re=await le.json().catch(()=>({}));console.log("❌ [RoleManagement] Failed to load user roles:",le.status,re),I([])}}catch(K){console.log("❌ [RoleManagement] Error loading user roles:",K),I([])}},ie=async()=>{var h;try{y(!0),console.log("🔍 [RoleManagement] Creating custom role:",se);const P=(h=window.firebase)==null?void 0:h.auth(),K=P==null?void 0:P.currentUser;if(!K){b("Please log in to create roles");return}const Z=await K.getIdToken(),ye=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/roles`,{method:"POST",headers:{Authorization:`Bearer ${Z}`,"Content-Type":"application/json"},body:JSON.stringify(se)});if(ye.ok){const le=await ye.json();console.log("✅ [RoleManagement] Role created successfully:",le),v("Role created successfully!"),g("overview"),q(),je(),de({name:"",displayName:"",description:"",category:"PRODUCTION",hierarchy:50,permissions:{}})}else{const le=await ye.json().catch(()=>({}));console.log("❌ [RoleManagement] Failed to create role:",le),b(le.error||"Failed to create role")}}catch(P){console.log("❌ [RoleManagement] Error creating role:",P),b("Failed to create role")}finally{y(!1)}},pe=async h=>{var P;try{y(!0),console.log("🔍 [RoleManagement] Using template:",h.displayName);const K={name:h.name,displayName:h.displayName,description:h.description,category:h.category,hierarchy:h.hierarchy,permissions:h.permissions,isCustom:!1,baseRole:h.baseRole},Z=(P=window.firebase)==null?void 0:P.auth(),ye=Z==null?void 0:Z.currentUser;if(!ye){b("Please log in to add roles");return}const le=await ye.getIdToken(),re=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/roles`,{method:"POST",headers:{Authorization:`Bearer ${le}`,"Content-Type":"application/json"},body:JSON.stringify(K)});if(re.ok){const k=await re.json();console.log("✅ [RoleManagement] Template role created successfully:",k),v(`Role "${h.displayName}" added to project!`),g("overview"),q()}else{const k=await re.json().catch(()=>({}));console.log("❌ [RoleManagement] Failed to create template role:",k),b(k.error||"Failed to add role from template")}}catch(K){console.log("❌ [RoleManagement] Error using template:",K),b("Failed to add role from template")}finally{y(!1)}},oe=async(h,P)=>{var K;try{y(!0),console.log("🔍 [RoleManagement] Assigning role:",{memberId:h,roleId:P});const Z=(K=window.firebase)==null?void 0:K.auth(),ye=Z==null?void 0:Z.currentUser;if(!ye){b("Please log in to assign roles");return}const le=await ye.getIdToken(),re=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/team-members/${h}/role`,{method:"PUT",headers:{Authorization:`Bearer ${le}`,"Content-Type":"application/json"},body:JSON.stringify({roleId:P})});if(re.ok){const k=await re.json();console.log("✅ [RoleManagement] Role assigned successfully:",k),v("Role assigned successfully!"),V()}else{const k=await re.json().catch(()=>({}));console.log("❌ [RoleManagement] Failed to assign role:",k),b(k.error||"Failed to assign role")}}catch(Z){console.log("❌ [RoleManagement] Error assigning role:",Z),b("Failed to assign role")}finally{y(!1)}},Se=async h=>{var P;try{y(!0),console.log("🔍 [RoleManagement] Using user created role:",h.displayName);const K=(P=window.firebase)==null?void 0:P.auth(),Z=K==null?void 0:K.currentUser;if(!Z){b("Please log in to add roles");return}const ye=await Z.getIdToken(),le={name:h.name,displayName:h.displayName,description:h.description,category:h.category,hierarchy:h.hierarchy,permissions:h.permissions,isCustom:!0,baseRole:h.baseRole},re=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${t}/roles`,{method:"POST",headers:{Authorization:`Bearer ${ye}`,"Content-Type":"application/json"},body:JSON.stringify(le)});if(re.ok){const k=await re.json();console.log("✅ [RoleManagement] User role added successfully:",k),v(`Role "${h.displayName}" added to project!`),g("overview"),q()}else{const k=await re.json().catch(()=>({}));console.log("❌ [RoleManagement] Failed to add user role:",k),b(k.error||"Failed to add role to project")}}catch(K){console.log("❌ [RoleManagement] Error using user role:",K),b("Failed to add role to project")}finally{y(!1)}},Ae=la.useMemo(()=>{let h=gs();if(console.log("🔍 [RoleTemplates] Total templates available:",h.length),console.log("🔍 [RoleTemplates] Selected industry:",Y),ee&&(h=Bi(),console.log("🔍 [RoleTemplates] Popular templates:",h.length)),Y!=="all"){const P=h.length;h=h.filter(Z=>Z.industry===Y),console.log(`🔍 [RoleTemplates] Filtered by industry ${Y}: ${P} → ${h.length}`);const K=gs().reduce((Z,ye)=>(Z[ye.industry]=(Z[ye.industry]||0)+1,Z),{});console.log("🔍 [RoleTemplates] Available industries:",K)}if(_.trim()){const P=Wi(_);h=h.filter(K=>P.some(Z=>Z.id===K.id)),console.log("🔍 [RoleTemplates] After search filter:",h.length)}return h},[_,Y,ee]),We=()=>e.jsxs(c,{children:[e.jsxs(x,{container:!0,spacing:2,sx:{mb:4},children:[e.jsx(x,{item:!0,xs:12,md:4,children:e.jsx(ge,{sx:{cursor:"pointer",border:"2px solid transparent","&:hover":{boxShadow:4,borderColor:"primary.main"}},onClick:()=>g("create-custom"),children:e.jsxs(Ce,{sx:{textAlign:"center",py:3},children:[e.jsx(ia,{sx:{fontSize:40,color:"primary.main",mb:2}}),e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Create Custom Role"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Define a new role with specific permissions"})]})})}),e.jsx(x,{item:!0,xs:12,md:4,children:e.jsx(ge,{sx:{cursor:"pointer",border:"2px solid transparent","&:hover":{boxShadow:4,borderColor:"secondary.main"}},onClick:()=>g("browse-templates"),children:e.jsxs(Ce,{sx:{textAlign:"center",py:3},children:[e.jsx(ei,{sx:{fontSize:40,color:"secondary.main",mb:2}}),e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Use Role Template"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Choose from 70+ pre-defined roles"})]})})}),e.jsx(x,{item:!0,xs:12,md:4,children:e.jsx(ge,{sx:{cursor:"pointer",border:"2px solid transparent","&:hover":{boxShadow:4,borderColor:"success.main"},opacity:ne.length===0?.6:1},onClick:()=>ne.length>0&&g("user-created"),children:e.jsxs(Ce,{sx:{textAlign:"center",py:3},children:[e.jsx(na,{sx:{fontSize:40,color:"success.main",mb:2}}),e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Your Created Roles"}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Reuse roles you've created (",ne.length,")"]})]})})})]}),e.jsx(ms,{sx:{my:3}}),e.jsxs(c,{sx:{mb:3},children:[e.jsxs(i,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Wt,{}),"Current Project Roles (",S.length,")"]}),S.length===0?e.jsx(Ze,{sx:{p:3,textAlign:"center",bgcolor:"grey.50"},children:e.jsx(i,{variant:"body2",color:"text.secondary",children:"No roles defined yet. Create a custom role or use a template to get started."})}):e.jsx(bt,{children:S.map(h=>e.jsxs(Te,{divider:!0,children:[e.jsx(Ne,{primary:h.displayName,secondary:e.jsxs(c,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:h.description}),e.jsxs(c,{sx:{mt:1,display:"flex",gap:1,alignItems:"center"},children:[e.jsx(F,{size:"small",label:h.category,variant:"outlined"}),e.jsx(F,{size:"small",label:`Level ${h.hierarchy}`,color:"primary",variant:"outlined"}),h.isCustom&&e.jsx(F,{size:"small",label:"Custom",color:"secondary",variant:"outlined"})]})]})}),e.jsxs(nr,{children:[e.jsx(et,{size:"small",children:e.jsx(ks,{})}),e.jsx(et,{size:"small",color:"error",children:e.jsx(Vt,{})})]})]},h.id))})]}),e.jsx(ms,{sx:{my:3}}),e.jsxs(c,{children:[e.jsxs(i,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Bt,{}),"Team Member Assignments (",G.length,")"]}),G.length===0?e.jsx(Ze,{sx:{p:3,textAlign:"center",bgcolor:"grey.50"},children:e.jsx(i,{variant:"body2",color:"text.secondary",children:"No team members found. Invite members to your project first."})}):e.jsx(bt,{children:G.map(h=>e.jsxs(Te,{divider:!0,children:[e.jsx(as,{sx:{mr:2},children:h.displayName.charAt(0).toUpperCase()}),e.jsx(Ne,{primary:h.displayName,secondary:h.email}),e.jsx(nr,{children:e.jsxs(Fe,{size:"small",sx:{minWidth:150},children:[e.jsx($e,{children:"Role"}),e.jsxs(Ge,{value:h.projectRoleId||"",label:"Role",onChange:P=>oe(h.id,P.target.value),children:[e.jsx(w,{value:"",children:e.jsx("em",{children:"No Role"})}),S.map(P=>e.jsx(w,{value:P.id,children:P.displayName},P.id))]})]})})]},h.id))})]})]}),Me=()=>e.jsxs(c,{children:[e.jsxs(c,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{startIcon:e.jsx(ls,{}),onClick:()=>g("overview"),variant:"outlined",size:"small",children:"Back"}),e.jsx(i,{variant:"h6",children:"Create Custom Role"})]}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(fe,{fullWidth:!0,label:"Role Name",value:se.displayName||"",onChange:h=>de(P=>({...P,displayName:h.target.value})),placeholder:"e.g., Senior Editor",sx:{mb:2}}),e.jsx(fe,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:se.description||"",onChange:h=>de(P=>({...P,description:h.target.value})),placeholder:"Describe the role's responsibilities...",sx:{mb:2}}),e.jsxs(Fe,{fullWidth:!0,sx:{mb:2},children:[e.jsx($e,{children:"Category"}),e.jsxs(Ge,{value:se.category||"PRODUCTION",label:"Category",onChange:h=>de(P=>({...P,category:h.target.value})),children:[e.jsx(w,{value:"PRODUCTION",children:"Production"}),e.jsx(w,{value:"POST_PRODUCTION",children:"Post-Production"}),e.jsx(w,{value:"ADMINISTRATIVE",children:"Administrative"}),e.jsx(w,{value:"CREATIVE",children:"Creative"}),e.jsx(w,{value:"TECHNICAL",children:"Technical"})]})]}),e.jsxs(c,{sx:{mb:2},children:[e.jsxs(i,{gutterBottom:!0,children:["Hierarchy Level: ",se.hierarchy]}),e.jsx(ti,{value:se.hierarchy||50,onChange:(h,P)=>de(K=>({...K,hierarchy:P})),min:1,max:100,marks:[{value:1,label:"Basic"},{value:50,label:"Standard"},{value:100,label:"Admin"}]})]})]}),e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(i,{variant:"subtitle1",gutterBottom:!0,children:"Permissions"}),e.jsxs(Ze,{sx:{p:2,maxHeight:400,overflow:"auto"},children:[e.jsx(Be,{control:e.jsx(Ye,{}),label:"Create & Edit Sessions"}),e.jsx(Be,{control:e.jsx(Ye,{}),label:"Manage Post-Production"}),e.jsx(Be,{control:e.jsx(Ye,{}),label:"Access Analytics"}),e.jsx(Be,{control:e.jsx(Ye,{}),label:"Manage Team"}),e.jsx(Be,{control:e.jsx(Ye,{}),label:"Project Settings"})]})]})]}),e.jsxs(c,{sx:{mt:3,textAlign:"right"},children:[e.jsx(B,{variant:"outlined",onClick:()=>g("overview"),sx:{mr:2},children:"Cancel"}),e.jsx(B,{variant:"contained",onClick:ie,disabled:!se.displayName||n,children:"Create Role"})]})]}),J=()=>e.jsxs(c,{children:[e.jsxs(c,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{startIcon:e.jsx(ls,{}),onClick:()=>g("overview"),variant:"outlined",size:"small",children:"Back"}),e.jsx(i,{variant:"h6",children:"Browse Role Templates"})]}),e.jsx(Ze,{sx:{p:2,mb:3},children:e.jsxs(x,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(x,{item:!0,xs:12,md:4,children:e.jsx(fe,{fullWidth:!0,size:"small",placeholder:"Search roles...",value:_,onChange:h=>ae(h.target.value),InputProps:{startAdornment:e.jsx(us,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsxs(Fe,{fullWidth:!0,size:"small",children:[e.jsx($e,{children:"Industry"}),e.jsxs(Ge,{value:Y,label:"Industry",onChange:h=>we(h.target.value),children:[e.jsx(w,{value:"all",children:"All Industries"}),e.jsx(w,{value:"FILM_TV",children:"Film & TV"}),e.jsx(w,{value:"CORPORATE_EVENTS",children:"Corporate Events"}),e.jsx(w,{value:"LIVE_EVENTS",children:"Live Events"}),e.jsx(w,{value:"SPORTS_BROADCAST",children:"Sports Broadcasting"}),e.jsx(w,{value:"GAMING_ESPORTS",children:"Gaming & Esports"}),e.jsx(w,{value:"HEALTHCARE",children:"Healthcare"}),e.jsx(w,{value:"IT_TECHNOLOGY",children:"IT & Technology"}),e.jsx(w,{value:"MARKETING_ADVERTISING",children:"Marketing & Advertising"}),e.jsx(w,{value:"EDUCATION_TRAINING",children:"Education & Training"}),e.jsx(w,{value:"CONSTRUCTION_ENGINEERING",children:"Construction & Engineering"}),e.jsx(w,{value:"FINANCE_BANKING",children:"Finance & Banking"}),e.jsx(w,{value:"GOVERNMENT_PUBLIC",children:"Government & Public"})]})]})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsx(Be,{control:e.jsx(Ye,{checked:ee,onChange:h=>ve(h.target.checked)}),label:"Popular Only"})}),e.jsx(x,{item:!0,xs:12,md:2,children:e.jsxs(i,{variant:"body2",color:"text.secondary",children:[Ae.length," roles"]})})]})}),e.jsx(x,{container:!0,spacing:2,children:Ae.map(h=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ge,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(Ce,{sx:{flexGrow:1},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(i,{variant:"h6",component:"div",noWrap:!0,children:h.name}),h.isPopular&&e.jsx(F,{size:"small",label:"Popular",color:"primary"})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:h.description}),e.jsxs(c,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(F,{size:"small",label:h.industry,variant:"outlined"}),e.jsx(F,{size:"small",label:`Level ${h.hierarchy}`,variant:"outlined"}),e.jsx(F,{size:"small",label:h.experienceLevel,variant:"outlined"})]}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["Used ",h.usageCount||0," times"]})]}),e.jsx(c,{sx:{p:2,pt:0},children:e.jsx(B,{fullWidth:!0,variant:"contained",size:"small",onClick:()=>pe(h),disabled:n,children:"Add to Project"})})]})},h.id))}),Ae.length===0&&e.jsxs(Ze,{sx:{p:4,textAlign:"center"},children:[e.jsx(i,{variant:"body1",color:"text.secondary",children:"No templates found matching your criteria."}),e.jsx(B,{variant:"outlined",onClick:()=>{ae(""),we("all"),ve(!1)},sx:{mt:2},children:"Clear Filters"})]})]}),T=()=>e.jsxs(c,{children:[e.jsxs(c,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{startIcon:e.jsx(ls,{}),onClick:()=>g("overview"),variant:"outlined",size:"small",children:"Back"}),e.jsx(i,{variant:"h6",children:"Your Created Roles"})]}),e.jsx(x,{container:!0,spacing:2,children:ne.map(h=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ge,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(Ce,{sx:{flexGrow:1},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(i,{variant:"h6",component:"div",noWrap:!0,children:h.displayName}),e.jsx(F,{size:"small",label:"Custom",color:"success"})]}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:h.description}),e.jsxs(c,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(F,{size:"small",label:h.category,variant:"outlined"}),e.jsx(F,{size:"small",label:`Level ${h.hierarchy}`,variant:"outlined"})]})]}),e.jsx(c,{sx:{p:2,pt:0},children:e.jsx(B,{fullWidth:!0,variant:"contained",size:"small",onClick:()=>Se(h),disabled:n,children:"Add to Project"})})]})},h.id))}),ne.length===0&&e.jsxs(Ze,{sx:{p:4,textAlign:"center"},children:[e.jsx(i,{variant:"body1",color:"text.secondary",children:"You haven't created any custom roles yet."}),e.jsx(B,{variant:"outlined",onClick:()=>g("create-custom"),sx:{mt:2},children:"Create Your First Role"})]})]});return e.jsxs(dt,{open:u,onClose:s,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{minHeight:"70vh"}},children:[e.jsx(ut,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Wt,{}),"Role Management - ",a]})}),e.jsxs(mt,{children:[j&&e.jsx(be,{severity:"error",sx:{mb:2},onClose:()=>b(null),children:j}),A&&e.jsx(be,{severity:"success",sx:{mb:2},onClose:()=>v(null),children:A}),n&&e.jsx(c,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(pt,{})}),l==="overview"&&We(),l==="create-custom"&&Me(),l==="browse-templates"&&J(),l==="user-created"&&T()]}),e.jsx(gt,{children:e.jsx(B,{onClick:s,children:"Close"})})]})},sr={ADMIN:100,GUEST:10,EXEC:95,ACCOUNT_MANAGER:75,PROJECT_MANAGER:70,PRODUCTION_MANAGER:65,MANAGER:60,BUSINESS_ANALYST:55,DEVOPS_ENGINEER:50,NETWORK_ENGINEER:45,SOUND_ENGINEER:40,LIGHTING_TECHNICIAN:35,DIT:35,TECH:30,NETWORKING:30,ART_DIRECTOR:60,VFX_ARTIST:40,MOTION_GRAPHICS_ARTIST:40,GFX_ARTIST:35,COLORIST:35,DIRECTOR:65,ASSIST_DIRECTOR:30,PRODUCER:55,ASSOCIATE_PRODUCER:45,POST_PRODUCER:50,LINE_PRODUCER:50,KEYNOTE_PRODUCER:45,KEYNOTE_PROD:40,PRODUCTION_ASSISTANT:25,POST_PA:25,EDITOR:45,ASSISTANT_EDITOR:30,POST_COORDINATOR:50,POST_PRODUCTION_SUPERVISOR:55,KEYNOTE_POST:40,AUDIO_PRODUCTION:40,AUDIO_POST:35,MEDIA_MANAGER:50,CAMERA_OPERATOR:35,QC_SPECIALIST:30},kt=class kt{constructor(){Ee(this,"roleMappingCache",new Map)}static getInstance(){return kt.instance||(kt.instance=new kt),kt.instance}mapLicensingRoleToDashboard(s,t,a="PRO"){console.log(`🔄 [RoleBridge] Mapping licensing role: ${s}${t?` with template: ${t.displayName}`:""}`);const o=`${s}-${(t==null?void 0:t.id)||"basic"}-${a}`;if(this.roleMappingCache.has(o))return this.roleMappingCache.get(o);let l,g,n=!1;if(t){const b=this.mapTemplateRoleToDashboard(t,s);l=b.dashboardRole,g=b.effectiveHierarchy,n=b.isCustomMapping}else{const b=this.mapBasicLicensingRole(s);l=b.dashboardRole,g=b.effectiveHierarchy}g=this.applyTierRestrictions(g,a);const y=this.generateRolePermissions(l,g,a),j={licensingRole:s,templateRole:t,dashboardRole:l,effectiveHierarchy:g,permissions:y,isCustomMapping:n};return this.roleMappingCache.set(o,j),console.log(`✅ [RoleBridge] Mapped to Dashboard role: ${l} (hierarchy: ${g})`),j}mapTemplateRoleToDashboard(s,t){const a=s.name.toUpperCase();s.displayName.toUpperCase();for(const[l,g]of Object.entries(sr))if(a.includes(l)||l.includes(a))return{dashboardRole:l,effectiveHierarchy:Math.max(s.hierarchy,g),isCustomMapping:!1};const o=this.getSemanticRoleMapping(s,t);return o||this.getHierarchyBasedMapping(s,t)}getSemanticRoleMapping(s,t){const a=s.displayName.toLowerCase();s.keyResponsibilities.join(" ").toLowerCase();const o=s.hierarchy;return o>=80||a.includes("manager")||a.includes("supervisor")||a.includes("director")?o>=90?{dashboardRole:"EXEC",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("post")||a.includes("production")?{dashboardRole:"POST_PRODUCTION_SUPERVISOR",effectiveHierarchy:o,isCustomMapping:!0}:{dashboardRole:"MANAGER",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("director")&&!a.includes("assistant")?{dashboardRole:"DIRECTOR",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("editor")?a.includes("assistant")?{dashboardRole:"ASSISTANT_EDITOR",effectiveHierarchy:o,isCustomMapping:!0}:{dashboardRole:"EDITOR",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("producer")?a.includes("associate")?{dashboardRole:"ASSOCIATE_PRODUCER",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("line")?{dashboardRole:"LINE_PRODUCER",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("post")?{dashboardRole:"POST_PRODUCER",effectiveHierarchy:o,isCustomMapping:!0}:{dashboardRole:"PRODUCER",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("camera")?{dashboardRole:"CAMERA_OPERATOR",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("sound")||a.includes("audio")?{dashboardRole:"SOUND_ENGINEER",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("lighting")?{dashboardRole:"LIGHTING_TECHNICIAN",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("color")?{dashboardRole:"COLORIST",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("graphics")||a.includes("gfx")?{dashboardRole:"GFX_ARTIST",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("qc")||a.includes("quality")?{dashboardRole:"QC_SPECIALIST",effectiveHierarchy:o,isCustomMapping:!0}:a.includes("assistant")||a.includes("support")||o<=20?{dashboardRole:"PRODUCTION_ASSISTANT",effectiveHierarchy:o,isCustomMapping:!0}:null}getHierarchyBasedMapping(s,t){const a=s.hierarchy;return a>=90?{dashboardRole:"EXEC",effectiveHierarchy:a,isCustomMapping:!0}:a>=80?{dashboardRole:"MANAGER",effectiveHierarchy:a,isCustomMapping:!0}:a>=60?{dashboardRole:"PRODUCER",effectiveHierarchy:a,isCustomMapping:!0}:a>=40?{dashboardRole:"EDITOR",effectiveHierarchy:a,isCustomMapping:!0}:a>=20?{dashboardRole:"PRODUCTION_ASSISTANT",effectiveHierarchy:a,isCustomMapping:!0}:{dashboardRole:"GUEST",effectiveHierarchy:a,isCustomMapping:!0}}mapBasicLicensingRole(s){switch(s){case ct.ADMIN:return{dashboardRole:"ADMIN",effectiveHierarchy:100};case ct.MEMBER:return{dashboardRole:"PRODUCER",effectiveHierarchy:60};default:return{dashboardRole:"GUEST",effectiveHierarchy:10}}}applyTierRestrictions(s,t){switch(t){case"BASIC":return Math.min(s,40);case"PRO":return Math.min(s,80);case"ENTERPRISE":return s;default:return Math.min(s,40)}}generateRolePermissions(s,t,a){const o={canManageTeam:t>=80,canManageProjects:t>=60,canViewFinancials:t>=70&&(a==="PRO"||a==="ENTERPRISE"),canEditContent:t>=25,canApproveContent:t>=40,canAccessReports:t>=30,canManageSettings:t>=90,hierarchyLevel:t};return a==="BASIC"&&(o.canViewFinancials=!1,o.canManageSettings=!1),o}getAvailableDashboardRoles(s,t){const a=this.applyTierRestrictions(100,t);return Object.entries(sr).filter(([o,l])=>l<=a).map(([o,l])=>o)}validateRoleAssignment(s,t,a){const o=sr[t],l=this.applyTierRestrictions(100,a);return o>l?{isValid:!1,reason:`Role ${t} (hierarchy ${o}) exceeds maximum allowed for ${a} tier (${l})`}:{isValid:!0}}clearCache(){this.roleMappingCache.clear(),console.log("🧹 [RoleBridge] Role mapping cache cleared")}};Ee(kt,"instance");let zs=kt;const zt=class zt{constructor(){Ee(this,"roleBridgeService");Ee(this,"syncListeners",new Map);Ee(this,"syncQueue",[]);Ee(this,"isProcessingQueue",!1);Ee(this,"config",{enableRealTimeSync:!0,enableBidirectionalSync:!0,conflictResolution:"hierarchy-based",batchSize:10,retryAttempts:3,syncTimeout:3e4});this.roleBridgeService=zs.getInstance(),this.initializeSyncListeners()}static getInstance(){return zt.instance||(zt.instance=new zt),zt.instance}initializeSyncListeners(){if(!this.config.enableRealTimeSync)return;console.log("🔄 [CrossAppSync] Initializing real-time sync listeners");const s=cs(Xe,"roleSyncEvents"),t=ca(s,a=>{a.docChanges().forEach(o=>{if(o.type==="added"){const l={id:o.doc.id,...o.doc.data()};this.handleIncomingSyncEvent(l)}})});this.syncListeners.set("roleSyncEvents",t)}async syncRoleToLicensing(s,t,a,o,l,g){if(!this.config.enableRealTimeSync){console.log(`⏸️ [CrossAppSync] Sync disabled, skipping role sync for: ${s}`);return}console.log(`🔄 [CrossAppSync] Syncing role to licensing: ${s} -> ${o}`);try{const n=this.roleBridgeService.mapLicensingRoleToDashboard(o,l,"PRO"),y={type:"ROLE_ASSIGNED",sourceApp:"licensing",targetApp:"dashboard",timestamp:new Date,userId:s,projectId:t,organizationId:a,data:{licensingRole:o,templateRole:l,dashboardRole:n.dashboardRole,hierarchy:n.effectiveHierarchy,permissions:n.permissions,roleMapping:n,assignedBy:g,reason:"Role assigned via licensing website wizard"},status:"pending"};await this.addToSyncQueue(y),await this.updateUserRoleMapping(s,t,n),console.log(`✅ [CrossAppSync] Role sync initiated for user: ${s}`)}catch(n){throw console.error("❌ [CrossAppSync] Error syncing role to licensing:",n),n}}async syncRoleFromDashboard(s,t,a,o,l,g){if(!this.config.enableRealTimeSync){console.log(`⏸️ [CrossAppSync] Sync disabled, skipping Dashboard role sync for: ${s}`);return}console.log(`🔄 [CrossAppSync] Syncing role from Dashboard: ${s} -> ${o}`);try{const n={type:"ROLE_ASSIGNED",sourceApp:"dashboard",targetApp:"licensing",timestamp:new Date,userId:s,projectId:t,organizationId:a,data:{dashboardRole:o,hierarchy:l,assignedBy:g,reason:"Role assigned via Dashboard application"},status:"pending"};await this.addToSyncQueue(n),console.log(`✅ [CrossAppSync] Dashboard role sync initiated for user: ${s}`)}catch(n){throw console.error("❌ [CrossAppSync] Error syncing role from Dashboard:",n),n}}async addToSyncQueue(s){try{const t=await Ri(cs(Xe,"roleSyncEvents"),{...s,timestamp:st.fromDate(s.timestamp)});s.id=t.id,this.syncQueue.push(s),this.isProcessingQueue||this.processSyncQueue()}catch(t){throw console.error("❌ [CrossAppSync] Error adding to sync queue:",t),t}}async processSyncQueue(){if(!(this.isProcessingQueue||this.syncQueue.length===0)){this.isProcessingQueue=!0,console.log(`🔄 [CrossAppSync] Processing sync queue: ${this.syncQueue.length} events`);try{for(;this.syncQueue.length>0;){const s=this.syncQueue.splice(0,this.config.batchSize);await Promise.all(s.map(t=>this.processSyncEvent(t)))}}catch(s){console.error("❌ [CrossAppSync] Error processing sync queue:",s)}finally{this.isProcessingQueue=!1}}}async processSyncEvent(s){console.log(`🔄 [CrossAppSync] Processing sync event: ${s.type} for user ${s.userId}`);try{switch(await this.updateSyncEventStatus(s.id,"processing"),s.type){case"ROLE_ASSIGNED":await this.processRoleAssignment(s);break;case"ROLE_UPDATED":await this.processRoleUpdate(s);break;case"ROLE_REMOVED":await this.processRoleRemoval(s);break;case"HIERARCHY_CHANGED":await this.processHierarchyChange(s);break;case"PERMISSIONS_UPDATED":await this.processPermissionsUpdate(s);break}await this.updateSyncEventStatus(s.id,"completed"),console.log(`✅ [CrossAppSync] Sync event completed: ${s.id}`)}catch(t){console.error(`❌ [CrossAppSync] Error processing sync event ${s.id}:`,t);const a=t instanceof Error?t.message:"Unknown error";await this.updateSyncEventStatus(s.id,"failed",a)}}async processRoleAssignment(s){const{userId:t,projectId:a,data:o}=s;s.targetApp==="dashboard"?await this.syncToDashboardApp(t,a,o.roleMapping):s.targetApp==="licensing"&&await this.syncToLicensingApp(t,a,o.dashboardRole,o.hierarchy)}async syncToDashboardApp(s,t,a){var o;console.log(`🎯 [CrossAppSync] Syncing to existing collections: ${s} -> ${a.dashboardRole}`);try{const l=Rt(Xe,"users",s),g=await ur(l),n={[t]:{dashboardRole:a.dashboardRole,hierarchy:a.effectiveHierarchy,permissions:a.permissions,licensingRole:a.licensingRole,templateRole:((o=a.templateRole)==null?void 0:o.id)||null,syncedAt:st.now(),syncSource:"licensing"}};if(g.exists())await ss(l,{[`dashboardRoleMappings.${t}`]:n[t],lastRoleSync:st.now(),roleSystemVersion:"2.0"}),console.log(`✅ [CrossAppSync] Updated user Dashboard role mapping: ${s}`);else{console.warn(`⚠️ [CrossAppSync] User document not found: ${s}`);return}const y=Ms(cs(Xe,"projectAssignments"),ds("projectId","==",t),ds("userId","==",s),ds("isActive","==",!0)),j=await cr(y);if(j.empty)console.warn(`⚠️ [CrossAppSync] No active project assignment found for user ${s} in project ${t}`);else{const b=j.docs[0];await ss(b.ref,{dashboardRole:a.dashboardRole,hierarchyLevel:a.effectiveHierarchy,enhancedPermissions:a.permissions,syncMetadata:{lastSyncedAt:st.now(),syncSource:"licensing",syncVersion:"2.0"}}),console.log(`✅ [CrossAppSync] Updated project assignment with Dashboard role: ${s}`)}}catch(l){throw console.error(`❌ [CrossAppSync] Error syncing to existing collections for user ${s}:`,l),l}}async syncToLicensingApp(s,t,a,o){console.log(`🎯 [CrossAppSync] Syncing to Licensing: ${s} -> ${a}`);const l=Rt(Xe,"projectAssignments",`${t}-${s}`);await ss(l,{dashboardRole:a,hierarchy:o,syncedAt:st.now(),syncSource:"dashboard"})}async handleIncomingSyncEvent(s){s.status==="pending"&&(this.syncQueue.push(s),this.isProcessingQueue||this.processSyncQueue())}async updateUserRoleMapping(s,t,a){try{const o=Rt(Xe,"users",s),l=await ur(o),g={...a,updatedAt:st.now()};l.exists()?(await ss(o,{[`roleMappings.${t}`]:g}),console.log(`✅ [CrossAppSync] Updated role mapping for user: ${s}`)):(await dr(o,{id:s,roleMappings:{[t]:g},createdAt:st.now(),updatedAt:st.now()}),console.log(`✅ [CrossAppSync] Created user with role mapping: ${s}`))}catch(o){console.error(`❌ [CrossAppSync] Error updating role mapping for user ${s}:`,o)}}async updateSyncEventStatus(s,t,a){const o=Rt(Xe,"roleSyncEvents",s),l={status:t,updatedAt:st.now()};a&&(l.error=a),await ss(o,l)}async processRoleUpdate(s){console.log("🔄 [CrossAppSync] Processing role update:",s.id)}async processRoleRemoval(s){console.log("🔄 [CrossAppSync] Processing role removal:",s.id)}async processHierarchyChange(s){console.log("🔄 [CrossAppSync] Processing hierarchy change:",s.id)}async processPermissionsUpdate(s){console.log("🔄 [CrossAppSync] Processing permissions update:",s.id)}configureSyncSettings(s){this.config={...this.config,...s},console.log("⚙️ [CrossAppSync] Sync configuration updated:",this.config),s.enableRealTimeSync&&!this.syncListeners.has("roleSyncEvents")&&this.initializeSyncListeners()}enableSync(){this.configureSyncSettings({enableRealTimeSync:!0}),console.log("✅ [CrossAppSync] Cross-app synchronization enabled")}disableSync(){this.configureSyncSettings({enableRealTimeSync:!1}),console.log("⏸️ [CrossAppSync] Cross-app synchronization disabled")}async getSyncStatus(s,t){return[]}cleanup(){this.syncListeners.forEach(s=>{s()}),this.syncListeners.clear(),console.log("🧹 [CrossAppSync] Sync listeners cleaned up")}};Ee(zt,"instance");let hr=zt;const rr=["Choose Action","Select Members","Assign Roles","Review & Confirm"],Ui=({open:u,onClose:s,projectId:t,projectName:a,organizationId:o,onTeamMembersUpdated:l,existingProjectTeamMembers:g})=>{const[n,y]=d.useState(0),[j,b]=d.useState(!1),[A,v]=d.useState(null),[S,W]=d.useState(null),[G,X]=d.useState(null),[ne,I]=d.useState([]),[_,ae]=d.useState([]),[Y,we]=d.useState([]),[ee,ve]=d.useState([]),[se,de]=d.useState([]),[q,V]=d.useState(!1),je=zs.getInstance(),ie=hr.getInstance(),[pe,oe]=d.useState(""),[Se,Ae]=d.useState("popular"),[We,Me]=d.useState("all");d.useEffect(()=>{u&&t&&J()},[u,t]);const J=async()=>{b(!0),v(null);try{await T(),await Promise.all([h(),P()])}catch(f){console.error("❌ [TeamRoleWizard] Error loading data:",f),v("Failed to load data. Please try again.")}finally{b(!1)}},T=async()=>{try{if(console.log(`🔍 [TeamRoleWizard] Loading existing team members for project: ${t}`),g&&g.length>0){console.log(`✅ [TeamRoleWizard] Using ${g.length} existing team members from parent component`),console.log("🔍 [TeamRoleWizard] Parent team members data:",g),de(g);const O=g.some(R=>R.role==="ADMIN"||R.role===ct.ADMIN||R.role==="ENTERPRISE");V(O),console.log(`🛡️ [TeamRoleWizard] Project has admin: ${O}`);return}const f=ea.getInstance({isWebOnlyMode:!0,apiBaseUrl:"/api"});try{const O=await f.getProjectTeamMembers(t);console.log(`✅ [TeamRoleWizard] Found ${O.length} existing team members from TeamMemberService`),console.log("🔍 [TeamRoleWizard] Service team members data:",O),de(O);const R=O.some(M=>M.role==="ADMIN"||M.role===ct.ADMIN||M.role==="ENTERPRISE");V(R),console.log(`🛡️ [TeamRoleWizard] Project has admin: ${R}`)}catch(O){console.warn("⚠️ [TeamRoleWizard] TeamMemberService failed:",O),de([]),V(!1),console.log("⚠️ [TeamRoleWizard] Using empty team member list - filtering may not work correctly")}}catch(f){console.error("❌ [TeamRoleWizard] Error loading existing team members:",f),de([]),V(!1)}},h=async()=>{try{console.log(`🔍 [TeamRoleWizard] Loading team members for project: ${t}`);const f=await ta.getTeamMembersForOrganization(),O=se.map(C=>C.id||C.userId||C.memberId||C.firebaseUid),R=se.map(C=>C.email).filter(Boolean);console.log(`🔍 [TeamRoleWizard] Found ${O.length} already assigned member IDs:`,O),console.log(`🔍 [TeamRoleWizard] Found ${R.length} already assigned member emails:`,R),console.log("🔍 [TeamRoleWizard] Existing team members structure:",se);const M=f.filter(C=>{const De=O.includes(C.id),z=R.includes(C.email),L=De||z;return L&&console.log(`🚫 [TeamRoleWizard] Filtering out already assigned member: ${C.name||C.email} (ID: ${C.id}, Email: ${C.email})`),!L}),H=M.map(C=>({id:C.id,name:C.name||`${C.firstName} ${C.lastName}`,email:C.email,tier:C.role||C.licenseType||"MEMBER",isSelected:!1}));I(H),console.log(`✅ [TeamRoleWizard] Loaded ${H.length} available team members (filtered out ${f.length-M.length} already assigned)`)}catch(f){console.error("❌ [TeamRoleWizard] Error loading members:",f),v(`Failed to load team members: ${f.message}`),I([])}},P=async()=>{try{console.log(`🔍 [TeamRoleWizard] Loading roles for project: ${t}`);let f=[{id:"basic-admin",name:"ADMIN",displayName:"Project Admin",description:"Full administrative access to the project",category:"MANAGEMENT",hierarchy:100,isTemplate:!1,isPopular:!0},{id:"basic-manager",name:"MANAGER",displayName:"Project Manager",description:"Manage project tasks and team members",category:"MANAGEMENT",hierarchy:80,isTemplate:!1,isPopular:!0},{id:"basic-doer",name:"MEMBER",displayName:"Team Member",description:"Standard team member with task execution access",category:"EXECUTION",hierarchy:60,isTemplate:!1,isPopular:!0},{id:"basic-viewer",name:"VIEWER",displayName:"Viewer",description:"Read-only access to project information",category:"ACCESS",hierarchy:20,isTemplate:!1,isPopular:!1}];const R=gs().map(M=>({id:`template-${M.id}`,name:M.name,displayName:M.displayName,description:M.description,category:M.category,hierarchy:M.hierarchy,isTemplate:!0,isPopular:M.isPopular,industry:M.industry,tags:M.tags,usageCount:M.usageCount,icon:M.icon,color:M.color}));console.log(`🎭 [TeamRoleWizard] Loaded ${R.length} enhanced role templates`),we([...f,...R])}catch(f){console.error("❌ [TeamRoleWizard] Error loading roles:",f),we([])}},K=()=>{if(n===0&&!G){v("Please choose an action to continue");return}if(n===1&&_.length===0){v("Please select at least one team member");return}if(n===2){const f=_.filter(O=>!ee.find(R=>R.memberId===O.id));if(f.length>0){v(`Please assign roles to: ${f.map(O=>O.name).join(", ")}`);return}if(!q&&!ee.some(R=>{const M=Y.find(H=>H.id===R.roleId);return(M==null?void 0:M.name)==="ADMIN"})){v("⚠️ This project needs an ADMIN! Please assign the ADMIN role to at least one team member before proceeding.");return}}v(null),y(f=>Math.min(f+1,rr.length-1))},Z=()=>{v(null),y(f=>Math.max(f-1,0))},ye=()=>{y(0),X(null),ae([]),ve([]),v(null),W(null)},le=f=>{ae(O=>O.some(M=>M.id===f.id)?(ve(M=>M.filter(H=>H.memberId!==f.id)),O.filter(M=>M.id!==f.id)):[...O,f])},re=(f,O)=>{ve(R=>{const M=R.find(De=>De.memberId===f);let H;M?H=R.map(De=>De.memberId===f?{...De,roleId:O}:De):H=[...R,{memberId:f,roleId:O}];const C=Y.find(De=>De.id===O);return(C==null?void 0:C.name)==="ADMIN"&&console.log("🛡️ [TeamRoleWizard] ADMIN role assigned - updating project admin status"),H})},k=async()=>{b(!0),v(null);try{console.log(`🚀 [TeamRoleWizard] Starting assignment process for ${ee.length} assignments`);const f=ea.getInstance({isWebOnlyMode:!0,apiBaseUrl:"/api"});for(let O=0;O<ee.length;O++){const R=ee[O],M=Y.find(L=>L.id===R.roleId),H=_.find(L=>L.id===R.memberId);console.log(`📋 [TeamRoleWizard] Processing assignment ${O+1}/${ee.length}: ${H==null?void 0:H.name} -> ${M==null?void 0:M.displayName}`);let C=ct.MEMBER,De=null,z=ct.MEMBER;if((M==null?void 0:M.name)==="ADMIN"?(z=ct.ADMIN,C=ct.ADMIN):(z=ct.MEMBER,C=ct.MEMBER),M!=null&&M.isTemplate&&H){console.log(`🎭 [TeamRoleWizard] Mapping template role: ${M.displayName}`);const L={id:M.id,name:M.name,displayName:M.displayName,description:M.description,industry:"FILM_TV",eventTypes:[],category:M.category,hierarchy:M.hierarchy,baseRole:"PRODUCER",permissions:{},raciLevel:"RESPONSIBLE",keyResponsibilities:[],requiredSkills:[],reportingStructure:{},tags:M.tags||[],isPopular:M.isPopular||!1,usageCount:M.usageCount||0,icon:M.icon||"Person",color:M.color||"#1976d2",experienceLevel:"Mid"},ue=je.mapLicensingRoleToDashboard(z,L,"PRO");De=ue.dashboardRole,console.log(`✅ [TeamRoleWizard] Template mapped to Dashboard role: ${De} (hierarchy: ${ue.effectiveHierarchy})`);try{await ie.syncRoleToLicensing(H.id,t,o,z,L,"licensing-wizard"),console.log(`🔄 [TeamRoleWizard] Role synced to Dashboard for: ${H.name}`)}catch(ze){console.warn("⚠️ [TeamRoleWizard] Failed to sync role to Dashboard:",ze)}}console.log(`👥 [TeamRoleWizard] Adding team member to project: ${H==null?void 0:H.name} with role: ${C}`);try{if(!await f.addTeamMemberToProject(t,R.memberId,C))throw new Error(`Failed to add ${(H==null?void 0:H.name)||"team member"} to project`);console.log(`✅ [TeamRoleWizard] Successfully added ${H==null?void 0:H.name} to project`)}catch(L){console.warn("⚠️ [TeamRoleWizard] TeamMemberService failed, trying UnifiedDataService:",L);try{await ta.addTeamMemberToProject(t,R.memberId,C),console.log(`✅ [TeamRoleWizard] Successfully added ${H==null?void 0:H.name} via UnifiedDataService`)}catch(ue){throw new Error(`Failed to add ${(H==null?void 0:H.name)||"team member"}: ${ue.message}`)}}}console.log("🎉 [TeamRoleWizard] All assignments completed successfully!"),W(`Successfully added ${_.length} team member${_.length!==1?"s":""} to the project!`),l&&(console.log("🔄 [TeamRoleWizard] Notifying parent component to refresh team members"),l()),setTimeout(()=>{s(),ye()},2e3)}catch(f){console.error("❌ [TeamRoleWizard] Error submitting:",f),v(f.message||"Failed to add team members")}finally{b(!1)}},te=Y.filter(f=>{var O;if(f.name==="ADMIN"){const R=ee.some(M=>{const H=Y.find(C=>C.id===M.roleId);return(H==null?void 0:H.name)==="ADMIN"});if(q||R)return!1}if(Se==="templates"){if(!f.isTemplate)return!1}else if(Se==="custom"){if(f.isTemplate)return!1}else if(Se==="popular"&&(!f.isTemplate||!f.isPopular))return!1;if(We!=="all"&&f.industry&&f.industry!==We)return!1;if(pe.trim()){const R=pe.toLowerCase(),M=f.displayName.toLowerCase().includes(R),H=f.description.toLowerCase().includes(R),C=((O=f.tags)==null?void 0:O.some(De=>De.toLowerCase().includes(R)))||!1;if(!M&&!H&&!C)return!1}return!0}),Ie=()=>{switch(n){case 0:return e.jsxs(c,{textAlign:"center",py:4,children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"What would you like to do?"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:4},children:"Choose an action to get started with team management"}),e.jsxs(x,{container:!0,spacing:3,justifyContent:"center",children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(ge,{sx:{cursor:"pointer",border:G==="add-members"?2:1,borderColor:G==="add-members"?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>X("add-members"),children:e.jsxs(Ce,{sx:{textAlign:"center",py:4},children:[e.jsx(ia,{sx:{fontSize:48,color:"primary.main",mb:2}}),e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Add Team Members"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Add new team members to this project and assign them roles"})]})})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(ge,{sx:{cursor:"pointer",border:G==="manage-roles"?2:1,borderColor:G==="manage-roles"?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>X("manage-roles"),children:e.jsxs(Ce,{sx:{textAlign:"center",py:4},children:[e.jsx(Wt,{sx:{fontSize:48,color:"primary.main",mb:2}}),e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Manage Roles"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Create custom roles or use templates for your project"})]})})})]})]});case 1:return e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Select Team Members"}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:['Choose team members to add to "',a,'"']}),se.length>0&&e.jsx(be,{severity:"info",sx:{mb:3},children:e.jsxs(i,{variant:"body2",children:[e.jsx("strong",{children:"Current Team:"})," This project already has ",se.length," team member",se.length!==1?"s":""," assigned.",q&&e.jsx(e.Fragment,{children:" ✅ Project has an admin."}),!q&&e.jsx(e.Fragment,{children:" ⚠️ Project needs an admin to be assigned."})]})}),e.jsx(fe,{fullWidth:!0,placeholder:"Search team members...",value:pe,onChange:f=>oe(f.target.value),InputProps:{startAdornment:e.jsx(us,{sx:{mr:1,color:"text.secondary"}})},sx:{mb:3}}),e.jsx(ge,{children:e.jsxs(Ce,{children:[e.jsxs(i,{variant:"subtitle1",gutterBottom:!0,children:["Available Team Members (",ne.length,")"]}),ne.length===0?e.jsx(be,{severity:"info",children:e.jsxs(i,{variant:"body2",children:[e.jsx("strong",{children:"No available team members found."}),se.length>0?e.jsx(e.Fragment,{children:" All organization members are already assigned to this project. To reassign a member, please remove them from the project first using the Project Details panel."}):e.jsx(e.Fragment,{children:" No team members are available in your organization. Please add team members to your organization first."})]})}):e.jsx(bt,{children:ne.filter(f=>{var O,R;return((O=f.name)==null?void 0:O.toLowerCase().includes(pe.toLowerCase()))||((R=f.email)==null?void 0:R.toLowerCase().includes(pe.toLowerCase()))}).map(f=>{var O,R;return e.jsxs(Te,{divider:!0,children:[e.jsx(ci,{children:e.jsx(as,{src:f.avatar,children:((O=f.name)==null?void 0:O.charAt(0))||((R=f.email)==null?void 0:R.charAt(0))})}),e.jsx(Ne,{primary:f.name||f.email,secondary:e.jsxs(c,{children:[e.jsx(i,{variant:"body2",color:"text.secondary",children:f.email}),e.jsx(F,{label:f.tier,size:"small",sx:{mt:.5}})]})}),e.jsx(nr,{children:e.jsx(ar,{checked:_.some(M=>M.id===f.id),onChange:()=>le(f)})})]},f.id)})})]})}),_.length>0&&e.jsx(ge,{sx:{mt:2},children:e.jsxs(Ce,{children:[e.jsxs(i,{variant:"subtitle1",gutterBottom:!0,children:["Selected Members (",_.length,")"]}),e.jsx(c,{display:"flex",flexWrap:"wrap",gap:1,children:_.map(f=>{var O,R;return e.jsx(F,{label:f.name||f.email,onDelete:()=>le(f),avatar:e.jsx(as,{src:f.avatar,children:((O=f.name)==null?void 0:O.charAt(0))||((R=f.email)==null?void 0:R.charAt(0))})},f.id)})})]})})]});case 2:return e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Assign Roles"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Assign roles to the selected team members from our comprehensive template library"}),!q&&e.jsx(be,{severity:"warning",sx:{mb:2},children:e.jsxs(i,{variant:"body2",children:[e.jsx("strong",{children:"⚠️ ADMIN Required!"})," This project doesn't have an administrator yet. You must assign the ADMIN role to at least one team member to proceed."]})}),e.jsx(be,{severity:"info",sx:{mb:3},children:e.jsxs(i,{variant:"body2",children:[e.jsx("strong",{children:"50+ Professional Role Templates Available!"})," Choose from industry-specific roles including Film & TV, Corporate, Live Events, Education, Sports, Streaming, Music, and Marketing. Popular templates are shown by default.",q&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("strong",{children:"Note:"})," ADMIN role is not available as this project already has an administrator."]})]})}),e.jsxs(c,{sx:{mb:3},children:[e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsxs(Fe,{fullWidth:!0,size:"small",children:[e.jsx($e,{children:"Role Type"}),e.jsxs(Ge,{value:Se,onChange:f=>Ae(f.target.value),label:"Role Type",children:[e.jsx(w,{value:"popular",children:"Popular Templates"}),e.jsx(w,{value:"templates",children:"All Templates"}),e.jsx(w,{value:"custom",children:"Custom Roles"}),e.jsx(w,{value:"all",children:"All Roles"})]})]})}),e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsxs(Fe,{fullWidth:!0,size:"small",children:[e.jsx($e,{children:"Industry"}),e.jsxs(Ge,{value:We,onChange:f=>Me(f.target.value),label:"Industry",children:[e.jsx(w,{value:"all",children:"All Industries"}),e.jsx(w,{value:"FILM_TV",children:e.jsxs(c,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ra,{fontSize:"small"}),"Film & TV"]})}),e.jsx(w,{value:"CORPORATE",children:e.jsxs(c,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(sa,{fontSize:"small"}),"Corporate"]})}),e.jsx(w,{value:"LIVE_EVENTS",children:e.jsxs(c,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ai,{fontSize:"small"}),"Live Events"]})}),e.jsx(w,{value:"EDUCATION",children:e.jsxs(c,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(oa,{fontSize:"small"}),"Education"]})}),e.jsx(w,{value:"SPORTS",children:e.jsxs(c,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ii,{fontSize:"small"}),"Sports"]})}),e.jsx(w,{value:"STREAMING",children:e.jsxs(c,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ni,{fontSize:"small"}),"Streaming"]})}),e.jsx(w,{value:"MUSIC",children:e.jsxs(c,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(oi,{fontSize:"small"}),"Music"]})}),e.jsx(w,{value:"MARKETING",children:e.jsxs(c,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(li,{fontSize:"small"}),"Marketing"]})})]})]})}),e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsx(fe,{fullWidth:!0,size:"small",placeholder:"Search roles...",value:pe,onChange:f=>oe(f.target.value),InputProps:{startAdornment:e.jsx(us,{sx:{mr:1,color:"text.secondary"}})}})})]}),e.jsxs(c,{sx:{mt:2,display:"flex",alignItems:"center",gap:1},children:[e.jsxs(i,{variant:"caption",color:"text.secondary",children:["Showing ",te.length," roles"]}),Se==="popular"&&e.jsx(F,{label:"Popular",size:"small",color:"primary"}),We!=="all"&&e.jsx(F,{label:We.replace("_"," "),size:"small",variant:"outlined",onDelete:()=>Me("all")}),pe&&e.jsx(F,{label:`"${pe}"`,size:"small",variant:"outlined",onDelete:()=>oe("")})]})]}),_.map(f=>{var M,H;const O=ee.find(C=>C.memberId===f.id),R=O?te.find(C=>C.id===O.roleId):null;return e.jsx(ge,{sx:{mb:2},children:e.jsxs(Ce,{children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(as,{src:f.avatar,children:((M=f.name)==null?void 0:M.charAt(0))||((H=f.email)==null?void 0:H.charAt(0))}),e.jsxs(c,{flex:1,children:[e.jsx(i,{variant:"subtitle1",children:f.name||f.email}),e.jsx(i,{variant:"body2",color:"text.secondary",children:f.email})]})]}),e.jsxs(Fe,{fullWidth:!0,children:[e.jsx($e,{children:"Assign Role"}),e.jsx(Ge,{value:(O==null?void 0:O.roleId)||"",onChange:C=>re(f.id,C.target.value),label:"Assign Role",children:te.map(C=>e.jsx(w,{value:C.id,sx:{...C.name==="ADMIN"&&!q&&{backgroundColor:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)","&:hover":{backgroundColor:"rgba(255, 152, 0, 0.2)"}}},children:e.jsxs(c,{display:"flex",alignItems:"center",gap:1,width:"100%",children:[e.jsx(c,{sx:{minWidth:24},children:C.name==="ADMIN"?e.jsx(Wt,{fontSize:"small",color:"warning"}):C.icon?e.jsx(i,{sx:{fontSize:"1.2em"},children:C.icon}):e.jsx(Wt,{fontSize:"small",color:"action"})}),e.jsxs(c,{flex:1,children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:1,mb:.5,children:[e.jsxs(i,{variant:"body1",sx:{fontWeight:C.name==="ADMIN"?600:500,color:C.name==="ADMIN"&&!q?"warning.main":"inherit"},children:[C.displayName,C.name==="ADMIN"&&!q&&" ⚠️ REQUIRED"]}),C.isPopular&&e.jsx(Hr,{sx:{fontSize:16,color:"orange"}}),C.isTemplate&&e.jsx(F,{label:"Template",size:"small",sx:{height:16,fontSize:"0.65rem"}})]}),e.jsx(i,{variant:"caption",color:"text.secondary",display:"block",children:C.description}),C.industry&&e.jsxs(i,{variant:"caption",color:"primary.main",children:[C.industry.replace("_"," ")," • Level ",C.hierarchy]}),C.tags&&C.tags.length>0&&e.jsx(c,{sx:{mt:.5},children:C.tags.slice(0,3).map(De=>e.jsx(F,{label:De,size:"small",variant:"outlined",sx:{height:16,fontSize:"0.6rem",mr:.5,mb:.5}},De))})]}),e.jsxs(c,{textAlign:"right",children:[e.jsx(F,{label:C.category,size:"small",variant:"outlined",sx:{mb:.5}}),C.usageCount&&e.jsxs(i,{variant:"caption",color:"text.secondary",display:"block",children:[C.usageCount," uses"]})]})]})},C.id))})]}),R&&e.jsxs(be,{severity:"info",sx:{mt:2},children:[e.jsxs(i,{variant:"body2",children:[e.jsx("strong",{children:R.displayName})," - Level ",R.hierarchy]}),e.jsx(i,{variant:"caption",children:R.description})]})]})},f.id)})]});case 3:return e.jsxs(c,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Review & Confirm"}),e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Review the team member assignments before confirming"}),e.jsx(ge,{children:e.jsxs(Ce,{children:[e.jsxs(i,{variant:"subtitle1",gutterBottom:!0,children:["Project: ",a]}),e.jsxs(i,{variant:"body2",color:"text.secondary",sx:{mb:3},children:["Adding ",_.length," team member",_.length!==1?"s":""]}),_.map(f=>{var M,H;const O=ee.find(C=>C.memberId===f.id),R=O?Y.find(C=>C.id===O.roleId):null;return e.jsxs(c,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(as,{src:f.avatar,children:((M=f.name)==null?void 0:M.charAt(0))||((H=f.email)==null?void 0:H.charAt(0))}),e.jsxs(c,{flex:1,children:[e.jsx(i,{variant:"body1",children:f.name||f.email}),e.jsx(i,{variant:"body2",color:"text.secondary",children:f.email})]}),e.jsxs(c,{textAlign:"right",children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:1,justifyContent:"flex-end",mb:.5,children:[(R==null?void 0:R.icon)&&e.jsx(i,{sx:{fontSize:"1em"},children:R.icon}),e.jsx(F,{label:(R==null?void 0:R.displayName)||"No Role",color:R?"primary":"default",size:"small"}),(R==null?void 0:R.isPopular)&&e.jsx(Hr,{sx:{fontSize:14,color:"orange"}})]}),e.jsxs(i,{variant:"caption",display:"block",color:"text.secondary",children:[R!=null&&R.isTemplate?"Template Role":"Custom Role"," • Level ",(R==null?void 0:R.hierarchy)||0]}),(R==null?void 0:R.industry)&&e.jsx(i,{variant:"caption",display:"block",color:"primary.main",children:R.industry.replace("_"," ")}),(R==null?void 0:R.tags)&&R.tags.length>0&&e.jsx(c,{sx:{mt:.5},children:R.tags.slice(0,2).map(C=>e.jsx(F,{label:C,size:"small",variant:"outlined",sx:{height:14,fontSize:"0.6rem",mr:.5}},C))})]})]},f.id)})]})})]});default:return null}};return e.jsxs(dt,{open:u,onClose:s,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsx(ut,{children:e.jsxs(c,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(c,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(Bt,{color:"primary"}),e.jsxs(c,{children:[e.jsx(i,{variant:"h6",children:"Team & Role Management"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:a})]})]}),e.jsx(et,{onClick:s,size:"small",children:e.jsx(ls,{})})]})}),e.jsxs(mt,{children:[e.jsx(_s,{activeStep:n,sx:{mb:4},children:rr.map(f=>e.jsx(Lt,{children:e.jsx(qt,{children:f})},f))}),A&&e.jsx(be,{severity:"error",sx:{mb:3},onClose:()=>v(null),children:A}),S&&e.jsx(be,{severity:"success",sx:{mb:3},children:S}),j&&e.jsx(c,{display:"flex",justifyContent:"center",py:4,children:e.jsx(pt,{})}),!j&&Ie()]}),e.jsxs(gt,{sx:{p:3,pt:0},children:[e.jsx(B,{onClick:s,disabled:j,children:"Cancel"}),e.jsx(c,{flex:1}),n>0&&e.jsx(B,{onClick:Z,disabled:j,startIcon:e.jsx(si,{}),children:"Back"}),n<rr.length-1?e.jsx(B,{variant:"contained",onClick:K,disabled:j,endIcon:e.jsx(ri,{}),children:"Next"}):e.jsx(B,{variant:"contained",onClick:k,disabled:j||_.length===0,startIcon:e.jsx(vr,{}),children:j?"Adding...":"Add Team Members"})]})]})},_t=class _t{constructor(){Ee(this,"baseUrl","https://us-central1-backbone-logic.cloudfunctions.net/api")}static getInstance(){return _t.instance||(_t.instance=new _t),_t.instance}async getAvailableRoles(s){var t,a;try{console.log(`🎭 [ProjectRoleService] Fetching available roles for project: ${s}`);let o=0;const l=10;let g;for(;o<l;){const j=(t=window.firebase)==null?void 0:t.auth(),b=j==null?void 0:j.currentUser;if(b){g=await b.getIdToken();break}await new Promise(A=>setTimeout(A,100)),o++}if(!g)throw new Error("User not authenticated - Firebase not ready");const n=await fetch(`${this.baseUrl}/projects/${s}/available-roles`,{method:"GET",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"}});if(!n.ok){const j=await n.json().catch(()=>({}));throw new Error(j.error||"Failed to fetch available roles")}const y=await n.json();return console.log(`✅ [ProjectRoleService] Fetched ${((a=y.data)==null?void 0:a.length)||0} available roles`),y.data||[]}catch(o){throw console.error("❌ [ProjectRoleService] Error fetching available roles:",o),o}}async addTeamMemberToProject(s,t,a){var o;try{console.log(`🎭 [ProjectRoleService] Adding team member ${t} to project ${s} with role ${a}`);let l=0;const g=10;let n;for(;l<g;){const b=(o=window.firebase)==null?void 0:o.auth(),A=b==null?void 0:b.currentUser;if(A){n=await A.getIdToken();break}await new Promise(v=>setTimeout(v,100)),l++}if(!n)throw new Error("User not authenticated - Firebase not ready");const y=await fetch(`${this.baseUrl}/projects/${s}/team-members`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({teamMemberId:t,roleId:a})});if(!y.ok){const b=await y.json().catch(()=>({}));throw new Error(b.error||"Failed to add team member to project")}const j=await y.json();console.log("✅ [ProjectRoleService] Successfully added team member to project:",j)}catch(l){throw console.error("❌ [ProjectRoleService] Error adding team member to project:",l),l}}getRoleDisplayColor(s){const t={ADMINISTRATIVE:"#ef4444",PRODUCTION:"#3b82f6",EDITORIAL:"#10b981",TECHNICAL:"#f59e0b",CREATIVE:"#8b5cf6",MANAGEMENT:"#f97316",default:"#6b7280"};return t[s]||t.default}formatRoleDescription(s){const t=s.hierarchy>=80?"High-level":s.hierarchy>=50?"Mid-level":"Entry-level";return`${s.description} (${t} - ${s.hierarchy})`}};Ee(_t,"instance");let xr=_t;const Ts=xr.getInstance(),$i=u=>{if(!u)return"draft";switch(u.toUpperCase()){case"ACTIVE":return"active";case"INACTIVE":return"draft";case"DRAFT":return"draft";case"COMPLETED":return"completed";case"ARCHIVED":return"archived";case"PAUSED":return"paused";default:return"draft"}},ga=(u,s=0,t=0)=>{var o;if((o=u.metadata)!=null&&o.extendedStatus){const l=u.metadata.extendedStatus;if(["draft","active","in-progress","completed","archived","paused"].includes(l))return l}const a=$i(u.status);if(a==="archived"||u.isArchived)return"archived";if(a==="paused")return"paused";if(a==="completed")return"completed";if(a==="active"){const l=s>0,g=t>0,n=u.lastAccessedAt&&new Date().getTime()-new Date(u.lastAccessedAt).getTime()<7*24*60*60*1e3;return l&&g&&n?"in-progress":"active"}return"draft"},Gi=u=>{switch(u){case"active":return"success";case"in-progress":return"info";case"completed":return"success";case"draft":return"warning";case"archived":return"default";case"paused":return"warning";default:return"default"}},Vi=(u,s={},t={})=>{const a={draft:0,active:0,"in-progress":0,completed:0,archived:0,paused:0};return u.forEach(o=>{const l=s[o.id]||0,g=t[o.id]||0,n=ga(o,l,g);a[n]++}),a},is=u=>{var o;if(!u)return 1;let s=0;if(u.licenses&&Array.isArray(u.licenses)){const l=u.licenses.filter(g=>g.status==="ACTIVE"||g.status==="PENDING");s+=l.length}if((o=u.subscription)!=null&&o.plan){const l=u.subscription.plan.toUpperCase();l==="ENTERPRISE"?s+=u.subscription.seats||100:l==="PRO"||l==="PROFESSIONAL"?s+=u.subscription.seats||25:l==="BASIC"&&(s+=u.subscription.seats||5)}if(u.organizationId&&!u.isTeamMember){const l=u.organizationLicenseCount||s;s=Math.max(s,l)}return Math.max(1,Math.min(s,1e3))},ns=(u,s=0,t=0)=>ga(u,s,t),fr=(u,s=0)=>{var t;return u.applicationMode==="shared_network"||s>0||((t=u.settings)==null?void 0:t.autoEnableCollaboration)!==!1||u.allowCollaboration===!0?!0:u.allowCollaboration!==!1},br=(u,s=0,t=0)=>{let a=0,o=0;if(u.name&&u.description?a+=20:u.name&&(a+=10),o+=20,s>0&&(a+=Math.min(30,s*10)),o+=30,t>0&&(a+=Math.min(25,t*5)),o+=25,u.lastAccessedAt){const l=(new Date().getTime()-new Date(u.lastAccessedAt).getTime())/864e5;l<=1?a+=25:l<=7?a+=15:l<=30&&(a+=5)}return o+=25,Math.min(100,Math.round(a/o*100))},Hi=u=>Gi(u),Yi=u=>{switch(u){case"draft":return e.jsx(It,{});case"active":return e.jsx(or,{});case"in-progress":return e.jsx(Gt,{});case"completed":return e.jsx(Cr,{});case"archived":return e.jsx(lr,{});case"paused":return e.jsx(Ai,{});default:return e.jsx(It,{})}},Ki=(u,s=0,t=0,a)=>{var y,j,b,A,v,S,W,G,X,ne,I,_,ae,Y,we,ee,ve,se,de,q;console.log("🔍 [DashboardCloudProjectsBridge] Mapping project:",u.name),console.log("🔍 [DashboardCloudProjectsBridge] Raw project data:",u),console.log("🔍 [DashboardCloudProjectsBridge] Team member count:",s),console.log("🔍 [DashboardCloudProjectsBridge] Dataset count:",t);const o=ns(u,s,t),l=fr(u,s),g=br(u,s,t),n=u.lastActivityAt||u.lastAccessedAt||u.updatedAt;return console.log("🔍 [DashboardCloudProjectsBridge] Calculated status:",o),console.log("🔍 [DashboardCloudProjectsBridge] Collaboration enabled:",l),console.log("🔍 [DashboardCloudProjectsBridge] Completion percentage:",g),{id:u.id,name:u.name,description:u.description,applicationMode:((y=u.settings)==null?void 0:y.applicationMode)||"shared_network",storageBackend:((j=u.settings)==null?void 0:j.storageBackend)||"firestore",gcsBucket:(b=u.settings)==null?void 0:b.gcsBucket,gcsPrefix:(A=u.settings)==null?void 0:A.gcsPrefix,s3Bucket:(v=u.settings)==null?void 0:v.s3Bucket,s3Region:(S=u.settings)==null?void 0:S.s3Region,s3Prefix:(W=u.settings)==null?void 0:W.s3Prefix,azureStorageAccount:(G=u.settings)==null?void 0:G.azureStorageAccount,azureContainer:(X=u.settings)==null?void 0:X.azureContainer,azurePrefix:(ne=u.settings)==null?void 0:ne.azurePrefix,lastAccessedAt:u.lastAccessedAt||new Date().toISOString(),isActive:o!=="archived"&&o!=="paused",isArchived:o==="archived",allowCollaboration:l,maxCollaborators:((I=u.settings)==null?void 0:I.maxCollaborators)||is(a),realTimeEnabled:((_=u.settings)==null?void 0:_.realTimeEnabled)||l,status:o,completionPercentage:g,lastActivityAt:n,teamMemberCount:s,collaborationEnabled:l,settings:{...u.settings,autoEnableCollaboration:((ae=u.settings)==null?void 0:ae.autoEnableCollaboration)??!0,completionCriteria:{requiresDatasets:!0,requiresTeamMembers:!0,minimumActivity:1,...(Y=u.settings)==null?void 0:Y.completionCriteria}},teamMemberRole:(ee=(we=u.teamMembers)==null?void 0:we[0])==null?void 0:ee.role,role:(se=(ve=u.teamMembers)==null?void 0:ve[0])==null?void 0:se.role,assignedAt:(q=(de=u.teamMembers)==null?void 0:de[0])==null?void 0:q.assignedAt,projectOwner:u.ownerId}},dn=()=>{var Lr,qr,Br,Wr;const{user:u}=yr(),{setLoading:s}=La(),t=d.useCallback(()=>{if(!u)return null;const r=localStorage.getItem("auth_user");let m={...u};if(r)try{const p=JSON.parse(r);m={...u,...p,isTeamMember:p.isTeamMember||u.isTeamMember||p.role==="TEAM_MEMBER",organizationId:p.organizationId||u.organizationId,memberRole:p.memberRole||u.memberRole,memberStatus:p.memberStatus||u.memberStatus,teamMemberData:p.teamMemberData||u.teamMemberData}}catch(p){console.warn("Failed to parse stored user from localStorage:",p)}if(!m.subscription){const p=localStorage.getItem("user_subscription");if(p)try{const E=JSON.parse(p);m.subscription=E}catch(E){console.warn("Failed to parse subscription data from localStorage:",E)}const D=localStorage.getItem("user_billing");if(D&&!m.subscription)try{const E=JSON.parse(D);E.subscription&&(m.subscription=E.subscription)}catch(E){console.warn("Failed to parse billing data from localStorage:",E)}}return m},[u]),a=d.useMemo(()=>t(),[t]),o=d.useCallback(()=>{if(!a)return!1;if(a.memberRole==="OWNER"||a.role==="SUPERADMIN"||a.role==="ADMIN"||String(a.role).includes("ENTERPRISE"))return console.log("🔍 [DashboardCloudProjectsBridge] User is account owner - NOT a team member"),!1;const r=a.isTeamMember===!0||a.role==="TEAM_MEMBER";if(!r){const m=localStorage.getItem("team_member_data");if(m)try{const p=JSON.parse(m);if(p.memberRole==="OWNER"||p.role==="SUPERADMIN"||p.role==="ADMIN"||String(p.role).includes("ENTERPRISE"))return console.log("🔍 [DashboardCloudProjectsBridge] localStorage shows account owner - NOT a team member"),!1}catch(p){console.warn("Failed to parse team member data:",p)}}return console.log("🔍 [DashboardCloudProjectsBridge] User is team member:",r),r},[a]),l=d.useCallback(()=>{var m,p,D,E;if(!a)return console.log("🔍 [DashboardCloudProjectsBridge] No complete user data available"),!1;if(console.log("🔍 [DashboardCloudProjectsBridge] Checking permissions for user:",{id:a.id,email:a.email,role:a.role,memberRole:a.memberRole,isTeamMember:a.isTeamMember,organizationId:a.organizationId,subscription:a.subscription}),a.memberRole==="ENTERPRISE_ADMIN"||a.role==="ENTERPRISE_ADMIN"||String(a.role).includes("ENTERPRISE"))return console.log("✅ [DashboardCloudProjectsBridge] User is enterprise user or admin, can create projects"),!0;if(!o())return((m=a.subscription)==null?void 0:m.status)==="ACTIVE"||((p=a.subscription)==null?void 0:p.status)==="TRIALING"||a.role==="SUPERADMIN"||a.role==="ADMIN"?(console.log("✅ [DashboardCloudProjectsBridge] User is account owner with active subscription, can create projects"),!0):(D=a.subscription)!=null&&D.plan&&["BASIC","PRO","ENTERPRISE"].includes(a.subscription.plan)?(console.log("✅ [DashboardCloudProjectsBridge] User is account owner with subscription plan, can create projects"),!0):a.isDemoUser||localStorage.getItem("demo_user_status")==="ACTIVE"?(console.log("✅ [DashboardCloudProjectsBridge] User is demo user, can create projects"),!0):(console.log("⚠️ [DashboardCloudProjectsBridge] User is account owner but no active subscription or demo status"),!0);if(a.memberRole==="ADMIN"||a.role==="ADMIN")return console.log("✅ [DashboardCloudProjectsBridge] Team member has ADMIN role, can create projects"),!0;const r=localStorage.getItem("team_member_data");if(r)try{const U=JSON.parse(r);if(console.log("🔍 [DashboardCloudProjectsBridge] Team member data from localStorage:",U),U.role==="ADMIN"||U.memberRole==="ADMIN"||U.role==="TEAM_ADMIN")return console.log("✅ [DashboardCloudProjectsBridge] Team member data shows ADMIN role, can create projects"),!0}catch(U){console.warn("Failed to parse team member data for permissions check:",U)}return a.memberRole==="OWNER"||a.role==="OWNER"||String(a.memberRole).includes("OWNER")?(console.log("✅ [DashboardCloudProjectsBridge] User has OWNER role, can create projects"),!0):a.role==="SUPERADMIN"?(console.log("✅ [DashboardCloudProjectsBridge] User is SUPERADMIN, can create projects"),!0):(E=a.subscription)!=null&&E.plan&&["BASIC","PRO","ENTERPRISE"].includes(a.subscription.plan)?(console.log("✅ [DashboardCloudProjectsBridge] User has subscription plan, allowing project creation"),!0):a.subscription?(console.log("✅ [DashboardCloudProjectsBridge] User has subscription data, allowing project creation"),!0):(console.log("❌ [DashboardCloudProjectsBridge] User cannot create projects - regular team member without admin privileges"),!1)},[a,o]),[g,n]=d.useState([]),[y,j]=d.useState(!0),[b,A]=d.useState(null),[v,S]=d.useState(0),[W,G]=d.useState(!1),[X,ne]=d.useState(!1),[I,_]=d.useState(null),[ae,Y]=d.useState(!1),[we,ee]=d.useState([]),[ve,se]=d.useState(!1),[de,q]=d.useState([]),[V,je]=d.useState([]),[ie,pe]=d.useState(!1),[oe,Se]=d.useState(""),[Ae,We]=d.useState("all"),[Me,J]=d.useState(""),[T,h]=d.useState({}),[P,K]=d.useState(!1),[Z,ye]=d.useState(null),[le,re]=d.useState(0),[k,te]=d.useState(!1),[Ie,f]=d.useState(null),[O,R]=d.useState(!1),[M,H]=d.useState(!1),[C,De]=d.useState(null),[z,L]=d.useState(!1),[ue,ze]=d.useState(!1),[Ue,_e]=d.useState(null),[he,Le]=d.useState(null),[ht,it]=d.useState(!1),[Et,ps]=d.useState(!1),[hs,Ht]=d.useState(!1),[yt,wt]=d.useState([]),[Ft,Ut]=d.useState([]),[nt,Dt]=d.useState(!1),[Tt,N]=d.useState(""),[Oe,tt]=d.useState(""),[ot,xs]=d.useState([]),[fs,Ar]=d.useState(!1),[Yt,Ls]=d.useState(""),[Kt,qs]=d.useState(!1),[Bs,Rr]=d.useState(!1),[Ir,Ws]=d.useState(null),[Ve,bs]=d.useState(""),[Fs,Us]=d.useState(0),[ys,pa]=d.useState(10),[ha,Er]=d.useState(!1),[xa,wr]=d.useState(null),[Ke,fa]=d.useState("lastAccessedAt"),[jt,ba]=d.useState("desc"),[Ct,Dr]=d.useState({}),[Qt,js]=d.useState({}),[Tr,Nr]=d.useState({}),[Mr,Or]=d.useState(null),Cs=d.useCallback(async r=>{try{se(!0),console.log("🔍 [DashboardCloudProjectsBridge] Loading datasets for project:",r.id);const m=await Re.getProjectDatasets(r.id);console.log("✅ [DashboardCloudProjectsBridge] Loaded assigned datasets:",m),ee(m),h(p=>({...p,[r.id]:m.length}));try{const p=await Re.listDatasets({backend:Ae==="all"?void 0:Ae,query:Me||void 0});console.log("✅ [DashboardCloudProjectsBridge] Loaded available datasets:",p),console.log("🔍 [DashboardCloudProjectsBridge] === DATASET DEBUG INFO ==="),p.forEach(($,me)=>{var ce;console.log(`🔍 [DashboardCloudProjectsBridge] Dataset ${me}:`,{id:$.id,name:$.name,organizationId:$.organizationId,storage:$.storage,idType:typeof $.id,idLength:(ce=$.id)==null?void 0:ce.length,fullDataset:$})}),console.log("🔍 [DashboardCloudProjectsBridge] === END DATASET DEBUG ===");const D=p.filter($=>!$.id||typeof $.id!="string"||$.id.trim()==="");D.length>0&&console.warn("⚠️ [DashboardCloudProjectsBridge] Found datasets with invalid IDs:",D);const E=p.find($=>$.id==="dataset-001");E?console.log("✅ [DashboardCloudProjectsBridge] dataset-001 found:",E):(console.warn("⚠️ [DashboardCloudProjectsBridge] dataset-001 NOT found in available datasets!"),console.log("🔍 [DashboardCloudProjectsBridge] Available dataset IDs:",p.map($=>$.id)));const U=p.map($=>{var ce;const me=xe=>{switch(xe){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...$,__label:`${$.name} ${me((ce=$.storage)==null?void 0:ce.backend)}`}});oe&&!U.find($=>$.id===oe)&&(console.warn("⚠️ [DashboardCloudProjectsBridge] Clearing invalid selected dataset:",oe),Se("")),q(U)}catch(p){console.warn("⚠️ [DashboardCloudProjectsBridge] Failed to load available datasets, using empty list:",p),q([])}}catch(m){console.error("❌ [DashboardCloudProjectsBridge] Failed to load datasets for project:",m),ee([]),q([])}finally{se(!1)}},[Ae,Me]),Nt=d.useCallback(async r=>{try{Dt(!0),console.log("🔍 [DashboardCloudProjectsBridge] Loading team members for project:",r.id);try{const m=await Re.getProjectTeamMembers(r.id);console.log("✅ [DashboardCloudProjectsBridge] Loaded assigned team members:",m),wt(m)}catch(m){console.warn("⚠️ [DashboardCloudProjectsBridge] Failed to load assigned team members, using empty list:",m),wt([])}try{const m=await Re.getLicensedTeamMembers({search:Yt||void 0,excludeProjectId:r.id});console.log("✅ [DashboardCloudProjectsBridge] Loaded available team members:",m),Ut(m)}catch(m){console.warn("⚠️ [DashboardCloudProjectsBridge] Failed to load licensed team members, using empty list:",m),Ut([])}}catch(m){console.error("❌ [DashboardCloudProjectsBridge] Failed to load team members for project:",m),wt([]),Ut([])}finally{Dt(!1)}},[Yt]);d.useEffect(()=>{I&&(console.log("🔄 [DashboardCloudProjectsBridge] Project selected, loading data..."),Cs(I),Nt(I))},[I,Cs,Nt]),d.useEffect(()=>{I&&Kt&&!fs&&ot.length===0&&(async()=>{try{Ar(!0),console.log("🎭 [DashboardCloudProjectsBridge] Loading available roles for project:",I.id);const m=await Ts.getAvailableRoles(I.id);if(console.log(`✅ [DashboardCloudProjectsBridge] Found ${(m==null?void 0:m.length)||0} available roles`),xs(m||[]),m&&m.length>0){const p=m.find(D=>D.name==="DO_ER")||m[0];tt(p.id)}}catch(m){console.error("❌ [DashboardCloudProjectsBridge] Failed to load available roles:",m),xs([])}finally{Ar(!1)}})()},[I,Kt,fs,ot.length]),d.useEffect(()=>{lt();const r=m=>{lt()};return window.addEventListener("project:created",r),()=>window.removeEventListener("project:created",r)},[]);const ya=(r,m)=>r==="desc"?(p,D)=>Pr(p,D,m):(p,D)=>-Pr(p,D,m),Pr=(r,m,p)=>{const D=r[p],E=m[p];return D==null&&E==null?0:D==null?1:E==null||E<D?-1:E>D?1:0},Jt=r=>{ba(Ke===r&&jt==="asc"?"desc":"asc"),fa(r)},vs=d.useMemo(()=>{let r=g;if(Ve.trim()){const m=Ve.toLowerCase();r=g.filter(p=>p.name.toLowerCase().includes(m)||p.description&&p.description.toLowerCase().includes(m)||p.storageBackend.toLowerCase().includes(m)||p.applicationMode.toLowerCase().includes(m))}return r.sort(ya(jt,Ke))},[g,Ve,jt,Ke]);d.useEffect(()=>{Us(0)},[Ve]);const Xt=d.useMemo(()=>{console.log("🔍 [DashboardCloudProjectsBridge] Filtering projects for tab:",v),console.log("🔍 [DashboardCloudProjectsBridge] All filtered projects:",vs);const r=vs.filter(m=>{const p=v===0,D=p?m.isActive&&!m.isArchived:m.isArchived;return console.log(`🔍 [DashboardCloudProjectsBridge] Project "${m.name}":`,{isActive:m.isActive,isArchived:m.isArchived,isActiveTab:p,shouldShow:D}),D});return console.log("🔍 [DashboardCloudProjectsBridge] Filtered projects for display:",r),r},[vs,v]),ja=d.useMemo(()=>{const r=Fs*ys;return Xt.slice(r,r+ys)},[Xt,Fs,ys]);d.useEffect(()=>{if(I&&Kt){const r=setTimeout(()=>{console.log("🔄 [DashboardCloudProjectsBridge] Team member search changed, refreshing..."),Nt(I)},300);return()=>clearTimeout(r)}},[Yt,I,Kt,Nt]),d.useCallback(async r=>{try{console.log("🔍 [DashboardCloudProjectsBridge] Loading team member counts for all projects...");const m=r.map(async E=>{try{const U=await Re.getProjectTeamMembers(E.id);return{projectId:E.id,count:U.length}}catch(U){return console.warn(`⚠️ [DashboardCloudProjectsBridge] Failed to load team members for project ${E.id}:`,U),{projectId:E.id,count:0}}}),p=await Promise.all(m),D={};p.forEach(({projectId:E,count:U})=>{D[E]=U}),Dr(D),console.log("✅ [DashboardCloudProjectsBridge] Loaded team member counts for all projects:",D)}catch(m){console.error("❌ [DashboardCloudProjectsBridge] Failed to load team member counts for all projects:",m)}},[]);const Ss=d.useCallback(async r=>{try{console.log("🔍 [DashboardCloudProjectsBridge] Loading dataset counts for all projects...");const m=r.map(async E=>{try{const U=await Re.getProjectDatasets(E.id);return console.log(`🔍 [DashboardCloudProjectsBridge] Project "${E.name}" has ${U.length} assigned datasets`),{projectId:E.id,count:U.length}}catch(U){return console.warn(`⚠️ [DashboardCloudProjectsBridge] Failed to load datasets for project ${E.id}:`,U),{projectId:E.id,count:0}}}),p=await Promise.all(m),D={};p.forEach(({projectId:E,count:U})=>{D[E]=U}),h(D),console.log("✅ [DashboardCloudProjectsBridge] Loaded ACTUAL dataset assignments per project:",D)}catch(m){console.error("❌ [DashboardCloudProjectsBridge] Failed to load dataset counts for all projects:",m)}},[]),lt=async()=>{try{if(A(null),j(!0),o())try{console.log("🔍 [DashboardCloudProjectsBridge] Web-only mode: Fetching projects from Firestore...");const r=u;if(!(r!=null&&r.organizationId))throw console.warn("⚠️ [DashboardCloudProjectsBridge] No organization ID found for user"),new Error("No organization found for user");const{db:m}=await Fr(async()=>{const{db:Q}=await import("./firebase-DMZK7dif.js").then(Qe=>Qe.f);return{db:Q}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),{collection:p,query:D,where:E,getDocs:U}=await Fr(async()=>{const{collection:Q,query:Qe,where:Mt,getDocs:xt}=await import("./index.esm-DPzT-Jis.js");return{collection:Q,query:Qe,where:Mt,getDocs:xt}},__vite__mapDeps([7,6])),$=D(p(m,"projects"),E("organizationId","==",r.organizationId)),me=await U($);console.log(`🔍 [DashboardCloudProjectsBridge] Found ${me.size} projects for organization: ${r.organizationId}`);const ce=me.docs.map(Q=>({id:Q.id,projectId:Q.id,...Q.data(),name:Q.data().name||Q.data().projectName||"Unnamed Project",projectName:Q.data().name||Q.data().projectName||"Unnamed Project",description:Q.data().description||"",role:"MEMBER",teamMemberRole:"MEMBER",isActive:Q.data().isActive!==!1,isArchived:Q.data().isArchived===!0,assignedAt:Q.data().createdAt||new Date().toISOString(),lastAccessed:Q.data().lastAccessedAt||Q.data().createdAt||new Date().toISOString(),ownerName:Q.data().ownerName||"Organization Owner"}));console.log("🔍 [DashboardCloudProjectsBridge] Team member projects from Firestore:",ce);const xe=ce.map(Q=>{console.log("🔍 [DashboardCloudProjectsBridge] Transforming project:",Q);const Qe=1,Mt=0,xt=ns(Q,Qe,Mt),Je=fr(Q,Qe),Es=br(Q,Qe,Mt),At={id:Q.projectId||Q.id,name:Q.projectName||Q.name||"Unnamed Project",description:Q.description||"",applicationMode:"shared_network",storageBackend:"firestore",lastAccessedAt:Q.lastAccessed||Q.assignedAt||new Date().toISOString(),isActive:xt!=="archived"&&xt!=="paused",isArchived:xt==="archived",allowCollaboration:Je,maxCollaborators:Q.maxCollaborators||is(a),realTimeEnabled:Je,status:xt,completionPercentage:Es,lastActivityAt:Q.lastAccessed||Q.assignedAt||new Date().toISOString(),teamMemberCount:Qe,collaborationEnabled:Je,settings:{autoEnableCollaboration:!0,completionCriteria:{requiresDatasets:!0,requiresTeamMembers:!0,minimumActivity:1}},teamMemberRole:Q.role||Q.teamMemberRole||"MEMBER",role:Q.role||Q.teamMemberRole||"MEMBER",assignedAt:Q.assignedAt,projectOwner:Q.ownerName||"Organization Owner"};return console.log("🔍 [DashboardCloudProjectsBridge] Transformed to:",At),At});n(xe),await Ss(xe)}catch(r){console.error("Failed to fetch team member projects:",r);const m=localStorage.getItem("team_member_data");if(m)try{const E=JSON.parse(m);if(E.projectAccess&&Array.isArray(E.projectAccess)){const U=E.projectAccess.map($=>{const xe=ns($,1,0),Q=fr($,1),Qe=br($,1,0);return{id:$.projectId,name:$.projectName||"Unnamed Project",description:$.description||"",applicationMode:"shared_network",storageBackend:"firestore",lastAccessedAt:$.lastAccessed||new Date().toISOString(),isActive:xe!=="archived"&&xe!=="paused",isArchived:xe==="archived",allowCollaboration:Q,maxCollaborators:is(a),realTimeEnabled:Q,status:xe,completionPercentage:Qe,lastActivityAt:$.lastAccessed||new Date().toISOString(),teamMemberCount:1,collaborationEnabled:Q,settings:{autoEnableCollaboration:!0,completionCriteria:{requiresDatasets:!0,requiresTeamMembers:!0,minimumActivity:1}},teamMemberRole:$.role||"MEMBER",assignedAt:$.assignedAt,projectOwner:"Organization Owner"}});n(U),await Ss(U);return}}catch(E){console.warn("Failed to parse fallback team member data:",E)}const D=Object.keys(localStorage).filter(E=>E.includes("team")||E.includes("member")||E.includes("project")||E.includes("assignment"));for(const E of D)try{const U=localStorage.getItem(E);if(U){const $=JSON.parse(U);$.projects||$.projectAccess||$.assignments}}catch{}A("Unable to load your assigned projects. Please contact your administrator or try again later."),n([])}else{console.log("🔍 [DashboardCloudProjectsBridge] Loading projects for account owner...");const r=await Re.getProjects();console.log("🔍 [DashboardCloudProjectsBridge] Raw service projects:",r),console.log("🔍 [DashboardCloudProjectsBridge] Service projects count:",r.length),console.log("🔍 [DashboardCloudProjectsBridge] Loading team member and dataset counts...");const m=r.map(async ce=>{try{const xe=await Re.getProjectTeamMembers(ce.id);return{projectId:ce.id,count:xe.length}}catch(xe){return console.warn(`⚠️ [DashboardCloudProjectsBridge] Failed to load team members for project ${ce.id}:`,xe),{projectId:ce.id,count:0}}}),p=r.map(async ce=>{try{const xe=await Re.getProjectDatasets(ce.id);return{projectId:ce.id,count:xe.length}}catch(xe){return console.warn(`⚠️ [DashboardCloudProjectsBridge] Failed to load datasets for project ${ce.id}:`,xe),{projectId:ce.id,count:0}}}),[D,E]=await Promise.all([Promise.all(m),Promise.all(p)]),U={},$={};D.forEach(({projectId:ce,count:xe})=>{U[ce]=xe}),E.forEach(({projectId:ce,count:xe})=>{$[ce]=xe}),Dr(U),h($);const me=r.map(ce=>Ki(ce,U[ce.id]||0,$[ce.id]||0,a));console.log("🔍 [DashboardCloudProjectsBridge] Mapped cloud projects with enhanced data:",me),console.log("🔍 [DashboardCloudProjectsBridge] Mapped projects count:",me.length),n(me),console.log("✅ [DashboardCloudProjectsBridge] Projects set in state with enhanced status and collaboration logic")}}catch(r){console.error("Failed to load projects:",r),A((r==null?void 0:r.message)||"Failed to load projects"),n([])}finally{j(!1)}},Ca=async()=>{try{const r="https://backbone-client.web.app/";let m=!1;try{const p=document.createElement("a");p.href=r,p.target="_blank",p.rel="noopener noreferrer",document.body.appendChild(p),p.click(),document.body.removeChild(p),m=!0}catch{}m||(window.location.href=r)}catch(r){console.error("Failed to launch web app",r),A("Unable to open web app. Please try again.")}},va=()=>{try{const p="dashboardv14://open-app";window.location.href=p}catch(r){console.error("Failed to open desktop deep link",r),A("Unable to open Desktop app. Please ensure it is installed.")}},$s=()=>{G(!0)},Sa=()=>{Y(!0)},Aa=(r,m)=>{console.log(`✅ Collection '${r}' created successfully`),lt(),_(null)},Ra=(r,m)=>{Us(m)},Ia=r=>{pa(parseInt(r.target.value,10)),Us(0)},Ea=(r,m)=>{Nr(p=>({...p,[m]:r.currentTarget}))},vt=r=>{Nr(m=>({...m,[r]:null}))},wa=r=>{Or(r.currentTarget)},St=()=>{Or(null)},Da=r=>{wr(r.currentTarget),Er(!0)},As=()=>{Er(!1),wr(null)},Ta=async r=>{G(!1),await lt()},Zt=d.useCallback(async(r,m)=>{try{js(D=>({...D,[r]:!0}));let p;switch(m){case"draft":p="draft";break;case"active":case"in-progress":case"completed":p="active";break;case"archived":case"paused":p="archived";break;default:p="active"}await Re.updateProject(r,{status:p,lastActivityAt:new Date().toISOString(),isActive:p!=="archived",isArchived:p==="archived",metadata:{extendedStatus:m,statusUpdatedAt:new Date().toISOString()}}),await lt(),console.log(`✅ [DashboardCloudProjectsBridge] Project ${r} status updated to ${m} (mapped to ${p})`)}catch(p){console.error("❌ [DashboardCloudProjectsBridge] Failed to update project status:",p),A(`Failed to update project status: ${p instanceof Error?p.message:"Unknown error"}`)}finally{js(p=>({...p,[r]:!1}))}},[]),Na=d.useCallback(async(r,m)=>{try{js(D=>({...D,[r]:!0}));const p=is(a);await Re.updateProject(r,{settings:{allowCollaboration:m,autoEnableCollaboration:m,realTimeEnabled:m,maxCollaborators:m?p:1},allowCollaboration:m,collaborationEnabled:m,realTimeEnabled:m,maxCollaborators:m?p:1,lastActivityAt:new Date().toISOString()}),await lt(),console.log(`✅ [DashboardCloudProjectsBridge] Project ${r} collaboration ${m?"enabled":"disabled"}`)}catch(p){console.error("❌ [DashboardCloudProjectsBridge] Failed to toggle collaboration:",p),A(`Failed to update collaboration settings: ${p instanceof Error?p.message:"Unknown error"}`)}finally{js(p=>({...p,[r]:!1}))}},[]),Ma=r=>{switch(r){case"firestore":return e.jsx(os,{});case"gcs":return e.jsx(He,{});default:return e.jsx(ir,{})}},Oa=r=>r==="standalone"?e.jsx(ir,{}):e.jsx(Ks,{}),Pa=r=>{const m=new Date(r),D=new Date().getTime()-m.getTime(),E=Math.floor(D/(1e3*60*60*24));return E===0?"Today":E===1?"Yesterday":E<7?`${E} days ago`:m.toLocaleDateString()},Gs=Vi(g,Ct,T),kr=g.filter(r=>{const m=Ct[r.id]||0,p=T[r.id]||0,D=ns(r,m,p);return D==="active"||D==="in-progress"}),zr=g.filter(r=>{const m=Ct[r.id]||0,p=T[r.id]||0;return ns(r,m,p)==="archived"}),Rs={totalProjects:g.length,activeProjects:Gs.active+Gs["in-progress"],archivedProjects:Gs.archived,collaborativeProjects:g.filter(r=>r.allowCollaboration).length,totalDatasets:Object.values(T).reduce((r,m)=>r+m,0),storageBreakdown:{firestore:g.filter(r=>r.storageBackend==="firestore").length,gcs:g.filter(r=>r.storageBackend==="gcs").length,s3:g.filter(r=>r.storageBackend==="s3").length,local:g.filter(r=>r.storageBackend==="local").length,azure:g.filter(r=>r.storageBackend==="azure-blob").length},modeBreakdown:{standalone:g.filter(r=>r.applicationMode==="standalone").length,network:g.filter(r=>r.applicationMode==="shared_network").length}},ka=d.useCallback(async()=>{g.length>0&&await Ss(g)},[g,Ss]),Is=d.useCallback(async()=>{try{pe(!0),console.log("🔍 [DashboardCloudProjectsBridge] Loading organization datasets for management dialog...");const r=await Re.getAllOrganizationDatasets();console.log("✅ [DashboardCloudProjectsBridge] Loaded organization datasets:",r);const m=r.map(p=>{var E;const D=U=>{switch(U){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...p,__label:`${p.name} ${D((E=p.storage)==null?void 0:E.backend)}`}});je(m)}catch(r){console.error("❌ [DashboardCloudProjectsBridge] Failed to load organization datasets:",r)}finally{pe(!1)}},[]);d.useEffect(()=>{O&&Is()},[O,Is]);const es=d.useCallback(async()=>{if(!(a!=null&&a.organizationId)){console.warn("⚠️ [DashboardCloudProjectsBridge] No organization ID for dataset analysis");return}L(!0);try{console.log("🔍 [DashboardCloudProjectsBridge] Loading dataset conflict analysis...");let r=V;r.length===0&&(console.log("🔄 [DashboardCloudProjectsBridge] Loading organization datasets for analysis..."),r=await Re.getAllOrganizationDatasets(),r=r.map(p=>{var E;const D=U=>{switch(U){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...p,__label:`${p.name} ${D((E=p.storage)==null?void 0:E.backend)}`}})),console.log("📊 [DashboardCloudProjectsBridge] Analyzing datasets:",{totalDatasets:r.length,firestoreDatasets:r.filter(p=>{var D;return((D=p.storage)==null?void 0:D.backend)==="firestore"}).length,datasetsWithCollections:r.filter(p=>{var D,E;return((E=(D=p.collectionAssignment)==null?void 0:D.selectedCollections)==null?void 0:E.length)>0}).length});const m=await Sr.analyzeOrganizationDatasets(a.organizationId,r);De(m),console.log("✅ [DashboardCloudProjectsBridge] Dataset analysis complete:",{datasets:m.totalDatasets,collections:m.totalCollections,overlaps:m.overlaps.length,healthScore:m.healthScore,recommendations:m.globalInsights.recommendations.length})}catch(r){console.error("❌ [DashboardCloudProjectsBridge] Failed to load dataset analysis:",r),De(null)}finally{L(!1)}},[a==null?void 0:a.organizationId,V]);d.useEffect(()=>{M&&es()},[M,es]);const _r=d.useCallback(()=>{if(!a){console.log("🔍 [DashboardCloudProjectsBridge] No user data available for subscription debug");return}console.log("🔍 [DashboardCloudProjectsBridge] === SUBSCRIPTION DEBUG INFO ==="),console.log("User ID:",a.id),console.log("User Email:",a.email),console.log("User Role:",a.role),console.log("Member Role:",a.memberRole),console.log("Is Team Member:",a.isTeamMember),console.log("Organization ID:",a.organizationId),console.log("Subscription Data:",a.subscription),console.log("Demo User Status:",a.isDemoUser),console.log("LocalStorage Demo Status:",localStorage.getItem("demo_user_status")),console.log("LocalStorage Subscription:",localStorage.getItem("user_subscription")),console.log("LocalStorage Billing:",localStorage.getItem("user_billing")),console.log("==========================================")},[a]);return d.useEffect(()=>{if(a&&a.id){const r=`subscription_debug_${a.id}`;sessionStorage.getItem(r)||(_r(),sessionStorage.setItem(r,"true"))}},[a,_r]),e.jsxs(c,{sx:{py:4,px:3},children:[e.jsx(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(c,{children:[e.jsx(i,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:o()?"My Assigned Projects":"Cloud Projects"}),e.jsx(i,{variant:"body1",color:"text.secondary",children:o()?l()?"Manage and collaborate on projects. As an admin, you can create new projects and access assigned ones.":"Access and collaborate on projects assigned to you by your team administrator":"Manage your projects with Firebase and Google Cloud Storage integration. Available for all license tiers: Basic, Pro, and Enterprise."}),o()&&a&&e.jsxs(c,{sx:{mt:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{icon:e.jsx(Yr,{}),label:`Team Member - ${a.memberRole||"MEMBER"}`,color:"primary",size:"small",sx:{backgroundColor:"rgba(0, 212, 255, 0.1)",border:"1px solid rgba(0, 212, 255, 0.3)",color:"primary.main"}}),a.organizationId&&e.jsx(F,{icon:e.jsx(di,{}),label:"Organization Access",color:"secondary",size:"small",sx:{backgroundColor:"rgba(156, 39, 176, 0.1)",border:"1px solid rgba(156, 39, 176, 0.3)",color:"secondary.main"}})]})]}),e.jsx(rs,{title:"Project Management Guide",arrow:!0,children:e.jsx(et,{onClick:Da,sx:{backgroundColor:"rgba(0, 212, 255, 0.1)",border:"1px solid rgba(0, 212, 255, 0.3)",color:"primary.main","&:hover":{backgroundColor:"rgba(0, 212, 255, 0.2)",borderColor:"rgba(0, 212, 255, 0.5)",transform:"scale(1.05)"},transition:"all 0.2s ease-in-out"},children:e.jsx(ui,{})})})]})}),y?e.jsx(x,{container:!0,spacing:3,sx:{mb:4},children:[1,2,3,4].map(r=>e.jsx(x,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(ge,{sx:{height:"100%"},children:e.jsx(Ce,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(c,{children:[e.jsx(c,{sx:{width:60,height:32,bgcolor:"grey.300",borderRadius:1,mb:1}}),e.jsx(c,{sx:{width:100,height:16,bgcolor:"grey.200",borderRadius:1}})]}),e.jsx(c,{sx:{width:40,height:40,bgcolor:"grey.200",borderRadius:"50%"}})]})})})},r))}):e.jsxs(x,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(x,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(ge,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(102, 126, 234, 0.3)"}},children:e.jsx(Ce,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(c,{children:[e.jsx(i,{variant:"h4",fontWeight:"bold",children:Rs.totalProjects}),e.jsx(i,{variant:"body2",sx:{opacity:.9},children:o()?"Assigned Projects":"Total Projects"})]}),e.jsx(Gt,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(x,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(ge,{sx:{background:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(17, 153, 142, 0.3)"}},onClick:()=>S(0),children:e.jsx(Ce,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(c,{children:[e.jsx(i,{variant:"h4",fontWeight:"bold",children:Rs.activeProjects}),e.jsx(i,{variant:"body2",sx:{opacity:.9},children:"Active Projects"})]}),e.jsx(or,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(x,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(ge,{sx:{background:"linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(252, 74, 26, 0.3)"}},onClick:()=>S(1),children:e.jsx(Ce,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(c,{children:[e.jsx(i,{variant:"h4",fontWeight:"bold",children:Rs.archivedProjects}),e.jsx(i,{variant:"body2",sx:{opacity:.9},children:"Archived Projects"})]}),e.jsx(lr,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(x,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(ge,{sx:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(79, 172, 254, 0.3)"}},children:e.jsx(Ce,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(c,{children:[e.jsx(i,{variant:"h4",fontWeight:"bold",children:o()&&a?(a.memberRole||"MEMBER").toUpperCase():Rs.collaborativeProjects}),e.jsx(i,{variant:"body2",sx:{opacity:.9},children:o()?"Your Role":"Collaborative"})]}),e.jsx(Bt,{sx:{fontSize:40,opacity:.8}})]})})})})]}),y?e.jsx(x,{container:!0,spacing:3,sx:{mb:4},children:[1,2].map(r=>e.jsx(x,{item:!0,xs:12,lg:6,children:e.jsx(ge,{sx:{height:"100%"},children:e.jsxs(Ce,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(c,{sx:{width:24,height:24,bgcolor:"grey.300",borderRadius:"50%"}}),e.jsx(c,{sx:{width:200,height:20,bgcolor:"grey.300",borderRadius:1}})]}),[1,2,3].map(m=>e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{sx:{width:20,height:20,bgcolor:"grey.200",borderRadius:"50%"}}),e.jsx(c,{sx:{width:80,height:16,bgcolor:"grey.200",borderRadius:1}})]}),e.jsx(c,{sx:{width:40,height:24,bgcolor:"grey.200",borderRadius:1}})]},m))]})})},r))}):null,b&&e.jsx(be,{severity:"error",sx:{mb:4},onClose:()=>A(null),children:b}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[e.jsxs(mi,{value:v,onChange:(r,m)=>S(m),sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(Kr,{label:`Active Projects (${kr.length})`}),e.jsx(Kr,{label:`Archived (${zr.length})`})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[!l()&&a&&e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,px:2,py:1,backgroundColor:"warning.light",borderRadius:1,border:"1px solid",borderColor:"warning.main"},children:[e.jsx(It,{color:"warning"}),e.jsx(i,{variant:"body2",color:"warning.dark",children:o()?"Contact your team administrator to create projects":"Active subscription required to create projects"})]}),e.jsx(B,{variant:"contained",startIcon:e.jsx(Qr,{}),onClick:wa,sx:{background:"linear-gradient(135deg, #4f46e5, #7c3aed)",color:"white",borderRadius:2,px:3,py:1.5,textTransform:"none",fontWeight:600,boxShadow:"0 6px 20px rgba(79, 70, 229, 0.4)","&:hover":{background:"linear-gradient(135deg, #4338ca, #6d28d9)",boxShadow:"0 8px 25px rgba(79, 70, 229, 0.5)",transform:"translateY(-2px)"}},children:"Actions"}),e.jsxs(Jr,{anchorEl:Mr,open:!!Mr,onClose:St,PaperProps:{sx:{backgroundColor:"rgba(30, 30, 30, 0.95)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:2,minWidth:200,"& .MuiMenuItem-root":{color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}}}},children:[l()&&e.jsxs(w,{onClick:()=>{St(),console.log("🚀 [DashboardCloudProjectsBridge] Create Project button clicked"),$s()},children:[e.jsx(ft,{sx:{mr:2}}),"Create Project"]}),l()&&e.jsxs(w,{onClick:()=>{St(),console.log("🧙‍♂️ [DashboardCloudProjectsBridge] Create Collection button clicked"),Sa()},children:[e.jsx(jr,{sx:{mr:2}}),"Create Collection"]}),l()&&e.jsxs(w,{onClick:()=>{St(),console.log("🚀 [DashboardCloudProjectsBridge] Create Dataset button clicked"),f(null),te(!0)},children:[e.jsx(rt,{sx:{mr:2}}),"Create Dataset"]}),l()&&e.jsxs(w,{onClick:()=>{St(),console.log("🚀 [DashboardCloudProjectsBridge] Manage Datasets button clicked"),R(!0)},children:[e.jsx(He,{sx:{mr:2}}),"Manage Datasets"]}),l()&&e.jsxs(w,{onClick:()=>{St(),console.log("🚀 [DashboardCloudProjectsBridge] Dataset Insights button clicked"),H(!0)},children:[e.jsx(Gt,{sx:{mr:2}}),"Dataset Insights"]}),e.jsx(w,{disabled:!0,sx:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",my:1}}),e.jsxs(w,{onClick:()=>{St(),Ca()},children:[e.jsx(Xr,{sx:{mr:2}}),"Launch Web App"]}),e.jsxs(w,{onClick:()=>{St(),va()},children:[e.jsx(Xr,{sx:{mr:2}}),"Launch Desktop App"]})]})]})]}),e.jsxs(c,{sx:{mb:4,display:"flex",gap:3,alignItems:"center"},children:[e.jsx(fe,{fullWidth:!0,placeholder:"Search projects by name, description, storage backend, or mode...",value:Ve,onChange:r=>bs(r.target.value),InputProps:{startAdornment:e.jsx(Os,{position:"start",children:e.jsx(us,{})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,"&:hover fieldset":{borderColor:"primary.main"}}}}),e.jsx(B,{variant:"outlined",onClick:lt,sx:{minWidth:"auto",px:3},title:"Refresh projects list",children:"Refresh"})]}),e.jsxs(c,{children:[o()&&g.length>0&&e.jsx(c,{sx:{mb:3,p:3,backgroundColor:"rgba(0, 212, 255, 0.1)",borderRadius:2,border:"1px solid rgba(0, 212, 255, 0.3)"},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Yr,{sx:{color:"primary.main",fontSize:24}}),e.jsxs(c,{children:[e.jsx(i,{variant:"h6",color:"primary.main",sx:{fontWeight:600,mb:1},children:"Team Member Access"}),e.jsxs(i,{variant:"body2",color:"text.secondary",children:["You have access to ",g.length," project",g.length!==1?"s":""," assigned by your team administrator. Click on any project to view details and launch the application."]})]})]})}),y?e.jsx(c,{sx:{textAlign:"center",py:4},children:e.jsx(i,{children:"Loading projects..."})}):e.jsxs(e.Fragment,{children:[Ve&&e.jsx(c,{sx:{mb:2,p:2,backgroundColor:"primary.light",borderRadius:2,color:"white"},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(i,{variant:"body2",children:["Found ",vs.filter(r=>v===0?r.isActive&&!r.isArchived:r.isArchived).length,' projects matching "',Ve,'"']}),e.jsx(B,{size:"small",variant:"text",onClick:()=>bs(""),sx:{color:"white",textDecoration:"underline"},children:"Clear Search"})]})}),e.jsx(gi,{component:Ze,sx:{borderRadius:2,overflow:"auto",boxShadow:2,maxHeight:"70vh",width:"100%"},children:e.jsxs(pi,{sx:{width:"100%"},stickyHeader:!0,children:[e.jsx(hi,{children:e.jsxs(Zr,{sx:{backgroundColor:"primary.main"},children:[e.jsx(Pe,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:e.jsx(ts,{active:Ke==="name",direction:Ke==="name"?jt:"asc",onClick:()=>Jt("name"),sx:{color:"white","& .MuiTableSortLabel-icon":{color:"white"}},children:"Project"})}),e.jsx(Pe,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:e.jsx(ts,{active:Ke==="status",direction:Ke==="status"?jt:"asc",onClick:()=>Jt("status"),sx:{color:"white","& .MuiTableSortLabel-icon":{color:"white"}},children:"Status"})}),e.jsx(Pe,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:e.jsx(ts,{active:Ke==="applicationMode",direction:Ke==="applicationMode"?jt:"asc",onClick:()=>Jt("applicationMode"),sx:{color:"white","& .MuiTableSortLabel-icon":{color:"white"}},children:"Mode"})}),e.jsx(Pe,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:e.jsx(ts,{active:Ke==="storageBackend",direction:Ke==="storageBackend"?jt:"asc",onClick:()=>Jt("storageBackend"),sx:{color:"white","& .MuiTableSortLabel-icon":{color:"white"}},children:"Storage"})}),o()&&e.jsx(Pe,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Your Role"}),e.jsx(Pe,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Team"}),e.jsx(Pe,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Datasets"}),e.jsx(Pe,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Collaboration"}),e.jsx(Pe,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:e.jsx(ts,{active:Ke==="lastAccessedAt",direction:Ke==="lastAccessedAt"?jt:"asc",onClick:()=>Jt("lastAccessedAt"),sx:{color:"white","& .MuiTableSortLabel-icon":{color:"white"}},children:"Last Accessed"})}),e.jsx(Pe,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Actions"})]})}),e.jsx(xi,{children:ja.map(r=>e.jsxs(Zr,{sx:{"&:hover":{backgroundColor:"action.hover",cursor:"pointer"},"&:nth-of-type(odd)":{backgroundColor:"action.hover"}},children:[e.jsx(Pe,{children:e.jsx(i,{variant:"subtitle1",fontWeight:600,children:r.name})}),e.jsx(Pe,{children:e.jsx(F,{size:"small",icon:Yi(r.status),label:r.status.charAt(0).toUpperCase()+r.status.slice(1).replace("-"," "),color:Hi(r.status),variant:"filled",sx:{fontWeight:600}})}),e.jsx(Pe,{children:e.jsx(F,{size:"small",icon:Oa(r.applicationMode),label:r.applicationMode==="standalone"?"Standalone":"Network",color:"primary",variant:"outlined"})}),e.jsx(Pe,{children:e.jsx(F,{size:"small",icon:Ma(r.storageBackend),label:r.storageBackend,variant:"outlined"})}),o()&&e.jsx(Pe,{children:e.jsx(F,{size:"small",label:r.teamMemberRole||r.role||"MEMBER",color:"primary",variant:"outlined",sx:{backgroundColor:"rgba(0, 212, 255, 0.1)",borderColor:"rgba(0, 212, 255, 0.3)",color:"primary.main",fontWeight:600}})}),e.jsx(Pe,{children:typeof Ct[r.id]=="number"?e.jsx(F,{size:"small",icon:e.jsx(Bt,{}),label:`${Ct[r.id]} member${Ct[r.id]!==1?"s":""}`,variant:"outlined",color:Ct[r.id]>0?"primary":"default",title:`${Ct[r.id]} team members assigned to this project`}):e.jsx(i,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(Pe,{children:typeof T[r.id]=="number"?e.jsx(F,{size:"small",icon:e.jsx(rt,{}),label:`${T[r.id]} dataset${T[r.id]!==1?"s":""}`,variant:"outlined",color:T[r.id]>0?"secondary":"default",title:`${T[r.id]} datasets assigned to this project`}):e.jsx(i,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(Pe,{children:r.collaborationEnabled?e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{size:"small",icon:e.jsx(Bt,{}),label:"Enabled",variant:"outlined",color:"success",sx:{fontWeight:600},title:"Collaboration is enabled for this project"}),r.realTimeEnabled&&e.jsx(F,{size:"small",label:"Real-time",variant:"filled",color:"info",sx:{fontSize:"0.7rem",height:"20px"}})]}):e.jsx(F,{size:"small",label:"Disabled",variant:"outlined",color:"default",sx:{color:"text.secondary"}})}),e.jsx(Pe,{children:e.jsx(i,{variant:"body2",children:Pa(r.lastAccessedAt)})}),e.jsx(Pe,{children:e.jsxs(c,{sx:{display:"flex",justifyContent:"center"},children:[e.jsx(et,{size:"small",onClick:m=>Ea(m,r.id),sx:{color:"text.secondary","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:e.jsx(Qr,{})}),e.jsxs(Jr,{anchorEl:Tr[r.id],open:!!Tr[r.id],onClose:()=>vt(r.id),anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:2,minWidth:200,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)"}},children:[e.jsxs(w,{onClick:()=>{_(r),vt(r.id)},sx:{py:1.5},children:[e.jsx(aa,{sx:{mr:2,fontSize:20}}),e.jsx(i,{variant:"body2",children:"Details"})]}),r.status==="draft"&&e.jsxs(w,{onClick:()=>{Zt(r.id,"active"),vt(r.id)},disabled:Qt[r.id],sx:{py:1.5},children:[e.jsx(Ys,{sx:{mr:2,fontSize:20,color:"success.main"}}),e.jsx(i,{variant:"body2",children:"Activate"})]}),r.status==="active"&&e.jsxs(w,{onClick:()=>{Zt(r.id,"in-progress"),vt(r.id)},disabled:Qt[r.id],sx:{py:1.5},children:[e.jsx(Ys,{sx:{mr:2,fontSize:20,color:"info.main"}}),e.jsx(i,{variant:"body2",children:"Start"})]}),r.status==="in-progress"&&e.jsxs(w,{onClick:()=>{Zt(r.id,"completed"),vt(r.id)},disabled:Qt[r.id],sx:{py:1.5},children:[e.jsx(vr,{sx:{mr:2,fontSize:20,color:"success.main"}}),e.jsx(i,{variant:"body2",children:"Complete"})]}),e.jsxs(w,{onClick:()=>{Na(r.id,!r.collaborationEnabled),vt(r.id)},disabled:Qt[r.id],sx:{py:1.5},children:[r.collaborationEnabled?e.jsx(fi,{sx:{mr:2,fontSize:20,color:"warning.main"}}):e.jsx(Ys,{sx:{mr:2,fontSize:20,color:"success.main"}}),e.jsx(i,{variant:"body2",children:r.collaborationEnabled?"Disable Collab":"Enable Collab"})]}),e.jsxs(w,{onClick:async()=>{try{r.isArchived?await Zt(r.id,"active"):await Zt(r.id,"archived"),vt(r.id)}catch(m){console.error("Failed to toggle archive",m),A("Failed to update project")}},disabled:Qt[r.id],sx:{py:1.5},children:[e.jsx(lr,{sx:{mr:2,fontSize:20,color:r.isArchived?"success.main":"warning.main"}}),e.jsx(i,{variant:"body2",children:r.isArchived?"Restore":"Archive"})]}),e.jsxs(w,{onClick:async()=>{try{window.confirm(`Are you sure you want to permanently delete "${r.name}"? This action cannot be undone and will remove all project data, datasets, and team member assignments.`)&&(s(!0),await Re.deleteProject(r.id)?(console.log(`✅ [DashboardCloudProjectsBridge] Project "${r.name}" deleted successfully`),await lt(),A(null)):A(`Failed to delete project "${r.name}". Please try again.`)),vt(r.id)}catch(m){console.error("Failed to delete project:",m),A(`Failed to delete project "${r.name}": ${m instanceof Error?m.message:"Unknown error"}`)}finally{s(!1)}},sx:{py:1.5,color:"error.main","&:hover":{backgroundColor:"error.light",color:"error.dark"}},children:[e.jsx(Vt,{sx:{mr:2,fontSize:20}}),e.jsx(i,{variant:"body2",children:"Delete"})]})]})]})})]},r.id))})]})}),e.jsx(bi,{component:"div",count:Xt.length,page:Fs,onPageChange:Ra,rowsPerPage:ys,onRowsPerPageChange:Ia,rowsPerPageOptions:[5,10,25,50],sx:{mt:2}})]}),!y&&Xt.length===0&&e.jsxs(c,{sx:{textAlign:"center",py:8},children:[e.jsx(os,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:Ve?"No projects found matching your search":v===0?"No active projects yet":"No archived projects"}),e.jsx(i,{variant:"body2",color:"text.secondary",paragraph:!0,children:Ve?"Try adjusting your search terms or browse all projects":v===0?o()?l()?"No projects assigned yet. As a team admin, you can create new projects or wait for assignments from your organization administrator.":"No projects have been assigned to you yet. Contact your team administrator to get access to projects.":l()?"Create your first cloud project to get started with Firebase and GCS integration":"You need an active subscription to create projects. Please upgrade your account or contact support.":"Archived projects will appear here"}),v===0&&!Ve&&l()&&e.jsx(B,{variant:"contained",startIcon:e.jsx(ft,{}),onClick:$s,size:"large",sx:{fontWeight:"bold",px:4,py:1.5,fontSize:"1.1rem",boxShadow:3,"&:hover":{boxShadow:6,transform:"translateY(-2px)"},transition:"all 0.3s ease-in-out"},children:"Create Your First Project"}),v===0&&!Ve&&o()&&!l()&&e.jsxs(c,{sx:{mt:2},children:[e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"💡 Team members without admin privileges cannot create projects. Projects must be assigned by your administrator."}),e.jsx(B,{variant:"outlined",onClick:lt,size:"large",sx:{mt:1},children:"Refresh Projects"})]}),v===0&&!Ve&&!o()&&((a==null?void 0:a.memberRole)==="ENTERPRISE_ADMIN"||(a==null?void 0:a.role)==="ENTERPRISE_ADMIN")&&e.jsx(c,{sx:{mt:2},children:e.jsx(i,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"🎯 As an Enterprise Admin, you can create new projects and manage your organization's project portfolio."})}),Ve&&e.jsx(B,{variant:"outlined",onClick:()=>bs(""),size:"large",sx:{mr:2},children:"Clear Search"})]}),!y&&Ve&&Xt.length===0&&(v===0?kr:zr).length>0&&e.jsxs(c,{sx:{textAlign:"center",py:4},children:[e.jsx(i,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No projects match your search criteria"}),e.jsx(i,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Try different search terms or browse all projects in this tab"}),e.jsx(B,{variant:"outlined",onClick:()=>bs(""),size:"large",children:"Clear Search"})]})]}),e.jsx(Ei,{open:W,onClose:()=>{G(!1)},mode:"shared_network",onSuccess:Ta,maxCollaborators:is(a),onCreate:async r=>await wi.createProject(r)}),e.jsx(Ni,{open:ae,onClose:()=>Y(!1),onCollectionCreated:Aa}),e.jsxs(dt,{open:!!I,onClose:()=>{_(null)},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)",overflow:"hidden"}},children:[e.jsx(ut,{sx:{background:"linear-gradient(135deg, #0f3460 0%, #16213e 100%)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",p:3,position:"relative","&::after":{content:'""',position:"absolute",bottom:0,left:0,right:0,height:"2px",background:"linear-gradient(90deg, #4f46e5, #06b6d4, #3b82f6)",borderRadius:"1px"}},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(c,{sx:{width:48,height:48,borderRadius:"50%",background:"linear-gradient(135deg, #4f46e5, #06b6d4)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 16px rgba(79, 70, 229, 0.3)"},children:e.jsx(yi,{sx:{color:"white",fontSize:24}})}),e.jsxs(c,{children:[e.jsx(i,{variant:"h5",sx:{color:"white",fontWeight:700,textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)"},children:"Project Details"}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:(I==null?void 0:I.name)||"Project Configuration"})]})]})}),e.jsx(mt,{sx:{p:0,background:"transparent"},children:I&&e.jsxs(c,{sx:{p:3},children:[e.jsxs(c,{sx:{mb:4},children:[e.jsxs(i,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",boxShadow:"0 0 8px rgba(139, 92, 246, 0.5)"}}),"Project Details"]}),e.jsx(c,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.2)",borderColor:"rgba(139, 92, 246, 0.3)"}},children:(I==null?void 0:I.description)&&e.jsxs(c,{sx:{mb:3},children:[e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)",mb:1,fontWeight:500},children:"Description"}),e.jsx(i,{variant:"body1",sx:{color:"white",lineHeight:1.6},children:I.description})]})})]}),e.jsxs(c,{children:[e.jsxs(i,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #f59e0b, #f97316)",boxShadow:"0 0 8px rgba(245, 158, 11, 0.5)"}}),"Assigned Datasets"]}),e.jsxs(c,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsx(c,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:e.jsx(B,{variant:"outlined",onClick:async()=>{if(I){console.log("🔄 [DashboardCloudProjectsBridge] Refreshing datasets for project:",I.id);try{se(!0),await Cs(I),console.log("✅ [DashboardCloudProjectsBridge] Datasets refreshed successfully")}catch(r){console.error("❌ [DashboardCloudProjectsBridge] Failed to refresh datasets:",r),A("Failed to refresh datasets")}finally{se(!1)}}},disabled:ve,sx:{borderColor:"rgba(79, 70, 229, 0.5)",color:"#4f46e5",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#4f46e5",backgroundColor:"rgba(79, 70, 229, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:ve?"Refreshing...":"Refresh"})}),e.jsxs(x,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(Fe,{fullWidth:!0,size:"small",children:[e.jsx($e,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Backend"}),e.jsxs(Ge,{value:Ae==="all"?"firestore":Ae,onChange:r=>We(r.target.value),sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(79, 70, 229, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white","& .MuiMenuItem-root":{color:"white"}},children:[e.jsx(w,{value:"firestore",children:"Firestore"}),e.jsx(w,{value:"gcs",children:"Google Cloud Storage"}),e.jsx(w,{value:"s3",children:"Amazon S3"}),e.jsx(w,{value:"aws",children:"AWS Services"}),e.jsx(w,{value:"azure",children:"Microsoft Azure"})]})]})}),e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsx(fe,{fullWidth:!0,size:"small",placeholder:"Search datasets...",value:Me,onChange:r=>J(r.target.value),sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(79, 70, 229, 0.5)"},"& input::placeholder":{color:"rgba(255, 255, 255, 0.5)",opacity:1}}}})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(Fe,{fullWidth:!0,size:"small",children:[e.jsx($e,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Select dataset"}),e.jsxs(Ge,{value:oe,onChange:r=>{const m=r.target.value;console.log("🔍 [DashboardCloudProjectsBridge] Dataset selection changed:",{oldValue:oe,newValue:m,valueType:typeof m,availableDatasetIds:de.map(p=>p.id)}),Se(m)},sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(79, 70, 229, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white","& .MuiMenuItem-root":{color:"white"}},children:[e.jsx(w,{value:"",children:"Select dataset..."}),de.map(r=>e.jsx(w,{value:r.id,children:r.__label||r.name},r.id))]})]})}),e.jsx(x,{item:!0,xs:12,sm:2,children:e.jsxs(c,{sx:{display:"flex",gap:1},children:[e.jsx(B,{variant:"contained",size:"small",disabled:!oe||ve,onClick:async()=>{if(!I||!oe)return;const r=de.find(m=>m.id===oe);if(console.log("🔍 [DashboardCloudProjectsBridge] Selected dataset details:",{selectedDatasetId:oe,selectedDataset:r,availableDatasetsCount:de.length,availableDatasetIds:de.map(m=>m.id)}),!r){console.error("❌ [DashboardCloudProjectsBridge] Selected dataset not found in available datasets:",{selectedDatasetId:oe,availableDatasetIds:de.map(m=>m.id)}),A(`Selected dataset (${oe}) not found. Please try selecting a different dataset.`);return}console.log("🔗 [DashboardCloudProjectsBridge] Assigning dataset to project:",{projectId:I.id,datasetId:oe});try{se(!0),await Re.assignDatasetToProject(I.id,oe),console.log("✅ [DashboardCloudProjectsBridge] Dataset assigned successfully");const m=await Re.getProjectDatasets(I.id);ee(m),h(E=>({...E,[I.id]:m.length}));const D=(await Re.listDatasets({backend:Ae==="all"?void 0:Ae,query:Me||void 0})).map(E=>{var $;const U=me=>{switch(me){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...E,__label:`${E.name} ${U(($=E.storage)==null?void 0:$.backend)}`}});q(D),Se(""),console.log("✅ [DashboardCloudProjectsBridge] Dataset assignment completed and lists refreshed")}catch(m){console.error("❌ [DashboardCloudProjectsBridge] Failed to assign dataset:",m),A("Failed to assign dataset to project")}finally{se(!1)}},sx:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",borderRadius:2,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)","&:hover":{background:"linear-gradient(135deg, #059669, #047857)",boxShadow:"0 6px 20px rgba(16, 185, 129, 0.4)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)",boxShadow:"none"}},children:ve?"Assigning...":"Assign"}),e.jsx(B,{variant:"outlined",size:"small",onClick:async()=>{if(I){console.log("🔍 [DashboardCloudProjectsBridge] Applying dataset filters:",{backend:Ae,search:Me});try{se(!0);const r=await Re.listDatasets({backend:Ae==="all"?void 0:Ae,query:Me||void 0});console.log("✅ [DashboardCloudProjectsBridge] Filtered datasets loaded:",r);const m=r.map(D=>{var U;const E=$=>{switch($){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...D,__label:`${D.name} ${E((U=D.storage)==null?void 0:U.backend)}`}});q(m);const p=await Re.getProjectDatasets(I.id);ee(p),h(D=>({...D,[I.id]:p.length})),console.log("✅ [DashboardCloudProjectsBridge] Filters applied successfully")}catch(r){console.error("❌ [DashboardCloudProjectsBridge] Failed to apply filters:",r),A("Failed to apply dataset filters")}finally{se(!1)}}},disabled:ve,sx:{borderColor:"rgba(79, 70, 229, 0.5)",color:"#4f46e5",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#4f46e5",backgroundColor:"rgba(79, 70, 229, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:ve?"Applying...":"Apply Filters"})]})})]}),e.jsxs(c,{children:[e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2,fontWeight:500},children:"Currently Assigned Datasets"}),we.length===0?e.jsxs(c,{sx:{p:4,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx(rt,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No datasets assigned to this project"})]}):e.jsx(c,{sx:{borderRadius:2,overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.1)"},children:we.map((r,m)=>{var p,D,E;return e.jsxs(c,{sx:{p:2,background:m%2===0?"rgba(255, 255, 255, 0.02)":"rgba(255, 255, 255, 0.05)",borderBottom:m<we.length-1?"1px solid rgba(255, 255, 255, 0.1)":"none",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease","&:hover":{background:"rgba(79, 70, 229, 0.1)",transform:"translateX(4px)"}},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(c,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #f59e0b, #f97316)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(rt,{sx:{color:"white",fontSize:16}})}),e.jsxs(c,{children:[e.jsx(i,{variant:"body1",sx:{color:"white",fontWeight:500},children:r.name}),r.description&&e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:r.description}),((p=r.storage)==null?void 0:p.backend)==="firestore"&&((E=(D=r.collectionAssignment)==null?void 0:D.selectedCollections)==null?void 0:E.length)>0&&e.jsxs(c,{sx:{mt:1},children:[e.jsx(i,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",display:"block",mb:.5},children:"Assigned Collections:"}),e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[r.collectionAssignment.selectedCollections.slice(0,3).map(U=>e.jsx(F,{label:U,size:"small",sx:{height:18,fontSize:"0.65rem",backgroundColor:"rgba(245, 158, 11, 0.2)",color:"#ffffff",border:"1px solid rgba(245, 158, 11, 0.3)"}},U)),r.collectionAssignment.selectedCollections.length>3&&e.jsx(F,{label:`+${r.collectionAssignment.selectedCollections.length-3} more`,size:"small",sx:{height:18,fontSize:"0.65rem",backgroundColor:"rgba(156, 163, 175, 0.2)",color:"#9ca3af"}})]}),r.collectionAssignment.organizationScope&&e.jsx(i,{variant:"caption",sx:{color:"rgba(16, 185, 129, 0.8)",display:"block",mt:.5,fontSize:"0.65rem"},children:"✓ Organization scoped for data isolation"})]})]})]}),e.jsx(c,{sx:{display:"flex",gap:1},children:e.jsx(B,{variant:"outlined",size:"small",startIcon:e.jsx(Vt,{}),onClick:async()=>{try{console.log("🗑️ [DashboardCloudProjectsBridge] Removing dataset from project:",{projectId:I.id,datasetId:r.id}),await Re.unassignDatasetFromProject(I.id,r.id),console.log("✅ [DashboardCloudProjectsBridge] Dataset removed successfully"),ee(me=>me.filter(ce=>ce.id!==r.id)),h(me=>({...me,[I.id]:Math.max(0,(me[I.id]||1)-1)}));const $=(await Re.listDatasets({backend:Ae==="all"?void 0:Ae,query:Me||void 0})).map(me=>{var xe;const ce=Q=>{switch(Q){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...me,__label:`${me.name} ${ce((xe=me.storage)==null?void 0:xe.backend)}`}});q($),console.log("✅ [DashboardCloudProjectsBridge] Dataset removal completed and lists refreshed")}catch(U){console.error("❌ [DashboardCloudProjectsBridge] Failed to remove dataset:",U),A("Failed to remove dataset from project")}},sx:{borderColor:"rgba(239, 68, 68, 0.5)",color:"#ef4444",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",transform:"scale(1.05)"}},children:"Remove"})})]},r.id)})})]})]})]}),e.jsxs(c,{sx:{mt:4},children:[e.jsxs(i,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(c,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",boxShadow:"0 0 8px rgba(139, 92, 246, 0.5)"}}),"Team Members"]}),e.jsxs(c,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsxs(c,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:[e.jsx(B,{variant:"contained",startIcon:e.jsx(Bt,{}),onClick:()=>Ht(!0),sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(139, 92, 246, 0.3)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 6px 20px rgba(139, 92, 246, 0.4)",transform:"translateY(-1px)"}},children:"Team & Roles"}),e.jsx(B,{variant:"outlined",onClick:async()=>{if(I){console.log("🔄 [DashboardCloudProjectsBridge] Refreshing team members for project:",I.id);try{Dt(!0),await Nt(I),console.log("✅ [DashboardCloudProjectsBridge] Team members refreshed successfully")}catch(r){console.error("❌ [DashboardCloudProjectsBridge] Failed to refresh team members:",r),A("Failed to refresh team members")}finally{Dt(!1)}}},disabled:nt,sx:{borderColor:"rgba(139, 92, 246, 0.5)",color:"#8b5cf6",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:nt?"Refreshing...":"Refresh"})]}),e.jsxs(c,{children:[e.jsxs(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)",mb:2,fontWeight:500},children:["Project Team Members (",yt.length,")"]}),yt.length===0?e.jsxs(c,{sx:{p:4,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx(Ks,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No team members assigned to this project"}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.4)",mt:1},children:"Add licensed team members to collaborate on this project"})]}):e.jsx(c,{sx:{borderRadius:2,overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.1)"},children:yt.map((r,m)=>{var $,me,ce,xe,Q,Qe,Mt,xt;console.log("🔍 [DashboardCloudProjectsBridge] Team member structure:",r);let p="Unnamed User";r.name&&r.name!=="Unnamed User"?(p=r.name,console.log("🎯 [DashboardCloudProjectsBridge] Using enriched name from TeamMemberService:",p)):($=r.teamMember)!=null&&$.name&&r.teamMember.name!=="Unnamed User"?(p=r.teamMember.name,console.log("🎯 [DashboardCloudProjectsBridge] Using nested teamMember name:",p)):(me=r.teamMember)!=null&&me.firstName&&((ce=r.teamMember)!=null&&ce.lastName)?(p=`${r.teamMember.firstName} ${r.teamMember.lastName}`,console.log("🎯 [DashboardCloudProjectsBridge] Constructed from nested firstName + lastName:",p)):(xe=r.teamMember)!=null&&xe.firstName?(p=r.teamMember.firstName,console.log("🎯 [DashboardCloudProjectsBridge] Using nested firstName:",p)):(r.email||(Q=r.teamMember)!=null&&Q.email)&&(p=(r.email||r.teamMember.email).split("@")[0].replace(/[._-]/g," ").split(" ").map(At=>At.charAt(0).toUpperCase()+At.slice(1).toLowerCase()).join(" "),console.log("🎯 [DashboardCloudProjectsBridge] Extracted from email:",p)),console.log("🔍 [DashboardCloudProjectsBridge] Final display name:",p);const D=r.email||((Qe=r.teamMember)==null?void 0:Qe.email)||"No email",E=r.role||((Mt=r.teamMember)==null?void 0:Mt.role)||"Member",U=((xt=r.teamMember)==null?void 0:xt.licenseType)||r.licenseType;return e.jsxs(c,{sx:{p:3,background:m%2===0?"rgba(255, 255, 255, 0.02)":"rgba(255, 255, 255, 0.05)",borderBottom:m<yt.length-1?"1px solid rgba(255, 255, 255, 0.1)":"none",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease","&:hover":{background:"rgba(139, 92, 246, 0.1)",transform:"translateX(4px)"}},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(c,{sx:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",fontWeight:600,color:"white"},children:p.charAt(0).toUpperCase()}),e.jsxs(c,{children:[e.jsx(i,{variant:"body1",sx:{color:"white",fontWeight:500},children:p}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:D}),e.jsxs(c,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(F,{size:"small",label:E,sx:{backgroundColor:"rgba(139, 92, 246, 0.2)",color:"#c4b5fd",fontSize:"11px"}}),U&&e.jsx(F,{size:"small",label:U,sx:{backgroundColor:"rgba(16, 185, 129, 0.2)",color:"#6ee7b7",fontSize:"11px"}})]})]})]}),e.jsx(B,{variant:"outlined",size:"small",startIcon:e.jsx(Vt,{}),onClick:async()=>{try{const Je=r.teamMemberId||r.id;if(!Je){console.error("No valid team member ID found:",r),alert("Error: Invalid team member ID");return}await Re.removeTeamMemberFromProject(I.id,Je),wt(Es=>Es.filter(At=>(At.teamMemberId||At.id)!==Je))}catch(Je){console.error("Failed to remove team member",Je),alert(`Failed to remove team member: ${(Je==null?void 0:Je.message)||"Unknown error"}`)}},sx:{borderColor:"rgba(239, 68, 68, 0.5)",color:"#ef4444",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",transform:"scale(1.05)"}},children:"Remove"})]},r.id)})})]})]})]})]})}),e.jsx(gt,{sx:{p:3,background:"rgba(255, 255, 255, 0.02)",borderTop:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"space-between"},children:e.jsx(B,{onClick:()=>_(null),variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})})]}),e.jsx(qa,{children:e.jsx(zi,{open:k,onClose:()=>{te(!1),f(null)},onSuccess:r=>{I&&Cs(I),lt()},assignToProject:Ie||void 0})}),e.jsxs(dt,{open:Kt,onClose:()=>qs(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"}},children:[e.jsx(ut,{sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",p:3},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(c,{sx:{width:40,height:40,borderRadius:"50%",background:"rgba(255, 255, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ft,{sx:{color:"white"}})}),e.jsxs(c,{children:[e.jsx(i,{variant:"h6",sx:{fontWeight:600},children:"Add Team Member"}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:"Add licensed team members to this project"})]})]})}),e.jsxs(mt,{sx:{p:3,background:"transparent"},children:[Ir&&e.jsx(be,{severity:"error",sx:{mb:3},children:Ir}),e.jsxs(c,{sx:{mb:3},children:[e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2},children:"Search and select from your licensed team members:"}),e.jsx(fe,{fullWidth:!0,placeholder:"Search team members by name or email...",value:Yt,onChange:r=>Ls(r.target.value),sx:{mb:2,"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(139, 92, 246, 0.5)"},"& input::placeholder":{color:"rgba(255, 255, 255, 0.5)",opacity:1}}}}),e.jsxs(Fe,{fullWidth:!0,sx:{mb:2},children:[e.jsx($e,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Select Team Member"}),e.jsxs(Ge,{value:Tt,onChange:r=>N(r.target.value),disabled:nt,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(139, 92, 246, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white"},children:[e.jsx(w,{value:"",children:e.jsx("em",{children:nt?"Loading team members...":"Select a team member..."})}),!nt&&Ft.length===0&&e.jsx(w,{disabled:!0,children:e.jsx(i,{component:"em",sx:{color:"rgba(255, 255, 255, 0.5)"},children:Yt?"No team members found matching your search":"No available team members found"})}),!nt&&Ft.map(r=>{var p;let m="Unnamed User";return r.name?m=r.name:r.fullName?m=r.fullName:r.displayName?m=r.displayName:r.firstName&&r.lastName?m=`${r.firstName} ${r.lastName}`:r.firstName?m=r.firstName:r.lastName?m=r.lastName:r.email&&(m=r.email.split("@")[0]),e.jsx(w,{value:r.id,children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[e.jsx(c,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:600,color:"white"},children:((p=m.charAt(0))==null?void 0:p.toUpperCase())||"U"}),e.jsxs(c,{sx:{flexGrow:1},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500,color:"white"},children:m}),e.jsxs(i,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:[r.email," • ",r.licenseType||"Licensed"]})]})]})},r.id)})]})]}),e.jsxs(Fe,{fullWidth:!0,children:[e.jsx($e,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Project Role"}),e.jsx(Ge,{value:Oe,onChange:r=>tt(r.target.value),disabled:fs,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(139, 92, 246, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white"},children:fs?e.jsx(w,{disabled:!0,children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(pt,{size:16,sx:{color:"rgba(255, 255, 255, 0.6)"}}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Loading roles..."})]})}):ot.length===0?e.jsx(w,{disabled:!0,children:e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"No roles available"})}):ot.map(r=>e.jsx(w,{value:r.id,children:e.jsxs(c,{children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500,color:"white"},children:r.displayName}),e.jsx(F,{label:r.category,size:"small",sx:{height:16,fontSize:"0.65rem",backgroundColor:Ts.getRoleDisplayColor(r.category),color:"white"}})]}),e.jsx(i,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)"},children:Ts.formatRoleDescription(r)})]})},r.id))})]})]}),Ft.length===0&&!nt&&e.jsxs(c,{sx:{p:3,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx(Ks,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No available team members found"}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.4)",mt:1},children:"Make sure team members have valid licenses and aren't already assigned to this project"})]})]}),e.jsxs(gt,{sx:{p:3,background:"rgba(255, 255, 255, 0.02)",borderTop:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"space-between"},children:[e.jsx(B,{onClick:()=>{qs(!1),N(""),tt(""),xs([]),Ls(""),Ws(null)},variant:"outlined",disabled:Bs,sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Cancel"}),e.jsx(B,{variant:"contained",disabled:Bs||!Tt,onClick:async()=>{if(!(!I||!Tt)){Ws(null),Rr(!0);try{await Ts.addTeamMemberToProject(I.id,Tt,Oe),await Nt(I),qs(!1),N(""),tt(""),xs([]),Ls("")}catch(r){console.error("Failed to add team member:",r),Ws((r==null?void 0:r.message)||"Failed to add team member")}finally{Rr(!1)}}},sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,boxShadow:"0 6px 20px rgba(139, 92, 246, 0.4)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 8px 25px rgba(139, 92, 246, 0.5)",transform:"translateY(-2px)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)",boxShadow:"none"}},children:Bs?"Adding...":"Add Team Member"})]})]}),e.jsxs(dt,{open:O,onClose:()=>R(!1),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",maxHeight:"80vh"}},children:[e.jsxs(ut,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",pb:2,fontSize:"1.5rem",fontWeight:600,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Dataset Management",e.jsx(B,{variant:"contained",startIcon:e.jsx(ft,{}),onClick:()=>{R(!1),te(!0)},sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(139, 92, 246, 0.4)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 6px 16px rgba(139, 92, 246, 0.5)",transform:"translateY(-1px)"}},children:"Create Dataset"})]}),e.jsx(mt,{sx:{p:3,overflow:"auto"},children:ie?e.jsxs(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:4},children:[e.jsx(pt,{sx:{color:"rgba(255, 255, 255, 0.7)"}}),e.jsx(i,{variant:"body2",sx:{ml:2,color:"rgba(255, 255, 255, 0.7)"},children:"Loading datasets..."})]}):V.length===0?e.jsxs(c,{sx:{textAlign:"center",py:4},children:[e.jsx(He,{sx:{fontSize:64,color:"rgba(255, 255, 255, 0.5)",mb:2}}),e.jsx(i,{variant:"h6",sx:{mb:2},children:"No Datasets Found"}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:3},children:"Create your first dataset to get started with data management."})]}):e.jsxs(c,{children:[e.jsxs(i,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(He,{sx:{mr:1}}),"Available Datasets (",V.length,")"]}),e.jsx(x,{container:!0,spacing:2,children:V.map(r=>{var m,p,D,E,U,$;return e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(ge,{sx:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:2,color:"white",position:"relative","&:hover":{background:"rgba(255, 255, 255, 0.08)",borderColor:"rgba(255, 255, 255, 0.2)",transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.3)"},transition:"all 0.2s ease-in-out"},children:e.jsxs(Ce,{sx:{p:2,pb:1},children:[e.jsx(i,{variant:"h6",sx:{fontSize:"1rem",fontWeight:600,mb:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.name}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2,minHeight:"2.5em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:r.description||"No description available"}),((m=r.storage)==null?void 0:m.backend)==="firestore"&&((D=(p=r.collectionAssignment)==null?void 0:p.selectedCollections)==null?void 0:D.length)>0&&e.jsxs(c,{sx:{mb:2},children:[e.jsxs(i,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",display:"block",mb:.5,fontWeight:500},children:["Collections (",r.collectionAssignment.selectedCollections.length,"):"]}),e.jsxs(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[r.collectionAssignment.selectedCollections.slice(0,2).map(me=>e.jsx(F,{label:me,size:"small",sx:{height:18,fontSize:"0.65rem",backgroundColor:"rgba(79, 70, 229, 0.2)",color:"#ffffff",border:"1px solid rgba(79, 70, 229, 0.3)"}},me)),r.collectionAssignment.selectedCollections.length>2&&e.jsx(F,{label:`+${r.collectionAssignment.selectedCollections.length-2}`,size:"small",sx:{height:18,fontSize:"0.65rem",backgroundColor:"rgba(156, 163, 175, 0.2)",color:"#9ca3af"}})]})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(F,{size:"small",label:((U=(E=r.__label)==null?void 0:E.match(/\((.*?)\)$/))==null?void 0:U[1])||"Firestore",variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",fontSize:"0.75rem"}}),e.jsx(F,{size:"small",label:r.visibility||"private",variant:"filled",sx:{backgroundColor:r.visibility==="public"?"rgba(34, 197, 94, 0.2)":r.visibility==="organization"?"rgba(59, 130, 246, 0.2)":"rgba(156, 163, 175, 0.2)",color:r.visibility==="public"?"#22c55e":r.visibility==="organization"?"#3b82f6":"#9ca3af",fontSize:"0.75rem"}})]}),e.jsxs(c,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(B,{variant:"outlined",size:"small",startIcon:e.jsx(ks,{}),onClick:me=>{me.stopPropagation(),console.log("✏️ [DashboardCloudProjectsBridge] Edit dataset clicked:",r.id),_e(r),ze(!0)},sx:{borderColor:"rgba(139, 92, 246, 0.3)",color:"#8b5cf6",minWidth:"auto",px:1.5,py:.5,fontSize:"0.75rem","&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"}},children:"Edit"}),(($=r.storage)==null?void 0:$.backend)==="firestore"&&e.jsx(B,{variant:"outlined",size:"small",startIcon:e.jsx(rt,{}),onClick:me=>{me.stopPropagation(),console.log("📊 [DashboardCloudProjectsBridge] View collections clicked:",r.id),Le(r),it(!0)},sx:{borderColor:"rgba(59, 130, 246, 0.3)",color:"#3b82f6",minWidth:"auto",px:1.5,py:.5,fontSize:"0.75rem","&:hover":{borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)"}},children:"Collections"}),e.jsx(B,{variant:"outlined",size:"small",startIcon:e.jsx(Vt,{}),onClick:async me=>{if(me.stopPropagation(),window.confirm(`Are you sure you want to delete dataset "${r.name}"? This action cannot be undone and will remove the dataset from all projects.`))try{console.log("🗑️ [DashboardCloudProjectsBridge] Deleting dataset:",r.id),await Re.deleteDataset(r.id),console.log("✅ [DashboardCloudProjectsBridge] Dataset deleted successfully"),await Is(),await ka()}catch(xe){console.error("❌ [DashboardCloudProjectsBridge] Failed to delete dataset:",xe),A(`Failed to delete dataset: ${xe instanceof Error?xe.message:"Unknown error"}`)}},sx:{borderColor:"rgba(239, 68, 68, 0.3)",color:"#ef4444",minWidth:"auto",px:1.5,py:.5,fontSize:"0.75rem","&:hover":{borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)"}},children:"Delete"})]}),e.jsxs(i,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)",mt:1,display:"block"},children:["ID: ",r.id]})]})})},r.id)})})]})}),e.jsxs(gt,{sx:{p:3,borderTop:"1px solid rgba(255, 255, 255, 0.1)",justifyContent:"space-between"},children:[e.jsx(B,{onClick:Is,variant:"outlined",startIcon:e.jsx(Ns,{}),disabled:ie,sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:3,py:1,textTransform:"none","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Refresh"}),e.jsx(B,{onClick:()=>R(!1),variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:3,py:1,textTransform:"none","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})]})]}),I&&e.jsx(Ui,{open:hs,onClose:()=>Ht(!1),projectId:I.id,projectName:I.name,organizationId:(a==null?void 0:a.organizationId)||"",existingProjectTeamMembers:yt,onTeamMembersUpdated:()=>{console.log("🔄 [DashboardCloudProjectsBridge] Refreshing team members after wizard update"),I&&Nt(I)}}),I&&e.jsx(Fi,{open:Et,onClose:()=>ps(!1),projectId:I.id,organizationId:(a==null?void 0:a.organizationId)||"",projectName:I.name}),e.jsxs(dt,{open:M,onClose:()=>H(!1),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",maxHeight:"90vh"}},children:[e.jsxs(ut,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",pb:2,fontSize:"1.5rem",fontWeight:600,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Gt,{sx:{fontSize:32,color:"#8b5cf6"}}),e.jsxs(c,{children:[e.jsx(i,{variant:"h5",sx:{fontWeight:700},children:"Dataset Insights & Analysis"}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Global overview of dataset organization and conflicts"})]})]}),C&&e.jsxs(c,{sx:{textAlign:"center"},children:[e.jsx(i,{variant:"h4",sx:{color:C.healthScore>=80?"#10b981":C.healthScore>=60?"#f59e0b":"#ef4444",fontWeight:700},children:C.healthScore}),e.jsx(i,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Health Score"})]})]}),e.jsx(mt,{sx:{p:3,overflow:"auto"},children:z?e.jsxs(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:[e.jsx(pt,{sx:{color:"#8b5cf6",mr:2}}),e.jsx(i,{variant:"body1",children:"Analyzing dataset organization..."})]}):C?e.jsxs(c,{children:[e.jsxs(c,{sx:{mb:4,p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs(i,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Gt,{sx:{color:"#8b5cf6"}}),"Dataset Analysis Summary"]}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(c,{sx:{textAlign:"center"},children:[e.jsx(i,{variant:"h3",sx:{fontWeight:700,color:"#667eea"},children:C.totalDatasets}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Total Datasets"})]})}),e.jsx(x,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(c,{sx:{textAlign:"center"},children:[e.jsx(i,{variant:"h3",sx:{fontWeight:700,color:"#f093fb"},children:V.filter(r=>{var m;return((m=r.storage)==null?void 0:m.backend)==="firestore"}).length}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Firestore Datasets"})]})}),e.jsx(x,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(c,{sx:{textAlign:"center"},children:[e.jsx(i,{variant:"h3",sx:{fontWeight:700,color:"#4facfe"},children:C.totalCollections}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Unique Collections"})]})}),e.jsx(x,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(c,{sx:{textAlign:"center"},children:[e.jsx(i,{variant:"h3",sx:{fontWeight:700,color:C.overlaps.length>0?"#fc4a1a":"#11998e"},children:C.overlaps.length}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Collection Overlaps"})]})})]})]}),e.jsxs(x,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(ge,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700},children:C.totalDatasets}),e.jsx(i,{variant:"body2",children:"Total Datasets"})]})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(ge,{sx:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700},children:C.totalCollections}),e.jsx(i,{variant:"body2",children:"Unique Collections"})]})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(ge,{sx:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700},children:C.overlaps.length}),e.jsx(i,{variant:"body2",children:"Collection Overlaps"})]})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(ge,{sx:{background:C.globalInsights.redundantAssignments.length>0?"linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%)":"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700},children:C.globalInsights.redundantAssignments.length}),e.jsx(i,{variant:"body2",children:"Redundancies"})]})})]}),C.overlaps.length>0&&e.jsxs(c,{sx:{mb:4},children:[e.jsxs(i,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ps,{color:"warning"}),"Collection Overlaps"]}),C.overlaps.map((r,m)=>e.jsx(ge,{sx:{mb:2,bgcolor:"rgba(255, 255, 255, 0.05)",border:`2px solid ${r.conflictLevel==="high"?"#ef4444":r.conflictLevel==="medium"?"#f59e0b":"#10b981"}`},children:e.jsxs(Ce,{children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(i,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(He,{}),r.collection]}),e.jsx(F,{label:r.conflictLevel.toUpperCase(),color:r.conflictLevel==="high"?"error":r.conflictLevel==="medium"?"warning":"success",sx:{fontWeight:600}})]}),e.jsxs(i,{variant:"body2",sx:{mb:2},children:["Used by ",r.datasets.length," datasets: ",r.datasets.map(p=>p.name).join(", ")]}),r.conflictReasons.length>0&&e.jsxs(c,{sx:{mb:2},children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,display:"block",mb:1},children:"Issues:"}),r.conflictReasons.map((p,D)=>e.jsxs(i,{variant:"body2",sx:{color:"#ef4444",fontSize:"0.85rem"},children:["• ",p]},D))]}),r.recommendations.length>0&&e.jsxs(c,{children:[e.jsx(i,{variant:"caption",sx:{fontWeight:600,display:"block",mb:1},children:"Recommendations:"}),r.recommendations.map((p,D)=>e.jsxs(i,{variant:"body2",sx:{color:"#10b981",fontSize:"0.85rem"},children:["💡 ",p]},D))]})]})},m))]}),C.globalInsights.mostUsedCollections.length>0&&e.jsxs(c,{sx:{mb:4},children:[e.jsxs(i,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(or,{color:"primary"}),"Most Used Collections"]}),e.jsx(x,{container:!0,spacing:2,children:C.globalInsights.mostUsedCollections.slice(0,6).map((r,m)=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(ge,{sx:{bgcolor:"rgba(255, 255, 255, 0.05)",p:2},children:[e.jsxs(i,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(rt,{color:"primary"}),r.collection]}),e.jsxs(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:["Used by ",r.count," dataset",r.count!==1?"s":""]}),e.jsxs(c,{sx:{mt:1},children:[r.datasets.slice(0,2).map((p,D)=>e.jsx(F,{label:p,size:"small",sx:{mr:.5,mb:.5,fontSize:"0.7rem"}},D)),r.datasets.length>2&&e.jsx(F,{label:`+${r.datasets.length-2} more`,size:"small",sx:{fontSize:"0.7rem"}})]})]})},m))})]}),C.globalInsights.recommendations.length>0&&e.jsxs(c,{children:[e.jsxs(i,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(It,{color:"info"}),"Optimization Recommendations"]}),C.globalInsights.recommendations.map((r,m)=>e.jsx(be,{severity:"info",sx:{mb:1,bgcolor:"rgba(79, 70, 229, 0.1)"},children:r},m))]}),C.overlaps.length===0&&C.globalInsights.redundantAssignments.length===0&&C.totalDatasets>0&&e.jsxs(c,{sx:{textAlign:"center",py:4},children:[e.jsx(Cr,{sx:{fontSize:64,color:"#10b981",mb:2}}),e.jsx(i,{variant:"h5",sx:{color:"#10b981",mb:1},children:"Excellent Dataset Organization!"}),e.jsx(i,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"No conflicts or redundancies detected. Your datasets are well-organized."})]}),C.totalDatasets===0&&e.jsxs(c,{sx:{textAlign:"center",py:6},children:[e.jsx(He,{sx:{fontSize:80,color:"rgba(255, 255, 255, 0.3)",mb:3}}),e.jsx(i,{variant:"h5",sx:{mb:2,color:"rgba(255, 255, 255, 0.8)"},children:"No Datasets Found"}),e.jsx(i,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.6)",mb:3,maxWidth:400,mx:"auto"},children:"Create your first dataset to start organizing your data and see detailed insights about collection usage and potential conflicts."}),e.jsx(B,{variant:"contained",startIcon:e.jsx(ft,{}),onClick:()=>{H(!1),te(!0)},sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(139, 92, 246, 0.4)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 6px 20px rgba(139, 92, 246, 0.5)",transform:"translateY(-2px)"}},children:"Create Your First Dataset"})]})]}):e.jsxs(c,{sx:{textAlign:"center",py:6},children:[e.jsx(Gt,{sx:{fontSize:80,color:"rgba(255, 255, 255, 0.3)",mb:3}}),e.jsx(i,{variant:"h5",sx:{mb:2,color:"rgba(255, 255, 255, 0.8)"},children:"Dataset Analysis Unavailable"}),e.jsx(i,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.6)",mb:3,maxWidth:400,mx:"auto"},children:"Unable to load dataset analysis. This could be due to missing organization data or a temporary service issue."}),e.jsxs(c,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(B,{variant:"outlined",startIcon:e.jsx(Ns,{}),onClick:es,sx:{borderColor:"rgba(139, 92, 246, 0.3)",color:"#8b5cf6","&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"}},children:"Retry Analysis"}),e.jsx(B,{variant:"contained",startIcon:e.jsx(ft,{}),onClick:()=>{H(!1),te(!0)},sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)"}},children:"Create Dataset"})]})]})}),e.jsxs(gt,{sx:{p:3,borderTop:"1px solid rgba(255, 255, 255, 0.1)",justifyContent:"space-between"},children:[e.jsx(B,{onClick:es,variant:"outlined",startIcon:e.jsx(Ns,{}),disabled:z,sx:{borderColor:"rgba(139, 92, 246, 0.3)",color:"#8b5cf6","&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"}},children:"Refresh Analysis"}),e.jsx(B,{onClick:()=>H(!1),variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})]})]}),e.jsxs(dt,{open:ht,onClose:()=>{it(!1),Le(null)},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",maxHeight:"80vh"}},children:[e.jsxs(ut,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",pb:2,fontSize:"1.25rem",fontWeight:600,display:"flex",alignItems:"center",gap:2},children:[e.jsx(rt,{sx:{color:"#3b82f6"}}),e.jsxs(c,{children:[e.jsx(i,{variant:"h6",sx:{fontWeight:700},children:"Dataset Collections"}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:(he==null?void 0:he.name)||"Dataset"})]})]}),e.jsx(mt,{sx:{p:3},children:he&&e.jsxs(c,{children:[e.jsxs(c,{sx:{mb:3,p:2,borderRadius:2,background:"rgba(255, 255, 255, 0.05)"},children:[e.jsx(i,{variant:"body1",sx:{fontWeight:600,mb:1},children:he.name}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2},children:he.description||"No description available"}),e.jsxs(c,{sx:{display:"flex",gap:1},children:[e.jsx(F,{size:"small",label:((Lr=he.storage)==null?void 0:Lr.backend)||"firestore",sx:{backgroundColor:"rgba(79, 70, 229, 0.2)",color:"#a5b4fc"}}),e.jsx(F,{size:"small",label:he.visibility||"private",sx:{backgroundColor:"rgba(59, 130, 246, 0.2)",color:"#60a5fa"}})]})]}),((qr=he.storage)==null?void 0:qr.backend)==="firestore"?e.jsxs(c,{children:[e.jsxs(i,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(He,{sx:{color:"#f59e0b"}}),"Firestore Collections"]}),((Wr=(Br=he.collectionAssignment)==null?void 0:Br.selectedCollections)==null?void 0:Wr.length)>0?e.jsxs(c,{children:[e.jsxs(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2},children:["This dataset includes ",he.collectionAssignment.selectedCollections.length," collection(s):"]}),e.jsx(x,{container:!0,spacing:1,children:he.collectionAssignment.selectedCollections.map((r,m)=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(c,{sx:{p:2,borderRadius:2,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",display:"flex",alignItems:"center",gap:1},children:[e.jsx(rt,{sx:{color:"#f59e0b",fontSize:20}}),e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:r})]})},m))}),he.collectionAssignment.organizationScope&&e.jsx(c,{sx:{mt:2,p:2,borderRadius:2,background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)"},children:e.jsxs(i,{variant:"body2",sx:{color:"#10b981",display:"flex",alignItems:"center",gap:1},children:[e.jsx(Wt,{sx:{fontSize:16}}),"Organization scoped for data isolation"]})})]}):e.jsxs(c,{sx:{textAlign:"center",py:4},children:[e.jsx(Ps,{sx:{fontSize:48,color:"rgba(245, 158, 11, 0.5)",mb:2}}),e.jsx(i,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.7)",mb:1},children:"No Collections Assigned"}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"This Firestore dataset doesn't have any collections assigned yet."})]})]}):e.jsxs(c,{sx:{textAlign:"center",py:4},children:[e.jsx(It,{sx:{fontSize:48,color:"rgba(59, 130, 246, 0.5)",mb:2}}),e.jsx(i,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.7)",mb:1},children:"Non-Firestore Dataset"}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"Collection management is only available for Firestore datasets."})]})]})}),e.jsxs(gt,{sx:{p:3,borderTop:"1px solid rgba(255, 255, 255, 0.1)",justifyContent:"space-between"},children:[e.jsx(B,{onClick:()=>{he&&(_e(he),ze(!0),it(!1))},variant:"outlined",startIcon:e.jsx(ks,{}),sx:{borderColor:"rgba(139, 92, 246, 0.3)",color:"#8b5cf6","&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"}},children:"Edit Dataset"}),e.jsx(B,{onClick:()=>{it(!1),Le(null)},variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})]})]}),e.jsx(Li,{open:ue,onClose:()=>{ze(!1),_e(null)},dataset:Ue,existingDatasets:V,onDatasetUpdated:r=>{console.log("✅ [DashboardCloudProjectsBridge] Dataset updated:",r),I&&ee(m=>m.map(p=>p.id===r.id?r:p)),je(m=>m.map(p=>p.id===r.id?r:p)),(he==null?void 0:he.id)===r.id&&Le(r),M&&es()}}),e.jsx(ji,{open:ha,anchorEl:xa,onClose:As,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},PaperProps:{sx:{width:800,maxWidth:"90vw",maxHeight:"80vh",overflow:"auto",borderRadius:3,boxShadow:"0 20px 40px rgba(0, 0, 0, 0.15)",background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:e.jsxs(c,{sx:{p:3},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:3},children:[e.jsx(c,{sx:{width:48,height:48,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(oa,{sx:{color:"white",fontSize:24}})}),e.jsxs(c,{children:[e.jsx(i,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Project Management Guide"}),e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Step-by-step instructions for effective project setup and management"})]})]}),e.jsxs(_s,{orientation:"vertical",sx:{mb:3},children:[e.jsxs(Lt,{active:!0,children:[e.jsx(qt,{StepIconComponent:()=>e.jsx(c,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #10b981, #059669)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold"},children:"1"}),sx:{color:"white"},children:e.jsx(i,{variant:"h6",sx:{color:"white",fontWeight:600},children:"Create Your Project"})}),e.jsx(ws,{children:e.jsxs(c,{sx:{pl:2,pb:2},children:[e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)",mb:2},children:"Start by creating a new project with the proper configuration:"}),e.jsxs(bt,{dense:!0,children:[e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(at,{sx:{color:"#10b981",fontSize:20}})}),e.jsx(Ne,{primary:"Click 'Create Project' button or use the Actions menu",secondary:"Choose between Standalone (local) or Network (collaborative) mode"})]}),e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(at,{sx:{color:"#10b981",fontSize:20}})}),e.jsx(Ne,{primary:"Configure storage backend",secondary:"Select Firestore for web-only projects, or GCS/S3 for file storage"})]}),e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(at,{sx:{color:"#10b981",fontSize:20}})}),e.jsx(Ne,{primary:"Set project name and description",secondary:"Use descriptive names that clearly identify the project purpose"})]})]})]})})]}),e.jsxs(Lt,{active:!0,children:[e.jsx(qt,{StepIconComponent:()=>e.jsx(c,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #3b82f6, #1d4ed8)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold"},children:"2"}),sx:{color:"white"},children:e.jsx(i,{variant:"h6",sx:{color:"white",fontWeight:600},children:"Create Datasets with Collections"})}),e.jsx(ws,{children:e.jsxs(c,{sx:{pl:2,pb:2},children:[e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)",mb:2},children:"Datasets organize your data and define which Firestore collections to use:"}),e.jsxs(bt,{dense:!0,children:[e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(He,{sx:{color:"#3b82f6",fontSize:20}})}),e.jsx(Ne,{primary:"Access Dataset Management from Actions menu",secondary:"Click 'Dataset Management' to view and create datasets"})]}),e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(at,{sx:{color:"#3b82f6",fontSize:20}})}),e.jsx(Ne,{primary:"Create new dataset with 'Create Dataset' button",secondary:"Configure dataset name, description, and visibility settings"})]}),e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(at,{sx:{color:"#3b82f6",fontSize:20}})}),e.jsx(Ne,{primary:"Select Firestore collections to include",secondary:"Choose which collections from your Firestore database to include in this dataset"})]}),e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(at,{sx:{color:"#3b82f6",fontSize:20}})}),e.jsx(Ne,{primary:"Set dataset visibility and permissions",secondary:"Configure whether dataset is private, organization-wide, or public"})]})]})]})})]}),e.jsxs(Lt,{active:!0,children:[e.jsx(qt,{StepIconComponent:()=>e.jsx(c,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #f59e0b, #d97706)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold"},children:"3"}),sx:{color:"white"},children:e.jsx(i,{variant:"h6",sx:{color:"white",fontWeight:600},children:"Assign Datasets to Projects"})}),e.jsx(ws,{children:e.jsxs(c,{sx:{pl:2,pb:2},children:[e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)",mb:2},children:"Connect your datasets to specific projects for organized data access:"}),e.jsxs(bt,{dense:!0,children:[e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(Ci,{sx:{color:"#f59e0b",fontSize:20}})}),e.jsx(Ne,{primary:"Click on any project in the table",secondary:"This opens the project details and management options"})]}),e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(at,{sx:{color:"#f59e0b",fontSize:20}})}),e.jsx(Ne,{primary:"Use 'Assign Dataset' option",secondary:"Select from available datasets to assign to this project"})]}),e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(at,{sx:{color:"#f59e0b",fontSize:20}})}),e.jsx(Ne,{primary:"Configure dataset permissions for the project",secondary:"Set read/write permissions and access levels for team members"})]})]})]})})]}),e.jsxs(Lt,{active:!0,children:[e.jsx(qt,{StepIconComponent:()=>e.jsx(c,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #7c3aed)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold"},children:"4"}),sx:{color:"white"},children:e.jsx(i,{variant:"h6",sx:{color:"white",fontWeight:600},children:"Assign Team Members to Project Roles"})}),e.jsx(ws,{children:e.jsxs(c,{sx:{pl:2,pb:2},children:[e.jsx(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)",mb:2},children:"Add team members and assign appropriate roles for collaboration:"}),e.jsxs(bt,{dense:!0,children:[e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(vi,{sx:{color:"#8b5cf6",fontSize:20}})}),e.jsx(Ne,{primary:"Access 'Team Management' from project actions",secondary:"Click on a project, then select team management options"})]}),e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(at,{sx:{color:"#8b5cf6",fontSize:20}})}),e.jsx(Ne,{primary:"Add team members to the project",secondary:"Search and select team members from your organization"})]}),e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(at,{sx:{color:"#8b5cf6",fontSize:20}})}),e.jsx(Ne,{primary:"Assign appropriate roles (Admin, Member, Viewer)",secondary:"Set role-based permissions for project access and management"})]}),e.jsxs(Te,{sx:{pl:0},children:[e.jsx(qe,{children:e.jsx(at,{sx:{color:"#8b5cf6",fontSize:20}})}),e.jsx(Ne,{primary:"Configure collaboration settings",secondary:"Enable real-time collaboration and set collaboration limits"})]})]})]})})]})]}),e.jsx(ms,{sx:{my:3,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsxs(c,{sx:{mb:3},children:[e.jsxs(i,{variant:"h6",sx:{color:"white",fontWeight:600,mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(na,{sx:{color:"#fbbf24"}}),"Best Practices"]}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,md:6,children:e.jsx(ge,{sx:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",color:"white"},children:e.jsxs(Ce,{sx:{p:2},children:[e.jsx(i,{variant:"subtitle2",sx:{fontWeight:600,mb:1,color:"#10b981"},children:"Project Organization"}),e.jsxs(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:["• Use descriptive project names that clearly identify purpose",e.jsx("br",{}),"• Group related projects with consistent naming conventions",e.jsx("br",{}),"• Archive completed projects to keep active list clean"]})]})})}),e.jsx(x,{item:!0,xs:12,md:6,children:e.jsx(ge,{sx:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",color:"white"},children:e.jsxs(Ce,{sx:{p:2},children:[e.jsx(i,{variant:"subtitle2",sx:{fontWeight:600,mb:1,color:"#3b82f6"},children:"Dataset Management"}),e.jsxs(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:["• Create datasets for specific data types or use cases",e.jsx("br",{}),"• Use clear collection naming in Firestore",e.jsx("br",{}),"• Set appropriate visibility levels for data security"]})]})})}),e.jsx(x,{item:!0,xs:12,md:6,children:e.jsx(ge,{sx:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",color:"white"},children:e.jsxs(Ce,{sx:{p:2},children:[e.jsx(i,{variant:"subtitle2",sx:{fontWeight:600,mb:1,color:"#8b5cf6"},children:"Team Collaboration"}),e.jsxs(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:["• Assign roles based on team member responsibilities",e.jsx("br",{}),"• Use Admin role sparingly for security",e.jsx("br",{}),"• Enable collaboration only when needed"]})]})})}),e.jsx(x,{item:!0,xs:12,md:6,children:e.jsx(ge,{sx:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",color:"white"},children:e.jsxs(Ce,{sx:{p:2},children:[e.jsx(i,{variant:"subtitle2",sx:{fontWeight:600,mb:1,color:"#f59e0b"},children:"Security & Access"}),e.jsxs(i,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:["• Review dataset visibility settings regularly",e.jsx("br",{}),"• Monitor team member access and roles",e.jsx("br",{}),"• Use organization-level permissions when appropriate"]})]})})})]})]}),e.jsxs(c,{sx:{mb:3},children:[e.jsxs(i,{variant:"h6",sx:{color:"white",fontWeight:600,mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Si,{sx:{color:"#ef4444"}}),"Quick Actions"]}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(B,{variant:"outlined",fullWidth:!0,startIcon:e.jsx(ft,{}),onClick:()=>{As(),$s()},sx:{borderColor:"rgba(16, 185, 129, 0.3)",color:"#10b981","&:hover":{borderColor:"#10b981",backgroundColor:"rgba(16, 185, 129, 0.1)"}},children:"Create New Project"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(B,{variant:"outlined",fullWidth:!0,startIcon:e.jsx(He,{}),onClick:()=>{As(),R(!0)},sx:{borderColor:"rgba(59, 130, 246, 0.3)",color:"#3b82f6","&:hover":{borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)"}},children:"Manage Datasets"})})]})]}),e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pt:2,borderTop:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx(i,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Need more help? Contact support or check the documentation."}),e.jsx(B,{variant:"text",onClick:As,sx:{color:"rgba(255, 255, 255, 0.8)"},children:"Close Guide"})]})]})})]})};export{dn as DashboardCloudProjectsBridge,dn as default};
