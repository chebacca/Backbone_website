import{j as e,b as ze,a as u,T as x,d,az as de,t as O,aA as Ge,aB as ue,G as he,k as Te,l as Ee,I as Ne,ak as Ue,h as k,aC as Re,Z as xe,aD as ge,aE as je,aF as qe,aG as me,U as pe,W as w,X as M,Y as S,aH as fe,aI as be,aJ as ve,u as D,a4 as _,F as Ye,Q as Oe,aj as He,aK as ye}from"./mui-T5zcPaKR.js";import{r as o}from"./vendor-OeuszDaU.js";import{cloudProjectIntegration as c}from"./CloudProjectIntegration-jp0BcI_-.js";import{U as Je,s as W}from"./UnifiedProjectCreationDialog-D6NMDzYm.js";import"./index-xzzCJJrm.js";import"./stripe-Bd-xCkZF.js";import"./proxy-Bigtmpzy.js";const nt=({onProjectLaunch:z})=>{const[G,Ce]=o.useState([]),[H,J]=o.useState(!0),[K,b]=o.useState(null),[m,ke]=o.useState(0),[we,T]=o.useState(!1),[Ke,Qe]=o.useState(!1),[s,P]=o.useState(null),[Q,v]=o.useState([]),[Se,y]=o.useState(!1),[De,I]=o.useState([]),[F,X]=o.useState(""),[g,Z]=o.useState("all"),[B,Pe]=o.useState(""),[V,ee]=o.useState(null),[h,te]=o.useState(null),[ae,E]=o.useState({}),[Ie,N]=o.useState({}),[Fe,C]=o.useState(!1),[U,se]=o.useState(!1),[ne,R]=o.useState(null),[oe,Be]=o.useState(!0),[l,p]=o.useState({name:"",description:"",backend:"firestore",gcsBucket:"",gcsPrefix:""}),Ae=async t=>{try{y(!0);const a=await c.getProjectDatasets(t.id);v(a),E(f=>({...f,[t.id]:a.length}));const n=g==="all"?t.storageBackend:g;g==="all"&&Z(n);const i=(await c.listDatasets({backend:n,query:B||void 0})).map(f=>{var j;return{...f,__label:`${f.name} ${((j=f.storage)==null?void 0:j.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});I(i)}catch(a){console.error("Failed to load datasets for project",a)}finally{y(!1)}};o.useEffect(()=>{s&&(Ae(s),p(t=>({...t,backend:s.storageBackend||"firestore",gcsBucket:s.gcsBucket||"",gcsPrefix:s.gcsPrefix||""})))},[s]),o.useEffect(()=>{A();const t=a=>{A()};return window.addEventListener("project:created",t),()=>window.removeEventListener("project:created",t)},[]);const A=async()=>{try{b(null),J(!0);const t=await c.getUserProjects();Ce(t);const a={};for(const n of t){const r=`launch_pref_${n.id}`,i=localStorage.getItem(r)||"web";a[n.id]=i}N(a)}catch(t){b((t==null?void 0:t.message)||"Failed to load projects")}finally{J(!1)}},re=async t=>{try{await W.selectMode(t.applicationMode,"cloud"),await W.selectProject(t.id),z==null||z(t.id)}catch(a){console.error("Failed to launch project:",a),b("Failed to launch project")}},Le=(t,a)=>{ee(t.currentTarget),te(a)},q=()=>{ee(null),te(null)},$e=async()=>{if(h){try{localStorage.setItem(`launch_pref_${h.id}`,"web"),N(r=>({...r,[h.id]:"web"})),await W.selectMode(h.applicationMode,"cloud"),await W.selectProject(h.id);const t=window.location.origin,n=`${String(t).replace(/\/$/,"")}/?projectId=${encodeURIComponent(h.id)}&mode=${encodeURIComponent(h.applicationMode)}`;window.open(n,"_blank","noopener,noreferrer")}catch{}q()}},Me=()=>{if(h)try{localStorage.setItem(`launch_pref_${h.id}`,"desktop"),N(r=>({...r,[h.id]:"desktop"}));const n=`dashboardv14://open-project?id=${encodeURIComponent(h.id)}`;window.location.href=n}catch(t){console.error("Failed to open desktop deep link",t),b("Unable to open Desktop app. Please ensure it is installed.")}finally{q()}},le=()=>{T(!0)},_e=async t=>{T(!1),await A(),setTimeout(()=>{const a=(m===0?L:$).find(n=>n.id===t)||G.find(n=>n.id===t);a&&re(a)},0)},ie=t=>{switch(t){case"firestore":return e.jsx(xe,{});case"gcs":return e.jsx(fe,{});default:return e.jsx(ye,{})}},Y=t=>t==="standalone"?e.jsx(ye,{}):e.jsx(be,{}),We=t=>{const a=new Date(t),r=new Date().getTime()-a.getTime(),i=Math.floor(r/(1e3*60*60*24));return i===0?"Today":i===1?"Yesterday":i<7?`${i} days ago`:a.toLocaleDateString()},L=G.filter(t=>t.isActive),$=G.filter(t=>!t.isActive);return e.jsxs(ze,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(u,{children:[e.jsx(x,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"Cloud Projects"}),e.jsx(x,{variant:"body1",color:"text.secondary",children:"Manage your projects with Firebase and Google Cloud Storage integration"})]}),e.jsx(d,{variant:"contained",startIcon:e.jsx(de,{}),onClick:le,size:"large",children:"Create Project"})]}),e.jsx(O,{severity:"info",sx:{mb:3},children:e.jsxs(x,{variant:"body2",children:[e.jsx("strong",{children:"Integrated Startup System:"})," Projects created here will automatically integrate with the unified startup flow and support both standalone and network modes with Firebase/GCS storage options."]})}),K&&e.jsx(O,{severity:"error",sx:{mb:3},onClose:()=>b(null),children:K}),e.jsxs(Ge,{value:m,onChange:(t,a)=>ke(a),sx:{borderBottom:1,borderColor:"divider",mb:3},children:[e.jsx(ue,{label:`Active Projects (${L.length})`}),e.jsx(ue,{label:`Archived (${$.length})`})]}),e.jsxs(u,{children:[H?e.jsx(u,{sx:{textAlign:"center",py:4},children:e.jsx(x,{children:"Loading projects..."})}):e.jsx(he,{container:!0,spacing:3,children:(m===0?L:$).map(t=>e.jsx(he,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(Te,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease","&:hover":{transform:"translateY(-2px)",boxShadow:a=>a.shadows[4]}},children:[e.jsxs(Ee,{sx:{flexGrow:1},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[Y(t.applicationMode),e.jsx(x,{variant:"h6",component:"h3",sx:{ml:1,flexGrow:1},children:t.name}),e.jsx(Ne,{size:"small",onClick:()=>P(t),children:e.jsx(Ue,{})})]}),t.description&&e.jsx(x,{variant:"body2",color:"text.secondary",paragraph:!0,children:t.description}),e.jsxs(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:[e.jsx(k,{size:"small",icon:Y(t.applicationMode),label:t.applicationMode==="standalone"?"Standalone":"Network",color:"primary",variant:"outlined"}),e.jsx(k,{size:"small",icon:ie(t.storageBackend),label:t.storageBackend,variant:"outlined"}),typeof ae[t.id]=="number"&&e.jsx(k,{size:"small",label:`Datasets: ${ae[t.id]}`,variant:"outlined"}),e.jsx(k,{size:"small",label:`Launch: ${(Ie[t.id]||"web")==="desktop"?"Desktop":"Web"}`,variant:"outlined"}),t.allowCollaboration&&e.jsx(k,{size:"small",label:`${t.maxCollaborators} users`,variant:"outlined"})]}),e.jsxs(x,{variant:"caption",color:"text.secondary",children:["Last accessed: ",We(t.lastAccessedAt)]})]}),e.jsxs(u,{sx:{p:2,pt:0,display:"flex",gap:1},children:[e.jsx(d,{fullWidth:!0,variant:"contained",startIcon:e.jsx(Re,{}),onClick:a=>Le(a,t),disabled:!t.isActive,children:t.isActive?"Launch":"Archived"}),e.jsx(d,{fullWidth:!0,variant:"outlined",color:t.isActive?"warning":"success",onClick:async()=>{try{t.isActive?await c.archiveProject(t.id):await c.restoreProject(t.id),await A()}catch(a){console.error("Failed to toggle archive",a),b("Failed to update project")}},children:t.isActive?"Archive":"Restore"})]})]})},t.id))}),!H&&(m===0?L:$).length===0&&e.jsxs(u,{sx:{textAlign:"center",py:8},children:[e.jsx(xe,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(x,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:m===0?"No active projects yet":"No archived projects"}),e.jsx(x,{variant:"body2",color:"text.secondary",paragraph:!0,children:m===0?"Create your first cloud project to get started with Firebase and GCS integration":"Archived projects will appear here"}),m===0&&e.jsx(d,{variant:"contained",startIcon:e.jsx(de,{}),onClick:le,size:"large",children:"Create Your First Project"})]})]}),e.jsx(Je,{open:we,onClose:()=>T(!1),mode:"shared_network",onSuccess:_e,onCreate:async t=>{var n,r;try{const i=localStorage.getItem("auth_token");i&&((r=(n=window.cloudProjectIntegration)==null?void 0:n.setAuthToken)==null||r.call(n,i))}catch{}return await c.createCloudProject(t)}}),e.jsxs(ge,{open:!!s,onClose:()=>P(null),maxWidth:"sm",fullWidth:!0,children:[e.jsx(je,{children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(qe,{}),"Project Details"]})}),e.jsxs(me,{children:[s&&e.jsxs(pe,{children:[e.jsxs(w,{children:[e.jsx(M,{children:Y(s.applicationMode)}),e.jsx(S,{primary:"Mode",secondary:s.applicationMode==="standalone"?"Standalone":"Network"})]}),e.jsxs(w,{children:[e.jsx(M,{children:ie(s.storageBackend)}),e.jsx(S,{primary:"Storage Backend",secondary:s.storageBackend})]}),s.gcsBucket&&e.jsxs(w,{children:[e.jsx(M,{children:e.jsx(fe,{})}),e.jsx(S,{primary:"GCS Bucket",secondary:s.gcsBucket})]}),s.allowCollaboration&&e.jsxs(w,{children:[e.jsx(M,{children:e.jsx(be,{})}),e.jsx(S,{primary:"Collaboration",secondary:`Up to ${s.maxCollaborators} users`})]})]}),s&&e.jsxs(u,{sx:{mt:2},children:[e.jsx(x,{variant:"subtitle1",sx:{mb:1},children:"Assigned Datasets"}),e.jsx(d,{size:"small",variant:"outlined",onClick:async()=>{if(s)try{y(!0);const t=await c.getProjectDatasets(s.id);v(t);const n=(await c.listDatasets({backend:g==="all"?void 0:g,query:B||void 0})).map(r=>{var i;return{...r,__label:`${r.name} ${((i=r.storage)==null?void 0:i.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});I(n)}catch(t){console.error("Failed to load datasets",t)}finally{y(!1)}},sx:{mb:1},children:Se?"Loading...":"Refresh"}),e.jsx(d,{size:"small",variant:"contained",color:"primary",onClick:()=>{R(null),C(!0)},sx:{mb:1,ml:1},children:"New Dataset"}),e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center",mb:1,flexWrap:"wrap"},children:[e.jsx("label",{htmlFor:"dataset-backend",className:"visually-hidden",children:"Backend"}),e.jsxs("select",{id:"dataset-backend","aria-label":"Backend filter",value:g,onChange:t=>Z(t.target.value),children:[e.jsx("option",{value:"all",children:"All backends"}),e.jsx("option",{value:"firestore",children:"Firestore"}),e.jsx("option",{value:"gcs",children:"GCS"})]}),e.jsx("input",{type:"text",placeholder:"Search datasets…",value:B,onChange:t=>Pe(t.target.value),"aria-label":"Search datasets",className:"dataset-search-input"}),e.jsx("label",{htmlFor:"dataset-select",className:"visually-hidden",children:"Select dataset"}),e.jsxs("select",{id:"dataset-select","aria-label":"Select dataset",value:F,onChange:t=>X(t.target.value),className:"dataset-select-input",children:[e.jsx("option",{value:"",children:"Select dataset…"}),De.map(t=>e.jsx("option",{value:t.id,children:t.__label||t.name},t.id))]}),e.jsx(d,{size:"small",variant:"contained",disabled:!F,onClick:async()=>{if(!(!s||!F))try{await c.assignDatasetToProject(s.id,F);const t=await c.getProjectDatasets(s.id);v(t),X("")}catch(t){console.error("Failed to assign dataset",t)}},children:"Assign"}),e.jsx(d,{size:"small",variant:"outlined",onClick:async()=>{if(s)try{y(!0);const t=await c.getProjectDatasets(s.id);v(t);const n=(await c.listDatasets({backend:g==="all"?void 0:g,query:B||void 0})).map(r=>{var i;return{...r,__label:`${r.name} ${((i=r.storage)==null?void 0:i.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});I(n)}catch(t){console.error("Failed to load datasets",t)}finally{y(!1)}},children:"Apply Filters"})]}),Q.length===0?e.jsx(x,{variant:"body2",color:"text.secondary",children:"No datasets assigned"}):e.jsx(pe,{children:Q.map(t=>e.jsx(w,{secondaryAction:e.jsx(d,{size:"small",color:"error",onClick:async()=>{try{await c.unassignDatasetFromProject(s.id,t.id),v(a=>a.filter(n=>n.id!==t.id)),E(a=>({...a,[s.id]:Math.max(0,(a[s.id]||1)-1)}))}catch(a){console.error("Failed to unassign dataset",a)}},children:"Remove"}),children:e.jsx(S,{primary:t.name,secondary:t.description})},t.id))})]})]}),e.jsxs(ve,{children:[e.jsx(d,{onClick:()=>P(null),children:"Close"}),s&&e.jsx(d,{variant:"contained",onClick:()=>{re(s),P(null)},children:"Launch Project"})]})]}),e.jsxs(ge,{open:Fe,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(je,{children:"Create Dataset"}),e.jsxs(me,{children:[ne&&e.jsx(O,{severity:"error",sx:{mb:2},children:ne}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(D,{label:"Name",value:l.name,onChange:t=>p({...l,name:t.target.value}),required:!0,fullWidth:!0}),e.jsx(D,{label:"Description",value:l.description,onChange:t=>p({...l,description:t.target.value}),multiline:!0,minRows:2,fullWidth:!0}),e.jsxs(D,{select:!0,label:"Storage Backend",value:l.backend,onChange:t=>p({...l,backend:t.target.value}),fullWidth:!0,children:[e.jsx(_,{value:"firestore",children:"Firestore"}),e.jsx(_,{value:"gcs",children:"Google Cloud Storage (GCS)"})]}),l.backend==="gcs"&&e.jsxs(e.Fragment,{children:[e.jsx(D,{label:"GCS Bucket",placeholder:"my-bucket",value:l.gcsBucket,onChange:t=>p({...l,gcsBucket:t.target.value}),fullWidth:!0}),e.jsx(D,{label:"GCS Prefix (optional)",placeholder:"datasets/project-123/",value:l.gcsPrefix,onChange:t=>p({...l,gcsPrefix:t.target.value}),fullWidth:!0})]}),e.jsx(Ye,{control:e.jsx(Oe,{checked:oe,onChange:(t,a)=>Be(a)}),label:"Assign to this project after creation"})]})]}),e.jsxs(ve,{children:[e.jsx(d,{onClick:()=>C(!1),disabled:U,children:"Cancel"}),e.jsx(d,{variant:"contained",disabled:U||!l.name.trim(),onClick:async()=>{if(!s){C(!1);return}R(null),se(!0);try{const t={backend:l.backend};l.backend==="gcs"&&(l.gcsBucket&&(t.gcsBucket=l.gcsBucket),l.gcsPrefix&&(t.gcsPrefix=l.gcsPrefix));const a=await c.createDataset({name:l.name.trim(),description:l.description.trim()||void 0,visibility:"private",organizationId:null,tags:[],schema:{},storage:t});oe&&await c.assignDatasetToProject(s.id,a.id);const n=await c.getProjectDatasets(s.id);v(n),E(j=>({...j,[s.id]:n.length}));const r=g==="all"?s.storageBackend:g,f=(await c.listDatasets({backend:r})).map(j=>{var ce;return{...j,__label:`${j.name} ${((ce=j.storage)==null?void 0:ce.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});I(f),C(!1),p(j=>({...j,name:"",description:""}))}catch(t){R((t==null?void 0:t.message)||"Failed to create dataset")}finally{se(!1)}},children:U?"Creating…":"Create Dataset"})]})]}),e.jsxs(He,{anchorEl:V,open:!!V,onClose:q,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsx(_,{onClick:$e,children:"Launch (Web)"}),e.jsx(_,{onClick:Me,children:"Launch (Desktop)"})]})]})};export{nt as DashboardCloudProjectsBridge,nt as default};
