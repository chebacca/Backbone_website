import{j as e,b as ze,a as u,T as h,d,az as ce,t as O,aA as Ge,aB as de,G as ue,k as Te,l as Ee,I as Ne,ak as Ue,h as k,aC as Re,Z as he,aD as xe,aE as ge,aF as qe,aG as je,U as me,W as w,X as $,Y as S,aH as fe,aI as pe,aJ as be,u as D,a4 as _,F as Ye,Q as Oe,aj as He,aK as ve}from"./mui-T5zcPaKR.js";import{r}from"./vendor-OeuszDaU.js";import{cloudProjectIntegration as c}from"./CloudProjectIntegration-CSRzgKQ3.js";import{U as Je,s as ye}from"./UnifiedProjectCreationDialog-C5xlEkeX.js";import"./index-CyfiPuQC.js";import"./stripe-Bd-xCkZF.js";import"./proxy-Bigtmpzy.js";const nt=({onProjectLaunch:W})=>{const[z,Ce]=r.useState([]),[H,J]=r.useState(!0),[K,b]=r.useState(null),[m,ke]=r.useState(0),[we,G]=r.useState(!1),[Ke,Qe]=r.useState(!1),[s,P]=r.useState(null),[Q,v]=r.useState([]),[Se,y]=r.useState(!1),[De,F]=r.useState([]),[I,X]=r.useState(""),[x,Z]=r.useState("all"),[B,Pe]=r.useState(""),[V,ee]=r.useState(null),[j,te]=r.useState(null),[ae,T]=r.useState({}),[Fe,E]=r.useState({}),[Ie,C]=r.useState(!1),[N,se]=r.useState(!1),[ne,U]=r.useState(null),[re,Be]=r.useState(!0),[o,f]=r.useState({name:"",description:"",backend:"firestore",gcsBucket:"",gcsPrefix:""}),Ae=async t=>{try{y(!0);const a=await c.getProjectDatasets(t.id);v(a),T(p=>({...p,[t.id]:a.length}));const n=x==="all"?t.storageBackend:x;x==="all"&&Z(n);const i=(await c.listDatasets({backend:n,query:B||void 0})).map(p=>{var g;return{...p,__label:`${p.name} ${((g=p.storage)==null?void 0:g.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});F(i)}catch(a){console.error("Failed to load datasets for project",a)}finally{y(!1)}};r.useEffect(()=>{s&&(Ae(s),f(t=>({...t,backend:s.storageBackend||"firestore",gcsBucket:s.gcsBucket||"",gcsPrefix:s.gcsPrefix||""})))},[s]),r.useEffect(()=>{A();const t=a=>{A()};return window.addEventListener("project:created",t),()=>window.removeEventListener("project:created",t)},[]);const A=async()=>{try{b(null),J(!0);const t=await c.getUserProjects();Ce(t);const a={};for(const n of t){const l=`launch_pref_${n.id}`,i=localStorage.getItem(l)||"web";a[n.id]=i}E(a)}catch(t){b((t==null?void 0:t.message)||"Failed to load projects")}finally{J(!1)}},R=async t=>{try{await ye.selectMode(t.applicationMode,"cloud"),await ye.selectProject(t.id),W==null||W(t.id)}catch(a){console.error("Failed to launch project:",a),b("Failed to launch project")}},Le=(t,a)=>{ee(t.currentTarget),te(a)},q=()=>{ee(null),te(null)},Me=async()=>{if(j){try{localStorage.setItem(`launch_pref_${j.id}`,"web"),E(t=>({...t,[j.id]:"web"}))}catch{}await R(j),q()}},$e=()=>{if(j)try{localStorage.setItem(`launch_pref_${j.id}`,"desktop"),E(l=>({...l,[j.id]:"desktop"}));const n=`dashboardv14://open-project?id=${encodeURIComponent(j.id)}`;window.location.href=n}catch(t){console.error("Failed to open desktop deep link",t),b("Unable to open Desktop app. Please ensure it is installed.")}finally{q()}},oe=()=>{G(!0)},_e=async t=>{G(!1),await A(),setTimeout(()=>{const a=(m===0?L:M).find(n=>n.id===t)||z.find(n=>n.id===t);a&&R(a)},0)},le=t=>{switch(t){case"firestore":return e.jsx(he,{});case"gcs":return e.jsx(fe,{});default:return e.jsx(ve,{})}},Y=t=>t==="standalone"?e.jsx(ve,{}):e.jsx(pe,{}),We=t=>{const a=new Date(t),l=new Date().getTime()-a.getTime(),i=Math.floor(l/(1e3*60*60*24));return i===0?"Today":i===1?"Yesterday":i<7?`${i} days ago`:a.toLocaleDateString()},L=z.filter(t=>t.isActive),M=z.filter(t=>!t.isActive);return e.jsxs(ze,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(u,{children:[e.jsx(h,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"Cloud Projects"}),e.jsx(h,{variant:"body1",color:"text.secondary",children:"Manage your projects with Firebase and Google Cloud Storage integration"})]}),e.jsx(d,{variant:"contained",startIcon:e.jsx(ce,{}),onClick:oe,size:"large",children:"Create Project"})]}),e.jsx(O,{severity:"info",sx:{mb:3},children:e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Integrated Startup System:"})," Projects created here will automatically integrate with the unified startup flow and support both standalone and network modes with Firebase/GCS storage options."]})}),K&&e.jsx(O,{severity:"error",sx:{mb:3},onClose:()=>b(null),children:K}),e.jsxs(Ge,{value:m,onChange:(t,a)=>ke(a),sx:{borderBottom:1,borderColor:"divider",mb:3},children:[e.jsx(de,{label:`Active Projects (${L.length})`}),e.jsx(de,{label:`Archived (${M.length})`})]}),e.jsxs(u,{children:[H?e.jsx(u,{sx:{textAlign:"center",py:4},children:e.jsx(h,{children:"Loading projects..."})}):e.jsx(ue,{container:!0,spacing:3,children:(m===0?L:M).map(t=>e.jsx(ue,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(Te,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease","&:hover":{transform:"translateY(-2px)",boxShadow:a=>a.shadows[4]}},children:[e.jsxs(Ee,{sx:{flexGrow:1},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[Y(t.applicationMode),e.jsx(h,{variant:"h6",component:"h3",sx:{ml:1,flexGrow:1},children:t.name}),e.jsx(Ne,{size:"small",onClick:()=>P(t),children:e.jsx(Ue,{})})]}),t.description&&e.jsx(h,{variant:"body2",color:"text.secondary",paragraph:!0,children:t.description}),e.jsxs(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:[e.jsx(k,{size:"small",icon:Y(t.applicationMode),label:t.applicationMode==="standalone"?"Standalone":"Network",color:"primary",variant:"outlined"}),e.jsx(k,{size:"small",icon:le(t.storageBackend),label:t.storageBackend,variant:"outlined"}),typeof ae[t.id]=="number"&&e.jsx(k,{size:"small",label:`Datasets: ${ae[t.id]}`,variant:"outlined"}),e.jsx(k,{size:"small",label:`Launch: ${(Fe[t.id]||"web")==="desktop"?"Desktop":"Web"}`,variant:"outlined"}),t.allowCollaboration&&e.jsx(k,{size:"small",label:`${t.maxCollaborators} users`,variant:"outlined"})]}),e.jsxs(h,{variant:"caption",color:"text.secondary",children:["Last accessed: ",We(t.lastAccessedAt)]})]}),e.jsxs(u,{sx:{p:2,pt:0,display:"flex",gap:1},children:[e.jsx(d,{fullWidth:!0,variant:"contained",startIcon:e.jsx(Re,{}),onClick:a=>Le(a,t),disabled:!t.isActive,children:t.isActive?"Launch":"Archived"}),e.jsx(d,{fullWidth:!0,variant:"outlined",color:t.isActive?"warning":"success",onClick:async()=>{try{t.isActive?await c.archiveProject(t.id):await c.restoreProject(t.id),await A()}catch(a){console.error("Failed to toggle archive",a),b("Failed to update project")}},children:t.isActive?"Archive":"Restore"})]})]})},t.id))}),!H&&(m===0?L:M).length===0&&e.jsxs(u,{sx:{textAlign:"center",py:8},children:[e.jsx(he,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(h,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:m===0?"No active projects yet":"No archived projects"}),e.jsx(h,{variant:"body2",color:"text.secondary",paragraph:!0,children:m===0?"Create your first cloud project to get started with Firebase and GCS integration":"Archived projects will appear here"}),m===0&&e.jsx(d,{variant:"contained",startIcon:e.jsx(ce,{}),onClick:oe,size:"large",children:"Create Your First Project"})]})]}),e.jsx(Je,{open:we,onClose:()=>G(!1),mode:"shared_network",onSuccess:_e,onCreate:async t=>{var n,l;try{const i=localStorage.getItem("auth_token");i&&((l=(n=window.cloudProjectIntegration)==null?void 0:n.setAuthToken)==null||l.call(n,i))}catch{}return await c.createCloudProject(t)}}),e.jsxs(xe,{open:!!s,onClose:()=>P(null),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ge,{children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(qe,{}),"Project Details"]})}),e.jsxs(je,{children:[s&&e.jsxs(me,{children:[e.jsxs(w,{children:[e.jsx($,{children:Y(s.applicationMode)}),e.jsx(S,{primary:"Mode",secondary:s.applicationMode==="standalone"?"Standalone":"Network"})]}),e.jsxs(w,{children:[e.jsx($,{children:le(s.storageBackend)}),e.jsx(S,{primary:"Storage Backend",secondary:s.storageBackend})]}),s.gcsBucket&&e.jsxs(w,{children:[e.jsx($,{children:e.jsx(fe,{})}),e.jsx(S,{primary:"GCS Bucket",secondary:s.gcsBucket})]}),s.allowCollaboration&&e.jsxs(w,{children:[e.jsx($,{children:e.jsx(pe,{})}),e.jsx(S,{primary:"Collaboration",secondary:`Up to ${s.maxCollaborators} users`})]})]}),s&&e.jsxs(u,{sx:{mt:2},children:[e.jsx(h,{variant:"subtitle1",sx:{mb:1},children:"Assigned Datasets"}),e.jsx(d,{size:"small",variant:"outlined",onClick:async()=>{if(s)try{y(!0);const t=await c.getProjectDatasets(s.id);v(t);const n=(await c.listDatasets({backend:x==="all"?void 0:x,query:B||void 0})).map(l=>{var i;return{...l,__label:`${l.name} ${((i=l.storage)==null?void 0:i.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});F(n)}catch(t){console.error("Failed to load datasets",t)}finally{y(!1)}},sx:{mb:1},children:Se?"Loading...":"Refresh"}),e.jsx(d,{size:"small",variant:"contained",color:"primary",onClick:()=>{U(null),C(!0)},sx:{mb:1,ml:1},children:"New Dataset"}),e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center",mb:1,flexWrap:"wrap"},children:[e.jsx("label",{htmlFor:"dataset-backend",className:"visually-hidden",children:"Backend"}),e.jsxs("select",{id:"dataset-backend","aria-label":"Backend filter",value:x,onChange:t=>Z(t.target.value),children:[e.jsx("option",{value:"all",children:"All backends"}),e.jsx("option",{value:"firestore",children:"Firestore"}),e.jsx("option",{value:"gcs",children:"GCS"})]}),e.jsx("input",{type:"text",placeholder:"Search datasets…",value:B,onChange:t=>Pe(t.target.value),"aria-label":"Search datasets",className:"dataset-search-input"}),e.jsx("label",{htmlFor:"dataset-select",className:"visually-hidden",children:"Select dataset"}),e.jsxs("select",{id:"dataset-select","aria-label":"Select dataset",value:I,onChange:t=>X(t.target.value),className:"dataset-select-input",children:[e.jsx("option",{value:"",children:"Select dataset…"}),De.map(t=>e.jsx("option",{value:t.id,children:t.__label||t.name},t.id))]}),e.jsx(d,{size:"small",variant:"contained",disabled:!I,onClick:async()=>{if(!(!s||!I))try{await c.assignDatasetToProject(s.id,I);const t=await c.getProjectDatasets(s.id);v(t),X("")}catch(t){console.error("Failed to assign dataset",t)}},children:"Assign"}),e.jsx(d,{size:"small",variant:"outlined",onClick:async()=>{if(s)try{y(!0);const t=await c.getProjectDatasets(s.id);v(t);const n=(await c.listDatasets({backend:x==="all"?void 0:x,query:B||void 0})).map(l=>{var i;return{...l,__label:`${l.name} ${((i=l.storage)==null?void 0:i.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});F(n)}catch(t){console.error("Failed to load datasets",t)}finally{y(!1)}},children:"Apply Filters"})]}),Q.length===0?e.jsx(h,{variant:"body2",color:"text.secondary",children:"No datasets assigned"}):e.jsx(me,{children:Q.map(t=>e.jsx(w,{secondaryAction:e.jsx(d,{size:"small",color:"error",onClick:async()=>{try{await c.unassignDatasetFromProject(s.id,t.id),v(a=>a.filter(n=>n.id!==t.id)),T(a=>({...a,[s.id]:Math.max(0,(a[s.id]||1)-1)}))}catch(a){console.error("Failed to unassign dataset",a)}},children:"Remove"}),children:e.jsx(S,{primary:t.name,secondary:t.description})},t.id))})]})]}),e.jsxs(be,{children:[e.jsx(d,{onClick:()=>P(null),children:"Close"}),s&&e.jsx(d,{variant:"contained",onClick:()=>{R(s),P(null)},children:"Launch Project"})]})]}),e.jsxs(xe,{open:Ie,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ge,{children:"Create Dataset"}),e.jsxs(je,{children:[ne&&e.jsx(O,{severity:"error",sx:{mb:2},children:ne}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(D,{label:"Name",value:o.name,onChange:t=>f({...o,name:t.target.value}),required:!0,fullWidth:!0}),e.jsx(D,{label:"Description",value:o.description,onChange:t=>f({...o,description:t.target.value}),multiline:!0,minRows:2,fullWidth:!0}),e.jsxs(D,{select:!0,label:"Storage Backend",value:o.backend,onChange:t=>f({...o,backend:t.target.value}),fullWidth:!0,children:[e.jsx(_,{value:"firestore",children:"Firestore"}),e.jsx(_,{value:"gcs",children:"Google Cloud Storage (GCS)"})]}),o.backend==="gcs"&&e.jsxs(e.Fragment,{children:[e.jsx(D,{label:"GCS Bucket",placeholder:"my-bucket",value:o.gcsBucket,onChange:t=>f({...o,gcsBucket:t.target.value}),fullWidth:!0}),e.jsx(D,{label:"GCS Prefix (optional)",placeholder:"datasets/project-123/",value:o.gcsPrefix,onChange:t=>f({...o,gcsPrefix:t.target.value}),fullWidth:!0})]}),e.jsx(Ye,{control:e.jsx(Oe,{checked:re,onChange:(t,a)=>Be(a)}),label:"Assign to this project after creation"})]})]}),e.jsxs(be,{children:[e.jsx(d,{onClick:()=>C(!1),disabled:N,children:"Cancel"}),e.jsx(d,{variant:"contained",disabled:N||!o.name.trim(),onClick:async()=>{if(!s){C(!1);return}U(null),se(!0);try{const t={backend:o.backend};o.backend==="gcs"&&(o.gcsBucket&&(t.gcsBucket=o.gcsBucket),o.gcsPrefix&&(t.gcsPrefix=o.gcsPrefix));const a=await c.createDataset({name:o.name.trim(),description:o.description.trim()||void 0,visibility:"private",organizationId:null,tags:[],schema:{},storage:t});re&&await c.assignDatasetToProject(s.id,a.id);const n=await c.getProjectDatasets(s.id);v(n),T(g=>({...g,[s.id]:n.length}));const l=x==="all"?s.storageBackend:x,p=(await c.listDatasets({backend:l})).map(g=>{var ie;return{...g,__label:`${g.name} ${((ie=g.storage)==null?void 0:ie.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});F(p),C(!1),f(g=>({...g,name:"",description:""}))}catch(t){U((t==null?void 0:t.message)||"Failed to create dataset")}finally{se(!1)}},children:N?"Creating…":"Create Dataset"})]})]}),e.jsxs(He,{anchorEl:V,open:!!V,onClose:q,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsx(_,{onClick:Me,children:"Launch (Web)"}),e.jsx(_,{onClick:$e,children:"Launch (Desktop)"})]})]})};export{nt as DashboardCloudProjectsBridge,nt as default};
