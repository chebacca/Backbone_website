import{j as t,b as ze,a as u,T as x,d,az as de,t as O,aA as Ge,aB as ue,G as he,k as Te,l as Ee,I as Ne,ak as Ue,h as k,aC as Re,Z as xe,aD as ge,aE as je,aF as qe,aG as me,U as pe,W as w,X as M,Y as S,aH as fe,aI as be,aJ as ye,u as D,a4 as _,F as Ye,Q as Oe,aj as He,aK as ve}from"./mui-T5zcPaKR.js";import{r}from"./vendor-OeuszDaU.js";import{cloudProjectIntegration as c}from"./CloudProjectIntegration-KF5cQVA1.js";import{U as Je,s as W}from"./UnifiedProjectCreationDialog-C_ZkLpVr.js";import"./index-TFOt2H-W.js";import"./stripe-Bd-xCkZF.js";import"./proxy-Bigtmpzy.js";const nt=({onProjectLaunch:z})=>{const[G,Ce]=r.useState([]),[H,J]=r.useState(!0),[K,b]=r.useState(null),[p,ke]=r.useState(0),[we,T]=r.useState(!1),[Ke,Qe]=r.useState(!1),[s,P]=r.useState(null),[Q,y]=r.useState([]),[Se,v]=r.useState(!1),[De,I]=r.useState([]),[F,X]=r.useState(""),[g,Z]=r.useState("all"),[B,Pe]=r.useState(""),[V,ee]=r.useState(null),[h,te]=r.useState(null),[ae,E]=r.useState({}),[Ie,N]=r.useState({}),[Fe,C]=r.useState(!1),[U,se]=r.useState(!1),[ne,R]=r.useState(null),[oe,Be]=r.useState(!0),[i,f]=r.useState({name:"",description:"",backend:"firestore",gcsBucket:"",gcsPrefix:""}),Ae=async e=>{try{v(!0);const a=await c.getProjectDatasets(e.id);y(a),E(m=>({...m,[e.id]:a.length}));const n=g==="all"?e.storageBackend:g;g==="all"&&Z(n);const l=(await c.listDatasets({backend:n,query:B||void 0})).map(m=>{var j;return{...m,__label:`${m.name} ${((j=m.storage)==null?void 0:j.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});I(l)}catch(a){console.error("Failed to load datasets for project",a)}finally{v(!1)}};r.useEffect(()=>{s&&(Ae(s),f(e=>({...e,backend:s.storageBackend||"firestore",gcsBucket:s.gcsBucket||"",gcsPrefix:s.gcsPrefix||""})))},[s]),r.useEffect(()=>{A();const e=a=>{A()};return window.addEventListener("project:created",e),()=>window.removeEventListener("project:created",e)},[]);const A=async()=>{try{b(null),J(!0);const e=await c.getUserProjects();Ce(e);const a={};for(const n of e){const o=`launch_pref_${n.id}`,l=localStorage.getItem(o)||"web";a[n.id]=l}N(a)}catch(e){b((e==null?void 0:e.message)||"Failed to load projects")}finally{J(!1)}},re=async e=>{try{await W.selectMode(e.applicationMode,"cloud"),await W.selectProject(e.id),z==null||z(e.id)}catch(a){console.error("Failed to launch project:",a),b("Failed to launch project")}},Le=(e,a)=>{ee(e.currentTarget),te(a)},q=()=>{ee(null),te(null)},$e=async()=>{if(h){try{localStorage.setItem(`launch_pref_${h.id}`,"web"),N(o=>({...o,[h.id]:"web"}));const e=window.open("about:blank","_blank","noopener,noreferrer");await W.selectMode(h.applicationMode,"cloud"),await W.selectProject(h.id);let a="";try{const o=localStorage.getItem("preferred_website_port"),l=o?Number(o):0,m=["localhost","127.0.0.1"].includes(window.location.hostname);l&&l>=1024&&l<=65535?a=`http://localhost:${l}`:m?a="http://localhost:3002":a=window.location.origin}catch{a=window.location.origin}a=String(a).replace(/\/$/,"");const n=`${a}/?projectId=${encodeURIComponent(h.id)}&mode=${encodeURIComponent(h.applicationMode)}`;if(e&&!e.closed)try{e.location.href=n}catch{}else window.open(n,"_blank","noopener,noreferrer")}catch{}q()}},Me=()=>{if(h)try{localStorage.setItem(`launch_pref_${h.id}`,"desktop"),N(o=>({...o,[h.id]:"desktop"}));const n=`dashboardv14://open-project?id=${encodeURIComponent(h.id)}`;window.location.href=n}catch(e){console.error("Failed to open desktop deep link",e),b("Unable to open Desktop app. Please ensure it is installed.")}finally{q()}},le=()=>{T(!0)},_e=async e=>{T(!1),await A(),setTimeout(()=>{const a=(p===0?L:$).find(n=>n.id===e)||G.find(n=>n.id===e);a&&re(a)},0)},ie=e=>{switch(e){case"firestore":return t.jsx(xe,{});case"gcs":return t.jsx(fe,{});default:return t.jsx(ve,{})}},Y=e=>e==="standalone"?t.jsx(ve,{}):t.jsx(be,{}),We=e=>{const a=new Date(e),o=new Date().getTime()-a.getTime(),l=Math.floor(o/(1e3*60*60*24));return l===0?"Today":l===1?"Yesterday":l<7?`${l} days ago`:a.toLocaleDateString()},L=G.filter(e=>e.isActive),$=G.filter(e=>!e.isActive);return t.jsxs(ze,{maxWidth:"lg",sx:{py:4},children:[t.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsxs(u,{children:[t.jsx(x,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"Cloud Projects"}),t.jsx(x,{variant:"body1",color:"text.secondary",children:"Manage your projects with Firebase and Google Cloud Storage integration"})]}),t.jsx(d,{variant:"contained",startIcon:t.jsx(de,{}),onClick:le,size:"large",children:"Create Project"})]}),t.jsx(O,{severity:"info",sx:{mb:3},children:t.jsxs(x,{variant:"body2",children:[t.jsx("strong",{children:"Integrated Startup System:"})," Projects created here will automatically integrate with the unified startup flow and support both standalone and network modes with Firebase/GCS storage options."]})}),K&&t.jsx(O,{severity:"error",sx:{mb:3},onClose:()=>b(null),children:K}),t.jsxs(Ge,{value:p,onChange:(e,a)=>ke(a),sx:{borderBottom:1,borderColor:"divider",mb:3},children:[t.jsx(ue,{label:`Active Projects (${L.length})`}),t.jsx(ue,{label:`Archived (${$.length})`})]}),t.jsxs(u,{children:[H?t.jsx(u,{sx:{textAlign:"center",py:4},children:t.jsx(x,{children:"Loading projects..."})}):t.jsx(he,{container:!0,spacing:3,children:(p===0?L:$).map(e=>t.jsx(he,{item:!0,xs:12,sm:6,md:4,children:t.jsxs(Te,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease","&:hover":{transform:"translateY(-2px)",boxShadow:a=>a.shadows[4]}},children:[t.jsxs(Ee,{sx:{flexGrow:1},children:[t.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[Y(e.applicationMode),t.jsx(x,{variant:"h6",component:"h3",sx:{ml:1,flexGrow:1},children:e.name}),t.jsx(Ne,{size:"small",onClick:()=>P(e),children:t.jsx(Ue,{})})]}),e.description&&t.jsx(x,{variant:"body2",color:"text.secondary",paragraph:!0,children:e.description}),t.jsxs(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:[t.jsx(k,{size:"small",icon:Y(e.applicationMode),label:e.applicationMode==="standalone"?"Standalone":"Network",color:"primary",variant:"outlined"}),t.jsx(k,{size:"small",icon:ie(e.storageBackend),label:e.storageBackend,variant:"outlined"}),typeof ae[e.id]=="number"&&t.jsx(k,{size:"small",label:`Datasets: ${ae[e.id]}`,variant:"outlined"}),t.jsx(k,{size:"small",label:`Launch: ${(Ie[e.id]||"web")==="desktop"?"Desktop":"Web"}`,variant:"outlined"}),e.allowCollaboration&&t.jsx(k,{size:"small",label:`${e.maxCollaborators} users`,variant:"outlined"})]}),t.jsxs(x,{variant:"caption",color:"text.secondary",children:["Last accessed: ",We(e.lastAccessedAt)]})]}),t.jsxs(u,{sx:{p:2,pt:0,display:"flex",gap:1},children:[t.jsx(d,{fullWidth:!0,variant:"contained",startIcon:t.jsx(Re,{}),onClick:a=>Le(a,e),disabled:!e.isActive,children:e.isActive?"Launch":"Archived"}),t.jsx(d,{fullWidth:!0,variant:"outlined",color:e.isActive?"warning":"success",onClick:async()=>{try{e.isActive?await c.archiveProject(e.id):await c.restoreProject(e.id),await A()}catch(a){console.error("Failed to toggle archive",a),b("Failed to update project")}},children:e.isActive?"Archive":"Restore"})]})]})},e.id))}),!H&&(p===0?L:$).length===0&&t.jsxs(u,{sx:{textAlign:"center",py:8},children:[t.jsx(xe,{sx:{fontSize:64,color:"text.secondary",mb:2}}),t.jsx(x,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:p===0?"No active projects yet":"No archived projects"}),t.jsx(x,{variant:"body2",color:"text.secondary",paragraph:!0,children:p===0?"Create your first cloud project to get started with Firebase and GCS integration":"Archived projects will appear here"}),p===0&&t.jsx(d,{variant:"contained",startIcon:t.jsx(de,{}),onClick:le,size:"large",children:"Create Your First Project"})]})]}),t.jsx(Je,{open:we,onClose:()=>T(!1),mode:"shared_network",onSuccess:_e,onCreate:async e=>{var n,o;try{const l=localStorage.getItem("auth_token");l&&((o=(n=window.cloudProjectIntegration)==null?void 0:n.setAuthToken)==null||o.call(n,l))}catch{}return await c.createCloudProject(e)}}),t.jsxs(ge,{open:!!s,onClose:()=>P(null),maxWidth:"sm",fullWidth:!0,children:[t.jsx(je,{children:t.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(qe,{}),"Project Details"]})}),t.jsxs(me,{children:[s&&t.jsxs(pe,{children:[t.jsxs(w,{children:[t.jsx(M,{children:Y(s.applicationMode)}),t.jsx(S,{primary:"Mode",secondary:s.applicationMode==="standalone"?"Standalone":"Network"})]}),t.jsxs(w,{children:[t.jsx(M,{children:ie(s.storageBackend)}),t.jsx(S,{primary:"Storage Backend",secondary:s.storageBackend})]}),s.gcsBucket&&t.jsxs(w,{children:[t.jsx(M,{children:t.jsx(fe,{})}),t.jsx(S,{primary:"GCS Bucket",secondary:s.gcsBucket})]}),s.allowCollaboration&&t.jsxs(w,{children:[t.jsx(M,{children:t.jsx(be,{})}),t.jsx(S,{primary:"Collaboration",secondary:`Up to ${s.maxCollaborators} users`})]})]}),s&&t.jsxs(u,{sx:{mt:2},children:[t.jsx(x,{variant:"subtitle1",sx:{mb:1},children:"Assigned Datasets"}),t.jsx(d,{size:"small",variant:"outlined",onClick:async()=>{if(s)try{v(!0);const e=await c.getProjectDatasets(s.id);y(e);const n=(await c.listDatasets({backend:g==="all"?void 0:g,query:B||void 0})).map(o=>{var l;return{...o,__label:`${o.name} ${((l=o.storage)==null?void 0:l.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});I(n)}catch(e){console.error("Failed to load datasets",e)}finally{v(!1)}},sx:{mb:1},children:Se?"Loading...":"Refresh"}),t.jsx(d,{size:"small",variant:"contained",color:"primary",onClick:()=>{R(null),C(!0)},sx:{mb:1,ml:1},children:"New Dataset"}),t.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center",mb:1,flexWrap:"wrap"},children:[t.jsx("label",{htmlFor:"dataset-backend",className:"visually-hidden",children:"Backend"}),t.jsxs("select",{id:"dataset-backend","aria-label":"Backend filter",value:g,onChange:e=>Z(e.target.value),children:[t.jsx("option",{value:"all",children:"All backends"}),t.jsx("option",{value:"firestore",children:"Firestore"}),t.jsx("option",{value:"gcs",children:"GCS"})]}),t.jsx("input",{type:"text",placeholder:"Search datasetsâ€¦",value:B,onChange:e=>Pe(e.target.value),"aria-label":"Search datasets",className:"dataset-search-input"}),t.jsx("label",{htmlFor:"dataset-select",className:"visually-hidden",children:"Select dataset"}),t.jsxs("select",{id:"dataset-select","aria-label":"Select dataset",value:F,onChange:e=>X(e.target.value),className:"dataset-select-input",children:[t.jsx("option",{value:"",children:"Select datasetâ€¦"}),De.map(e=>t.jsx("option",{value:e.id,children:e.__label||e.name},e.id))]}),t.jsx(d,{size:"small",variant:"contained",disabled:!F,onClick:async()=>{if(!(!s||!F))try{await c.assignDatasetToProject(s.id,F);const e=await c.getProjectDatasets(s.id);y(e),X("")}catch(e){console.error("Failed to assign dataset",e)}},children:"Assign"}),t.jsx(d,{size:"small",variant:"outlined",onClick:async()=>{if(s)try{v(!0);const e=await c.getProjectDatasets(s.id);y(e);const n=(await c.listDatasets({backend:g==="all"?void 0:g,query:B||void 0})).map(o=>{var l;return{...o,__label:`${o.name} ${((l=o.storage)==null?void 0:l.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});I(n)}catch(e){console.error("Failed to load datasets",e)}finally{v(!1)}},children:"Apply Filters"})]}),Q.length===0?t.jsx(x,{variant:"body2",color:"text.secondary",children:"No datasets assigned"}):t.jsx(pe,{children:Q.map(e=>t.jsx(w,{secondaryAction:t.jsx(d,{size:"small",color:"error",onClick:async()=>{try{await c.unassignDatasetFromProject(s.id,e.id),y(a=>a.filter(n=>n.id!==e.id)),E(a=>({...a,[s.id]:Math.max(0,(a[s.id]||1)-1)}))}catch(a){console.error("Failed to unassign dataset",a)}},children:"Remove"}),children:t.jsx(S,{primary:e.name,secondary:e.description})},e.id))})]})]}),t.jsxs(ye,{children:[t.jsx(d,{onClick:()=>P(null),children:"Close"}),s&&t.jsx(d,{variant:"contained",onClick:()=>{re(s),P(null)},children:"Launch Project"})]})]}),t.jsxs(ge,{open:Fe,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[t.jsx(je,{children:"Create Dataset"}),t.jsxs(me,{children:[ne&&t.jsx(O,{severity:"error",sx:{mb:2},children:ne}),t.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[t.jsx(D,{label:"Name",value:i.name,onChange:e=>f({...i,name:e.target.value}),required:!0,fullWidth:!0}),t.jsx(D,{label:"Description",value:i.description,onChange:e=>f({...i,description:e.target.value}),multiline:!0,minRows:2,fullWidth:!0}),t.jsxs(D,{select:!0,label:"Storage Backend",value:i.backend,onChange:e=>f({...i,backend:e.target.value}),fullWidth:!0,children:[t.jsx(_,{value:"firestore",children:"Firestore"}),t.jsx(_,{value:"gcs",children:"Google Cloud Storage (GCS)"})]}),i.backend==="gcs"&&t.jsxs(t.Fragment,{children:[t.jsx(D,{label:"GCS Bucket",placeholder:"my-bucket",value:i.gcsBucket,onChange:e=>f({...i,gcsBucket:e.target.value}),fullWidth:!0}),t.jsx(D,{label:"GCS Prefix (optional)",placeholder:"datasets/project-123/",value:i.gcsPrefix,onChange:e=>f({...i,gcsPrefix:e.target.value}),fullWidth:!0})]}),t.jsx(Ye,{control:t.jsx(Oe,{checked:oe,onChange:(e,a)=>Be(a)}),label:"Assign to this project after creation"})]})]}),t.jsxs(ye,{children:[t.jsx(d,{onClick:()=>C(!1),disabled:U,children:"Cancel"}),t.jsx(d,{variant:"contained",disabled:U||!i.name.trim(),onClick:async()=>{if(!s){C(!1);return}R(null),se(!0);try{const e={backend:i.backend};i.backend==="gcs"&&(i.gcsBucket&&(e.gcsBucket=i.gcsBucket),i.gcsPrefix&&(e.gcsPrefix=i.gcsPrefix));const a=await c.createDataset({name:i.name.trim(),description:i.description.trim()||void 0,visibility:"private",organizationId:null,tags:[],schema:{},storage:e});oe&&await c.assignDatasetToProject(s.id,a.id);const n=await c.getProjectDatasets(s.id);y(n),E(j=>({...j,[s.id]:n.length}));const o=g==="all"?s.storageBackend:g,m=(await c.listDatasets({backend:o})).map(j=>{var ce;return{...j,__label:`${j.name} ${((ce=j.storage)==null?void 0:ce.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});I(m),C(!1),f(j=>({...j,name:"",description:""}))}catch(e){R((e==null?void 0:e.message)||"Failed to create dataset")}finally{se(!1)}},children:U?"Creatingâ€¦":"Create Dataset"})]})]}),t.jsxs(He,{anchorEl:V,open:!!V,onClose:q,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[t.jsx(_,{onClick:$e,children:"Launch (Web)"}),t.jsx(_,{onClick:Me,children:"Launch (Desktop)"})]})]})};export{nt as DashboardCloudProjectsBridge,nt as default};
