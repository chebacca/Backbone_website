import{j as e,b as Le,a as u,T as h,d,az as oe,t as R,aA as Ge,aB as le,G as ie,k as Me,l as Te,I as We,ak as ze,h as q,aC as $e,Z as ce,aD as de,aE as ue,aF as _e,aG as he,U as xe,W as C,X as G,Y as k,aH as ge,aI as je,aJ as me,u as w,a4 as M,F as Ee,Q as Ne,aj as Ue,aK as pe}from"./mui-T5zcPaKR.js";import{r}from"./vendor-OeuszDaU.js";import{cloudProjectIntegration as l}from"./CloudProjectIntegration-apnuMy7o.js";import{U as Re,s as qe}from"./UnifiedProjectCreationDialog-Dzn10AEo.js";import"./index-sAO77y9I.js";import"./stripe-Bd-xCkZF.js";import"./proxy-Bigtmpzy.js";const et=({onProjectLaunch:T})=>{const[W,fe]=r.useState([]),[Y,O]=r.useState(!0),[H,p]=r.useState(null),[j,be]=r.useState(0),[ve,z]=r.useState(!1),[Ye,Oe]=r.useState(!1),[s,S]=r.useState(null),[J,f]=r.useState([]),[ye,b]=r.useState(!1),[Ce,D]=r.useState([]),[P,K]=r.useState(""),[x,Q]=r.useState("all"),[F,ke]=r.useState(""),[X,Z]=r.useState(null),[B,V]=r.useState(null),[we,v]=r.useState(!1),[$,ee]=r.useState(!1),[te,_]=r.useState(null),[ae,Se]=r.useState(!0),[o,m]=r.useState({name:"",description:"",backend:"firestore",gcsBucket:"",gcsPrefix:""}),De=async t=>{try{b(!0);const a=await l.getProjectDatasets(t.id);f(a);const n=x==="all"?t.storageBackend:x;x==="all"&&Q(n);const i=(await l.listDatasets({backend:n,query:F||void 0})).map(y=>{var g;return{...y,__label:`${y.name} ${((g=y.storage)==null?void 0:g.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});D(i)}catch(a){console.error("Failed to load datasets for project",a)}finally{b(!1)}};r.useEffect(()=>{s&&(De(s),m(t=>({...t,backend:s.storageBackend||"firestore",gcsBucket:s.gcsBucket||"",gcsPrefix:s.gcsPrefix||""})))},[s]),r.useEffect(()=>{A();const t=a=>{A()};return window.addEventListener("project:created",t),()=>window.removeEventListener("project:created",t)},[]);const A=async()=>{try{p(null),O(!0);const t=await l.getUserProjects();fe(t)}catch(t){p((t==null?void 0:t.message)||"Failed to load projects")}finally{O(!1)}},E=async t=>{try{await qe.selectProject(t.id),T==null||T(t.id)}catch(a){console.error("Failed to launch project:",a),p("Failed to launch project")}},Pe=(t,a)=>{Z(t.currentTarget),V(a)},N=()=>{Z(null),V(null)},Fe=async()=>{B&&(await E(B),N())},Be=()=>{if(B)try{const n=`dashboardv14://open-project?id=${encodeURIComponent(B.id)}`;window.location.href=n}catch(t){console.error("Failed to open desktop deep link",t),p("Unable to open Desktop app. Please ensure it is installed.")}finally{N()}},se=()=>{z(!0)},Ae=async t=>{z(!1),await A(),setTimeout(()=>{const a=(j===0?I:L).find(n=>n.id===t)||W.find(n=>n.id===t);a&&E(a)},0)},ne=t=>{switch(t){case"firestore":return e.jsx(ce,{});case"gcs":return e.jsx(ge,{});default:return e.jsx(pe,{})}},U=t=>t==="standalone"?e.jsx(pe,{}):e.jsx(je,{}),Ie=t=>{const a=new Date(t),c=new Date().getTime()-a.getTime(),i=Math.floor(c/(1e3*60*60*24));return i===0?"Today":i===1?"Yesterday":i<7?`${i} days ago`:a.toLocaleDateString()},I=W.filter(t=>t.isActive),L=W.filter(t=>!t.isActive);return e.jsxs(Le,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(u,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(u,{children:[e.jsx(h,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:"Cloud Projects"}),e.jsx(h,{variant:"body1",color:"text.secondary",children:"Manage your projects with Firebase and Google Cloud Storage integration"})]}),e.jsx(d,{variant:"contained",startIcon:e.jsx(oe,{}),onClick:se,size:"large",children:"Create Project"})]}),e.jsx(R,{severity:"info",sx:{mb:3},children:e.jsxs(h,{variant:"body2",children:[e.jsx("strong",{children:"Integrated Startup System:"})," Projects created here will automatically integrate with the unified startup flow and support both standalone and network modes with Firebase/GCS storage options."]})}),H&&e.jsx(R,{severity:"error",sx:{mb:3},onClose:()=>p(null),children:H}),e.jsxs(Ge,{value:j,onChange:(t,a)=>be(a),sx:{borderBottom:1,borderColor:"divider",mb:3},children:[e.jsx(le,{label:`Active Projects (${I.length})`}),e.jsx(le,{label:`Archived (${L.length})`})]}),e.jsxs(u,{children:[Y?e.jsx(u,{sx:{textAlign:"center",py:4},children:e.jsx(h,{children:"Loading projects..."})}):e.jsx(ie,{container:!0,spacing:3,children:(j===0?I:L).map(t=>e.jsx(ie,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(Me,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"all 0.2s ease","&:hover":{transform:"translateY(-2px)",boxShadow:a=>a.shadows[4]}},children:[e.jsxs(Te,{sx:{flexGrow:1},children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:2},children:[U(t.applicationMode),e.jsx(h,{variant:"h6",component:"h3",sx:{ml:1,flexGrow:1},children:t.name}),e.jsx(We,{size:"small",onClick:()=>S(t),children:e.jsx(ze,{})})]}),t.description&&e.jsx(h,{variant:"body2",color:"text.secondary",paragraph:!0,children:t.description}),e.jsxs(u,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:[e.jsx(q,{size:"small",icon:U(t.applicationMode),label:t.applicationMode==="standalone"?"Standalone":"Network",color:"primary",variant:"outlined"}),e.jsx(q,{size:"small",icon:ne(t.storageBackend),label:t.storageBackend,variant:"outlined"}),t.allowCollaboration&&e.jsx(q,{size:"small",label:`${t.maxCollaborators} users`,variant:"outlined"})]}),e.jsxs(h,{variant:"caption",color:"text.secondary",children:["Last accessed: ",Ie(t.lastAccessedAt)]})]}),e.jsxs(u,{sx:{p:2,pt:0,display:"flex",gap:1},children:[e.jsx(d,{fullWidth:!0,variant:"contained",startIcon:e.jsx($e,{}),onClick:a=>Pe(a,t),disabled:!t.isActive,children:t.isActive?"Launch":"Archived"}),e.jsx(d,{fullWidth:!0,variant:"outlined",color:t.isActive?"warning":"success",onClick:async()=>{try{t.isActive?await l.archiveProject(t.id):await l.restoreProject(t.id),await A()}catch(a){console.error("Failed to toggle archive",a),p("Failed to update project")}},children:t.isActive?"Archive":"Restore"})]})]})},t.id))}),!Y&&(j===0?I:L).length===0&&e.jsxs(u,{sx:{textAlign:"center",py:8},children:[e.jsx(ce,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(h,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:j===0?"No active projects yet":"No archived projects"}),e.jsx(h,{variant:"body2",color:"text.secondary",paragraph:!0,children:j===0?"Create your first cloud project to get started with Firebase and GCS integration":"Archived projects will appear here"}),j===0&&e.jsx(d,{variant:"contained",startIcon:e.jsx(oe,{}),onClick:se,size:"large",children:"Create Your First Project"})]})]}),e.jsx(Re,{open:ve,onClose:()=>z(!1),mode:"shared_network",onSuccess:Ae,onCreate:async t=>{var n,c;try{const i=localStorage.getItem("auth_token");i&&((c=(n=window.cloudProjectIntegration)==null?void 0:n.setAuthToken)==null||c.call(n,i))}catch{}return await l.createCloudProject(t)}}),e.jsxs(de,{open:!!s,onClose:()=>S(null),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_e,{}),"Project Details"]})}),e.jsxs(he,{children:[s&&e.jsxs(xe,{children:[e.jsxs(C,{children:[e.jsx(G,{children:U(s.applicationMode)}),e.jsx(k,{primary:"Mode",secondary:s.applicationMode==="standalone"?"Standalone":"Network"})]}),e.jsxs(C,{children:[e.jsx(G,{children:ne(s.storageBackend)}),e.jsx(k,{primary:"Storage Backend",secondary:s.storageBackend})]}),s.gcsBucket&&e.jsxs(C,{children:[e.jsx(G,{children:e.jsx(ge,{})}),e.jsx(k,{primary:"GCS Bucket",secondary:s.gcsBucket})]}),s.allowCollaboration&&e.jsxs(C,{children:[e.jsx(G,{children:e.jsx(je,{})}),e.jsx(k,{primary:"Collaboration",secondary:`Up to ${s.maxCollaborators} users`})]})]}),s&&e.jsxs(u,{sx:{mt:2},children:[e.jsx(h,{variant:"subtitle1",sx:{mb:1},children:"Assigned Datasets"}),e.jsx(d,{size:"small",variant:"outlined",onClick:async()=>{if(s)try{b(!0);const t=await l.getProjectDatasets(s.id);f(t);const n=(await l.listDatasets({backend:x==="all"?void 0:x,query:F||void 0})).map(c=>{var i;return{...c,__label:`${c.name} ${((i=c.storage)==null?void 0:i.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});D(n)}catch(t){console.error("Failed to load datasets",t)}finally{b(!1)}},sx:{mb:1},children:ye?"Loading...":"Refresh"}),e.jsx(d,{size:"small",variant:"contained",color:"primary",onClick:()=>{_(null),v(!0)},sx:{mb:1,ml:1},children:"New Dataset"}),e.jsxs(u,{sx:{display:"flex",gap:1,alignItems:"center",mb:1,flexWrap:"wrap"},children:[e.jsx("label",{htmlFor:"dataset-backend",className:"visually-hidden",children:"Backend"}),e.jsxs("select",{id:"dataset-backend","aria-label":"Backend filter",value:x,onChange:t=>Q(t.target.value),children:[e.jsx("option",{value:"all",children:"All backends"}),e.jsx("option",{value:"firestore",children:"Firestore"}),e.jsx("option",{value:"gcs",children:"GCS"})]}),e.jsx("input",{type:"text",placeholder:"Search datasets…",value:F,onChange:t=>ke(t.target.value),"aria-label":"Search datasets",className:"dataset-search-input"}),e.jsx("label",{htmlFor:"dataset-select",className:"visually-hidden",children:"Select dataset"}),e.jsxs("select",{id:"dataset-select","aria-label":"Select dataset",value:P,onChange:t=>K(t.target.value),className:"dataset-select-input",children:[e.jsx("option",{value:"",children:"Select dataset…"}),Ce.map(t=>e.jsx("option",{value:t.id,children:t.__label||t.name},t.id))]}),e.jsx(d,{size:"small",variant:"contained",disabled:!P,onClick:async()=>{if(!(!s||!P))try{await l.assignDatasetToProject(s.id,P);const t=await l.getProjectDatasets(s.id);f(t),K("")}catch(t){console.error("Failed to assign dataset",t)}},children:"Assign"}),e.jsx(d,{size:"small",variant:"outlined",onClick:async()=>{if(s)try{b(!0);const t=await l.getProjectDatasets(s.id);f(t);const n=(await l.listDatasets({backend:x==="all"?void 0:x,query:F||void 0})).map(c=>{var i;return{...c,__label:`${c.name} ${((i=c.storage)==null?void 0:i.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});D(n)}catch(t){console.error("Failed to load datasets",t)}finally{b(!1)}},children:"Apply Filters"})]}),J.length===0?e.jsx(h,{variant:"body2",color:"text.secondary",children:"No datasets assigned"}):e.jsx(xe,{children:J.map(t=>e.jsx(C,{secondaryAction:e.jsx(d,{size:"small",color:"error",onClick:async()=>{try{await l.unassignDatasetFromProject(s.id,t.id),f(a=>a.filter(n=>n.id!==t.id))}catch(a){console.error("Failed to unassign dataset",a)}},children:"Remove"}),children:e.jsx(k,{primary:t.name,secondary:t.description})},t.id))})]})]}),e.jsxs(me,{children:[e.jsx(d,{onClick:()=>S(null),children:"Close"}),s&&e.jsx(d,{variant:"contained",onClick:()=>{E(s),S(null)},children:"Launch Project"})]})]}),e.jsxs(de,{open:we,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:"Create Dataset"}),e.jsxs(he,{children:[te&&e.jsx(R,{severity:"error",sx:{mb:2},children:te}),e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsx(w,{label:"Name",value:o.name,onChange:t=>m({...o,name:t.target.value}),required:!0,fullWidth:!0}),e.jsx(w,{label:"Description",value:o.description,onChange:t=>m({...o,description:t.target.value}),multiline:!0,minRows:2,fullWidth:!0}),e.jsxs(w,{select:!0,label:"Storage Backend",value:o.backend,onChange:t=>m({...o,backend:t.target.value}),fullWidth:!0,children:[e.jsx(M,{value:"firestore",children:"Firestore"}),e.jsx(M,{value:"gcs",children:"Google Cloud Storage (GCS)"})]}),o.backend==="gcs"&&e.jsxs(e.Fragment,{children:[e.jsx(w,{label:"GCS Bucket",placeholder:"my-bucket",value:o.gcsBucket,onChange:t=>m({...o,gcsBucket:t.target.value}),fullWidth:!0}),e.jsx(w,{label:"GCS Prefix (optional)",placeholder:"datasets/project-123/",value:o.gcsPrefix,onChange:t=>m({...o,gcsPrefix:t.target.value}),fullWidth:!0})]}),e.jsx(Ee,{control:e.jsx(Ne,{checked:ae,onChange:(t,a)=>Se(a)}),label:"Assign to this project after creation"})]})]}),e.jsxs(me,{children:[e.jsx(d,{onClick:()=>v(!1),disabled:$,children:"Cancel"}),e.jsx(d,{variant:"contained",disabled:$||!o.name.trim(),onClick:async()=>{if(!s){v(!1);return}_(null),ee(!0);try{const t={backend:o.backend};o.backend==="gcs"&&(o.gcsBucket&&(t.gcsBucket=o.gcsBucket),o.gcsPrefix&&(t.gcsPrefix=o.gcsPrefix));const a=await l.createDataset({name:o.name.trim(),description:o.description.trim()||void 0,visibility:"private",organizationId:null,tags:[],schema:{},storage:t});ae&&await l.assignDatasetToProject(s.id,a.id);const n=await l.getProjectDatasets(s.id);f(n);const c=x==="all"?s.storageBackend:x,y=(await l.listDatasets({backend:c})).map(g=>{var re;return{...g,__label:`${g.name} ${((re=g.storage)==null?void 0:re.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});D(y),v(!1),m(g=>({...g,name:"",description:""}))}catch(t){_((t==null?void 0:t.message)||"Failed to create dataset")}finally{ee(!1)}},children:$?"Creating…":"Create Dataset"})]})]}),e.jsxs(Ue,{anchorEl:X,open:!!X,onClose:N,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsx(M,{onClick:Fe,children:"Launch (Web)"}),e.jsx(M,{onClick:Be,children:"Launch (Desktop)"})]})]})};export{et as DashboardCloudProjectsBridge,et as default};
