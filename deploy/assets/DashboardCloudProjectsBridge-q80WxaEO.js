const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firebase-BzaqTwdK.js","assets/index-CBCKrx7Z.js","assets/mui-bHvDBUJA.js","assets/vendor-CjD1bmmO.js","assets/stripe-6YKC861V.js","assets/index-CBai7h7s.css","assets/index.esm-BANGvNYi.js","assets/index.esm-9jaBBmwp.js","assets/index.esm-CiRfLMBX.js"])))=>i.map(i=>d[i]);
var Pa=Object.defineProperty;var Ma=(u,r,i)=>r in u?Pa(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i;var _e=(u,r,i)=>Ma(u,typeof r!="symbol"?r+"":r,i);import{u as ka,a as _a,_ as Zt,E as Oa}from"./index-CBCKrx7Z.js";import{j as e,B as o,T as a,c as Be,G as x,r as W,cj as qe,d as ge,F as Re,s as Pe,ap as We,m as st,C as Ke,aj as Nt,e as te,I as ua,g as xs,V as Na,h as ga,a as G,K as Ts,b9 as Ct,t as oe,v as be,ar as Oe,c3 as za,c4 as Ba,c5 as ht,aI as Ze,aJ as es,bG as Es,aK as ss,bZ as ma,b_ as ha,b$ as pa,i as La,aL as ts,aS as As,aW as zt,ak as Ds,as as Le,at as Fe,M,bQ as Fa,D as St,p as Bt,ck as Ua,bO as Wa,H as Is,aP as xa,a9 as $a,cl as Ga,w as At,x as Rt,z as wt,aN as Tt,aO as et,X as ps,ag as Rs,c1 as Ha,bp as tt,A as Va,q as qa,u as ea,cm as Ka,Y as Ya,cn as Qa,bf as Ja,co as Xa,cp as Za,cq as er,cr as sr,cs as tr,l as ar,f as sa,ct as rr,an as ws,aA as Et,cu as It,b4 as or,b5 as ta,aH as aa,a5 as ra,bS as oa,aB as nr,aC as ir,aD as lr,aE as na,aF as je,aG as cr,bj as pt,cv as dr,cw as ur,a6 as gr,c0 as Js,R as ia,am as mr}from"./mui-bHvDBUJA.js";import{b as ba,r as g}from"./vendor-CjD1bmmO.js";import{c as re,T as Ue,a as la}from"./CloudProjectIntegration-DBwOLgah.js";import{U as hr,s as pr}from"./UnifiedProjectCreationDialog-iP8ueGtM.js";import{unifiedDataService as ca}from"./UnifiedDataService-BHx3uL4B.js";import{collection as xt,onSnapshot as xr,addDoc as br,Timestamp as Ve,doc as Xs,getDoc as da,updateDoc as Ss,query as fr,where as bt,getDocs as yr,setDoc as jr}from"./index.esm-9jaBBmwp.js";import{db as ls}from"./firebase-BzaqTwdK.js";import"./stripe-6YKC861V.js";import"./FirestoreCollectionManager-DSQCq1J2.js";import"./index.esm-BANGvNYi.js";import"./index.esm-CiRfLMBX.js";const cs=class cs{static getInstance(){return cs.instance||(cs.instance=new cs),cs.instance}async analyzeOrganizationDatasets(r,i){console.log("ðŸ” [DatasetConflictAnalyzer] Analyzing datasets for organization:",r);const t=i.filter(w=>{var S,k,_;return((S=w.storage)==null?void 0:S.backend)==="firestore"&&((_=(k=w.collectionAssignment)==null?void 0:k.selectedCollections)==null?void 0:_.length)>0}),c=this.buildCollectionUsageMap(t),l=this.detectCollectionOverlaps(c,t),h=this.generateGlobalInsights(c,t),n=this.calculateHealthScore(l,h),A={organizationId:r,totalDatasets:t.length,totalCollections:Object.keys(c).length,overlaps:l,globalInsights:h,healthScore:n};return console.log("âœ… [DatasetConflictAnalyzer] Analysis complete:",{datasets:A.totalDatasets,overlaps:A.overlaps.length,healthScore:A.healthScore}),A}async checkDatasetCreationConflicts(r,i){var A,w;console.log("ðŸ” [DatasetConflictAnalyzer] Checking conflicts for new dataset:",r.name);const t=[],c=[];if(!((w=(A=r.collectionAssignment)==null?void 0:A.selectedCollections)!=null&&w.length))return{hasConflicts:!1,warnings:[],suggestions:[]};const l=r.collectionAssignment.selectedCollections;for(const S of l){const k=i.filter(_=>{var N,ne;return(ne=(N=_.collectionAssignment)==null?void 0:N.selectedCollections)==null?void 0:ne.includes(S)});if(k.length>0){const _=this.assessConflictLevel(S,k,r);_!=="none"&&t.push({type:"overlap",severity:_==="high"?"error":_==="medium"?"warning":"info",message:`Collection "${S}" is already used by ${k.length} other dataset(s)`,affectedCollections:[S],affectedDatasets:k.map(N=>N.name),recommendation:this.getConflictRecommendation(S,k,r)}),_==="high"?c.push({type:"filter",message:"Consider adding data filters to differentiate from existing datasets",collections:[S]}):k.length>=3&&c.push({type:"merge",message:`Collection "${S}" is heavily used. Consider merging with existing dataset "${k[0].name}"`,collections:[S]})}}const h=this.checkRedundancyPatterns(l,i);t.push(...h.warnings),c.push(...h.suggestions);const n=this.checkPerformanceImplications(l,i);return t.push(...n),{hasConflicts:t.some(S=>S.severity==="error"),warnings:t,suggestions:c}}getConflictResolutionRecommendations(r){const i=[],t=r.overlaps.filter(c=>c.conflictLevel==="high");for(const c of t)i.push({type:"merge",priority:"high",title:`Merge datasets using "${c.collection}"`,description:`Collection "${c.collection}" is used by ${c.datasets.length} datasets with high conflict potential`,affectedDatasets:c.datasets.map(l=>l.name),estimatedImpact:"Reduces data redundancy and improves query performance",steps:["Review data usage patterns for each dataset","Identify common use cases and data access patterns","Create a unified dataset with appropriate data filters","Migrate existing queries to use the new unified dataset"]});for(const c of r.globalInsights.redundantAssignments)i.push({type:"filter",priority:"medium",title:`Add data filters for "${c.collection}"`,description:c.reason,affectedDatasets:c.affectedDatasets,estimatedImpact:"Improves data organization and reduces confusion",steps:["Analyze data access patterns for each dataset","Define specific filter criteria for each use case","Update dataset configurations with appropriate filters","Test data access to ensure proper isolation"]});if(r.globalInsights.mostUsedCollections.length>0){const c=r.globalInsights.mostUsedCollections[0];c.count>3&&i.push({type:"reorganize",priority:"low",title:`Optimize "${c.collection}" usage`,description:`This collection is used by ${c.count} datasets, consider optimization`,affectedDatasets:c.datasets,estimatedImpact:"Improves query performance and reduces resource usage",steps:["Review query patterns for this collection","Consider creating specialized views or indexes","Implement caching strategies for frequently accessed data","Monitor performance improvements"]})}return i.sort((c,l)=>{const h={high:3,medium:2,low:1};return h[l.priority]-h[c.priority]})}buildCollectionUsageMap(r){var t;const i={};for(const c of r)if((t=c.collectionAssignment)!=null&&t.selectedCollections)for(const l of c.collectionAssignment.selectedCollections)i[l]||(i[l]=[]),i[l].push(c);return i}detectCollectionOverlaps(r,i){const t=[];for(const[c,l]of Object.entries(r))if(l.length>1){const h=this.assessOverlapConflictLevel(c,l),n=this.getConflictReasons(c,l),A=this.getOverlapRecommendations(c,l);t.push({collection:c,datasets:l.map(w=>{var S,k,_;return{id:w.id,name:w.name,visibility:w.visibility||"private",organizationScope:((S=w.collectionAssignment)==null?void 0:S.organizationScope)!==!1,filters:(_=(k=w.collectionAssignment)==null?void 0:k.dataFilters)==null?void 0:_.filter(N=>N.collection===c)}}),conflictLevel:h,conflictReasons:n,recommendations:A})}return t.sort((c,l)=>{const h={high:4,medium:3,low:2,none:1};return h[l.conflictLevel]-h[c.conflictLevel]})}generateGlobalInsights(r,i){var n;const t=Object.entries(r).map(([A,w])=>({collection:A,count:w.length,datasets:w.map(S=>S.name)})).sort((A,w)=>w.count-A.count).slice(0,10),c=Object.entries(r).filter(([A,w])=>w.length>1).map(([A,w])=>w.some(k=>{var _,N;return(N=(_=k.collectionAssignment)==null?void 0:_.dataFilters)==null?void 0:N.some(ne=>ne.collection===A)})?null:{collection:A,reason:`Used by ${w.length} datasets without data filters - potential redundancy`,affectedDatasets:w.map(k=>k.name)}).filter(Boolean),l=[],h=[];return c.length>0&&h.push("Consider adding data filters to datasets with overlapping collections"),((n=t[0])==null?void 0:n.count)>3&&h.push(`Collection "${t[0].collection}" is heavily used - consider optimization`),i.length>10&&h.push("Large number of datasets detected - consider consolidation opportunities"),{mostUsedCollections:t,redundantAssignments:c,schemaConflicts:l,recommendations:h}}calculateHealthScore(r,i){let t=100;for(const c of r)switch(c.conflictLevel){case"high":t-=15;break;case"medium":t-=8;break;case"low":t-=3;break}return t-=i.redundantAssignments.length*5,t-=i.schemaConflicts.length*10,Math.max(0,Math.min(100,t))}assessOverlapConflictLevel(r,i){if(new Set(i.map(l=>l.visibility)).size>1)return"high";const c=i.some(l=>{var h,n;return(n=(h=l.collectionAssignment)==null?void 0:h.dataFilters)==null?void 0:n.some(A=>A.collection===r)});return!c&&i.length>2?"medium":!c&&i.length===2?"low":"none"}assessConflictLevel(r,i,t){var n,A;if(new Set(i.map(w=>w.visibility)).has("public")&&t.visibility!=="public")return"high";const l=i.some(w=>{var S,k;return(k=(S=w.collectionAssignment)==null?void 0:S.dataFilters)==null?void 0:k.some(_=>_.collection===r)}),h=(A=(n=t.collectionAssignment)==null?void 0:n.dataFilters)==null?void 0:A.some(w=>w.collection===r);return!l&&!h?i.length>1?"high":"medium":"low"}getConflictReasons(r,i){const t=[];return new Set(i.map(h=>h.visibility)).size>1&&t.push("Datasets have different visibility levels"),i.some(h=>{var n,A;return(A=(n=h.collectionAssignment)==null?void 0:n.dataFilters)==null?void 0:A.some(w=>w.collection===r)})||t.push("No data filters defined - potential data redundancy"),i.length>3&&t.push("Collection used by many datasets - consider consolidation"),t}getOverlapRecommendations(r,i){const t=[];return i.some(h=>{var n,A;return(A=(n=h.collectionAssignment)==null?void 0:n.dataFilters)==null?void 0:A.some(w=>w.collection===r)})||t.push("Add data filters to differentiate dataset purposes"),i.length>2&&t.push("Consider merging similar datasets to reduce redundancy"),new Set(i.map(h=>h.visibility)).size>1&&t.push("Standardize visibility levels across related datasets"),t}getConflictRecommendation(r,i,t){return i.some(l=>{var h,n;return(n=(h=l.collectionAssignment)==null?void 0:h.dataFilters)==null?void 0:n.some(A=>A.collection===r)})?i.length>2?`Consider merging with existing dataset "${i[0].name}"`:"Review existing usage to avoid data redundancy":"Add data filters to differentiate from existing datasets"}checkRedundancyPatterns(r,i){var l;const t=[],c=[];for(const h of i)if((l=h.collectionAssignment)!=null&&l.selectedCollections){const A=r.filter(w=>h.collectionAssignment.selectedCollections.includes(w)).length/r.length;A>.7&&(t.push({type:"redundancy",severity:"warning",message:`${Math.round(A*100)}% overlap with existing dataset "${h.name}"`,affectedCollections:r,affectedDatasets:[h.name],recommendation:"Consider extending the existing dataset instead of creating a new one"}),c.push({type:"merge",message:`Merge with "${h.name}" to avoid redundancy`,collections:r}))}return{warnings:t,suggestions:c}}checkPerformanceImplications(r,i){const t=[],c=["users","activities","sessions","audit_log"];return r.some(h=>c.includes(h))&&r.length>5&&t.push({type:"performance",severity:"info",message:"Dataset includes large collections - consider performance implications",affectedCollections:r.filter(h=>c.includes(h)),affectedDatasets:[],recommendation:"Add data filters or consider splitting into smaller datasets"}),t}};_e(cs,"instance");let Dt=cs;const Lt=Dt.getInstance(),fa={"Core System":{icon:"ðŸ‘¥",description:"User management, organizations, and core system data",collections:["users","teamMembers","organizations","roles","projects","projectTeamMembers","clients","contacts","test"]},"Sessions & Workflows":{icon:"ðŸŽ¬",description:"Production sessions, workflows, and task management",collections:["sessions","sessionWorkflows","sessionAssignments","sessionParticipants","workflowTemplates","workflowDiagrams","workflowInstances","workflowSteps","workflowAssignments","sessionPhaseTransitions","sessionReviews","sessionQc","sessionTasks","demoSessions"]},"Inventory & Equipment":{icon:"ðŸ“¦",description:"Equipment tracking, network management, and inventory systems",collections:["inventoryItems","inventory","networkIPAssignments","networkIPRanges","networks","inventoryHistory","setupProfiles","schemas","schemaFields","mapLayouts","mapLocations","inventoryMaps","mapData"]},"Timecards & Scheduling":{icon:"â°",description:"Time tracking, approvals, and scheduling systems",collections:["timecard_entries","user_timecards","timecard_approvals","timecard_templates"]},"Media & Content":{icon:"ðŸŽ¥",description:"Media files, production tasks, and content management",collections:["mediaFiles","postProductionTasks","stages","notes","reports","callSheets"]},"AI & Automation":{icon:"ðŸ¤–",description:"AI agents, messaging, and automated systems",collections:["aiAgents","messages","chats","messageSessions"]},"Business & Licensing":{icon:"ðŸ’¼",description:"Licenses, subscriptions, payments, and business data",collections:["licenses","subscriptions","payments","userPreferences"]},"Production Budget Management":{icon:"ðŸ’°",description:"Budget tracking, schedules, and financial management",collections:["pbmProjects","pbmSchedules","pbmPayscales","pbmDailyStatus"]}};Object.values(fa).flatMap(u=>u.collections);const ft=["Basic Information","Cloud Provider Selection","Authentication Setup","Storage Configuration","Collection Assignment","Advanced Options","Review & Create"],yt={name:"",description:"",visibility:"private",tags:[],cloudProvider:"firestore",authentication:{},storage:{backend:"firestore"},schema:{template:"custom",customFields:[]},collectionAssignment:{selectedCollections:[],includeSubcollections:!1,dataFilters:[],organizationScope:!0},advanced:{encryption:!1,compression:!1,backup:!0,versioning:!1,accessLogging:!1}},vr=ba.memo(({open:u,onClose:r,onSuccess:i,preselectedProvider:t,assignToProject:c})=>{var U;const[l,h]=g.useState(0),[n,A]=g.useState(yt),[w,S]=g.useState(!1),[k,_]=g.useState(null),[N,ne]=g.useState({}),[me,Ae]=g.useState({}),[ae,f]=g.useState(!1),[Y,ve]=g.useState(null),[X,pe]=g.useState(null),[Z,xe]=g.useState([]),[ee,ce]=g.useState(!1),T=g.useCallback(()=>{const y=t||"firestore",I=y==="azure-blob"?"azure":y;A({...yt,cloudProvider:y,storage:{...yt.storage,backend:I}}),h(0),_(null),ne({}),Ae({}),ve(null)},[t]);g.useEffect(()=>{u&&T()},[u,T]);const E=g.useCallback(y=>{A(H=>({...H,...y}));const I={...N};Object.keys(y).forEach(H=>{delete I[H]}),ne(I)},[N]),Q=g.useCallback(y=>{var H,K,V,ue,ke,Ne,p,P,v;const I={};switch(y){case 0:n.name.trim()||(I.name="Dataset name is required"),n.name.length>100&&(I.name="Dataset name must be 100 characters or less");break;case 1:n.cloudProvider||(I.cloudProvider="Please select a cloud provider");break;case 2:(n.cloudProvider==="firestore"||n.cloudProvider==="gcs")&&((H=n.authentication.projectId)!=null&&H.trim()||(I.projectId="Project ID is required for Google Cloud services")),(n.cloudProvider==="s3"||n.cloudProvider==="aws")&&((K=n.authentication.accessKeyId)!=null&&K.trim()||(I.accessKeyId="Access Key ID is required for AWS services"),(V=n.authentication.secretAccessKey)!=null&&V.trim()||(I.secretAccessKey="Secret Access Key is required for AWS services")),n.cloudProvider==="azure-blob"&&((ue=n.authentication.connectionString)!=null&&ue.trim()||(I.connectionString="Connection string is required for Azure services"));break;case 3:n.cloudProvider==="gcs"&&!((ke=n.storage.gcsBucket)!=null&&ke.trim())&&(I.gcsBucket="GCS bucket name is required"),n.cloudProvider==="s3"&&!((Ne=n.storage.s3Bucket)!=null&&Ne.trim())&&(I.s3Bucket="S3 bucket name is required"),n.cloudProvider==="azure-blob"&&!((p=n.storage.azureContainer)!=null&&p.trim())&&(I.azureContainer="Azure container name is required");break;case 4:n.cloudProvider==="firestore"&&((v=(P=n.collectionAssignment)==null?void 0:P.selectedCollections)!=null&&v.length||(I.collections="Please select at least one Firestore collection for this dataset"));break}return ne(I),Object.keys(I).length===0},[n]),$=g.useCallback(()=>{Q(l)&&h(y=>Math.min(y+1,ft.length-1))},[l,Q]),ie=g.useCallback(()=>{h(y=>Math.max(y-1,0))},[]),de=g.useCallback(y=>{y<l&&h(y)},[l]),Te=g.useCallback(y=>{Ae(I=>({...I,[y]:!I[y]}))},[]),Se=g.useCallback(async()=>{if(n.cloudProvider){f(!0),ve(null);try{await new Promise(y=>setTimeout(y,2e3)),ve({success:!0,message:"Connection test successful!"})}catch(y){ve({success:!1,message:`Connection test failed: ${y instanceof Error?y.message:"Unknown error"}`})}finally{f(!1)}}},[n.cloudProvider]),Ee=g.useCallback(async()=>{if(Q(l)){S(!0),_(null);try{const y=await re.createDataset({name:n.name,description:n.description,visibility:n.visibility,tags:n.tags,storage:n.storage,schema:n.schema,projectId:c||"default-project",collectionAssignment:n.cloudProvider==="firestore"?n.collectionAssignment:void 0});y?(i==null||i(y),r==null||r()):_("Failed to create dataset: No dataset returned")}catch(y){_(`Failed to create dataset: ${y instanceof Error?y.message:"Unknown error"}`)}finally{S(!1)}}},[l,Q,n,i,r]),we=g.useCallback(async()=>{try{const y=await re.listDatasets();xe(y),console.log("âœ… [DatasetCreationWizard] Loaded existing datasets for conflict analysis:",y.length)}catch(y){console.warn("âš ï¸ [DatasetCreationWizard] Failed to load existing datasets:",y),xe([])}},[]),Ie=g.useCallback(async()=>{var y,I;if(n.cloudProvider!=="firestore"||!((I=(y=n.collectionAssignment)==null?void 0:y.selectedCollections)!=null&&I.length)){pe(null);return}ce(!0);try{const H=await Lt.checkDatasetCreationConflicts({name:n.name,collectionAssignment:n.collectionAssignment},Z);pe(H),console.log("âœ… [DatasetCreationWizard] Conflict check complete:",H)}catch(H){console.error("âŒ [DatasetCreationWizard] Failed to check conflicts:",H),pe(null)}finally{ce(!1)}},[n.cloudProvider,n.name,n.collectionAssignment,Z]);g.useEffect(()=>{u&&we()},[u,we]),g.useEffect(()=>{var y,I;if(l===4&&((I=(y=n.collectionAssignment)==null?void 0:y.selectedCollections)!=null&&I.length)){const H=setTimeout(()=>{Ie()},500);return()=>clearTimeout(H)}},[l,(U=n.collectionAssignment)==null?void 0:U.selectedCollections,Ie]);const as=g.useCallback(y=>{var I,H,K,V,ue,ke,Ne,p,P,v,j,L,R,he;switch(y){case 0:return e.jsxs(o,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Basic Information"}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Dataset Name",value:n.name,onChange:C=>E({name:C.target.value}),error:!!N.name,helperText:N.name,required:!0})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Description (Optional)",value:n.description||"",onChange:C=>E({description:C.target.value}),multiline:!0,rows:3})}),e.jsx(x,{item:!0,xs:12,children:e.jsxs(Oe,{fullWidth:!0,children:[e.jsx(za,{children:"Visibility"}),e.jsxs(Ba,{value:n.visibility,onChange:C=>E({visibility:C.target.value}),row:!0,children:[e.jsx(Re,{value:"private",control:e.jsx(ht,{}),label:"Private"}),e.jsx(Re,{value:"organization",control:e.jsx(ht,{}),label:"Organization"}),e.jsx(Re,{value:"public",control:e.jsx(ht,{}),label:"Public"})]})]})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Tags (Optional)",value:((I=n.tags)==null?void 0:I.join(", "))||"",onChange:C=>E({tags:C.target.value.split(",").map(q=>q.trim()).filter(q=>q.length>0)}),placeholder:"tag1, tag2, tag3",helperText:"Comma-separated tags for organization"})})]})]});case 1:return e.jsxs(o,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Cloud Provider Selection"}),e.jsx(x,{container:!0,spacing:2,children:[{value:"firestore",label:"Firestore",icon:e.jsx(Ts,{}),description:"Google Cloud Firestore"},{value:"gcs",label:"Google Cloud Storage",icon:e.jsx(We,{}),description:"Google Cloud Storage"},{value:"s3",label:"Amazon S3",icon:e.jsx(Ts,{}),description:"Amazon S3"},{value:"aws",label:"AWS Services",icon:e.jsx(Ts,{}),description:"AWS Services"},{value:"azure-blob",label:"Azure Blob Storage",icon:e.jsx(We,{}),description:"Microsoft Azure"},{value:"local",label:"Local Storage",icon:e.jsx(Ct,{}),description:"Local file system"}].map(C=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(oe,{sx:{cursor:"pointer",border:n.cloudProvider===C.value?"2px solid":"1px solid",borderColor:n.cloudProvider===C.value?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>{const q=C.value,fe=q==="azure-blob"?"azure":q;E({cloudProvider:q,storage:{...n.storage,backend:fe}})},children:e.jsxs(be,{sx:{textAlign:"center",p:2},children:[e.jsx(o,{sx:{mb:1},children:C.icon}),e.jsx(a,{variant:"subtitle1",sx:{fontWeight:600},children:C.label}),e.jsx(a,{variant:"body2",color:"text.secondary",children:C.description})]})})},C.value))})]});case 2:return e.jsxs(o,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Authentication Setup"}),n.cloudProvider==="firestore"||n.cloudProvider==="gcs"?e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Project ID",value:n.authentication.projectId||"",onChange:C=>E({authentication:{...n.authentication,projectId:C.target.value}}),error:!!N.projectId,helperText:N.projectId,required:!0})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Service Account Key (Optional)",value:n.authentication.serviceAccountKey||"",onChange:C=>E({authentication:{...n.authentication,serviceAccountKey:C.target.value}}),multiline:!0,rows:4,placeholder:"Paste your service account JSON key here..."})})]}):n.cloudProvider==="s3"||n.cloudProvider==="aws"?e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Access Key ID",value:n.authentication.accessKeyId||"",onChange:C=>E({authentication:{...n.authentication,accessKeyId:C.target.value}}),error:!!N.accessKeyId,helperText:N.accessKeyId,required:!0})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Secret Access Key",value:n.authentication.secretAccessKey||"",onChange:C=>E({authentication:{...n.authentication,secretAccessKey:C.target.value}}),error:!!N.secretAccessKey,helperText:N.secretAccessKey,required:!0,type:me.secretAccessKey?"text":"password",InputProps:{endAdornment:e.jsx(ua,{position:"end",children:e.jsx(xs,{onClick:()=>Te("secretAccessKey"),edge:"end",children:me.secretAccessKey?e.jsx(Na,{}):e.jsx(ga,{})})})}})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Region",value:n.authentication.region||"",onChange:C=>E({authentication:{...n.authentication,region:C.target.value}}),placeholder:"us-east-1"})})]}):n.cloudProvider==="azure-blob"?e.jsx(x,{container:!0,spacing:3,children:e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Connection String",value:n.authentication.connectionString||"",onChange:C=>E({authentication:{...n.authentication,connectionString:C.target.value}}),error:!!N.connectionString,helperText:N.connectionString,required:!0,multiline:!0,rows:3,placeholder:"DefaultEndpointsProtocol=https;AccountName=..."})})}):e.jsx(a,{color:"text.secondary",children:"No authentication required for local storage."}),n.cloudProvider!=="local"&&e.jsxs(o,{sx:{mt:3},children:[e.jsx(G,{variant:"outlined",onClick:Se,disabled:ae,startIcon:ae?e.jsx(Ke,{size:16}):e.jsx(st,{}),children:ae?"Testing Connection...":"Test Connection"}),Y&&e.jsx(ge,{severity:Y.success?"success":"error",sx:{mt:2},children:Y.message})]})]});case 3:return e.jsxs(o,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Storage Configuration"}),n.cloudProvider==="gcs"&&e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"GCS Bucket Name",value:n.storage.gcsBucket||"",onChange:C=>E({storage:{...n.storage,gcsBucket:C.target.value}}),error:!!N.gcsBucket,helperText:N.gcsBucket,required:!0,placeholder:"my-dataset-bucket"})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Prefix (Optional)",value:n.storage.gcsPrefix||"",onChange:C=>E({storage:{...n.storage,gcsPrefix:C.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),n.cloudProvider==="s3"&&e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"S3 Bucket Name",value:n.storage.s3Bucket||"",onChange:C=>E({storage:{...n.storage,s3Bucket:C.target.value}}),error:!!N.s3Bucket,helperText:N.s3Bucket,required:!0,placeholder:"my-dataset-bucket"})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Region",value:n.storage.s3Region||"",onChange:C=>E({storage:{...n.storage,s3Region:C.target.value}}),placeholder:"us-east-1"})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Prefix (Optional)",value:n.storage.s3Prefix||"",onChange:C=>E({storage:{...n.storage,s3Prefix:C.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),n.cloudProvider==="azure-blob"&&e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Container Name",value:n.storage.azureContainer||"",onChange:C=>E({storage:{...n.storage,azureContainer:C.target.value}}),error:!!N.azureContainer,helperText:N.azureContainer,required:!0,placeholder:"datasets"})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,label:"Prefix (Optional)",value:n.storage.azurePrefix||"",onChange:C=>E({storage:{...n.storage,azurePrefix:C.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),n.cloudProvider==="local"&&e.jsx(a,{color:"text.secondary",children:"Local storage will be configured automatically based on your system settings."}),e.jsxs(ge,{severity:"info",sx:{mt:3},children:[e.jsx(a,{variant:"subtitle2",sx:{fontWeight:600,mb:.5},children:"Using Backbone Logic Unified Schema"}),e.jsx(a,{variant:"body2",children:"The standard Backbone Logic schema will be automatically applied to this dataset. This ensures full compatibility with all application features and provides a consistent data structure."})]})]});case 4:return e.jsxs(o,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Collection Assignment"}),n.cloudProvider==="firestore"?e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsx(ge,{severity:"info",sx:{mb:2},children:e.jsx(a,{variant:"body2",children:"Select which Firestore collections this dataset should include. Data will be automatically scoped to your organization for security."})})}),e.jsx(x,{item:!0,xs:12,children:e.jsxs(o,{sx:{mb:2},children:[e.jsx(a,{variant:"subtitle2",sx:{color:"white",mb:2},children:"Select Collections by Category"}),Object.entries(fa).map(([C,q])=>e.jsxs(o,{sx:{mb:3},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:1,p:1,bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:1,border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx(a,{sx:{fontSize:"1.2rem"},children:q.icon}),e.jsxs(o,{children:[e.jsx(a,{variant:"subtitle2",sx:{color:"white",fontWeight:600},children:C}),e.jsx(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:q.description})]})]}),e.jsx(o,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:1,pl:2},children:q.collections.map(fe=>{var Ms,ks;const ye=((ks=(Ms=n.collectionAssignment)==null?void 0:Ms.selectedCollections)==null?void 0:ks.includes(fe))||!1;return e.jsx(o,{onClick:()=>{var Ye,rs,ms,hs;const _s=((Ye=n.collectionAssignment)==null?void 0:Ye.selectedCollections)||[],Os=ye?_s.filter($e=>$e!==fe):[..._s,fe];E({collectionAssignment:{...n.collectionAssignment,selectedCollections:Os,includeSubcollections:((rs=n.collectionAssignment)==null?void 0:rs.includeSubcollections)||!1,dataFilters:((ms=n.collectionAssignment)==null?void 0:ms.dataFilters)||[],organizationScope:((hs=n.collectionAssignment)==null?void 0:hs.organizationScope)!==!1}})},sx:{p:1.5,border:ye?"2px solid #8b5cf6":"1px solid rgba(255, 255, 255, 0.2)",borderRadius:1,bgcolor:ye?"rgba(139, 92, 246, 0.1)":"rgba(255, 255, 255, 0.02)",cursor:"pointer",transition:"all 0.2s ease","&:hover":{bgcolor:ye?"rgba(139, 92, 246, 0.2)":"rgba(255, 255, 255, 0.05)",borderColor:ye?"#8b5cf6":"rgba(255, 255, 255, 0.4)",transform:"translateY(-1px)"}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(We,{fontSize:"small",sx:{color:ye?"#8b5cf6":"rgba(255, 255, 255, 0.7)"}}),e.jsx(a,{variant:"body2",sx:{color:ye?"#8b5cf6":"white",fontWeight:ye?600:400,fontSize:"0.85rem"},children:fe}),ye&&e.jsx(st,{fontSize:"small",sx:{color:"#8b5cf6",ml:"auto"}})]})},fe)})})]},C))]})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(Re,{control:e.jsx(Pe,{checked:((H=n.collectionAssignment)==null?void 0:H.includeSubcollections)||!1,onChange:C=>{var q,fe,ye;return E({collectionAssignment:{selectedCollections:((q=n.collectionAssignment)==null?void 0:q.selectedCollections)||[],includeSubcollections:C.target.checked,dataFilters:((fe=n.collectionAssignment)==null?void 0:fe.dataFilters)||[],organizationScope:((ye=n.collectionAssignment)==null?void 0:ye.organizationScope)||!1}})}}),label:"Include Subcollections"})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(Re,{control:e.jsx(Pe,{checked:((K=n.collectionAssignment)==null?void 0:K.organizationScope)!==!1,onChange:C=>{var q,fe,ye;return E({collectionAssignment:{selectedCollections:((q=n.collectionAssignment)==null?void 0:q.selectedCollections)||[],includeSubcollections:((fe=n.collectionAssignment)==null?void 0:fe.includeSubcollections)||!1,dataFilters:((ye=n.collectionAssignment)==null?void 0:ye.dataFilters)||[],organizationScope:C.target.checked}})}}),label:"Organization Scoped Data (Recommended for Multi-Tenancy)"})}),(((ue=(V=n.collectionAssignment)==null?void 0:V.selectedCollections)==null?void 0:ue.length)||0)>0&&e.jsxs(x,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Selected Collections Preview:"}),e.jsx(Be,{sx:{p:2,bgcolor:"grey.50"},children:(Ne=(ke=n.collectionAssignment)==null?void 0:ke.selectedCollections)==null?void 0:Ne.map(C=>{var q;return e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(qe,{fontSize:"small",color:"primary"}),e.jsxs(a,{variant:"body2",children:[C,((q=n.collectionAssignment)==null?void 0:q.organizationScope)&&e.jsx(W,{label:"Org Scoped",size:"small",color:"primary",sx:{ml:1,height:20}})]})]},C)})})]}),ee&&e.jsx(x,{item:!0,xs:12,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:1},children:[e.jsx(Ke,{size:20}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Analyzing collection conflicts..."})]})}),X&&(X.warnings.length>0||X.suggestions.length>0)&&e.jsx(x,{item:!0,xs:12,children:e.jsxs(o,{sx:{mt:2},children:[e.jsxs(a,{variant:"subtitle2",gutterBottom:!0,sx:{color:"white",display:"flex",alignItems:"center",gap:1},children:[e.jsx(Nt,{fontSize:"small",color:"warning"}),"Smart Analysis Results"]}),X.warnings.map((C,q)=>e.jsx(ge,{severity:C.severity,sx:{mb:1,bgcolor:"rgba(255, 255, 255, 0.05)"},children:e.jsxs(o,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:.5},children:C.message}),C.affectedDatasets.length>0&&e.jsxs(a,{variant:"caption",sx:{display:"block",mb:.5},children:["Affected datasets: ",C.affectedDatasets.join(", ")]}),e.jsxs(a,{variant:"caption",sx:{fontStyle:"italic"},children:["ðŸ’¡ ",C.recommendation]})]})},q)),X.suggestions.length>0&&e.jsxs(o,{sx:{mt:2},children:[e.jsx(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)",display:"block",mb:1},children:"ðŸ’¡ Smart Suggestions:"}),X.suggestions.map((C,q)=>e.jsx(Be,{sx:{p:2,mb:1,bgcolor:"rgba(79, 70, 229, 0.1)",border:"1px solid rgba(79, 70, 229, 0.3)"},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{label:C.type.toUpperCase(),size:"small",sx:{bgcolor:"rgba(79, 70, 229, 0.2)",color:"#8b5cf6",fontWeight:600,fontSize:"0.65rem"}}),e.jsx(a,{variant:"body2",sx:{color:"white"},children:C.message})]})},q))]}),X.hasConflicts&&e.jsx(ge,{severity:"error",sx:{mt:2,bgcolor:"rgba(239, 68, 68, 0.1)"},children:e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"âš ï¸ High-priority conflicts detected. Please review and resolve before proceeding."})})]})})]}):e.jsx(ge,{severity:"warning",children:"Collection assignment is only available for Firestore datasets. Please select Firestore as your cloud provider to configure collection assignment."})]});case 5:return e.jsxs(o,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Advanced Options"}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(Re,{control:e.jsx(Pe,{checked:((p=n.advanced)==null?void 0:p.encryption)||!1,onChange:C=>E({advanced:{...n.advanced,encryption:C.target.checked}})}),label:"Enable Encryption"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(Re,{control:e.jsx(Pe,{checked:((P=n.advanced)==null?void 0:P.compression)||!1,onChange:C=>E({advanced:{...n.advanced,compression:C.target.checked}})}),label:"Enable Compression"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(Re,{control:e.jsx(Pe,{checked:((v=n.advanced)==null?void 0:v.backup)||!1,onChange:C=>E({advanced:{...n.advanced,backup:C.target.checked}})}),label:"Enable Backup"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(Re,{control:e.jsx(Pe,{checked:((j=n.advanced)==null?void 0:j.versioning)||!1,onChange:C=>E({advanced:{...n.advanced,versioning:C.target.checked}})}),label:"Enable Versioning"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(Re,{control:e.jsx(Pe,{checked:((L=n.advanced)==null?void 0:L.accessLogging)||!1,onChange:C=>E({advanced:{...n.advanced,accessLogging:C.target.checked}})}),label:"Enable Access Logging"})})]})]});case 6:return e.jsxs(o,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Review & Create"}),e.jsxs(Be,{sx:{p:3,mb:3},children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Dataset Configuration Summary"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Name: ",e.jsx("strong",{children:n.name})]})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Provider: ",e.jsx("strong",{children:n.cloudProvider})]})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Visibility: ",e.jsx("strong",{children:n.visibility})]})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Schema: ",e.jsx("strong",{children:"Backbone Logic Unified Schema"})]})}),n.cloudProvider==="firestore"&&((he=(R=n.collectionAssignment)==null?void 0:R.selectedCollections)==null?void 0:he.length)&&e.jsxs(x,{item:!0,xs:12,children:[e.jsx(a,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.jsx("strong",{children:"Assigned Collections:"})}),e.jsx(o,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mt:1},children:n.collectionAssignment.selectedCollections.map(C=>e.jsx(W,{label:C,size:"small",color:"primary",icon:e.jsx(qe,{})},C))}),n.collectionAssignment.organizationScope&&e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"âœ“ Data will be automatically scoped to your organization for security"})]})]})]}),e.jsx(ge,{severity:"info",children:"Please review your configuration before creating the dataset. You can go back to any step to make changes."})]});default:return null}},[n,N,me,E,Te,Se]);return g.useMemo(()=>u?e.jsxs(Ze,{open:u,onClose:r,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)",maxHeight:"90vh"}},children:[e.jsxs(es,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"background.paper",borderBottom:"1px solid",borderColor:"divider",pb:2},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(qe,{color:"primary"}),e.jsx(a,{variant:"h6",sx:{fontWeight:600},children:"Create Dataset"})]}),e.jsx(xs,{onClick:r,size:"small",children:e.jsx(Es,{})})]}),e.jsxs(ss,{sx:{p:3},children:[k&&e.jsx(ge,{severity:"error",sx:{mb:3},children:k}),e.jsx(ma,{activeStep:l,orientation:"horizontal",sx:{mb:3},children:ft.map((y,I)=>e.jsx(ha,{children:e.jsx(pa,{onClick:()=>de(I),sx:{cursor:"pointer"},children:y})},y))}),as(l),w&&e.jsx(La,{sx:{mt:2}})]}),e.jsxs(ts,{sx:{px:3,pb:3,pt:2,backgroundColor:"background.paper",borderTop:"1px solid",borderColor:"divider",justifyContent:"space-between"},children:[e.jsx(G,{onClick:r,variant:"outlined",disabled:w,sx:{borderColor:"primary.main",color:"primary.main"},children:"Cancel"}),e.jsxs(o,{sx:{display:"flex",gap:1},children:[e.jsx(G,{onClick:ie,disabled:l===0||w,variant:"outlined",children:"Back"}),l===ft.length-1?e.jsx(G,{onClick:Ee,variant:"contained",disabled:w||!n.name.trim(),startIcon:e.jsx(As,{}),sx:{backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:w?"Creating Dataset...":"Create Dataset"}):e.jsx(G,{onClick:$,variant:"contained",disabled:w,children:"Next"})]})]})]}):null,[u,r,n,l,w,k,N,me,ae,Y,ie,$,de,Ee,as])}),ya={"Core System":{icon:"ðŸ‘¥",description:"User management, organizations, and core system data",collections:["users","teamMembers","organizations","roles","projects","projectTeamMembers","clients","contacts","test"]},"Sessions & Workflows":{icon:"ðŸŽ¬",description:"Production sessions, workflows, and task management",collections:["sessions","sessionWorkflows","sessionAssignments","sessionParticipants","workflowTemplates","workflowDiagrams","workflowInstances","workflowSteps","workflowAssignments","sessionPhaseTransitions","sessionReviews","sessionQc","sessionTasks","demoSessions"]},"Inventory & Equipment":{icon:"ðŸ“¦",description:"Equipment tracking, network management, and inventory systems",collections:["inventoryItems","inventory","networkIPAssignments","networkIPRanges","networks","inventoryHistory","setupProfiles","schemas","schemaFields","mapLayouts","mapLocations","inventoryMaps","mapData"]},"Timecards & Scheduling":{icon:"â°",description:"Time tracking, approvals, and scheduling systems",collections:["timecard_entries","user_timecards","timecard_approvals","timecard_templates"]},"Media & Content":{icon:"ðŸŽ¥",description:"Media files, production tasks, and content management",collections:["mediaFiles","postProductionTasks","stages","notes","reports","callSheets"]},"AI & Automation":{icon:"ðŸ¤–",description:"AI agents, messaging, and automated systems",collections:["aiAgents","messages","chats","messageSessions"]},"Business & Licensing":{icon:"ðŸ’¼",description:"Licenses, subscriptions, payments, and business data",collections:["licenses","subscriptions","payments","userPreferences"]},"Production Budget Management":{icon:"ðŸ’°",description:"Budget tracking, schedules, and financial management",collections:["pbmProjects","pbmSchedules","pbmPayscales","pbmDailyStatus"]}};Object.values(ya).flatMap(u=>u.collections);const Cr=({open:u,onClose:r,dataset:i,onDatasetUpdated:t,existingDatasets:c=[]})=>{var pe,Z,xe,ee,ce;const[l,h]=g.useState({}),[n,A]=g.useState(!1),[w,S]=g.useState(null),[k,_]=g.useState({}),[N,ne]=g.useState(null),[me,Ae]=g.useState(!1);g.useEffect(()=>{i&&u&&(h({name:i.name,description:i.description,visibility:i.visibility,tags:i.tags||[],collectionAssignment:i.collectionAssignment||{selectedCollections:[],includeSubcollections:!1,dataFilters:[],organizationScope:!0}}),S(null),_({}),ne(null))},[i,u]);const ae=g.useCallback(T=>{h(E=>({...E,...T}))},[]),f=g.useCallback(async()=>{var T,E;if(!i||!((E=(T=l.collectionAssignment)==null?void 0:T.selectedCollections)!=null&&E.length)){ne(null);return}Ae(!0);try{const Q=c.filter(ie=>ie.id!==i.id),$=await Lt.checkDatasetCreationConflicts({name:l.name||i.name,collectionAssignment:l.collectionAssignment},Q);ne($),console.log("âœ… [EditDatasetDialog] Conflict check complete:",$)}catch(Q){console.error("âŒ [EditDatasetDialog] Failed to check conflicts:",Q),ne(null)}finally{Ae(!1)}},[i,l.name,l.collectionAssignment,c]);g.useEffect(()=>{var T,E;if(u&&((E=(T=l.collectionAssignment)==null?void 0:T.selectedCollections)!=null&&E.length)){const Q=setTimeout(()=>{f()},500);return()=>clearTimeout(Q)}},[u,(pe=l.collectionAssignment)==null?void 0:pe.selectedCollections,f]);const Y=g.useCallback(()=>{var E,Q,$,ie;const T={};return(E=l.name)!=null&&E.trim()||(T.name="Dataset name is required"),((Q=i==null?void 0:i.storage)==null?void 0:Q.backend)==="firestore"&&!((ie=($=l.collectionAssignment)==null?void 0:$.selectedCollections)!=null&&ie.length)&&(T.collections="At least one collection must be selected for Firestore datasets"),_(T),Object.keys(T).length===0},[l,i]),ve=g.useCallback(async()=>{if(!(!i||!Y())){if(N!=null&&N.hasConflicts){S("Please resolve high-priority conflicts before saving");return}A(!0),S(null);try{console.log("ðŸ’¾ [EditDatasetDialog] Saving dataset updates:",l);const T=await re.updateDataset(i.id,{name:l.name,description:l.description,visibility:l.visibility,tags:l.tags,collectionAssignment:l.collectionAssignment});T?(console.log("âœ… [EditDatasetDialog] Dataset updated successfully"),t==null||t(T),r()):S("Failed to update dataset: No response from server")}catch(T){console.error("âŒ [EditDatasetDialog] Failed to update dataset:",T),S(`Failed to update dataset: ${T instanceof Error?T.message:"Unknown error"}`)}finally{A(!1)}}},[i,l,Y,N,t,r]),X=g.useCallback(T=>{var E,Q,$;ae({collectionAssignment:{...l.collectionAssignment,selectedCollections:T,includeSubcollections:((E=l.collectionAssignment)==null?void 0:E.includeSubcollections)||!1,dataFilters:((Q=l.collectionAssignment)==null?void 0:Q.dataFilters)||[],organizationScope:(($=l.collectionAssignment)==null?void 0:$.organizationScope)!==!1}})},[l.collectionAssignment,ae]);return i?e.jsxs(Ze,{open:u,onClose:r,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",maxHeight:"90vh"}},children:[e.jsxs(es,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",pb:2,display:"flex",alignItems:"center",gap:2},children:[e.jsx(zt,{sx:{color:"#8b5cf6"}}),e.jsxs(o,{children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600},children:"Edit Dataset"}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Update dataset information and collection assignments"})]})]}),e.jsxs(ss,{sx:{p:3,overflow:"auto"},children:[w&&e.jsx(ge,{severity:"error",sx:{mb:3,bgcolor:"rgba(239, 68, 68, 0.1)"},children:w}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,children:e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ds,{color:"primary"}),"Basic Information"]})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(te,{fullWidth:!0,label:"Dataset Name",value:l.name||"",onChange:T=>ae({name:T.target.value}),error:!!k.name,helperText:k.name,sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#8b5cf6"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)"}}})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(Oe,{fullWidth:!0,children:[e.jsx(Le,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Visibility"}),e.jsxs(Fe,{value:l.visibility||"private",onChange:T=>ae({visibility:T.target.value}),sx:{color:"white","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#8b5cf6"}},children:[e.jsx(M,{value:"private",children:"Private"}),e.jsx(M,{value:"organization",children:"Organization"}),e.jsx(M,{value:"public",children:"Public"})]})]})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(te,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:l.description||"",onChange:T=>ae({description:T.target.value}),sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#8b5cf6"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)"}}})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(Fa,{multiple:!0,freeSolo:!0,options:[],value:l.tags||[],onChange:(T,E)=>ae({tags:E}),renderTags:(T,E)=>T.map((Q,$)=>e.jsx(W,{variant:"outlined",label:Q,...E({index:$}),sx:{color:"white",borderColor:"rgba(255, 255, 255, 0.3)"}})),renderInput:T=>e.jsx(te,{...T,label:"Tags",placeholder:"Add tags...",sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"},"&.Mui-focused fieldset":{borderColor:"#8b5cf6"}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)"}}})})}),((Z=i.storage)==null?void 0:Z.backend)==="firestore"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{item:!0,xs:12,children:[e.jsx(St,{sx:{my:2,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(We,{color:"primary"}),"Collection Assignment"]})]}),e.jsx(x,{item:!0,xs:12,children:e.jsxs(o,{sx:{mb:2},children:[e.jsx(a,{variant:"subtitle2",sx:{color:"white",mb:2},children:"Select Collections by Category"}),k.collections&&e.jsx(ge,{severity:"error",sx:{mb:2,bgcolor:"rgba(239, 68, 68, 0.1)"},children:k.collections}),Object.entries(ya).map(([T,E])=>e.jsxs(o,{sx:{mb:3},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:1,p:1,bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:1,border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx(a,{sx:{fontSize:"1.2rem"},children:E.icon}),e.jsxs(o,{children:[e.jsx(a,{variant:"subtitle2",sx:{color:"white",fontWeight:600},children:T}),e.jsx(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:E.description})]})]}),e.jsx(o,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:1,pl:2},children:E.collections.map(Q=>{var ie,de;const $=((de=(ie=l.collectionAssignment)==null?void 0:ie.selectedCollections)==null?void 0:de.includes(Q))||!1;return e.jsx(o,{onClick:()=>{var Ee;const Te=((Ee=l.collectionAssignment)==null?void 0:Ee.selectedCollections)||[],Se=$?Te.filter(we=>we!==Q):[...Te,Q];X(Se)},sx:{p:1.5,border:$?"2px solid #8b5cf6":"1px solid rgba(255, 255, 255, 0.2)",borderRadius:1,bgcolor:$?"rgba(139, 92, 246, 0.1)":"rgba(255, 255, 255, 0.02)",cursor:"pointer",transition:"all 0.2s ease","&:hover":{bgcolor:$?"rgba(139, 92, 246, 0.2)":"rgba(255, 255, 255, 0.05)",borderColor:$?"#8b5cf6":"rgba(255, 255, 255, 0.4)",transform:"translateY(-1px)"}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(We,{fontSize:"small",sx:{color:$?"#8b5cf6":"rgba(255, 255, 255, 0.7)"}}),e.jsx(a,{variant:"body2",sx:{color:$?"#8b5cf6":"white",fontWeight:$?600:400,fontSize:"0.85rem"},children:Q}),$&&e.jsx(Bt,{fontSize:"small",sx:{color:"#8b5cf6",ml:"auto"}})]})},Q)})})]},T))]})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(Re,{control:e.jsx(Pe,{checked:((xe=l.collectionAssignment)==null?void 0:xe.organizationScope)!==!1,onChange:T=>{var E,Q,$;return ae({collectionAssignment:{...l.collectionAssignment,organizationScope:T.target.checked,selectedCollections:((E=l.collectionAssignment)==null?void 0:E.selectedCollections)||[],includeSubcollections:((Q=l.collectionAssignment)==null?void 0:Q.includeSubcollections)||!1,dataFilters:(($=l.collectionAssignment)==null?void 0:$.dataFilters)||[]}})},sx:{color:"#8b5cf6"}}),label:e.jsxs(o,{children:[e.jsx(a,{variant:"body2",sx:{color:"white"},children:"Organization Scoped Data"}),e.jsx(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Automatically filter data to current organization for multi-tenant isolation"})]})})}),((ce=(ee=l.collectionAssignment)==null?void 0:ee.selectedCollections)==null?void 0:ce.length)>0&&e.jsx(x,{item:!0,xs:12,children:e.jsxs(Be,{sx:{p:2,bgcolor:"rgba(139, 92, 246, 0.1)",border:"1px solid rgba(139, 92, 246, 0.3)"},children:[e.jsxs(a,{variant:"subtitle2",sx:{mb:1,color:"white"},children:["Selected Collections (",l.collectionAssignment.selectedCollections.length,")"]}),l.collectionAssignment.selectedCollections.map(T=>{var E;return e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(qe,{fontSize:"small",color:"primary"}),e.jsxs(a,{variant:"body2",sx:{color:"white"},children:[T,((E=l.collectionAssignment)==null?void 0:E.organizationScope)&&e.jsx(W,{label:"Org Scoped",size:"small",color:"primary",sx:{ml:1,height:20}})]})]},T)})]})}),me&&e.jsx(x,{item:!0,xs:12,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,p:2,bgcolor:"rgba(255, 255, 255, 0.05)",borderRadius:1},children:[e.jsx(Ke,{size:20}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Analyzing collection conflicts..."})]})}),N&&(N.warnings.length>0||N.suggestions.length>0)&&e.jsx(x,{item:!0,xs:12,children:e.jsx(oe,{sx:{bgcolor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(be,{children:[e.jsxs(a,{variant:"subtitle2",gutterBottom:!0,sx:{color:"white",display:"flex",alignItems:"center",gap:1},children:[e.jsx(Nt,{fontSize:"small",color:"warning"}),"Smart Analysis Results"]}),N.warnings.map((T,E)=>e.jsxs(ge,{severity:T.severity,sx:{mb:1,bgcolor:"rgba(255, 255, 255, 0.05)"},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:T.message}),e.jsxs(a,{variant:"caption",sx:{fontStyle:"italic",display:"block",mt:.5},children:["ðŸ’¡ ",T.recommendation]})]},E)),N.suggestions.map((T,E)=>e.jsx(ge,{severity:"info",sx:{mb:1,bgcolor:"rgba(79, 70, 229, 0.1)"},children:e.jsxs(a,{variant:"body2",children:[e.jsxs("strong",{children:[T.type.toUpperCase(),":"]})," ",T.message]})},E))]})})})]})]})]}),e.jsxs(ts,{sx:{p:3,borderTop:"1px solid rgba(255, 255, 255, 0.1)",justifyContent:"space-between"},children:[e.jsx(G,{onClick:r,variant:"outlined",startIcon:e.jsx(Ua,{}),sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Cancel"}),e.jsx(G,{onClick:ve,variant:"contained",startIcon:n?e.jsx(Ke,{size:16}):e.jsx(Wa,{}),disabled:n||(N==null?void 0:N.hasConflicts),sx:{bgcolor:"#8b5cf6","&:hover":{bgcolor:"#7c3aed"},"&:disabled":{bgcolor:"rgba(139, 92, 246, 0.3)",color:"rgba(255, 255, 255, 0.5)"}},children:n?"Saving...":"Save Changes"})]})]}):null};var Ce=(u=>(u.ADMIN="ADMIN",u.GUEST="GUEST",u.MANAGER="MANAGER",u.EXEC="EXEC",u.POST_COORDINATOR="POST_COORDINATOR",u.POST_PRODUCTION_SUPERVISOR="POST_PRODUCTION_SUPERVISOR",u.MEDIA_MANAGER="MEDIA_MANAGER",u.PRODUCER="PRODUCER",u.ASSOCIATE_PRODUCER="ASSOCIATE_PRODUCER",u.POST_PRODUCER="POST_PRODUCER",u.LINE_PRODUCER="LINE_PRODUCER",u.KEYNOTE_PRODUCER="KEYNOTE_PRODUCER",u.KEYNOTE_PROD="KEYNOTE_PROD",u.PRODUCTION_ASSISTANT="PRODUCTION_ASSISTANT",u.POST_PA="POST_PA",u.DIRECTOR="DIRECTOR",u.ART_DIRECTOR="ART_DIRECTOR",u.ASSIST_DIRECTOR="ASSIST_DIRECTOR",u.EDITOR="EDITOR",u.ASSISTANT_EDITOR="ASSISTANT_EDITOR",u.CAMERA_OPERATOR="CAMERA_OPERATOR",u.SOUND_ENGINEER="SOUND_ENGINEER",u.LIGHTING_TECHNICIAN="LIGHTING_TECHNICIAN",u.DIT="DIT",u.TECH="TECH",u.NETWORKING="NETWORKING",u.COLORIST="COLORIST",u.AUDIO_PRODUCTION="AUDIO_PRODUCTION",u.AUDIO_POST="AUDIO_POST",u.GFX_ARTIST="GFX_ARTIST",u.KEYNOTE_POST="KEYNOTE_POST",u.QC_SPECIALIST="QC_SPECIALIST",u))(Ce||{});const Sr={FILM_TV:[{id:"executive-producer",name:"EXECUTIVE_PRODUCER",displayName:"Executive Producer",description:"Oversees entire production from development to distribution, manages financing and high-level creative decisions",industry:"FILM_TV",eventTypes:["FEATURE_FILM","TV_SERIES","DOCUMENTARY"],category:"Executive Leadership",hierarchy:95,baseRole:Ce.EXEC,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0,manage_post_tasks:!0,access_media_library:!0},postProduction:{manage_tasks:!0,assign_post_roles:!0,approve_final_cuts:!0,manage_review_cycles:!0,access_color_tools:!0,manage_audio_tools:!0,export_final_media:!0},userManagement:{create_users:!0,edit_users:!0,delete_users:!0,manage_roles:!0,assign_permissions:!0,view_user_activity:!0},system:{access_settings:!0,manage_integrations:!0,view_system_logs:!0,manage_ai_agents:!0},reports:{create_reports:!0,edit_reports:!0,delete_reports:!0,access_analytics:!0,export_reports:!0,manage_templates:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Secure financing and manage budgets","Oversee creative vision and final approval","Manage distribution and marketing strategy","Coordinate with studios and investors","Ensure legal compliance and contracts"],requiredSkills:["Leadership","Finance","Negotiation","Strategic Planning","Industry Knowledge"],reportingStructure:{manages:["Producer","Line Producer","Director"]},tags:["executive","finance","leadership","strategy","high-level"],isPopular:!0,usageCount:450,icon:"ðŸ‘‘",color:"#1a237e",salaryRange:{min:15e4,max:5e5,currency:"USD"},experienceLevel:"Executive"},{id:"showrunner",name:"SHOWRUNNER",displayName:"Showrunner",description:"Head writer and executive producer for TV series, manages creative direction and day-to-day operations",industry:"FILM_TV",eventTypes:["TV_SERIES"],category:"Creative Leadership",hierarchy:90,baseRole:Ce.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0,manage_post_tasks:!0,access_media_library:!0},postProduction:{manage_tasks:!0,assign_post_roles:!0,approve_final_cuts:!0,manage_review_cycles:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Oversee writing room and story development","Manage creative vision for entire series","Coordinate with network executives","Supervise all aspects of production","Ensure continuity across episodes"],requiredSkills:["Writing","Leadership","Creative Vision","Team Management","Industry Knowledge"],reportingStructure:{reportsTo:"Executive Producer",manages:["Writer","Director","Producer"]},tags:["creative","writing","tv","leadership","storytelling"],isPopular:!0,usageCount:280,icon:"ðŸ“",color:"#3f51b5",salaryRange:{min:2e5,max:1e6,currency:"USD"},experienceLevel:"Executive"},{id:"cinematographer-dp",name:"CINEMATOGRAPHER_DP",displayName:"Cinematographer (Director of Photography)",description:"Responsible for visual storytelling, camera work, lighting design, and overall visual aesthetic",industry:"FILM_TV",eventTypes:["FEATURE_FILM","TV_SERIES","COMMERCIAL","MUSIC_VIDEO"],category:"Creative Technical",hierarchy:75,baseRole:Ce.CAMERA_OPERATOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,access_media_library:!0},postProduction:{access_color_tools:!0,manage_review_cycles:!0},inventory:{create_assets:!0,edit_assets:!0,manage_checkouts:!0,view_asset_reports:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Design visual style and cinematography","Manage camera department and equipment","Collaborate with director on visual storytelling","Oversee lighting design and execution","Ensure technical quality of footage"],requiredSkills:["Cinematography","Lighting","Camera Operation","Visual Storytelling","Technical Expertise"],reportingStructure:{reportsTo:"Director",manages:["Camera Operator","Gaffer","1st AC","2nd AC"]},tags:["cinematography","visual","camera","lighting","technical"],isPopular:!0,usageCount:890,icon:"ðŸ“¹",color:"#795548",salaryRange:{min:8e4,max:3e5,currency:"USD"},experienceLevel:"Senior"}],CORPORATE_EVENTS:[{id:"event-director",name:"EVENT_DIRECTOR",displayName:"Event Director",description:"Oversees all aspects of corporate event planning, execution, and management",industry:"CORPORATE_EVENTS",eventTypes:["CONFERENCE","TRADE_SHOW","PRODUCT_LAUNCH","CORPORATE_VIDEO"],category:"Event Leadership",hierarchy:85,baseRole:Ce.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Develop event strategy and objectives","Manage event budget and resources","Coordinate with vendors and stakeholders","Oversee event logistics and execution","Ensure ROI and success metrics"],requiredSkills:["Event Planning","Project Management","Budget Management","Vendor Relations","Strategic Planning"],reportingStructure:{manages:["Event Coordinator","AV Technician","Registration Manager"]},tags:["events","corporate","planning","management","strategy"],isPopular:!0,usageCount:650,icon:"ðŸŽ¯",color:"#1976d2",salaryRange:{min:7e4,max:15e4,currency:"USD"},experienceLevel:"Senior"},{id:"av-production-manager",name:"AV_PRODUCTION_MANAGER",displayName:"AV Production Manager",description:"Manages all audio-visual aspects of corporate events including streaming, recording, and live production",industry:"CORPORATE_EVENTS",eventTypes:["CONFERENCE","WEBINAR","VIRTUAL_EVENT","PRODUCT_LAUNCH"],category:"Technical Production",hierarchy:70,baseRole:Ce.TECH,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,access_media_library:!0},postProduction:{manage_tasks:!0,access_color_tools:!0,manage_audio_tools:!0,export_final_media:!0},inventory:{create_assets:!0,edit_assets:!0,manage_checkouts:!0,manage_ip_addresses:!0},system:{access_settings:!0,manage_integrations:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Design and implement AV systems","Manage live streaming and recording","Coordinate technical rehearsals","Troubleshoot technical issues","Ensure broadcast quality standards"],requiredSkills:["AV Technology","Live Streaming","Technical Troubleshooting","Equipment Management","Broadcast Standards"],reportingStructure:{reportsTo:"Event Director",manages:["AV Technician","Camera Operator","Audio Engineer"]},tags:["av","technical","streaming","production","broadcast"],isPopular:!0,usageCount:520,icon:"ðŸŽ›ï¸",color:"#546e7a",salaryRange:{min:55e3,max:12e4,currency:"USD"},experienceLevel:"Mid"}],LIVE_EVENTS:[{id:"concert-director",name:"CONCERT_DIRECTOR",displayName:"Concert Director",description:"Oversees creative and technical direction for live concert productions and music events",industry:"LIVE_EVENTS",eventTypes:["CONCERT","FESTIVAL","AWARDS_SHOW"],category:"Live Production",hierarchy:88,baseRole:Ce.DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},automation:{view_all_sessions:!0,view_all_alerts:!0,manage_automation:!0,configure_settings:!0},system:{access_settings:!0,manage_integrations:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Direct live concert performances","Coordinate with artists and management","Oversee stage design and production","Manage live broadcast elements","Ensure audience experience quality"],requiredSkills:["Live Direction","Music Industry Knowledge","Stage Production","Artist Relations","Broadcast Direction"],reportingStructure:{manages:["Stage Manager","Technical Director","Lighting Designer"]},tags:["concert","live","music","performance","broadcast"],isPopular:!0,usageCount:380,icon:"ðŸŽ¤",color:"#d32f2f",salaryRange:{min:8e4,max:25e4,currency:"USD"},experienceLevel:"Senior"},{id:"festival-producer",name:"FESTIVAL_PRODUCER",displayName:"Festival Producer",description:"Manages multi-day festival productions including logistics, talent coordination, and audience experience",industry:"LIVE_EVENTS",eventTypes:["FESTIVAL","CONCERT"],category:"Festival Management",hierarchy:82,baseRole:Ce.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Coordinate multiple stages and venues","Manage artist logistics and hospitality","Oversee festival operations and security","Coordinate with local authorities","Ensure festival brand and experience"],requiredSkills:["Festival Management","Logistics Coordination","Vendor Management","Crisis Management","Entertainment Industry"],reportingStructure:{manages:["Stage Producer","Operations Manager","Artist Liaison"]},tags:["festival","multi-day","logistics","entertainment","coordination"],isPopular:!1,usageCount:180,icon:"ðŸŽª",color:"#e91e63",salaryRange:{min:6e4,max:18e4,currency:"USD"},experienceLevel:"Senior"}],SPORTS_BROADCAST:[{id:"sports-director",name:"SPORTS_DIRECTOR",displayName:"Sports Broadcast Director",description:"Directs live sports broadcasts, manages camera coverage, and coordinates real-time production decisions",industry:"SPORTS_BROADCAST",eventTypes:["SPORTS_BROADCAST","SPORTS_EVENT","OLYMPICS"],category:"Sports Production",hierarchy:85,baseRole:Ce.DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,delete_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},automation:{view_all_sessions:!0,view_all_alerts:!0,manage_automation:!0,configure_settings:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Direct live sports coverage","Coordinate multiple camera angles","Manage instant replay systems","Work with commentary teams","Ensure broadcast quality and timing"],requiredSkills:["Sports Broadcasting","Live Direction","Multi-Camera Production","Sports Knowledge","Real-time Decision Making"],reportingStructure:{manages:["Camera Operator","Replay Operator","Graphics Operator"]},tags:["sports","live","broadcast","real-time","multi-camera"],isPopular:!0,usageCount:320,icon:"ðŸ†",color:"#ff5722",salaryRange:{min:7e4,max:2e5,currency:"USD"},experienceLevel:"Senior"},{id:"sports-producer",name:"SPORTS_PRODUCER",displayName:"Sports Producer",description:"Produces sports content including pre-game, live coverage, and post-game analysis",industry:"SPORTS_BROADCAST",eventTypes:["SPORTS_BROADCAST","SPORTS_EVENT"],category:"Sports Production",hierarchy:75,baseRole:Ce.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},postProduction:{manage_tasks:!0,approve_final_cuts:!0,export_final_media:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Plan sports broadcast content","Coordinate with sports organizations","Manage highlight packages","Oversee graphics and statistics","Coordinate talent and commentary"],requiredSkills:["Sports Production","Content Planning","Sports Industry Knowledge","Broadcast Standards","Team Coordination"],reportingStructure:{reportsTo:"Sports Director",manages:["Associate Producer","Graphics Coordinator","Statistics Coordinator"]},tags:["sports","production","content","highlights","coordination"],isPopular:!0,usageCount:420,icon:"âš½",color:"#4caf50",salaryRange:{min:5e4,max:15e4,currency:"USD"},experienceLevel:"Mid"}],GAMING_ESPORTS:[{id:"esports-director",name:"ESPORTS_DIRECTOR",displayName:"Esports Tournament Director",description:"Oversees esports tournament production, player coordination, and broadcast management",industry:"GAMING_ESPORTS",eventTypes:["ESPORTS_TOURNAMENT","GAMING_STREAM","GAME_LAUNCH"],category:"Esports Production",hierarchy:80,baseRole:Ce.DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},automation:{view_all_sessions:!0,manage_automation:!0,configure_settings:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Direct esports tournament broadcasts","Coordinate with game developers","Manage player and team logistics","Oversee tournament format and rules","Ensure competitive integrity"],requiredSkills:["Esports Knowledge","Tournament Management","Gaming Industry","Broadcast Production","Player Relations"],reportingStructure:{manages:["Tournament Producer","Broadcast Producer","Player Coordinator"]},tags:["esports","gaming","tournament","competitive","broadcast"],isPopular:!0,usageCount:250,icon:"ðŸŽ®",color:"#673ab7",salaryRange:{min:6e4,max:18e4,currency:"USD"},experienceLevel:"Senior"},{id:"stream-producer",name:"STREAM_PRODUCER",displayName:"Gaming Stream Producer",description:"Produces gaming content for streaming platforms, manages creator partnerships, and audience engagement",industry:"GAMING_ESPORTS",eventTypes:["GAMING_STREAM","LIVE_STREAM"],category:"Content Production",hierarchy:65,baseRole:Ce.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0},automation:{view_all_sessions:!0,manage_automation:!0},reports:{create_reports:!0,access_analytics:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Produce gaming content for streams","Manage creator relationships","Coordinate sponsored content","Analyze audience engagement","Develop content strategies"],requiredSkills:["Content Production","Gaming Knowledge","Streaming Platforms","Creator Relations","Audience Analytics"],reportingStructure:{reportsTo:"Esports Director",manages:["Content Creator","Community Manager"]},tags:["streaming","content","gaming","creators","engagement"],isPopular:!1,usageCount:180,icon:"ðŸ“¹",color:"#9c27b0",salaryRange:{min:4e4,max:1e5,currency:"USD"},experienceLevel:"Mid"}],HEALTHCARE:[{id:"healthcare-project-manager",name:"HEALTHCARE_PROJECT_MANAGER",displayName:"Healthcare Project Manager",description:"Manages healthcare-related projects ensuring compliance with medical regulations and patient care standards",industry:"HEALTHCARE",eventTypes:["TRAINING_VIDEO","WEBINAR","CONFERENCE"],category:"Healthcare Management",hierarchy:75,baseRole:Ce.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure HIPAA compliance in all projects","Manage medical content accuracy","Coordinate with healthcare professionals","Oversee patient safety protocols","Manage regulatory approvals"],requiredSkills:["Healthcare Regulations","HIPAA Compliance","Medical Knowledge","Project Management","Risk Management"],reportingStructure:{manages:["Clinical Coordinator","Compliance Officer"]},tags:["healthcare","compliance","medical","regulations","safety"],isPopular:!1,usageCount:120,icon:"ðŸ¥",color:"#4caf50",salaryRange:{min:7e4,max:16e4,currency:"USD"},experienceLevel:"Senior"}],IT_TECHNOLOGY:[{id:"it-project-manager",name:"IT_PROJECT_MANAGER",displayName:"IT Project Manager",description:"Manages technology projects including software development, system implementations, and digital transformations",industry:"IT_TECHNOLOGY",eventTypes:["TRAINING_VIDEO","WEBINAR","PRODUCT_LAUNCH"],category:"Technology Management",hierarchy:75,baseRole:Ce.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},system:{access_settings:!0,manage_integrations:!0,view_system_logs:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Manage software development lifecycles","Coordinate technical teams and resources","Ensure system security and compliance","Oversee technology implementations","Manage stakeholder communications"],requiredSkills:["Project Management","Software Development","System Architecture","Agile Methodologies","Technical Leadership"],reportingStructure:{manages:["Software Developer","System Administrator","QA Engineer"]},tags:["technology","software","development","systems","digital"],isPopular:!0,usageCount:680,icon:"ðŸ’»",color:"#2196f3",salaryRange:{min:8e4,max:18e4,currency:"USD"},experienceLevel:"Senior"}],MARKETING_ADVERTISING:[{id:"creative-director",name:"CREATIVE_DIRECTOR",displayName:"Creative Director",description:"Leads creative vision for marketing campaigns, oversees creative teams, and ensures brand consistency",industry:"MARKETING_ADVERTISING",eventTypes:["COMMERCIAL","CORPORATE_VIDEO","PRODUCT_LAUNCH"],category:"Creative Leadership",hierarchy:85,baseRole:Ce.ART_DIRECTOR,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0,approve_sessions:!0},postProduction:{manage_tasks:!0,approve_final_cuts:!0,access_color_tools:!0},userManagement:{assign_permissions:!0,view_user_activity:!0},reports:{create_reports:!0,access_analytics:!0,export_reports:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Develop creative concepts and campaigns","Lead creative team and vision","Ensure brand consistency across projects","Present concepts to clients","Oversee creative production process"],requiredSkills:["Creative Leadership","Brand Strategy","Design Thinking","Team Management","Client Relations"],reportingStructure:{manages:["Art Director","Copywriter","Designer"]},tags:["creative","marketing","branding","campaigns","leadership"],isPopular:!0,usageCount:540,icon:"ðŸŽ¨",color:"#ff9800",salaryRange:{min:9e4,max:25e4,currency:"USD"},experienceLevel:"Senior"}],EDUCATION_TRAINING:[{id:"instructional-designer",name:"INSTRUCTIONAL_DESIGNER",displayName:"Instructional Designer",description:"Designs educational content and learning experiences for training videos and e-learning platforms",industry:"EDUCATION_TRAINING",eventTypes:["TRAINING_VIDEO","WEBINAR","VIRTUAL_EVENT"],category:"Educational Design",hierarchy:65,baseRole:Ce.PRODUCER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0},postProduction:{manage_tasks:!0,manage_review_cycles:!0},reports:{create_reports:!0,access_analytics:!0}},raciLevel:"RESPONSIBLE",keyResponsibilities:["Design learning objectives and outcomes","Create educational content structure","Develop assessment strategies","Ensure pedagogical best practices","Analyze learning effectiveness"],requiredSkills:["Instructional Design","Educational Theory","Content Development","Learning Analytics","Curriculum Design"],reportingStructure:{manages:["Content Developer","Educational Technologist"]},tags:["education","learning","instructional","content","pedagogy"],isPopular:!1,usageCount:220,icon:"ðŸ“š",color:"#4caf50",salaryRange:{min:55e3,max:12e4,currency:"USD"},experienceLevel:"Mid"}],CONSTRUCTION_ENGINEERING:[{id:"construction-project-manager",name:"CONSTRUCTION_PROJECT_MANAGER",displayName:"Construction Project Manager",description:"Manages construction and engineering projects including documentation, safety compliance, and progress tracking",industry:"CONSTRUCTION_ENGINEERING",eventTypes:["TRAINING_VIDEO","CORPORATE_VIDEO","DOCUMENTARY"],category:"Construction Management",hierarchy:80,baseRole:Ce.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure safety compliance and protocols","Manage construction documentation","Coordinate with engineering teams","Oversee project timelines and budgets","Ensure regulatory compliance"],requiredSkills:["Construction Management","Safety Regulations","Engineering Knowledge","Project Planning","Risk Management"],reportingStructure:{manages:["Site Supervisor","Safety Coordinator","Documentation Specialist"]},tags:["construction","engineering","safety","compliance","documentation"],isPopular:!1,usageCount:95,icon:"ðŸ—ï¸",color:"#795548",salaryRange:{min:75e3,max:17e4,currency:"USD"},experienceLevel:"Senior"}],FINANCE_BANKING:[{id:"financial-project-manager",name:"FINANCIAL_PROJECT_MANAGER",displayName:"Financial Project Manager",description:"Manages financial services projects ensuring regulatory compliance and risk management",industry:"FINANCE_BANKING",eventTypes:["TRAINING_VIDEO","WEBINAR","CORPORATE_VIDEO"],category:"Financial Management",hierarchy:80,baseRole:Ce.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0,export_reports:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure financial regulatory compliance","Manage risk assessment and mitigation","Oversee financial data security","Coordinate with compliance teams","Manage stakeholder communications"],requiredSkills:["Financial Regulations","Risk Management","Compliance","Financial Analysis","Project Management"],reportingStructure:{manages:["Compliance Analyst","Risk Analyst","Financial Analyst"]},tags:["finance","banking","compliance","risk","regulations"],isPopular:!1,usageCount:85,icon:"ðŸ¦",color:"#4caf50",salaryRange:{min:85e3,max:2e5,currency:"USD"},experienceLevel:"Senior"}],GOVERNMENT_PUBLIC:[{id:"public-affairs-manager",name:"PUBLIC_AFFAIRS_MANAGER",displayName:"Public Affairs Manager",description:"Manages government and public sector communication projects ensuring transparency and public engagement",industry:"GOVERNMENT_PUBLIC",eventTypes:["CORPORATE_VIDEO","WEBINAR","CONFERENCE"],category:"Public Communications",hierarchy:75,baseRole:Ce.MANAGER,permissions:{sessions:{create_sessions:!0,edit_sessions:!0,manage_workflow_steps:!0,assign_reviewers:!0},reports:{create_reports:!0,edit_reports:!0,access_analytics:!0},userManagement:{assign_permissions:!0,view_user_activity:!0}},raciLevel:"ACCOUNTABLE",keyResponsibilities:["Ensure public transparency requirements","Manage government communications","Coordinate with public stakeholders","Ensure accessibility compliance","Manage public information requests"],requiredSkills:["Public Administration","Government Regulations","Public Communications","Transparency Laws","Stakeholder Management"],reportingStructure:{manages:["Communications Specialist","Public Information Officer"]},tags:["government","public","transparency","communications","civic"],isPopular:!1,usageCount:65,icon:"ðŸ›ï¸",color:"#3f51b5",salaryRange:{min:6e4,max:14e4,currency:"USD"},experienceLevel:"Senior"}]},Ps=()=>Object.values(Sr).flat(),Ar=()=>Ps().filter(u=>u.isPopular),Rr=u=>{const r=u.toLowerCase();return Ps().filter(i=>i.displayName.toLowerCase().includes(r)||i.description.toLowerCase().includes(r)||i.tags.some(t=>t.toLowerCase().includes(r))||i.keyResponsibilities.some(t=>t.toLowerCase().includes(r)))},wr=({open:u,onClose:r,projectId:i,projectName:t,organizationId:c})=>{const[l,h]=g.useState("overview"),[n,A]=g.useState(!1),[w,S]=g.useState(null),[k,_]=g.useState(null),[N,ne]=g.useState([]),[me,Ae]=g.useState([]),[ae,f]=g.useState([]),[Y,ve]=g.useState(""),[X,pe]=g.useState("all"),[Z,xe]=g.useState(!1),[ee,ce]=g.useState({name:"",displayName:"",description:"",category:"PRODUCTION",hierarchy:50,permissions:{}});g.useEffect(()=>{u&&(T(),E(),Q())},[u,i]);const T=async()=>{var b,U;try{A(!0),console.log("ðŸ” [RoleManagement] Loading project roles for project:",i);const y=(b=window.firebase)==null?void 0:b.auth(),I=y==null?void 0:y.currentUser;if(!I){console.log("âš ï¸ [RoleManagement] No authenticated user"),S("Please log in to manage roles");return}const H=await I.getIdToken();console.log("âœ… [RoleManagement] Got auth token for roles");const K=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${i}/roles`,{headers:{Authorization:`Bearer ${H}`,"Content-Type":"application/json"}});if(K.ok){const V=await K.json();console.log("âœ… [RoleManagement] Loaded project roles:",((U=V.roles)==null?void 0:U.length)||0),ne(V.roles||[])}else{const V=await K.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to load roles:",K.status,V),S(`Failed to load project roles: ${V.error||"API Error"}`),ne([])}}catch(y){console.log("âŒ [RoleManagement] Error loading roles:",y),S("Failed to load project roles"),ne([])}finally{A(!1)}},E=async()=>{var b,U;try{A(!0),console.log("ðŸ” [RoleManagement] Loading team members for project:",i);const y=(b=window.firebase)==null?void 0:b.auth(),I=y==null?void 0:y.currentUser;if(!I){console.log("âš ï¸ [RoleManagement] No authenticated user"),S("Please log in to manage roles");return}const H=await I.getIdToken();console.log("âœ… [RoleManagement] Got auth token for user:",I.email);const K=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${i}/team-members`,{headers:{Authorization:`Bearer ${H}`,"Content-Type":"application/json"}});if(K.ok){const V=await K.json();console.log("âœ… [RoleManagement] Loaded team members:",((U=V.teamMembers)==null?void 0:U.length)||0),Ae(V.teamMembers||[])}else{const V=await K.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to load team members:",K.status,V),S(`Failed to load team members: ${V.error||"API Error"}`),Ae([])}}catch(y){console.log("âš ï¸ [RoleManagement] Error loading team members:",y),S("Failed to load team members"),Ae([])}finally{A(!1)}},Q=async()=>{var b,U;try{console.log("ðŸ” [RoleManagement] Loading user created roles");const y=(b=window.firebase)==null?void 0:b.auth(),I=y==null?void 0:y.currentUser;if(!I){console.log("âš ï¸ [RoleManagement] No authenticated user for user roles"),f([]);return}const H=await I.getIdToken(),K=await fetch("https://us-central1-backbone-logic.cloudfunctions.net/api/user/custom-roles",{headers:{Authorization:`Bearer ${H}`,"Content-Type":"application/json"}});if(K.ok){const V=await K.json();console.log("âœ… [RoleManagement] Loaded user created roles:",((U=V.roles)==null?void 0:U.length)||0),f(V.roles||[])}else{const V=await K.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to load user roles:",K.status,V),f([])}}catch(y){console.log("âŒ [RoleManagement] Error loading user roles:",y),f([])}},$=async()=>{var b;try{A(!0),console.log("ðŸ” [RoleManagement] Creating custom role:",ee);const U=(b=window.firebase)==null?void 0:b.auth(),y=U==null?void 0:U.currentUser;if(!y){S("Please log in to create roles");return}const I=await y.getIdToken(),H=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${i}/roles`,{method:"POST",headers:{Authorization:`Bearer ${I}`,"Content-Type":"application/json"},body:JSON.stringify(ee)});if(H.ok){const K=await H.json();console.log("âœ… [RoleManagement] Role created successfully:",K),_("Role created successfully!"),h("overview"),T(),Q(),ce({name:"",displayName:"",description:"",category:"PRODUCTION",hierarchy:50,permissions:{}})}else{const K=await H.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to create role:",K),S(K.error||"Failed to create role")}}catch(U){console.log("âŒ [RoleManagement] Error creating role:",U),S("Failed to create role")}finally{A(!1)}},ie=async b=>{var U;try{A(!0),console.log("ðŸ” [RoleManagement] Using template:",b.displayName);const y={name:b.name,displayName:b.displayName,description:b.description,category:b.category,hierarchy:b.hierarchy,permissions:b.permissions,isCustom:!1,baseRole:b.baseRole},I=(U=window.firebase)==null?void 0:U.auth(),H=I==null?void 0:I.currentUser;if(!H){S("Please log in to add roles");return}const K=await H.getIdToken(),V=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${i}/roles`,{method:"POST",headers:{Authorization:`Bearer ${K}`,"Content-Type":"application/json"},body:JSON.stringify(y)});if(V.ok){const ue=await V.json();console.log("âœ… [RoleManagement] Template role created successfully:",ue),_(`Role "${b.displayName}" added to project!`),h("overview"),T()}else{const ue=await V.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to create template role:",ue),S(ue.error||"Failed to add role from template")}}catch(y){console.log("âŒ [RoleManagement] Error using template:",y),S("Failed to add role from template")}finally{A(!1)}},de=async(b,U)=>{var y;try{A(!0),console.log("ðŸ” [RoleManagement] Assigning role:",{memberId:b,roleId:U});const I=(y=window.firebase)==null?void 0:y.auth(),H=I==null?void 0:I.currentUser;if(!H){S("Please log in to assign roles");return}const K=await H.getIdToken(),V=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${i}/team-members/${b}/role`,{method:"PUT",headers:{Authorization:`Bearer ${K}`,"Content-Type":"application/json"},body:JSON.stringify({roleId:U})});if(V.ok){const ue=await V.json();console.log("âœ… [RoleManagement] Role assigned successfully:",ue),_("Role assigned successfully!"),E()}else{const ue=await V.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to assign role:",ue),S(ue.error||"Failed to assign role")}}catch(I){console.log("âŒ [RoleManagement] Error assigning role:",I),S("Failed to assign role")}finally{A(!1)}},Te=async b=>{var U;try{A(!0),console.log("ðŸ” [RoleManagement] Using user created role:",b.displayName);const y=(U=window.firebase)==null?void 0:U.auth(),I=y==null?void 0:y.currentUser;if(!I){S("Please log in to add roles");return}const H=await I.getIdToken(),K={name:b.name,displayName:b.displayName,description:b.description,category:b.category,hierarchy:b.hierarchy,permissions:b.permissions,isCustom:!0,baseRole:b.baseRole},V=await fetch(`https://us-central1-backbone-logic.cloudfunctions.net/api/projects/${i}/roles`,{method:"POST",headers:{Authorization:`Bearer ${H}`,"Content-Type":"application/json"},body:JSON.stringify(K)});if(V.ok){const ue=await V.json();console.log("âœ… [RoleManagement] User role added successfully:",ue),_(`Role "${b.displayName}" added to project!`),h("overview"),T()}else{const ue=await V.json().catch(()=>({}));console.log("âŒ [RoleManagement] Failed to add user role:",ue),S(ue.error||"Failed to add role to project")}}catch(y){console.log("âŒ [RoleManagement] Error using user role:",y),S("Failed to add role to project")}finally{A(!1)}},Se=ba.useMemo(()=>{let b=Ps();if(console.log("ðŸ” [RoleTemplates] Total templates available:",b.length),console.log("ðŸ” [RoleTemplates] Selected industry:",X),Z&&(b=Ar(),console.log("ðŸ” [RoleTemplates] Popular templates:",b.length)),X!=="all"){const U=b.length;b=b.filter(I=>I.industry===X),console.log(`ðŸ” [RoleTemplates] Filtered by industry ${X}: ${U} â†’ ${b.length}`);const y=Ps().reduce((I,H)=>(I[H.industry]=(I[H.industry]||0)+1,I),{});console.log("ðŸ” [RoleTemplates] Available industries:",y)}if(Y.trim()){const U=Rr(Y);b=b.filter(y=>U.some(I=>I.id===y.id)),console.log("ðŸ” [RoleTemplates] After search filter:",b.length)}return b},[Y,X,Z]),Ee=()=>e.jsxs(o,{children:[e.jsxs(x,{container:!0,spacing:2,sx:{mb:4},children:[e.jsx(x,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{cursor:"pointer",border:"2px solid transparent","&:hover":{boxShadow:4,borderColor:"primary.main"}},onClick:()=>h("create-custom"),children:e.jsxs(be,{sx:{textAlign:"center",py:3},children:[e.jsx(xa,{sx:{fontSize:40,color:"primary.main",mb:2}}),e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Create Custom Role"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Define a new role with specific permissions"})]})})}),e.jsx(x,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{cursor:"pointer",border:"2px solid transparent","&:hover":{boxShadow:4,borderColor:"secondary.main"}},onClick:()=>h("browse-templates"),children:e.jsxs(be,{sx:{textAlign:"center",py:3},children:[e.jsx($a,{sx:{fontSize:40,color:"secondary.main",mb:2}}),e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Use Role Template"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Choose from 70+ pre-defined roles"})]})})}),e.jsx(x,{item:!0,xs:12,md:4,children:e.jsx(oe,{sx:{cursor:"pointer",border:"2px solid transparent","&:hover":{boxShadow:4,borderColor:"success.main"},opacity:ae.length===0?.6:1},onClick:()=>ae.length>0&&h("user-created"),children:e.jsxs(be,{sx:{textAlign:"center",py:3},children:[e.jsx(Ga,{sx:{fontSize:40,color:"success.main",mb:2}}),e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Your Created Roles"}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Reuse roles you've created (",ae.length,")"]})]})})})]}),e.jsx(St,{sx:{my:3}}),e.jsxs(o,{sx:{mb:3},children:[e.jsxs(a,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Is,{}),"Current Project Roles (",N.length,")"]}),N.length===0?e.jsx(Be,{sx:{p:3,textAlign:"center",bgcolor:"grey.50"},children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"No roles defined yet. Create a custom role or use a template to get started."})}):e.jsx(At,{children:N.map(b=>e.jsxs(Rt,{divider:!0,children:[e.jsx(wt,{primary:b.displayName,secondary:e.jsxs(o,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:b.description}),e.jsxs(o,{sx:{mt:1,display:"flex",gap:1,alignItems:"center"},children:[e.jsx(W,{size:"small",label:b.category,variant:"outlined"}),e.jsx(W,{size:"small",label:`Level ${b.hierarchy}`,color:"primary",variant:"outlined"}),b.isCustom&&e.jsx(W,{size:"small",label:"Custom",color:"secondary",variant:"outlined"})]})]})}),e.jsxs(Tt,{children:[e.jsx(xs,{size:"small",children:e.jsx(zt,{})}),e.jsx(xs,{size:"small",color:"error",children:e.jsx(et,{})})]})]},b.id))})]}),e.jsx(St,{sx:{my:3}}),e.jsxs(o,{children:[e.jsxs(a,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ps,{}),"Team Member Assignments (",me.length,")"]}),me.length===0?e.jsx(Be,{sx:{p:3,textAlign:"center",bgcolor:"grey.50"},children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"No team members found. Invite members to your project first."})}):e.jsx(At,{children:me.map(b=>e.jsxs(Rt,{divider:!0,children:[e.jsx(Rs,{sx:{mr:2},children:b.displayName.charAt(0).toUpperCase()}),e.jsx(wt,{primary:b.displayName,secondary:b.email}),e.jsx(Tt,{children:e.jsxs(Oe,{size:"small",sx:{minWidth:150},children:[e.jsx(Le,{children:"Role"}),e.jsxs(Fe,{value:b.projectRoleId||"",label:"Role",onChange:U=>de(b.id,U.target.value),children:[e.jsx(M,{value:"",children:e.jsx("em",{children:"No Role"})}),N.map(U=>e.jsx(M,{value:U.id,children:U.displayName},U.id))]})]})})]},b.id))})]})]}),we=()=>e.jsxs(o,{children:[e.jsxs(o,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{startIcon:e.jsx(Es,{}),onClick:()=>h("overview"),variant:"outlined",size:"small",children:"Back"}),e.jsx(a,{variant:"h6",children:"Create Custom Role"})]}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(te,{fullWidth:!0,label:"Role Name",value:ee.displayName||"",onChange:b=>ce(U=>({...U,displayName:b.target.value})),placeholder:"e.g., Senior Editor",sx:{mb:2}}),e.jsx(te,{fullWidth:!0,label:"Description",multiline:!0,rows:3,value:ee.description||"",onChange:b=>ce(U=>({...U,description:b.target.value})),placeholder:"Describe the role's responsibilities...",sx:{mb:2}}),e.jsxs(Oe,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Le,{children:"Category"}),e.jsxs(Fe,{value:ee.category||"PRODUCTION",label:"Category",onChange:b=>ce(U=>({...U,category:b.target.value})),children:[e.jsx(M,{value:"PRODUCTION",children:"Production"}),e.jsx(M,{value:"POST_PRODUCTION",children:"Post-Production"}),e.jsx(M,{value:"ADMINISTRATIVE",children:"Administrative"}),e.jsx(M,{value:"CREATIVE",children:"Creative"}),e.jsx(M,{value:"TECHNICAL",children:"Technical"})]})]}),e.jsxs(o,{sx:{mb:2},children:[e.jsxs(a,{gutterBottom:!0,children:["Hierarchy Level: ",ee.hierarchy]}),e.jsx(Ha,{value:ee.hierarchy||50,onChange:(b,U)=>ce(y=>({...y,hierarchy:U})),min:1,max:100,marks:[{value:1,label:"Basic"},{value:50,label:"Standard"},{value:100,label:"Admin"}]})]})]}),e.jsxs(x,{item:!0,xs:12,md:6,children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Permissions"}),e.jsxs(Be,{sx:{p:2,maxHeight:400,overflow:"auto"},children:[e.jsx(Re,{control:e.jsx(Pe,{}),label:"Create & Edit Sessions"}),e.jsx(Re,{control:e.jsx(Pe,{}),label:"Manage Post-Production"}),e.jsx(Re,{control:e.jsx(Pe,{}),label:"Access Analytics"}),e.jsx(Re,{control:e.jsx(Pe,{}),label:"Manage Team"}),e.jsx(Re,{control:e.jsx(Pe,{}),label:"Project Settings"})]})]})]}),e.jsxs(o,{sx:{mt:3,textAlign:"right"},children:[e.jsx(G,{variant:"outlined",onClick:()=>h("overview"),sx:{mr:2},children:"Cancel"}),e.jsx(G,{variant:"contained",onClick:$,disabled:!ee.displayName||n,children:"Create Role"})]})]}),Ie=()=>e.jsxs(o,{children:[e.jsxs(o,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{startIcon:e.jsx(Es,{}),onClick:()=>h("overview"),variant:"outlined",size:"small",children:"Back"}),e.jsx(a,{variant:"h6",children:"Browse Role Templates"})]}),e.jsx(Be,{sx:{p:2,mb:3},children:e.jsxs(x,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(x,{item:!0,xs:12,md:4,children:e.jsx(te,{fullWidth:!0,size:"small",placeholder:"Search roles...",value:Y,onChange:b=>ve(b.target.value),InputProps:{startAdornment:e.jsx(tt,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsxs(Oe,{fullWidth:!0,size:"small",children:[e.jsx(Le,{children:"Industry"}),e.jsxs(Fe,{value:X,label:"Industry",onChange:b=>pe(b.target.value),children:[e.jsx(M,{value:"all",children:"All Industries"}),e.jsx(M,{value:"FILM_TV",children:"Film & TV"}),e.jsx(M,{value:"CORPORATE_EVENTS",children:"Corporate Events"}),e.jsx(M,{value:"LIVE_EVENTS",children:"Live Events"}),e.jsx(M,{value:"SPORTS_BROADCAST",children:"Sports Broadcasting"}),e.jsx(M,{value:"GAMING_ESPORTS",children:"Gaming & Esports"}),e.jsx(M,{value:"HEALTHCARE",children:"Healthcare"}),e.jsx(M,{value:"IT_TECHNOLOGY",children:"IT & Technology"}),e.jsx(M,{value:"MARKETING_ADVERTISING",children:"Marketing & Advertising"}),e.jsx(M,{value:"EDUCATION_TRAINING",children:"Education & Training"}),e.jsx(M,{value:"CONSTRUCTION_ENGINEERING",children:"Construction & Engineering"}),e.jsx(M,{value:"FINANCE_BANKING",children:"Finance & Banking"}),e.jsx(M,{value:"GOVERNMENT_PUBLIC",children:"Government & Public"})]})]})}),e.jsx(x,{item:!0,xs:12,md:3,children:e.jsx(Re,{control:e.jsx(Pe,{checked:Z,onChange:b=>xe(b.target.checked)}),label:"Popular Only"})}),e.jsx(x,{item:!0,xs:12,md:2,children:e.jsxs(a,{variant:"body2",color:"text.secondary",children:[Se.length," roles"]})})]})}),e.jsx(x,{container:!0,spacing:2,children:Se.map(b=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(oe,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(be,{sx:{flexGrow:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(a,{variant:"h6",component:"div",noWrap:!0,children:b.name}),b.isPopular&&e.jsx(W,{size:"small",label:"Popular",color:"primary"})]}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:b.description}),e.jsxs(o,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(W,{size:"small",label:b.industry,variant:"outlined"}),e.jsx(W,{size:"small",label:`Level ${b.hierarchy}`,variant:"outlined"}),e.jsx(W,{size:"small",label:b.experienceLevel,variant:"outlined"})]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Used ",b.usageCount||0," times"]})]}),e.jsx(o,{sx:{p:2,pt:0},children:e.jsx(G,{fullWidth:!0,variant:"contained",size:"small",onClick:()=>ie(b),disabled:n,children:"Add to Project"})})]})},b.id))}),Se.length===0&&e.jsxs(Be,{sx:{p:4,textAlign:"center"},children:[e.jsx(a,{variant:"body1",color:"text.secondary",children:"No templates found matching your criteria."}),e.jsx(G,{variant:"outlined",onClick:()=>{ve(""),pe("all"),xe(!1)},sx:{mt:2},children:"Clear Filters"})]})]}),as=()=>e.jsxs(o,{children:[e.jsxs(o,{sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{startIcon:e.jsx(Es,{}),onClick:()=>h("overview"),variant:"outlined",size:"small",children:"Back"}),e.jsx(a,{variant:"h6",children:"Your Created Roles"})]}),e.jsx(x,{container:!0,spacing:2,children:ae.map(b=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(oe,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs(be,{sx:{flexGrow:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(a,{variant:"h6",component:"div",noWrap:!0,children:b.displayName}),e.jsx(W,{size:"small",label:"Custom",color:"success"})]}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:b.description}),e.jsxs(o,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:[e.jsx(W,{size:"small",label:b.category,variant:"outlined"}),e.jsx(W,{size:"small",label:`Level ${b.hierarchy}`,variant:"outlined"})]})]}),e.jsx(o,{sx:{p:2,pt:0},children:e.jsx(G,{fullWidth:!0,variant:"contained",size:"small",onClick:()=>Te(b),disabled:n,children:"Add to Project"})})]})},b.id))}),ae.length===0&&e.jsxs(Be,{sx:{p:4,textAlign:"center"},children:[e.jsx(a,{variant:"body1",color:"text.secondary",children:"You haven't created any custom roles yet."}),e.jsx(G,{variant:"outlined",onClick:()=>h("create-custom"),sx:{mt:2},children:"Create Your First Role"})]})]});return e.jsxs(Ze,{open:u,onClose:r,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{minHeight:"70vh"}},children:[e.jsx(es,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Is,{}),"Role Management - ",t]})}),e.jsxs(ss,{children:[w&&e.jsx(ge,{severity:"error",sx:{mb:2},onClose:()=>S(null),children:w}),k&&e.jsx(ge,{severity:"success",sx:{mb:2},onClose:()=>_(null),children:k}),n&&e.jsx(o,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(Ke,{})}),l==="overview"&&Ee(),l==="create-custom"&&we(),l==="browse-templates"&&Ie(),l==="user-created"&&as()]}),e.jsx(ts,{children:e.jsx(G,{onClick:r,children:"Close"})})]})},jt={ADMIN:100,GUEST:10,EXEC:95,ACCOUNT_MANAGER:75,PROJECT_MANAGER:70,PRODUCTION_MANAGER:65,MANAGER:60,BUSINESS_ANALYST:55,DEVOPS_ENGINEER:50,NETWORK_ENGINEER:45,SOUND_ENGINEER:40,LIGHTING_TECHNICIAN:35,DIT:35,TECH:30,NETWORKING:30,ART_DIRECTOR:60,VFX_ARTIST:40,MOTION_GRAPHICS_ARTIST:40,GFX_ARTIST:35,COLORIST:35,DIRECTOR:65,ASSIST_DIRECTOR:30,PRODUCER:55,ASSOCIATE_PRODUCER:45,POST_PRODUCER:50,LINE_PRODUCER:50,KEYNOTE_PRODUCER:45,KEYNOTE_PROD:40,PRODUCTION_ASSISTANT:25,POST_PA:25,EDITOR:45,ASSISTANT_EDITOR:30,POST_COORDINATOR:50,POST_PRODUCTION_SUPERVISOR:55,KEYNOTE_POST:40,AUDIO_PRODUCTION:40,AUDIO_POST:35,MEDIA_MANAGER:50,CAMERA_OPERATOR:35,QC_SPECIALIST:30},ds=class ds{constructor(){_e(this,"roleMappingCache",new Map)}static getInstance(){return ds.instance||(ds.instance=new ds),ds.instance}mapLicensingRoleToDashboard(r,i,t="PRO"){console.log(`ðŸ”„ [RoleBridge] Mapping licensing role: ${r}${i?` with template: ${i.displayName}`:""}`);const c=`${r}-${(i==null?void 0:i.id)||"basic"}-${t}`;if(this.roleMappingCache.has(c))return this.roleMappingCache.get(c);let l,h,n=!1;if(i){const S=this.mapTemplateRoleToDashboard(i,r);l=S.dashboardRole,h=S.effectiveHierarchy,n=S.isCustomMapping}else{const S=this.mapBasicLicensingRole(r);l=S.dashboardRole,h=S.effectiveHierarchy}h=this.applyTierRestrictions(h,t);const A=this.generateRolePermissions(l,h,t),w={licensingRole:r,templateRole:i,dashboardRole:l,effectiveHierarchy:h,permissions:A,isCustomMapping:n};return this.roleMappingCache.set(c,w),console.log(`âœ… [RoleBridge] Mapped to Dashboard role: ${l} (hierarchy: ${h})`),w}mapTemplateRoleToDashboard(r,i){const t=r.name.toUpperCase();r.displayName.toUpperCase();for(const[l,h]of Object.entries(jt))if(t.includes(l)||l.includes(t))return{dashboardRole:l,effectiveHierarchy:Math.max(r.hierarchy,h),isCustomMapping:!1};const c=this.getSemanticRoleMapping(r,i);return c||this.getHierarchyBasedMapping(r,i)}getSemanticRoleMapping(r,i){const t=r.displayName.toLowerCase();r.keyResponsibilities.join(" ").toLowerCase();const c=r.hierarchy;return c>=80||t.includes("manager")||t.includes("supervisor")||t.includes("director")?c>=90?{dashboardRole:"EXEC",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("post")||t.includes("production")?{dashboardRole:"POST_PRODUCTION_SUPERVISOR",effectiveHierarchy:c,isCustomMapping:!0}:{dashboardRole:"MANAGER",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("director")&&!t.includes("assistant")?{dashboardRole:"DIRECTOR",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("editor")?t.includes("assistant")?{dashboardRole:"ASSISTANT_EDITOR",effectiveHierarchy:c,isCustomMapping:!0}:{dashboardRole:"EDITOR",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("producer")?t.includes("associate")?{dashboardRole:"ASSOCIATE_PRODUCER",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("line")?{dashboardRole:"LINE_PRODUCER",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("post")?{dashboardRole:"POST_PRODUCER",effectiveHierarchy:c,isCustomMapping:!0}:{dashboardRole:"PRODUCER",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("camera")?{dashboardRole:"CAMERA_OPERATOR",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("sound")||t.includes("audio")?{dashboardRole:"SOUND_ENGINEER",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("lighting")?{dashboardRole:"LIGHTING_TECHNICIAN",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("color")?{dashboardRole:"COLORIST",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("graphics")||t.includes("gfx")?{dashboardRole:"GFX_ARTIST",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("qc")||t.includes("quality")?{dashboardRole:"QC_SPECIALIST",effectiveHierarchy:c,isCustomMapping:!0}:t.includes("assistant")||t.includes("support")||c<=20?{dashboardRole:"PRODUCTION_ASSISTANT",effectiveHierarchy:c,isCustomMapping:!0}:null}getHierarchyBasedMapping(r,i){const t=r.hierarchy;return t>=90?{dashboardRole:"EXEC",effectiveHierarchy:t,isCustomMapping:!0}:t>=80?{dashboardRole:"MANAGER",effectiveHierarchy:t,isCustomMapping:!0}:t>=60?{dashboardRole:"PRODUCER",effectiveHierarchy:t,isCustomMapping:!0}:t>=40?{dashboardRole:"EDITOR",effectiveHierarchy:t,isCustomMapping:!0}:t>=20?{dashboardRole:"PRODUCTION_ASSISTANT",effectiveHierarchy:t,isCustomMapping:!0}:{dashboardRole:"GUEST",effectiveHierarchy:t,isCustomMapping:!0}}mapBasicLicensingRole(r){switch(r){case Ue.ADMIN:return{dashboardRole:"ADMIN",effectiveHierarchy:100};case Ue.MEMBER:return{dashboardRole:"PRODUCER",effectiveHierarchy:60};default:return{dashboardRole:"GUEST",effectiveHierarchy:10}}}applyTierRestrictions(r,i){switch(i){case"BASIC":return Math.min(r,40);case"PRO":return Math.min(r,80);case"ENTERPRISE":return r;default:return Math.min(r,40)}}generateRolePermissions(r,i,t){const c={canManageTeam:i>=80,canManageProjects:i>=60,canViewFinancials:i>=70&&(t==="PRO"||t==="ENTERPRISE"),canEditContent:i>=25,canApproveContent:i>=40,canAccessReports:i>=30,canManageSettings:i>=90,hierarchyLevel:i};return t==="BASIC"&&(c.canViewFinancials=!1,c.canManageSettings=!1),c}getAvailableDashboardRoles(r,i){const t=this.applyTierRestrictions(100,i);return Object.entries(jt).filter(([c,l])=>l<=t).map(([c,l])=>c)}validateRoleAssignment(r,i,t){const c=jt[i],l=this.applyTierRestrictions(100,t);return c>l?{isValid:!1,reason:`Role ${i} (hierarchy ${c}) exceeds maximum allowed for ${t} tier (${l})`}:{isValid:!0}}clearCache(){this.roleMappingCache.clear(),console.log("ðŸ§¹ [RoleBridge] Role mapping cache cleared")}};_e(ds,"instance");let at=ds;const us=class us{constructor(){_e(this,"roleBridgeService");_e(this,"syncListeners",new Map);_e(this,"syncQueue",[]);_e(this,"isProcessingQueue",!1);_e(this,"config",{enableRealTimeSync:!0,enableBidirectionalSync:!0,conflictResolution:"hierarchy-based",batchSize:10,retryAttempts:3,syncTimeout:3e4});this.roleBridgeService=at.getInstance(),this.initializeSyncListeners()}static getInstance(){return us.instance||(us.instance=new us),us.instance}initializeSyncListeners(){if(!this.config.enableRealTimeSync)return;console.log("ðŸ”„ [CrossAppSync] Initializing real-time sync listeners");const r=xt(ls,"roleSyncEvents"),i=xr(r,t=>{t.docChanges().forEach(c=>{if(c.type==="added"){const l={id:c.doc.id,...c.doc.data()};this.handleIncomingSyncEvent(l)}})});this.syncListeners.set("roleSyncEvents",i)}async syncRoleToLicensing(r,i,t,c,l,h){if(!this.config.enableRealTimeSync){console.log(`â¸ï¸ [CrossAppSync] Sync disabled, skipping role sync for: ${r}`);return}console.log(`ðŸ”„ [CrossAppSync] Syncing role to licensing: ${r} -> ${c}`);try{const n=this.roleBridgeService.mapLicensingRoleToDashboard(c,l,"PRO"),A={type:"ROLE_ASSIGNED",sourceApp:"licensing",targetApp:"dashboard",timestamp:new Date,userId:r,projectId:i,organizationId:t,data:{licensingRole:c,templateRole:l,dashboardRole:n.dashboardRole,hierarchy:n.effectiveHierarchy,permissions:n.permissions,roleMapping:n,assignedBy:h,reason:"Role assigned via licensing website wizard"},status:"pending"};await this.addToSyncQueue(A),await this.updateUserRoleMapping(r,i,n),console.log(`âœ… [CrossAppSync] Role sync initiated for user: ${r}`)}catch(n){throw console.error("âŒ [CrossAppSync] Error syncing role to licensing:",n),n}}async syncRoleFromDashboard(r,i,t,c,l,h){if(!this.config.enableRealTimeSync){console.log(`â¸ï¸ [CrossAppSync] Sync disabled, skipping Dashboard role sync for: ${r}`);return}console.log(`ðŸ”„ [CrossAppSync] Syncing role from Dashboard: ${r} -> ${c}`);try{const n={type:"ROLE_ASSIGNED",sourceApp:"dashboard",targetApp:"licensing",timestamp:new Date,userId:r,projectId:i,organizationId:t,data:{dashboardRole:c,hierarchy:l,assignedBy:h,reason:"Role assigned via Dashboard application"},status:"pending"};await this.addToSyncQueue(n),console.log(`âœ… [CrossAppSync] Dashboard role sync initiated for user: ${r}`)}catch(n){throw console.error("âŒ [CrossAppSync] Error syncing role from Dashboard:",n),n}}async addToSyncQueue(r){try{const i=await br(xt(ls,"roleSyncEvents"),{...r,timestamp:Ve.fromDate(r.timestamp)});r.id=i.id,this.syncQueue.push(r),this.isProcessingQueue||this.processSyncQueue()}catch(i){throw console.error("âŒ [CrossAppSync] Error adding to sync queue:",i),i}}async processSyncQueue(){if(!(this.isProcessingQueue||this.syncQueue.length===0)){this.isProcessingQueue=!0,console.log(`ðŸ”„ [CrossAppSync] Processing sync queue: ${this.syncQueue.length} events`);try{for(;this.syncQueue.length>0;){const r=this.syncQueue.splice(0,this.config.batchSize);await Promise.all(r.map(i=>this.processSyncEvent(i)))}}catch(r){console.error("âŒ [CrossAppSync] Error processing sync queue:",r)}finally{this.isProcessingQueue=!1}}}async processSyncEvent(r){console.log(`ðŸ”„ [CrossAppSync] Processing sync event: ${r.type} for user ${r.userId}`);try{switch(await this.updateSyncEventStatus(r.id,"processing"),r.type){case"ROLE_ASSIGNED":await this.processRoleAssignment(r);break;case"ROLE_UPDATED":await this.processRoleUpdate(r);break;case"ROLE_REMOVED":await this.processRoleRemoval(r);break;case"HIERARCHY_CHANGED":await this.processHierarchyChange(r);break;case"PERMISSIONS_UPDATED":await this.processPermissionsUpdate(r);break}await this.updateSyncEventStatus(r.id,"completed"),console.log(`âœ… [CrossAppSync] Sync event completed: ${r.id}`)}catch(i){console.error(`âŒ [CrossAppSync] Error processing sync event ${r.id}:`,i);const t=i instanceof Error?i.message:"Unknown error";await this.updateSyncEventStatus(r.id,"failed",t)}}async processRoleAssignment(r){const{userId:i,projectId:t,data:c}=r;r.targetApp==="dashboard"?await this.syncToDashboardApp(i,t,c.roleMapping):r.targetApp==="licensing"&&await this.syncToLicensingApp(i,t,c.dashboardRole,c.hierarchy)}async syncToDashboardApp(r,i,t){var c;console.log(`ðŸŽ¯ [CrossAppSync] Syncing to existing collections: ${r} -> ${t.dashboardRole}`);try{const l=Xs(ls,"users",r),h=await da(l),n={[i]:{dashboardRole:t.dashboardRole,hierarchy:t.effectiveHierarchy,permissions:t.permissions,licensingRole:t.licensingRole,templateRole:((c=t.templateRole)==null?void 0:c.id)||null,syncedAt:Ve.now(),syncSource:"licensing"}};if(h.exists())await Ss(l,{[`dashboardRoleMappings.${i}`]:n[i],lastRoleSync:Ve.now(),roleSystemVersion:"2.0"}),console.log(`âœ… [CrossAppSync] Updated user Dashboard role mapping: ${r}`);else{console.warn(`âš ï¸ [CrossAppSync] User document not found: ${r}`);return}const A=fr(xt(ls,"projectAssignments"),bt("projectId","==",i),bt("userId","==",r),bt("isActive","==",!0)),w=await yr(A);if(w.empty)console.warn(`âš ï¸ [CrossAppSync] No active project assignment found for user ${r} in project ${i}`);else{const S=w.docs[0];await Ss(S.ref,{dashboardRole:t.dashboardRole,hierarchyLevel:t.effectiveHierarchy,enhancedPermissions:t.permissions,syncMetadata:{lastSyncedAt:Ve.now(),syncSource:"licensing",syncVersion:"2.0"}}),console.log(`âœ… [CrossAppSync] Updated project assignment with Dashboard role: ${r}`)}}catch(l){throw console.error(`âŒ [CrossAppSync] Error syncing to existing collections for user ${r}:`,l),l}}async syncToLicensingApp(r,i,t,c){console.log(`ðŸŽ¯ [CrossAppSync] Syncing to Licensing: ${r} -> ${t}`);const l=Xs(ls,"projectAssignments",`${i}-${r}`);await Ss(l,{dashboardRole:t,hierarchy:c,syncedAt:Ve.now(),syncSource:"dashboard"})}async handleIncomingSyncEvent(r){r.status==="pending"&&(this.syncQueue.push(r),this.isProcessingQueue||this.processSyncQueue())}async updateUserRoleMapping(r,i,t){try{const c=Xs(ls,"users",r),l=await da(c),h={...t,updatedAt:Ve.now()};l.exists()?(await Ss(c,{[`roleMappings.${i}`]:h}),console.log(`âœ… [CrossAppSync] Updated role mapping for user: ${r}`)):(await jr(c,{id:r,roleMappings:{[i]:h},createdAt:Ve.now(),updatedAt:Ve.now()}),console.log(`âœ… [CrossAppSync] Created user with role mapping: ${r}`))}catch(c){console.error(`âŒ [CrossAppSync] Error updating role mapping for user ${r}:`,c)}}async updateSyncEventStatus(r,i,t){const c=Xs(ls,"roleSyncEvents",r),l={status:i,updatedAt:Ve.now()};t&&(l.error=t),await Ss(c,l)}async processRoleUpdate(r){console.log("ðŸ”„ [CrossAppSync] Processing role update:",r.id)}async processRoleRemoval(r){console.log("ðŸ”„ [CrossAppSync] Processing role removal:",r.id)}async processHierarchyChange(r){console.log("ðŸ”„ [CrossAppSync] Processing hierarchy change:",r.id)}async processPermissionsUpdate(r){console.log("ðŸ”„ [CrossAppSync] Processing permissions update:",r.id)}configureSyncSettings(r){this.config={...this.config,...r},console.log("âš™ï¸ [CrossAppSync] Sync configuration updated:",this.config),r.enableRealTimeSync&&!this.syncListeners.has("roleSyncEvents")&&this.initializeSyncListeners()}enableSync(){this.configureSyncSettings({enableRealTimeSync:!0}),console.log("âœ… [CrossAppSync] Cross-app synchronization enabled")}disableSync(){this.configureSyncSettings({enableRealTimeSync:!1}),console.log("â¸ï¸ [CrossAppSync] Cross-app synchronization disabled")}async getSyncStatus(r,i){return[]}cleanup(){this.syncListeners.forEach(r=>{r()}),this.syncListeners.clear(),console.log("ðŸ§¹ [CrossAppSync] Sync listeners cleaned up")}};_e(us,"instance");let Pt=us;const vt=["Choose Action","Select Members","Assign Roles","Review & Confirm"],Tr=({open:u,onClose:r,projectId:i,projectName:t,organizationId:c,onTeamMembersUpdated:l,existingProjectTeamMembers:h})=>{const[n,A]=g.useState(0),[w,S]=g.useState(!1),[k,_]=g.useState(null),[N,ne]=g.useState(null),[me,Ae]=g.useState(null),[ae,f]=g.useState([]),[Y,ve]=g.useState([]),[X,pe]=g.useState([]),[Z,xe]=g.useState([]),[ee,ce]=g.useState([]),[T,E]=g.useState(!1),Q=at.getInstance(),$=Pt.getInstance(),[ie,de]=g.useState(""),[Te,Se]=g.useState("popular"),[Ee,we]=g.useState("all");g.useEffect(()=>{u&&i&&Ie()},[u,i]);const Ie=async()=>{S(!0),_(null);try{await as(),await Promise.all([b(),U()])}catch(p){console.error("âŒ [TeamRoleWizard] Error loading data:",p),_("Failed to load data. Please try again.")}finally{S(!1)}},as=async()=>{try{if(console.log(`ðŸ” [TeamRoleWizard] Loading existing team members for project: ${i}`),h&&h.length>0){console.log(`âœ… [TeamRoleWizard] Using ${h.length} existing team members from parent component`),console.log("ðŸ” [TeamRoleWizard] Parent team members data:",h),ce(h);const P=h.some(v=>v.role==="ADMIN"||v.role===Ue.ADMIN||v.role==="ENTERPRISE");E(P),console.log(`ðŸ›¡ï¸ [TeamRoleWizard] Project has admin: ${P}`);return}const p=la.getInstance({isWebOnlyMode:!0,apiBaseUrl:"/api"});try{const P=await p.getProjectTeamMembers(i);console.log(`âœ… [TeamRoleWizard] Found ${P.length} existing team members from TeamMemberService`),console.log("ðŸ” [TeamRoleWizard] Service team members data:",P),ce(P);const v=P.some(j=>j.role==="ADMIN"||j.role===Ue.ADMIN||j.role==="ENTERPRISE");E(v),console.log(`ðŸ›¡ï¸ [TeamRoleWizard] Project has admin: ${v}`)}catch(P){console.warn("âš ï¸ [TeamRoleWizard] TeamMemberService failed:",P),ce([]),E(!1),console.log("âš ï¸ [TeamRoleWizard] Using empty team member list - filtering may not work correctly")}}catch(p){console.error("âŒ [TeamRoleWizard] Error loading existing team members:",p),ce([]),E(!1)}},b=async()=>{try{console.log(`ðŸ” [TeamRoleWizard] Loading team members for project: ${i}`);const p=await ca.getTeamMembersForOrganization(),P=ee.map(R=>R.id||R.userId||R.memberId||R.firebaseUid),v=ee.map(R=>R.email).filter(Boolean);console.log(`ðŸ” [TeamRoleWizard] Found ${P.length} already assigned member IDs:`,P),console.log(`ðŸ” [TeamRoleWizard] Found ${v.length} already assigned member emails:`,v),console.log("ðŸ” [TeamRoleWizard] Existing team members structure:",ee);const j=p.filter(R=>{const he=P.includes(R.id),C=v.includes(R.email),q=he||C;return q&&console.log(`ðŸš« [TeamRoleWizard] Filtering out already assigned member: ${R.name||R.email} (ID: ${R.id}, Email: ${R.email})`),!q}),L=j.map(R=>({id:R.id,name:R.name||`${R.firstName} ${R.lastName}`,email:R.email,tier:R.role||R.licenseType||"MEMBER",isSelected:!1}));f(L),console.log(`âœ… [TeamRoleWizard] Loaded ${L.length} available team members (filtered out ${p.length-j.length} already assigned)`)}catch(p){console.error("âŒ [TeamRoleWizard] Error loading members:",p),_(`Failed to load team members: ${p.message}`),f([])}},U=async()=>{try{console.log(`ðŸ” [TeamRoleWizard] Loading roles for project: ${i}`);let p=[{id:"basic-admin",name:"ADMIN",displayName:"Project Admin",description:"Full administrative access to the project",category:"MANAGEMENT",hierarchy:100,isTemplate:!1,isPopular:!0},{id:"basic-manager",name:"MANAGER",displayName:"Project Manager",description:"Manage project tasks and team members",category:"MANAGEMENT",hierarchy:80,isTemplate:!1,isPopular:!0},{id:"basic-doer",name:"MEMBER",displayName:"Team Member",description:"Standard team member with task execution access",category:"EXECUTION",hierarchy:60,isTemplate:!1,isPopular:!0},{id:"basic-viewer",name:"VIEWER",displayName:"Viewer",description:"Read-only access to project information",category:"ACCESS",hierarchy:20,isTemplate:!1,isPopular:!1}];const v=Ps().map(j=>({id:`template-${j.id}`,name:j.name,displayName:j.displayName,description:j.description,category:j.category,hierarchy:j.hierarchy,isTemplate:!0,isPopular:j.isPopular,industry:j.industry,tags:j.tags,usageCount:j.usageCount,icon:j.icon,color:j.color}));console.log(`ðŸŽ­ [TeamRoleWizard] Loaded ${v.length} enhanced role templates`),pe([...p,...v])}catch(p){console.error("âŒ [TeamRoleWizard] Error loading roles:",p),pe([])}},y=()=>{if(n===0&&!me){_("Please choose an action to continue");return}if(n===1&&Y.length===0){_("Please select at least one team member");return}if(n===2){const p=Y.filter(P=>!Z.find(v=>v.memberId===P.id));if(p.length>0){_(`Please assign roles to: ${p.map(P=>P.name).join(", ")}`);return}if(!T&&!Z.some(v=>{const j=X.find(L=>L.id===v.roleId);return(j==null?void 0:j.name)==="ADMIN"})){_("âš ï¸ This project needs an ADMIN! Please assign the ADMIN role to at least one team member before proceeding.");return}}_(null),A(p=>Math.min(p+1,vt.length-1))},I=()=>{_(null),A(p=>Math.max(p-1,0))},H=()=>{A(0),Ae(null),ve([]),xe([]),_(null),ne(null)},K=p=>{ve(P=>P.some(j=>j.id===p.id)?(xe(j=>j.filter(L=>L.memberId!==p.id)),P.filter(j=>j.id!==p.id)):[...P,p])},V=(p,P)=>{xe(v=>{const j=v.find(he=>he.memberId===p);let L;j?L=v.map(he=>he.memberId===p?{...he,roleId:P}:he):L=[...v,{memberId:p,roleId:P}];const R=X.find(he=>he.id===P);return(R==null?void 0:R.name)==="ADMIN"&&console.log("ðŸ›¡ï¸ [TeamRoleWizard] ADMIN role assigned - updating project admin status"),L})},ue=async()=>{S(!0),_(null);try{console.log(`ðŸš€ [TeamRoleWizard] Starting assignment process for ${Z.length} assignments`);const p=la.getInstance({isWebOnlyMode:!0,apiBaseUrl:"/api"});for(let P=0;P<Z.length;P++){const v=Z[P],j=X.find(q=>q.id===v.roleId),L=Y.find(q=>q.id===v.memberId);console.log(`ðŸ“‹ [TeamRoleWizard] Processing assignment ${P+1}/${Z.length}: ${L==null?void 0:L.name} -> ${j==null?void 0:j.displayName}`);let R=Ue.MEMBER,he=null,C=Ue.MEMBER;if((j==null?void 0:j.name)==="ADMIN"?(C=Ue.ADMIN,R=Ue.ADMIN):(C=Ue.MEMBER,R=Ue.MEMBER),j!=null&&j.isTemplate&&L){console.log(`ðŸŽ­ [TeamRoleWizard] Mapping template role: ${j.displayName}`);const q={id:j.id,name:j.name,displayName:j.displayName,description:j.description,industry:"FILM_TV",eventTypes:[],category:j.category,hierarchy:j.hierarchy,baseRole:"PRODUCER",permissions:{},raciLevel:"RESPONSIBLE",keyResponsibilities:[],requiredSkills:[],reportingStructure:{},tags:j.tags||[],isPopular:j.isPopular||!1,usageCount:j.usageCount||0,icon:j.icon||"Person",color:j.color||"#1976d2",experienceLevel:"Mid"},fe=Q.mapLicensingRoleToDashboard(C,q,"PRO");he=fe.dashboardRole,console.log(`âœ… [TeamRoleWizard] Template mapped to Dashboard role: ${he} (hierarchy: ${fe.effectiveHierarchy})`);try{await $.syncRoleToLicensing(L.id,i,c,C,q,"licensing-wizard"),console.log(`ðŸ”„ [TeamRoleWizard] Role synced to Dashboard for: ${L.name}`)}catch(ye){console.warn("âš ï¸ [TeamRoleWizard] Failed to sync role to Dashboard:",ye)}}console.log(`ðŸ‘¥ [TeamRoleWizard] Adding team member to project: ${L==null?void 0:L.name} with role: ${R}`);try{if(!await p.addTeamMemberToProject(i,v.memberId,R))throw new Error(`Failed to add ${(L==null?void 0:L.name)||"team member"} to project`);console.log(`âœ… [TeamRoleWizard] Successfully added ${L==null?void 0:L.name} to project`)}catch(q){console.warn("âš ï¸ [TeamRoleWizard] TeamMemberService failed, trying UnifiedDataService:",q);try{await ca.addTeamMemberToProject(i,v.memberId,R),console.log(`âœ… [TeamRoleWizard] Successfully added ${L==null?void 0:L.name} via UnifiedDataService`)}catch(fe){throw new Error(`Failed to add ${(L==null?void 0:L.name)||"team member"}: ${fe.message}`)}}}console.log("ðŸŽ‰ [TeamRoleWizard] All assignments completed successfully!"),ne(`Successfully added ${Y.length} team member${Y.length!==1?"s":""} to the project!`),l&&(console.log("ðŸ”„ [TeamRoleWizard] Notifying parent component to refresh team members"),l()),setTimeout(()=>{r(),H()},2e3)}catch(p){console.error("âŒ [TeamRoleWizard] Error submitting:",p),_(p.message||"Failed to add team members")}finally{S(!1)}},ke=X.filter(p=>{var P;if(p.name==="ADMIN"){const v=Z.some(j=>{const L=X.find(R=>R.id===j.roleId);return(L==null?void 0:L.name)==="ADMIN"});if(T||v)return!1}if(Te==="templates"){if(!p.isTemplate)return!1}else if(Te==="custom"){if(p.isTemplate)return!1}else if(Te==="popular"&&(!p.isTemplate||!p.isPopular))return!1;if(Ee!=="all"&&p.industry&&p.industry!==Ee)return!1;if(ie.trim()){const v=ie.toLowerCase(),j=p.displayName.toLowerCase().includes(v),L=p.description.toLowerCase().includes(v),R=((P=p.tags)==null?void 0:P.some(he=>he.toLowerCase().includes(v)))||!1;if(!j&&!L&&!R)return!1}return!0}),Ne=()=>{switch(n){case 0:return e.jsxs(o,{textAlign:"center",py:4,children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"What would you like to do?"}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:4},children:"Choose an action to get started with team management"}),e.jsxs(x,{container:!0,spacing:3,justifyContent:"center",children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(oe,{sx:{cursor:"pointer",border:me==="add-members"?2:1,borderColor:me==="add-members"?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>Ae("add-members"),children:e.jsxs(be,{sx:{textAlign:"center",py:4},children:[e.jsx(xa,{sx:{fontSize:48,color:"primary.main",mb:2}}),e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Add Team Members"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Add new team members to this project and assign them roles"})]})})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(oe,{sx:{cursor:"pointer",border:me==="manage-roles"?2:1,borderColor:me==="manage-roles"?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>Ae("manage-roles"),children:e.jsxs(be,{sx:{textAlign:"center",py:4},children:[e.jsx(Is,{sx:{fontSize:48,color:"primary.main",mb:2}}),e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Manage Roles"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Create custom roles or use templates for your project"})]})})})]})]});case 1:return e.jsxs(o,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Select Team Members"}),e.jsxs(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:['Choose team members to add to "',t,'"']}),ee.length>0&&e.jsx(ge,{severity:"info",sx:{mb:3},children:e.jsxs(a,{variant:"body2",children:[e.jsx("strong",{children:"Current Team:"})," This project already has ",ee.length," team member",ee.length!==1?"s":""," assigned.",T&&e.jsx(e.Fragment,{children:" âœ… Project has an admin."}),!T&&e.jsx(e.Fragment,{children:" âš ï¸ Project needs an admin to be assigned."})]})}),e.jsx(te,{fullWidth:!0,placeholder:"Search team members...",value:ie,onChange:p=>de(p.target.value),InputProps:{startAdornment:e.jsx(tt,{sx:{mr:1,color:"text.secondary"}})},sx:{mb:3}}),e.jsx(oe,{children:e.jsxs(be,{children:[e.jsxs(a,{variant:"subtitle1",gutterBottom:!0,children:["Available Team Members (",ae.length,")"]}),ae.length===0?e.jsx(ge,{severity:"info",children:e.jsxs(a,{variant:"body2",children:[e.jsx("strong",{children:"No available team members found."}),ee.length>0?e.jsx(e.Fragment,{children:" All organization members are already assigned to this project. To reassign a member, please remove them from the project first using the Project Details panel."}):e.jsx(e.Fragment,{children:" No team members are available in your organization. Please add team members to your organization first."})]})}):e.jsx(At,{children:ae.filter(p=>{var P,v;return((P=p.name)==null?void 0:P.toLowerCase().includes(ie.toLowerCase()))||((v=p.email)==null?void 0:v.toLowerCase().includes(ie.toLowerCase()))}).map(p=>{var P,v;return e.jsxs(Rt,{divider:!0,children:[e.jsx(tr,{children:e.jsx(Rs,{src:p.avatar,children:((P=p.name)==null?void 0:P.charAt(0))||((v=p.email)==null?void 0:v.charAt(0))})}),e.jsx(wt,{primary:p.name||p.email,secondary:e.jsxs(o,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",children:p.email}),e.jsx(W,{label:p.tier,size:"small",sx:{mt:.5}})]})}),e.jsx(Tt,{children:e.jsx(ar,{checked:Y.some(j=>j.id===p.id),onChange:()=>K(p)})})]},p.id)})})]})}),Y.length>0&&e.jsx(oe,{sx:{mt:2},children:e.jsxs(be,{children:[e.jsxs(a,{variant:"subtitle1",gutterBottom:!0,children:["Selected Members (",Y.length,")"]}),e.jsx(o,{display:"flex",flexWrap:"wrap",gap:1,children:Y.map(p=>{var P,v;return e.jsx(W,{label:p.name||p.email,onDelete:()=>K(p),avatar:e.jsx(Rs,{src:p.avatar,children:((P=p.name)==null?void 0:P.charAt(0))||((v=p.email)==null?void 0:v.charAt(0))})},p.id)})})]})})]});case 2:return e.jsxs(o,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Assign Roles"}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Assign roles to the selected team members from our comprehensive template library"}),!T&&e.jsx(ge,{severity:"warning",sx:{mb:2},children:e.jsxs(a,{variant:"body2",children:[e.jsx("strong",{children:"âš ï¸ ADMIN Required!"})," This project doesn't have an administrator yet. You must assign the ADMIN role to at least one team member to proceed."]})}),e.jsx(ge,{severity:"info",sx:{mb:3},children:e.jsxs(a,{variant:"body2",children:[e.jsx("strong",{children:"50+ Professional Role Templates Available!"})," Choose from industry-specific roles including Film & TV, Corporate, Live Events, Education, Sports, Streaming, Music, and Marketing. Popular templates are shown by default.",T&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("strong",{children:"Note:"})," ADMIN role is not available as this project already has an administrator."]})]})}),e.jsxs(o,{sx:{mb:3},children:[e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsxs(Oe,{fullWidth:!0,size:"small",children:[e.jsx(Le,{children:"Role Type"}),e.jsxs(Fe,{value:Te,onChange:p=>Se(p.target.value),label:"Role Type",children:[e.jsx(M,{value:"popular",children:"Popular Templates"}),e.jsx(M,{value:"templates",children:"All Templates"}),e.jsx(M,{value:"custom",children:"Custom Roles"}),e.jsx(M,{value:"all",children:"All Roles"})]})]})}),e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsxs(Oe,{fullWidth:!0,size:"small",children:[e.jsx(Le,{children:"Industry"}),e.jsxs(Fe,{value:Ee,onChange:p=>we(p.target.value),label:"Industry",children:[e.jsx(M,{value:"all",children:"All Industries"}),e.jsx(M,{value:"FILM_TV",children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Ka,{fontSize:"small"}),"Film & TV"]})}),e.jsx(M,{value:"CORPORATE",children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Ya,{fontSize:"small"}),"Corporate"]})}),e.jsx(M,{value:"LIVE_EVENTS",children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Qa,{fontSize:"small"}),"Live Events"]})}),e.jsx(M,{value:"EDUCATION",children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Ja,{fontSize:"small"}),"Education"]})}),e.jsx(M,{value:"SPORTS",children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Xa,{fontSize:"small"}),"Sports"]})}),e.jsx(M,{value:"STREAMING",children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(Za,{fontSize:"small"}),"Streaming"]})}),e.jsx(M,{value:"MUSIC",children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(er,{fontSize:"small"}),"Music"]})}),e.jsx(M,{value:"MARKETING",children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(sr,{fontSize:"small"}),"Marketing"]})})]})]})}),e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsx(te,{fullWidth:!0,size:"small",placeholder:"Search roles...",value:ie,onChange:p=>de(p.target.value),InputProps:{startAdornment:e.jsx(tt,{sx:{mr:1,color:"text.secondary"}})}})})]}),e.jsxs(o,{sx:{mt:2,display:"flex",alignItems:"center",gap:1},children:[e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Showing ",ke.length," roles"]}),Te==="popular"&&e.jsx(W,{label:"Popular",size:"small",color:"primary"}),Ee!=="all"&&e.jsx(W,{label:Ee.replace("_"," "),size:"small",variant:"outlined",onDelete:()=>we("all")}),ie&&e.jsx(W,{label:`"${ie}"`,size:"small",variant:"outlined",onDelete:()=>de("")})]})]}),Y.map(p=>{var j,L;const P=Z.find(R=>R.memberId===p.id),v=P?ke.find(R=>R.id===P.roleId):null;return e.jsx(oe,{sx:{mb:2},children:e.jsxs(be,{children:[e.jsxs(o,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(Rs,{src:p.avatar,children:((j=p.name)==null?void 0:j.charAt(0))||((L=p.email)==null?void 0:L.charAt(0))}),e.jsxs(o,{flex:1,children:[e.jsx(a,{variant:"subtitle1",children:p.name||p.email}),e.jsx(a,{variant:"body2",color:"text.secondary",children:p.email})]})]}),e.jsxs(Oe,{fullWidth:!0,children:[e.jsx(Le,{children:"Assign Role"}),e.jsx(Fe,{value:(P==null?void 0:P.roleId)||"",onChange:R=>V(p.id,R.target.value),label:"Assign Role",children:ke.map(R=>e.jsx(M,{value:R.id,sx:{...R.name==="ADMIN"&&!T&&{backgroundColor:"rgba(255, 152, 0, 0.1)",border:"1px solid rgba(255, 152, 0, 0.3)","&:hover":{backgroundColor:"rgba(255, 152, 0, 0.2)"}}},children:e.jsxs(o,{display:"flex",alignItems:"center",gap:1,width:"100%",children:[e.jsx(o,{sx:{minWidth:24},children:R.name==="ADMIN"?e.jsx(Is,{fontSize:"small",color:"warning"}):R.icon?e.jsx(a,{sx:{fontSize:"1.2em"},children:R.icon}):e.jsx(Is,{fontSize:"small",color:"action"})}),e.jsxs(o,{flex:1,children:[e.jsxs(o,{display:"flex",alignItems:"center",gap:1,mb:.5,children:[e.jsxs(a,{variant:"body1",sx:{fontWeight:R.name==="ADMIN"?600:500,color:R.name==="ADMIN"&&!T?"warning.main":"inherit"},children:[R.displayName,R.name==="ADMIN"&&!T&&" âš ï¸ REQUIRED"]}),R.isPopular&&e.jsx(ea,{sx:{fontSize:16,color:"orange"}}),R.isTemplate&&e.jsx(W,{label:"Template",size:"small",sx:{height:16,fontSize:"0.65rem"}})]}),e.jsx(a,{variant:"caption",color:"text.secondary",display:"block",children:R.description}),R.industry&&e.jsxs(a,{variant:"caption",color:"primary.main",children:[R.industry.replace("_"," ")," â€¢ Level ",R.hierarchy]}),R.tags&&R.tags.length>0&&e.jsx(o,{sx:{mt:.5},children:R.tags.slice(0,3).map(he=>e.jsx(W,{label:he,size:"small",variant:"outlined",sx:{height:16,fontSize:"0.6rem",mr:.5,mb:.5}},he))})]}),e.jsxs(o,{textAlign:"right",children:[e.jsx(W,{label:R.category,size:"small",variant:"outlined",sx:{mb:.5}}),R.usageCount&&e.jsxs(a,{variant:"caption",color:"text.secondary",display:"block",children:[R.usageCount," uses"]})]})]})},R.id))})]}),v&&e.jsxs(ge,{severity:"info",sx:{mt:2},children:[e.jsxs(a,{variant:"body2",children:[e.jsx("strong",{children:v.displayName})," - Level ",v.hierarchy]}),e.jsx(a,{variant:"caption",children:v.description})]})]})},p.id)})]});case 3:return e.jsxs(o,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Review & Confirm"}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Review the team member assignments before confirming"}),e.jsx(oe,{children:e.jsxs(be,{children:[e.jsxs(a,{variant:"subtitle1",gutterBottom:!0,children:["Project: ",t]}),e.jsxs(a,{variant:"body2",color:"text.secondary",sx:{mb:3},children:["Adding ",Y.length," team member",Y.length!==1?"s":""]}),Y.map(p=>{var j,L;const P=Z.find(R=>R.memberId===p.id),v=P?X.find(R=>R.id===P.roleId):null;return e.jsxs(o,{display:"flex",alignItems:"center",gap:2,mb:2,children:[e.jsx(Rs,{src:p.avatar,children:((j=p.name)==null?void 0:j.charAt(0))||((L=p.email)==null?void 0:L.charAt(0))}),e.jsxs(o,{flex:1,children:[e.jsx(a,{variant:"body1",children:p.name||p.email}),e.jsx(a,{variant:"body2",color:"text.secondary",children:p.email})]}),e.jsxs(o,{textAlign:"right",children:[e.jsxs(o,{display:"flex",alignItems:"center",gap:1,justifyContent:"flex-end",mb:.5,children:[(v==null?void 0:v.icon)&&e.jsx(a,{sx:{fontSize:"1em"},children:v.icon}),e.jsx(W,{label:(v==null?void 0:v.displayName)||"No Role",color:v?"primary":"default",size:"small"}),(v==null?void 0:v.isPopular)&&e.jsx(ea,{sx:{fontSize:14,color:"orange"}})]}),e.jsxs(a,{variant:"caption",display:"block",color:"text.secondary",children:[v!=null&&v.isTemplate?"Template Role":"Custom Role"," â€¢ Level ",(v==null?void 0:v.hierarchy)||0]}),(v==null?void 0:v.industry)&&e.jsx(a,{variant:"caption",display:"block",color:"primary.main",children:v.industry.replace("_"," ")}),(v==null?void 0:v.tags)&&v.tags.length>0&&e.jsx(o,{sx:{mt:.5},children:v.tags.slice(0,2).map(R=>e.jsx(W,{label:R,size:"small",variant:"outlined",sx:{height:14,fontSize:"0.6rem",mr:.5}},R))})]})]},p.id)})]})})]});default:return null}};return e.jsxs(Ze,{open:u,onClose:r,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"600px"}},children:[e.jsx(es,{children:e.jsxs(o,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(o,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(ps,{color:"primary"}),e.jsxs(o,{children:[e.jsx(a,{variant:"h6",children:"Team & Role Management"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:t})]})]}),e.jsx(xs,{onClick:r,size:"small",children:e.jsx(Es,{})})]})}),e.jsxs(ss,{children:[e.jsx(ma,{activeStep:n,sx:{mb:4},children:vt.map(p=>e.jsx(ha,{children:e.jsx(pa,{children:p})},p))}),k&&e.jsx(ge,{severity:"error",sx:{mb:3},onClose:()=>_(null),children:k}),N&&e.jsx(ge,{severity:"success",sx:{mb:3},children:N}),w&&e.jsx(o,{display:"flex",justifyContent:"center",py:4,children:e.jsx(Ke,{})}),!w&&Ne()]}),e.jsxs(ts,{sx:{p:3,pt:0},children:[e.jsx(G,{onClick:r,disabled:w,children:"Cancel"}),e.jsx(o,{flex:1}),n>0&&e.jsx(G,{onClick:I,disabled:w,startIcon:e.jsx(Va,{}),children:"Back"}),n<vt.length-1?e.jsx(G,{variant:"contained",onClick:y,disabled:w,endIcon:e.jsx(qa,{}),children:"Next"}):e.jsx(G,{variant:"contained",onClick:ue,disabled:w||Y.length===0,startIcon:e.jsx(st,{}),children:w?"Adding...":"Add Team Members"})]})]})},gs=class gs{constructor(){_e(this,"baseUrl","https://us-central1-backbone-logic.cloudfunctions.net/api")}static getInstance(){return gs.instance||(gs.instance=new gs),gs.instance}async getAvailableRoles(r){var i,t;try{console.log(`ðŸŽ­ [ProjectRoleService] Fetching available roles for project: ${r}`);let c=0;const l=10;let h;for(;c<l;){const w=(i=window.firebase)==null?void 0:i.auth(),S=w==null?void 0:w.currentUser;if(S){h=await S.getIdToken();break}await new Promise(k=>setTimeout(k,100)),c++}if(!h)throw new Error("User not authenticated - Firebase not ready");const n=await fetch(`${this.baseUrl}/projects/${r}/available-roles`,{method:"GET",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"}});if(!n.ok){const w=await n.json().catch(()=>({}));throw new Error(w.error||"Failed to fetch available roles")}const A=await n.json();return console.log(`âœ… [ProjectRoleService] Fetched ${((t=A.data)==null?void 0:t.length)||0} available roles`),A.data||[]}catch(c){throw console.error("âŒ [ProjectRoleService] Error fetching available roles:",c),c}}async addTeamMemberToProject(r,i,t){var c;try{console.log(`ðŸŽ­ [ProjectRoleService] Adding team member ${i} to project ${r} with role ${t}`);let l=0;const h=10;let n;for(;l<h;){const S=(c=window.firebase)==null?void 0:c.auth(),k=S==null?void 0:S.currentUser;if(k){n=await k.getIdToken();break}await new Promise(_=>setTimeout(_,100)),l++}if(!n)throw new Error("User not authenticated - Firebase not ready");const A=await fetch(`${this.baseUrl}/projects/${r}/team-members`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({teamMemberId:i,roleId:t})});if(!A.ok){const S=await A.json().catch(()=>({}));throw new Error(S.error||"Failed to add team member to project")}const w=await A.json();console.log("âœ… [ProjectRoleService] Successfully added team member to project:",w)}catch(l){throw console.error("âŒ [ProjectRoleService] Error adding team member to project:",l),l}}getRoleDisplayColor(r){const i={ADMINISTRATIVE:"#ef4444",PRODUCTION:"#3b82f6",EDITORIAL:"#10b981",TECHNICAL:"#f59e0b",CREATIVE:"#8b5cf6",MANAGEMENT:"#f97316",default:"#6b7280"};return i[r]||i.default}formatRoleDescription(r){const i=r.hierarchy>=80?"High-level":r.hierarchy>=50?"Mid-level":"Entry-level";return`${r.description} (${i} - ${r.hierarchy})`}};_e(gs,"instance");let Mt=gs;const Zs=Mt.getInstance(),Xe=u=>{var c;if(!u)return 1;let r=0;if(u.licenses&&Array.isArray(u.licenses)){const l=u.licenses.filter(h=>h.status==="ACTIVE"||h.status==="PENDING");r+=l.length}if((c=u.subscription)!=null&&c.plan){const l=u.subscription.plan.toUpperCase();l==="ENTERPRISE"?r+=u.subscription.seats||100:l==="PRO"||l==="PROFESSIONAL"?r+=u.subscription.seats||25:l==="BASIC"&&(r+=u.subscription.seats||5)}if(u.organizationId&&!u.isTeamMember){const l=u.organizationLicenseCount||r;r=Math.max(r,l)}return Math.max(1,Math.min(r,1e3))},kt=(u,r=0,i=0)=>{var h;if((h=u.metadata)!=null&&h.extendedStatus){const n=u.metadata.extendedStatus;if(["draft","active","in-progress","completed","archived","paused"].includes(n))return n}if(u.isArchived||u.status==="archived")return"archived";if(u.status==="paused")return"paused";if(u.status==="completed")return"completed";if(u.status==="draft")return"draft";const t=r>0,c=i>0,l=u.lastAccessedAt&&new Date().getTime()-new Date(u.lastAccessedAt).getTime()<7*24*60*60*1e3;return t&&c&&l?"in-progress":(t||c)&&!l||l?"active":"draft"},_t=(u,r=0)=>{var i;return u.applicationMode==="shared_network"||r>0||((i=u.settings)==null?void 0:i.autoEnableCollaboration)!==!1||u.allowCollaboration===!0?!0:u.allowCollaboration!==!1},Ot=(u,r=0,i=0)=>{let t=0,c=0;if(u.name&&u.description?t+=20:u.name&&(t+=10),c+=20,r>0&&(t+=Math.min(30,r*10)),c+=30,i>0&&(t+=Math.min(25,i*5)),c+=25,u.lastAccessedAt){const l=(new Date().getTime()-new Date(u.lastAccessedAt).getTime())/864e5;l<=1?t+=25:l<=7?t+=15:l<=30&&(t+=5)}return c+=25,Math.min(100,Math.round(t/c*100))},Er=u=>{switch(u){case"draft":return"default";case"active":return"primary";case"in-progress":return"info";case"completed":return"success";case"archived":return"default";case"paused":return"warning";default:return"default"}},Ir=u=>{switch(u){case"draft":return e.jsx(Ds,{});case"active":return e.jsx(Et,{});case"in-progress":return e.jsx(ws,{});case"completed":return e.jsx(Bt,{});case"archived":return e.jsx(It,{});case"paused":return e.jsx(mr,{});default:return e.jsx(Ds,{})}},Dr=(u,r=0,i=0,t)=>{var A,w,S,k,_,N,ne,me,Ae,ae,f,Y,ve,X,pe,Z,xe,ee,ce,T;console.log("ðŸ” [DashboardCloudProjectsBridge] Mapping project:",u.name),console.log("ðŸ” [DashboardCloudProjectsBridge] Raw project data:",u),console.log("ðŸ” [DashboardCloudProjectsBridge] Team member count:",r),console.log("ðŸ” [DashboardCloudProjectsBridge] Dataset count:",i);const c=kt(u,r,i),l=_t(u,r),h=Ot(u,r,i),n=u.lastActivityAt||u.lastAccessedAt||u.updatedAt;return console.log("ðŸ” [DashboardCloudProjectsBridge] Calculated status:",c),console.log("ðŸ” [DashboardCloudProjectsBridge] Collaboration enabled:",l),console.log("ðŸ” [DashboardCloudProjectsBridge] Completion percentage:",h),{id:u.id,name:u.name,description:u.description,applicationMode:((A=u.settings)==null?void 0:A.applicationMode)||"shared_network",storageBackend:((w=u.settings)==null?void 0:w.storageBackend)||"firestore",gcsBucket:(S=u.settings)==null?void 0:S.gcsBucket,gcsPrefix:(k=u.settings)==null?void 0:k.gcsPrefix,s3Bucket:(_=u.settings)==null?void 0:_.s3Bucket,s3Region:(N=u.settings)==null?void 0:N.s3Region,s3Prefix:(ne=u.settings)==null?void 0:ne.s3Prefix,azureStorageAccount:(me=u.settings)==null?void 0:me.azureStorageAccount,azureContainer:(Ae=u.settings)==null?void 0:Ae.azureContainer,azurePrefix:(ae=u.settings)==null?void 0:ae.azurePrefix,lastAccessedAt:u.lastAccessedAt||new Date().toISOString(),isActive:c!=="archived"&&c!=="paused",isArchived:c==="archived",allowCollaboration:l,maxCollaborators:((f=u.settings)==null?void 0:f.maxCollaborators)||Xe(t),realTimeEnabled:((Y=u.settings)==null?void 0:Y.realTimeEnabled)||l,status:c,completionPercentage:h,lastActivityAt:n,teamMemberCount:r,collaborationEnabled:l,settings:{...u.settings,autoEnableCollaboration:((ve=u.settings)==null?void 0:ve.autoEnableCollaboration)??!0,completionCriteria:{requiresDatasets:!0,requiresTeamMembers:!0,minimumActivity:1,...(X=u.settings)==null?void 0:X.completionCriteria}},teamMemberRole:(Z=(pe=u.teamMembers)==null?void 0:pe[0])==null?void 0:Z.role,role:(ee=(xe=u.teamMembers)==null?void 0:xe[0])==null?void 0:ee.role,assignedAt:(T=(ce=u.teamMembers)==null?void 0:ce[0])==null?void 0:T.assignedAt,projectOwner:u.ownerId}},Gr=()=>{const{user:u}=ka(),{setLoading:r}=_a(),i=g.useCallback(()=>{if(!u)return null;const s=localStorage.getItem("auth_user");let d={...u};if(s)try{const m=JSON.parse(s);d={...u,...m,isTeamMember:m.isTeamMember||u.isTeamMember||m.role==="TEAM_MEMBER",organizationId:m.organizationId||u.organizationId,memberRole:m.memberRole||u.memberRole,memberStatus:m.memberStatus||u.memberStatus,teamMemberData:m.teamMemberData||u.teamMemberData}}catch(m){console.warn("Failed to parse stored user from localStorage:",m)}if(!d.subscription){const m=localStorage.getItem("user_subscription");if(m)try{const D=JSON.parse(m);d.subscription=D}catch(D){console.warn("Failed to parse subscription data from localStorage:",D)}const z=localStorage.getItem("user_billing");if(z&&!d.subscription)try{const D=JSON.parse(z);D.subscription&&(d.subscription=D.subscription)}catch(D){console.warn("Failed to parse billing data from localStorage:",D)}}return d},[u]),t=g.useMemo(()=>i(),[i]),c=g.useCallback(()=>{if(!t)return!1;if(t.memberRole==="OWNER"||t.role==="SUPERADMIN"||t.role==="ADMIN"||String(t.role).includes("ENTERPRISE"))return console.log("ðŸ” [DashboardCloudProjectsBridge] User is account owner - NOT a team member"),!1;const s=t.isTeamMember===!0||t.role==="TEAM_MEMBER";if(!s){const d=localStorage.getItem("team_member_data");if(d)try{const m=JSON.parse(d);if(m.memberRole==="OWNER"||m.role==="SUPERADMIN"||m.role==="ADMIN"||String(m.role).includes("ENTERPRISE"))return console.log("ðŸ” [DashboardCloudProjectsBridge] localStorage shows account owner - NOT a team member"),!1}catch(m){console.warn("Failed to parse team member data:",m)}}return console.log("ðŸ” [DashboardCloudProjectsBridge] User is team member:",s),s},[t]),l=g.useCallback(()=>{var d,m,z,D;if(!t)return console.log("ðŸ” [DashboardCloudProjectsBridge] No complete user data available"),!1;if(console.log("ðŸ” [DashboardCloudProjectsBridge] Checking permissions for user:",{id:t.id,email:t.email,role:t.role,memberRole:t.memberRole,isTeamMember:t.isTeamMember,organizationId:t.organizationId,subscription:t.subscription}),t.memberRole==="ENTERPRISE_ADMIN"||t.role==="ENTERPRISE_ADMIN"||String(t.role).includes("ENTERPRISE"))return console.log("âœ… [DashboardCloudProjectsBridge] User is enterprise user or admin, can create projects"),!0;if(!c())return((d=t.subscription)==null?void 0:d.status)==="ACTIVE"||((m=t.subscription)==null?void 0:m.status)==="TRIALING"||t.role==="SUPERADMIN"||t.role==="ADMIN"?(console.log("âœ… [DashboardCloudProjectsBridge] User is account owner with active subscription, can create projects"),!0):(z=t.subscription)!=null&&z.plan&&["BASIC","PRO","ENTERPRISE"].includes(t.subscription.plan)?(console.log("âœ… [DashboardCloudProjectsBridge] User is account owner with subscription plan, can create projects"),!0):t.isDemoUser||localStorage.getItem("demo_user_status")==="ACTIVE"?(console.log("âœ… [DashboardCloudProjectsBridge] User is demo user, can create projects"),!0):(console.log("âš ï¸ [DashboardCloudProjectsBridge] User is account owner but no active subscription or demo status"),!0);if(t.memberRole==="ADMIN"||t.role==="ADMIN")return console.log("âœ… [DashboardCloudProjectsBridge] Team member has ADMIN role, can create projects"),!0;const s=localStorage.getItem("team_member_data");if(s)try{const B=JSON.parse(s);if(console.log("ðŸ” [DashboardCloudProjectsBridge] Team member data from localStorage:",B),B.role==="ADMIN"||B.memberRole==="ADMIN"||B.role==="TEAM_ADMIN")return console.log("âœ… [DashboardCloudProjectsBridge] Team member data shows ADMIN role, can create projects"),!0}catch(B){console.warn("Failed to parse team member data for permissions check:",B)}return t.memberRole==="OWNER"||t.role==="OWNER"||String(t.memberRole).includes("OWNER")?(console.log("âœ… [DashboardCloudProjectsBridge] User has OWNER role, can create projects"),!0):t.role==="SUPERADMIN"?(console.log("âœ… [DashboardCloudProjectsBridge] User is SUPERADMIN, can create projects"),!0):(D=t.subscription)!=null&&D.plan&&["BASIC","PRO","ENTERPRISE"].includes(t.subscription.plan)?(console.log("âœ… [DashboardCloudProjectsBridge] User has subscription plan, allowing project creation"),!0):t.subscription?(console.log("âœ… [DashboardCloudProjectsBridge] User has subscription data, allowing project creation"),!0):(console.log("âŒ [DashboardCloudProjectsBridge] User cannot create projects - regular team member without admin privileges"),!1)},[t,c]),[h,n]=g.useState([]),[A,w]=g.useState(!0),[S,k]=g.useState(null),[_,N]=g.useState(0),[ne,me]=g.useState(!1),[Ae,ae]=g.useState(!1),[f,Y]=g.useState(null),[ve,X]=g.useState([]),[pe,Z]=g.useState(!1),[xe,ee]=g.useState([]),[ce,T]=g.useState([]),[E,Q]=g.useState(!1),[$,ie]=g.useState(""),[de,Te]=g.useState("all"),[Se,Ee]=g.useState(""),[we,Ie]=g.useState({}),[as,b]=g.useState(!1),[U,y]=g.useState(null),[I,H]=g.useState(0),[K,V]=g.useState(!1),[ue,ke]=g.useState(null),[Ne,p]=g.useState(!1),[P,v]=g.useState(!1),[j,L]=g.useState(null),[R,he]=g.useState(!1),[C,q]=g.useState(!1),[fe,ye]=g.useState(null),[Ms,ks]=g.useState(!1),[_s,Os]=g.useState(!1),[Ye,rs]=g.useState([]),[ms,hs]=g.useState([]),[$e,Ns]=g.useState(!1),[zs,rt]=g.useState(""),[Ft,Bs]=g.useState(""),[Ls,Fs]=g.useState([]),[Us,Ut]=g.useState(!1),[bs,ot]=g.useState(""),[fs,nt]=g.useState(!1),[it,Wt]=g.useState(!1),[$t,lt]=g.useState(null),[De,Ws]=g.useState(""),[ct,dt]=g.useState(0),[$s,ja]=g.useState(10),[ys,Gt]=g.useState({}),[js,Gs]=g.useState({}),[Ht,Vt]=g.useState({}),[qt,Kt]=g.useState(null),Hs=g.useCallback(async s=>{try{Z(!0),console.log("ðŸ” [DashboardCloudProjectsBridge] Loading datasets for project:",s.id);const d=await re.getProjectDatasets(s.id);console.log("âœ… [DashboardCloudProjectsBridge] Loaded assigned datasets:",d),X(d),Ie(m=>({...m,[s.id]:d.length}));try{const m=await re.listDatasets({backend:de==="all"?void 0:de,query:Se||void 0});console.log("âœ… [DashboardCloudProjectsBridge] Loaded available datasets:",m),console.log("ðŸ” [DashboardCloudProjectsBridge] === DATASET DEBUG INFO ==="),m.forEach((O,le)=>{var J;console.log(`ðŸ” [DashboardCloudProjectsBridge] Dataset ${le}:`,{id:O.id,name:O.name,organizationId:O.organizationId,storage:O.storage,idType:typeof O.id,idLength:(J=O.id)==null?void 0:J.length,fullDataset:O})}),console.log("ðŸ” [DashboardCloudProjectsBridge] === END DATASET DEBUG ===");const z=m.filter(O=>!O.id||typeof O.id!="string"||O.id.trim()==="");z.length>0&&console.warn("âš ï¸ [DashboardCloudProjectsBridge] Found datasets with invalid IDs:",z);const D=m.find(O=>O.id==="dataset-001");D?console.log("âœ… [DashboardCloudProjectsBridge] dataset-001 found:",D):(console.warn("âš ï¸ [DashboardCloudProjectsBridge] dataset-001 NOT found in available datasets!"),console.log("ðŸ” [DashboardCloudProjectsBridge] Available dataset IDs:",m.map(O=>O.id)));const B=m.map(O=>{var J;const le=se=>{switch(se){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...O,__label:`${O.name} ${le((J=O.storage)==null?void 0:J.backend)}`}});$&&!B.find(O=>O.id===$)&&(console.warn("âš ï¸ [DashboardCloudProjectsBridge] Clearing invalid selected dataset:",$),ie("")),ee(B)}catch(m){console.warn("âš ï¸ [DashboardCloudProjectsBridge] Failed to load available datasets, using empty list:",m),ee([])}}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load datasets for project:",d),X([]),ee([])}finally{Z(!1)}},[de,Se]),os=g.useCallback(async s=>{try{Ns(!0),console.log("ðŸ” [DashboardCloudProjectsBridge] Loading team members for project:",s.id);try{const d=await re.getProjectTeamMembers(s.id);console.log("âœ… [DashboardCloudProjectsBridge] Loaded assigned team members:",d),rs(d)}catch(d){console.warn("âš ï¸ [DashboardCloudProjectsBridge] Failed to load assigned team members, using empty list:",d),rs([])}try{const d=await re.getLicensedTeamMembers({search:bs||void 0,excludeProjectId:s.id});console.log("âœ… [DashboardCloudProjectsBridge] Loaded available team members:",d),hs(d)}catch(d){console.warn("âš ï¸ [DashboardCloudProjectsBridge] Failed to load licensed team members, using empty list:",d),hs([])}}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load team members for project:",d),rs([]),hs([])}finally{Ns(!1)}},[bs]);g.useEffect(()=>{f&&(console.log("ðŸ”„ [DashboardCloudProjectsBridge] Project selected, loading data..."),Hs(f),os(f))},[f,Hs,os]),g.useEffect(()=>{f&&fs&&!Us&&Ls.length===0&&(async()=>{try{Ut(!0),console.log("ðŸŽ­ [DashboardCloudProjectsBridge] Loading available roles for project:",f.id);const d=await Zs.getAvailableRoles(f.id);if(console.log(`âœ… [DashboardCloudProjectsBridge] Found ${(d==null?void 0:d.length)||0} available roles`),Fs(d||[]),d&&d.length>0){const m=d.find(z=>z.name==="DO_ER")||d[0];Bs(m.id)}}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load available roles:",d),Fs([])}finally{Ut(!1)}})()},[f,fs,Us,Ls.length]),g.useEffect(()=>{Ge();const s=d=>{Ge()};return window.addEventListener("project:created",s),()=>window.removeEventListener("project:created",s)},[]);const Vs=g.useMemo(()=>{if(!De.trim())return h;const s=De.toLowerCase();return h.filter(d=>d.name.toLowerCase().includes(s)||d.description&&d.description.toLowerCase().includes(s)||d.storageBackend.toLowerCase().includes(s)||d.applicationMode.toLowerCase().includes(s))},[h,De]);g.useEffect(()=>{dt(0)},[De]);const vs=g.useMemo(()=>{console.log("ðŸ” [DashboardCloudProjectsBridge] Filtering projects for tab:",_),console.log("ðŸ” [DashboardCloudProjectsBridge] All filtered projects:",Vs);const s=Vs.filter(d=>{const m=_===0,z=m?d.isActive&&!d.isArchived:d.isArchived;return console.log(`ðŸ” [DashboardCloudProjectsBridge] Project "${d.name}":`,{isActive:d.isActive,isArchived:d.isArchived,isActiveTab:m,shouldShow:z}),z});return console.log("ðŸ” [DashboardCloudProjectsBridge] Filtered projects for display:",s),s},[Vs,_]),va=g.useMemo(()=>{const s=ct*$s;return vs.slice(s,s+$s)},[vs,ct,$s]);g.useEffect(()=>{if(f&&fs){const s=setTimeout(()=>{console.log("ðŸ”„ [DashboardCloudProjectsBridge] Team member search changed, refreshing..."),os(f)},300);return()=>clearTimeout(s)}},[bs,f,fs,os]),g.useCallback(async s=>{try{console.log("ðŸ” [DashboardCloudProjectsBridge] Loading team member counts for all projects...");const d=s.map(async D=>{try{const B=await re.getProjectTeamMembers(D.id);return{projectId:D.id,count:B.length}}catch(B){return console.warn(`âš ï¸ [DashboardCloudProjectsBridge] Failed to load team members for project ${D.id}:`,B),{projectId:D.id,count:0}}}),m=await Promise.all(d),z={};m.forEach(({projectId:D,count:B})=>{z[D]=B}),Gt(z),console.log("âœ… [DashboardCloudProjectsBridge] Loaded team member counts for all projects:",z)}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load team member counts for all projects:",d)}},[]);const qs=g.useCallback(async s=>{try{console.log("ðŸ” [DashboardCloudProjectsBridge] Loading dataset counts for all projects...");try{const m=(await re.getAllOrganizationDatasets()).length,z={};s.forEach(D=>{z[D.id]=m}),Ie(z),console.log(`âœ… [DashboardCloudProjectsBridge] Loaded total dataset count for organization: ${m}`)}catch{console.warn("âš ï¸ [DashboardCloudProjectsBridge] Failed to load organization datasets, falling back to per-project counts");const m=s.map(async B=>{try{const O=await re.getProjectDatasets(B.id);return{projectId:B.id,count:O.length}}catch(O){return console.warn(`âš ï¸ [DashboardCloudProjectsBridge] Failed to load datasets for project ${B.id}:`,O),{projectId:B.id,count:0}}}),z=await Promise.all(m),D={};z.forEach(({projectId:B,count:O})=>{D[B]=O}),Ie(D),console.log("âœ… [DashboardCloudProjectsBridge] Loaded dataset counts for all projects (fallback):",D)}}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load dataset counts for all projects:",d)}},[]),Ge=async()=>{try{if(k(null),w(!0),c())try{console.log("ðŸ” [DashboardCloudProjectsBridge] Web-only mode: Fetching projects from Firestore...");const s=u;if(!(s!=null&&s.organizationId))throw console.warn("âš ï¸ [DashboardCloudProjectsBridge] No organization ID found for user"),new Error("No organization found for user");const{db:d}=await Zt(async()=>{const{db:F}=await import("./firebase-BzaqTwdK.js");return{db:F}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),{collection:m,query:z,where:D,getDocs:B}=await Zt(async()=>{const{collection:F,query:ze,where:is,getDocs:He}=await import("./index.esm-9jaBBmwp.js");return{collection:F,query:ze,where:is,getDocs:He}},__vite__mapDeps([7,6])),O=z(m(d,"projects"),D("organizationId","==",s.organizationId)),le=await B(O);console.log(`ðŸ” [DashboardCloudProjectsBridge] Found ${le.size} projects for organization: ${s.organizationId}`);const J=le.docs.map(F=>({id:F.id,projectId:F.id,...F.data(),name:F.data().name||F.data().projectName||"Unnamed Project",projectName:F.data().name||F.data().projectName||"Unnamed Project",description:F.data().description||"",role:"MEMBER",teamMemberRole:"MEMBER",isActive:F.data().isActive!==!1,isArchived:F.data().isArchived===!0,assignedAt:F.data().createdAt||new Date().toISOString(),lastAccessed:F.data().lastAccessedAt||F.data().createdAt||new Date().toISOString(),ownerName:F.data().ownerName||"Organization Owner"}));console.log("ðŸ” [DashboardCloudProjectsBridge] Team member projects from Firestore:",J);const se=J.map(F=>{console.log("ðŸ” [DashboardCloudProjectsBridge] Transforming project:",F);const ze=1,is=0,He=kt(F,ze,is),Me=_t(F,ze),Qs=Ot(F,ze,is),Je={id:F.projectId||F.id,name:F.projectName||F.name||"Unnamed Project",description:F.description||"",applicationMode:"shared_network",storageBackend:"firestore",lastAccessedAt:F.lastAccessed||F.assignedAt||new Date().toISOString(),isActive:He!=="archived"&&He!=="paused",isArchived:He==="archived",allowCollaboration:Me,maxCollaborators:F.maxCollaborators||Xe(t),realTimeEnabled:Me,status:He,completionPercentage:Qs,lastActivityAt:F.lastAccessed||F.assignedAt||new Date().toISOString(),teamMemberCount:ze,collaborationEnabled:Me,settings:{autoEnableCollaboration:!0,completionCriteria:{requiresDatasets:!0,requiresTeamMembers:!0,minimumActivity:1}},teamMemberRole:F.role||F.teamMemberRole||"MEMBER",role:F.role||F.teamMemberRole||"MEMBER",assignedAt:F.assignedAt,projectOwner:F.ownerName||"Organization Owner"};return console.log("ðŸ” [DashboardCloudProjectsBridge] Transformed to:",Je),Je});n(se),await qs(se)}catch(s){console.error("Failed to fetch team member projects:",s);const d=localStorage.getItem("team_member_data");if(d)try{const D=JSON.parse(d);if(D.projectAccess&&Array.isArray(D.projectAccess)){const B=D.projectAccess.map(O=>{const se=kt(O,1,0),F=_t(O,1),ze=Ot(O,1,0);return{id:O.projectId,name:O.projectName||"Unnamed Project",description:O.description||"",applicationMode:"shared_network",storageBackend:"firestore",lastAccessedAt:O.lastAccessed||new Date().toISOString(),isActive:se!=="archived"&&se!=="paused",isArchived:se==="archived",allowCollaboration:F,maxCollaborators:Xe(t),realTimeEnabled:F,status:se,completionPercentage:ze,lastActivityAt:O.lastAccessed||new Date().toISOString(),teamMemberCount:1,collaborationEnabled:F,settings:{autoEnableCollaboration:!0,completionCriteria:{requiresDatasets:!0,requiresTeamMembers:!0,minimumActivity:1}},teamMemberRole:O.role||"MEMBER",assignedAt:O.assignedAt,projectOwner:"Organization Owner"}});n(B),await qs(B);return}}catch(D){console.warn("Failed to parse fallback team member data:",D)}const z=Object.keys(localStorage).filter(D=>D.includes("team")||D.includes("member")||D.includes("project")||D.includes("assignment"));for(const D of z)try{const B=localStorage.getItem(D);if(B){const O=JSON.parse(B);O.projects||O.projectAccess||O.assignments}}catch{}k("Unable to load your assigned projects. Please contact your administrator or try again later."),n([])}else{console.log("ðŸ” [DashboardCloudProjectsBridge] Loading projects for account owner...");const s=await re.getProjects();console.log("ðŸ” [DashboardCloudProjectsBridge] Raw service projects:",s),console.log("ðŸ” [DashboardCloudProjectsBridge] Service projects count:",s.length),console.log("ðŸ” [DashboardCloudProjectsBridge] Loading team member and dataset counts...");const d=s.map(async J=>{try{const se=await re.getProjectTeamMembers(J.id);return{projectId:J.id,count:se.length}}catch(se){return console.warn(`âš ï¸ [DashboardCloudProjectsBridge] Failed to load team members for project ${J.id}:`,se),{projectId:J.id,count:0}}}),m=s.map(async J=>{try{const se=await re.getProjectDatasets(J.id);return{projectId:J.id,count:se.length}}catch(se){return console.warn(`âš ï¸ [DashboardCloudProjectsBridge] Failed to load datasets for project ${J.id}:`,se),{projectId:J.id,count:0}}}),[z,D]=await Promise.all([Promise.all(d),Promise.all(m)]),B={},O={};z.forEach(({projectId:J,count:se})=>{B[J]=se}),D.forEach(({projectId:J,count:se})=>{O[J]=se}),Gt(B),Ie(O);const le=s.map(J=>Dr(J,B[J.id]||0,O[J.id]||0,t));console.log("ðŸ” [DashboardCloudProjectsBridge] Mapped cloud projects with enhanced data:",le),console.log("ðŸ” [DashboardCloudProjectsBridge] Mapped projects count:",le.length),n(le),console.log("âœ… [DashboardCloudProjectsBridge] Projects set in state with enhanced status and collaboration logic")}}catch(s){console.error("Failed to load projects:",s),k((s==null?void 0:s.message)||"Failed to load projects"),n([])}finally{w(!1)}},Ca=async()=>{try{const s="https://backbone-client.web.app/";let d=!1;try{const m=document.createElement("a");m.href=s,m.target="_blank",m.rel="noopener noreferrer",document.body.appendChild(m),m.click(),document.body.removeChild(m),d=!0}catch{}d||(window.location.href=s)}catch(s){console.error("Failed to launch web app",s),k("Unable to open web app. Please try again.")}},Sa=()=>{try{const m="dashboardv14://open-app";window.location.href=m}catch(s){console.error("Failed to open desktop deep link",s),k("Unable to open Desktop app. Please ensure it is installed.")}},Yt=()=>{me(!0),Y(null)},Aa=(s,d)=>{dt(d)},Ra=s=>{ja(parseInt(s.target.value,10)),dt(0)},wa=(s,d)=>{Vt(m=>({...m,[d]:s.currentTarget}))},Qe=s=>{Vt(d=>({...d,[s]:null}))},Ta=s=>{Kt(s.currentTarget)},ns=()=>{Kt(null)},Ea=async s=>{me(!1),await Ge()},Cs=g.useCallback(async(s,d)=>{try{Gs(z=>({...z,[s]:!0}));let m;switch(d){case"draft":m="draft";break;case"active":case"in-progress":case"completed":m="active";break;case"archived":case"paused":m="archived";break;default:m="active"}await re.updateProject(s,{status:m,lastActivityAt:new Date().toISOString(),isActive:m!=="archived",isArchived:m==="archived",metadata:{extendedStatus:d,statusUpdatedAt:new Date().toISOString()}}),await Ge(),console.log(`âœ… [DashboardCloudProjectsBridge] Project ${s} status updated to ${d} (mapped to ${m})`)}catch(m){console.error("âŒ [DashboardCloudProjectsBridge] Failed to update project status:",m),k(`Failed to update project status: ${m instanceof Error?m.message:"Unknown error"}`)}finally{Gs(m=>({...m,[s]:!1}))}},[]),Ia=g.useCallback(async(s,d)=>{try{Gs(z=>({...z,[s]:!0}));const m=Xe(t);await re.updateProject(s,{settings:{allowCollaboration:d,autoEnableCollaboration:d,realTimeEnabled:d,maxCollaborators:d?m:1},allowCollaboration:d,collaborationEnabled:d,realTimeEnabled:d,maxCollaborators:d?m:1,lastActivityAt:new Date().toISOString()}),await Ge(),console.log(`âœ… [DashboardCloudProjectsBridge] Project ${s} collaboration ${d?"enabled":"disabled"}`)}catch(m){console.error("âŒ [DashboardCloudProjectsBridge] Failed to toggle collaboration:",m),k(`Failed to update collaboration settings: ${m instanceof Error?m.message:"Unknown error"}`)}finally{Gs(m=>({...m,[s]:!1}))}},[]),Qt=s=>{switch(s){case"firestore":return e.jsx(Ts,{});case"gcs":return e.jsx(We,{});default:return e.jsx(Ct,{})}},Jt=s=>s==="standalone"?e.jsx(Ct,{}):e.jsx(Js,{}),Da=s=>{const d=new Date(s),z=new Date().getTime()-d.getTime(),D=Math.floor(z/(1e3*60*60*24));return D===0?"Today":D===1?"Yesterday":D<7?`${D} days ago`:d.toLocaleDateString()},ut=h.filter(s=>s.isActive&&!s.isArchived),gt=h.filter(s=>s.isArchived),Ks={totalProjects:h.length,activeProjects:ut.length,archivedProjects:gt.length,collaborativeProjects:h.filter(s=>s.allowCollaboration).length,totalDatasets:Object.values(we).reduce((s,d)=>s+d,0),storageBreakdown:{firestore:h.filter(s=>s.storageBackend==="firestore").length,gcs:h.filter(s=>s.storageBackend==="gcs").length,s3:h.filter(s=>s.storageBackend==="s3").length,local:h.filter(s=>s.storageBackend==="local").length,azure:h.filter(s=>s.storageBackend==="azure-blob").length},modeBreakdown:{standalone:h.filter(s=>s.applicationMode==="standalone").length,network:h.filter(s=>s.applicationMode==="shared_network").length}};g.useCallback(async()=>{h.length>0&&await qs(h)},[h,qs]);const mt=g.useCallback(async()=>{try{Q(!0),console.log("ðŸ” [DashboardCloudProjectsBridge] Loading organization datasets for management dialog...");const s=await re.getAllOrganizationDatasets();console.log("âœ… [DashboardCloudProjectsBridge] Loaded organization datasets:",s);const d=s.map(m=>{var D;const z=B=>{switch(B){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...m,__label:`${m.name} ${z((D=m.storage)==null?void 0:D.backend)}`}});T(d)}catch(s){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load organization datasets:",s)}finally{Q(!1)}},[]);g.useEffect(()=>{Ne&&mt()},[Ne,mt]);const Ys=g.useCallback(async()=>{if(!(t!=null&&t.organizationId)){console.warn("âš ï¸ [DashboardCloudProjectsBridge] No organization ID for dataset analysis");return}he(!0);try{console.log("ðŸ” [DashboardCloudProjectsBridge] Loading dataset conflict analysis...");const s=await re.getAllOrganizationDatasets(),d=await Lt.analyzeOrganizationDatasets(t.organizationId,s);L(d),console.log("âœ… [DashboardCloudProjectsBridge] Dataset analysis complete:",{datasets:d.totalDatasets,overlaps:d.overlaps.length,healthScore:d.healthScore})}catch(s){console.error("âŒ [DashboardCloudProjectsBridge] Failed to load dataset analysis:",s),L(null)}finally{he(!1)}},[t==null?void 0:t.organizationId]);g.useEffect(()=>{P&&Ys()},[P,Ys]);const Xt=g.useCallback(()=>{if(!t){console.log("ðŸ” [DashboardCloudProjectsBridge] No user data available for subscription debug");return}console.log("ðŸ” [DashboardCloudProjectsBridge] === SUBSCRIPTION DEBUG INFO ==="),console.log("User ID:",t.id),console.log("User Email:",t.email),console.log("User Role:",t.role),console.log("Member Role:",t.memberRole),console.log("Is Team Member:",t.isTeamMember),console.log("Organization ID:",t.organizationId),console.log("Subscription Data:",t.subscription),console.log("Demo User Status:",t.isDemoUser),console.log("LocalStorage Demo Status:",localStorage.getItem("demo_user_status")),console.log("LocalStorage Subscription:",localStorage.getItem("user_subscription")),console.log("LocalStorage Billing:",localStorage.getItem("user_billing")),console.log("==========================================")},[t]);return g.useEffect(()=>{if(t&&t.id){const s=`subscription_debug_${t.id}`;sessionStorage.getItem(s)||(Xt(),sessionStorage.setItem(s,"true"))}},[t,Xt]),e.jsxs(o,{sx:{py:4,px:3},children:[e.jsx(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:e.jsxs(o,{children:[e.jsx(a,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:c()?"My Assigned Projects":"Cloud Projects"}),e.jsx(a,{variant:"body1",color:"text.secondary",children:c()?l()?"Manage and collaborate on projects. As an admin, you can create new projects and access assigned ones.":"Access and collaborate on projects assigned to you by your team administrator":"Manage your projects with Firebase and Google Cloud Storage integration. Available for all license tiers: Basic, Pro, and Enterprise."}),c()&&t&&e.jsxs(o,{sx:{mt:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{icon:e.jsx(sa,{}),label:`Team Member - ${t.memberRole||"MEMBER"}`,color:"primary",size:"small",sx:{backgroundColor:"rgba(0, 212, 255, 0.1)",border:"1px solid rgba(0, 212, 255, 0.3)",color:"primary.main"}}),t.organizationId&&e.jsx(W,{icon:e.jsx(rr,{}),label:"Organization Access",color:"secondary",size:"small",sx:{backgroundColor:"rgba(156, 39, 176, 0.1)",border:"1px solid rgba(156, 39, 176, 0.3)",color:"secondary.main"}})]})]})}),A?e.jsx(x,{container:!0,spacing:3,sx:{mb:4},children:[1,2,3,4].map(s=>e.jsx(x,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(oe,{sx:{height:"100%"},children:e.jsx(be,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(o,{sx:{width:60,height:32,bgcolor:"grey.300",borderRadius:1,mb:1}}),e.jsx(o,{sx:{width:100,height:16,bgcolor:"grey.200",borderRadius:1}})]}),e.jsx(o,{sx:{width:40,height:40,bgcolor:"grey.200",borderRadius:"50%"}})]})})})},s))}):e.jsxs(x,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(x,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(oe,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(102, 126, 234, 0.3)"}},children:e.jsx(be,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(a,{variant:"h4",fontWeight:"bold",children:Ks.totalProjects}),e.jsx(a,{variant:"body2",sx:{opacity:.9},children:c()?"Assigned Projects":"Total Projects"})]}),e.jsx(ws,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(x,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(oe,{sx:{background:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(17, 153, 142, 0.3)"}},onClick:()=>N(0),children:e.jsx(be,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(a,{variant:"h4",fontWeight:"bold",children:Ks.activeProjects}),e.jsx(a,{variant:"body2",sx:{opacity:.9},children:"Active Projects"})]}),e.jsx(Et,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(x,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(oe,{sx:{background:"linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(252, 74, 26, 0.3)"}},onClick:()=>N(1),children:e.jsx(be,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(a,{variant:"h4",fontWeight:"bold",children:Ks.archivedProjects}),e.jsx(a,{variant:"body2",sx:{opacity:.9},children:"Archived Projects"})]}),e.jsx(It,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(x,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(oe,{sx:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(79, 172, 254, 0.3)"}},children:e.jsx(be,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{children:[e.jsx(a,{variant:"h4",fontWeight:"bold",children:c()&&t?(t.memberRole||"MEMBER").toUpperCase():Ks.collaborativeProjects}),e.jsx(a,{variant:"body2",sx:{opacity:.9},children:c()?"Your Role":"Collaborative"})]}),e.jsx(ps,{sx:{fontSize:40,opacity:.8}})]})})})})]}),A?e.jsx(x,{container:!0,spacing:3,sx:{mb:4},children:[1,2].map(s=>e.jsx(x,{item:!0,xs:12,lg:6,children:e.jsx(oe,{sx:{height:"100%"},children:e.jsxs(be,{children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(o,{sx:{width:24,height:24,bgcolor:"grey.300",borderRadius:"50%"}}),e.jsx(o,{sx:{width:200,height:20,bgcolor:"grey.300",borderRadius:1}})]}),[1,2,3].map(d=>e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(o,{sx:{width:20,height:20,bgcolor:"grey.200",borderRadius:"50%"}}),e.jsx(o,{sx:{width:80,height:16,bgcolor:"grey.200",borderRadius:1}})]}),e.jsx(o,{sx:{width:40,height:24,bgcolor:"grey.200",borderRadius:1}})]},d))]})})},s))}):null,S&&e.jsx(ge,{severity:"error",sx:{mb:4},onClose:()=>k(null),children:S}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:4},children:[e.jsxs(or,{value:_,onChange:(s,d)=>N(d),sx:{borderBottom:1,borderColor:"divider"},children:[e.jsx(ta,{label:`Active Projects (${ut.length})`}),e.jsx(ta,{label:`Archived (${gt.length})`})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[!l()&&t&&e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,px:2,py:1,backgroundColor:"warning.light",borderRadius:1,border:"1px solid",borderColor:"warning.main"},children:[e.jsx(Ds,{color:"warning"}),e.jsx(a,{variant:"body2",color:"warning.dark",children:c()?"Contact your team administrator to create projects":"Active subscription required to create projects"})]}),e.jsx(G,{variant:"contained",startIcon:e.jsx(aa,{}),onClick:Ta,sx:{background:"linear-gradient(135deg, #4f46e5, #7c3aed)",color:"white",borderRadius:2,px:3,py:1.5,textTransform:"none",fontWeight:600,boxShadow:"0 6px 20px rgba(79, 70, 229, 0.4)","&:hover":{background:"linear-gradient(135deg, #4338ca, #6d28d9)",boxShadow:"0 8px 25px rgba(79, 70, 229, 0.5)",transform:"translateY(-2px)"}},children:"Actions"}),e.jsxs(ra,{anchorEl:qt,open:!!qt,onClose:ns,PaperProps:{sx:{backgroundColor:"rgba(30, 30, 30, 0.95)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:2,minWidth:200,"& .MuiMenuItem-root":{color:"white","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}}}},children:[l()&&e.jsxs(M,{onClick:()=>{ns(),console.log("ðŸš€ [DashboardCloudProjectsBridge] Create Project button clicked"),Yt()},children:[e.jsx(As,{sx:{mr:2}}),"Create Project"]}),l()&&e.jsxs(M,{onClick:()=>{ns(),console.log("ðŸš€ [DashboardCloudProjectsBridge] Create Dataset button clicked"),ke(null),V(!0)},children:[e.jsx(qe,{sx:{mr:2}}),"Create Dataset"]}),l()&&e.jsxs(M,{onClick:()=>{ns(),console.log("ðŸš€ [DashboardCloudProjectsBridge] Manage Datasets button clicked"),p(!0)},children:[e.jsx(We,{sx:{mr:2}}),"Manage Datasets"]}),l()&&e.jsxs(M,{onClick:()=>{ns(),console.log("ðŸš€ [DashboardCloudProjectsBridge] Dataset Insights button clicked"),v(!0)},children:[e.jsx(ws,{sx:{mr:2}}),"Dataset Insights"]}),e.jsx(M,{disabled:!0,sx:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",my:1}}),e.jsxs(M,{onClick:()=>{ns(),Ca()},children:[e.jsx(oa,{sx:{mr:2}}),"Launch Web App"]}),e.jsxs(M,{onClick:()=>{ns(),Sa()},children:[e.jsx(oa,{sx:{mr:2}}),"Launch Desktop App"]})]})]})]}),e.jsxs(o,{sx:{mb:4,display:"flex",gap:3,alignItems:"center"},children:[e.jsx(te,{fullWidth:!0,placeholder:"Search projects by name, description, storage backend, or mode...",value:De,onChange:s=>Ws(s.target.value),InputProps:{startAdornment:e.jsx(ua,{position:"start",children:e.jsx(tt,{})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,"&:hover fieldset":{borderColor:"primary.main"}}}}),e.jsx(G,{variant:"outlined",onClick:Ge,sx:{minWidth:"auto",px:3},title:"Refresh projects list",children:"Refresh"})]}),e.jsxs(o,{children:[c()&&h.length>0&&e.jsx(o,{sx:{mb:3,p:3,backgroundColor:"rgba(0, 212, 255, 0.1)",borderRadius:2,border:"1px solid rgba(0, 212, 255, 0.3)"},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(sa,{sx:{color:"primary.main",fontSize:24}}),e.jsxs(o,{children:[e.jsx(a,{variant:"h6",color:"primary.main",sx:{fontWeight:600,mb:1},children:"Team Member Access"}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:["You have access to ",h.length," project",h.length!==1?"s":""," assigned by your team administrator. Click on any project to view details and launch the application."]})]})]})}),A?e.jsx(o,{sx:{textAlign:"center",py:4},children:e.jsx(a,{children:"Loading projects..."})}):e.jsxs(e.Fragment,{children:[De&&e.jsx(o,{sx:{mb:2,p:2,backgroundColor:"primary.light",borderRadius:2,color:"white"},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(a,{variant:"body2",children:["Found ",Vs.filter(s=>_===0?s.isActive&&!s.isArchived:s.isArchived).length,' projects matching "',De,'"']}),e.jsx(G,{size:"small",variant:"text",onClick:()=>Ws(""),sx:{color:"white",textDecoration:"underline"},children:"Clear Search"})]})}),e.jsx(nr,{component:Be,sx:{borderRadius:2,overflow:"auto",boxShadow:2,maxHeight:"70vh",width:"100%"},children:e.jsxs(ir,{sx:{width:"100%"},stickyHeader:!0,children:[e.jsx(lr,{children:e.jsxs(na,{sx:{backgroundColor:"primary.main"},children:[e.jsx(je,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Project"}),e.jsx(je,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Status"}),e.jsx(je,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Mode"}),e.jsx(je,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Storage"}),c()&&e.jsx(je,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Your Role"}),e.jsx(je,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Team"}),e.jsx(je,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Datasets"}),e.jsx(je,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Collaboration"}),e.jsx(je,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Last Accessed"}),e.jsx(je,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Actions"})]})}),e.jsx(cr,{children:va.map(s=>e.jsxs(na,{sx:{"&:hover":{backgroundColor:"action.hover",cursor:"pointer"},"&:nth-of-type(odd)":{backgroundColor:"action.hover"}},children:[e.jsx(je,{children:e.jsx(a,{variant:"subtitle1",fontWeight:600,children:s.name})}),e.jsx(je,{children:e.jsx(W,{size:"small",icon:Ir(s.status),label:s.status.charAt(0).toUpperCase()+s.status.slice(1).replace("-"," "),color:Er(s.status),variant:"filled",sx:{fontWeight:600}})}),e.jsx(je,{children:e.jsx(W,{size:"small",icon:Jt(s.applicationMode),label:s.applicationMode==="standalone"?"Standalone":"Network",color:"primary",variant:"outlined"})}),e.jsx(je,{children:e.jsx(W,{size:"small",icon:Qt(s.storageBackend),label:s.storageBackend,variant:"outlined"})}),c()&&e.jsx(je,{children:e.jsx(W,{size:"small",label:s.teamMemberRole||s.role||"MEMBER",color:"primary",variant:"outlined",sx:{backgroundColor:"rgba(0, 212, 255, 0.1)",borderColor:"rgba(0, 212, 255, 0.3)",color:"primary.main",fontWeight:600}})}),e.jsx(je,{children:typeof ys[s.id]=="number"?e.jsx(W,{size:"small",icon:e.jsx(ps,{}),label:`${ys[s.id]} member${ys[s.id]!==1?"s":""}`,variant:"outlined",color:ys[s.id]>0?"primary":"default",title:`${ys[s.id]} team members assigned to this project`}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(je,{children:typeof we[s.id]=="number"?e.jsx(W,{size:"small",icon:e.jsx(qe,{}),label:`${we[s.id]} dataset${we[s.id]!==1?"s":""}`,variant:"outlined",color:we[s.id]>0?"secondary":"default",title:`${we[s.id]} datasets assigned to this project`}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(je,{children:s.collaborationEnabled?e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{size:"small",icon:e.jsx(ps,{}),label:`${s.maxCollaborators||Xe(t)} licenses`,variant:"outlined",color:"success",sx:{fontWeight:600},title:`Based on your active licenses: ${s.maxCollaborators||Xe(t)} users can collaborate`}),s.realTimeEnabled&&e.jsx(W,{size:"small",label:"Real-time",variant:"filled",color:"info",sx:{fontSize:"0.7rem",height:"20px"}})]}):e.jsx(W,{size:"small",label:"Disabled",variant:"outlined",color:"default",sx:{color:"text.secondary"}})}),e.jsx(je,{children:e.jsx(a,{variant:"body2",children:Da(s.lastAccessedAt)})}),e.jsx(je,{children:e.jsxs(o,{sx:{display:"flex",justifyContent:"center"},children:[e.jsx(xs,{size:"small",onClick:d=>wa(d,s.id),sx:{color:"text.secondary","&:hover":{backgroundColor:"action.hover",color:"text.primary"}},children:e.jsx(aa,{})}),e.jsxs(ra,{anchorEl:Ht[s.id],open:!!Ht[s.id],onClose:()=>Qe(s.id),anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:2,minWidth:200,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)"}},children:[e.jsxs(M,{onClick:()=>{Y(s),Qe(s.id)},sx:{py:1.5},children:[e.jsx(ga,{sx:{mr:2,fontSize:20}}),e.jsx(a,{variant:"body2",children:"Details"})]}),s.status==="draft"&&e.jsxs(M,{onClick:()=>{Cs(s.id,"active"),Qe(s.id)},disabled:js[s.id],sx:{py:1.5},children:[e.jsx(pt,{sx:{mr:2,fontSize:20,color:"success.main"}}),e.jsx(a,{variant:"body2",children:"Activate"})]}),s.status==="active"&&e.jsxs(M,{onClick:()=>{Cs(s.id,"in-progress"),Qe(s.id)},disabled:js[s.id],sx:{py:1.5},children:[e.jsx(pt,{sx:{mr:2,fontSize:20,color:"info.main"}}),e.jsx(a,{variant:"body2",children:"Start"})]}),s.status==="in-progress"&&e.jsxs(M,{onClick:()=>{Cs(s.id,"completed"),Qe(s.id)},disabled:js[s.id],sx:{py:1.5},children:[e.jsx(st,{sx:{mr:2,fontSize:20,color:"success.main"}}),e.jsx(a,{variant:"body2",children:"Complete"})]}),e.jsxs(M,{onClick:()=>{Ia(s.id,!s.collaborationEnabled),Qe(s.id)},disabled:js[s.id],sx:{py:1.5},children:[s.collaborationEnabled?e.jsx(dr,{sx:{mr:2,fontSize:20,color:"warning.main"}}):e.jsx(pt,{sx:{mr:2,fontSize:20,color:"success.main"}}),e.jsx(a,{variant:"body2",children:s.collaborationEnabled?"Disable Collab":"Enable Collab"})]}),e.jsxs(M,{onClick:async()=>{try{s.isArchived?await Cs(s.id,"active"):await Cs(s.id,"archived"),Qe(s.id)}catch(d){console.error("Failed to toggle archive",d),k("Failed to update project")}},disabled:js[s.id],sx:{py:1.5},children:[e.jsx(It,{sx:{mr:2,fontSize:20,color:s.isArchived?"success.main":"warning.main"}}),e.jsx(a,{variant:"body2",children:s.isArchived?"Restore":"Archive"})]}),e.jsxs(M,{onClick:async()=>{try{window.confirm(`Are you sure you want to permanently delete "${s.name}"? This action cannot be undone and will remove all project data, datasets, and team member assignments.`)&&(r(!0),await re.deleteProject(s.id)?(console.log(`âœ… [DashboardCloudProjectsBridge] Project "${s.name}" deleted successfully`),await Ge(),k(null)):k(`Failed to delete project "${s.name}". Please try again.`)),Qe(s.id)}catch(d){console.error("Failed to delete project:",d),k(`Failed to delete project "${s.name}": ${d instanceof Error?d.message:"Unknown error"}`)}finally{r(!1)}},sx:{py:1.5,color:"error.main","&:hover":{backgroundColor:"error.light",color:"error.dark"}},children:[e.jsx(et,{sx:{mr:2,fontSize:20}}),e.jsx(a,{variant:"body2",children:"Delete"})]})]})]})})]},s.id))})]})}),e.jsx(ur,{component:"div",count:vs.length,page:ct,onPageChange:Aa,rowsPerPage:$s,onRowsPerPageChange:Ra,rowsPerPageOptions:[5,10,25,50],sx:{mt:2}})]}),!A&&vs.length===0&&e.jsxs(o,{sx:{textAlign:"center",py:8},children:[e.jsx(Ts,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(a,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:De?"No projects found matching your search":_===0?"No active projects yet":"No archived projects"}),e.jsx(a,{variant:"body2",color:"text.secondary",paragraph:!0,children:De?"Try adjusting your search terms or browse all projects":_===0?c()?l()?"No projects assigned yet. As a team admin, you can create new projects or wait for assignments from your organization administrator.":"No projects have been assigned to you yet. Contact your team administrator to get access to projects.":l()?"Create your first cloud project to get started with Firebase and GCS integration":"You need an active subscription to create projects. Please upgrade your account or contact support.":"Archived projects will appear here"}),_===0&&!De&&l()&&e.jsx(G,{variant:"contained",startIcon:e.jsx(As,{}),onClick:Yt,size:"large",sx:{fontWeight:"bold",px:4,py:1.5,fontSize:"1.1rem",boxShadow:3,"&:hover":{boxShadow:6,transform:"translateY(-2px)"},transition:"all 0.3s ease-in-out"},children:"Create Your First Project"}),_===0&&!De&&c()&&!l()&&e.jsxs(o,{sx:{mt:2},children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"ðŸ’¡ Team members without admin privileges cannot create projects. Projects must be assigned by your administrator."}),e.jsx(G,{variant:"outlined",onClick:Ge,size:"large",sx:{mt:1},children:"Refresh Projects"})]}),_===0&&!De&&!c()&&((t==null?void 0:t.memberRole)==="ENTERPRISE_ADMIN"||(t==null?void 0:t.role)==="ENTERPRISE_ADMIN")&&e.jsx(o,{sx:{mt:2},children:e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"ðŸŽ¯ As an Enterprise Admin, you can create new projects and manage your organization's project portfolio."})}),De&&e.jsx(G,{variant:"outlined",onClick:()=>Ws(""),size:"large",sx:{mr:2},children:"Clear Search"})]}),!A&&De&&vs.length===0&&(_===0?ut:gt).length>0&&e.jsxs(o,{sx:{textAlign:"center",py:4},children:[e.jsx(a,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No projects match your search criteria"}),e.jsx(a,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Try different search terms or browse all projects in this tab"}),e.jsx(G,{variant:"outlined",onClick:()=>Ws(""),size:"large",children:"Clear Search"})]})]}),e.jsx(hr,{open:ne,onClose:()=>{me(!1)},mode:"shared_network",onSuccess:Ea,maxCollaborators:Xe(t),onCreate:async s=>await pr.createProject(s)}),e.jsxs(Ze,{open:!!f,onClose:()=>{Y(null)},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)",overflow:"hidden"}},children:[e.jsx(es,{sx:{background:"linear-gradient(135deg, #0f3460 0%, #16213e 100%)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",p:3,position:"relative","&::after":{content:'""',position:"absolute",bottom:0,left:0,right:0,height:"2px",background:"linear-gradient(90deg, #4f46e5, #06b6d4, #3b82f6)",borderRadius:"1px"}},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(o,{sx:{width:48,height:48,borderRadius:"50%",background:"linear-gradient(135deg, #4f46e5, #06b6d4)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 16px rgba(79, 70, 229, 0.3)"},children:e.jsx(gr,{sx:{color:"white",fontSize:24}})}),e.jsxs(o,{children:[e.jsx(a,{variant:"h5",sx:{color:"white",fontWeight:700,textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)"},children:"Project Details"}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:(f==null?void 0:f.name)||"Project Configuration"})]})]})}),e.jsx(ss,{sx:{p:0,background:"transparent"},children:f&&e.jsxs(o,{sx:{p:3},children:[e.jsxs(o,{sx:{mb:4},children:[e.jsxs(a,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(o,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #10b981, #06b6d4)",boxShadow:"0 0 8px rgba(16, 185, 129, 0.5)"}}),"Project Information"]}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsxs(o,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.2)",borderColor:"rgba(79, 70, 229, 0.3)"}},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(o,{sx:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",display:"flex",alignItems:"center",justifyContent:"center"},children:f&&Jt(f.applicationMode)}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Mode"})]}),e.jsx(a,{variant:"h6",sx:{color:"white",fontWeight:600},children:(f==null?void 0:f.applicationMode)==="standalone"?"Standalone":"Network"})]})}),e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsxs(o,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.2)",borderColor:"rgba(6, 182, 212, 0.3)"}},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(o,{sx:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #06b6d4, #0891b2)",display:"flex",alignItems:"center",justifyContent:"center"},children:f&&Qt(f.storageBackend)}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Storage Backend"})]}),e.jsx(a,{variant:"h6",sx:{color:"white",fontWeight:600},children:f==null?void 0:f.storageBackend})]})}),e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsxs(o,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.2)",borderColor:"rgba(16, 185, 129, 0.3)"}},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(o,{sx:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #10b981, #059669)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Js,{sx:{color:"white"}})}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Collaboration"})]}),e.jsxs(a,{variant:"h6",sx:{color:"white",fontWeight:600},children:[(f==null?void 0:f.maxCollaborators)||Xe(t)," licenses available"]})]})})]})]}),e.jsxs(o,{sx:{mb:4},children:[e.jsxs(a,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(o,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",boxShadow:"0 0 8px rgba(139, 92, 246, 0.5)"}}),"Project Details"]}),e.jsxs(o,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.2)",borderColor:"rgba(139, 92, 246, 0.3)"}},children:[(f==null?void 0:f.description)&&e.jsxs(o,{sx:{mb:3},children:[e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)",mb:1,fontWeight:500},children:"Description"}),e.jsx(a,{variant:"body1",sx:{color:"white",lineHeight:1.6},children:f.description})]}),(f==null?void 0:f.completionPercentage)!==void 0&&e.jsxs(o,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)",fontWeight:500},children:"Completion Progress"}),e.jsxs(a,{variant:"body2",sx:{color:"white",fontWeight:600},children:[f.completionPercentage,"%"]})]}),e.jsx(o,{sx:{width:"100%",height:"8px",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden",position:"relative"},children:e.jsx(o,{sx:{width:`${f.completionPercentage}%`,height:"100%",background:f.completionPercentage>=80?"linear-gradient(90deg, #10b981, #059669)":f.completionPercentage>=50?"linear-gradient(90deg, #f59e0b, #d97706)":"linear-gradient(90deg, #ef4444, #dc2626)",transition:"width 0.5s ease",borderRadius:"4px",boxShadow:f.completionPercentage>=80?"0 0 10px rgba(16, 185, 129, 0.3)":f.completionPercentage>=50?"0 0 10px rgba(245, 158, 11, 0.3)":"0 0 10px rgba(239, 68, 68, 0.3)"}})})]})]})]}),e.jsxs(o,{children:[e.jsxs(a,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(o,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #f59e0b, #f97316)",boxShadow:"0 0 8px rgba(245, 158, 11, 0.5)"}}),"Assigned Datasets"]}),e.jsxs(o,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsx(o,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:e.jsx(G,{variant:"outlined",onClick:async()=>{if(f){console.log("ðŸ”„ [DashboardCloudProjectsBridge] Refreshing datasets for project:",f.id);try{Z(!0),await Hs(f),console.log("âœ… [DashboardCloudProjectsBridge] Datasets refreshed successfully")}catch(s){console.error("âŒ [DashboardCloudProjectsBridge] Failed to refresh datasets:",s),k("Failed to refresh datasets")}finally{Z(!1)}}},disabled:pe,sx:{borderColor:"rgba(79, 70, 229, 0.5)",color:"#4f46e5",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#4f46e5",backgroundColor:"rgba(79, 70, 229, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:pe?"Refreshing...":"Refresh"})}),e.jsxs(x,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(Oe,{fullWidth:!0,size:"small",children:[e.jsx(Le,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Backend"}),e.jsxs(Fe,{value:de==="all"?"firestore":de,onChange:s=>Te(s.target.value),sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(79, 70, 229, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white","& .MuiMenuItem-root":{color:"white"}},children:[e.jsx(M,{value:"firestore",children:"Firestore"}),e.jsx(M,{value:"gcs",children:"Google Cloud Storage"}),e.jsx(M,{value:"s3",children:"Amazon S3"}),e.jsx(M,{value:"aws",children:"AWS Services"}),e.jsx(M,{value:"azure",children:"Microsoft Azure"})]})]})}),e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsx(te,{fullWidth:!0,size:"small",placeholder:"Search datasets...",value:Se,onChange:s=>Ee(s.target.value),sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(79, 70, 229, 0.5)"},"& input::placeholder":{color:"rgba(255, 255, 255, 0.5)",opacity:1}}}})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(Oe,{fullWidth:!0,size:"small",children:[e.jsx(Le,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Select dataset"}),e.jsxs(Fe,{value:$,onChange:s=>{const d=s.target.value;console.log("ðŸ” [DashboardCloudProjectsBridge] Dataset selection changed:",{oldValue:$,newValue:d,valueType:typeof d,availableDatasetIds:xe.map(m=>m.id)}),ie(d)},sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(79, 70, 229, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white","& .MuiMenuItem-root":{color:"white"}},children:[e.jsx(M,{value:"",children:"Select dataset..."}),xe.map(s=>e.jsx(M,{value:s.id,children:s.__label||s.name},s.id))]})]})}),e.jsx(x,{item:!0,xs:12,sm:2,children:e.jsxs(o,{sx:{display:"flex",gap:1},children:[e.jsx(G,{variant:"contained",size:"small",disabled:!$||pe,onClick:async()=>{if(!f||!$)return;const s=xe.find(d=>d.id===$);if(console.log("ðŸ” [DashboardCloudProjectsBridge] Selected dataset details:",{selectedDatasetId:$,selectedDataset:s,availableDatasetsCount:xe.length,availableDatasetIds:xe.map(d=>d.id)}),!s){console.error("âŒ [DashboardCloudProjectsBridge] Selected dataset not found in available datasets:",{selectedDatasetId:$,availableDatasetIds:xe.map(d=>d.id)}),k(`Selected dataset (${$}) not found. Please try selecting a different dataset.`);return}console.log("ðŸ”— [DashboardCloudProjectsBridge] Assigning dataset to project:",{projectId:f.id,datasetId:$});try{Z(!0),await re.assignDatasetToProject(f.id,$),console.log("âœ… [DashboardCloudProjectsBridge] Dataset assigned successfully");const d=await re.getProjectDatasets(f.id);X(d),Ie(D=>({...D,[f.id]:d.length}));const z=(await re.listDatasets({backend:de==="all"?void 0:de,query:Se||void 0})).map(D=>{var O;const B=le=>{switch(le){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...D,__label:`${D.name} ${B((O=D.storage)==null?void 0:O.backend)}`}});ee(z),ie(""),console.log("âœ… [DashboardCloudProjectsBridge] Dataset assignment completed and lists refreshed")}catch(d){console.error("âŒ [DashboardCloudProjectsBridge] Failed to assign dataset:",d),k("Failed to assign dataset to project")}finally{Z(!1)}},sx:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",borderRadius:2,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)","&:hover":{background:"linear-gradient(135deg, #059669, #047857)",boxShadow:"0 6px 20px rgba(16, 185, 129, 0.4)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)",boxShadow:"none"}},children:pe?"Assigning...":"Assign"}),e.jsx(G,{variant:"outlined",size:"small",onClick:async()=>{if(f){console.log("ðŸ” [DashboardCloudProjectsBridge] Applying dataset filters:",{backend:de,search:Se});try{Z(!0);const s=await re.listDatasets({backend:de==="all"?void 0:de,query:Se||void 0});console.log("âœ… [DashboardCloudProjectsBridge] Filtered datasets loaded:",s);const d=s.map(z=>{var B;const D=O=>{switch(O){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...z,__label:`${z.name} ${D((B=z.storage)==null?void 0:B.backend)}`}});ee(d);const m=await re.getProjectDatasets(f.id);X(m),Ie(z=>({...z,[f.id]:m.length})),console.log("âœ… [DashboardCloudProjectsBridge] Filters applied successfully")}catch(s){console.error("âŒ [DashboardCloudProjectsBridge] Failed to apply filters:",s),k("Failed to apply dataset filters")}finally{Z(!1)}}},disabled:pe,sx:{borderColor:"rgba(79, 70, 229, 0.5)",color:"#4f46e5",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#4f46e5",backgroundColor:"rgba(79, 70, 229, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:pe?"Applying...":"Apply Filters"})]})})]}),e.jsxs(o,{children:[e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2,fontWeight:500},children:"Currently Assigned Datasets"}),ve.length===0?e.jsxs(o,{sx:{p:4,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx(qe,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No datasets assigned to this project"})]}):e.jsx(o,{sx:{borderRadius:2,overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.1)"},children:ve.map((s,d)=>{var m,z,D;return e.jsxs(o,{sx:{p:2,background:d%2===0?"rgba(255, 255, 255, 0.02)":"rgba(255, 255, 255, 0.05)",borderBottom:d<ve.length-1?"1px solid rgba(255, 255, 255, 0.1)":"none",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease","&:hover":{background:"rgba(79, 70, 229, 0.1)",transform:"translateX(4px)"}},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(o,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #f59e0b, #f97316)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(qe,{sx:{color:"white",fontSize:16}})}),e.jsxs(o,{children:[e.jsx(a,{variant:"body1",sx:{color:"white",fontWeight:500},children:s.name}),s.description&&e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:s.description}),((m=s.storage)==null?void 0:m.backend)==="firestore"&&((D=(z=s.collectionAssignment)==null?void 0:z.selectedCollections)==null?void 0:D.length)>0&&e.jsxs(o,{sx:{mt:1},children:[e.jsx(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)",display:"block",mb:.5},children:"Assigned Collections:"}),e.jsxs(o,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[s.collectionAssignment.selectedCollections.slice(0,3).map(B=>e.jsx(W,{label:B,size:"small",sx:{height:18,fontSize:"0.65rem",backgroundColor:"rgba(245, 158, 11, 0.2)",color:"#fbbf24",border:"1px solid rgba(245, 158, 11, 0.3)"}},B)),s.collectionAssignment.selectedCollections.length>3&&e.jsx(W,{label:`+${s.collectionAssignment.selectedCollections.length-3} more`,size:"small",sx:{height:18,fontSize:"0.65rem",backgroundColor:"rgba(156, 163, 175, 0.2)",color:"#9ca3af"}})]}),s.collectionAssignment.organizationScope&&e.jsx(a,{variant:"caption",sx:{color:"rgba(16, 185, 129, 0.8)",display:"block",mt:.5,fontSize:"0.65rem"},children:"âœ“ Organization scoped for data isolation"})]})]})]}),e.jsxs(o,{sx:{display:"flex",gap:1},children:[e.jsx(G,{variant:"outlined",size:"small",startIcon:e.jsx(zt,{}),onClick:()=>{console.log("âœï¸ [DashboardCloudProjectsBridge] Edit dataset clicked:",s.id),ye(s),q(!0)},sx:{borderColor:"rgba(139, 92, 246, 0.3)",color:"#8b5cf6",minWidth:"auto",px:1.5,"&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"}},children:"Edit"}),e.jsx(G,{variant:"outlined",size:"small",startIcon:e.jsx(et,{}),onClick:async()=>{try{console.log("ðŸ—‘ï¸ [DashboardCloudProjectsBridge] Removing dataset from project:",{projectId:f.id,datasetId:s.id}),await re.unassignDatasetFromProject(f.id,s.id),console.log("âœ… [DashboardCloudProjectsBridge] Dataset removed successfully"),X(le=>le.filter(J=>J.id!==s.id)),Ie(le=>({...le,[f.id]:Math.max(0,(le[f.id]||1)-1)}));const O=(await re.listDatasets({backend:de==="all"?void 0:de,query:Se||void 0})).map(le=>{var se;const J=F=>{switch(F){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...le,__label:`${le.name} ${J((se=le.storage)==null?void 0:se.backend)}`}});ee(O),console.log("âœ… [DashboardCloudProjectsBridge] Dataset removal completed and lists refreshed")}catch(B){console.error("âŒ [DashboardCloudProjectsBridge] Failed to remove dataset:",B),k("Failed to remove dataset from project")}},sx:{borderColor:"rgba(239, 68, 68, 0.5)",color:"#ef4444",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",transform:"scale(1.05)"}},children:"Remove"})]})]},s.id)})})]})]})]}),e.jsxs(o,{sx:{mt:4},children:[e.jsxs(a,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(o,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",boxShadow:"0 0 8px rgba(139, 92, 246, 0.5)"}}),"Team Members"]}),e.jsxs(o,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsxs(o,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:[e.jsx(G,{variant:"contained",startIcon:e.jsx(ps,{}),onClick:()=>Os(!0),sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(139, 92, 246, 0.3)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 6px 20px rgba(139, 92, 246, 0.4)",transform:"translateY(-1px)"}},children:"Team & Roles"}),e.jsx(G,{variant:"outlined",onClick:async()=>{if(f){console.log("ðŸ”„ [DashboardCloudProjectsBridge] Refreshing team members for project:",f.id);try{Ns(!0),await os(f),console.log("âœ… [DashboardCloudProjectsBridge] Team members refreshed successfully")}catch(s){console.error("âŒ [DashboardCloudProjectsBridge] Failed to refresh team members:",s),k("Failed to refresh team members")}finally{Ns(!1)}}},disabled:$e,sx:{borderColor:"rgba(139, 92, 246, 0.5)",color:"#8b5cf6",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:$e?"Refreshing...":"Refresh"})]}),e.jsxs(o,{children:[e.jsxs(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)",mb:2,fontWeight:500},children:["Project Team Members (",Ye.length,")"]}),Ye.length===0?e.jsxs(o,{sx:{p:4,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx(Js,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No team members assigned to this project"}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.4)",mt:1},children:"Add licensed team members to collaborate on this project"})]}):e.jsx(o,{sx:{borderRadius:2,overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.1)"},children:Ye.map((s,d)=>{var O,le,J,se,F,ze,is,He;console.log("ðŸ” [DashboardCloudProjectsBridge] Team member structure:",s);let m="Unnamed User";s.name&&s.name!=="Unnamed User"?(m=s.name,console.log("ðŸŽ¯ [DashboardCloudProjectsBridge] Using enriched name from TeamMemberService:",m)):(O=s.teamMember)!=null&&O.name&&s.teamMember.name!=="Unnamed User"?(m=s.teamMember.name,console.log("ðŸŽ¯ [DashboardCloudProjectsBridge] Using nested teamMember name:",m)):(le=s.teamMember)!=null&&le.firstName&&((J=s.teamMember)!=null&&J.lastName)?(m=`${s.teamMember.firstName} ${s.teamMember.lastName}`,console.log("ðŸŽ¯ [DashboardCloudProjectsBridge] Constructed from nested firstName + lastName:",m)):(se=s.teamMember)!=null&&se.firstName?(m=s.teamMember.firstName,console.log("ðŸŽ¯ [DashboardCloudProjectsBridge] Using nested firstName:",m)):(s.email||(F=s.teamMember)!=null&&F.email)&&(m=(s.email||s.teamMember.email).split("@")[0].replace(/[._-]/g," ").split(" ").map(Je=>Je.charAt(0).toUpperCase()+Je.slice(1).toLowerCase()).join(" "),console.log("ðŸŽ¯ [DashboardCloudProjectsBridge] Extracted from email:",m)),console.log("ðŸ” [DashboardCloudProjectsBridge] Final display name:",m);const z=s.email||((ze=s.teamMember)==null?void 0:ze.email)||"No email",D=s.role||((is=s.teamMember)==null?void 0:is.role)||"Member",B=((He=s.teamMember)==null?void 0:He.licenseType)||s.licenseType;return e.jsxs(o,{sx:{p:3,background:d%2===0?"rgba(255, 255, 255, 0.02)":"rgba(255, 255, 255, 0.05)",borderBottom:d<Ye.length-1?"1px solid rgba(255, 255, 255, 0.1)":"none",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease","&:hover":{background:"rgba(139, 92, 246, 0.1)",transform:"translateX(4px)"}},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(o,{sx:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",fontWeight:600,color:"white"},children:m.charAt(0).toUpperCase()}),e.jsxs(o,{children:[e.jsx(a,{variant:"body1",sx:{color:"white",fontWeight:500},children:m}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:z}),e.jsxs(o,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(W,{size:"small",label:D,sx:{backgroundColor:"rgba(139, 92, 246, 0.2)",color:"#c4b5fd",fontSize:"11px"}}),B&&e.jsx(W,{size:"small",label:B,sx:{backgroundColor:"rgba(16, 185, 129, 0.2)",color:"#6ee7b7",fontSize:"11px"}})]})]})]}),e.jsx(G,{variant:"outlined",size:"small",startIcon:e.jsx(et,{}),onClick:async()=>{try{const Me=s.teamMemberId||s.id;if(!Me){console.error("No valid team member ID found:",s),alert("Error: Invalid team member ID");return}await re.removeTeamMemberFromProject(f.id,Me),rs(Qs=>Qs.filter(Je=>(Je.teamMemberId||Je.id)!==Me))}catch(Me){console.error("Failed to remove team member",Me),alert(`Failed to remove team member: ${(Me==null?void 0:Me.message)||"Unknown error"}`)}},sx:{borderColor:"rgba(239, 68, 68, 0.5)",color:"#ef4444",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",transform:"scale(1.05)"}},children:"Remove"})]},s.id)})})]})]})]})]})}),e.jsx(ts,{sx:{p:3,background:"rgba(255, 255, 255, 0.02)",borderTop:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"space-between"},children:e.jsx(G,{onClick:()=>Y(null),variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})})]}),e.jsx(Oa,{children:e.jsx(vr,{open:K,onClose:()=>{V(!1),ke(null)},onSuccess:s=>{f&&Hs(f),Ge()},assignToProject:ue||void 0})}),e.jsxs(Ze,{open:fs,onClose:()=>nt(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"}},children:[e.jsx(es,{sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",p:3},children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(o,{sx:{width:40,height:40,borderRadius:"50%",background:"rgba(255, 255, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(As,{sx:{color:"white"}})}),e.jsxs(o,{children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600},children:"Add Team Member"}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:"Add licensed team members to this project"})]})]})}),e.jsxs(ss,{sx:{p:3,background:"transparent"},children:[$t&&e.jsx(ge,{severity:"error",sx:{mb:3},children:$t}),e.jsxs(o,{sx:{mb:3},children:[e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2},children:"Search and select from your licensed team members:"}),e.jsx(te,{fullWidth:!0,placeholder:"Search team members by name or email...",value:bs,onChange:s=>ot(s.target.value),sx:{mb:2,"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(139, 92, 246, 0.5)"},"& input::placeholder":{color:"rgba(255, 255, 255, 0.5)",opacity:1}}}}),e.jsxs(Oe,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Le,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Select Team Member"}),e.jsxs(Fe,{value:zs,onChange:s=>rt(s.target.value),disabled:$e,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(139, 92, 246, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white"},children:[e.jsx(M,{value:"",children:e.jsx("em",{children:$e?"Loading team members...":"Select a team member..."})}),!$e&&ms.length===0&&e.jsx(M,{disabled:!0,children:e.jsx(a,{component:"em",sx:{color:"rgba(255, 255, 255, 0.5)"},children:bs?"No team members found matching your search":"No available team members found"})}),!$e&&ms.map(s=>{var m;let d="Unnamed User";return s.name?d=s.name:s.fullName?d=s.fullName:s.displayName?d=s.displayName:s.firstName&&s.lastName?d=`${s.firstName} ${s.lastName}`:s.firstName?d=s.firstName:s.lastName?d=s.lastName:s.email&&(d=s.email.split("@")[0]),e.jsx(M,{value:s.id,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[e.jsx(o,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:600,color:"white"},children:((m=d.charAt(0))==null?void 0:m.toUpperCase())||"U"}),e.jsxs(o,{sx:{flexGrow:1},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,color:"white"},children:d}),e.jsxs(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:[s.email," â€¢ ",s.licenseType||"Licensed"]})]})]})},s.id)})]})]}),e.jsxs(Oe,{fullWidth:!0,children:[e.jsx(Le,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Project Role"}),e.jsx(Fe,{value:Ft,onChange:s=>Bs(s.target.value),disabled:Us,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(139, 92, 246, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white"},children:Us?e.jsx(M,{disabled:!0,children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ke,{size:16,sx:{color:"rgba(255, 255, 255, 0.6)"}}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Loading roles..."})]})}):Ls.length===0?e.jsx(M,{disabled:!0,children:e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"No roles available"})}):Ls.map(s=>e.jsx(M,{value:s.id,children:e.jsxs(o,{children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,color:"white"},children:s.displayName}),e.jsx(W,{label:s.category,size:"small",sx:{height:16,fontSize:"0.65rem",backgroundColor:Zs.getRoleDisplayColor(s.category),color:"white"}})]}),e.jsx(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)"},children:Zs.formatRoleDescription(s)})]})},s.id))})]})]}),ms.length===0&&!$e&&e.jsxs(o,{sx:{p:3,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx(Js,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No available team members found"}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.4)",mt:1},children:"Make sure team members have valid licenses and aren't already assigned to this project"})]})]}),e.jsxs(ts,{sx:{p:3,background:"rgba(255, 255, 255, 0.02)",borderTop:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"space-between"},children:[e.jsx(G,{onClick:()=>{nt(!1),rt(""),Bs(""),Fs([]),ot(""),lt(null)},variant:"outlined",disabled:it,sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Cancel"}),e.jsx(G,{variant:"contained",disabled:it||!zs,onClick:async()=>{if(!(!f||!zs)){lt(null),Wt(!0);try{await Zs.addTeamMemberToProject(f.id,zs,Ft),await os(f),nt(!1),rt(""),Bs(""),Fs([]),ot("")}catch(s){console.error("Failed to add team member:",s),lt((s==null?void 0:s.message)||"Failed to add team member")}finally{Wt(!1)}}},sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,boxShadow:"0 6px 20px rgba(139, 92, 246, 0.4)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 8px 25px rgba(139, 92, 246, 0.5)",transform:"translateY(-2px)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)",boxShadow:"none"}},children:it?"Adding...":"Add Team Member"})]})]}),e.jsxs(Ze,{open:Ne,onClose:()=>p(!1),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",maxHeight:"80vh"}},children:[e.jsxs(es,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",pb:2,fontSize:"1.5rem",fontWeight:600,display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Dataset Management",e.jsx(G,{variant:"contained",startIcon:e.jsx(As,{}),onClick:()=>{p(!1),V(!0)},sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(139, 92, 246, 0.4)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 6px 16px rgba(139, 92, 246, 0.5)",transform:"translateY(-1px)"}},children:"Create Dataset"})]}),e.jsx(ss,{sx:{p:3,overflow:"auto"},children:E?e.jsxs(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:4},children:[e.jsx(Ke,{sx:{color:"rgba(255, 255, 255, 0.7)"}}),e.jsx(a,{variant:"body2",sx:{ml:2,color:"rgba(255, 255, 255, 0.7)"},children:"Loading datasets..."})]}):ce.length===0?e.jsxs(o,{sx:{textAlign:"center",py:4},children:[e.jsx(We,{sx:{fontSize:64,color:"rgba(255, 255, 255, 0.5)",mb:2}}),e.jsx(a,{variant:"h6",sx:{mb:2},children:"No Datasets Found"}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:3},children:"Create your first dataset to get started with data management."})]}):e.jsxs(o,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(We,{sx:{mr:1}}),"Available Datasets (",ce.length,")"]}),e.jsx(x,{container:!0,spacing:2,children:ce.map(s=>{var d,m;return e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsx(oe,{sx:{background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:2,color:"white","&:hover":{background:"rgba(255, 255, 255, 0.08)",borderColor:"rgba(255, 255, 255, 0.2)",transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.3)"},transition:"all 0.2s ease-in-out",cursor:"pointer"},children:e.jsxs(be,{sx:{p:2},children:[e.jsx(a,{variant:"h6",sx:{fontSize:"1rem",fontWeight:600,mb:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.name}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:1,minHeight:"2.5em",overflow:"hidden",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:s.description||"No description available"}),e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mt:2},children:[e.jsx(W,{size:"small",label:((m=(d=s.__label)==null?void 0:d.match(/\((.*?)\)$/))==null?void 0:m[1])||"Firestore",variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",fontSize:"0.75rem"}}),e.jsx(W,{size:"small",label:s.visibility||"private",variant:"filled",sx:{backgroundColor:s.visibility==="public"?"rgba(34, 197, 94, 0.2)":s.visibility==="organization"?"rgba(59, 130, 246, 0.2)":"rgba(156, 163, 175, 0.2)",color:s.visibility==="public"?"#22c55e":s.visibility==="organization"?"#3b82f6":"#9ca3af",fontSize:"0.75rem"}})]}),e.jsxs(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.5)",mt:1,display:"block"},children:["ID: ",s.id]})]})})},s.id)})})]})}),e.jsxs(ts,{sx:{p:3,borderTop:"1px solid rgba(255, 255, 255, 0.1)",justifyContent:"space-between"},children:[e.jsx(G,{onClick:mt,variant:"outlined",startIcon:e.jsx(ia,{}),disabled:E,sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:3,py:1,textTransform:"none","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Refresh"}),e.jsx(G,{onClick:()=>p(!1),variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:3,py:1,textTransform:"none","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})]})]}),f&&e.jsx(Tr,{open:_s,onClose:()=>Os(!1),projectId:f.id,projectName:f.name,organizationId:(t==null?void 0:t.organizationId)||"",existingProjectTeamMembers:Ye,onTeamMembersUpdated:()=>{console.log("ðŸ”„ [DashboardCloudProjectsBridge] Refreshing team members after wizard update"),f&&os(f)}}),f&&e.jsx(wr,{open:Ms,onClose:()=>ks(!1),projectId:f.id,organizationId:(t==null?void 0:t.organizationId)||"",projectName:f.name}),e.jsxs(Ze,{open:P,onClose:()=>v(!1),maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"white",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",maxHeight:"90vh"}},children:[e.jsxs(es,{sx:{borderBottom:"1px solid rgba(255, 255, 255, 0.1)",pb:2,fontSize:"1.5rem",fontWeight:600,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ws,{sx:{fontSize:32,color:"#8b5cf6"}}),e.jsxs(o,{children:[e.jsx(a,{variant:"h5",sx:{fontWeight:700},children:"Dataset Insights & Analysis"}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Global overview of dataset organization and conflicts"})]})]}),j&&e.jsxs(o,{sx:{textAlign:"center"},children:[e.jsx(a,{variant:"h4",sx:{color:j.healthScore>=80?"#10b981":j.healthScore>=60?"#f59e0b":"#ef4444",fontWeight:700},children:j.healthScore}),e.jsx(a,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Health Score"})]})]}),e.jsx(ss,{sx:{p:3,overflow:"auto"},children:R?e.jsxs(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:8},children:[e.jsx(Ke,{sx:{color:"#8b5cf6",mr:2}}),e.jsx(a,{variant:"body1",children:"Analyzing dataset organization..."})]}):j?e.jsxs(o,{children:[e.jsxs(x,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(oe,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700},children:j.totalDatasets}),e.jsx(a,{variant:"body2",children:"Total Datasets"})]})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(oe,{sx:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700},children:j.totalCollections}),e.jsx(a,{variant:"body2",children:"Unique Collections"})]})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(oe,{sx:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700},children:j.overlaps.length}),e.jsx(a,{variant:"body2",children:"Collection Overlaps"})]})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsxs(oe,{sx:{background:j.globalInsights.redundantAssignments.length>0?"linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%)":"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",color:"white",textAlign:"center",p:2},children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700},children:j.globalInsights.redundantAssignments.length}),e.jsx(a,{variant:"body2",children:"Redundancies"})]})})]}),j.overlaps.length>0&&e.jsxs(o,{sx:{mb:4},children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Nt,{color:"warning"}),"Collection Overlaps"]}),j.overlaps.map((s,d)=>e.jsx(oe,{sx:{mb:2,bgcolor:"rgba(255, 255, 255, 0.05)",border:`2px solid ${s.conflictLevel==="high"?"#ef4444":s.conflictLevel==="medium"?"#f59e0b":"#10b981"}`},children:e.jsxs(be,{children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(a,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(We,{}),s.collection]}),e.jsx(W,{label:s.conflictLevel.toUpperCase(),color:s.conflictLevel==="high"?"error":s.conflictLevel==="medium"?"warning":"success",sx:{fontWeight:600}})]}),e.jsxs(a,{variant:"body2",sx:{mb:2},children:["Used by ",s.datasets.length," datasets: ",s.datasets.map(m=>m.name).join(", ")]}),s.conflictReasons.length>0&&e.jsxs(o,{sx:{mb:2},children:[e.jsx(a,{variant:"caption",sx:{fontWeight:600,display:"block",mb:1},children:"Issues:"}),s.conflictReasons.map((m,z)=>e.jsxs(a,{variant:"body2",sx:{color:"#ef4444",fontSize:"0.85rem"},children:["â€¢ ",m]},z))]}),s.recommendations.length>0&&e.jsxs(o,{children:[e.jsx(a,{variant:"caption",sx:{fontWeight:600,display:"block",mb:1},children:"Recommendations:"}),s.recommendations.map((m,z)=>e.jsxs(a,{variant:"body2",sx:{color:"#10b981",fontSize:"0.85rem"},children:["ðŸ’¡ ",m]},z))]})]})},d))]}),j.globalInsights.mostUsedCollections.length>0&&e.jsxs(o,{sx:{mb:4},children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Et,{color:"primary"}),"Most Used Collections"]}),e.jsx(x,{container:!0,spacing:2,children:j.globalInsights.mostUsedCollections.slice(0,6).map((s,d)=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(oe,{sx:{bgcolor:"rgba(255, 255, 255, 0.05)",p:2},children:[e.jsxs(a,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(qe,{color:"primary"}),s.collection]}),e.jsxs(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:["Used by ",s.count," dataset",s.count!==1?"s":""]}),e.jsxs(o,{sx:{mt:1},children:[s.datasets.slice(0,2).map((m,z)=>e.jsx(W,{label:m,size:"small",sx:{mr:.5,mb:.5,fontSize:"0.7rem"}},z)),s.datasets.length>2&&e.jsx(W,{label:`+${s.datasets.length-2} more`,size:"small",sx:{fontSize:"0.7rem"}})]})]})},d))})]}),j.globalInsights.recommendations.length>0&&e.jsxs(o,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ds,{color:"info"}),"Optimization Recommendations"]}),j.globalInsights.recommendations.map((s,d)=>e.jsx(ge,{severity:"info",sx:{mb:1,bgcolor:"rgba(79, 70, 229, 0.1)"},children:s},d))]}),j.overlaps.length===0&&j.globalInsights.redundantAssignments.length===0&&e.jsxs(o,{sx:{textAlign:"center",py:4},children:[e.jsx(Bt,{sx:{fontSize:64,color:"#10b981",mb:2}}),e.jsx(a,{variant:"h5",sx:{color:"#10b981",mb:1},children:"Excellent Dataset Organization!"}),e.jsx(a,{variant:"body1",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"No conflicts or redundancies detected. Your datasets are well-organized."})]})]}):e.jsxs(o,{sx:{textAlign:"center",py:4},children:[e.jsx(ws,{sx:{fontSize:64,color:"rgba(255, 255, 255, 0.5)",mb:2}}),e.jsx(a,{variant:"h6",sx:{mb:2},children:"No Dataset Analysis Available"}),e.jsx(a,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Create some datasets with collection assignments to see insights."})]})}),e.jsxs(ts,{sx:{p:3,borderTop:"1px solid rgba(255, 255, 255, 0.1)",justifyContent:"space-between"},children:[e.jsx(G,{onClick:Ys,variant:"outlined",startIcon:e.jsx(ia,{}),disabled:R,sx:{borderColor:"rgba(139, 92, 246, 0.3)",color:"#8b5cf6","&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"}},children:"Refresh Analysis"}),e.jsx(G,{onClick:()=>v(!1),variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)","&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})]})]}),e.jsx(Cr,{open:C,onClose:()=>{q(!1),ye(null)},dataset:fe,existingDatasets:ce,onDatasetUpdated:s=>{console.log("âœ… [DashboardCloudProjectsBridge] Dataset updated:",s),f&&X(d=>d.map(m=>m.id===s.id?s:m)),T(d=>d.map(m=>m.id===s.id?s:m)),P&&Ys()}})]})};export{Gr as DashboardCloudProjectsBridge,Gr as default};
