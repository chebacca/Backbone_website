const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/firebase-DunYn50n.js","assets/index-BbJter-q.js","assets/mui-Dvh35qVf.js","assets/vendor-CjD1bmmO.js","assets/stripe-CbtnRl6i.js","assets/index-CBai7h7s.css","assets/index.esm-D7ujsXeY.js","assets/index.esm-DonjM_pP.js","assets/index.esm-D2YDx4vs.js"])))=>i.map(i=>d[i]);
import{u as qr,a as Gr,_ as wr,E as Yr}from"./index-BbJter-q.js";import{j as e,B as a,T as o,c as br,G as g,d as de,F as le,s as De,e as M,I as Pr,g as ce,V as Vr,h as Jr,a as S,C as gr,m as Hr,K as Me,aM as ve,b6 as hr,t as oe,v as ne,aB as ye,c2 as Qr,c3 as Xr,c4 as lr,ay as Ke,az as qe,c6 as Ae,bE as Ar,aA as Ge,bY as Zr,bZ as ea,b_ as ra,i as aa,aE as Ye,ap as Ie,aZ as fe,aj as ta,R as sa,aq as Ir,ar as Br,as as Rr,at as Te,au as A,av as Mr,aC as Be,aD as Re,a5 as _,r as H,bM as oa,c7 as na,aJ as ia,aH as xr,bX as la,f as Sr,c8 as ca,ak as da,bQ as kr,an as ua,ao as ga,c9 as ha,W as xa,b$ as Pe,b1 as ba,b2 as Dr,bm as ma,ca as pa,a6 as ja}from"./mui-Dvh35qVf.js";import{b as fa,r as i}from"./vendor-CjD1bmmO.js";import{cloudProjectIntegration as E}from"./CloudProjectIntegration-DKhJ3a_M.js";import{U as ya,s as va}from"./UnifiedProjectCreationDialog-SYL70rX9.js";import"./stripe-CbtnRl6i.js";const cr=["Basic Information","Cloud Provider Selection","Authentication Setup","Storage Configuration","Advanced Options","Review & Create"],dr={name:"",description:"",visibility:"private",tags:[],cloudProvider:"firestore",authentication:{},storage:{backend:"firestore"},schema:{template:"custom",customFields:[]},advanced:{encryption:!1,compression:!1,backup:!0,versioning:!1,accessLogging:!1}},Ca=fa.memo(({open:d,onClose:T,onSuccess:R,preselectedProvider:n,assignToProject:D})=>{const[k,C]=i.useState(0),[s,B]=i.useState(dr),[U,K]=i.useState(!1),[x,I]=i.useState(null),[P,Q]=i.useState({}),[N,re]=i.useState({}),[Y,u]=i.useState(!1),[F,q]=i.useState(null),ae=i.useCallback(()=>{const m=n||"firestore",j=m==="azure-blob"?"azure":m;B({...dr,cloudProvider:m,storage:{...dr.storage,backend:j}}),C(0),I(null),Q({}),re({}),q(null)},[n]);i.useEffect(()=>{d&&ae()},[d,ae]);const w=i.useCallback(m=>{B(z=>({...z,...m}));const j={...P};Object.keys(m).forEach(z=>{delete j[z]}),Q(j)},[P]),$=i.useCallback(m=>{var z,he,xe,be,me,h,X;const j={};switch(m){case 0:s.name.trim()||(j.name="Dataset name is required"),s.name.length>100&&(j.name="Dataset name must be 100 characters or less");break;case 1:s.cloudProvider||(j.cloudProvider="Please select a cloud provider");break;case 2:(s.cloudProvider==="firestore"||s.cloudProvider==="gcs")&&((z=s.authentication.projectId)!=null&&z.trim()||(j.projectId="Project ID is required for Google Cloud services")),(s.cloudProvider==="s3"||s.cloudProvider==="aws")&&((he=s.authentication.accessKeyId)!=null&&he.trim()||(j.accessKeyId="Access Key ID is required for AWS services"),(xe=s.authentication.secretAccessKey)!=null&&xe.trim()||(j.secretAccessKey="Secret Access Key is required for AWS services")),s.cloudProvider==="azure-blob"&&((be=s.authentication.connectionString)!=null&&be.trim()||(j.connectionString="Connection string is required for Azure services"));break;case 3:s.cloudProvider==="gcs"&&!((me=s.storage.gcsBucket)!=null&&me.trim())&&(j.gcsBucket="GCS bucket name is required"),s.cloudProvider==="s3"&&!((h=s.storage.s3Bucket)!=null&&h.trim())&&(j.s3Bucket="S3 bucket name is required"),s.cloudProvider==="azure-blob"&&!((X=s.storage.azureContainer)!=null&&X.trim())&&(j.azureContainer="Azure container name is required");break}return Q(j),Object.keys(j).length===0},[s]),Z=i.useCallback(()=>{$(k)&&C(m=>Math.min(m+1,cr.length-1))},[k,$]),ee=i.useCallback(()=>{C(m=>Math.max(m-1,0))},[]),W=i.useCallback(m=>{m<k&&C(m)},[k]),ie=i.useCallback(m=>{re(j=>({...j,[m]:!j[m]}))},[]),O=i.useCallback(async()=>{if(s.cloudProvider){u(!0),q(null);try{await new Promise(m=>setTimeout(m,2e3)),q({success:!0,message:"Connection test successful!"})}catch(m){q({success:!1,message:`Connection test failed: ${m instanceof Error?m.message:"Unknown error"}`})}finally{u(!1)}}},[s.cloudProvider]),ge=i.useCallback(async()=>{if($(k)){K(!0),I(null);try{const m=await E.createDataset({name:s.name,description:s.description,visibility:s.visibility,tags:s.tags,storage:s.storage,schema:s.schema,projectId:D||"default-project"});m?(R==null||R(m),T==null||T()):I("Failed to create dataset: No dataset returned")}catch(m){I(`Failed to create dataset: ${m instanceof Error?m.message:"Unknown error"}`)}finally{K(!1)}}},[k,$,s,R,T]),V=i.useCallback(m=>{var j,z,he,xe,be,me;switch(m){case 0:return e.jsxs(a,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Basic Information"}),e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Dataset Name",value:s.name,onChange:h=>w({name:h.target.value}),error:!!P.name,helperText:P.name,required:!0})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Description (Optional)",value:s.description||"",onChange:h=>w({description:h.target.value}),multiline:!0,rows:3})}),e.jsx(g,{item:!0,xs:12,children:e.jsxs(ye,{fullWidth:!0,children:[e.jsx(Qr,{children:"Visibility"}),e.jsxs(Xr,{value:s.visibility,onChange:h=>w({visibility:h.target.value}),row:!0,children:[e.jsx(le,{value:"private",control:e.jsx(lr,{}),label:"Private"}),e.jsx(le,{value:"organization",control:e.jsx(lr,{}),label:"Organization"}),e.jsx(le,{value:"public",control:e.jsx(lr,{}),label:"Public"})]})]})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Tags (Optional)",value:((j=s.tags)==null?void 0:j.join(", "))||"",onChange:h=>w({tags:h.target.value.split(",").map(X=>X.trim()).filter(X=>X.length>0)}),placeholder:"tag1, tag2, tag3",helperText:"Comma-separated tags for organization"})})]})]});case 1:return e.jsxs(a,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Cloud Provider Selection"}),e.jsx(g,{container:!0,spacing:2,children:[{value:"firestore",label:"Firestore",icon:e.jsx(Me,{}),description:"Google Cloud Firestore"},{value:"gcs",label:"Google Cloud Storage",icon:e.jsx(ve,{}),description:"Google Cloud Storage"},{value:"s3",label:"Amazon S3",icon:e.jsx(Me,{}),description:"Amazon S3"},{value:"aws",label:"AWS Services",icon:e.jsx(Me,{}),description:"AWS Services"},{value:"azure-blob",label:"Azure Blob Storage",icon:e.jsx(ve,{}),description:"Microsoft Azure"},{value:"local",label:"Local Storage",icon:e.jsx(hr,{}),description:"Local file system"}].map(h=>e.jsx(g,{item:!0,xs:12,sm:6,md:4,children:e.jsx(oe,{sx:{cursor:"pointer",border:s.cloudProvider===h.value?"2px solid":"1px solid",borderColor:s.cloudProvider===h.value?"primary.main":"divider","&:hover":{borderColor:"primary.main"}},onClick:()=>{const X=h.value,ze=X==="azure-blob"?"azure":X;w({cloudProvider:X,storage:{...s.storage,backend:ze}})},children:e.jsxs(ne,{sx:{textAlign:"center",p:2},children:[e.jsx(a,{sx:{mb:1},children:h.icon}),e.jsx(o,{variant:"subtitle1",sx:{fontWeight:600},children:h.label}),e.jsx(o,{variant:"body2",color:"text.secondary",children:h.description})]})})},h.value))})]});case 2:return e.jsxs(a,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Authentication Setup"}),s.cloudProvider==="firestore"||s.cloudProvider==="gcs"?e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Project ID",value:s.authentication.projectId||"",onChange:h=>w({authentication:{...s.authentication,projectId:h.target.value}}),error:!!P.projectId,helperText:P.projectId,required:!0})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Service Account Key (Optional)",value:s.authentication.serviceAccountKey||"",onChange:h=>w({authentication:{...s.authentication,serviceAccountKey:h.target.value}}),multiline:!0,rows:4,placeholder:"Paste your service account JSON key here..."})})]}):s.cloudProvider==="s3"||s.cloudProvider==="aws"?e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Access Key ID",value:s.authentication.accessKeyId||"",onChange:h=>w({authentication:{...s.authentication,accessKeyId:h.target.value}}),error:!!P.accessKeyId,helperText:P.accessKeyId,required:!0})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Secret Access Key",value:s.authentication.secretAccessKey||"",onChange:h=>w({authentication:{...s.authentication,secretAccessKey:h.target.value}}),error:!!P.secretAccessKey,helperText:P.secretAccessKey,required:!0,type:N.secretAccessKey?"text":"password",InputProps:{endAdornment:e.jsx(Pr,{position:"end",children:e.jsx(ce,{onClick:()=>ie("secretAccessKey"),edge:"end",children:N.secretAccessKey?e.jsx(Vr,{}):e.jsx(Jr,{})})})}})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Region",value:s.authentication.region||"",onChange:h=>w({authentication:{...s.authentication,region:h.target.value}}),placeholder:"us-east-1"})})]}):s.cloudProvider==="azure-blob"?e.jsx(g,{container:!0,spacing:3,children:e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Connection String",value:s.authentication.connectionString||"",onChange:h=>w({authentication:{...s.authentication,connectionString:h.target.value}}),error:!!P.connectionString,helperText:P.connectionString,required:!0,multiline:!0,rows:3,placeholder:"DefaultEndpointsProtocol=https;AccountName=..."})})}):e.jsx(o,{color:"text.secondary",children:"No authentication required for local storage."}),s.cloudProvider!=="local"&&e.jsxs(a,{sx:{mt:3},children:[e.jsx(S,{variant:"outlined",onClick:O,disabled:Y,startIcon:Y?e.jsx(gr,{size:16}):e.jsx(Hr,{}),children:Y?"Testing Connection...":"Test Connection"}),F&&e.jsx(de,{severity:F.success?"success":"error",sx:{mt:2},children:F.message})]})]});case 3:return e.jsxs(a,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Storage Configuration"}),s.cloudProvider==="gcs"&&e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"GCS Bucket Name",value:s.storage.gcsBucket||"",onChange:h=>w({storage:{...s.storage,gcsBucket:h.target.value}}),error:!!P.gcsBucket,helperText:P.gcsBucket,required:!0,placeholder:"my-dataset-bucket"})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Prefix (Optional)",value:s.storage.gcsPrefix||"",onChange:h=>w({storage:{...s.storage,gcsPrefix:h.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),s.cloudProvider==="s3"&&e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"S3 Bucket Name",value:s.storage.s3Bucket||"",onChange:h=>w({storage:{...s.storage,s3Bucket:h.target.value}}),error:!!P.s3Bucket,helperText:P.s3Bucket,required:!0,placeholder:"my-dataset-bucket"})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Region",value:s.storage.s3Region||"",onChange:h=>w({storage:{...s.storage,s3Region:h.target.value}}),placeholder:"us-east-1"})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Prefix (Optional)",value:s.storage.s3Prefix||"",onChange:h=>w({storage:{...s.storage,s3Prefix:h.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),s.cloudProvider==="azure-blob"&&e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Container Name",value:s.storage.azureContainer||"",onChange:h=>w({storage:{...s.storage,azureContainer:h.target.value}}),error:!!P.azureContainer,helperText:P.azureContainer,required:!0,placeholder:"datasets"})}),e.jsx(g,{item:!0,xs:12,children:e.jsx(M,{fullWidth:!0,label:"Prefix (Optional)",value:s.storage.azurePrefix||"",onChange:h=>w({storage:{...s.storage,azurePrefix:h.target.value}}),placeholder:"datasets/",helperText:"Optional folder prefix for organizing datasets"})})]}),s.cloudProvider==="local"&&e.jsx(o,{color:"text.secondary",children:"Local storage will be configured automatically based on your system settings."}),e.jsxs(de,{severity:"info",sx:{mt:3},children:[e.jsx(o,{variant:"subtitle2",sx:{fontWeight:600,mb:.5},children:"Using Backbone Logic Unified Schema"}),e.jsx(o,{variant:"body2",children:"The standard Backbone Logic schema will be automatically applied to this dataset. This ensures full compatibility with all application features and provides a consistent data structure."})]})]});case 4:return e.jsxs(a,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Advanced Options"}),e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsx(le,{control:e.jsx(De,{checked:((z=s.advanced)==null?void 0:z.encryption)||!1,onChange:h=>w({advanced:{...s.advanced,encryption:h.target.checked}})}),label:"Enable Encryption"})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsx(le,{control:e.jsx(De,{checked:((he=s.advanced)==null?void 0:he.compression)||!1,onChange:h=>w({advanced:{...s.advanced,compression:h.target.checked}})}),label:"Enable Compression"})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsx(le,{control:e.jsx(De,{checked:((xe=s.advanced)==null?void 0:xe.backup)||!1,onChange:h=>w({advanced:{...s.advanced,backup:h.target.checked}})}),label:"Enable Backup"})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsx(le,{control:e.jsx(De,{checked:((be=s.advanced)==null?void 0:be.versioning)||!1,onChange:h=>w({advanced:{...s.advanced,versioning:h.target.checked}})}),label:"Enable Versioning"})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsx(le,{control:e.jsx(De,{checked:((me=s.advanced)==null?void 0:me.accessLogging)||!1,onChange:h=>w({advanced:{...s.advanced,accessLogging:h.target.checked}})}),label:"Enable Access Logging"})})]})]});case 5:return e.jsxs(a,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Review & Create"}),e.jsxs(br,{sx:{p:3,mb:3},children:[e.jsx(o,{variant:"subtitle1",gutterBottom:!0,children:"Dataset Configuration Summary"}),e.jsxs(g,{container:!0,spacing:2,children:[e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Name: ",e.jsx("strong",{children:s.name})]})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Provider: ",e.jsx("strong",{children:s.cloudProvider})]})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Visibility: ",e.jsx("strong",{children:s.visibility})]})}),e.jsx(g,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"body2",color:"text.secondary",children:["Schema: ",e.jsx("strong",{children:"Backbone Logic Unified Schema"})]})})]})]}),e.jsx(de,{severity:"info",children:"Please review your configuration before creating the dataset. You can go back to any step to make changes."})]});default:return null}},[s,P,N,w,ie,O]);return i.useMemo(()=>d?e.jsxs(Ke,{open:d,onClose:T,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)",maxHeight:"90vh"}},children:[e.jsxs(qe,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"background.paper",borderBottom:"1px solid",borderColor:"divider",pb:2},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ae,{color:"primary"}),e.jsx(o,{variant:"h6",sx:{fontWeight:600},children:"Create Dataset"})]}),e.jsx(ce,{onClick:T,size:"small",children:e.jsx(Ar,{})})]}),e.jsxs(Ge,{sx:{p:3},children:[x&&e.jsx(de,{severity:"error",sx:{mb:3},children:x}),e.jsx(Zr,{activeStep:k,orientation:"horizontal",sx:{mb:3},children:cr.map((m,j)=>e.jsx(ea,{children:e.jsx(ra,{onClick:()=>W(j),sx:{cursor:"pointer"},children:m})},m))}),V(k),U&&e.jsx(aa,{sx:{mt:2}})]}),e.jsxs(Ye,{sx:{px:3,pb:3,pt:2,backgroundColor:"background.paper",borderTop:"1px solid",borderColor:"divider",justifyContent:"space-between"},children:[e.jsx(S,{onClick:T,variant:"outlined",disabled:U,sx:{borderColor:"primary.main",color:"primary.main"},children:"Cancel"}),e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(S,{onClick:ee,disabled:k===0||U,variant:"outlined",children:"Back"}),k===cr.length-1?e.jsx(S,{onClick:ge,variant:"contained",disabled:U||!s.name.trim(),startIcon:e.jsx(Ie,{}),sx:{backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:U?"Creating Dataset...":"Create Dataset"}):e.jsx(S,{onClick:Z,variant:"contained",disabled:U,children:"Next"})]})]})]}):null,[d,T,s,k,U,x,P,N,Y,F,ee,Z,W,ge,V])}),wa=({open:d,onClose:T,onDatasetUpdated:R})=>{const[n,D]=i.useState([]),[k,C]=i.useState(!1),[s,B]=i.useState(null),[U,K]=i.useState(null),[x,I]=i.useState(null),[P,Q]=i.useState(null),[N,re]=i.useState(null),[Y,u]=i.useState(!1),F=E;i.useEffect(()=>{d&&q()},[d]);const q=async()=>{try{C(!0),B(null);const b=await F.listDatasets();D(b)}catch(b){B("Failed to load datasets: "+b.message)}finally{C(!1)}},ae=b=>{var m,j;I({id:b.id,name:b.name,description:b.description||"",storage:{backend:((m=b.storage)==null?void 0:m.backend)||"firestore",path:((j=b.storage)==null?void 0:j.path)||""}})},w=async()=>{if(x)try{C(!0),B(null),await F.updateDataset(x.id,{name:x.name,description:x.description,storage:x.storage})?(K("Dataset updated successfully"),I(null),await q(),R==null||R()):B("Failed to update dataset")}catch(b){B("Failed to update dataset: "+b.message)}finally{C(!1)}},$=()=>{I(null)},Z=(b,m)=>{re(b),Q(m.currentTarget)},ee=async()=>{if(N)try{C(!0),B(null),await F.deleteDataset(N.id)?(K(`Dataset "${N.name}" deleted successfully`),await q(),R==null||R()):B("Failed to delete dataset")}catch(b){B("Failed to delete dataset: "+b.message)}finally{C(!1),Q(null),re(null)}},W=()=>{Q(null),re(null)},ie=async()=>{try{u(!0),B(null);const b=await F.cleanupCorruptedDatasets();b.cleaned>0?(K(`Cleaned up ${b.cleaned} corrupted datasets`),await q(),R==null||R()):K("No corrupted datasets found to clean up"),b.errors.length>0&&B(`Some errors occurred: ${b.errors.join(", ")}`)}catch(b){B("Failed to cleanup corrupted datasets: "+b.message)}finally{u(!1)}},O=b=>{switch(b){case"gcs":return"Google Cloud Storage";case"s3":return"Amazon S3";case"aws":return"AWS";case"azure":return"Azure";case"firestore":default:return"Firestore"}},ge=b=>{switch(b){case"gcs":return"primary";case"s3":return"warning";case"aws":return"info";case"azure":return"secondary";case"firestore":default:return"default"}},V=b=>new Date(b).toLocaleDateString()+" "+new Date(b).toLocaleTimeString();return e.jsxs(e.Fragment,{children:[e.jsxs(Ke,{open:d,onClose:T,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{bgcolor:"background.paper",backgroundImage:"none",minHeight:"600px"}},children:[e.jsxs(qe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:1,borderColor:"divider"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ve,{}),e.jsx(o,{variant:"h6",children:"Manage Datasets"})]}),e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(fe,{title:"Clean up corrupted datasets",children:e.jsx(S,{variant:"outlined",color:"warning",size:"small",onClick:ie,disabled:Y,startIcon:Y?e.jsx(gr,{size:16}):e.jsx(ta,{}),children:Y?"Cleaning...":"Cleanup"})}),e.jsx(fe,{title:"Refresh datasets",children:e.jsx(ce,{onClick:q,disabled:k,children:e.jsx(sa,{})})}),e.jsx(ce,{onClick:T,children:e.jsx(Ar,{})})]})]}),e.jsxs(Ge,{sx:{p:0},children:[s&&e.jsx(de,{severity:"error",sx:{m:2},onClose:()=>B(null),children:s}),U&&e.jsx(de,{severity:"success",sx:{m:2},onClose:()=>K(null),children:U}),k&&!Y?e.jsx(a,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(gr,{})}):e.jsx(Ir,{component:br,sx:{boxShadow:"none"},children:e.jsxs(Br,{children:[e.jsx(Rr,{children:e.jsxs(Te,{sx:{bgcolor:"grey.50"},children:[e.jsx(A,{children:e.jsx("strong",{children:"Name"})}),e.jsx(A,{children:e.jsx("strong",{children:"Description"})}),e.jsx(A,{children:e.jsx("strong",{children:"Storage"})}),e.jsx(A,{children:e.jsx("strong",{children:"Created"})}),e.jsx(A,{children:e.jsx("strong",{children:"Updated"})}),e.jsx(A,{align:"center",children:e.jsx("strong",{children:"Actions"})})]})}),e.jsx(Mr,{children:n.length===0?e.jsx(Te,{children:e.jsx(A,{colSpan:6,align:"center",sx:{py:4},children:e.jsx(o,{color:"textSecondary",children:"No datasets found"})})}):n.map(b=>{var m,j;return e.jsxs(Te,{hover:!0,children:[e.jsx(A,{children:(x==null?void 0:x.id)===b.id?e.jsx(M,{value:x.name,onChange:z=>I({...x,name:z.target.value}),size:"small",fullWidth:!0}):e.jsx(o,{variant:"body2",fontWeight:"medium",children:b.name})}),e.jsx(A,{children:(x==null?void 0:x.id)===b.id?e.jsx(M,{value:x.description,onChange:z=>I({...x,description:z.target.value}),size:"small",fullWidth:!0,multiline:!0,rows:2}):e.jsx(o,{variant:"body2",color:"textSecondary",children:b.description||"No description"})}),e.jsx(A,{children:(x==null?void 0:x.id)===b.id?e.jsxs(a,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsxs(ye,{size:"small",fullWidth:!0,children:[e.jsx(Be,{children:"Backend"}),e.jsxs(Re,{value:x.storage.backend,onChange:z=>I({...x,storage:{...x.storage,backend:z.target.value}}),label:"Backend",children:[e.jsx(_,{value:"firestore",children:"Firestore"}),e.jsx(_,{value:"gcs",children:"Google Cloud Storage"}),e.jsx(_,{value:"s3",children:"Amazon S3"}),e.jsx(_,{value:"aws",children:"AWS"}),e.jsx(_,{value:"azure",children:"Azure"})]})]}),e.jsx(M,{value:x.storage.path,onChange:z=>I({...x,storage:{...x.storage,path:z.target.value}}),size:"small",fullWidth:!0,label:"Path"})]}):e.jsx(H,{label:O(((m=b.storage)==null?void 0:m.backend)||"firestore"),color:ge(((j=b.storage)==null?void 0:j.backend)||"firestore"),size:"small"})}),e.jsx(A,{children:e.jsx(o,{variant:"body2",color:"textSecondary",children:b.createdAt?V(b.createdAt):"Unknown"})}),e.jsx(A,{children:e.jsx(o,{variant:"body2",color:"textSecondary",children:b.updatedAt?V(b.updatedAt):"Unknown"})}),e.jsx(A,{align:"center",children:(x==null?void 0:x.id)===b.id?e.jsxs(a,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[e.jsx(fe,{title:"Save changes",children:e.jsx(ce,{onClick:w,color:"primary",size:"small",disabled:k,children:e.jsx(oa,{})})}),e.jsx(fe,{title:"Cancel editing",children:e.jsx(ce,{onClick:$,color:"secondary",size:"small",disabled:k,children:e.jsx(na,{})})})]}):e.jsxs(a,{sx:{display:"flex",gap:1,justifyContent:"center"},children:[e.jsx(fe,{title:"Edit dataset",children:e.jsx(ce,{onClick:()=>ae(b),color:"primary",size:"small",disabled:k,children:e.jsx(ia,{})})}),e.jsx(fe,{title:"Delete dataset",children:e.jsx(ce,{onClick:z=>Z(b,z),color:"error",size:"small",disabled:k,children:e.jsx(xr,{})})})]})})]},b.id)})})]})})]}),e.jsx(Ye,{sx:{borderTop:1,borderColor:"divider",p:2},children:e.jsx(S,{onClick:T,variant:"outlined",children:"Close"})})]}),e.jsx(la,{open:!!P,anchorEl:P,onClose:W,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:e.jsxs(a,{sx:{p:2,maxWidth:300},children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Confirm Deletion"}),e.jsxs(o,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:['Are you sure you want to delete "',N==null?void 0:N.name,'"?']}),e.jsx(o,{variant:"caption",color:"error",display:"block",gutterBottom:!0,children:"This action cannot be undone and will remove the dataset from all projects."}),e.jsxs(a,{sx:{display:"flex",gap:1,justifyContent:"flex-end",mt:2},children:[e.jsx(S,{onClick:W,size:"small",children:"Cancel"}),e.jsx(S,{onClick:ee,color:"error",variant:"contained",size:"small",disabled:k,children:"Delete"})]})]})})]})},ur=d=>{var T,R;if(!d)return 10;if((T=d.subscription)!=null&&T.plan){const n=d.subscription.plan.toUpperCase();if(n==="ENTERPRISE")return 250;if(n==="PRO"||n==="PROFESSIONAL")return 50;if(n==="BASIC")return 10}if(d.licenses&&d.licenses.length>0){const n=d.licenses.find(D=>D.status==="ACTIVE"||D.status==="PENDING");if(n){const D=((R=n.key)==null?void 0:R.toUpperCase())||"";if(D.includes("ENTERPRISE"))return 250;if(D.includes("PROFESSIONAL")||D.includes("PRO"))return 50;if(D.includes("BASIC"))return 10}}return 10},Sa=d=>{var T,R,n,D,k,C,s,B,U,K,x,I,P,Q,N,re,Y,u,F;return console.log("🔍 [DashboardCloudProjectsBridge] Mapping project:",d.name),console.log("🔍 [DashboardCloudProjectsBridge] Raw project data:",d),console.log("🔍 [DashboardCloudProjectsBridge] Project status:",d.status),console.log("🔍 [DashboardCloudProjectsBridge] Project isActive field:",d.isActive),console.log("🔍 [DashboardCloudProjectsBridge] Project isArchived field:",d.isArchived),{id:d.id,name:d.name,description:d.description,applicationMode:((T=d.settings)==null?void 0:T.applicationMode)||"standalone",storageBackend:((R=d.settings)==null?void 0:R.storageBackend)||"firestore",gcsBucket:(n=d.settings)==null?void 0:n.gcsBucket,gcsPrefix:(D=d.settings)==null?void 0:D.gcsPrefix,s3Bucket:(k=d.settings)==null?void 0:k.s3Bucket,s3Region:(C=d.settings)==null?void 0:C.s3Region,s3Prefix:(s=d.settings)==null?void 0:s.s3Prefix,azureStorageAccount:(B=d.settings)==null?void 0:B.azureStorageAccount,azureContainer:(U=d.settings)==null?void 0:U.azureContainer,azurePrefix:(K=d.settings)==null?void 0:K.azurePrefix,lastAccessedAt:d.lastAccessedAt||new Date().toISOString(),isActive:d.status==="active"||d.isActive!==!1,isArchived:d.status==="archived"||d.isArchived===!0,allowCollaboration:((x=d.settings)==null?void 0:x.allowCollaboration)||!1,maxCollaborators:((I=d.settings)==null?void 0:I.maxCollaborators)||10,realTimeEnabled:((P=d.settings)==null?void 0:P.realTimeEnabled)||!1,settings:d.settings,teamMemberRole:(N=(Q=d.teamMembers)==null?void 0:Q[0])==null?void 0:N.role,role:(Y=(re=d.teamMembers)==null?void 0:re[0])==null?void 0:Y.role,assignedAt:(F=(u=d.teamMembers)==null?void 0:u[0])==null?void 0:F.assignedAt,projectOwner:d.ownerId}},Ra=()=>{const{user:d}=qr(),{setLoading:T}=Gr(),R=i.useCallback(()=>{if(!d)return null;const r=localStorage.getItem("auth_user");let t={...d};if(r)try{const l=JSON.parse(r);t={...d,...l,isTeamMember:l.isTeamMember||d.isTeamMember||l.role==="TEAM_MEMBER",organizationId:l.organizationId||d.organizationId,memberRole:l.memberRole||d.memberRole,memberStatus:l.memberStatus||d.memberStatus,teamMemberData:l.teamMemberData||d.teamMemberData}}catch(l){console.warn("Failed to parse stored user from localStorage:",l)}if(!t.subscription){const l=localStorage.getItem("user_subscription");if(l)try{const c=JSON.parse(l);t.subscription=c}catch(c){console.warn("Failed to parse subscription data from localStorage:",c)}const f=localStorage.getItem("user_billing");if(f&&!t.subscription)try{const c=JSON.parse(f);c.subscription&&(t.subscription=c.subscription)}catch(c){console.warn("Failed to parse billing data from localStorage:",c)}}return t},[d]),n=i.useMemo(()=>R(),[R]),D=i.useCallback(()=>{if(!n)return!1;if(n.memberRole==="OWNER"||n.role==="SUPERADMIN"||n.role==="ADMIN"||String(n.role).includes("ENTERPRISE"))return console.log("🔍 [DashboardCloudProjectsBridge] User is account owner - NOT a team member"),!1;const r=n.isTeamMember===!0||n.role==="TEAM_MEMBER";if(!r){const t=localStorage.getItem("team_member_data");if(t)try{const l=JSON.parse(t);if(l.memberRole==="OWNER"||l.role==="SUPERADMIN"||l.role==="ADMIN"||String(l.role).includes("ENTERPRISE"))return console.log("🔍 [DashboardCloudProjectsBridge] localStorage shows account owner - NOT a team member"),!1}catch(l){console.warn("Failed to parse team member data:",l)}}return console.log("🔍 [DashboardCloudProjectsBridge] User is team member:",r),r},[n]),k=i.useCallback(()=>{var t,l,f,c;if(!n)return console.log("🔍 [DashboardCloudProjectsBridge] No complete user data available"),!1;if(console.log("🔍 [DashboardCloudProjectsBridge] Checking permissions for user:",{id:n.id,email:n.email,role:n.role,memberRole:n.memberRole,isTeamMember:n.isTeamMember,organizationId:n.organizationId,subscription:n.subscription}),n.memberRole==="ENTERPRISE_ADMIN"||n.role==="ENTERPRISE_ADMIN"||String(n.role).includes("ENTERPRISE"))return console.log("✅ [DashboardCloudProjectsBridge] User is enterprise user or admin, can create projects"),!0;if(!D())return((t=n.subscription)==null?void 0:t.status)==="ACTIVE"||((l=n.subscription)==null?void 0:l.status)==="TRIALING"||n.role==="SUPERADMIN"||n.role==="ADMIN"?(console.log("✅ [DashboardCloudProjectsBridge] User is account owner with active subscription, can create projects"),!0):(f=n.subscription)!=null&&f.plan&&["BASIC","PRO","ENTERPRISE"].includes(n.subscription.plan)?(console.log("✅ [DashboardCloudProjectsBridge] User is account owner with subscription plan, can create projects"),!0):n.isDemoUser||localStorage.getItem("demo_user_status")==="ACTIVE"?(console.log("✅ [DashboardCloudProjectsBridge] User is demo user, can create projects"),!0):(console.log("⚠️ [DashboardCloudProjectsBridge] User is account owner but no active subscription or demo status"),!0);if(n.memberRole==="ADMIN"||n.role==="ADMIN")return console.log("✅ [DashboardCloudProjectsBridge] Team member has ADMIN role, can create projects"),!0;const r=localStorage.getItem("team_member_data");if(r)try{const v=JSON.parse(r);if(console.log("🔍 [DashboardCloudProjectsBridge] Team member data from localStorage:",v),v.role==="ADMIN"||v.memberRole==="ADMIN"||v.role==="TEAM_ADMIN")return console.log("✅ [DashboardCloudProjectsBridge] Team member data shows ADMIN role, can create projects"),!0}catch(v){console.warn("Failed to parse team member data for permissions check:",v)}return n.memberRole==="OWNER"||n.role==="OWNER"||String(n.memberRole).includes("OWNER")?(console.log("✅ [DashboardCloudProjectsBridge] User has OWNER role, can create projects"),!0):n.role==="SUPERADMIN"?(console.log("✅ [DashboardCloudProjectsBridge] User is SUPERADMIN, can create projects"),!0):(c=n.subscription)!=null&&c.plan&&["BASIC","PRO","ENTERPRISE"].includes(n.subscription.plan)?(console.log("✅ [DashboardCloudProjectsBridge] User has subscription plan, allowing project creation"),!0):n.subscription?(console.log("✅ [DashboardCloudProjectsBridge] User has subscription data, allowing project creation"),!0):(console.log("❌ [DashboardCloudProjectsBridge] User cannot create projects - regular team member without admin privileges"),!1)},[n,D]),[C,s]=i.useState([]),[B,U]=i.useState(!0),[K,x]=i.useState(null),[I,P]=i.useState(0),[Q,N]=i.useState(!1),[re,Y]=i.useState(!1),[u,F]=i.useState(null),[q,ae]=i.useState([]),[w,$]=i.useState(!1),[Z,ee]=i.useState([]),[W,ie]=i.useState(""),[O,ge]=i.useState("all"),[V,b]=i.useState(""),[m,j]=i.useState({}),[z,he]=i.useState(!1),[xe,be]=i.useState(null),[me,h]=i.useState(0),[X,ze]=i.useState(!1),[Tr,mr]=i.useState(null),[zr,pr]=i.useState(!1),[Ee,We]=i.useState([]),[Ve,Je]=i.useState([]),[ue,Ne]=i.useState(!1),[Fe,He]=i.useState(""),[jr,Qe]=i.useState("DO_ER"),[Ce,Xe]=i.useState(""),[Ze,Oe]=i.useState(!1),[er,fr]=i.useState(!1),[yr,rr]=i.useState(null),[G,Le]=i.useState(""),[ar,tr]=i.useState(0),[_e,Er]=i.useState(10),we=i.useCallback(async r=>{try{$(!0),console.log("🔍 [DashboardCloudProjectsBridge] Loading datasets for project:",r.id);const t=await E.getProjectDatasets(r.id);console.log("✅ [DashboardCloudProjectsBridge] Loaded assigned datasets:",t),ae(t),j(l=>({...l,[r.id]:t.length}));try{const l=await E.listDatasets({backend:O==="all"?void 0:O,query:V||void 0});console.log("✅ [DashboardCloudProjectsBridge] Loaded available datasets:",l),console.log("🔍 [DashboardCloudProjectsBridge] === DATASET DEBUG INFO ==="),l.forEach((p,J)=>{var L;console.log(`🔍 [DashboardCloudProjectsBridge] Dataset ${J}:`,{id:p.id,name:p.name,organizationId:p.organizationId,storage:p.storage,idType:typeof p.id,idLength:(L=p.id)==null?void 0:L.length,fullDataset:p})}),console.log("🔍 [DashboardCloudProjectsBridge] === END DATASET DEBUG ===");const f=l.filter(p=>!p.id||typeof p.id!="string"||p.id.trim()==="");f.length>0&&console.warn("⚠️ [DashboardCloudProjectsBridge] Found datasets with invalid IDs:",f);const c=l.find(p=>p.id==="dataset-001");c?console.log("✅ [DashboardCloudProjectsBridge] dataset-001 found:",c):(console.warn("⚠️ [DashboardCloudProjectsBridge] dataset-001 NOT found in available datasets!"),console.log("🔍 [DashboardCloudProjectsBridge] Available dataset IDs:",l.map(p=>p.id)));const v=l.map(p=>{var L;const J=je=>{switch(je){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...p,__label:`${p.name} ${J((L=p.storage)==null?void 0:L.backend)}`}});W&&!v.find(p=>p.id===W)&&(console.warn("⚠️ [DashboardCloudProjectsBridge] Clearing invalid selected dataset:",W),ie("")),ee(v)}catch(l){console.warn("⚠️ [DashboardCloudProjectsBridge] Failed to load available datasets, using empty list:",l),ee([])}}catch(t){console.error("❌ [DashboardCloudProjectsBridge] Failed to load datasets for project:",t),ae([]),ee([])}finally{$(!1)}},[O,V]),pe=i.useCallback(async r=>{try{Ne(!0),console.log("🔍 [DashboardCloudProjectsBridge] Loading team members for project:",r.id);try{const t=await E.getProjectTeamMembers(r.id);console.log("✅ [DashboardCloudProjectsBridge] Loaded assigned team members:",t),We(t)}catch(t){console.warn("⚠️ [DashboardCloudProjectsBridge] Failed to load assigned team members, using empty list:",t),We([])}try{const t=await E.getLicensedTeamMembers({search:Ce||void 0,excludeProjectId:r.id});console.log("✅ [DashboardCloudProjectsBridge] Loaded available team members:",t),Je(t)}catch(t){console.warn("⚠️ [DashboardCloudProjectsBridge] Failed to load licensed team members, using empty list:",t),Je([])}}catch(t){console.error("❌ [DashboardCloudProjectsBridge] Failed to load team members for project:",t),We([]),Je([])}finally{Ne(!1)}},[Ce]);i.useEffect(()=>{u&&(console.log("🔄 [DashboardCloudProjectsBridge] Project selected, loading data..."),we(u),pe(u))},[u,we,pe]),i.useEffect(()=>{se();const r=t=>{se()};return window.addEventListener("project:created",r),()=>window.removeEventListener("project:created",r)},[]);const Ue=i.useMemo(()=>{if(!G.trim())return C;const r=G.toLowerCase();return C.filter(t=>t.name.toLowerCase().includes(r)||t.description&&t.description.toLowerCase().includes(r)||t.storageBackend.toLowerCase().includes(r)||t.applicationMode.toLowerCase().includes(r))},[C,G]);i.useEffect(()=>{tr(0)},[G]);const Se=i.useMemo(()=>{console.log("🔍 [DashboardCloudProjectsBridge] Filtering projects for tab:",I),console.log("🔍 [DashboardCloudProjectsBridge] All filtered projects:",Ue);const r=Ue.filter(t=>{const l=I===0,f=l?t.isActive&&!t.isArchived:t.isArchived;return console.log(`🔍 [DashboardCloudProjectsBridge] Project "${t.name}":`,{isActive:t.isActive,isArchived:t.isArchived,isActiveTab:l,shouldShow:f}),f});return console.log("🔍 [DashboardCloudProjectsBridge] Filtered projects for display:",r),r},[Ue,I]),Wr=i.useMemo(()=>{const r=ar*_e;return Se.slice(r,r+_e)},[Se,ar,_e]);i.useEffect(()=>{if(u&&Ze){const r=setTimeout(()=>{console.log("🔄 [DashboardCloudProjectsBridge] Team member search changed, refreshing..."),pe(u)},300);return()=>clearTimeout(r)}},[Ce,u,Ze,pe]);const ke=i.useCallback(async r=>{try{console.log("🔍 [DashboardCloudProjectsBridge] Loading dataset counts for all projects...");const t=r.map(async c=>{try{const v=await E.getProjectDatasets(c.id);return{projectId:c.id,count:v.length}}catch(v){return console.warn(`⚠️ [DashboardCloudProjectsBridge] Failed to load datasets for project ${c.id}:`,v),{projectId:c.id,count:0}}}),l=await Promise.all(t),f={};l.forEach(({projectId:c,count:v})=>{f[c]=v}),j(f),console.log("✅ [DashboardCloudProjectsBridge] Loaded dataset counts for all projects:",f)}catch(t){console.error("❌ [DashboardCloudProjectsBridge] Failed to load dataset counts for all projects:",t)}},[]),se=async()=>{try{if(x(null),U(!0),D())try{console.log("🔍 [DashboardCloudProjectsBridge] Web-only mode: Fetching projects from Firestore...");const r=d;if(!(r!=null&&r.organizationId))throw console.warn("⚠️ [DashboardCloudProjectsBridge] No organization ID found for user"),new Error("No organization found for user");const{db:t}=await wr(async()=>{const{db:y}=await import("./firebase-DunYn50n.js");return{db:y}},__vite__mapDeps([0,1,2,3,4,5,6,7,8])),{collection:l,query:f,where:c,getDocs:v}=await wr(async()=>{const{collection:y,query:$e,where:$r,getDocs:Kr}=await import("./index.esm-DonjM_pP.js");return{collection:y,query:$e,where:$r,getDocs:Kr}},__vite__mapDeps([7,6])),p=f(l(t,"projects"),c("organizationId","==",r.organizationId)),J=await v(p);console.log(`🔍 [DashboardCloudProjectsBridge] Found ${J.size} projects for organization: ${r.organizationId}`);const L=J.docs.map(y=>({id:y.id,projectId:y.id,...y.data(),name:y.data().name||y.data().projectName||"Unnamed Project",projectName:y.data().name||y.data().projectName||"Unnamed Project",description:y.data().description||"",role:"MEMBER",teamMemberRole:"MEMBER",isActive:y.data().isActive!==!1,isArchived:y.data().isArchived===!0,assignedAt:y.data().createdAt||new Date().toISOString(),lastAccessed:y.data().lastAccessedAt||y.data().createdAt||new Date().toISOString(),ownerName:y.data().ownerName||"Organization Owner"}));console.log("🔍 [DashboardCloudProjectsBridge] Team member projects from Firestore:",L);const je=L.map(y=>{console.log("🔍 [DashboardCloudProjectsBridge] Transforming project:",y);const $e={id:y.projectId||y.id,name:y.projectName||y.name||"Unnamed Project",description:y.description||"",applicationMode:"shared_network",storageBackend:"firestore",lastAccessedAt:y.lastAccessed||y.assignedAt||new Date().toISOString(),isActive:y.isActive!==!1,isArchived:y.isArchived===!0,allowCollaboration:!0,maxCollaborators:y.maxCollaborators||10,realTimeEnabled:!0,enableComments:!0,enableChat:!0,enableActivityLog:!0,teamMemberRole:y.role||y.teamMemberRole||"MEMBER",assignedAt:y.assignedAt,projectOwner:y.ownerName||"Organization Owner"};return console.log("🔍 [DashboardCloudProjectsBridge] Transformed to:",$e),$e});s(je),await ke(je)}catch(r){console.error("Failed to fetch team member projects:",r);const t=localStorage.getItem("team_member_data");if(t)try{const c=JSON.parse(t);if(c.projectAccess&&Array.isArray(c.projectAccess)){const v=c.projectAccess.map(p=>({id:p.projectId,name:p.projectName||"Unnamed Project",description:p.description||"",applicationMode:"shared_network",storageBackend:"firestore",lastAccessedAt:p.lastAccessed||new Date().toISOString(),isActive:!0,isArchived:!1,allowCollaboration:!0,maxCollaborators:10,realTimeEnabled:!0,enableComments:!0,enableChat:!0,enableActivityLog:!0,teamMemberRole:p.role||"MEMBER",assignedAt:p.assignedAt,projectOwner:"Organization Owner"}));s(v),await ke(v);return}}catch(c){console.warn("Failed to parse fallback team member data:",c)}const f=Object.keys(localStorage).filter(c=>c.includes("team")||c.includes("member")||c.includes("project")||c.includes("assignment"));for(const c of f)try{const v=localStorage.getItem(c);if(v){const p=JSON.parse(v);p.projects||p.projectAccess||p.assignments}}catch{}x("Unable to load your assigned projects. Please contact your administrator or try again later."),s([])}else{console.log("🔍 [DashboardCloudProjectsBridge] Loading projects for account owner...");const r=await E.getProjects();console.log("🔍 [DashboardCloudProjectsBridge] Raw service projects:",r),console.log("🔍 [DashboardCloudProjectsBridge] Service projects count:",r.length);const t=r.map(Sa);console.log("🔍 [DashboardCloudProjectsBridge] Mapped cloud projects:",t),console.log("🔍 [DashboardCloudProjectsBridge] Mapped projects count:",t.length),s(t),console.log("✅ [DashboardCloudProjectsBridge] Projects set in state"),await ke(t)}}catch(r){console.error("Failed to load projects:",r),x((r==null?void 0:r.message)||"Failed to load projects"),s([])}finally{U(!1)}},Nr=async()=>{try{const r="https://backbone-client.web.app/";let t=!1;try{const l=document.createElement("a");l.href=r,l.target="_blank",l.rel="noopener noreferrer",document.body.appendChild(l),l.click(),document.body.removeChild(l),t=!0}catch{}t||(window.location.href=r)}catch(r){console.error("Failed to launch web app",r),x("Unable to open web app. Please try again.")}},Fr=()=>{try{const l="dashboardv14://open-app";window.location.href=l}catch(r){console.error("Failed to open desktop deep link",r),x("Unable to open Desktop app. Please ensure it is installed.")}},vr=()=>{N(!0),F(null)},Or=(r,t)=>{tr(t)},Lr=r=>{Er(parseInt(r.target.value,10)),tr(0)},_r=async r=>{N(!1),await se()},sr=r=>{switch(r){case"firestore":return e.jsx(Me,{});case"gcs":return e.jsx(ve,{});default:return e.jsx(hr,{})}},or=r=>r==="standalone"?e.jsx(hr,{}):e.jsx(Pe,{}),Ur=r=>{const t=new Date(r),f=new Date().getTime()-t.getTime(),c=Math.floor(f/(1e3*60*60*24));return c===0?"Today":c===1?"Yesterday":c<7?`${c} days ago`:t.toLocaleDateString()},nr=C.filter(r=>r.isActive&&!r.isArchived),ir=C.filter(r=>r.isArchived),te={totalProjects:C.length,activeProjects:nr.length,archivedProjects:ir.length,collaborativeProjects:C.filter(r=>r.allowCollaboration).length,totalDatasets:Object.values(m).reduce((r,t)=>r+t,0),storageBreakdown:{firestore:C.filter(r=>r.storageBackend==="firestore").length,gcs:C.filter(r=>r.storageBackend==="gcs").length,s3:C.filter(r=>r.storageBackend==="s3").length,local:C.filter(r=>r.storageBackend==="local").length,azure:C.filter(r=>r.storageBackend==="azure-blob").length},modeBreakdown:{standalone:C.filter(r=>r.applicationMode==="standalone").length,network:C.filter(r=>r.applicationMode==="shared_network").length}};i.useCallback(async()=>{C.length>0&&await ke(C)},[C,ke]);const Cr=i.useCallback(()=>{if(!n){console.log("🔍 [DashboardCloudProjectsBridge] No user data available for subscription debug");return}console.log("🔍 [DashboardCloudProjectsBridge] === SUBSCRIPTION DEBUG INFO ==="),console.log("User ID:",n.id),console.log("User Email:",n.email),console.log("User Role:",n.role),console.log("Member Role:",n.memberRole),console.log("Is Team Member:",n.isTeamMember),console.log("Organization ID:",n.organizationId),console.log("Subscription Data:",n.subscription),console.log("Demo User Status:",n.isDemoUser),console.log("LocalStorage Demo Status:",localStorage.getItem("demo_user_status")),console.log("LocalStorage Subscription:",localStorage.getItem("user_subscription")),console.log("LocalStorage Billing:",localStorage.getItem("user_billing")),console.log("==========================================")},[n]);return i.useEffect(()=>{if(n&&n.id){const r=`subscription_debug_${n.id}`;sessionStorage.getItem(r)||(Cr(),sessionStorage.setItem(r,"true"))}},[n,Cr]),e.jsxs(a,{sx:{py:4,px:3},children:[e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(a,{children:[e.jsx(o,{variant:"h4",component:"h1",fontWeight:"bold",gutterBottom:!0,children:D()?"My Assigned Projects":"Cloud Projects"}),e.jsx(o,{variant:"body1",color:"text.secondary",children:D()?k()?"Manage and collaborate on projects. As an admin, you can create new projects and access assigned ones.":"Access and collaborate on projects assigned to you by your team administrator":"Manage your projects with Firebase and Google Cloud Storage integration. Available for all license tiers: Basic, Pro, and Enterprise."}),D()&&n&&e.jsxs(a,{sx:{mt:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(H,{icon:e.jsx(Sr,{}),label:`Team Member - ${n.memberRole||"MEMBER"}`,color:"primary",size:"small",sx:{backgroundColor:"rgba(0, 212, 255, 0.1)",border:"1px solid rgba(0, 212, 255, 0.3)",color:"primary.main"}}),n.organizationId&&e.jsx(H,{icon:e.jsx(ca,{}),label:"Organization Access",color:"secondary",size:"small",sx:{backgroundColor:"rgba(156, 39, 176, 0.1)",border:"1px solid rgba(156, 39, 176, 0.3)",color:"secondary.main"}})]})]}),e.jsxs(a,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[k()&&e.jsx(S,{variant:"contained",startIcon:e.jsx(Ie,{}),onClick:r=>{r.preventDefault(),r.stopPropagation(),console.log("🚀 [DashboardCloudProjectsBridge] Create Project button clicked"),vr()},size:"large",sx:{minWidth:"160px",fontWeight:"bold",boxShadow:2,"&:hover":{boxShadow:4,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Create Project"}),k()&&e.jsx(S,{variant:"outlined",startIcon:e.jsx(Ae,{}),onClick:()=>{console.log("🚀 [DashboardCloudProjectsBridge] Create Dataset button clicked"),mr(null),ze(!0)},size:"large",sx:{minWidth:"160px",borderColor:"primary.main",color:"primary.main",fontWeight:"bold",borderWidth:2,"&:hover":{borderColor:"primary.dark",backgroundColor:"primary.main",color:"white",borderWidth:2,transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Create Dataset"}),k()&&e.jsx(S,{variant:"outlined",startIcon:e.jsx(ve,{}),onClick:()=>{console.log("🚀 [DashboardCloudProjectsBridge] Manage Datasets button clicked"),pr(!0)},size:"large",sx:{borderColor:"rgba(255, 255, 255, 0.2)",color:"white","&:hover":{borderColor:"rgba(255, 255, 255, 0.4)",backgroundColor:"rgba(255, 255, 255, 0.05)",transform:"translateY(-1px)"},transition:"all 0.2s ease-in-out"},children:"Manage Datasets"}),!k()&&n&&e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,px:2,py:1,backgroundColor:"warning.light",borderRadius:1,border:"1px solid",borderColor:"warning.main"},children:[e.jsx(da,{color:"warning"}),e.jsx(o,{variant:"body2",color:"warning.dark",children:D()?"Contact your team administrator to create projects":"Active subscription required to create projects"})]}),e.jsx(S,{variant:"contained",startIcon:e.jsx(kr,{}),onClick:Nr,sx:{background:"linear-gradient(135deg, #4f46e5, #7c3aed)",color:"white",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,boxShadow:"0 6px 20px rgba(79, 70, 229, 0.4)","&:hover":{background:"linear-gradient(135deg, #4338ca, #6d28d9)",boxShadow:"0 8px 25px rgba(79, 70, 229, 0.5)",transform:"translateY(-2px)"}},children:"Launch Web App"}),e.jsx(S,{variant:"contained",startIcon:e.jsx(kr,{}),onClick:Fr,sx:{background:"linear-gradient(135deg, #059669, #10b981)",color:"white",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,boxShadow:"0 6px 20px rgba(5, 150, 105, 0.4)","&:hover":{background:"linear-gradient(135deg, #047857, #059669)",boxShadow:"0 8px 25px rgba(5, 150, 105, 0.5)",transform:"translateY(-2px)"}},children:"Launch Desktop App"})]})]}),B?e.jsx(g,{container:!0,spacing:3,sx:{mb:4},children:[1,2,3,4].map(r=>e.jsx(g,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(oe,{sx:{height:"100%"},children:e.jsx(ne,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(a,{children:[e.jsx(a,{sx:{width:60,height:32,bgcolor:"grey.300",borderRadius:1,mb:1}}),e.jsx(a,{sx:{width:100,height:16,bgcolor:"grey.200",borderRadius:1}})]}),e.jsx(a,{sx:{width:40,height:40,bgcolor:"grey.200",borderRadius:"50%"}})]})})})},r))}):e.jsxs(g,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(g,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(oe,{sx:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(102, 126, 234, 0.3)"}},children:e.jsx(ne,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(a,{children:[e.jsx(o,{variant:"h4",fontWeight:"bold",children:te.totalProjects}),e.jsx(o,{variant:"body2",sx:{opacity:.9},children:D()?"Assigned Projects":"Total Projects"})]}),e.jsx(ua,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(g,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(oe,{sx:{background:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(17, 153, 142, 0.3)"}},onClick:()=>P(0),children:e.jsx(ne,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(a,{children:[e.jsx(o,{variant:"h4",fontWeight:"bold",children:te.activeProjects}),e.jsx(o,{variant:"body2",sx:{opacity:.9},children:"Active Projects"})]}),e.jsx(ga,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(g,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(oe,{sx:{background:"linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(252, 74, 26, 0.3)"}},onClick:()=>P(1),children:e.jsx(ne,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(a,{children:[e.jsx(o,{variant:"h4",fontWeight:"bold",children:te.archivedProjects}),e.jsx(o,{variant:"body2",sx:{opacity:.9},children:"Archived Projects"})]}),e.jsx(ha,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(g,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(oe,{sx:{background:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(79, 172, 254, 0.3)"}},children:e.jsx(ne,{children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(a,{children:[e.jsx(o,{variant:"h4",fontWeight:"bold",children:D()&&n?(n.memberRole||"MEMBER").toUpperCase():te.collaborativeProjects}),e.jsx(o,{variant:"body2",sx:{opacity:.9},children:D()?"Your Role":"Collaborative"})]}),e.jsx(xa,{sx:{fontSize:40,opacity:.8}})]})})})})]}),B?e.jsx(g,{container:!0,spacing:3,sx:{mb:4},children:[1,2].map(r=>e.jsx(g,{item:!0,xs:12,lg:6,children:e.jsx(oe,{sx:{height:"100%"},children:e.jsxs(ne,{children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(a,{sx:{width:24,height:24,bgcolor:"grey.300",borderRadius:"50%"}}),e.jsx(a,{sx:{width:200,height:20,bgcolor:"grey.300",borderRadius:1}})]}),[1,2,3].map(t=>e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(a,{sx:{width:20,height:20,bgcolor:"grey.200",borderRadius:"50%"}}),e.jsx(a,{sx:{width:80,height:16,bgcolor:"grey.200",borderRadius:1}})]}),e.jsx(a,{sx:{width:40,height:24,bgcolor:"grey.200",borderRadius:1}})]},t))]})})},r))}):e.jsxs(g,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(g,{item:!0,xs:12,lg:6,children:e.jsx(oe,{sx:{height:"100%",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1)"}},children:e.jsxs(ne,{children:[e.jsxs(o,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ve,{color:"primary"}),"Storage Backend Distribution"]}),e.jsxs(a,{sx:{mt:2},children:[Object.entries(te.storageBreakdown).map(([r,t])=>t>0&&e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[sr(r),e.jsx(o,{variant:"body2",sx:{textTransform:"capitalize"},children:r==="azure-blob"?"Azure Blob":r})]}),e.jsx(H,{size:"small",label:t,color:"primary",variant:"outlined"})]},r)),Object.values(te.storageBreakdown).every(r=>r===0)&&e.jsx(o,{variant:"body2",color:"text.secondary",children:"No projects with storage backends yet"})]})]})})}),e.jsx(g,{item:!0,xs:12,lg:6,children:e.jsx(oe,{sx:{height:"100%",transition:"transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out","&:hover":{transform:"translateY(-2px)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1)"}},children:e.jsxs(ne,{children:[e.jsxs(o,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Pe,{color:"primary"}),"Application Mode Distribution"]}),e.jsxs(a,{sx:{mt:2},children:[Object.entries(te.modeBreakdown).map(([r,t])=>t>0&&e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[or(r),e.jsx(o,{variant:"body2",sx:{textTransform:"capitalize"},children:r==="shared_network"?"Network":r})]}),e.jsx(H,{size:"small",label:t,color:"secondary",variant:"outlined"})]},r)),Object.values(te.modeBreakdown).every(r=>r===0)&&e.jsx(o,{variant:"body2",color:"text.secondary",children:"No projects created yet"})]}),te.totalDatasets>0&&e.jsx(a,{sx:{mt:3,pt:2,borderTop:"1px solid",borderColor:"divider"},children:e.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ae,{color:"primary"}),e.jsx(o,{variant:"body2",children:"Total Datasets"})]}),e.jsx(H,{size:"small",label:te.totalDatasets,color:"success",variant:"outlined"})]})})]})})})]}),K&&e.jsx(de,{severity:"error",sx:{mb:4},onClose:()=>x(null),children:K}),e.jsxs(ba,{value:I,onChange:(r,t)=>P(t),sx:{borderBottom:1,borderColor:"divider",mb:4},children:[e.jsx(Dr,{label:`Active Projects (${nr.length})`}),e.jsx(Dr,{label:`Archived (${ir.length})`})]}),e.jsxs(a,{sx:{mb:4,display:"flex",gap:3,alignItems:"center"},children:[e.jsx(M,{fullWidth:!0,placeholder:"Search projects by name, description, storage backend, or mode...",value:G,onChange:r=>Le(r.target.value),InputProps:{startAdornment:e.jsx(Pr,{position:"start",children:e.jsx(ma,{})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,"&:hover fieldset":{borderColor:"primary.main"}}}}),e.jsx(S,{variant:"outlined",onClick:se,sx:{minWidth:"auto",px:3},title:"Refresh projects list",children:"Refresh"})]}),e.jsxs(a,{children:[D()&&C.length>0&&e.jsx(a,{sx:{mb:3,p:3,backgroundColor:"rgba(0, 212, 255, 0.1)",borderRadius:2,border:"1px solid rgba(0, 212, 255, 0.3)"},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Sr,{sx:{color:"primary.main",fontSize:24}}),e.jsxs(a,{children:[e.jsx(o,{variant:"h6",color:"primary.main",sx:{fontWeight:600,mb:1},children:"Team Member Access"}),e.jsxs(o,{variant:"body2",color:"text.secondary",children:["You have access to ",C.length," project",C.length!==1?"s":""," assigned by your team administrator. Click on any project to view details and launch the application."]})]})]})}),B?e.jsx(a,{sx:{textAlign:"center",py:4},children:e.jsx(o,{children:"Loading projects..."})}):e.jsxs(e.Fragment,{children:[G&&e.jsx(a,{sx:{mb:2,p:2,backgroundColor:"primary.light",borderRadius:2,color:"white"},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(o,{variant:"body2",children:["Found ",Ue.filter(r=>I===0?r.isActive&&!r.isArchived:r.isArchived).length,' projects matching "',G,'"']}),e.jsx(S,{size:"small",variant:"text",onClick:()=>Le(""),sx:{color:"white",textDecoration:"underline"},children:"Clear Search"})]})}),e.jsx(Ir,{component:br,sx:{borderRadius:2,overflow:"auto",boxShadow:2,maxHeight:"70vh",width:"100%"},children:e.jsxs(Br,{sx:{width:"100%"},stickyHeader:!0,children:[e.jsx(Rr,{children:e.jsxs(Te,{sx:{backgroundColor:"primary.main"},children:[e.jsx(A,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Project"}),e.jsx(A,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Mode"}),e.jsx(A,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Storage"}),D()&&e.jsx(A,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Your Role"}),e.jsx(A,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Datasets"}),e.jsx(A,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Collaboration"}),e.jsx(A,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Last Accessed"}),e.jsx(A,{sx:{color:"white",fontWeight:600,fontSize:"0.875rem"},children:"Actions"})]})}),e.jsx(Mr,{children:Wr.map(r=>e.jsxs(Te,{sx:{"&:hover":{backgroundColor:"action.hover",cursor:"pointer"},"&:nth-of-type(odd)":{backgroundColor:"action.hover"}},children:[e.jsx(A,{children:e.jsxs(a,{children:[e.jsx(o,{variant:"subtitle1",fontWeight:600,children:r.name}),r.description&&e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:r.description})]})}),e.jsx(A,{children:e.jsx(H,{size:"small",icon:or(r.applicationMode),label:r.applicationMode==="standalone"?"Standalone":"Network",color:"primary",variant:"outlined"})}),e.jsx(A,{children:e.jsx(H,{size:"small",icon:sr(r.storageBackend),label:r.storageBackend,variant:"outlined"})}),D()&&e.jsx(A,{children:e.jsx(H,{size:"small",label:r.teamMemberRole||r.role||"MEMBER",color:"primary",variant:"outlined",sx:{backgroundColor:"rgba(0, 212, 255, 0.1)",borderColor:"rgba(0, 212, 255, 0.3)",color:"primary.main",fontWeight:600}})}),e.jsx(A,{children:typeof m[r.id]=="number"?e.jsx(H,{size:"small",label:`${m[r.id]} datasets`,variant:"outlined",color:"secondary"}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"-"})}),e.jsx(A,{children:r.allowCollaboration?e.jsx(H,{size:"small",label:`${r.maxCollaborators||ur(d)} users`,variant:"outlined",color:"success"}):e.jsx(o,{variant:"body2",color:"text.secondary",children:"Disabled"})}),e.jsx(A,{children:e.jsx(o,{variant:"body2",children:Ur(r.lastAccessedAt)})}),e.jsx(A,{children:e.jsxs(a,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[e.jsx(S,{size:"small",variant:"outlined",onClick:()=>F(r),sx:{borderColor:"primary.main",color:"primary.main",minWidth:"auto","&:hover":{borderColor:"primary.dark",backgroundColor:"primary.main",color:"white"}},children:"Details"}),e.jsx(S,{size:"small",variant:"outlined",color:r.isArchived?"success":"warning",onClick:async()=>{try{r.isArchived?await E.restoreProject(r.id):await E.archiveProject(r.id),await se()}catch(t){console.error("Failed to toggle archive",t),x("Failed to update project")}},sx:{minWidth:"auto"},children:r.isArchived?"Restore":"Archive"}),e.jsx(S,{size:"small",variant:"outlined",color:"error",onClick:async()=>{try{window.confirm(`Are you sure you want to permanently delete "${r.name}"? This action cannot be undone and will remove all project data, datasets, and team member assignments.`)&&(T(!0),await E.deleteProject(r.id)?(console.log(`✅ [DashboardCloudProjectsBridge] Project "${r.name}" deleted successfully`),await se(),x(null)):x(`Failed to delete project "${r.name}". Please try again.`))}catch(t){console.error("Failed to delete project:",t),x(`Failed to delete project "${r.name}": ${t instanceof Error?t.message:"Unknown error"}`)}finally{T(!1)}},sx:{minWidth:"auto",borderColor:"error.main",color:"error.main","&:hover":{borderColor:"error.dark",backgroundColor:"error.main",color:"white"}},children:"Delete"})]})})]},r.id))})]})}),e.jsx(pa,{component:"div",count:Se.length,page:ar,onPageChange:Or,rowsPerPage:_e,onRowsPerPageChange:Lr,rowsPerPageOptions:[5,10,25,50],sx:{mt:2}})]}),!B&&Se.length===0&&e.jsxs(a,{sx:{textAlign:"center",py:8},children:[e.jsx(Me,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(o,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:G?"No projects found matching your search":I===0?"No active projects yet":"No archived projects"}),e.jsx(o,{variant:"body2",color:"text.secondary",paragraph:!0,children:G?"Try adjusting your search terms or browse all projects":I===0?D()?k()?"No projects assigned yet. As a team admin, you can create new projects or wait for assignments from your organization administrator.":"No projects have been assigned to you yet. Contact your team administrator to get access to projects.":k()?"Create your first cloud project to get started with Firebase and GCS integration":"You need an active subscription to create projects. Please upgrade your account or contact support.":"Archived projects will appear here"}),I===0&&!G&&k()&&e.jsx(S,{variant:"contained",startIcon:e.jsx(Ie,{}),onClick:vr,size:"large",sx:{fontWeight:"bold",px:4,py:1.5,fontSize:"1.1rem",boxShadow:3,"&:hover":{boxShadow:6,transform:"translateY(-2px)"},transition:"all 0.3s ease-in-out"},children:"Create Your First Project"}),I===0&&!G&&D()&&!k()&&e.jsxs(a,{sx:{mt:2},children:[e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"💡 Team members without admin privileges cannot create projects. Projects must be assigned by your administrator."}),e.jsx(S,{variant:"outlined",onClick:se,size:"large",sx:{mt:1},children:"Refresh Projects"})]}),I===0&&!G&&!D()&&((n==null?void 0:n.memberRole)==="ENTERPRISE_ADMIN"||(n==null?void 0:n.role)==="ENTERPRISE_ADMIN")&&e.jsx(a,{sx:{mt:2},children:e.jsx(o,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"🎯 As an Enterprise Admin, you can create new projects and manage your organization's project portfolio."})}),G&&e.jsx(S,{variant:"outlined",onClick:()=>Le(""),size:"large",sx:{mr:2},children:"Clear Search"})]}),!B&&G&&Se.length===0&&(I===0?nr:ir).length>0&&e.jsxs(a,{sx:{textAlign:"center",py:4},children:[e.jsx(o,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No projects match your search criteria"}),e.jsx(o,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Try different search terms or browse all projects in this tab"}),e.jsx(S,{variant:"outlined",onClick:()=>Le(""),size:"large",children:"Clear Search"})]})]}),e.jsx(ya,{open:Q,onClose:()=>{N(!1)},mode:"shared_network",onSuccess:_r,maxCollaborators:ur(n),onCreate:async r=>await va.createProject(r)}),e.jsxs(Ke,{open:!!u,onClose:()=>{F(null)},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)",overflow:"hidden"}},children:[e.jsx(qe,{sx:{background:"linear-gradient(135deg, #0f3460 0%, #16213e 100%)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",p:3,position:"relative","&::after":{content:'""',position:"absolute",bottom:0,left:0,right:0,height:"2px",background:"linear-gradient(90deg, #4f46e5, #06b6d4, #3b82f6)",borderRadius:"1px"}},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(a,{sx:{width:48,height:48,borderRadius:"50%",background:"linear-gradient(135deg, #4f46e5, #06b6d4)",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 16px rgba(79, 70, 229, 0.3)"},children:e.jsx(ja,{sx:{color:"white",fontSize:24}})}),e.jsxs(a,{children:[e.jsx(o,{variant:"h5",sx:{color:"white",fontWeight:700,textShadow:"0 2px 4px rgba(0, 0, 0, 0.3)"},children:"Project Details"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:(u==null?void 0:u.name)||"Project Configuration"})]})]})}),e.jsx(Ge,{sx:{p:0,background:"transparent"},children:u&&e.jsxs(a,{sx:{p:3},children:[e.jsxs(a,{sx:{mb:4},children:[e.jsxs(o,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(a,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #10b981, #06b6d4)",boxShadow:"0 0 8px rgba(16, 185, 129, 0.5)"}}),"Project Information"]}),e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,sm:4,children:e.jsxs(a,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.2)",borderColor:"rgba(79, 70, 229, 0.3)"}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(a,{sx:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #4f46e5, #7c3aed)",display:"flex",alignItems:"center",justifyContent:"center"},children:u&&or(u.applicationMode)}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Mode"})]}),e.jsx(o,{variant:"h6",sx:{color:"white",fontWeight:600},children:(u==null?void 0:u.applicationMode)==="standalone"?"Standalone":"Network"})]})}),e.jsx(g,{item:!0,xs:12,sm:4,children:e.jsxs(a,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.2)",borderColor:"rgba(6, 182, 212, 0.3)"}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(a,{sx:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #06b6d4, #0891b2)",display:"flex",alignItems:"center",justifyContent:"center"},children:u&&sr(u.storageBackend)}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Storage Backend"})]}),e.jsx(o,{variant:"h6",sx:{color:"white",fontWeight:600},children:u==null?void 0:u.storageBackend})]})}),e.jsx(g,{item:!0,xs:12,sm:4,children:e.jsxs(a,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-2px)",boxShadow:"0 8px 25px rgba(0, 0, 0, 0.2)",borderColor:"rgba(16, 185, 129, 0.3)"}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(a,{sx:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #10b981, #059669)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Pe,{sx:{color:"white"}})}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Collaboration"})]}),e.jsxs(o,{variant:"h6",sx:{color:"white",fontWeight:600},children:["Up to ",(u==null?void 0:u.maxCollaborators)||ur(n)," users"]})]})})]})]}),e.jsxs(a,{children:[e.jsxs(o,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(a,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #f59e0b, #f97316)",boxShadow:"0 0 8px rgba(245, 158, 11, 0.5)"}}),"Assigned Datasets"]}),e.jsxs(a,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsx(a,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:e.jsx(S,{variant:"outlined",onClick:async()=>{if(u){console.log("🔄 [DashboardCloudProjectsBridge] Refreshing datasets for project:",u.id);try{$(!0),await we(u),console.log("✅ [DashboardCloudProjectsBridge] Datasets refreshed successfully")}catch(r){console.error("❌ [DashboardCloudProjectsBridge] Failed to refresh datasets:",r),x("Failed to refresh datasets")}finally{$(!1)}}},disabled:w,sx:{borderColor:"rgba(79, 70, 229, 0.5)",color:"#4f46e5",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#4f46e5",backgroundColor:"rgba(79, 70, 229, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:w?"Refreshing...":"Refresh"})}),e.jsxs(g,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(g,{item:!0,xs:12,sm:3,children:e.jsxs(ye,{fullWidth:!0,size:"small",children:[e.jsx(Be,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Backend"}),e.jsxs(Re,{value:O==="all"?"firestore":O,onChange:r=>ge(r.target.value),sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(79, 70, 229, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white","& .MuiMenuItem-root":{color:"white"}},children:[e.jsx(_,{value:"firestore",children:"Firestore"}),e.jsx(_,{value:"gcs",children:"Google Cloud Storage"}),e.jsx(_,{value:"s3",children:"Amazon S3"}),e.jsx(_,{value:"aws",children:"AWS Services"}),e.jsx(_,{value:"azure",children:"Microsoft Azure"})]})]})}),e.jsx(g,{item:!0,xs:12,sm:4,children:e.jsx(M,{fullWidth:!0,size:"small",placeholder:"Search datasets...",value:V,onChange:r=>b(r.target.value),sx:{"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(79, 70, 229, 0.5)"},"& input::placeholder":{color:"rgba(255, 255, 255, 0.5)",opacity:1}}}})}),e.jsx(g,{item:!0,xs:12,sm:3,children:e.jsxs(ye,{fullWidth:!0,size:"small",children:[e.jsx(Be,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Select dataset"}),e.jsxs(Re,{value:W,onChange:r=>{const t=r.target.value;console.log("🔍 [DashboardCloudProjectsBridge] Dataset selection changed:",{oldValue:W,newValue:t,valueType:typeof t,availableDatasetIds:Z.map(l=>l.id)}),ie(t)},sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(79, 70, 229, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white","& .MuiMenuItem-root":{color:"white"}},children:[e.jsx(_,{value:"",children:"Select dataset..."}),Z.map(r=>e.jsx(_,{value:r.id,children:r.__label||r.name},r.id))]})]})}),e.jsx(g,{item:!0,xs:12,sm:2,children:e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(S,{variant:"contained",size:"small",disabled:!W||w,onClick:async()=>{if(!u||!W)return;const r=Z.find(t=>t.id===W);if(console.log("🔍 [DashboardCloudProjectsBridge] Selected dataset details:",{selectedDatasetId:W,selectedDataset:r,availableDatasetsCount:Z.length,availableDatasetIds:Z.map(t=>t.id)}),!r){console.error("❌ [DashboardCloudProjectsBridge] Selected dataset not found in available datasets:",{selectedDatasetId:W,availableDatasetIds:Z.map(t=>t.id)}),x(`Selected dataset (${W}) not found. Please try selecting a different dataset.`);return}console.log("🔗 [DashboardCloudProjectsBridge] Assigning dataset to project:",{projectId:u.id,datasetId:W});try{$(!0),await E.assignDatasetToProject(u.id,W),console.log("✅ [DashboardCloudProjectsBridge] Dataset assigned successfully");const t=await E.getProjectDatasets(u.id);ae(t),j(c=>({...c,[u.id]:t.length}));const f=(await E.listDatasets({backend:O==="all"?void 0:O,query:V||void 0})).map(c=>{var p;const v=J=>{switch(J){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...c,__label:`${c.name} ${v((p=c.storage)==null?void 0:p.backend)}`}});ee(f),ie(""),console.log("✅ [DashboardCloudProjectsBridge] Dataset assignment completed and lists refreshed")}catch(t){console.error("❌ [DashboardCloudProjectsBridge] Failed to assign dataset:",t),x("Failed to assign dataset to project")}finally{$(!1)}},sx:{background:"linear-gradient(135deg, #10b981, #059669)",color:"white",borderRadius:2,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)","&:hover":{background:"linear-gradient(135deg, #059669, #047857)",boxShadow:"0 6px 20px rgba(16, 185, 129, 0.4)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)",boxShadow:"none"}},children:w?"Assigning...":"Assign"}),e.jsx(S,{variant:"outlined",size:"small",onClick:async()=>{if(u){console.log("🔍 [DashboardCloudProjectsBridge] Applying dataset filters:",{backend:O,search:V});try{$(!0);const r=await E.listDatasets({backend:O==="all"?void 0:O,query:V||void 0});console.log("✅ [DashboardCloudProjectsBridge] Filtered datasets loaded:",r);const t=r.map(f=>{var v;const c=p=>{switch(p){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...f,__label:`${f.name} ${c((v=f.storage)==null?void 0:v.backend)}`}});ee(t);const l=await E.getProjectDatasets(u.id);ae(l),j(f=>({...f,[u.id]:l.length})),console.log("✅ [DashboardCloudProjectsBridge] Filters applied successfully")}catch(r){console.error("❌ [DashboardCloudProjectsBridge] Failed to apply filters:",r),x("Failed to apply dataset filters")}finally{$(!1)}}},disabled:w,sx:{borderColor:"rgba(79, 70, 229, 0.5)",color:"#4f46e5",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#4f46e5",backgroundColor:"rgba(79, 70, 229, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:w?"Applying...":"Apply Filters"})]})})]}),e.jsxs(a,{children:[e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2,fontWeight:500},children:"Currently Assigned Datasets"}),q.length===0?e.jsxs(a,{sx:{p:4,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx(Ae,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No datasets assigned to this project"})]}):e.jsx(a,{sx:{borderRadius:2,overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.1)"},children:q.map((r,t)=>e.jsxs(a,{sx:{p:2,background:t%2===0?"rgba(255, 255, 255, 0.02)":"rgba(255, 255, 255, 0.05)",borderBottom:t<q.length-1?"1px solid rgba(255, 255, 255, 0.1)":"none",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease","&:hover":{background:"rgba(79, 70, 229, 0.1)",transform:"translateX(4px)"}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(a,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #f59e0b, #f97316)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ae,{sx:{color:"white",fontSize:16}})}),e.jsxs(a,{children:[e.jsx(o,{variant:"body1",sx:{color:"white",fontWeight:500},children:r.name}),r.description&&e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)"},children:r.description})]})]}),e.jsx(S,{variant:"outlined",size:"small",startIcon:e.jsx(xr,{}),onClick:async()=>{try{console.log("🗑️ [DashboardCloudProjectsBridge] Removing dataset from project:",{projectId:u.id,datasetId:r.id}),await E.unassignDatasetFromProject(u.id,r.id),console.log("✅ [DashboardCloudProjectsBridge] Dataset removed successfully"),ae(c=>c.filter(v=>v.id!==r.id)),j(c=>({...c,[u.id]:Math.max(0,(c[u.id]||1)-1)}));const f=(await E.listDatasets({backend:O==="all"?void 0:O,query:V||void 0})).map(c=>{var p;const v=J=>{switch(J){case"gcs":return"(GCS)";case"s3":return"(S3)";case"aws":return"(AWS)";case"azure":return"(Azure)";case"firestore":default:return"(Firestore)"}};return{...c,__label:`${c.name} ${v((p=c.storage)==null?void 0:p.backend)}`}});ee(f),console.log("✅ [DashboardCloudProjectsBridge] Dataset removal completed and lists refreshed")}catch(l){console.error("❌ [DashboardCloudProjectsBridge] Failed to remove dataset:",l),x("Failed to remove dataset from project")}},sx:{borderColor:"rgba(239, 68, 68, 0.5)",color:"#ef4444",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",transform:"scale(1.05)"}},children:"Remove"})]},r.id))})]})]})]}),e.jsxs(a,{sx:{mt:4},children:[e.jsxs(o,{variant:"h6",sx:{color:"white",mb:3,fontWeight:600,display:"flex",alignItems:"center",gap:1},children:[e.jsx(a,{sx:{width:8,height:8,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",boxShadow:"0 0 8px rgba(139, 92, 246, 0.5)"}}),"Team Members"]}),e.jsxs(a,{sx:{p:3,borderRadius:2,background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)"},children:[e.jsxs(a,{sx:{display:"flex",gap:2,mb:3,flexWrap:"wrap"},children:[e.jsx(S,{variant:"contained",startIcon:e.jsx(Ie,{}),onClick:()=>Oe(!0),sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,boxShadow:"0 4px 12px rgba(139, 92, 246, 0.3)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 6px 20px rgba(139, 92, 246, 0.4)",transform:"translateY(-1px)"}},children:"Add Team Member"}),e.jsx(S,{variant:"outlined",onClick:async()=>{if(u){console.log("🔄 [DashboardCloudProjectsBridge] Refreshing team members for project:",u.id);try{Ne(!0),await pe(u),console.log("✅ [DashboardCloudProjectsBridge] Team members refreshed successfully")}catch(r){console.error("❌ [DashboardCloudProjectsBridge] Failed to refresh team members:",r),x("Failed to refresh team members")}finally{Ne(!1)}}},disabled:ue,sx:{borderColor:"rgba(139, 92, 246, 0.5)",color:"#8b5cf6",borderRadius:2,px:3,py:1,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#8b5cf6",backgroundColor:"rgba(139, 92, 246, 0.1)"},"&:disabled":{borderColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.3)"}},children:ue?"Refreshing...":"Refresh"})]}),e.jsxs(a,{children:[e.jsxs(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)",mb:2,fontWeight:500},children:["Project Team Members (",Ee.length,")"]}),Ee.length===0?e.jsxs(a,{sx:{p:4,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx(Pe,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No team members assigned to this project"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.4)",mt:1},children:"Add licensed team members to collaborate on this project"})]}):e.jsx(a,{sx:{borderRadius:2,overflow:"hidden",border:"1px solid rgba(255, 255, 255, 0.1)"},children:Ee.map((r,t)=>{var J;const l=r.teamMember||r,f=l.name||(l.firstName&&l.lastName?`${l.firstName} ${l.lastName}`:l.firstName||((J=l.email)==null?void 0:J.split("@")[0])||"Unnamed User"),c=l.email||r.email||"No email",v=r.role||"Member",p=l.licenseType||r.licenseType;return e.jsxs(a,{sx:{p:3,background:t%2===0?"rgba(255, 255, 255, 0.02)":"rgba(255, 255, 255, 0.05)",borderBottom:t<Ee.length-1?"1px solid rgba(255, 255, 255, 0.1)":"none",display:"flex",alignItems:"center",justifyContent:"space-between",transition:"all 0.2s ease","&:hover":{background:"rgba(139, 92, 246, 0.1)",transform:"translateX(4px)"}},children:[e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(a,{sx:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"18px",fontWeight:600,color:"white"},children:f.charAt(0).toUpperCase()}),e.jsxs(a,{children:[e.jsx(o,{variant:"body1",sx:{color:"white",fontWeight:500},children:f}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.6)"},children:c}),e.jsxs(a,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(H,{size:"small",label:v,sx:{backgroundColor:"rgba(139, 92, 246, 0.2)",color:"#c4b5fd",fontSize:"11px"}}),p&&e.jsx(H,{size:"small",label:p,sx:{backgroundColor:"rgba(16, 185, 129, 0.2)",color:"#6ee7b7",fontSize:"11px"}})]})]})]}),e.jsx(S,{variant:"outlined",size:"small",startIcon:e.jsx(xr,{}),onClick:async()=>{try{const L=r.teamMemberId||r.id;if(!L){console.error("No valid team member ID found:",r),alert("Error: Invalid team member ID");return}await E.removeTeamMemberFromProject(u.id,L),We(je=>je.filter(y=>(y.teamMemberId||y.id)!==L))}catch(L){console.error("Failed to remove team member",L),alert(`Failed to remove team member: ${(L==null?void 0:L.message)||"Unknown error"}`)}},sx:{borderColor:"rgba(239, 68, 68, 0.5)",color:"#ef4444",borderRadius:2,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",transform:"scale(1.05)"}},children:"Remove"})]},r.id)})})]})]})]})]})}),e.jsx(Ye,{sx:{p:3,background:"rgba(255, 255, 255, 0.02)",borderTop:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"space-between"},children:e.jsx(S,{onClick:()=>F(null),variant:"outlined",sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Close"})})]}),e.jsx(Yr,{children:e.jsx(Ca,{open:X,onClose:()=>{ze(!1),mr(null)},onSuccess:r=>{u&&we(u),se()},assignToProject:Tr||void 0})}),e.jsxs(Ke,{open:Ze,onClose:()=>Oe(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:3,background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",border:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.3)"}},children:[e.jsx(qe,{sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",p:3},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(a,{sx:{width:40,height:40,borderRadius:"50%",background:"rgba(255, 255, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ie,{sx:{color:"white"}})}),e.jsxs(a,{children:[e.jsx(o,{variant:"h6",sx:{fontWeight:600},children:"Add Team Member"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:"Add licensed team members to this project"})]})]})}),e.jsxs(Ge,{sx:{p:3,background:"transparent"},children:[yr&&e.jsx(de,{severity:"error",sx:{mb:3},children:yr}),e.jsxs(a,{sx:{mb:3},children:[e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.7)",mb:2},children:"Search and select from your licensed team members:"}),e.jsx(M,{fullWidth:!0,placeholder:"Search team members by name or email...",value:Ce,onChange:r=>Xe(r.target.value),sx:{mb:2,"& .MuiOutlinedInput-root":{color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(139, 92, 246, 0.5)"},"& input::placeholder":{color:"rgba(255, 255, 255, 0.5)",opacity:1}}}}),e.jsxs(ye,{fullWidth:!0,sx:{mb:2},children:[e.jsx(Be,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Select Team Member"}),e.jsxs(Re,{value:Fe,onChange:r=>He(r.target.value),disabled:ue,sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(139, 92, 246, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white"},children:[e.jsx(_,{value:"",children:e.jsx("em",{children:ue?"Loading team members...":"Select a team member..."})}),!ue&&Ve.length===0&&e.jsx(_,{disabled:!0,children:e.jsx(o,{component:"em",sx:{color:"rgba(255, 255, 255, 0.5)"},children:Ce?"No team members found matching your search":"No available team members found"})}),!ue&&Ve.map(r=>{var t,l,f,c;return e.jsx(_,{value:r.id,children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2,width:"100%"},children:[e.jsx(a,{sx:{width:32,height:32,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6, #a855f7)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:600,color:"white"},children:((l=(t=r.name)==null?void 0:t.charAt(0))==null?void 0:l.toUpperCase())||((c=(f=r.email)==null?void 0:f.charAt(0))==null?void 0:c.toUpperCase())||"U"}),e.jsxs(a,{sx:{flexGrow:1},children:[e.jsx(o,{variant:"body2",sx:{fontWeight:500,color:"white"},children:r.name||"Unnamed User"}),e.jsxs(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.7)"},children:[r.email," • ",r.licenseType||"Licensed"]})]})]})},r.id)})]})]}),e.jsxs(ye,{fullWidth:!0,children:[e.jsx(Be,{sx:{color:"rgba(255, 255, 255, 0.7)"},children:"Project Role"}),e.jsxs(Re,{value:jr,onChange:r=>Qe(r.target.value),sx:{"& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(139, 92, 246, 0.5)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"},color:"white"},children:[e.jsx(_,{value:"DO_ER",children:e.jsxs(a,{children:[e.jsx(o,{variant:"body2",sx:{fontWeight:500,color:"white"},children:"Do_Er"}),e.jsx(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)"},children:"Can create, edit, and delete data but no admin privileges"})]})}),e.jsx(_,{value:"ADMIN",children:e.jsxs(a,{children:[e.jsx(o,{variant:"body2",sx:{fontWeight:500,color:"white"},children:"Admin"}),e.jsx(o,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.8)"},children:"Full administrative access (only 1 admin per project)"})]})})]})]})]}),Ve.length===0&&!ue&&e.jsxs(a,{sx:{p:3,textAlign:"center",borderRadius:2,background:"rgba(255, 255, 255, 0.02)",border:"1px dashed rgba(255, 255, 255, 0.1)"},children:[e.jsx(Pe,{sx:{fontSize:48,color:"rgba(255, 255, 255, 0.3)",mb:2}}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.5)"},children:"No available team members found"}),e.jsx(o,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.4)",mt:1},children:"Make sure team members have valid licenses and aren't already assigned to this project"})]})]}),e.jsxs(Ye,{sx:{p:3,background:"rgba(255, 255, 255, 0.02)",borderTop:"1px solid rgba(255, 255, 255, 0.1)",display:"flex",justifyContent:"space-between"},children:[e.jsx(S,{onClick:()=>{Oe(!1),He(""),Qe("DO_ER"),Xe(""),rr(null)},variant:"outlined",disabled:er,sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"rgba(255, 255, 255, 0.8)",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,"&:hover":{borderColor:"rgba(255, 255, 255, 0.5)",backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:"Cancel"}),e.jsx(S,{variant:"contained",disabled:er||!Fe,onClick:async()=>{if(!(!u||!Fe)){rr(null),fr(!0);try{await E.addTeamMemberToProject(u.id,Fe,jr),await pe(u),Oe(!1),He(""),Qe("DO_ER"),Xe("")}catch(r){console.error("Failed to add team member:",r),rr((r==null?void 0:r.message)||"Failed to add team member")}finally{fr(!1)}}},sx:{background:"linear-gradient(135deg, #8b5cf6, #a855f7)",color:"white",borderRadius:2,px:4,py:1.5,textTransform:"none",fontWeight:600,boxShadow:"0 6px 20px rgba(139, 92, 246, 0.4)","&:hover":{background:"linear-gradient(135deg, #7c3aed, #9333ea)",boxShadow:"0 8px 25px rgba(139, 92, 246, 0.5)",transform:"translateY(-2px)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.3)",boxShadow:"none"}},children:er?"Adding...":"Add Team Member"})]})]}),e.jsx(wa,{open:zr,onClose:()=>pr(!1),onDatasetUpdated:()=>{u&&we(u),se()}})]})};export{Ra as DashboardCloudProjectsBridge,Ra as default};
