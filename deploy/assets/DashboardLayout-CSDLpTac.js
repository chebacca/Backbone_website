import{j as e,aB as ae,g as M,bB as O,H as v,bC as ce,bD as le,B as i,bE as de,bF as $,bG as pe,A as F,a as P,aA as xe,bH as he,ar as ge,M as Q,y as b,aW as X,bI as ue,bJ as J,d as be,aQ as Z,a4 as W,ac as G,bK as me,aI as ee,X as te,a2 as re,J as ye,T as k,ae as je,r as _,w as fe,x as A,bL as I,z as D,D as q,as as Se,Y as ke}from"./mui-CCWxH8Vb.js";import{u as oe,r as p,e as ve,b as Ce,L as m,O as Ae}from"./vendor-CjD1bmmO.js";import{u as ne}from"./index-CxNnS82J.js";import"./stripe-vGaGA8Al.js";const Ie=()=>{const U=oe(),{user:h}=ne(),[s,j]=p.useState("USER"),[f,N]=p.useState(),[c,r]=p.useState(0),[w,l]=p.useState(0);p.useEffect(()=>{(async()=>{var a,d,g,n;if(h)try{const t=(await h.getIdTokenResult()).claims;console.log("SecurityNavigation - User claims:",t),console.log("SecurityNavigation - User email:",h.email);const T=(t==null?void 0:t.role)==="DEV_ADMIN"||(t==null?void 0:t.role)==="SuperAdmin"||(t==null?void 0:t.role)==="SUPERADMIN"||(t==null?void 0:t.isDevAdmin)===!0||((a=t==null?void 0:t.permissions)==null?void 0:a.includes("security:master_access"))||((d=t==null?void 0:t.permissions)==null?void 0:d.includes("admin:master_security")),E=(t==null?void 0:t.role)==="ADMIN"||(t==null?void 0:t.role)==="ORG_ADMIN"||(t==null?void 0:t.role)==="SuperAdmin"||(t==null?void 0:t.role)==="SUPERADMIN"||(t==null?void 0:t.isOrgAdmin)===!0||((g=t==null?void 0:t.permissions)==null?void 0:g.includes("admin:organization"))||((n=t==null?void 0:t.permissions)==null?void 0:n.includes("admin:team_members"));console.log("SecurityNavigation - isDevAdmin:",T),console.log("SecurityNavigation - isOrgAdmin:",E),T?(console.log("SecurityNavigation - Setting role to DEV_ADMIN"),j("DEV_ADMIN")):E?(console.log("SecurityNavigation - Setting role to ORG_ADMIN"),j("ORG_ADMIN"),N((t==null?void 0:t.organizationId)||h.organizationId)):(console.log("SecurityNavigation - Setting role to USER"),j("USER"))}catch(S){console.error("Error checking user permissions:",S),j("USER")}})()},[h]),p.useEffect(()=>{const C=async()=>{try{if(s==="DEV_ADMIN"){const[a,d]=await Promise.all([fetch("/api/security/alerts?source=dashboard_app").then(t=>t.json()).catch(()=>[]),fetch("/api/security/alerts?source=licensing_website").then(t=>t.json()).catch(()=>[])]),n=[...a,...d].filter(t=>!t.resolved),S=n.filter(t=>t.severity==="critical");r(n.length),l(S.length)}else if(s==="ORG_ADMIN"&&f){const d=(await fetch(`/api/security/alerts?source=licensing_website&organizationId=${f}`).then(n=>n.json()).catch(()=>[])).filter(n=>!n.resolved),g=d.filter(n=>n.severity==="critical");r(d.length),l(g.length)}}catch(a){console.error("Error loading security alerts:",a)}};if(s==="DEV_ADMIN"||s==="ORG_ADMIN"){C();const a=setInterval(C,3e4);return()=>clearInterval(a)}},[s,f]);const L=()=>{U("/security-dashboard")};return console.log("SecurityNavigation - Current userRole:",s),console.log("SecurityNavigation - Should render:",s==="DEV_ADMIN"||s==="ORG_ADMIN"),s!=="DEV_ADMIN"&&s!=="ORG_ADMIN"?(console.log("SecurityNavigation - Not rendering, userRole:",s),null):(console.log("SecurityNavigation - Rendering security button"),e.jsx(ae,{title:s==="DEV_ADMIN"?"Master Security Dashboard":"Organization Security Dashboard",children:e.jsx(M,{color:"inherit",onClick:L,sx:{mr:1,backgroundColor:w>0?"error.dark":"transparent","&:hover":{backgroundColor:w>0?"error.main":"rgba(255,255,255,0.1)"}},children:e.jsx(O,{badgeContent:c,color:"error",children:e.jsx(v,{})})})}))},y=280,De=[{text:"Overview",icon:e.jsx(Z,{}),path:"/dashboard"},{text:"Licenses",icon:e.jsx(re,{}),path:"/dashboard/licenses"},{text:"Cloud Projects",icon:e.jsx(G,{}),path:"/dashboard/cloud-projects"},{text:"Team Management",icon:e.jsx(te,{}),path:"/dashboard/team"},{text:"Billing & Payments",icon:e.jsx(W,{}),path:"/dashboard/billing"},{text:"Support",icon:e.jsx(ye,{}),path:"/dashboard/support"},{text:"Settings",icon:e.jsx(X,{}),path:"/dashboard/settings"}],Me=[{text:"Organization",icon:e.jsx(ke,{}),path:"/dashboard/organization"},{text:"Security Center",icon:e.jsx(v,{}),path:"/security-dashboard"},{text:"Compliance",icon:e.jsx(v,{}),path:"/dashboard/compliance"}],Ne=[{text:"Overview",icon:e.jsx(Z,{}),path:"/accounting#overview"},{text:"Payments",icon:e.jsx(W,{}),path:"/accounting#payments"},{text:"Tax",icon:e.jsx(G,{}),path:"/accounting#tax"},{text:"Filings",icon:e.jsx(me,{}),path:"/accounting#filings"},{text:"KYC",icon:e.jsx(v,{}),path:"/accounting#kyc"},{text:"Compliance",icon:e.jsx(v,{}),path:"/accounting#compliance"},{text:"Terms",icon:e.jsx(ee,{}),path:"/accounting#terms"}],we=[{text:"Users",icon:e.jsx(te,{}),path:"/admin#users"},{text:"Licenses",icon:e.jsx(re,{}),path:"/admin#licenses"},{text:"Invoices",icon:e.jsx(W,{}),path:"/admin#invoices"},{text:"System Health",icon:e.jsx(v,{}),path:"/admin#system"}],Te=()=>{var V;const U=ce(),h=le(U.breakpoints.down("lg")),[s,j]=p.useState(!1),[f,N]=p.useState(null),c=ve(),{user:r,logout:w}=ne(),l=oe(),[L,C]=p.useState(()=>{try{return localStorage.getItem("dismiss_kyc_banner")==="1"}catch{return!1}}),a=String((r==null?void 0:r.role)||"").toUpperCase()==="ACCOUNTING";if(p.useEffect(()=>{a&&c.pathname.startsWith("/dashboard")&&l("/accounting",{replace:!0})},[a,c.pathname,l]),a&&!c.pathname.startsWith("/accounting"))return null;const d=()=>{j(!s)},g=x=>{N(x.currentTarget)},n=()=>{N(null)},S=async()=>{try{await w(),n()}catch(x){console.error("Logout failed:",x),n()}},t=String(((V=r==null?void 0:r.subscription)==null?void 0:V.plan)||"").toUpperCase()==="ENTERPRISE",E=String((r==null?void 0:r.role)||"").toUpperCase()==="ENTERPRISE_ADMIN",K=String((r==null?void 0:r.kycStatus)||"").toUpperCase()!=="COMPLETED",se=K&&!L,ie=Ce.useMemo(()=>{const x=c.pathname.startsWith("/accounting"),R=c.pathname.startsWith("/admin");if(x)return[...Ne];if(R)return[...we];const o=[...De];return String((r==null?void 0:r.role)||"").toUpperCase()==="SUPERADMIN"?o.filter(Y=>Y.path!=="/dashboard/billing"):o},[c.pathname,r==null?void 0:r.role]),H=()=>{var x,R;return e.jsxs(i,{sx:{width:y,height:"100%",backgroundColor:"background.paper"},children:[e.jsxs(i,{component:m,to:"/","aria-label":"Go to Landing Page",sx:{p:3,display:"block",textDecoration:"none",color:"inherit",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",cursor:"pointer","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.04)"}},children:[e.jsx(k,{variant:"h6",sx:{fontWeight:600,background:"linear-gradient(135deg, #ffffff 0%, #00d4ff 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"BackboneLogic, Inc."}),e.jsx(k,{variant:"body2",color:"text.secondary",children:"License Management"})]}),e.jsx(i,{sx:{p:3,borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(je,{sx:{width:48,height:48,bgcolor:"primary.main"},children:((x=r==null?void 0:r.name)==null?void 0:x[0])||((R=r==null?void 0:r.email)==null?void 0:R[0])||"U"}),e.jsxs(i,{sx:{flex:1,minWidth:0},children:[e.jsx(k,{variant:"subtitle1",sx:{fontWeight:600},noWrap:!0,children:(r==null?void 0:r.name)||(r==null?void 0:r.email)||"User"}),e.jsx(k,{variant:"body2",color:"text.secondary",noWrap:!0,children:r==null?void 0:r.email}),(r==null?void 0:r.subscription)&&e.jsx(_,{label:String(r.subscription.plan).toUpperCase(),size:"small",color:String(r.subscription.plan).toUpperCase()==="ENTERPRISE"?"primary":"default",sx:{mt:.5,fontSize:"0.7rem"}})]})]})}),e.jsxs(fe,{sx:{px:2,py:1},children:[ie.map(o=>{const[u,B]=String(o.path||"").split("#"),z=!!B?c.pathname===u&&c.hash===`#${B}`:c.pathname===o.path;return e.jsx(i,{children:e.jsx(A,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(I,{component:m,to:o.path,sx:{borderRadius:2,py:1.5,backgroundColor:z?"rgba(0, 212, 255, 0.1)":"transparent",color:z?"primary.main":"text.primary","&:hover":{backgroundColor:z?"rgba(0, 212, 255, 0.15)":"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(b,{sx:{color:"inherit",minWidth:40},children:o.badge?e.jsx(O,{badgeContent:o.badge,color:"primary",children:o.icon}):o.icon}),e.jsx(D,{primary:o.text,sx:{"& .MuiListItemText-primary":{fontWeight:z?600:400,fontSize:"0.95rem"}}}),o.chip&&e.jsx(_,{label:o.chip,size:"small",sx:{fontSize:"0.7rem",height:20,backgroundColor:"rgba(0, 212, 255, 0.2)",color:"primary.main"}})]})})},o.text)}),t&&E&&e.jsxs(e.Fragment,{children:[e.jsx(q,{sx:{my:2,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsx(k,{variant:"caption",sx:{px:2,py:1,display:"block",fontWeight:600,color:"text.secondary",textTransform:"uppercase",letterSpacing:1},children:"Enterprise"}),Me.map(o=>{const u=c.pathname===o.path;return e.jsx(i,{children:e.jsx(A,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(I,{component:m,to:o.path,sx:{borderRadius:2,py:1.5,backgroundColor:u?"rgba(0, 212, 255, 0.1)":"transparent",color:u?"primary.main":"text.primary","&:hover":{backgroundColor:u?"rgba(0, 212, 255, 0.15)":"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(b,{sx:{color:"inherit",minWidth:40},children:o.icon}),e.jsx(D,{primary:o.text,sx:{"& .MuiListItemText-primary":{fontWeight:u?600:400,fontSize:"0.95rem"}}})]})})},o.text)})]})]}),e.jsxs(i,{sx:{mt:"auto",p:2},children:[e.jsx(q,{sx:{mb:2,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsx(k,{variant:"caption",sx:{px:2,py:1,display:"block",fontWeight:600,color:"text.secondary",textTransform:"uppercase",letterSpacing:1},children:"Quick Access"}),e.jsx(A,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(I,{component:m,to:"/dashboard/support#analytics",sx:{borderRadius:2,py:1,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(b,{sx:{color:"text.secondary",minWidth:40},children:e.jsx(G,{})}),e.jsx(D,{primary:"Usage Analytics",sx:{"& .MuiListItemText-primary":{fontSize:"0.85rem",color:"text.secondary"}}})]})}),e.jsx(A,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(I,{component:m,to:"/dashboard/support#downloads",sx:{borderRadius:2,py:1,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(b,{sx:{color:"text.secondary",minWidth:40},children:e.jsx(Se,{})}),e.jsx(D,{primary:"Downloads",sx:{"& .MuiListItemText-primary":{fontSize:"0.85rem",color:"text.secondary"}}}),e.jsx(_,{label:"SDK",size:"small",sx:{fontSize:"0.6rem",height:16,backgroundColor:"rgba(0, 212, 255, 0.2)",color:"primary.main"}})]})}),e.jsx(A,{disablePadding:!0,children:e.jsxs(I,{component:m,to:"/dashboard/support#documentation",sx:{borderRadius:2,py:1,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(b,{sx:{color:"text.secondary",minWidth:40},children:e.jsx(ee,{})}),e.jsx(D,{primary:"Documentation",sx:{"& .MuiListItemText-primary":{fontSize:"0.85rem",color:"text.secondary"}}})]})})]})]})};return e.jsxs(i,{sx:{display:"flex",minHeight:"100vh"},children:[e.jsx(de,{position:"fixed",sx:{width:{lg:`calc(100% - ${y}px)`},ml:{lg:`${y}px`},backgroundColor:"background.paper",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"none"},children:e.jsxs($,{children:[e.jsx(M,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:d,sx:{mr:2,display:{lg:"none"}},children:e.jsx(pe,{})}),h?e.jsx(M,{color:"inherit","aria-label":"Back",onClick:()=>{typeof window<"u"&&window.history.length>1?l(-1):l("/")},sx:{mr:1},children:e.jsx(F,{})}):e.jsx(P,{variant:"outlined",size:"small",startIcon:e.jsx(F,{}),onClick:()=>{typeof window<"u"&&window.history.length>1?l(-1):l("/")},sx:{mr:1,borderColor:"rgba(255, 255, 255, 0.2)",color:"text.primary",textTransform:"none","&:hover":{borderColor:"primary.main",backgroundColor:"rgba(0, 212, 255, 0.1)"}},children:"Back"}),e.jsx(i,{sx:{flexGrow:1}}),e.jsx(Ie,{}),e.jsx(M,{size:"large",color:"inherit",sx:{mr:1},children:e.jsx(O,{badgeContent:K?1:0,color:"primary",children:e.jsx(xe,{})})}),e.jsx(M,{size:"large",edge:"end","aria-label":"account of current user","aria-controls":"profile-menu","aria-haspopup":"true",onClick:g,color:"inherit",children:e.jsx(he,{})}),e.jsxs(ge,{id:"profile-menu",anchorEl:f,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:!!f,onClose:n,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)",mt:1}},children:[e.jsxs(Q,{component:m,to:"/dashboard/settings",onClick:n,children:[e.jsx(b,{children:e.jsx(X,{fontSize:"small"})}),"Settings"]}),e.jsxs(Q,{onClick:S,children:[e.jsx(b,{children:e.jsx(ue,{fontSize:"small"})}),"Logout"]})]})]})}),e.jsxs(i,{component:"nav",sx:{width:{lg:y},flexShrink:{lg:0}},children:[e.jsx(J,{variant:"temporary",open:s,onClose:d,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",lg:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:y,backgroundColor:"background.paper",border:"none",borderRight:"1px solid rgba(255, 255, 255, 0.1)"}},children:e.jsx(H,{})}),e.jsx(J,{variant:"permanent",sx:{display:{xs:"none",lg:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:y,backgroundColor:"background.paper",border:"none",borderRight:"1px solid rgba(255, 255, 255, 0.1)"}},open:!0,children:e.jsx(H,{})})]}),e.jsxs(i,{component:"main",sx:{flexGrow:1,width:{lg:`calc(100% - ${y}px)`},backgroundColor:"background.default",minHeight:"100vh"},children:[e.jsx($,{}),e.jsxs(i,{sx:{p:3},children:[se&&e.jsx(be,{severity:"warning",sx:{mb:2},action:e.jsxs(i,{sx:{display:"flex",gap:1},children:[e.jsx(P,{size:"small",variant:"contained",onClick:()=>l("/dashboard/settings#compliance"),sx:{color:"#000"},children:"Complete KYC"}),e.jsx(P,{size:"small",onClick:()=>{try{localStorage.setItem("dismiss_kyc_banner","1")}catch{}C(!0)},children:"Dismiss"})]}),children:"Your account requires identity verification (KYC). Complete it in Settings to unlock all features."}),e.jsx(Ae,{})]})]})]})};export{Te as DashboardLayout,Te as default};
