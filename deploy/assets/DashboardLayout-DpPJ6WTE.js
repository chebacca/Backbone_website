import{j as e,bB as ne,bC as $,g as v,bD as se,T as C,B as s,aB as he,a as S,r as B,bE as Y,H as I,aQ as Q,a0 as pe,aW as P,bF as F,ar as ae,M as N,bG as ge,bH as ue,A as re,aA as me,y,bI as be,bJ as te,d as je,a4 as J,ac as q,bK as ye,aI as ie,X as ce,a2 as le,J as fe,ae as ke,w as Ce,x as E,bL as z,z as L,D as oe,as as Se,Y as ve}from"./mui-BiHqxpLd.js";import{u as de,r as d,e as Ie,b as Ae,L as f,O as De}from"./vendor-CjD1bmmO.js";import{u as xe}from"./index-nDXpZG0O.js";import"./stripe-DpmuhD-h.js";const we=({onMenuClick:U})=>{const b=de(),{user:j,logout:O}=xe(),[A,D]=d.useState(null),[n,t]=d.useState("USER"),[w,h]=d.useState(),[W,R]=d.useState(0),[u,M]=d.useState(0);d.useEffect(()=>{(async()=>{var l,p,m,a;if(j)try{const r=(await j.getIdTokenResult()).claims,o=(r==null?void 0:r.role)==="DEV_ADMIN"||(r==null?void 0:r.role)==="SuperAdmin"||(r==null?void 0:r.isDevAdmin)===!0||((l=r==null?void 0:r.permissions)==null?void 0:l.includes("security:master_access"))||((p=r==null?void 0:r.permissions)==null?void 0:p.includes("admin:master_security")),g=(r==null?void 0:r.role)==="ADMIN"||(r==null?void 0:r.role)==="ORG_ADMIN"||(r==null?void 0:r.isOrgAdmin)===!0||((m=r==null?void 0:r.permissions)==null?void 0:m.includes("admin:organization"))||((a=r==null?void 0:r.permissions)==null?void 0:a.includes("admin:team_members"));o?t("DEV_ADMIN"):g?(t("ORG_ADMIN"),h((r==null?void 0:r.organizationId)||j.organizationId)):t("USER")}catch(i){console.error("Error checking user permissions:",i),t("USER")}})()},[j]),d.useEffect(()=>{const x=async()=>{try{if(n==="DEV_ADMIN"){const[l,p]=await Promise.all([fetch("/api/security/alerts?source=dashboard_app").then(r=>r.json()).catch(()=>[]),fetch("/api/security/alerts?source=licensing_website").then(r=>r.json()).catch(()=>[])]),a=[...l,...p].filter(r=>!r.resolved),i=a.filter(r=>r.severity==="critical");R(a.length),M(i.length)}else if(n==="ORG_ADMIN"&&w){const p=(await fetch(`/api/security/alerts?source=licensing_website&organizationId=${w}`).then(a=>a.json()).catch(()=>[])).filter(a=>!a.resolved),m=p.filter(a=>a.severity==="critical");R(p.length),M(m.length)}}catch(l){console.error("Error loading security alerts:",l)}};if(n==="DEV_ADMIN"||n==="ORG_ADMIN"){x();const l=setInterval(x,3e4);return()=>clearInterval(l)}},[n,w]);const _=x=>{D(x.currentTarget)},c=()=>{D(null)},G=async()=>{try{await O(),b("/login")}catch(x){console.error("Logout error:",x)}c()},K=()=>{b("/security-dashboard"),c()},X=()=>{b("/dashboard"),c()},H=()=>{b("/users"),c()},Z=()=>{b("/settings"),c()};return e.jsx(ne,{position:"static",elevation:0,sx:{backgroundColor:"primary.main"},children:e.jsxs($,{children:[e.jsx(v,{edge:"start",color:"inherit","aria-label":"menu",onClick:U,sx:{mr:2},children:e.jsx(se,{})}),e.jsx(C,{variant:"h6",component:"div",sx:{flexGrow:1},children:"Backbone Logic - Licensing Platform"}),e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[(n==="DEV_ADMIN"||n==="ORG_ADMIN")&&e.jsx(he,{title:n==="DEV_ADMIN"?"Master Security Dashboard":"Organization Security Dashboard",children:e.jsxs(S,{color:"inherit",startIcon:e.jsx(Y,{badgeContent:W,color:"error",children:e.jsx(I,{})}),onClick:K,sx:{mr:1,backgroundColor:u>0?"error.dark":"transparent","&:hover":{backgroundColor:u>0?"error.main":"rgba(255,255,255,0.1)"}},children:["Security",u>0&&e.jsx(B,{label:`${u} Critical`,color:"error",size:"small",sx:{ml:1,height:20}})]})}),e.jsx(S,{color:"inherit",startIcon:e.jsx(Q,{}),onClick:X,children:"Dashboard"}),e.jsx(S,{color:"inherit",startIcon:e.jsx(pe,{}),onClick:H,children:"Users"}),e.jsx(S,{color:"inherit",startIcon:e.jsx(P,{}),onClick:Z,children:"Settings"}),e.jsx(v,{color:"inherit",onClick:_,sx:{ml:1},children:e.jsx(F,{})}),e.jsxs(ae,{anchorEl:A,open:!!A,onClose:c,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsxs(N,{onClick:c,children:[e.jsx(F,{sx:{mr:1}}),"Profile"]}),e.jsxs(N,{onClick:G,children:[e.jsx(P,{sx:{mr:1}}),"Logout"]})]})]})]})})},k=280,Me=[{text:"Overview",icon:e.jsx(Q,{}),path:"/dashboard"},{text:"Licenses",icon:e.jsx(le,{}),path:"/dashboard/licenses"},{text:"Cloud Projects",icon:e.jsx(q,{}),path:"/dashboard/cloud-projects"},{text:"Team Management",icon:e.jsx(ce,{}),path:"/dashboard/team"},{text:"Billing & Payments",icon:e.jsx(J,{}),path:"/dashboard/billing"},{text:"Support",icon:e.jsx(fe,{}),path:"/dashboard/support"},{text:"Settings",icon:e.jsx(P,{}),path:"/dashboard/settings"}],Ee=[{text:"Organization",icon:e.jsx(ve,{}),path:"/dashboard/organization"},{text:"Security Center",icon:e.jsx(I,{}),path:"/security-dashboard"},{text:"Compliance",icon:e.jsx(I,{}),path:"/dashboard/compliance"}],ze=[{text:"Overview",icon:e.jsx(Q,{}),path:"/accounting#overview"},{text:"Payments",icon:e.jsx(J,{}),path:"/accounting#payments"},{text:"Tax",icon:e.jsx(q,{}),path:"/accounting#tax"},{text:"Filings",icon:e.jsx(ye,{}),path:"/accounting#filings"},{text:"KYC",icon:e.jsx(I,{}),path:"/accounting#kyc"},{text:"Compliance",icon:e.jsx(I,{}),path:"/accounting#compliance"},{text:"Terms",icon:e.jsx(ie,{}),path:"/accounting#terms"}],Le=[{text:"Users",icon:e.jsx(ce,{}),path:"/admin#users"},{text:"Licenses",icon:e.jsx(le,{}),path:"/admin#licenses"},{text:"Invoices",icon:e.jsx(J,{}),path:"/admin#invoices"},{text:"System Health",icon:e.jsx(I,{}),path:"/admin#system"}],Ne=()=>{var a;const U=ge(),b=ue(U.breakpoints.down("lg")),[j,O]=d.useState(!1),[A,D]=d.useState(null),n=Ie(),{user:t,logout:w}=xe(),h=de(),[W,R]=d.useState(()=>{try{return localStorage.getItem("dismiss_kyc_banner")==="1"}catch{return!1}}),u=String((t==null?void 0:t.role)||"").toUpperCase()==="ACCOUNTING";if(d.useEffect(()=>{u&&n.pathname.startsWith("/dashboard")&&h("/accounting",{replace:!0})},[u,n.pathname,h]),u&&!n.pathname.startsWith("/accounting"))return null;const M=()=>{O(!j)},_=i=>{D(i.currentTarget)},c=()=>{D(null)},G=async()=>{try{await w(),c()}catch(i){console.error("Logout failed:",i),c()}},K=String(((a=t==null?void 0:t.subscription)==null?void 0:a.plan)||"").toUpperCase()==="ENTERPRISE",H=String((t==null?void 0:t.role)||"").toUpperCase()==="ENTERPRISE_ADMIN",x=String((t==null?void 0:t.kycStatus)||"").toUpperCase()!=="COMPLETED",l=x&&!W,p=Ae.useMemo(()=>{const i=n.pathname.startsWith("/accounting"),r=n.pathname.startsWith("/admin");if(i)return[...ze];if(r)return[...Le];const o=[...Me];return String((t==null?void 0:t.role)||"").toUpperCase()==="SUPERADMIN"?o.filter(ee=>ee.path!=="/dashboard/billing"):o},[n.pathname,t==null?void 0:t.role]),m=()=>{var i,r;return e.jsxs(s,{sx:{width:k,height:"100%",backgroundColor:"background.paper"},children:[e.jsxs(s,{component:f,to:"/","aria-label":"Go to Landing Page",sx:{p:3,display:"block",textDecoration:"none",color:"inherit",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",cursor:"pointer","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.04)"}},children:[e.jsx(C,{variant:"h6",sx:{fontWeight:600,background:"linear-gradient(135deg, #ffffff 0%, #00d4ff 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"BackboneLogic, Inc."}),e.jsx(C,{variant:"body2",color:"text.secondary",children:"License Management"})]}),e.jsx(s,{sx:{p:3,borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ke,{sx:{width:48,height:48,bgcolor:"primary.main"},children:((i=t==null?void 0:t.name)==null?void 0:i[0])||((r=t==null?void 0:t.email)==null?void 0:r[0])||"U"}),e.jsxs(s,{sx:{flex:1,minWidth:0},children:[e.jsx(C,{variant:"subtitle1",sx:{fontWeight:600},noWrap:!0,children:(t==null?void 0:t.name)||(t==null?void 0:t.email)||"User"}),e.jsx(C,{variant:"body2",color:"text.secondary",noWrap:!0,children:t==null?void 0:t.email}),(t==null?void 0:t.subscription)&&e.jsx(B,{label:String(t.subscription.plan).toUpperCase(),size:"small",color:String(t.subscription.plan).toUpperCase()==="ENTERPRISE"?"primary":"default",sx:{mt:.5,fontSize:"0.7rem"}})]})]})}),e.jsxs(Ce,{sx:{px:2,py:1},children:[p.map(o=>{const[g,V]=String(o.path||"").split("#"),T=!!V?n.pathname===g&&n.hash===`#${V}`:n.pathname===o.path;return e.jsx(s,{children:e.jsx(E,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(z,{component:f,to:o.path,sx:{borderRadius:2,py:1.5,backgroundColor:T?"rgba(0, 212, 255, 0.1)":"transparent",color:T?"primary.main":"text.primary","&:hover":{backgroundColor:T?"rgba(0, 212, 255, 0.15)":"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(y,{sx:{color:"inherit",minWidth:40},children:o.badge?e.jsx(Y,{badgeContent:o.badge,color:"primary",children:o.icon}):o.icon}),e.jsx(L,{primary:o.text,sx:{"& .MuiListItemText-primary":{fontWeight:T?600:400,fontSize:"0.95rem"}}}),o.chip&&e.jsx(B,{label:o.chip,size:"small",sx:{fontSize:"0.7rem",height:20,backgroundColor:"rgba(0, 212, 255, 0.2)",color:"primary.main"}})]})})},o.text)}),K&&H&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{sx:{my:2,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsx(C,{variant:"caption",sx:{px:2,py:1,display:"block",fontWeight:600,color:"text.secondary",textTransform:"uppercase",letterSpacing:1},children:"Enterprise"}),Ee.map(o=>{const g=n.pathname===o.path;return e.jsx(s,{children:e.jsx(E,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(z,{component:f,to:o.path,sx:{borderRadius:2,py:1.5,backgroundColor:g?"rgba(0, 212, 255, 0.1)":"transparent",color:g?"primary.main":"text.primary","&:hover":{backgroundColor:g?"rgba(0, 212, 255, 0.15)":"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(y,{sx:{color:"inherit",minWidth:40},children:o.icon}),e.jsx(L,{primary:o.text,sx:{"& .MuiListItemText-primary":{fontWeight:g?600:400,fontSize:"0.95rem"}}})]})})},o.text)})]})]}),e.jsxs(s,{sx:{mt:"auto",p:2},children:[e.jsx(oe,{sx:{mb:2,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsx(C,{variant:"caption",sx:{px:2,py:1,display:"block",fontWeight:600,color:"text.secondary",textTransform:"uppercase",letterSpacing:1},children:"Quick Access"}),e.jsx(E,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(z,{component:f,to:"/dashboard/support#analytics",sx:{borderRadius:2,py:1,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(y,{sx:{color:"text.secondary",minWidth:40},children:e.jsx(q,{})}),e.jsx(L,{primary:"Usage Analytics",sx:{"& .MuiListItemText-primary":{fontSize:"0.85rem",color:"text.secondary"}}})]})}),e.jsx(E,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(z,{component:f,to:"/dashboard/support#downloads",sx:{borderRadius:2,py:1,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(y,{sx:{color:"text.secondary",minWidth:40},children:e.jsx(Se,{})}),e.jsx(L,{primary:"Downloads",sx:{"& .MuiListItemText-primary":{fontSize:"0.85rem",color:"text.secondary"}}}),e.jsx(B,{label:"SDK",size:"small",sx:{fontSize:"0.6rem",height:16,backgroundColor:"rgba(0, 212, 255, 0.2)",color:"primary.main"}})]})}),e.jsx(E,{disablePadding:!0,children:e.jsxs(z,{component:f,to:"/dashboard/support#documentation",sx:{borderRadius:2,py:1,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(y,{sx:{color:"text.secondary",minWidth:40},children:e.jsx(ie,{})}),e.jsx(L,{primary:"Documentation",sx:{"& .MuiListItemText-primary":{fontSize:"0.85rem",color:"text.secondary"}}})]})})]})]})};return e.jsxs(s,{sx:{display:"flex",minHeight:"100vh"},children:[e.jsx(ne,{position:"fixed",sx:{width:{lg:`calc(100% - ${k}px)`},ml:{lg:`${k}px`},backgroundColor:"background.paper",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"none"},children:e.jsxs($,{children:[e.jsx(v,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:M,sx:{mr:2,display:{lg:"none"}},children:e.jsx(se,{})}),b?e.jsx(v,{color:"inherit","aria-label":"Back",onClick:()=>{typeof window<"u"&&window.history.length>1?h(-1):h("/")},sx:{mr:1},children:e.jsx(re,{})}):e.jsx(S,{variant:"outlined",size:"small",startIcon:e.jsx(re,{}),onClick:()=>{typeof window<"u"&&window.history.length>1?h(-1):h("/")},sx:{mr:1,borderColor:"rgba(255, 255, 255, 0.2)",color:"text.primary",textTransform:"none","&:hover":{borderColor:"primary.main",backgroundColor:"rgba(0, 212, 255, 0.1)"}},children:"Back"}),e.jsx(s,{sx:{flexGrow:1}}),e.jsx(we,{}),e.jsx(v,{size:"large",color:"inherit",sx:{mr:1},children:e.jsx(Y,{badgeContent:x?1:0,color:"primary",children:e.jsx(me,{})})}),e.jsx(v,{size:"large",edge:"end","aria-label":"account of current user","aria-controls":"profile-menu","aria-haspopup":"true",onClick:_,color:"inherit",children:e.jsx(F,{})}),e.jsxs(ae,{id:"profile-menu",anchorEl:A,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:!!A,onClose:c,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)",mt:1}},children:[e.jsxs(N,{component:f,to:"/dashboard/settings",onClick:c,children:[e.jsx(y,{children:e.jsx(P,{fontSize:"small"})}),"Settings"]}),e.jsxs(N,{onClick:G,children:[e.jsx(y,{children:e.jsx(be,{fontSize:"small"})}),"Logout"]})]})]})}),e.jsxs(s,{component:"nav",sx:{width:{lg:k},flexShrink:{lg:0}},children:[e.jsx(te,{variant:"temporary",open:j,onClose:M,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",lg:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:k,backgroundColor:"background.paper",border:"none",borderRight:"1px solid rgba(255, 255, 255, 0.1)"}},children:e.jsx(m,{})}),e.jsx(te,{variant:"permanent",sx:{display:{xs:"none",lg:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:k,backgroundColor:"background.paper",border:"none",borderRight:"1px solid rgba(255, 255, 255, 0.1)"}},open:!0,children:e.jsx(m,{})})]}),e.jsxs(s,{component:"main",sx:{flexGrow:1,width:{lg:`calc(100% - ${k}px)`},backgroundColor:"background.default",minHeight:"100vh"},children:[e.jsx($,{}),e.jsxs(s,{sx:{p:3},children:[l&&e.jsx(je,{severity:"warning",sx:{mb:2},action:e.jsxs(s,{sx:{display:"flex",gap:1},children:[e.jsx(S,{size:"small",variant:"contained",onClick:()=>h("/dashboard/settings#compliance"),sx:{color:"#000"},children:"Complete KYC"}),e.jsx(S,{size:"small",onClick:()=>{try{localStorage.setItem("dismiss_kyc_banner","1")}catch{}R(!0)},children:"Dismiss"})]}),children:"Your account requires identity verification (KYC). Complete it in Settings to unlock all features."}),e.jsx(De,{})]})]})]})};export{Ne as DashboardLayout,Ne as default};
