import{j as e,aB as ce,g as w,bB as K,H as D,bC as le,bD as de,B as a,bE as pe,bF as J,bG as ge,A as q,a as G,aA as xe,bH as he,ar as ue,M as X,y as S,aW as te,bI as me,bJ as Z,d as be,aQ as oe,a4 as H,ac as F,bK as ye,aI as re,X as ne,a2 as se,J as je,T as I,ae as Se,r as V,w as fe,x as M,bL as R,z as E,D as ee,as as ve,Y as ke}from"./mui-CCWxH8Vb.js";import{u as ie,r as h,e as Ae,b as Ie,L as f,O as De}from"./vendor-CjD1bmmO.js";import{u as ae}from"./index-DUsOwf0X.js";import"./stripe-vGaGA8Al.js";const Ce=()=>{const L=ie(),{user:r}=ae(),[i,u]=h.useState("USER"),[k,C]=h.useState(),[l,o]=h.useState(0),[U,g]=h.useState(0);h.useEffect(()=>{(async()=>{var c,x,b,s,A,d,B,_;if(r)try{if(console.log("SecurityNavigation - User object:",r),console.log("SecurityNavigation - User email:",r.email),console.log("SecurityNavigation - User type:",typeof r),console.log("SecurityNavigation - User has getIdTokenResult:",typeof r.getIdTokenResult),typeof r.getIdTokenResult=="function"){const t=(await r.getIdTokenResult()).claims;console.log("SecurityNavigation - User claims:",t);const y=(t==null?void 0:t.role)==="DEV_ADMIN"||(t==null?void 0:t.role)==="SuperAdmin"||(t==null?void 0:t.role)==="SUPERADMIN"||(t==null?void 0:t.isDevAdmin)===!0||((c=t==null?void 0:t.permissions)==null?void 0:c.includes("security:master_access"))||((x=t==null?void 0:t.permissions)==null?void 0:x.includes("admin:master_security")),z=(t==null?void 0:t.role)==="ADMIN"||(t==null?void 0:t.role)==="ORG_ADMIN"||(t==null?void 0:t.role)==="SuperAdmin"||(t==null?void 0:t.role)==="SUPERADMIN"||(t==null?void 0:t.isOrgAdmin)===!0||((b=t==null?void 0:t.permissions)==null?void 0:b.includes("admin:organization"))||((s=t==null?void 0:t.permissions)==null?void 0:s.includes("admin:team_members"));console.log("SecurityNavigation - isDevAdmin:",y),console.log("SecurityNavigation - isOrgAdmin:",z),y?(console.log("SecurityNavigation - Setting role to DEV_ADMIN"),u("DEV_ADMIN")):z?(console.log("SecurityNavigation - Setting role to ORG_ADMIN"),u("ORG_ADMIN"),C((t==null?void 0:t.organizationId)||r.organizationId)):(console.log("SecurityNavigation - Setting role to USER"),u("USER"))}else{console.log("SecurityNavigation - Using fallback role detection"),console.log("SecurityNavigation - User properties:",Object.keys(r));const p=r.role||r.userRole||r.user_type,t=p==="DEV_ADMIN"||p==="SuperAdmin"||p==="SUPERADMIN"||r.isDevAdmin===!0||((A=r.permissions)==null?void 0:A.includes("security:master_access"))||((d=r.permissions)==null?void 0:d.includes("admin:master_security")),y=p==="ADMIN"||p==="ORG_ADMIN"||p==="SuperAdmin"||p==="SUPERADMIN"||r.isOrgAdmin===!0||((B=r.permissions)==null?void 0:B.includes("admin:organization"))||((_=r.permissions)==null?void 0:_.includes("admin:team_members"));console.log("SecurityNavigation - Fallback isDevAdmin:",t),console.log("SecurityNavigation - Fallback isOrgAdmin:",y),t?(console.log("SecurityNavigation - Setting role to DEV_ADMIN (fallback)"),u("DEV_ADMIN")):y?(console.log("SecurityNavigation - Setting role to ORG_ADMIN (fallback)"),u("ORG_ADMIN"),C(r.organizationId)):(console.log("SecurityNavigation - Setting role to USER (fallback)"),u("USER"))}}catch(p){console.error("Error checking user permissions:",p),u("USER")}})()},[r]),h.useEffect(()=>{const N=async()=>{try{if(i==="DEV_ADMIN"){const[c,x]=await Promise.all([fetch("/api/security/alerts?source=dashboard_app").then(d=>d.json()).catch(()=>[]),fetch("/api/security/alerts?source=licensing_website").then(d=>d.json()).catch(()=>[])]),s=[...c,...x].filter(d=>!d.resolved),A=s.filter(d=>d.severity==="critical");o(s.length),g(A.length)}else if(i==="ORG_ADMIN"&&k){const x=(await fetch(`/api/security/alerts?source=licensing_website&organizationId=${k}`).then(s=>s.json()).catch(()=>[])).filter(s=>!s.resolved),b=x.filter(s=>s.severity==="critical");o(x.length),g(b.length)}}catch(c){console.error("Error loading security alerts:",c)}};if(i==="DEV_ADMIN"||i==="ORG_ADMIN"){N();const c=setInterval(N,3e4);return()=>clearInterval(c)}},[i,k]);const P=()=>{L("/security-dashboard")};return console.log("SecurityNavigation - Current userRole:",i),console.log("SecurityNavigation - Should render:",i==="DEV_ADMIN"||i==="ORG_ADMIN"),i!=="DEV_ADMIN"&&i!=="ORG_ADMIN"?(console.log("SecurityNavigation - Not rendering, userRole:",i),null):(console.log("SecurityNavigation - Rendering security button"),e.jsx(ce,{title:i==="DEV_ADMIN"?"Master Security Dashboard":"Organization Security Dashboard",children:e.jsx(w,{color:"inherit",onClick:P,sx:{mr:1,backgroundColor:U>0?"error.dark":"transparent","&:hover":{backgroundColor:U>0?"error.main":"rgba(255,255,255,0.1)"}},children:e.jsx(K,{badgeContent:l,color:"error",children:e.jsx(D,{})})})}))},v=280,Ne=[{text:"Overview",icon:e.jsx(oe,{}),path:"/dashboard"},{text:"Licenses",icon:e.jsx(se,{}),path:"/dashboard/licenses"},{text:"Cloud Projects",icon:e.jsx(F,{}),path:"/dashboard/cloud-projects"},{text:"Team Management",icon:e.jsx(ne,{}),path:"/dashboard/team"},{text:"Billing & Payments",icon:e.jsx(H,{}),path:"/dashboard/billing"},{text:"Support",icon:e.jsx(je,{}),path:"/dashboard/support"},{text:"Settings",icon:e.jsx(te,{}),path:"/dashboard/settings"}],Me=[{text:"Organization",icon:e.jsx(ke,{}),path:"/dashboard/organization"},{text:"Security Center",icon:e.jsx(D,{}),path:"/security-dashboard"},{text:"Compliance",icon:e.jsx(D,{}),path:"/dashboard/compliance"}],Re=[{text:"Overview",icon:e.jsx(oe,{}),path:"/accounting#overview"},{text:"Payments",icon:e.jsx(H,{}),path:"/accounting#payments"},{text:"Tax",icon:e.jsx(F,{}),path:"/accounting#tax"},{text:"Filings",icon:e.jsx(ye,{}),path:"/accounting#filings"},{text:"KYC",icon:e.jsx(D,{}),path:"/accounting#kyc"},{text:"Compliance",icon:e.jsx(D,{}),path:"/accounting#compliance"},{text:"Terms",icon:e.jsx(re,{}),path:"/accounting#terms"}],Ee=[{text:"Users",icon:e.jsx(ne,{}),path:"/admin#users"},{text:"Licenses",icon:e.jsx(se,{}),path:"/admin#licenses"},{text:"Invoices",icon:e.jsx(H,{}),path:"/admin#invoices"},{text:"System Health",icon:e.jsx(D,{}),path:"/admin#system"}],Oe=()=>{var $;const L=le(),r=de(L.breakpoints.down("lg")),[i,u]=h.useState(!1),[k,C]=h.useState(null),l=Ae(),{user:o,logout:U}=ae(),g=ie(),[P,N]=h.useState(()=>{try{return localStorage.getItem("dismiss_kyc_banner")==="1"}catch{return!1}}),c=String((o==null?void 0:o.role)||"").toUpperCase()==="ACCOUNTING";if(h.useEffect(()=>{c&&l.pathname.startsWith("/dashboard")&&g("/accounting",{replace:!0})},[c,l.pathname,g]),c&&!l.pathname.startsWith("/accounting"))return null;const x=()=>{u(!i)},b=m=>{C(m.currentTarget)},s=()=>{C(null)},A=async()=>{try{await U(),s()}catch(m){console.error("Logout failed:",m),s()}},d=String((($=o==null?void 0:o.subscription)==null?void 0:$.plan)||"").toUpperCase()==="ENTERPRISE",_=String((o==null?void 0:o.role)||"").toUpperCase()==="ENTERPRISE_ADMIN",t=String((o==null?void 0:o.kycStatus)||"").toUpperCase()!=="COMPLETED",y=t&&!P,z=Ie.useMemo(()=>{const m=l.pathname.startsWith("/accounting"),O=l.pathname.startsWith("/admin");if(m)return[...Re];if(O)return[...Ee];const n=[...Ne];return String((o==null?void 0:o.role)||"").toUpperCase()==="SUPERADMIN"?n.filter(Q=>Q.path!=="/dashboard/billing"):n},[l.pathname,o==null?void 0:o.role]),Y=()=>{var m,O;return e.jsxs(a,{sx:{width:v,height:"100%",backgroundColor:"background.paper"},children:[e.jsxs(a,{component:f,to:"/","aria-label":"Go to Landing Page",sx:{p:3,display:"block",textDecoration:"none",color:"inherit",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",cursor:"pointer","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.04)"}},children:[e.jsx(I,{variant:"h6",sx:{fontWeight:600,background:"linear-gradient(135deg, #ffffff 0%, #00d4ff 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"BackboneLogic, Inc."}),e.jsx(I,{variant:"body2",color:"text.secondary",children:"License Management"})]}),e.jsx(a,{sx:{p:3,borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(a,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Se,{sx:{width:48,height:48,bgcolor:"primary.main"},children:((m=o==null?void 0:o.name)==null?void 0:m[0])||((O=o==null?void 0:o.email)==null?void 0:O[0])||"U"}),e.jsxs(a,{sx:{flex:1,minWidth:0},children:[e.jsx(I,{variant:"subtitle1",sx:{fontWeight:600},noWrap:!0,children:(o==null?void 0:o.name)||(o==null?void 0:o.email)||"User"}),e.jsx(I,{variant:"body2",color:"text.secondary",noWrap:!0,children:o==null?void 0:o.email}),(o==null?void 0:o.subscription)&&e.jsx(V,{label:String(o.subscription.plan).toUpperCase(),size:"small",color:String(o.subscription.plan).toUpperCase()==="ENTERPRISE"?"primary":"default",sx:{mt:.5,fontSize:"0.7rem"}})]})]})}),e.jsxs(fe,{sx:{px:2,py:1},children:[z.map(n=>{const[j,W]=String(n.path||"").split("#"),T=!!W?l.pathname===j&&l.hash===`#${W}`:l.pathname===n.path;return e.jsx(a,{children:e.jsx(M,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(R,{component:f,to:n.path,sx:{borderRadius:2,py:1.5,backgroundColor:T?"rgba(0, 212, 255, 0.1)":"transparent",color:T?"primary.main":"text.primary","&:hover":{backgroundColor:T?"rgba(0, 212, 255, 0.15)":"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(S,{sx:{color:"inherit",minWidth:40},children:n.badge?e.jsx(K,{badgeContent:n.badge,color:"primary",children:n.icon}):n.icon}),e.jsx(E,{primary:n.text,sx:{"& .MuiListItemText-primary":{fontWeight:T?600:400,fontSize:"0.95rem"}}}),n.chip&&e.jsx(V,{label:n.chip,size:"small",sx:{fontSize:"0.7rem",height:20,backgroundColor:"rgba(0, 212, 255, 0.2)",color:"primary.main"}})]})})},n.text)}),d&&_&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{sx:{my:2,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsx(I,{variant:"caption",sx:{px:2,py:1,display:"block",fontWeight:600,color:"text.secondary",textTransform:"uppercase",letterSpacing:1},children:"Enterprise"}),Me.map(n=>{const j=l.pathname===n.path;return e.jsx(a,{children:e.jsx(M,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(R,{component:f,to:n.path,sx:{borderRadius:2,py:1.5,backgroundColor:j?"rgba(0, 212, 255, 0.1)":"transparent",color:j?"primary.main":"text.primary","&:hover":{backgroundColor:j?"rgba(0, 212, 255, 0.15)":"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(S,{sx:{color:"inherit",minWidth:40},children:n.icon}),e.jsx(E,{primary:n.text,sx:{"& .MuiListItemText-primary":{fontWeight:j?600:400,fontSize:"0.95rem"}}})]})})},n.text)})]})]}),e.jsxs(a,{sx:{mt:"auto",p:2},children:[e.jsx(ee,{sx:{mb:2,borderColor:"rgba(255, 255, 255, 0.1)"}}),e.jsx(I,{variant:"caption",sx:{px:2,py:1,display:"block",fontWeight:600,color:"text.secondary",textTransform:"uppercase",letterSpacing:1},children:"Quick Access"}),e.jsx(M,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(R,{component:f,to:"/dashboard/support#analytics",sx:{borderRadius:2,py:1,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(S,{sx:{color:"text.secondary",minWidth:40},children:e.jsx(F,{})}),e.jsx(E,{primary:"Usage Analytics",sx:{"& .MuiListItemText-primary":{fontSize:"0.85rem",color:"text.secondary"}}})]})}),e.jsx(M,{disablePadding:!0,sx:{mb:.5},children:e.jsxs(R,{component:f,to:"/dashboard/support#downloads",sx:{borderRadius:2,py:1,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(S,{sx:{color:"text.secondary",minWidth:40},children:e.jsx(ve,{})}),e.jsx(E,{primary:"Downloads",sx:{"& .MuiListItemText-primary":{fontSize:"0.85rem",color:"text.secondary"}}}),e.jsx(V,{label:"SDK",size:"small",sx:{fontSize:"0.6rem",height:16,backgroundColor:"rgba(0, 212, 255, 0.2)",color:"primary.main"}})]})}),e.jsx(M,{disablePadding:!0,children:e.jsxs(R,{component:f,to:"/dashboard/support#documentation",sx:{borderRadius:2,py:1,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},children:[e.jsx(S,{sx:{color:"text.secondary",minWidth:40},children:e.jsx(re,{})}),e.jsx(E,{primary:"Documentation",sx:{"& .MuiListItemText-primary":{fontSize:"0.85rem",color:"text.secondary"}}})]})})]})]})};return e.jsxs(a,{sx:{display:"flex",minHeight:"100vh"},children:[e.jsx(pe,{position:"fixed",sx:{width:{lg:`calc(100% - ${v}px)`},ml:{lg:`${v}px`},backgroundColor:"background.paper",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",boxShadow:"none"},children:e.jsxs(J,{children:[e.jsx(w,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:x,sx:{mr:2,display:{lg:"none"}},children:e.jsx(ge,{})}),r?e.jsx(w,{color:"inherit","aria-label":"Back",onClick:()=>{typeof window<"u"&&window.history.length>1?g(-1):g("/")},sx:{mr:1},children:e.jsx(q,{})}):e.jsx(G,{variant:"outlined",size:"small",startIcon:e.jsx(q,{}),onClick:()=>{typeof window<"u"&&window.history.length>1?g(-1):g("/")},sx:{mr:1,borderColor:"rgba(255, 255, 255, 0.2)",color:"text.primary",textTransform:"none","&:hover":{borderColor:"primary.main",backgroundColor:"rgba(0, 212, 255, 0.1)"}},children:"Back"}),e.jsx(a,{sx:{flexGrow:1}}),e.jsx(Ce,{}),e.jsx(w,{size:"large",color:"inherit",sx:{mr:1},children:e.jsx(K,{badgeContent:t?1:0,color:"primary",children:e.jsx(xe,{})})}),e.jsx(w,{size:"large",edge:"end","aria-label":"account of current user","aria-controls":"profile-menu","aria-haspopup":"true",onClick:b,color:"inherit",children:e.jsx(he,{})}),e.jsxs(ue,{id:"profile-menu",anchorEl:k,anchorOrigin:{vertical:"bottom",horizontal:"right"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:!!k,onClose:s,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)",mt:1}},children:[e.jsxs(X,{component:f,to:"/dashboard/settings",onClick:s,children:[e.jsx(S,{children:e.jsx(te,{fontSize:"small"})}),"Settings"]}),e.jsxs(X,{onClick:A,children:[e.jsx(S,{children:e.jsx(me,{fontSize:"small"})}),"Logout"]})]})]})}),e.jsxs(a,{component:"nav",sx:{width:{lg:v},flexShrink:{lg:0}},children:[e.jsx(Z,{variant:"temporary",open:i,onClose:x,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",lg:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:v,backgroundColor:"background.paper",border:"none",borderRight:"1px solid rgba(255, 255, 255, 0.1)"}},children:e.jsx(Y,{})}),e.jsx(Z,{variant:"permanent",sx:{display:{xs:"none",lg:"block"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:v,backgroundColor:"background.paper",border:"none",borderRight:"1px solid rgba(255, 255, 255, 0.1)"}},open:!0,children:e.jsx(Y,{})})]}),e.jsxs(a,{component:"main",sx:{flexGrow:1,width:{lg:`calc(100% - ${v}px)`},backgroundColor:"background.default",minHeight:"100vh"},children:[e.jsx(J,{}),e.jsxs(a,{sx:{p:3},children:[y&&e.jsx(be,{severity:"warning",sx:{mb:2},action:e.jsxs(a,{sx:{display:"flex",gap:1},children:[e.jsx(G,{size:"small",variant:"contained",onClick:()=>g("/dashboard/settings#compliance"),sx:{color:"#000"},children:"Complete KYC"}),e.jsx(G,{size:"small",onClick:()=>{try{localStorage.setItem("dismiss_kyc_banner","1")}catch{}N(!0)},children:"Dismiss"})]}),children:"Your account requires identity verification (KYC). Complete it in Settings to unlock all features."}),e.jsx(De,{})]})]})]})};export{Oe as DashboardLayout,Oe as default};
