import{j as e,a as r,T as s,A as fe,aE as Ee,aF as we,G as a,aA as ce,aG as k,aH as M,aI as Pe,a7 as Se,z as re,J as ae,a1 as Ae,m as Ce,d as p,aB as Ie,K as De,q as Te,r as Le,s as Re,aC as ke,t as Me,p as Ne,c as Ue,w as ne,aJ as Oe,aK as We,aq as ze,O as Fe,ak as Ve}from"./mui-Ilj8o9AZ.js";import{u as Be,r as i,L as b,b as ie}from"./vendor-OeuszDaU.js";import{u as Ke,c as v,d as Ge,e as y}from"./index-tsOIn16f.js";import{M as f}from"./MetricCard-BdSYF6k0.js";import{S as He}from"./StorageWarningCard-Tb9wnWnw.js";import"./stripe-BKUR_tcx.js";var N=(t=>(t.BASIC="BASIC",t.PRO="PRO",t.ENTERPRISE="ENTERPRISE",t))(N||{}),le=(t=>(t.PENDING="PENDING",t.ACTIVE="ACTIVE",t.SUSPENDED="SUSPENDED",t.EXPIRED="EXPIRED",t.REVOKED="REVOKED",t))(le||{});const oe=[{type:"license",title:"License Activated",description:"Pro license activated for john.doe@company.com",timestamp:"2 hours ago",status:"success"},{type:"payment",title:"Payment Successful",description:"Monthly subscription renewed for $297.00",timestamp:"1 day ago",status:"success"},{type:"user",title:"Team Member Added",description:"Sarah Johnson added to development team",timestamp:"2 days ago",status:"success"},{type:"security",title:"Security Alert",description:"New device login detected from New York",timestamp:"3 days ago",status:"warning"}],$e=t=>{switch(t){case"license":return e.jsx(ce,{});case"payment":return e.jsx(Ve,{});case"user":return e.jsx(M,{});case"security":return e.jsx(Fe,{});default:return e.jsx(ze,{})}},Je=t=>{switch(t){case"success":return"success.main";case"warning":return"warning.main";case"error":return"error.main";default:return"text.secondary"}},ns=()=>{var B;const{user:t}=Ke(),u=Be(),[de,U]=i.useState(!0),[h,O]=i.useState(0),[g,W]=i.useState(0),[qe,E]=i.useState(0),[Qe,w]=i.useState(0),[P,z]=i.useState(""),[F,V]=i.useState(""),[Xe,S]=i.useState(!1),[xe,me]=i.useState(!1),[ue,he]=i.useState(null),[A,j]=i.useState(0),[ge,C]=i.useState(0),[je,I]=i.useState(0),[_e,Ye]=i.useState(!1);i.useEffect(()=>{let o=!0;return(async()=>{var K,G,H,$,J,q,Q,X,_,Y,Z;try{U(!0);const[L,pe,be,R,d]=await Promise.all([v.get(y.subscriptions.mySubscriptions()),v.get(y.licenses.analytics()),v.get(y.licenses.myLicenses()),Ge.getUserProjects(),v.get(y.organizations.context()).catch(()=>null)]);if(!o)return;const ee=((G=(K=be.data)==null?void 0:K.data)==null?void 0:G.licenses)??[],ve=ee.length,ye=ee.filter(n=>n.status===le.ACTIVE).length;W(ve),O(ye);const se=(($=(H=L.data)==null?void 0:H.data)==null?void 0:$.subscriptions)??[],l=se.find(n=>n.status==="ACTIVE")||se[0];if(l){if(z(((J=l.tier)==null?void 0:J.toLowerCase())??""),l.currentPeriodEnd){const n=new Date(l.currentPeriodEnd),c=Math.max(0,Math.ceil((n.getTime()-Date.now())/(1e3*60*60*24)));V(`${c} day${c===1?"":"s"}`)}S(l.tier===N.ENTERPRISE)}let x=0;if((Q=(q=d==null?void 0:d.data)==null?void 0:q.data)!=null&&Q.members)x=d.data.data.members.filter(c=>c&&c.status==="ACTIVE").length,console.log("[DashboardOverview] Found team members in org context:",x);else if((_=(X=d==null?void 0:d.data)==null?void 0:X.data)!=null&&_.organization){const n=d.data.data.organization;n.members&&Array.isArray(n.members)&&(x=n.members.filter(c=>c&&c.status==="ACTIVE").length,console.log("[DashboardOverview] Found team members in org object:",x))}else console.log("[DashboardOverview] No organization context available");x>0?(j(x),S(!0),console.log("[DashboardOverview] Setting team members count:",x)):l&&l.tier===N.ENTERPRISE?(j(l.seats||0),console.log("[DashboardOverview] Using subscription seats for Enterprise:",l.seats||0)):(j(0),console.log("[DashboardOverview] No team members found"));const m=(Y=pe.data)==null?void 0:Y.data;if(m)if(m.summary){E(m.summary.totalEvents??0);const n=((Z=m.summary.eventTypes)==null?void 0:Z.SDK_DOWNLOAD_REQUEST)||0;w(n)}else m.totalEvents!==void 0&&(E(m.totalEvents),w(m.downloads||0));try{if(R){const n=R.length,c=R.filter(te=>te.isActive&&!te.isArchived).length;C(n),I(c)}}catch(n){console.error("Error processing cloud projects data:",n),C(0),I(0)}me(!1),he(null)}catch(L){if(console.error("Error fetching dashboard data:",L),!o)return;O(0),W(0),E(0),w(0),z(""),V(""),S(!1),j(0),C(0),I(0)}finally{o&&U(!1)}})(),()=>{o=!1}},[]);const D=i.useMemo(()=>g<=0?0:Math.round(h/g*100),[h,g]);return de?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(s,{children:"Loading dashboard..."})}):e.jsxs(r,{children:[xe&&e.jsxs(fe,{severity:"info",sx:{mb:3},icon:e.jsx(we,{}),children:[e.jsx(Ee,{children:"Edge Mode Active"}),"Running in offline LAN mode via Edge Hub at ",ue||"local network",". Projects and data are stored locally and will sync when cloud connectivity returns."]}),e.jsx(r,{children:e.jsxs(r,{sx:{mb:4},children:[e.jsxs(s,{variant:"h4",sx:{fontWeight:700,mb:1},children:["Welcome back, ",((B=t==null?void 0:t.name)==null?void 0:B.split(" ")[0])||"User","! ðŸ‘‹"]}),e.jsx(s,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Here's what's happening with your BackboneLogic, Inc. licenses"})]})}),e.jsxs(a,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(a,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(f,{title:"Active Licenses",value:h,icon:e.jsx(ce,{}),trend:{value:12,direction:"up"},color:"primary"})}),A>0&&e.jsx(a,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(k,{title:"Click to view Team Management",arrow:!0,children:e.jsx("div",{children:e.jsx(f,{title:"Team Members",value:A,icon:e.jsx(M,{}),trend:{value:8,direction:"up"},color:"secondary",onClick:()=>u("/dashboard/team")})})})}),e.jsx(a,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(k,{title:"Click to view Cloud Projects",arrow:!0,children:e.jsx("div",{children:e.jsx(f,{title:"Total Projects",value:ge,icon:e.jsx(Pe,{}),trend:{value:15,direction:"up"},color:"success",onClick:()=>u("/dashboard/cloud-projects")})})})}),e.jsx(a,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(k,{title:"Click to view Cloud Projects",arrow:!0,children:e.jsx("div",{children:e.jsx(f,{title:"Active Projects",value:je,icon:e.jsx(Se,{}),trend:{value:8,direction:"up"},color:"warning",onClick:()=>u("/dashboard/cloud-projects")})})})})]}),e.jsx(He,{onUpgrade:()=>u("/pricing"),compact:!0}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{item:!0,xs:12,lg:8,children:e.jsx(r,{children:e.jsx(re,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",mb:3},children:e.jsxs(ae,{children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600,mb:3},children:"License Overview"}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsxs(a,{item:!0,xs:12,md:6,children:[e.jsxs(r,{sx:{mb:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"License Utilization"}),e.jsxs(s,{variant:"body2",sx:{fontWeight:600},children:[D,"%"]})]}),e.jsx(Ae,{variant:"determinate",value:D,sx:{height:8,borderRadius:4,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:4,background:D>80?"linear-gradient(90deg, #ff9800 0%, #f44336 100%)":"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}}),e.jsxs(s,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[h," of ",g," licenses in use"]})]}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Current Plan"}),e.jsx(Ce,{label:P&&P.charAt(0).toUpperCase()+P.slice(1).toLowerCase()||"â€”",color:"primary",sx:{fontWeight:600,mb:2}}),e.jsx(s,{variant:"body2",color:"text.secondary",children:F?`Next renewal in ${F}`:"â€”"})]})]}),e.jsxs(a,{item:!0,xs:12,md:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Quick Actions"}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:[A>0&&e.jsx(p,{variant:"outlined",startIcon:e.jsx(M,{}),component:b,to:"/dashboard/team",sx:{justifyContent:"flex-start"},children:"Add Team Member"}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(Ie,{}),component:b,to:"/dashboard/downloads",sx:{justifyContent:"flex-start"},children:"Download SDK"}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(De,{}),component:b,to:"/dashboard/billing",sx:{justifyContent:"flex-start"},children:"Upgrade Plan"})]})]})]})]})})})}),e.jsx(a,{item:!0,xs:12,lg:4,children:e.jsx(r,{children:e.jsx(re,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",height:"fit-content"},children:e.jsxs(ae,{children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Recent Activity"}),e.jsx(Te,{dense:!0,children:oe.map((o,T)=>e.jsxs(ie.Fragment,{children:[e.jsxs(Le,{sx:{px:0},children:[e.jsx(Re,{sx:{minWidth:40},children:e.jsx(ke,{sx:{width:32,height:32,bgcolor:Je(o.status),fontSize:"1rem"},children:$e(o.type)})}),e.jsx(Me,{primary:o.title,secondary:e.jsxs(ie.Fragment,{children:[e.jsx(s,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:o.description}),e.jsx(s,{variant:"caption",color:"text.secondary",children:o.timestamp})]}),primaryTypographyProps:{variant:"body2",fontWeight:500}})]}),T<oe.length-1&&e.jsx(Ne,{variant:"inset",component:"li",sx:{borderColor:"rgba(255,255,255,0.1)"}})]},T))}),e.jsx(p,{variant:"text",size:"small",sx:{mt:2,color:"primary.main"},component:b,to:"/dashboard/activity",children:"View All Activity"})]})})})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(r,{children:e.jsxs(Ue,{sx:{p:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600,mb:2},children:"System Status"}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ne,{sx:{color:"success.main",fontSize:20}}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"License Server"}),e.jsx(s,{variant:"caption",color:"success.main",children:"Operational"})]})]})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ne,{sx:{color:"success.main",fontSize:20}}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"API Services"}),e.jsx(s,{variant:"caption",color:"success.main",children:"Operational"})]})]})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Oe,{sx:{color:"warning.main",fontSize:20}}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Maintenance"}),e.jsx(s,{variant:"caption",color:"warning.main",children:"Scheduled 2AM EST"})]})]})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(We,{sx:{color:"primary.main",fontSize:20}}),e.jsxs(r,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"SDK Version"}),e.jsx(s,{variant:"caption",color:"primary.main",children:"v14.2.1 Available"})]})]})})]})]})})})]})]})};export{ns as default};
