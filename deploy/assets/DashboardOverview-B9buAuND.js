import{j as e,a as r,T as t,A as Pe,aE as Ae,aF as Se,G as a,aA as xe,aG as F,aH as V,aI as Ie,a7 as Ce,z as ie,J as oe,a1 as De,m as Te,d as T,aB as Me,K as Re,q as Le,r as ke,s as Oe,aC as Ne,t as Ue,p as We,c as ze,w as ce,aJ as Fe,aK as Ve,aq as Be,O as Ke,ak as Ge}from"./mui-Ilj8o9AZ.js";import{u as _e,r as i,L as M,b as le}from"./vendor-OeuszDaU.js";import{u as He,c as de,d as R,e as L}from"./index-f8_farJw.js";import{M as k}from"./MetricCard-BdSYF6k0.js";import{S as $e}from"./StorageWarningCard-B5pwvOu5.js";import"./stripe-BKUR_tcx.js";var B=(s=>(s.BASIC="BASIC",s.PRO="PRO",s.ENTERPRISE="ENTERPRISE",s))(B||{}),he=(s=>(s.PENDING="PENDING",s.ACTIVE="ACTIVE",s.SUSPENDED="SUSPENDED",s.EXPIRED="EXPIRED",s.REVOKED="REVOKED",s))(he||{});const me=[{type:"license",title:"License Activated",description:"Pro license activated for john.doe@company.com",timestamp:"2 hours ago",status:"success"},{type:"payment",title:"Payment Successful",description:"Monthly subscription renewed for $297.00",timestamp:"1 day ago",status:"success"},{type:"user",title:"Team Member Added",description:"Sarah Johnson added to development team",timestamp:"2 days ago",status:"success"},{type:"security",title:"Security Alert",description:"New device login detected from New York",timestamp:"3 days ago",status:"warning"}],Je=s=>{switch(s){case"license":return e.jsx(xe,{});case"payment":return e.jsx(Ge,{});case"user":return e.jsx(V,{});case"security":return e.jsx(Ke,{});default:return e.jsx(Be,{})}},qe=s=>{switch(s){case"success":return"success.main";case"warning":return"warning.main";case"error":return"error.main";default:return"text.secondary"}},os=()=>{var _;const{user:s}=He(),f=_e(),ue=()=>(s==null?void 0:s.isTeamMember)===!0||(s==null?void 0:s.role)==="TEAM_MEMBER"||(s==null?void 0:s.memberRole)&&(s==null?void 0:s.memberRole)!=="OWNER"||localStorage.getItem("team_member_data")!==null,[ge,K]=i.useState(!0),[y,E]=i.useState(0),[w,P]=i.useState(0),[Qe,u]=i.useState(0),[Xe,g]=i.useState(0),[O,A]=i.useState(""),[G,S]=i.useState(""),[Ye,j]=i.useState(!1),[je,be]=i.useState(!1),[pe,ve]=i.useState(null),[N,h]=i.useState(0),[fe,b]=i.useState(0),[ye,p]=i.useState(0),[Ze,es]=i.useState(!1);i.useEffect(()=>{let o=!0;return(async()=>{var H,$,J,q,Q,X,Y,Z,ee,se,te;try{K(!0);const I=ue();if(console.log("🔍 [DashboardOverview] User is team member:",I),I){console.log("🔍 [DashboardOverview] Fetching team member data only");try{const v=await de.getUserProjects();if(!o)return;const C=v||[];b(C.length),p(C.filter(D=>D.isActive&&!D.isArchived).length),E(0),P(0),u(0),g(0),A("Team Member"),S("N/A"),j(!1),h(0),console.log("🔍 [DashboardOverview] Team member data loaded successfully")}catch(v){console.error("🔍 [DashboardOverview] Error fetching team member data:",v),b(0),p(0),E(0),P(0),u(0),g(0),A("Team Member"),S("N/A"),j(!1),h(0)}}else{console.log("🔍 [DashboardOverview] Fetching account owner data");const[v,C,D,z,d]=await Promise.all([R.get(L.subscriptions.mySubscriptions()),R.get(L.licenses.analytics()),R.get(L.licenses.myLicenses()),de.getUserProjects(),R.get(L.organizations.context()).catch(()=>null)]);if(!o)return;const re=(($=(H=D.data)==null?void 0:H.data)==null?void 0:$.licenses)??[],Ee=re.length,we=re.filter(n=>n.status===he.ACTIVE).length;P(Ee),E(we);const ae=((q=(J=v.data)==null?void 0:J.data)==null?void 0:q.subscriptions)??[],l=ae.find(n=>n.status==="ACTIVE")||ae[0];if(l){if(A(((Q=l.tier)==null?void 0:Q.toLowerCase())??""),l.currentPeriodEnd){const n=new Date(l.currentPeriodEnd),c=Math.max(0,Math.ceil((n.getTime()-Date.now())/(1e3*60*60*24)));S(`${c} day${c===1?"":"s"}`)}j(l.tier===B.ENTERPRISE)}let m=0;if((Y=(X=d==null?void 0:d.data)==null?void 0:X.data)!=null&&Y.members)m=d.data.data.members.filter(c=>c&&c.status==="ACTIVE").length,console.log("[DashboardOverview] Found team members in org context:",m);else if((ee=(Z=d==null?void 0:d.data)==null?void 0:Z.data)!=null&&ee.organization){const n=d.data.data.organization;n.members&&Array.isArray(n.members)&&(m=n.members.filter(c=>c&&c.status==="ACTIVE").length,console.log("[DashboardOverview] Found team members in org object:",m))}else console.log("[DashboardOverview] No organization context available");m>0?(h(m),j(!0),console.log("[DashboardOverview] Setting team members count:",m)):l&&l.tier===B.ENTERPRISE?(h(l.seats||0),console.log("[DashboardOverview] Using subscription seats for Enterprise:",l.seats||0)):(h(0),console.log("[DashboardOverview] No team members found"));const x=(se=C.data)==null?void 0:se.data;if(x)if(x.summary){u(x.summary.totalEvents??0);const n=((te=x.summary.eventTypes)==null?void 0:te.SDK_DOWNLOAD_REQUEST)||0;g(n)}else x.totalEvents!==void 0&&(u(x.totalEvents),g(x.downloads||0));try{if(z){const n=z.length,c=z.filter(ne=>ne.isActive&&!ne.isArchived).length;b(n),p(c)}}catch(n){console.error("Error processing cloud projects data:",n),b(0),p(0)}be(!1),ve(null)}}catch(I){if(console.error("Error fetching dashboard data:",I),!o)return;E(0),P(0),u(0),g(0),A(""),S(""),j(!1),h(0),b(0),p(0)}finally{o&&K(!1)}})(),()=>{o=!1}},[]);const U=i.useMemo(()=>w<=0?0:Math.round(y/w*100),[y,w]);return ge?e.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:e.jsx(t,{children:"Loading dashboard..."})}):e.jsxs(r,{children:[je&&e.jsxs(Pe,{severity:"info",sx:{mb:3},icon:e.jsx(Se,{}),children:[e.jsx(Ae,{children:"Edge Mode Active"}),"Running in offline LAN mode via Edge Hub at ",pe||"local network",". Projects and data are stored locally and will sync when cloud connectivity returns."]}),e.jsx(r,{children:e.jsxs(r,{sx:{mb:4},children:[e.jsxs(t,{variant:"h4",sx:{fontWeight:700,mb:1},children:["Welcome back, ",((_=s==null?void 0:s.name)==null?void 0:_.split(" ")[0])||"User","! 👋"]}),e.jsx(t,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Here's what's happening with your BackboneLogic, Inc. licenses"})]})}),e.jsxs(a,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(a,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(k,{title:"Active Licenses",value:y,icon:e.jsx(xe,{}),trend:{value:12,direction:"up"},color:"primary"})}),N>0&&e.jsx(a,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(F,{title:"Click to view Team Management",arrow:!0,children:e.jsx("div",{children:e.jsx(k,{title:"Team Members",value:N,icon:e.jsx(V,{}),trend:{value:8,direction:"up"},color:"secondary",onClick:()=>f("/dashboard/team")})})})}),e.jsx(a,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(F,{title:"Click to view Cloud Projects",arrow:!0,children:e.jsx("div",{children:e.jsx(k,{title:"Total Projects",value:fe,icon:e.jsx(Ie,{}),trend:{value:15,direction:"up"},color:"success",onClick:()=>f("/dashboard/cloud-projects")})})})}),e.jsx(a,{item:!0,xs:12,sm:6,lg:3,children:e.jsx(F,{title:"Click to view Cloud Projects",arrow:!0,children:e.jsx("div",{children:e.jsx(k,{title:"Active Projects",value:ye,icon:e.jsx(Ce,{}),trend:{value:8,direction:"up"},color:"warning",onClick:()=>f("/dashboard/cloud-projects")})})})})]}),e.jsx($e,{onUpgrade:()=>f("/pricing"),compact:!0}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{item:!0,xs:12,lg:8,children:e.jsx(r,{children:e.jsx(ie,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",mb:3},children:e.jsxs(oe,{children:[e.jsx(t,{variant:"h6",sx:{fontWeight:600,mb:3},children:"License Overview"}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsxs(a,{item:!0,xs:12,md:6,children:[e.jsxs(r,{sx:{mb:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(t,{variant:"body2",color:"text.secondary",children:"License Utilization"}),e.jsxs(t,{variant:"body2",sx:{fontWeight:600},children:[U,"%"]})]}),e.jsx(De,{variant:"determinate",value:U,sx:{height:8,borderRadius:4,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:4,background:U>80?"linear-gradient(90deg, #ff9800 0%, #f44336 100%)":"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[y," of ",w," licenses in use"]})]}),e.jsxs(r,{children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Current Plan"}),e.jsx(Te,{label:O&&O.charAt(0).toUpperCase()+O.slice(1).toLowerCase()||"—",color:"primary",sx:{fontWeight:600,mb:2}}),e.jsx(t,{variant:"body2",color:"text.secondary",children:G?`Next renewal in ${G}`:"—"})]})]}),e.jsxs(a,{item:!0,xs:12,md:6,children:[e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Quick Actions"}),e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:1},children:[N>0&&e.jsx(T,{variant:"outlined",startIcon:e.jsx(V,{}),component:M,to:"/dashboard/team",sx:{justifyContent:"flex-start"},children:"Add Team Member"}),e.jsx(T,{variant:"outlined",startIcon:e.jsx(Me,{}),component:M,to:"/dashboard/downloads",sx:{justifyContent:"flex-start"},children:"Download SDK"}),e.jsx(T,{variant:"outlined",startIcon:e.jsx(Re,{}),component:M,to:"/dashboard/billing",sx:{justifyContent:"flex-start"},children:"Upgrade Plan"})]})]})]})]})})})}),e.jsx(a,{item:!0,xs:12,lg:4,children:e.jsx(r,{children:e.jsx(ie,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)",height:"fit-content"},children:e.jsxs(oe,{children:[e.jsx(t,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Recent Activity"}),e.jsx(Le,{dense:!0,children:me.map((o,W)=>e.jsxs(le.Fragment,{children:[e.jsxs(ke,{sx:{px:0},children:[e.jsx(Oe,{sx:{minWidth:40},children:e.jsx(Ne,{sx:{width:32,height:32,bgcolor:qe(o.status),fontSize:"1rem"},children:Je(o.type)})}),e.jsx(Ue,{primary:o.title,secondary:e.jsxs(le.Fragment,{children:[e.jsx(t,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:o.description}),e.jsx(t,{variant:"caption",color:"text.secondary",children:o.timestamp})]}),primaryTypographyProps:{variant:"body2",fontWeight:500}})]}),W<me.length-1&&e.jsx(We,{variant:"inset",component:"li",sx:{borderColor:"rgba(255,255,255,0.1)"}})]},W))}),e.jsx(T,{variant:"text",size:"small",sx:{mt:2,color:"primary.main"},component:M,to:"/dashboard/activity",children:"View All Activity"})]})})})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(r,{children:e.jsxs(ze,{sx:{p:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:600,mb:2},children:"System Status"}),e.jsxs(a,{container:!0,spacing:3,children:[e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ce,{sx:{color:"success.main",fontSize:20}}),e.jsxs(r,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:500},children:"License Server"}),e.jsx(t,{variant:"caption",color:"success.main",children:"Operational"})]})]})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ce,{sx:{color:"success.main",fontSize:20}}),e.jsxs(r,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:500},children:"API Services"}),e.jsx(t,{variant:"caption",color:"success.main",children:"Operational"})]})]})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Fe,{sx:{color:"warning.main",fontSize:20}}),e.jsxs(r,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:500},children:"Maintenance"}),e.jsx(t,{variant:"caption",color:"warning.main",children:"Scheduled 2AM EST"})]})]})}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ve,{sx:{color:"primary.main",fontSize:20}}),e.jsxs(r,{children:[e.jsx(t,{variant:"body2",sx:{fontWeight:500},children:"SDK Version"}),e.jsx(t,{variant:"caption",color:"primary.main",children:"v14.2.1 Available"})]})]})})]})]})})})]})]})};export{os as default};
