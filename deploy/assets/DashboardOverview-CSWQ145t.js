import{j as e,B as a,C as oe,T as t,d as q,ai as H,w as M,x,y as h,aj as ce,z as j,H as K,K as de,a as p,ak as le,al as N,am as xe,G as y,t as v,v as f,ag as B,ae as J,i as he,an as R,ao as je,q as F,D as O,aa as ue,r as $,p as me,u as ge}from"./mui-BN540ctE.js";import{u as be,r as u,b as pe}from"./vendor-CjD1bmmO.js";import{u as ye}from"./index-QI6vUtjw.js";import{db as V}from"./firebase-CGg-uXYU.js";import{getDoc as X,doc as Z,query as _,collection as ee,where as Q,orderBy as ve,limit as fe,getDocs as te}from"./index.esm-DonjM_pP.js";import"./stripe-C-GNnApq.js";import"./index.esm-D7ujsXeY.js";import"./index.esm-D2YDx4vs.js";const Ue=()=>{const l=be(),{user:s,isAuthenticated:A,isLoading:I}=ye(),[o,se]=u.useState(null),[m,re]=u.useState(null),[i,ae]=u.useState([]),[z,ne]=u.useState([]),[S,G]=u.useState(!0),[ie,W]=u.useState(null);u.useEffect(()=>{console.log("ðŸ” [DashboardOverview] State Debug:",{authLoading:I,loading:S,user:s,isAuthenticated:A,currentUser:o,organization:m,projects:i,teamMembers:z})},[I,S,s,A,o,m,i,z]),u.useEffect(()=>{console.log("ðŸ” [DashboardOverview] State Debug:",{authLoading:I,loading:S,user:s,isAuthenticated:A,currentUser:o,organization:m,projects:i,teamMembers:z})},[I,S,s,A,o,m,i,z]),u.useEffect(()=>{if(!A||!s)return;(async()=>{var D,k,L,P;try{G(!0),W(null),console.log("ðŸ” [DashboardOverview] Fetching data for user:",{userId:s.id,firebaseUid:s.firebaseUid,organizationId:s.organizationId,email:s.email});const C=s.firebaseUid||s.id,E=await X(Z(V,"users",C));if(E.exists()){const r=E.data();se({id:E.id,...r,createdAt:((D=r.createdAt)==null?void 0:D.toDate())||new Date,updatedAt:((k=r.updatedAt)==null?void 0:k.toDate())||new Date})}if(s.organizationId){const r=await X(Z(V,"organizations",s.organizationId));if(r.exists()){const g=r.data();re({id:r.id,...g,createdAt:((L=g.createdAt)==null?void 0:L.toDate())||new Date,updatedAt:((P=g.updatedAt)==null?void 0:P.toDate())||new Date})}}if(s.organizationId){console.log("ðŸ” [DashboardOverview] Querying projects for organizationId:",s.organizationId);try{const r=_(ee(V,"projects"),Q("organizationId","==",s.organizationId),ve("createdAt","desc"),fe(10)),g=await te(r);console.log("âœ… [DashboardOverview] Projects found:",g.size);const T=g.docs.map(d=>{var b,U;return{id:d.id,...d.data(),createdAt:((b=d.data().createdAt)==null?void 0:b.toDate())||new Date,updatedAt:((U=d.data().updatedAt)==null?void 0:U.toDate())||new Date}});ae(T)}catch(r){throw console.error("âŒ [DashboardOverview] Error fetching projects:",r),r}}if(s.organizationId){console.log("ðŸ” [DashboardOverview] Querying team members for organizationId:",s.organizationId);try{const r=_(ee(V,"teamMembers"),Q("organizationId","==",s.organizationId),Q("status","==","ACTIVE")),g=await te(r);console.log("âœ… [DashboardOverview] Team members found:",g.size);const T=g.docs.map(d=>{var b,U;return{id:d.id,...d.data(),createdAt:((b=d.data().createdAt)==null?void 0:b.toDate())||new Date,updatedAt:((U=d.data().updatedAt)==null?void 0:U.toDate())||new Date}});ne(T)}catch(r){throw console.error("âŒ [DashboardOverview] Error fetching team members:",r),r}}}catch(C){console.error("Error fetching dashboard data:",C),W(C instanceof Error?C.message:"Failed to fetch dashboard data")}finally{G(!1)}})()},[A,s]);const n=u.useMemo(()=>{if(!o||!m)return{activeLicenses:0,totalLicenses:0,monthlyUsage:0,totalDownloads:0,currentPlan:"Unknown",daysUntilRenewal:"N/A",hasEnterpriseFeatures:!1,projectCount:0,teamMemberCount:0,licenseUtilization:0};const c=o.status==="ACTIVE"?1:0,D=1,k=c/D*100,L=i.reduce((d,b)=>d+(b.status==="ACTIVE"?100:0),0),P=i.reduce((d,b)=>d+(b.status==="ACTIVE"?50:0),0),C=z.length,E=i.length,r=m.tier||"BASIC";return{activeLicenses:c,totalLicenses:D,monthlyUsage:L,totalDownloads:P,currentPlan:r,daysUntilRenewal:"30 days",hasEnterpriseFeatures:r==="ENTERPRISE",projectCount:E,teamMemberCount:C,licenseUtilization:k}},[o,m,i,z]),w=u.useMemo(()=>{var c;return o?((c=o.role)==null?void 0:c.toLowerCase())||"member":"unknown"},[o]),Y=w==="admin"||w==="owner"||w==="superadmin";return I||S?e.jsx(a,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(a,{textAlign:"center",children:[e.jsx(oe,{size:60}),e.jsx(t,{variant:"h6",sx:{mt:2},children:"Loading Dashboard Data..."}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Fetching your organization and project information"})]})}):ie?e.jsx(a,{sx:{p:3},children:e.jsxs(q,{severity:"error",children:[e.jsx(H,{children:"Unable to Load Dashboard Data"}),e.jsx(t,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your dashboard information. This could be due to:"}),e.jsxs(M,{dense:!0,children:[e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(ce,{fontSize:"small"})}),e.jsx(j,{primary:"Network connectivity issues"})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(K,{fontSize:"small"})}),e.jsx(j,{primary:"Authentication token expired"})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(de,{fontSize:"small"})}),e.jsx(j,{primary:"Firebase service temporarily unavailable"})]})]}),e.jsxs(a,{sx:{mt:2},children:[e.jsx(p,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Retry"}),e.jsx(p,{variant:"outlined",onClick:()=>l("/dashboard/support"),children:"Contact Support"})]})]})}):!o||!m?e.jsx(a,{sx:{p:3},children:e.jsxs(q,{severity:"info",children:[e.jsx(H,{children:"Setting Up Your Dashboard"}),e.jsx(t,{variant:"body2",sx:{mb:2},children:"We're preparing your dashboard. This usually happens when:"}),e.jsxs(M,{dense:!0,children:[e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(le,{fontSize:"small"})}),e.jsx(j,{primary:"Your account is being set up for the first time"})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(N,{fontSize:"small"})}),e.jsx(j,{primary:"You're being added to an organization"})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsx(xe,{fontSize:"small"})}),e.jsx(j,{primary:"Data synchronization is in progress"})]})]}),e.jsxs(a,{sx:{mt:2},children:[e.jsx(p,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Refresh"}),e.jsx(p,{variant:"outlined",onClick:()=>l("/dashboard/team"),children:"Check Team Status"})]})]})}):e.jsxs(a,{sx:{flexGrow:1,p:3},children:[e.jsxs(a,{sx:{mb:4},children:[e.jsxs(t,{variant:"h4",component:"h1",gutterBottom:!0,children:["Welcome back, ",o.name||o.email]}),e.jsxs(t,{variant:"subtitle1",color:"text.secondary",children:[m.name," â€¢ ",n.currentPlan," Plan â€¢ ",w.charAt(0).toUpperCase()+w.slice(1)]})]}),e.jsxs(y,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{children:e.jsxs(f,{children:[e.jsxs(a,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(a,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Active Licenses"}),e.jsx(t,{variant:"h4",children:n.activeLicenses}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["of ",n.totalLicenses," total"]})]}),e.jsx(B,{sx:{bgcolor:"primary.main"},children:e.jsx(J,{})})]}),n.totalLicenses>0&&e.jsxs(a,{sx:{mt:2},children:[e.jsx(he,{variant:"determinate",value:n.licenseUtilization,sx:{height:8,borderRadius:4}}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[n.licenseUtilization.toFixed(1),"% utilization"]})]})]})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{children:e.jsx(f,{children:e.jsxs(a,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(a,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Projects"}),e.jsx(t,{variant:"h4",children:n.projectCount}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"active projects"})]}),e.jsx(B,{sx:{bgcolor:"success.main"},children:e.jsx(R,{})})]})})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{children:e.jsx(f,{children:e.jsxs(a,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(a,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Team Members"}),e.jsx(t,{variant:"h4",children:n.teamMemberCount}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"in organization"})]}),e.jsx(B,{sx:{bgcolor:"info.main"},children:e.jsx(N,{})})]})})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{children:e.jsx(f,{children:e.jsxs(a,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(a,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Monthly Usage"}),e.jsx(t,{variant:"h4",children:n.monthlyUsage.toLocaleString()}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"API calls"})]}),e.jsx(B,{sx:{bgcolor:"warning.main"},children:e.jsx(je,{})})]})})})})]}),e.jsxs(y,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(v,{children:e.jsxs(f,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),e.jsxs(M,{children:[e.jsxs(x,{button:!0,onClick:()=>l("/dashboard/projects"),children:[e.jsx(h,{children:e.jsx(R,{})}),e.jsx(j,{primary:"Manage Projects",secondary:`${n.projectCount} active projects`}),e.jsx(F,{})]}),e.jsx(O,{}),e.jsxs(x,{button:!0,onClick:()=>l("/dashboard/team"),children:[e.jsx(h,{children:e.jsx(N,{})}),e.jsx(j,{primary:"Team Management",secondary:`${n.teamMemberCount} team members`}),e.jsx(F,{})]}),e.jsx(O,{}),e.jsxs(x,{button:!0,onClick:()=>l("/dashboard/licenses"),children:[e.jsx(h,{children:e.jsx(J,{})}),e.jsx(j,{primary:"License Management",secondary:`${n.activeLicenses} active licenses`}),e.jsx(F,{})]}),Y&&e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsxs(x,{button:!0,onClick:()=>l("/dashboard/billing"),children:[e.jsx(h,{children:e.jsx(ue,{})}),e.jsx(j,{primary:"Billing & Subscription",secondary:`${n.currentPlan} plan â€¢ Renews ${n.daysUntilRenewal}`}),e.jsx(F,{})]})]})]})]})})}),e.jsx(y,{item:!0,xs:12,md:6,children:e.jsx(v,{children:e.jsxs(f,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Account Status"}),e.jsxs(a,{sx:{mb:2},children:[e.jsx($,{icon:e.jsx(me,{}),label:`${n.currentPlan} Plan`,color:"primary",sx:{mr:1,mb:1}}),e.jsx($,{icon:e.jsx(K,{}),label:w.charAt(0).toUpperCase()+w.slice(1),color:"secondary",sx:{mr:1,mb:1}}),n.hasEnterpriseFeatures&&e.jsx($,{icon:e.jsx(ge,{}),label:"Enterprise",color:"warning",sx:{mr:1,mb:1}})]}),e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Organization: ",m.name]}),e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Next renewal: ",n.daysUntilRenewal]}),e.jsxs(a,{sx:{mt:2},children:[e.jsx(p,{variant:"outlined",size:"small",onClick:()=>l("/dashboard/settings"),sx:{mr:1},children:"Account Settings"}),Y&&e.jsx(p,{variant:"outlined",size:"small",onClick:()=>l("/dashboard/billing"),children:"Manage Billing"})]})]})})})]}),i&&i.length>0&&e.jsx(v,{children:e.jsxs(f,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Recent Projects"}),e.jsx(M,{children:i.slice(0,5).map((c,D)=>e.jsxs(pe.Fragment,{children:[e.jsxs(x,{button:!0,onClick:()=>l(`/dashboard/projects/${c.id}`),children:[e.jsx(h,{children:e.jsx(R,{})}),e.jsx(j,{primary:c.name,secondary:`Created ${new Date(c.createdAt).toLocaleDateString()}`}),e.jsx($,{label:c.status||"ACTIVE",size:"small",color:c.status==="ACTIVE"?"success":"default"})]}),D<Math.min(i.length-1,4)&&e.jsx(O,{})]},c.id))}),i.length>5&&e.jsx(a,{sx:{mt:2,textAlign:"center"},children:e.jsxs(p,{variant:"outlined",onClick:()=>l("/dashboard/projects"),children:["View All Projects (",i.length,")"]})})]})}),i&&i.length===0&&e.jsx(v,{children:e.jsxs(f,{sx:{textAlign:"center",py:4},children:[e.jsx(R,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"No Projects Yet"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Get started by creating your first project"}),e.jsx(p,{variant:"contained",onClick:()=>l("/dashboard/projects"),children:"Create Project"})]})})]})};export{Ue as default};
