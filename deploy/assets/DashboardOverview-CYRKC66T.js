import{j as e,B as s,C as ie,T as t,d as Q,ai as q,w as T,x as d,y as x,aj as oe,z as h,H,K as ce,a as f,ak as le,al as N,am as de,G as v,t as C,v as w,ag as B,ae as K,i as xe,an as M,ao as he,q as R,D as F,aa as je,r as $,p as ue,u as me}from"./mui-BEXhTKQE.js";import{u as pe,r as j,b as ge}from"./vendor-CjD1bmmO.js";import{u as be}from"./index-SPrD8gjn.js";import{db as V}from"./firebase-CzYWGC7y.js";import{getDoc as _,doc as J,query as X,collection as Z,where as O,orderBy as ye,limit as fe,getDocs as ee}from"./index.esm-DonjM_pP.js";import"./stripe-BgsnbYLP.js";import"./index.esm-D7ujsXeY.js";import"./index.esm-D2YDx4vs.js";const ke=()=>{const l=pe(),{user:n,isAuthenticated:S,isLoading:I}=be(),[i,te]=j.useState(null),[u,se]=j.useState(null),[a,re]=j.useState([]),[z,ae]=j.useState([]),[k,G]=j.useState(!0),[ne,W]=j.useState(null);j.useEffect(()=>{console.log("ðŸ” [DashboardOverview] State Debug:",{authLoading:I,loading:k,user:n,isAuthenticated:S,currentUser:i,organization:u,projects:a,teamMembers:z})},[I,k,n,S,i,u,a,z]),j.useEffect(()=>{console.log("ðŸ” [DashboardOverview] State Debug:",{authLoading:I,loading:k,user:n,isAuthenticated:S,currentUser:i,organization:u,projects:a,teamMembers:z})},[I,k,n,S,i,u,a,z]),j.useEffect(()=>{if(!S||!n)return;(async()=>{var D,L,E,U;try{G(!0),W(null);const p=await _(J(V,"users",n.id));if(p.exists()){const c=p.data();te({id:p.id,...c,createdAt:((D=c.createdAt)==null?void 0:D.toDate())||new Date,updatedAt:((L=c.updatedAt)==null?void 0:L.toDate())||new Date})}if(n.organizationId){const c=await _(J(V,"organizations",n.organizationId));if(c.exists()){const y=c.data();se({id:c.id,...y,createdAt:((E=y.createdAt)==null?void 0:E.toDate())||new Date,updatedAt:((U=y.updatedAt)==null?void 0:U.toDate())||new Date})}}if(n.organizationId){const c=X(Z(V,"projects"),O("organizationId","==",n.organizationId),ye("createdAt","desc"),fe(10)),P=(await ee(c)).docs.map(m=>{var g,b;return{id:m.id,...m.data(),createdAt:((g=m.data().createdAt)==null?void 0:g.toDate())||new Date,updatedAt:((b=m.data().updatedAt)==null?void 0:b.toDate())||new Date}});re(P)}if(n.organizationId){const c=X(Z(V,"team_members"),O("organizationId","==",n.organizationId),O("status","==","ACTIVE")),P=(await ee(c)).docs.map(m=>{var g,b;return{id:m.id,...m.data(),createdAt:((g=m.data().createdAt)==null?void 0:g.toDate())||new Date,updatedAt:((b=m.data().updatedAt)==null?void 0:b.toDate())||new Date}});ae(P)}}catch(p){console.error("Error fetching dashboard data:",p),W(p instanceof Error?p.message:"Failed to fetch dashboard data")}finally{G(!1)}})()},[S,n]);const r=j.useMemo(()=>{if(!i||!u)return{activeLicenses:0,totalLicenses:0,monthlyUsage:0,totalDownloads:0,currentPlan:"Unknown",daysUntilRenewal:"N/A",hasEnterpriseFeatures:!1,projectCount:0,teamMemberCount:0,licenseUtilization:0};const o=i.status==="ACTIVE"?1:0,D=1,L=o/D*100,E=a.reduce((g,b)=>g+(b.status==="ACTIVE"?100:0),0),U=a.reduce((g,b)=>g+(b.status==="ACTIVE"?50:0),0),p=z.length,c=a.length,y=u.tier||"BASIC";return{activeLicenses:o,totalLicenses:D,monthlyUsage:E,totalDownloads:U,currentPlan:y,daysUntilRenewal:"30 days",hasEnterpriseFeatures:y==="ENTERPRISE",projectCount:c,teamMemberCount:p,licenseUtilization:L}},[i,u,a,z]),A=j.useMemo(()=>{var o;return i?((o=i.role)==null?void 0:o.toLowerCase())||"member":"unknown"},[i]),Y=A==="admin"||A==="owner"||A==="superadmin";return I||k?e.jsx(s,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ie,{size:60}),e.jsx(t,{variant:"h6",sx:{mt:2},children:"Loading Dashboard Data..."}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Fetching your organization and project information"})]})}):ne?e.jsx(s,{sx:{p:3},children:e.jsxs(Q,{severity:"error",children:[e.jsx(q,{children:"Unable to Load Dashboard Data"}),e.jsx(t,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your dashboard information. This could be due to:"}),e.jsxs(T,{dense:!0,children:[e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(oe,{fontSize:"small"})}),e.jsx(h,{primary:"Network connectivity issues"})]}),e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(H,{fontSize:"small"})}),e.jsx(h,{primary:"Authentication token expired"})]}),e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(ce,{fontSize:"small"})}),e.jsx(h,{primary:"Firebase service temporarily unavailable"})]})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(f,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Retry"}),e.jsx(f,{variant:"outlined",onClick:()=>l("/dashboard/support"),children:"Contact Support"})]})]})}):!i||!u?e.jsx(s,{sx:{p:3},children:e.jsxs(Q,{severity:"info",children:[e.jsx(q,{children:"Setting Up Your Dashboard"}),e.jsx(t,{variant:"body2",sx:{mb:2},children:"We're preparing your dashboard. This usually happens when:"}),e.jsxs(T,{dense:!0,children:[e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(le,{fontSize:"small"})}),e.jsx(h,{primary:"Your account is being set up for the first time"})]}),e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(N,{fontSize:"small"})}),e.jsx(h,{primary:"You're being added to an organization"})]}),e.jsxs(d,{children:[e.jsx(x,{children:e.jsx(de,{fontSize:"small"})}),e.jsx(h,{primary:"Data synchronization is in progress"})]})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(f,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Refresh"}),e.jsx(f,{variant:"outlined",onClick:()=>l("/dashboard/team"),children:"Check Team Status"})]})]})}):e.jsxs(s,{sx:{flexGrow:1,p:3},children:[e.jsxs(s,{sx:{mb:4},children:[e.jsxs(t,{variant:"h4",component:"h1",gutterBottom:!0,children:["Welcome back, ",i.name||i.email]}),e.jsxs(t,{variant:"subtitle1",color:"text.secondary",children:[u.name," â€¢ ",r.currentPlan," Plan â€¢ ",A.charAt(0).toUpperCase()+A.slice(1)]})]}),e.jsxs(v,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(v,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{children:e.jsxs(w,{children:[e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(s,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Active Licenses"}),e.jsx(t,{variant:"h4",children:r.activeLicenses}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["of ",r.totalLicenses," total"]})]}),e.jsx(B,{sx:{bgcolor:"primary.main"},children:e.jsx(K,{})})]}),r.totalLicenses>0&&e.jsxs(s,{sx:{mt:2},children:[e.jsx(xe,{variant:"determinate",value:r.licenseUtilization,sx:{height:8,borderRadius:4}}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[r.licenseUtilization.toFixed(1),"% utilization"]})]})]})})}),e.jsx(v,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{children:e.jsx(w,{children:e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(s,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Projects"}),e.jsx(t,{variant:"h4",children:r.projectCount}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"active projects"})]}),e.jsx(B,{sx:{bgcolor:"success.main"},children:e.jsx(M,{})})]})})})}),e.jsx(v,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{children:e.jsx(w,{children:e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(s,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Team Members"}),e.jsx(t,{variant:"h4",children:r.teamMemberCount}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"in organization"})]}),e.jsx(B,{sx:{bgcolor:"info.main"},children:e.jsx(N,{})})]})})})}),e.jsx(v,{item:!0,xs:12,sm:6,md:3,children:e.jsx(C,{children:e.jsx(w,{children:e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(s,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Monthly Usage"}),e.jsx(t,{variant:"h4",children:r.monthlyUsage.toLocaleString()}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"API calls"})]}),e.jsx(B,{sx:{bgcolor:"warning.main"},children:e.jsx(he,{})})]})})})})]}),e.jsxs(v,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(v,{item:!0,xs:12,md:6,children:e.jsx(C,{children:e.jsxs(w,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),e.jsxs(T,{children:[e.jsxs(d,{button:!0,onClick:()=>l("/dashboard/projects"),children:[e.jsx(x,{children:e.jsx(M,{})}),e.jsx(h,{primary:"Manage Projects",secondary:`${r.projectCount} active projects`}),e.jsx(R,{})]}),e.jsx(F,{}),e.jsxs(d,{button:!0,onClick:()=>l("/dashboard/team"),children:[e.jsx(x,{children:e.jsx(N,{})}),e.jsx(h,{primary:"Team Management",secondary:`${r.teamMemberCount} team members`}),e.jsx(R,{})]}),e.jsx(F,{}),e.jsxs(d,{button:!0,onClick:()=>l("/dashboard/licenses"),children:[e.jsx(x,{children:e.jsx(K,{})}),e.jsx(h,{primary:"License Management",secondary:`${r.activeLicenses} active licenses`}),e.jsx(R,{})]}),Y&&e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsxs(d,{button:!0,onClick:()=>l("/dashboard/billing"),children:[e.jsx(x,{children:e.jsx(je,{})}),e.jsx(h,{primary:"Billing & Subscription",secondary:`${r.currentPlan} plan â€¢ Renews ${r.daysUntilRenewal}`}),e.jsx(R,{})]})]})]})]})})}),e.jsx(v,{item:!0,xs:12,md:6,children:e.jsx(C,{children:e.jsxs(w,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Account Status"}),e.jsxs(s,{sx:{mb:2},children:[e.jsx($,{icon:e.jsx(ue,{}),label:`${r.currentPlan} Plan`,color:"primary",sx:{mr:1,mb:1}}),e.jsx($,{icon:e.jsx(H,{}),label:A.charAt(0).toUpperCase()+A.slice(1),color:"secondary",sx:{mr:1,mb:1}}),r.hasEnterpriseFeatures&&e.jsx($,{icon:e.jsx(me,{}),label:"Enterprise",color:"warning",sx:{mr:1,mb:1}})]}),e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Organization: ",u.name]}),e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Next renewal: ",r.daysUntilRenewal]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(f,{variant:"outlined",size:"small",onClick:()=>l("/dashboard/settings"),sx:{mr:1},children:"Account Settings"}),Y&&e.jsx(f,{variant:"outlined",size:"small",onClick:()=>l("/dashboard/billing"),children:"Manage Billing"})]})]})})})]}),a&&a.length>0&&e.jsx(C,{children:e.jsxs(w,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Recent Projects"}),e.jsx(T,{children:a.slice(0,5).map((o,D)=>e.jsxs(ge.Fragment,{children:[e.jsxs(d,{button:!0,onClick:()=>l(`/dashboard/projects/${o.id}`),children:[e.jsx(x,{children:e.jsx(M,{})}),e.jsx(h,{primary:o.name,secondary:`Created ${new Date(o.createdAt).toLocaleDateString()}`}),e.jsx($,{label:o.status||"ACTIVE",size:"small",color:o.status==="ACTIVE"?"success":"default"})]}),D<Math.min(a.length-1,4)&&e.jsx(F,{})]},o.id))}),a.length>5&&e.jsx(s,{sx:{mt:2,textAlign:"center"},children:e.jsxs(f,{variant:"outlined",onClick:()=>l("/dashboard/projects"),children:["View All Projects (",a.length,")"]})})]})}),a&&a.length===0&&e.jsx(C,{children:e.jsxs(w,{sx:{textAlign:"center",py:4},children:[e.jsx(M,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"No Projects Yet"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Get started by creating your first project"}),e.jsx(f,{variant:"contained",onClick:()=>l("/dashboard/projects"),children:"Create Project"})]})})]})};export{ke as default};
