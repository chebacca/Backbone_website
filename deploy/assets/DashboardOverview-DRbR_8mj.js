import{j as e,B as s,C as ie,T as t,d as Y,ai as O,w as L,x as c,y as l,aj as oe,z as d,H as Q,K as ce,a as b,ak as le,al as R,am as de,G as f,t as v,v as C,ag as U,ae as q,i as xe,an as E,ao as he,q as P,D as T,aa as je,r as B,p as ue,u as me}from"./mui-CwmAuw8Y.js";import{u as pe,r as g,b as ge}from"./vendor-CjD1bmmO.js";import{u as ye}from"./index-aK4jFdLF.js";import{db as M}from"./firebase-C2LkCNug.js";import{getDoc as H,doc as K,query as _,collection as J,where as F,orderBy as be,limit as fe,getDocs as X}from"./index.esm-DonjM_pP.js";import"./stripe-N9VLlH2J.js";import"./index.esm-D7ujsXeY.js";import"./index.esm-D2YDx4vs.js";const ke=()=>{const o=pe(),{user:h,isAuthenticated:$,isLoading:Z}=ye(),[j,ee]=g.useState(null),[D,te]=g.useState(null),[i,se]=g.useState([]),[V,re]=g.useState([]),[ae,N]=g.useState(!0),[ne,G]=g.useState(null);g.useEffect(()=>{if(!$||!h)return;(async()=>{var w,S,z,I;try{N(!0),G(null);const u=await H(K(M,"users",h.id));if(u.exists()){const n=u.data();ee({id:u.id,...n,createdAt:((w=n.createdAt)==null?void 0:w.toDate())||new Date,updatedAt:((S=n.updatedAt)==null?void 0:S.toDate())||new Date})}if(h.organizationId){const n=await H(K(M,"organizations",h.organizationId));if(n.exists()){const y=n.data();te({id:n.id,...y,createdAt:((z=y.createdAt)==null?void 0:z.toDate())||new Date,updatedAt:((I=y.updatedAt)==null?void 0:I.toDate())||new Date})}}if(h.organizationId){const n=_(J(M,"projects"),F("organizationId","==",h.organizationId),be("createdAt","desc"),fe(10)),k=(await X(n)).docs.map(x=>{var m,p;return{id:x.id,...x.data(),createdAt:((m=x.data().createdAt)==null?void 0:m.toDate())||new Date,updatedAt:((p=x.data().updatedAt)==null?void 0:p.toDate())||new Date}});se(k)}if(h.organizationId){const n=_(J(M,"team_members"),F("organizationId","==",h.organizationId),F("status","==","ACTIVE")),k=(await X(n)).docs.map(x=>{var m,p;return{id:x.id,...x.data(),createdAt:((m=x.data().createdAt)==null?void 0:m.toDate())||new Date,updatedAt:((p=x.data().updatedAt)==null?void 0:p.toDate())||new Date}});re(k)}}catch(u){console.error("Error fetching dashboard data:",u),G(u instanceof Error?u.message:"Failed to fetch dashboard data")}finally{N(!1)}})()},[$,h]);const r=g.useMemo(()=>{if(!j||!D)return{activeLicenses:0,totalLicenses:0,monthlyUsage:0,totalDownloads:0,currentPlan:"Unknown",daysUntilRenewal:"N/A",hasEnterpriseFeatures:!1,projectCount:0,teamMemberCount:0,licenseUtilization:0};const a=j.status==="ACTIVE"?1:0,w=1,S=a/w*100,z=i.reduce((m,p)=>m+(p.status==="ACTIVE"?100:0),0),I=i.reduce((m,p)=>m+(p.status==="ACTIVE"?50:0),0),u=V.length,n=i.length,y=D.tier||"BASIC";return{activeLicenses:a,totalLicenses:w,monthlyUsage:z,totalDownloads:I,currentPlan:y,daysUntilRenewal:"30 days",hasEnterpriseFeatures:y==="ENTERPRISE",projectCount:n,teamMemberCount:u,licenseUtilization:S}},[j,D,i,V]),A=g.useMemo(()=>{var a;return j?((a=j.role)==null?void 0:a.toLowerCase())||"member":"unknown"},[j]),W=A==="admin"||A==="owner"||A==="superadmin";return Z||ae?e.jsx(s,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(s,{textAlign:"center",children:[e.jsx(ie,{size:60}),e.jsx(t,{variant:"h6",sx:{mt:2},children:"Loading Dashboard Data..."}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Fetching your organization and project information"})]})}):ne?e.jsx(s,{sx:{p:3},children:e.jsxs(Y,{severity:"error",children:[e.jsx(O,{children:"Unable to Load Dashboard Data"}),e.jsx(t,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your dashboard information. This could be due to:"}),e.jsxs(L,{dense:!0,children:[e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(oe,{fontSize:"small"})}),e.jsx(d,{primary:"Network connectivity issues"})]}),e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(Q,{fontSize:"small"})}),e.jsx(d,{primary:"Authentication token expired"})]}),e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(ce,{fontSize:"small"})}),e.jsx(d,{primary:"Firebase service temporarily unavailable"})]})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(b,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Retry"}),e.jsx(b,{variant:"outlined",onClick:()=>o("/dashboard/support"),children:"Contact Support"})]})]})}):!j||!D?e.jsx(s,{sx:{p:3},children:e.jsxs(Y,{severity:"info",children:[e.jsx(O,{children:"Setting Up Your Dashboard"}),e.jsx(t,{variant:"body2",sx:{mb:2},children:"We're preparing your dashboard. This usually happens when:"}),e.jsxs(L,{dense:!0,children:[e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(le,{fontSize:"small"})}),e.jsx(d,{primary:"Your account is being set up for the first time"})]}),e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(R,{fontSize:"small"})}),e.jsx(d,{primary:"You're being added to an organization"})]}),e.jsxs(c,{children:[e.jsx(l,{children:e.jsx(de,{fontSize:"small"})}),e.jsx(d,{primary:"Data synchronization is in progress"})]})]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(b,{variant:"contained",onClick:()=>window.location.reload(),sx:{mr:2},children:"Refresh"}),e.jsx(b,{variant:"outlined",onClick:()=>o("/dashboard/team"),children:"Check Team Status"})]})]})}):e.jsxs(s,{sx:{flexGrow:1,p:3},children:[e.jsxs(s,{sx:{mb:4},children:[e.jsxs(t,{variant:"h4",component:"h1",gutterBottom:!0,children:["Welcome back, ",j.name||j.email]}),e.jsxs(t,{variant:"subtitle1",color:"text.secondary",children:[D.name," • ",r.currentPlan," Plan • ",A.charAt(0).toUpperCase()+A.slice(1)]})]}),e.jsxs(f,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(f,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{children:e.jsxs(C,{children:[e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(s,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Active Licenses"}),e.jsx(t,{variant:"h4",children:r.activeLicenses}),e.jsxs(t,{variant:"body2",color:"text.secondary",children:["of ",r.totalLicenses," total"]})]}),e.jsx(U,{sx:{bgcolor:"primary.main"},children:e.jsx(q,{})})]}),r.totalLicenses>0&&e.jsxs(s,{sx:{mt:2},children:[e.jsx(xe,{variant:"determinate",value:r.licenseUtilization,sx:{height:8,borderRadius:4}}),e.jsxs(t,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:[r.licenseUtilization.toFixed(1),"% utilization"]})]})]})})}),e.jsx(f,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{children:e.jsx(C,{children:e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(s,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Projects"}),e.jsx(t,{variant:"h4",children:r.projectCount}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"active projects"})]}),e.jsx(U,{sx:{bgcolor:"success.main"},children:e.jsx(E,{})})]})})})}),e.jsx(f,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{children:e.jsx(C,{children:e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(s,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Team Members"}),e.jsx(t,{variant:"h4",children:r.teamMemberCount}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"in organization"})]}),e.jsx(U,{sx:{bgcolor:"info.main"},children:e.jsx(R,{})})]})})})}),e.jsx(f,{item:!0,xs:12,sm:6,md:3,children:e.jsx(v,{children:e.jsx(C,{children:e.jsxs(s,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(s,{children:[e.jsx(t,{color:"textSecondary",gutterBottom:!0,variant:"body2",children:"Monthly Usage"}),e.jsx(t,{variant:"h4",children:r.monthlyUsage.toLocaleString()}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"API calls"})]}),e.jsx(U,{sx:{bgcolor:"warning.main"},children:e.jsx(he,{})})]})})})})]}),e.jsxs(f,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(f,{item:!0,xs:12,md:6,children:e.jsx(v,{children:e.jsxs(C,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),e.jsxs(L,{children:[e.jsxs(c,{button:!0,onClick:()=>o("/dashboard/projects"),children:[e.jsx(l,{children:e.jsx(E,{})}),e.jsx(d,{primary:"Manage Projects",secondary:`${r.projectCount} active projects`}),e.jsx(P,{})]}),e.jsx(T,{}),e.jsxs(c,{button:!0,onClick:()=>o("/dashboard/team"),children:[e.jsx(l,{children:e.jsx(R,{})}),e.jsx(d,{primary:"Team Management",secondary:`${r.teamMemberCount} team members`}),e.jsx(P,{})]}),e.jsx(T,{}),e.jsxs(c,{button:!0,onClick:()=>o("/dashboard/licenses"),children:[e.jsx(l,{children:e.jsx(q,{})}),e.jsx(d,{primary:"License Management",secondary:`${r.activeLicenses} active licenses`}),e.jsx(P,{})]}),W&&e.jsxs(e.Fragment,{children:[e.jsx(T,{}),e.jsxs(c,{button:!0,onClick:()=>o("/dashboard/billing"),children:[e.jsx(l,{children:e.jsx(je,{})}),e.jsx(d,{primary:"Billing & Subscription",secondary:`${r.currentPlan} plan • Renews ${r.daysUntilRenewal}`}),e.jsx(P,{})]})]})]})]})})}),e.jsx(f,{item:!0,xs:12,md:6,children:e.jsx(v,{children:e.jsxs(C,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Account Status"}),e.jsxs(s,{sx:{mb:2},children:[e.jsx(B,{icon:e.jsx(ue,{}),label:`${r.currentPlan} Plan`,color:"primary",sx:{mr:1,mb:1}}),e.jsx(B,{icon:e.jsx(Q,{}),label:A.charAt(0).toUpperCase()+A.slice(1),color:"secondary",sx:{mr:1,mb:1}}),r.hasEnterpriseFeatures&&e.jsx(B,{icon:e.jsx(me,{}),label:"Enterprise",color:"warning",sx:{mr:1,mb:1}})]}),e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Organization: ",D.name]}),e.jsxs(t,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Next renewal: ",r.daysUntilRenewal]}),e.jsxs(s,{sx:{mt:2},children:[e.jsx(b,{variant:"outlined",size:"small",onClick:()=>o("/dashboard/settings"),sx:{mr:1},children:"Account Settings"}),W&&e.jsx(b,{variant:"outlined",size:"small",onClick:()=>o("/dashboard/billing"),children:"Manage Billing"})]})]})})})]}),i&&i.length>0&&e.jsx(v,{children:e.jsxs(C,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Recent Projects"}),e.jsx(L,{children:i.slice(0,5).map((a,w)=>e.jsxs(ge.Fragment,{children:[e.jsxs(c,{button:!0,onClick:()=>o(`/dashboard/projects/${a.id}`),children:[e.jsx(l,{children:e.jsx(E,{})}),e.jsx(d,{primary:a.name,secondary:`Created ${new Date(a.createdAt).toLocaleDateString()}`}),e.jsx(B,{label:a.status||"ACTIVE",size:"small",color:a.status==="ACTIVE"?"success":"default"})]}),w<Math.min(i.length-1,4)&&e.jsx(T,{})]},a.id))}),i.length>5&&e.jsx(s,{sx:{mt:2,textAlign:"center"},children:e.jsxs(b,{variant:"outlined",onClick:()=>o("/dashboard/projects"),children:["View All Projects (",i.length,")"]})})]})}),i&&i.length===0&&e.jsx(v,{children:e.jsxs(C,{sx:{textAlign:"center",py:4},children:[e.jsx(E,{sx:{fontSize:64,color:"text.secondary",mb:2}}),e.jsx(t,{variant:"h6",gutterBottom:!0,children:"No Projects Yet"}),e.jsx(t,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Get started by creating your first project"}),e.jsx(b,{variant:"contained",onClick:()=>o("/dashboard/projects"),children:"Create Project"})]})})]})};export{ke as default};
