var tt=Object.defineProperty;var st=(f,s,e)=>s in f?tt(f,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):f[s]=e;var M=(f,s,e)=>st(f,typeof s!="symbol"?s+"":s,e);import{j as t,B as w,T as y,G as T,aR as at,d as Ie,ai as Me,a as k,cd as it,ce as nt,c7 as rt,al as De,p as lt,am as ot,bP as ct,t as ne,aU as dt,aV as _,ab as ut,aW as pt,a6 as ht,cf as mt,e as gt,I as ft,be as xt,cg as vt,bC as jt,bD as re,ch as yt,ci as wt,cj as St,ck as At,v as Le,ar as K,as as X,at as Z,M as I,aB as le,c as oe,aC as ce,aD as de,aE as z,aF as h,l as ke,aG as ue,af as Tt,r as D,g as Ct,aH as bt,cl as It,C as Mt,i as Dt,aI as Lt,aJ as kt,aK as Et,cm as Rt,aL as Bt}from"./mui-DUnBgZhO.js";import{r as g}from"./vendor-CjD1bmmO.js";import{u as Ft}from"./notistack.esm-Ca-E78ev.js";import{b as Vt,c as Ot,a as Pt,u as zt,d as Nt,i as _t,j as $t,k as Ut,g as Gt,h as Ht,l as Wt}from"./useStreamlinedData-Cdn-WXx5.js";import{M as q}from"./MetricCard-BiOGvHso.js";import"./UnifiedDataService-D842w1FY.js";import"./index-DF_wOeHE.js";import"./stripe-BqXXkzvQ.js";import"./index.esm-DdZh2hq1.js";import"./index.esm-Dkmm1Qng.js";import"./FirestoreCollectionManager-BhDW-3AF.js";import"./firebase-DioZzF2i.js";import"./index.esm-e-DuI42t.js";const E=class E{static getInstance(){return E.instance||(E.instance=new E),E.instance}async exportTeamMembers(s,e={}){const{includeInactive:i=!1,includePassword:a=!1,includeAuditInfo:n=!1,customFields:r=[]}=e;let d=s;i||(d=s.filter(c=>c.status==="active"));const u=["Email","First Name","Last Name","Role","Status","Department","Position","Phone","License Type","Organization ID","Created At","Last Active"];a&&u.splice(4,0,"Password"),n&&u.push("Created By","Updated At","Updated By"),r.forEach(c=>{u.includes(c)||u.push(c)});const o=d.map(c=>{const x=[c.email||"",c.firstName||"",c.lastName||"",c.role||"",c.status||"",c.department||"",c.position||"",c.phone||"",c.licenseType||"",c.organizationId||"",c.createdAt?new Date(c.createdAt).toISOString():"",c.lastActive?new Date(c.lastActive).toISOString():""];return a&&x.splice(4,0,c.password||""),n&&x.push(c.createdBy||"",c.updatedAt?new Date(c.updatedAt).toISOString():"",c.updatedBy||""),r.forEach(b=>{const S=c[b];x.push(typeof S=="string"?S:S?String(S):"")}),x});return[u.join(","),...o.map(c=>c.map(x=>typeof x=="string"&&x.includes(",")?`"${x.replace(/"/g,'""')}"`:x).join(","))].join(`
`)}async importTeamMembers(s,e,i){const a=s.split(`
`).filter(c=>c.trim());if(a.length<2)return{success:!1,totalRows:0,successfulImports:0,failedImports:0,errors:[{row:0,field:"general",value:"",error:"CSV file is empty or invalid"}],importedMembers:[]};const n=this.parseCSVLine(a[0]),r=a.slice(1),d=[],u=[],p=["Email","First Name","Last Name","Role"].filter(c=>!n.includes(c));if(p.length>0)return{success:!1,totalRows:r.length,successfulImports:0,failedImports:r.length,errors:[{row:0,field:"headers",value:p.join(", "),error:`Missing required headers: ${p.join(", ")}`}],importedMembers:[]};for(let c=0;c<r.length;c++){const x=r[c],b=this.parseCSVLine(x);i&&i(Math.round((c+1)/r.length*100));try{const S=this.validateAndCreateTeamMember(b,n,e,c+2);S&&u.push(S)}catch(S){d.push({row:c+2,field:"general",value:x,error:S instanceof Error?S.message:"Unknown error"})}}return{success:d.length===0,totalRows:r.length,successfulImports:u.length,failedImports:d.length,errors:d,importedMembers:u}}parseCSVLine(s){const e=[];let i="",a=!1;for(let n=0;n<s.length;n++){const r=s[n];r==='"'?a&&s[n+1]==='"'?(i+='"',n++):a=!a:r===","&&!a?(e.push(i.trim()),i=""):i+=r}return e.push(i.trim()),e}validateAndCreateTeamMember(s,e,i,a){var x,b,S,N,U,ee,te,se;const n=[],r={};e.forEach((G,je)=>{r[G.toLowerCase()]=s[je]||""});const d=(x=r.email)==null?void 0:x.trim(),u=(b=r["first name"])==null?void 0:b.trim(),o=(S=r["last name"])==null?void 0:S.trim(),p=(N=r.role)==null?void 0:N.trim();if(d?this.isValidEmail(d)||n.push({row:a,field:"email",value:d,error:"Invalid email format"}):n.push({row:a,field:"email",value:"",error:"Email is required"}),u||n.push({row:a,field:"first name",value:"",error:"First name is required"}),o||n.push({row:a,field:"last name",value:"",error:"Last name is required"}),p?["admin","member","viewer","owner"].includes(p.toLowerCase())||n.push({row:a,field:"role",value:p,error:"Invalid role. Must be admin, member, viewer, or owner"}):n.push({row:a,field:"role",value:"",error:"Role is required"}),n.length>0)throw new Error(`Validation errors: ${n.map(G=>G.error).join(", ")}`);return{id:"",email:d.toLowerCase(),firstName:u,lastName:o,role:p.toLowerCase(),status:"pending",organization:{id:i,name:"",tier:"BASIC"},organizationId:i,department:((U=r.department)==null?void 0:U.trim())||"",position:((ee=r.position)==null?void 0:ee.trim())||"",phone:((te=r.phone)==null?void 0:te.trim())||"",licenseType:((se=r["license type"])==null?void 0:se.trim())||"BASIC",assignedProjects:[],joinedAt:new Date,createdAt:new Date,updatedAt:new Date,lastActive:r["last active"]?new Date(r["last active"]):void 0}}isValidEmail(s){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)}downloadCSV(s,e="team-members.csv"){const i=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),n=URL.createObjectURL(i);a.setAttribute("href",n),a.setAttribute("download",e),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}generateTemplate(){const s=["Email","First Name","Last Name","Role","Status","Department","Position","Phone","License Type"],e=["john.doe@example.com","John","Doe","member","active","Engineering","Software Developer","+1-555-0123","PROFESSIONAL"];return[s.join(","),e.join(",")].join(`
`)}};M(E,"instance");let me=E;const pe=me.getInstance(),R=class R{static getInstance(){return R.instance||(R.instance=new R),R.instance}filterTeamMembers(s,e,i,a){let n=[...s];e.search&&(n=this.applySearchFilter(n,e.search)),e.role&&e.role.length>0&&(n=n.filter(c=>e.role.includes(c.role))),e.status&&e.status.length>0&&(n=n.filter(c=>e.status.includes(c.status))),e.department&&e.department.length>0&&(n=n.filter(c=>c.department&&e.department.includes(c.department))),e.licenseType&&e.licenseType.length>0&&(n=n.filter(c=>c.licenseType&&e.licenseType.includes(c.licenseType))),e.dateRange&&(n=this.applyDateRangeFilter(n,e.dateRange)),e.hasLicense!==void 0&&(n=n.filter(c=>e.hasLicense?!!c.licenseType:!c.licenseType)),e.isActive!==void 0&&(n=n.filter(c=>e.isActive?c.status==="active":c.status!=="active")),e.customFields&&(n=this.applyCustomFieldFilters(n,e.customFields)),i&&(n=this.applySorting(n,i));const r=s.length,d=n.length;let u=n,o=!1,p={currentPage:1,totalPages:1,pageSize:d,totalItems:d};if(a){const c=(a.page-1)*a.pageSize,x=c+a.pageSize;u=n.slice(c,x),o=x<d,p={currentPage:a.page,totalPages:Math.ceil(d/a.pageSize),pageSize:a.pageSize,totalItems:d}}return{filteredMembers:u,totalCount:r,filteredCount:d,hasMore:o,pageInfo:p}}applySearchFilter(s,e){const i=e.toLowerCase();return s.filter(a=>[a.email,a.firstName,a.lastName,a.department,a.position,a.phone,a.role,a.status,a.licenseType].some(r=>r&&r.toLowerCase().includes(i)))}applyDateRangeFilter(s,e){return e?s.filter(i=>{const a=i[e.field];if(!a)return!1;const n=new Date(a),r=e.start?new Date(e.start):null,d=e.end?new Date(e.end):null;return!(r&&n<r||d&&n>d)}):s}applyCustomFieldFilters(s,e){return s.filter(i=>Object.entries(e).every(([a,n])=>{const r=i[a];return n==null?r===n:typeof n=="string"?r&&String(r).toLowerCase().includes(n.toLowerCase()):r===n}))}applySorting(s,e){return s.sort((i,a)=>{const n=i[e.field],r=a[e.field];if(n===void 0&&r===void 0)return 0;if(n===void 0)return e.direction==="asc"?1:-1;if(r===void 0)return e.direction==="asc"?-1:1;let d=0;return typeof n=="string"&&typeof r=="string"?d=n.localeCompare(r):n instanceof Date&&r instanceof Date?d=n.getTime()-r.getTime():typeof n=="number"&&typeof r=="number"?d=n-r:d=String(n).localeCompare(String(r)),e.direction==="asc"?d:-d})}getFilterOptions(s){const e=[...new Set(s.map(r=>r.role))].sort(),i=[...new Set(s.map(r=>r.status))].sort(),a=[...new Set(s.map(r=>r.department).filter(Boolean))].sort(),n=[...new Set(s.map(r=>r.licenseType).filter(Boolean))].sort();return{roles:e,statuses:i,departments:a,licenseTypes:n,totalMembers:s.length,activeMembers:s.filter(r=>r.status==="active").length,pendingMembers:s.filter(r=>r.status==="pending").length,licensedMembers:s.filter(r=>r.licenseType).length}}getQuickFilters(){return{all:{label:"All Members",criteria:{}},active:{label:"Active Members",criteria:{isActive:!0}},pending:{label:"Pending Invites",criteria:{status:["pending"]}},admins:{label:"Administrators",criteria:{role:["admin","owner"]}},licensed:{label:"Licensed Members",criteria:{hasLicense:!0}},recent:{label:"Recently Added",criteria:{dateRange:{field:"createdAt",start:new Date(Date.now()-30*24*60*60*1e3)}}}}}};M(R,"instance");let ge=R;const Qt=ge.getInstance(),B=class B{static getInstance(){return B.instance||(B.instance=new B),B.instance}generateAnalytics(s){return{overview:this.calculateOverviewStats(s),trends:this.calculateTrends(s),departmentBreakdown:this.calculateDepartmentStats(s),roleDistribution:this.calculateRoleDistribution(s),licenseUtilization:this.calculateLicenseStats(s),activityMetrics:this.calculateActivityMetrics(s),growthMetrics:this.calculateGrowthMetrics(s),topPerformers:this.identifyTopPerformers(s),recommendations:this.generateRecommendations(s)}}calculateOverviewStats(s){const e=s.length,i=s.filter(c=>c.status==="active").length,a=s.filter(c=>c.status==="pending").length,n=s.filter(c=>c.status==="suspended").length,r=s.filter(c=>c.licenseType&&c.licenseType!=="BASIC").length,d=e-r,u=s.map(c=>this.calculateActivityScore(c)),o=u.reduce((c,x)=>c+x,0)/u.length,p=this.calculateRetentionRate(s);return{totalMembers:e,activeMembers:i,pendingMembers:a,suspendedMembers:n,licensedMembers:r,unlicensedMembers:d,averageActivityScore:Math.round(o*100)/100,memberRetentionRate:Math.round(p*100)/100}}calculateTrends(s){const e=[],i=new Date;for(let a=11;a>=0;a--){const n=new Date(i.getFullYear(),i.getMonth()-a,1),r=new Date(i.getFullYear(),i.getMonth()-a+1,1),d=s.filter(p=>{const c=new Date(p.createdAt);return c>=n&&c<r}),u=s.filter(p=>{const c=p.lastActive?new Date(p.lastActive):null;return c&&c>=n&&c<r}),o=s.filter(p=>p.licenseType&&p.licenseType!=="BASIC"&&new Date(p.createdAt)<=r);e.push({period:n.toLocaleDateString("en-US",{month:"short",year:"numeric"}),membersAdded:d.length,membersRemoved:0,netGrowth:d.length,activeMembers:u.length,licenseUtilization:o.length})}return e}calculateDepartmentStats(s){const e=new Map;return s.forEach(i=>{const a=i.department||"Unassigned";e.has(a)||e.set(a,[]),e.get(a).push(i)}),Array.from(e.entries()).map(([i,a])=>{const n=a.filter(o=>o.status==="active").length,r=a.map(o=>this.calculateActivityScore(o)),d=r.reduce((o,p)=>o+p,0)/r.length,u=a.filter(o=>o.licenseType&&o.licenseType!=="BASIC").length;return{department:i,memberCount:a.length,activeMembers:n,averageActivityScore:Math.round(d*100)/100,licenseUtilization:Math.round(u/a.length*100),growthRate:0}}).sort((i,a)=>a.memberCount-i.memberCount)}calculateRoleDistribution(s){const e=new Map;s.forEach(a=>{e.has(a.role)||e.set(a.role,[]),e.get(a.role).push(a)});const i=s.length;return Array.from(e.entries()).map(([a,n])=>{const r=n.map(o=>this.calculateActivityScore(o)),d=r.reduce((o,p)=>o+p,0)/r.length,u=n.filter(o=>o.licenseType&&o.licenseType!=="BASIC").length;return{role:a,count:n.length,percentage:Math.round(n.length/i*100),averageActivityScore:Math.round(d*100)/100,licenseUtilization:Math.round(u/n.length*100)}}).sort((a,n)=>n.count-a.count)}calculateLicenseStats(s){const e=s.length,i=s.filter(d=>d.licenseType&&d.licenseType!=="BASIC").length,a=e-i,n=Math.round(i/e*100),r={};return s.forEach(d=>{d.licenseType&&(r[d.licenseType]=(r[d.licenseType]||0)+1)}),{totalLicenses:e,assignedLicenses:i,availableLicenses:a,utilizationRate:n,byType:r,projectedNeeds:Math.max(0,Math.ceil(e*.1))}}calculateActivityMetrics(s){const i=s.filter(o=>o.lastActive).map(o=>new Date(o.lastActive)),a=i.length>0?new Date(i.reduce((o,p)=>o+p.getTime(),0)/i.length):new Date,n=s.map(o=>({member:o,score:this.calculateActivityScore(o)})),r=n.sort((o,p)=>p.score-o.score).slice(0,5).map(o=>`${o.member.firstName} ${o.member.lastName}`),d=n.filter(o=>o.score<.3).map(o=>`${o.member.firstName} ${o.member.lastName}`),u={"High (0.8-1.0)":n.filter(o=>o.score>=.8).length,"Medium (0.5-0.8)":n.filter(o=>o.score>=.5&&o.score<.8).length,"Low (0.3-0.5)":n.filter(o=>o.score>=.3&&o.score<.5).length,"Inactive (0.0-0.3)":n.filter(o=>o.score<.3).length};return{averageLastActive:a,mostActiveMembers:r,inactiveMembers:d,activityScoreDistribution:u}}calculateGrowthMetrics(s){const e=new Date,i=new Date(e.getTime()-30*24*60*60*1e3);new Date(e.getTime()-90*24*60*60*1e3),new Date(e.getTime()-365*24*60*60*1e3);const a=s.filter(d=>new Date(d.createdAt)>=i).length,n=s.filter(d=>{const u=new Date(d.createdAt);return u>=new Date(i.getTime()-30*24*60*60*1e3)&&u<i}).length,r=n>0?(a-n)/n*100:0;return{monthlyGrowthRate:Math.round(r*100)/100,quarterlyGrowthRate:0,yearlyGrowthRate:0,projectedGrowth:Math.round(s.length*(r/100)),churnRate:0}}identifyTopPerformers(s){return s.map(e=>({memberId:e.id,name:`${e.firstName} ${e.lastName}`,email:e.email,score:this.calculateActivityScore(e),metrics:{activityScore:this.calculateActivityScore(e),projectCount:0,licenseUtilization:e.licenseType&&e.licenseType!=="BASIC"?1:0}})).sort((e,i)=>i.score-e.score).slice(0,10)}generateRecommendations(s){const e=[],i=this.calculateOverviewStats(s),a=Math.round(i.licensedMembers/i.totalMembers*100);return a<50&&e.push({type:"license",priority:"high",title:"Low License Utilization",description:`Only ${a}% of team members have licenses assigned.`,action:"Review license assignments and consider upgrading more members.",impact:"Improved productivity and feature access for team members."}),i.averageActivityScore<.5&&e.push({type:"activity",priority:"medium",title:"Low Team Activity",description:`Average activity score is ${i.averageActivityScore.toFixed(2)}.`,action:"Engage with inactive members and provide training.",impact:"Increased team engagement and productivity."}),i.totalMembers<10&&e.push({type:"growth",priority:"low",title:"Small Team Size",description:`Team has ${i.totalMembers} members. Consider expanding.`,action:"Invite more team members to scale operations.",impact:"Better resource distribution and team resilience."}),e}calculateActivityScore(s){let e=0;if(s.status==="active"&&(e+=.3),s.lastActive){const i=(Date.now()-new Date(s.lastActive).getTime())/864e5;i<7?e+=.4:i<30?e+=.2:i<90&&(e+=.1)}return s.licenseType&&s.licenseType!=="BASIC"&&(e+=.2),s.department&&s.position&&(e+=.1),Math.min(e,1)}calculateRetentionRate(s){const e=s.filter(a=>a.status==="active").length,i=s.length;return i>0?e/i:0}};M(B,"instance");let fe=B;const Jt=fe.getInstance(),F=class F{constructor(){M(this,"auditLogs",[])}static getInstance(){return F.instance||(F.instance=new F),F.instance}logAction(s,e,i,a,n,r,d,u){const o={id:this.generateAuditId(),timestamp:new Date,action:s,actorId:e,actorEmail:i,targetMemberId:a,targetMemberEmail:n,changes:r,metadata:{...d,additionalContext:{...d.additionalContext,...u}}};this.auditLogs.push(o),console.log("ðŸ” [Audit] Team member action logged:",o)}logMemberCreation(s,e,i,a){const n=[{field:"email",oldValue:null,newValue:i.email,changeType:"added"},{field:"firstName",oldValue:null,newValue:i.firstName,changeType:"added"},{field:"lastName",oldValue:null,newValue:i.lastName,changeType:"added"},{field:"role",oldValue:null,newValue:i.role,changeType:"added"},{field:"status",oldValue:null,newValue:i.status,changeType:"added"}];this.logAction("member_created",s,e,i.id,i.email,n,a)}logMemberUpdate(s,e,i,a,n,r,d){const u=[];["firstName","lastName","email","role","status","department","position","phone","licenseType"].forEach(p=>{const c=n[p],x=r[p];c!==x&&u.push({field:p,oldValue:c,newValue:x,changeType:c===void 0?"added":x===void 0?"removed":"modified"})}),u.length>0&&this.logAction("member_updated",s,e,i,a,u,d)}logMemberDeletion(s,e,i,a){const n=[{field:"status",oldValue:i.status,newValue:"deleted",changeType:"modified"}];this.logAction("member_deleted",s,e,i.id,i.email,n,a)}logPasswordReset(s,e,i,a,n){const r=[{field:"password",oldValue:"[REDACTED]",newValue:"[RESET]",changeType:"modified"}];this.logAction("member_password_reset",s,e,i,a,r,n)}logLicenseAssignment(s,e,i,a,n,r,d){const u=[{field:"licenseType",oldValue:n||"BASIC",newValue:r,changeType:"modified"}];this.logAction("member_license_assigned",s,e,i,a,u,d)}logBulkOperation(s,e,i,a,n,r){const d=[{field:"bulk_operation",oldValue:null,newValue:i,changeType:"added"},{field:"affected_members",oldValue:null,newValue:a.length,changeType:"added"},...n];this.logAction("bulk_operation",s,e,a[0]||"multiple","multiple",d,r)}queryAuditLogs(s){let e=[...this.auditLogs];return s.memberId&&(e=e.filter(i=>i.targetMemberId===s.memberId)),s.actorId&&(e=e.filter(i=>i.actorId===s.actorId)),s.action&&(e=e.filter(i=>i.action===s.action)),s.startDate&&(e=e.filter(i=>i.timestamp>=s.startDate)),s.endDate&&(e=e.filter(i=>i.timestamp<=s.endDate)),s.organizationId&&(e=e.filter(i=>i.metadata.organizationId===s.organizationId)),e.sort((i,a)=>a.timestamp.getTime()-i.timestamp.getTime()),s.offset&&(e=e.slice(s.offset)),s.limit&&(e=e.slice(0,s.limit)),e}getAuditSummary(s,e=30){const i=new Date(Date.now()-e*24*60*60*1e3),a=this.auditLogs.filter(o=>o.metadata.organizationId===s&&o.timestamp>=i),n={};a.forEach(o=>{n[o.action]=(n[o.action]||0)+1});const r={};a.forEach(o=>{r[o.actorId]||(r[o.actorId]={actorEmail:o.actorEmail,count:0}),r[o.actorId].count++});const d=Object.entries(r).map(([o,p])=>({actorId:o,actorEmail:p.actorEmail,actionCount:p.count})).sort((o,p)=>p.actionCount-o.actionCount).slice(0,5),u=this.calculateComplianceScore(a);return{totalActions:a.length,actionsByType:n,recentActivity:a.slice(0,10),topActors:d,complianceScore:u}}calculateComplianceScore(s){if(s.length===0)return 100;let e=100;const i=s.filter(n=>n.action==="member_deleted"||n.action==="member_suspended"||n.action==="member_password_reset");e-=i.length*5;const a=s.filter(n=>n.action==="bulk_operation");return e-=a.length*2,Math.max(0,e)}generateAuditId(){return`audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}exportAuditLogs(s){const e=this.queryAuditLogs(s),i=["Timestamp","Action","Actor ID","Actor Email","Target Member ID","Target Member Email","Changes","Organization ID"],a=e.map(r=>[r.timestamp.toISOString(),r.action,r.actorId,r.actorEmail,r.targetMemberId,r.targetMemberEmail,JSON.stringify(r.changes),r.metadata.organizationId]);return[i.join(","),...a.map(r=>r.map(d=>typeof d=="string"&&d.includes(",")?`"${d.replace(/"/g,'""')}"`:d).join(","))].join(`
`)}};M(F,"instance");let xe=F;const Yt=xe.getInstance(),L=class L{constructor(){M(this,"templates",[]);M(this,"bulkOperations",[])}static getInstance(){return L.instance||(L.instance=new L,L.instance.initializeDefaultTemplates()),L.instance}initializeDefaultTemplates(){this.templates=[{id:"executive_admin",name:"Executive Administrator",description:"Full administrative access with all permissions",category:"executive",industry:["all"],role:"admin",permissions:["manage_team","manage_licenses","manage_projects","view_analytics","manage_organization","audit_access"],defaultSettings:{department:"Executive",position:"Administrator",licenseType:"ENTERPRISE",status:"active"},isDefault:!0,isCustom:!1,createdAt:new Date,updatedAt:new Date},{id:"project_manager",name:"Project Manager",description:"Project management role with team coordination permissions",category:"management",industry:["all"],role:"member",permissions:["manage_projects","assign_team_members","view_analytics","manage_tasks"],defaultSettings:{department:"Project Management",position:"Project Manager",licenseType:"PROFESSIONAL",status:"active"},isDefault:!0,isCustom:!1,createdAt:new Date,updatedAt:new Date},{id:"software_developer",name:"Software Developer",description:"Technical role for software development teams",category:"technical",industry:["technology","software","it"],role:"member",permissions:["access_projects","manage_tasks","view_documentation"],defaultSettings:{department:"Engineering",position:"Software Developer",licenseType:"PROFESSIONAL",status:"active"},isDefault:!0,isCustom:!1,createdAt:new Date,updatedAt:new Date},{id:"creative_director",name:"Creative Director",description:"Creative leadership role for design and content teams",category:"creative",industry:["media","advertising","design","entertainment"],role:"member",permissions:["manage_creative_projects","approve_content","manage_assets","view_analytics"],defaultSettings:{department:"Creative",position:"Creative Director",licenseType:"PROFESSIONAL",status:"active"},isDefault:!0,isCustom:!1,createdAt:new Date,updatedAt:new Date},{id:"sales_representative",name:"Sales Representative",description:"Sales role with client management permissions",category:"sales",industry:["all"],role:"member",permissions:["manage_clients","view_sales_analytics","manage_opportunities"],defaultSettings:{department:"Sales",position:"Sales Representative",licenseType:"BASIC",status:"active"},isDefault:!0,isCustom:!1,createdAt:new Date,updatedAt:new Date},{id:"support_specialist",name:"Support Specialist",description:"Customer support role with limited access",category:"support",industry:["all"],role:"viewer",permissions:["view_tickets","manage_support_cases","view_documentation"],defaultSettings:{department:"Support",position:"Support Specialist",licenseType:"BASIC",status:"active"},isDefault:!0,isCustom:!1,createdAt:new Date,updatedAt:new Date}]}getTemplates(s,e){let i=[...this.templates];return s&&(i=i.filter(a=>a.category===s)),e&&(i=i.filter(a=>a.industry.includes("all")||a.industry.includes(e))),i.sort((a,n)=>a.name.localeCompare(n.name))}getTemplate(s){return this.templates.find(e=>e.id===s)}createTemplate(s,e){const i={...s,id:`custom_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,isDefault:!1,isCustom:!0,createdBy:e,createdAt:new Date,updatedAt:new Date};return this.templates.push(i),i}updateTemplate(s,e){const i=this.templates.findIndex(a=>a.id===s);return i===-1?!1:(this.templates[i]={...this.templates[i],...e,updatedAt:new Date},!0)}deleteTemplate(s){const e=this.templates.findIndex(i=>i.id===s);return e===-1||this.templates[e].isDefault?!1:(this.templates.splice(e,1),!0)}createMemberFromTemplate(s,e,i){const a=this.getTemplate(s);if(!a)throw new Error("Template not found");return{id:"",email:e.email||"",firstName:e.firstName||"",lastName:e.lastName||"",role:a.role,status:a.defaultSettings.status,organization:{id:i,name:"",tier:"BASIC"},organizationId:i,department:a.defaultSettings.department||e.department||"",position:a.defaultSettings.position||e.position||"",phone:e.phone||"",licenseType:a.defaultSettings.licenseType,assignedProjects:[],joinedAt:new Date,createdAt:new Date,updatedAt:new Date,...e,...a.defaultSettings.customFields}}createBulkOperation(s,e,i,a,n,r){const d={id:`bulk_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:s,description:e,operation:i,template:r?this.getTemplate(r):void 0,criteria:a,affectedMembers:[],status:"pending",progress:0,results:{totalProcessed:0,successful:0,failed:0,errors:[],details:{}},createdBy:n,createdAt:new Date};return this.bulkOperations.push(d),d}async executeBulkOperation(s,e,i){const a=this.bulkOperations.find(d=>d.id===s);if(!a)throw new Error("Bulk operation not found");a.status="running",a.progress=0;const n={totalProcessed:0,successful:0,failed:0,errors:[],details:{}},r=this.filterMembersByCriteria(e,a.criteria);a.affectedMembers=r.map(d=>d.id),n.totalProcessed=r.length;for(let d=0;d<r.length;d++){const u=r[d];try{switch(a.operation){case"create":n.details[u.id]="Created successfully",n.successful++;break;case"update":n.details[u.id]="Updated successfully",n.successful++;break;case"delete":n.details[u.id]="Deleted successfully",n.successful++;break;case"assign_license":n.details[u.id]="License assigned successfully",n.successful++;break;case"change_role":n.details[u.id]="Role changed successfully",n.successful++;break}}catch(o){n.failed++,n.errors.push({memberId:u.id,error:o instanceof Error?o.message:"Unknown error"}),n.details[u.id]="Failed"}a.progress=Math.round((d+1)/r.length*100),i&&i(a.progress)}return a.results=n,a.status=n.failed===0?"completed":"failed",a.completedAt=new Date,n}filterMembersByCriteria(s,e){let i=[...s];return e.memberIds&&e.memberIds.length>0&&(i=i.filter(a=>e.memberIds.includes(a.id))),e.roles&&e.roles.length>0&&(i=i.filter(a=>e.roles.includes(a.role))),e.departments&&e.departments.length>0&&(i=i.filter(a=>a.department&&e.departments.includes(a.department))),e.statuses&&e.statuses.length>0&&(i=i.filter(a=>e.statuses.includes(a.status))),e.licenseTypes&&e.licenseTypes.length>0&&(i=i.filter(a=>a.licenseType&&e.licenseTypes.includes(a.licenseType))),i}getBulkOperations(s){let e=[...this.bulkOperations];return s&&(e=e.filter(i=>i.createdBy===s)),e.sort((i,a)=>a.createdAt.getTime()-i.createdAt.getTime())}getBulkOperation(s){return this.bulkOperations.find(e=>e.id===s)}getCategories(){return["executive","management","technical","creative","support","sales","marketing","operations","custom"]}getIndustries(){return["technology","software","it","media","advertising","design","entertainment","finance","healthcare","education","retail","manufacturing","consulting","nonprofit","government","all"]}};M(L,"instance");let ve=L;const he=ve.getInstance();function $(f){const{children:s,value:e,index:i,...a}=f;return t.jsx("div",{role:"tabpanel",hidden:e!==i,id:`team-tabpanel-${i}`,"aria-labelledby":`team-tab-${i}`,...a,children:e===i&&t.jsx(w,{sx:{p:3},children:s})})}const fs=()=>{var Ce,be;const{enqueueSnackbar:f}=Ft(),[s,e]=g.useState(0),[i,a]=g.useState([]),[n,r]=g.useState({}),[d,u]=g.useState({field:"createdAt",direction:"desc"}),[o,p]=g.useState({page:1,pageSize:25}),[c,x]=g.useState("table"),[b,S]=g.useState(""),[N,U]=g.useState(!1),[ee,te]=g.useState(!1),[se,G]=g.useState(!1),[je,Kt]=g.useState(!1),[Xt,Zt]=g.useState(!1),[Ee,ae]=g.useState(!1),[qt,es]=g.useState(!1),[Re,Be]=g.useState(null),[ye,Fe]=g.useState([]),[Ve,Oe]=g.useState([]),[we,Pe]=g.useState([]),[V,ze]=g.useState(null),[ts,H]=g.useState(!1),{loading:Ne,error:Se}=Vt(),{data:A,loading:_e,error:Ae}=Ot(),{data:v,loading:$e,error:Te,refetch:W}=Pt(),{data:Q}=zt();Nt(),_t(),$t(),Ut(),Gt(),Ht(),Wt();const O=g.useMemo(()=>{if(!v)return[];const l={...n,search:b||void 0};return Qt.filterTeamMembers(v,l,d,o).filteredMembers},[v,n,b,d,o]),J=g.useMemo(()=>{if(!v)return{totalMembers:0,activeMembers:0,pendingInvites:0,availableLicenses:0,totalLicenses:0,assignedLicenses:0};const l=v.length,m=v.filter(P=>P.status==="active").length,j=v.filter(P=>P.status==="pending").length,C=v.filter(P=>P.licenseType&&P.licenseType!=="BASIC").length,ie=(Q==null?void 0:Q.length)||0,et=ie-C;return{totalMembers:l,activeMembers:m,pendingInvites:j,availableLicenses:et,totalLicenses:ie,assignedLicenses:C}},[v,Q]),Ue=g.useCallback(async()=>{if(v){H(!0);try{const l=Jt.generateAnalytics(v);Be(l)}catch(l){console.error("Failed to load analytics:",l),f("Failed to load analytics",{variant:"error"})}finally{H(!1)}}},[v,f]),Ge=g.useCallback(async()=>{var l;if((l=A==null?void 0:A.organization)!=null&&l.id){H(!0);try{const m={organizationId:A.organization.id,limit:100},j=Yt.queryAuditLogs(m);Fe(j)}catch(m){console.error("Failed to load audit logs:",m),f("Failed to load audit logs",{variant:"error"})}finally{H(!1)}}},[(Ce=A==null?void 0:A.organization)==null?void 0:Ce.id,f]),He=g.useCallback(async()=>{try{const l=he.getTemplates();Oe(l)}catch(l){console.error("Failed to load templates:",l),f("Failed to load templates",{variant:"error"})}},[f]),We=g.useCallback(async()=>{try{const l=he.getBulkOperations();Pe(l)}catch(l){console.error("Failed to load bulk operations:",l),f("Failed to load bulk operations",{variant:"error"})}},[f]),Qe=g.useCallback(async()=>{if(v)try{const l=await pe.exportTeamMembers(v,{includeInactive:!0,includeAuditInfo:!0});pe.downloadCSV(l,`team-members-${new Date().toISOString().split("T")[0]}.csv`),f("Team members exported successfully",{variant:"success"})}catch(l){console.error("Failed to export CSV:",l),f("Failed to export CSV",{variant:"error"})}},[v,f]),Je=g.useCallback(async l=>{var m;if((m=A==null?void 0:A.organization)!=null&&m.id)try{const j=await l.text(),C=await pe.importTeamMembers(j,A.organization.id,ie=>{});ze(C),C.success?(f(`Successfully imported ${C.successfulImports} team members`,{variant:"success"}),W()):f(`Import completed with ${C.failedImports} errors`,{variant:"warning"})}catch(j){console.error("Failed to import CSV:",j),f("Failed to import CSV",{variant:"error"})}},[(be=A==null?void 0:A.organization)==null?void 0:be.id,f,W]),Ye=g.useCallback(async l=>{if(v)try{const m=await he.executeBulkOperation(l.id,v,j=>{});f(`Bulk operation completed: ${m.successful} successful, ${m.failed} failed`,{variant:"success"}),W()}catch(m){console.error("Failed to execute bulk operation:",m),f("Failed to execute bulk operation",{variant:"error"})}},[v,f,W]),Ke=(l,m)=>{switch(e(m),m){case 1:Ue();break;case 2:Ge();break;case 3:He();break;case 4:We();break}},Xe=(l,m)=>{a(m?j=>[...j,l]:j=>j.filter(C=>C!==l))},Ze=l=>{a(l?O.map(m=>m.id):[])},Y=l=>{r(l),p(m=>({...m,page:1}))},qe=l=>{p(l)};return Ne||_e||$e?t.jsxs(w,{sx:{p:3},children:[t.jsx(y,{variant:"h4",gutterBottom:!0,children:"Team Management"}),t.jsx(T,{container:!0,spacing:3,children:[1,2,3,4].map(l=>t.jsx(T,{item:!0,xs:12,sm:6,md:3,children:t.jsx(at,{variant:"rectangular",height:120})},l))})]}):Se||Ae||Te?t.jsx(w,{sx:{p:3},children:t.jsxs(Ie,{severity:"error",children:[t.jsx(Me,{children:"Error Loading Team Data"}),Se||Ae||Te||"Unknown error occurred"]})}):t.jsxs(w,{sx:{p:3},children:[t.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsx(y,{variant:"h4",component:"h1",children:"Team Management"}),t.jsxs(w,{sx:{display:"flex",gap:1},children:[t.jsx(k,{variant:"outlined",startIcon:t.jsx(it,{}),onClick:Qe,children:"Export CSV"}),t.jsx(k,{variant:"outlined",startIcon:t.jsx(nt,{}),onClick:()=>ae(!0),children:"Import CSV"}),t.jsx(k,{variant:"contained",startIcon:t.jsx(rt,{}),onClick:()=>{},children:"Invite Member"})]})]}),t.jsxs(T,{container:!0,spacing:3,sx:{mb:3},children:[t.jsx(T,{item:!0,xs:12,sm:6,md:3,children:t.jsx(q,{title:"Total Members",value:J.totalMembers,icon:t.jsx(De,{}),color:"primary"})}),t.jsx(T,{item:!0,xs:12,sm:6,md:3,children:t.jsx(q,{title:"Active Members",value:J.activeMembers,icon:t.jsx(lt,{}),color:"success"})}),t.jsx(T,{item:!0,xs:12,sm:6,md:3,children:t.jsx(q,{title:"Pending Invites",value:J.pendingInvites,icon:t.jsx(ot,{}),color:"warning"})}),t.jsx(T,{item:!0,xs:12,sm:6,md:3,children:t.jsx(q,{title:"Available Licenses",value:J.availableLicenses,icon:t.jsx(ct,{}),color:"primary"})})]}),t.jsxs(ne,{children:[t.jsx(w,{sx:{borderBottom:1,borderColor:"divider"},children:t.jsxs(dt,{value:s,onChange:Ke,"aria-label":"team management tabs",children:[t.jsx(_,{label:"Team Members",icon:t.jsx(De,{})}),t.jsx(_,{label:"Analytics",icon:t.jsx(ut,{})}),t.jsx(_,{label:"Audit Trail",icon:t.jsx(pt,{})}),t.jsx(_,{label:"Templates",icon:t.jsx(ht,{})}),t.jsx(_,{label:"Bulk Operations",icon:t.jsx(mt,{})})]})}),t.jsxs($,{value:s,index:0,children:[t.jsxs(w,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[t.jsx(gt,{fullWidth:!0,placeholder:"Search team members...",value:b,onChange:l=>S(l.target.value),InputProps:{startAdornment:t.jsx(ft,{position:"start",children:t.jsx(xt,{})})}}),t.jsx(k,{variant:"outlined",startIcon:t.jsx(vt,{}),onClick:()=>U(!N),children:"Filters"}),t.jsxs(jt,{value:c,exclusive:!0,onChange:(l,m)=>m&&x(m),size:"small",children:[t.jsx(re,{value:"table",children:t.jsx(yt,{})}),t.jsx(re,{value:"grid",children:t.jsx(wt,{})}),t.jsx(re,{value:"list",children:t.jsx(St,{})})]})]}),N&&t.jsxs(ne,{sx:{mb:3},children:[t.jsx(At,{title:"Advanced Filters"}),t.jsx(Le,{children:t.jsxs(T,{container:!0,spacing:2,children:[t.jsx(T,{item:!0,xs:12,sm:6,md:3,children:t.jsxs(K,{fullWidth:!0,children:[t.jsx(X,{children:"Role"}),t.jsxs(Z,{multiple:!0,value:n.role||[],onChange:l=>Y({...n,role:l.target.value}),children:[t.jsx(I,{value:"admin",children:"Admin"}),t.jsx(I,{value:"member",children:"Member"}),t.jsx(I,{value:"viewer",children:"Viewer"}),t.jsx(I,{value:"owner",children:"Owner"})]})]})}),t.jsx(T,{item:!0,xs:12,sm:6,md:3,children:t.jsxs(K,{fullWidth:!0,children:[t.jsx(X,{children:"Status"}),t.jsxs(Z,{multiple:!0,value:n.status||[],onChange:l=>Y({...n,status:l.target.value}),children:[t.jsx(I,{value:"active",children:"Active"}),t.jsx(I,{value:"pending",children:"Pending"}),t.jsx(I,{value:"suspended",children:"Suspended"})]})]})}),t.jsx(T,{item:!0,xs:12,sm:6,md:3,children:t.jsxs(K,{fullWidth:!0,children:[t.jsx(X,{children:"Department"}),t.jsx(Z,{multiple:!0,value:n.department||[],onChange:l=>Y({...n,department:l.target.value})})]})}),t.jsx(T,{item:!0,xs:12,sm:6,md:3,children:t.jsxs(K,{fullWidth:!0,children:[t.jsx(X,{children:"License Type"}),t.jsxs(Z,{multiple:!0,value:n.licenseType||[],onChange:l=>Y({...n,licenseType:l.target.value}),children:[t.jsx(I,{value:"BASIC",children:"Basic"}),t.jsx(I,{value:"PROFESSIONAL",children:"Professional"}),t.jsx(I,{value:"ENTERPRISE",children:"Enterprise"})]})]})})]})})]}),t.jsx(le,{component:oe,children:t.jsxs(ce,{children:[t.jsx(de,{children:t.jsxs(z,{children:[t.jsx(h,{padding:"checkbox",children:t.jsx(ke,{indeterminate:i.length>0&&i.length<O.length,checked:O.length>0&&i.length===O.length,onChange:l=>Ze(l.target.checked)})}),t.jsx(h,{children:"Member"}),t.jsx(h,{children:"Role"}),t.jsx(h,{children:"Status"}),t.jsx(h,{children:"Department"}),t.jsx(h,{children:"License"}),t.jsx(h,{children:"Last Active"}),t.jsx(h,{children:"Actions"})]})}),t.jsx(ue,{children:O.map(l=>{var m,j;return t.jsxs(z,{children:[t.jsx(h,{padding:"checkbox",children:t.jsx(ke,{checked:i.includes(l.id),onChange:C=>Xe(l.id,C.target.checked)})}),t.jsx(h,{children:t.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:2},children:[t.jsxs(Tt,{children:[(m=l.firstName)==null?void 0:m[0],(j=l.lastName)==null?void 0:j[0]]}),t.jsxs(w,{children:[t.jsxs(y,{variant:"subtitle2",children:[l.firstName," ",l.lastName]}),t.jsx(y,{variant:"body2",color:"text.secondary",children:l.email})]})]})}),t.jsx(h,{children:t.jsx(D,{label:l.role,color:l.role==="admin"?"primary":"default",size:"small"})}),t.jsx(h,{children:t.jsx(D,{label:l.status,color:l.status==="active"?"success":"default",size:"small"})}),t.jsx(h,{children:l.department||"-"}),t.jsx(h,{children:l.licenseType?t.jsx(D,{label:l.licenseType,color:"info",size:"small"}):"-"}),t.jsx(h,{children:l.lastActive?new Date(l.lastActive).toLocaleDateString():"-"}),t.jsx(h,{children:t.jsx(Ct,{size:"small",children:t.jsx(bt,{})})})]},l.id)})})]})}),t.jsx(w,{sx:{display:"flex",justifyContent:"center",mt:3},children:t.jsx(It,{count:Math.ceil(O.length/o.pageSize),page:o.page,onChange:(l,m)=>qe({...o,page:m}),color:"primary"})})]}),t.jsx($,{value:s,index:1,children:Re?t.jsxs(w,{children:[t.jsx(y,{variant:"h5",gutterBottom:!0,children:"Team Analytics"}),t.jsx(y,{children:"Analytics dashboard coming soon..."})]}):t.jsxs(w,{sx:{textAlign:"center",py:4},children:[t.jsx(Mt,{}),t.jsx(y,{variant:"body1",sx:{mt:2},children:"Loading analytics..."})]})}),t.jsxs($,{value:s,index:2,children:[t.jsx(y,{variant:"h5",gutterBottom:!0,children:"Audit Trail"}),ye.length>0?t.jsx(le,{component:oe,children:t.jsxs(ce,{children:[t.jsx(de,{children:t.jsxs(z,{children:[t.jsx(h,{children:"Timestamp"}),t.jsx(h,{children:"Action"}),t.jsx(h,{children:"Actor"}),t.jsx(h,{children:"Target"}),t.jsx(h,{children:"Changes"})]})}),t.jsx(ue,{children:ye.map(l=>t.jsxs(z,{children:[t.jsx(h,{children:l.timestamp.toLocaleString()}),t.jsx(h,{children:t.jsx(D,{label:l.action,size:"small"})}),t.jsx(h,{children:l.actorEmail}),t.jsx(h,{children:l.targetMemberEmail}),t.jsxs(h,{children:[l.changes.length," changes"]})]},l.id))})]})}):t.jsx(y,{children:"No audit logs found."})]}),t.jsxs($,{value:s,index:3,children:[t.jsx(y,{variant:"h5",gutterBottom:!0,children:"Team Member Templates"}),t.jsx(T,{container:!0,spacing:2,children:Ve.map(l=>t.jsx(T,{item:!0,xs:12,sm:6,md:4,children:t.jsx(ne,{children:t.jsxs(Le,{children:[t.jsx(y,{variant:"h6",children:l.name}),t.jsx(y,{variant:"body2",color:"text.secondary",children:l.description}),t.jsxs(w,{sx:{mt:2},children:[t.jsx(D,{label:l.role,size:"small"}),t.jsx(D,{label:l.category,size:"small",sx:{ml:1}})]})]})})},l.id))})]}),t.jsxs($,{value:s,index:4,children:[t.jsx(y,{variant:"h5",gutterBottom:!0,children:"Bulk Operations"}),we.length>0?t.jsx(le,{component:oe,children:t.jsxs(ce,{children:[t.jsx(de,{children:t.jsxs(z,{children:[t.jsx(h,{children:"Name"}),t.jsx(h,{children:"Operation"}),t.jsx(h,{children:"Status"}),t.jsx(h,{children:"Progress"}),t.jsx(h,{children:"Created"}),t.jsx(h,{children:"Actions"})]})}),t.jsx(ue,{children:we.map(l=>t.jsxs(z,{children:[t.jsx(h,{children:l.name}),t.jsx(h,{children:t.jsx(D,{label:l.operation,size:"small"})}),t.jsx(h,{children:t.jsx(D,{label:l.status,color:l.status==="completed"?"success":"default",size:"small"})}),t.jsx(h,{children:t.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(Dt,{variant:"determinate",value:l.progress,sx:{width:100}}),t.jsxs(y,{variant:"body2",children:[l.progress,"%"]})]})}),t.jsx(h,{children:l.createdAt.toLocaleDateString()}),t.jsx(h,{children:t.jsx(k,{size:"small",onClick:()=>Ye(l),disabled:l.status==="running",children:"Execute"})})]},l.id))})]})}):t.jsx(y,{children:"No bulk operations found."})]})]}),t.jsxs(Lt,{open:Ee,onClose:()=>ae(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(kt,{children:"Import Team Members from CSV"}),t.jsxs(Et,{children:[t.jsx(w,{sx:{mb:3},children:t.jsxs(k,{variant:"outlined",component:"label",startIcon:t.jsx(Rt,{}),fullWidth:!0,children:["Choose CSV File",t.jsx("input",{type:"file",accept:".csv",hidden:!0,onChange:l=>{var j;const m=(j=l.target.files)==null?void 0:j[0];m&&Je(m)}})]})}),V&&t.jsxs(Ie,{severity:V.success?"success":"warning",children:[t.jsxs(Me,{children:["Import ",V.success?"Successful":"Completed with Errors"]}),t.jsxs(y,{children:["Processed: ",V.totalRows," rows"]}),t.jsxs(y,{children:["Successful: ",V.successfulImports]}),t.jsxs(y,{children:["Failed: ",V.failedImports]})]})]}),t.jsx(Bt,{children:t.jsx(k,{onClick:()=>ae(!1),children:"Close"})})]})]})};export{fs as default};
