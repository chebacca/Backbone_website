const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.esm-zGMEL0w1.js","assets/index.esm-DFeBm_6f.js"])))=>i.map(i=>d[i]);
import{j as e,aI as ie,aJ as re,B as n,bV as us,T as s,g as Ke,bG as ms,aK as le,bW as js,bX as ps,bY as gs,aL as oe,a as C,A as fs,q as ys,p as _,t as q,v as K,G as d,af as ye,bZ as ve,D as be,e as u,r as ee,w as Ye,x as Ce,y as U,z as Se,L as vs,d as W,ai as ce,C as Le,ay as bs,aj as Ae,H as Cs,aS as Fe,ae as Ze,am as Q,al as Oe,i as Be,aB as Ss,aC as Ls,aD as As,aE as $e,aF as p,aG as Is,u as Me,ag as xe,aH as ws,aR as Ps,as as he,at as ue,au as me,a5 as b,aP as je,aO as _e,aW as pe,I as E,aZ as Ie,bk as qe,E as Es,X as Ge,aX as Ts,a4 as Ds,b2 as Ws}from"./mui-BO-fjSjW.js";import{r as h}from"./vendor-CjD1bmmO.js";import{u as Je}from"./notistack.esm-Ca-E78ev.js";import{b as Ns,c as ks,u as Us,a as zs,l as Rs,i as Fs,j as Os}from"./useStreamlinedData-ByPJOb-o.js";import{M as ae}from"./MetricCard-Bwv-4yrN.js";import{_ as Bs}from"./index-ChDbFW_u.js";import{E as $s,l as Ms,u as _s,a as qs,C as Ve}from"./stripe-BghXmgwV.js";import"./UnifiedDataService-C1pyZgUN.js";import"./index.esm-DPts1Tj8.js";import"./index.esm-DFeBm_6f.js";import"./FirestoreCollectionManager-CrKS2x9a.js";import"./firebase-BAcWDerH.js";import"./index.esm-zGMEL0w1.js";const ge=[{id:"basic",name:"Basic",tier:"BASIC",price:29,maxDevices:2,features:["Basic project management","Up to 2 devices","Email support","Standard templates","5GB storage"]},{id:"professional",name:"Professional",tier:"PROFESSIONAL",price:99,maxDevices:5,popular:!0,features:["Advanced project management","Up to 5 devices","Priority support","Custom templates","50GB storage","Team collaboration","Advanced analytics"]},{id:"enterprise",name:"Enterprise",tier:"ENTERPRISE",price:199,maxDevices:10,features:["Enterprise project management","Up to 10 devices","24/7 dedicated support","Unlimited templates","500GB storage","Advanced team management","Custom integrations","White-label options","SLA guarantee"]}],He=[{id:"plan-selection",label:"Select Plan",description:"Choose your license plan and quantity",completed:!1},{id:"billing-info",label:"Billing Information",description:"Enter your billing details",completed:!1},{id:"payment",label:"Payment",description:"Complete your payment securely",completed:!1},{id:"confirmation",label:"Confirmation",description:"Review and activate your licenses",completed:!1}],Gs=Ms("pk_test_disabled"),Vs=({purchaseData:i,onPaymentSuccess:I,onPaymentError:x,processing:S})=>{const L=_s(),N=qs(),[y,j]=h.useState(!1),[k,O]=h.useState(null),v=async g=>{if(g.preventDefault(),!L||!N){x("Stripe has not loaded yet. Please try again.");return}const G=N.getElement(Ve);if(!G){x("Card element not found. Please refresh and try again.");return}try{const{error:f,paymentMethod:Y}=await L.createPaymentMethod({type:"card",card:G,billing_details:{name:`${i.billingAddress.firstName} ${i.billingAddress.lastName}`,email:i.billingAddress.email,phone:i.billingAddress.phone,address:{line1:i.billingAddress.address,city:i.billingAddress.city,state:i.billingAddress.state,postal_code:i.billingAddress.zipCode,country:i.billingAddress.country}}});if(f){x(f.message||"Payment method creation failed");return}I(Y)}catch(f){x(f.message||"An unexpected error occurred")}},m=g=>{j(g.complete),O(g.error?g.error.message:null)};return e.jsxs(n,{component:"form",onSubmit:v,children:[e.jsx(q,{sx:{mb:3,border:"2px solid",borderColor:"primary.main"},children:e.jsxs(K,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(vs,{color:"primary",sx:{mr:1}}),e.jsx(s,{variant:"h6",children:"Secure Payment"}),e.jsx(ee,{label:"SSL Encrypted",size:"small",color:"success",sx:{ml:"auto"}})]}),e.jsx(Ve,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}},onChange:m}),k&&e.jsx(W,{severity:"error",sx:{mt:2},children:k})]})}),e.jsxs(W,{severity:"info",sx:{mb:3},children:[e.jsx(ce,{children:"Test Mode"}),e.jsxs(s,{variant:"body2",children:["Use test card: ",e.jsx("strong",{children:"4242 4242 4242 4242"})," with any future expiry date and any CVC."]})]}),e.jsx(C,{type:"submit",variant:"contained",fullWidth:!0,size:"large",disabled:!L||!y||S,startIcon:S?e.jsx(Le,{size:20}):e.jsx(bs,{}),sx:{py:2,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600,fontSize:"1.1rem"},children:S?"Processing Payment...":`Pay ${new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(i.total)}`})]})},Hs=({open:i,onClose:I,initialPlan:x="professional",initialQuantity:S=1,onPurchaseComplete:L})=>{const{enqueueSnackbar:N}=Je(),[y,j]=h.useState(0),[k,O]=h.useState(He),[v,m]=h.useState(!1),[g,G]=h.useState(ge.find(o=>o.id===x)||ge[1]),[f,Y]=h.useState(S),[l,A]=h.useState({firstName:"",lastName:"",company:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",country:"US"}),z=g.price*f,R=z*.08,V=z+R,H={plan:g,quantity:f,billingAddress:l,total:V,tax:R,subtotal:z},de=()=>{if(y<k.length-1){const o=[...k];o[y].completed=!0,O(o),j(y+1)}},X=()=>{y>0&&j(y-1)},a=()=>{v||(I(),j(0),O(He.map(o=>({...o,completed:!1}))))},B=o=>{switch(o){case 0:return g&&f>0;case 1:return!!(l.firstName&&l.lastName&&l.email&&l.address&&l.city&&l.state&&l.zipCode);case 2:return!0;default:return!0}},se=async o=>{m(!0);try{console.log("ðŸ›’ [LicensePurchaseFlow] Processing payment with method:",o.id);const r=await fetch("/api/licenses/purchase",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await Pe()}`},body:JSON.stringify({planId:g.id,quantity:f,paymentMethodId:o.id,billingAddress:l,total:V})});if(!r.ok)throw new Error("Payment processing failed");const T=await r.json();if(T.success){const F=[...k];F[2].completed=!0,O(F),j(3),N("Payment processed successfully!",{variant:"success"}),setTimeout(()=>{L(T.data),a()},3e3)}else throw new Error(T.error||"Payment failed")}catch(r){console.error("âŒ [LicensePurchaseFlow] Payment error:",r),N(r.message||"Payment failed. Please try again.",{variant:"error"})}finally{m(!1)}},te=o=>{N(o,{variant:"error"})},Pe=async()=>{try{const{getAuth:o}=await Bs(async()=>{const{getAuth:Z}=await import("./index.esm-zGMEL0w1.js");return{getAuth:Z}},__vite__mapDeps([0,1])),T=o().currentUser;if(!T)throw new Error("No authenticated user");return await T.getIdToken()}catch(o){throw console.error("âŒ [LicensePurchaseFlow] Error getting auth token:",o),new Error("Authentication failed")}},Ee=o=>{switch(o){case 0:return e.jsxs(n,{children:[e.jsx(s,{variant:"h6",sx:{mb:3},children:"Choose Your License Plan"}),e.jsx(d,{container:!0,spacing:3,sx:{mb:3},children:ge.map(r=>e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(q,{sx:{cursor:"pointer",border:g.id===r.id?"2px solid":"1px solid",borderColor:g.id===r.id?"primary.main":"divider",position:"relative","&:hover":{borderColor:"primary.main",transform:"translateY(-2px)"},transition:"all 0.2s ease-in-out"},onClick:()=>G(r),children:[r.popular&&e.jsx(ee,{label:"Most Popular",color:"primary",size:"small",sx:{position:"absolute",top:-10,left:"50%",transform:"translateX(-50%)",zIndex:1}}),e.jsxs(K,{sx:{textAlign:"center",p:3},children:[e.jsx(s,{variant:"h5",sx:{fontWeight:600,mb:1},children:r.name}),e.jsxs(s,{variant:"h3",sx:{fontWeight:700,mb:1},children:["$",r.price,e.jsx(s,{component:"span",variant:"body1",color:"text.secondary",children:"/month"})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Up to ",r.maxDevices," devices"]}),e.jsx(Ye,{dense:!0,children:r.features.map((T,F)=>e.jsxs(Ce,{sx:{px:0},children:[e.jsx(U,{sx:{minWidth:32},children:e.jsx(_,{color:"success",fontSize:"small"})}),e.jsx(Se,{primary:T,primaryTypographyProps:{variant:"body2"}})]},F))})]})]})},r.id))}),e.jsx(q,{sx:{p:3,backgroundColor:"background.paper"},children:e.jsxs(d,{container:!0,spacing:3,alignItems:"center",children:[e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Number of Licenses",type:"number",value:f,onChange:r=>Y(Math.max(1,parseInt(r.target.value)||1)),inputProps:{min:1,max:100},helperText:`${f} Ã— $${g.price} = $${z}/month`})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsxs(n,{sx:{textAlign:"right"},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600},children:["Monthly Total: $",z]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"+ taxes and fees"})]})})]})})]});case 1:return e.jsxs(n,{children:[e.jsx(s,{variant:"h6",sx:{mb:3},children:"Billing Information"}),e.jsxs(d,{container:!0,spacing:3,children:[e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"First Name",value:l.firstName,onChange:r=>A({...l,firstName:r.target.value}),required:!0})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Last Name",value:l.lastName,onChange:r=>A({...l,lastName:r.target.value}),required:!0})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(u,{fullWidth:!0,label:"Company (Optional)",value:l.company,onChange:r=>A({...l,company:r.target.value})})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Email Address",type:"email",value:l.email,onChange:r=>A({...l,email:r.target.value}),required:!0})}),e.jsx(d,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Phone Number (Optional)",value:l.phone,onChange:r=>A({...l,phone:r.target.value})})}),e.jsx(d,{item:!0,xs:12,children:e.jsx(u,{fullWidth:!0,label:"Address",value:l.address,onChange:r=>A({...l,address:r.target.value}),required:!0})}),e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsx(u,{fullWidth:!0,label:"City",value:l.city,onChange:r=>A({...l,city:r.target.value}),required:!0})}),e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsx(u,{fullWidth:!0,label:"State",value:l.state,onChange:r=>A({...l,state:r.target.value}),required:!0})}),e.jsx(d,{item:!0,xs:12,sm:4,children:e.jsx(u,{fullWidth:!0,label:"ZIP Code",value:l.zipCode,onChange:r=>A({...l,zipCode:r.target.value}),required:!0})})]})]});case 2:return e.jsxs(n,{children:[e.jsx(s,{variant:"h6",sx:{mb:3},children:"Payment Details"}),e.jsx(q,{sx:{mb:3},children:e.jsxs(K,{children:[e.jsx(s,{variant:"h6",sx:{mb:2},children:"Order Summary"}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(s,{children:[g.name," Plan Ã— ",f]}),e.jsxs(s,{children:["$",z.toFixed(2)]})]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(s,{children:"Tax"}),e.jsxs(s,{children:["$",R.toFixed(2)]})]}),e.jsx(be,{sx:{my:1}}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",fontWeight:600},children:[e.jsx(s,{variant:"h6",children:"Total"}),e.jsxs(s,{variant:"h6",children:["$",V.toFixed(2)]})]})]})}),e.jsx($s,{stripe:Gs,children:e.jsx(Vs,{purchaseData:H,onPaymentSuccess:se,onPaymentError:te,processing:v})})]});case 3:return e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx(_,{sx:{fontSize:80,color:"success.main",mb:2}}),e.jsx(s,{variant:"h4",sx:{fontWeight:600,mb:2},children:"Payment Successful!"}),e.jsx(s,{variant:"body1",color:"text.secondary",sx:{mb:4},children:"Your licenses have been activated and are ready to use."}),e.jsx(q,{sx:{mb:3,textAlign:"left"},children:e.jsxs(K,{children:[e.jsx(s,{variant:"h6",sx:{mb:2},children:"Purchase Details"}),e.jsxs(d,{container:!0,spacing:2,children:[e.jsxs(d,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Plan:"}),e.jsx(s,{variant:"body1",children:g.name})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Licenses:"}),e.jsx(s,{variant:"body1",children:f})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Monthly Cost:"}),e.jsxs(s,{variant:"body1",children:["$",V.toFixed(2)]})]}),e.jsxs(d,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Next Billing:"}),e.jsx(s,{variant:"body1",children:new Date(Date.now()+30*24*60*60*1e3).toLocaleDateString()})]})]})]})}),e.jsxs(n,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(C,{variant:"outlined",startIcon:e.jsx(ye,{}),onClick:()=>N("Receipt downloaded",{variant:"success"}),children:"Download Receipt"}),e.jsx(C,{variant:"contained",startIcon:e.jsx(ve,{}),onClick:()=>{L({licenses:[],invoice:{},subscription:{}}),a()},children:"View Licenses"})]})]});default:return null}};return e.jsxs(ie,{open:i,onClose:a,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"70vh"}},children:[e.jsx(re,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(us,{color:"primary"}),e.jsx(s,{variant:"h5",sx:{fontWeight:600},children:"Purchase Licenses"})]}),e.jsx(Ke,{onClick:a,disabled:v,children:e.jsx(ms,{})})]})}),e.jsxs(le,{sx:{pb:0},children:[e.jsx(js,{activeStep:y,orientation:"horizontal",sx:{mb:4},children:k.map((o,r)=>e.jsx(ps,{completed:o.completed,children:e.jsx(gs,{children:e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:o.label})})},o.id))}),e.jsx(n,{sx:{minHeight:400},children:Ee(y)})]}),y<3&&e.jsxs(oe,{sx:{p:3,pt:2},children:[e.jsx(C,{onClick:X,disabled:y===0||v,startIcon:e.jsx(fs,{}),children:"Back"}),e.jsx(n,{sx:{flex:1}}),y<2&&e.jsx(C,{onClick:de,variant:"contained",disabled:!B(y),endIcon:e.jsx(ys,{}),children:"Continue"})]})]})},Xs=i=>{switch(i){case"ACTIVE":return"success";case"PENDING":return"warning";case"SUSPENDED":return"error";case"EXPIRED":return"default";default:return"default"}},Ks=i=>{switch(i){case"ACTIVE":return e.jsx(_,{});case"PENDING":return e.jsx(Q,{});case"SUSPENDED":return e.jsx(Ie,{});case"EXPIRED":return e.jsx(Ae,{});default:return e.jsx(Ze,{})}},Ys=i=>{switch(i){case"BASIC":return"default";case"PROFESSIONAL":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},we=(i,I)=>{if(!i)return"Unassigned";if(I&&i.email){const x=I.find(S=>S.email.toLowerCase()===i.email.toLowerCase());if(x){if(x.firstName&&x.lastName)return`${x.firstName} ${x.lastName}`;if(x.firstName)return x.firstName;if(x.lastName)return x.lastName}}return i.name&&i.name!=="Unknown User"?i.name:i.email?i.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(L=>L.charAt(0).toUpperCase()+L.slice(1).toLowerCase()).join(" "):"Unknown User"},Xe=(i,I)=>{if(!i)return"?";const x=we(i,I);if(x==="Unassigned"||x==="Unknown User")return"?";const S=x.split(" ");return S.length>=2?(S[0].charAt(0)+S[1].charAt(0)).toUpperCase():x.charAt(0).toUpperCase()},fe=i=>i.firstName&&i.lastName?`${i.firstName} ${i.lastName}`:i.firstName?i.firstName:i.lastName?i.lastName:i.email.split("@")[0],xt=()=>{var Ue,ze,Re;const{enqueueSnackbar:i}=Je(),{data:I,loading:x,error:S}=Ns(),{data:L,loading:N,error:y}=ks(),{data:j,loading:k,error:O,refetch:v}=Us(),{data:m,loading:g,error:G}=zs(),f=Rs(),Y=Fs();Os();const[l,A]=h.useState(!1),[z,R]=h.useState(!1),[V,H]=h.useState(!1),[de,X]=h.useState(!1),[a,B]=h.useState(null),[se,te]=h.useState(null),[Pe,Ee]=h.useState(""),[o,r]=h.useState(""),[T,F]=h.useState(""),[Z,Te]=h.useState("PROFESSIONAL"),[De,We]=h.useState("PENDING"),[Ne,ke]=h.useState(""),Qe=x||N||k||g,es=S||y||O||G;h.useEffect(()=>{const t=async c=>{var D;const P=c;console.log("ðŸ”„ License refresh event received:",P.detail),((D=P.detail)==null?void 0:D.action)==="created"&&await v()};return window.addEventListener("licenses:refresh",t),()=>{window.removeEventListener("licenses:refresh",t)}},[v]);const w=h.useMemo(()=>{if(!I||!L||!j)return{licenses:[],stats:{totalLicenses:0,activeLicenses:0,expiringSoon:0,unassignedLicenses:0,utilizationRate:0}};const t=j.length,c=j.filter(J=>J.status==="ACTIVE").length,P=j.filter(J=>{const xs=new Date(J.expiresAt),hs=new Date(Date.now()+30*24*60*60*1e3);return xs<=hs}).length,D=j.filter(J=>!J.assignedTo).length,M=t>0?c/t*100:0;return{licenses:j,stats:{totalLicenses:t,activeLicenses:c,expiringSoon:P,unassignedLicenses:D,utilizationRate:M}}},[I,L,j]),ss=(t,c)=>{console.log("ðŸ”§ [LicensesPage] Menu clicked for license:",c),B(c),te(t.currentTarget)},$=()=>{te(null)},ts=t=>{navigator.clipboard.writeText(t),i("License key copied to clipboard",{variant:"success"}),$()},ne=h.useMemo(()=>{if(!m||!j)return[];const t=j.filter(c=>{var P;return(P=c.assignedTo)==null?void 0:P.userId}).map(c=>c.assignedTo.userId);return m.filter(c=>!t.includes(c.id))},[m,j]),ns=async()=>{if(!a||!o){i("Please select a valid team member to assign the license to",{variant:"error"});return}try{await Y.mutate({licenseId:a.id,userId:o});const t=m==null?void 0:m.find(P=>P.id===o),c=t?fe(t):"Unknown User";i(`License assigned to ${c}`,{variant:"success"}),r(""),R(!1),$(),v()}catch(t){i((t==null?void 0:t.message)||"Failed to assign license",{variant:"error"})}},as=async()=>{if(a){try{await f.mutate({licenseId:a.id,updates:{status:"SUSPENDED"}}),i(`License ${a.name} has been suspended`,{variant:"warning"}),v()}catch(t){i((t==null?void 0:t.message)||"Failed to suspend license",{variant:"error"})}$()}},is=async()=>{if(a){try{await f.mutate({licenseId:a.id,updates:{status:"ACTIVE"}}),i(`License ${a.name} has been activated`,{variant:"success"}),v()}catch(t){i((t==null?void 0:t.message)||"Failed to activate license",{variant:"error"})}$()}},rs=()=>{a&&(X(!0),$())},ls=async()=>{if(a)try{i(`License ${a.name} has been deleted`,{variant:"success"}),X(!1),B(null),v()}catch(t){i((t==null?void 0:t.message)||"Failed to delete license",{variant:"error"})}},os=t=>{const c=t||a;if(!c){console.error("ðŸ”§ [LicensesPage] No license provided for editing"),i("Unable to load license data. Please try again.",{variant:"error"});return}console.log("ðŸ”§ [LicensesPage] Opening edit dialog for license:",c),B(c),F(c.name),Te(c.tier),We(c.status),ke(new Date(c.expiresAt).toISOString().split("T")[0]),$(),setTimeout(()=>{H(!0)},10)},cs=async()=>{if(a)try{await f.mutate({licenseId:a.id,updates:{name:T,tier:Z,status:De,expiresAt:new Date(Ne)}}),i(`License ${a.name} updated successfully`,{variant:"success"}),H(!1),B(null),v()}catch(t){i((t==null?void 0:t.message)||"Failed to update license",{variant:"error"})}},ds=async t=>{console.log("ðŸŽ‰ [LicensesPage] Purchase completed:",t),i(`Successfully purchased ${t.licenses.length} license(s)! They are now active and ready to use.`,{variant:"success",autoHideDuration:6e3}),await v(),A(!1)};return Qe?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(n,{textAlign:"center",children:[e.jsx(Le,{size:60}),e.jsx(s,{variant:"h6",sx:{mt:2},children:"Loading License Data..."}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Fetching your licenses and subscription details"})]})}):es?e.jsx(n,{sx:{p:3},children:e.jsxs(W,{severity:"error",children:[e.jsx(ce,{children:"Unable to Load License Data"}),e.jsx(s,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your license information. This could be due to:"}),e.jsxs(Ye,{dense:!0,children:[e.jsxs(Ce,{children:[e.jsx(U,{children:e.jsx(Ae,{fontSize:"small"})}),e.jsx(Se,{primary:"Network connectivity issues"})]}),e.jsxs(Ce,{children:[e.jsx(U,{children:e.jsx(Cs,{fontSize:"small"})}),e.jsx(Se,{primary:"Authentication token expired"})]})]}),e.jsx(n,{sx:{mt:2},children:e.jsx(C,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!I||!L?e.jsx(n,{sx:{p:3},children:e.jsxs(W,{severity:"info",children:[e.jsx(ce,{children:"Setting Up License Management"}),e.jsx(s,{variant:"body2",children:"We're preparing your license management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(n,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsxs(s,{variant:"body1",color:"text.secondary",children:["Manage your ",((Ue=L.organization)==null?void 0:Ue.name)||"Organization"," licenses and assignments",j&&e.jsxs("span",{style:{marginLeft:"8px",fontWeight:500,color:"primary.main"},children:["â€¢ ",j.length," total licenses"]})]})]}),e.jsx(n,{sx:{display:"flex",gap:2},children:e.jsx(C,{variant:"contained",startIcon:e.jsx(Fe,{}),onClick:()=>A(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Purchase Licenses"})})]}),e.jsxs(d,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ae,{title:"Total Licenses",value:w.stats.totalLicenses.toString(),icon:e.jsx(Ze,{}),color:"primary"})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ae,{title:"Active Licenses",value:w.stats.activeLicenses.toString(),icon:e.jsx(_,{}),color:"success"})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ae,{title:"Expiring Soon",value:w.stats.expiringSoon.toString(),icon:e.jsx(Q,{}),color:"warning"})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ae,{title:"Unassigned",value:w.stats.unassignedLicenses.toString(),icon:e.jsx(Oe,{}),color:"secondary"})})]}),e.jsx(q,{sx:{mb:4},children:e.jsxs(K,{children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600,mb:2},children:"License Utilization"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(Be,{variant:"determinate",value:w.stats.utilizationRate,sx:{flex:1,height:8,borderRadius:4}}),e.jsxs(s,{variant:"body2",sx:{minWidth:60},children:[w.stats.utilizationRate.toFixed(1),"%"]})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[w.stats.activeLicenses," of ",w.stats.totalLicenses," licenses are currently active"]})]})}),w.stats.expiringSoon>0&&e.jsxs(W,{severity:"warning",sx:{mb:4},children:[e.jsx(ce,{children:"Licenses Expiring Soon"}),e.jsxs(s,{variant:"body2",sx:{mb:2},children:[w.stats.expiringSoon," license(s) will expire within the next 30 days."]}),e.jsx(C,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Renew Licenses"})]}),e.jsx(q,{children:e.jsxs(K,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600},children:["All Licenses (",w.licenses.length,")"]}),e.jsx(C,{variant:"outlined",startIcon:e.jsx(ye,{}),onClick:()=>i("License report downloaded",{variant:"success"}),children:"Export Report"})]}),e.jsx(Ss,{children:e.jsxs(Ls,{children:[e.jsx(As,{children:e.jsxs($e,{children:[e.jsx(p,{sx:{fontWeight:600},children:"License"}),e.jsx(p,{sx:{fontWeight:600},children:"Tier"}),e.jsx(p,{sx:{fontWeight:600},children:"Status"}),e.jsx(p,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(p,{sx:{fontWeight:600},children:"Department"}),e.jsx(p,{sx:{fontWeight:600},children:"Role"}),e.jsx(p,{sx:{fontWeight:600},children:"Usage"}),e.jsx(p,{sx:{fontWeight:600},children:"Expires"}),e.jsx(p,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Is,{children:w.licenses.map(t=>{var c,P;return e.jsxs($e,{hover:!0,children:[e.jsx(p,{children:e.jsxs(n,{children:[e.jsx(s,{variant:"body1",sx:{fontWeight:500},children:t.name}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:t.key})]})}),e.jsx(p,{children:e.jsx(ee,{label:t.tier,color:Ys(t.tier),size:"small",icon:t.tier==="ENTERPRISE"?e.jsx(Me,{}):void 0})}),e.jsx(p,{children:e.jsx(ee,{icon:Ks(t.status),label:t.status,color:Xs(t.status),size:"small"})}),e.jsx(p,{children:t.assignedTo?e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xe,{sx:{width:24,height:24},children:Xe(t.assignedTo,m)}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:we(t.assignedTo,m)}),e.jsx(s,{variant:"caption",color:"text.secondary",children:t.assignedTo.email})]})]}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(p,{children:e.jsx(s,{variant:"body2",color:"text.secondary",children:t.assignedTo?((c=m==null?void 0:m.find(D=>{var M;return D.email===((M=t.assignedTo)==null?void 0:M.email)}))==null?void 0:c.department)||"Not specified":"â€”"})}),e.jsx(p,{children:t.assignedTo?e.jsx(ee,{label:((P=m==null?void 0:m.find(D=>{var M;return D.email===((M=t.assignedTo)==null?void 0:M.email)}))==null?void 0:P.role)||"Member",color:"primary",size:"small",variant:"outlined"}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"â€”"})}),e.jsx(p,{children:e.jsxs(n,{children:[e.jsxs(s,{variant:"body2",children:[t.usage.apiCalls.toLocaleString()," API calls"]}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[t.usage.dataTransfer," GB transferred"]})]})}),e.jsx(p,{children:e.jsx(s,{variant:"body2",color:new Date(t.expiresAt)<=new Date(Date.now()+30*24*60*60*1e3)?"warning.main":"text.primary",children:new Date(t.expiresAt).toLocaleDateString()})}),e.jsx(p,{children:e.jsx(Ke,{size:"small",onClick:D=>ss(D,t),children:e.jsx(ws,{})})})]},t.id)})})]})})]})}),e.jsx(Ps,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"},background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)"},onClick:()=>A(!0),children:e.jsx(Fe,{})}),e.jsxs(ie,{open:z,onClose:()=>R(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(re,{children:"Assign License"}),e.jsx(le,{children:a&&e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(W,{severity:"info",children:e.jsxs(s,{variant:"body2",children:["Assigning license: ",e.jsx("strong",{children:a.name})]})}),e.jsxs(he,{fullWidth:!0,children:[e.jsx(ue,{children:"Assign To"}),e.jsx(me,{value:o,label:"Assign To",onChange:t=>r(t.target.value),disabled:ne.length===0,children:ne.length===0?e.jsx(b,{disabled:!0,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"No available team members for assignment"})}):ne.map(t=>e.jsx(b,{value:t.id,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xe,{sx:{width:24,height:24},children:fe(t).charAt(0)}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:fe(t)}),e.jsx(s,{variant:"caption",color:"text.secondary",children:t.email})]})]})},t.id))})]}),ne.length===0&&e.jsx(W,{severity:"info",children:e.jsx(s,{variant:"body2",children:"All team members already have licenses assigned. To assign this license, you'll need to unassign another license first or invite new team members."})}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"The user will receive an email with instructions to activate their license."})]})}),e.jsxs(oe,{children:[e.jsx(C,{onClick:()=>R(!1),children:"Cancel"}),e.jsx(C,{onClick:ns,variant:"contained",startIcon:e.jsx(je,{}),children:"Assign License"})]})]}),e.jsxs(ie,{open:de,onClose:()=>X(!1),maxWidth:"sm",children:[e.jsx(re,{children:"Delete License"}),e.jsx(le,{children:a&&e.jsxs(n,{children:[e.jsxs(s,{variant:"body1",sx:{mb:2},children:["Are you sure you want to delete ",e.jsx("strong",{children:a.name}),"?"]}),e.jsx(W,{severity:"warning",children:e.jsx(s,{variant:"body2",children:"This action cannot be undone. The license will be permanently removed and any assigned user will lose access."})})]})}),e.jsxs(oe,{children:[e.jsx(C,{onClick:()=>X(!1),children:"Cancel"}),e.jsx(C,{onClick:ls,variant:"contained",color:"error",startIcon:e.jsx(_e,{}),children:"Delete License"})]})]}),e.jsxs(ie,{open:V,onClose:()=>{H(!1),B(null)},maxWidth:"md",fullWidth:!0,children:[e.jsx(re,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(pe,{}),"Edit License: ",(a==null?void 0:a.name)||"Loading..."]})}),e.jsx(le,{children:a?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ve,{})," Basic Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(u,{fullWidth:!0,label:"License Name",value:T,onChange:t=>F(t.target.value),placeholder:"Development Team License",required:!0}),e.jsx(u,{fullWidth:!0,label:"License Key",value:a.key,disabled:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(ve,{})})},helperText:"License key is automatically generated and cannot be changed"})]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(he,{fullWidth:!0,children:[e.jsx(ue,{children:"License Tier"}),e.jsxs(me,{value:Z,label:"License Tier",onChange:t=>Te(t.target.value),children:[e.jsx(b,{value:"BASIC",children:e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Basic"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Limited features â€¢ 2 max devices â€¢ Basic support"})]})}),e.jsx(b,{value:"PROFESSIONAL",children:e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Professional"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Full features â€¢ 5 max devices â€¢ Priority support"})]})}),e.jsx(b,{value:"ENTERPRISE",children:e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Enterprise"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Advanced features â€¢ 10 max devices â€¢ 24/7 support"})]})})]})]}),e.jsxs(he,{fullWidth:!0,children:[e.jsx(ue,{children:"Status"}),e.jsxs(me,{value:De,label:"Status",onChange:t=>We(t.target.value),children:[e.jsx(b,{value:"PENDING",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{color:"warning"}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Pending"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Awaiting activation"})]})]})}),e.jsx(b,{value:"ACTIVE",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(_,{color:"success"}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Active"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Fully operational"})]})]})}),e.jsx(b,{value:"SUSPENDED",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ie,{color:"error"}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Suspended"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Temporarily disabled"})]})]})}),e.jsx(b,{value:"EXPIRED",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ae,{color:"warning"}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Expired"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Past expiration date"})]})]})})]})]})]}),e.jsx(u,{fullWidth:!0,label:"Expiration Date",type:"date",value:Ne,onChange:t=>ke(t.target.value),InputLabelProps:{shrink:!0},required:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(Q,{})})}})]}),e.jsxs(n,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(qe,{})," Usage & Limits"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(u,{fullWidth:!0,label:"Max Devices",value:a.usage.maxDevices,disabled:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(Oe,{})})},helperText:`${Z} tier limit`}),e.jsx(u,{fullWidth:!0,label:"Current Devices",value:a.usage.deviceCount,disabled:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(_,{})})}})]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(u,{fullWidth:!0,label:"API Calls Used",value:a.usage.apiCalls.toLocaleString(),disabled:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(qe,{})})}}),e.jsx(u,{fullWidth:!0,label:"Data Transfer (GB)",value:a.usage.dataTransfer,disabled:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(ye,{})})}})]}),e.jsxs(n,{sx:{mt:2},children:[e.jsxs(s,{variant:"body2",sx:{mb:1},children:["Device Usage: ",a.usage.deviceCount," / ",a.usage.maxDevices]}),e.jsx(Be,{variant:"determinate",value:a.usage.deviceCount/a.usage.maxDevices*100,sx:{height:8,borderRadius:4},color:a.usage.deviceCount>=a.usage.maxDevices?"error":"primary"})]})]}),e.jsxs(n,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{})," Assignment Information"]}),a.assignedTo?e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(u,{fullWidth:!0,label:"Assigned To",value:we(a.assignedTo,m),disabled:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(xe,{sx:{width:20,height:20},children:Xe(a.assignedTo,m)})})}}),e.jsx(u,{fullWidth:!0,label:"User Email",value:a.assignedTo.email,disabled:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(Es,{})})}})]}):e.jsx(W,{severity:"info",children:e.jsx(s,{variant:"body2",children:'This license is currently unassigned. Use the "Assign License" action to assign it to a team member.'})})]}),e.jsxs(n,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{})," Organization & Metadata"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(u,{fullWidth:!0,label:"Organization",value:((ze=a.organization)==null?void 0:ze.name)||"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(Ge,{})})}}),e.jsx(u,{fullWidth:!0,label:"Organization Tier",value:((Re=a.organization)==null?void 0:Re.tier)||"BASIC",disabled:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(Me,{})})}})]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(u,{fullWidth:!0,label:"Created Date",value:a.createdAt?new Date(a.createdAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(Q,{})})}}),e.jsx(u,{fullWidth:!0,label:"Last Updated",value:a.updatedAt?new Date(a.updatedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(E,{position:"start",children:e.jsx(Ts,{})})}})]})]}),e.jsxs(W,{severity:"warning",children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500,mb:1},children:"âš ï¸ Important Notes"}),e.jsxs(s,{variant:"body2",children:["â€¢ Changing the license tier will update device limits and feature access",e.jsx("br",{}),"â€¢ Status changes will immediately affect the user's access to the system",e.jsx("br",{}),"â€¢ Expiration date changes should be communicated to the license holder",e.jsx("br",{}),"â€¢ Some fields are system-managed and cannot be edited here"]})]})]}):e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(n,{textAlign:"center",children:[e.jsx(Le,{size:40,sx:{mb:2}}),e.jsx(s,{variant:"body1",color:"text.secondary",children:"Loading license data..."}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"If this persists, please try again or refresh the page."})]})})}),e.jsxs(oe,{children:[e.jsx(C,{onClick:()=>H(!1),children:"Cancel"}),e.jsx(C,{onClick:cs,variant:"contained",startIcon:e.jsx(pe,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(Ds,{anchorEl:se,open:!!se,onClose:$,children:[e.jsxs(b,{onClick:()=>a&&ts(a.key),children:[e.jsx(U,{children:e.jsx(Ws,{})}),"Copy License Key"]}),!(a!=null&&a.assignedTo)&&e.jsxs(b,{onClick:()=>R(!0),children:[e.jsx(U,{children:e.jsx(je,{})}),"Assign License"]}),e.jsxs(b,{onClick:()=>a&&os(a),children:[e.jsx(U,{children:e.jsx(pe,{})}),"Edit License"]}),e.jsx(be,{}),(a==null?void 0:a.status)==="ACTIVE"?e.jsxs(b,{onClick:as,children:[e.jsx(U,{children:e.jsx(Ie,{})}),"Suspend License"]}):e.jsxs(b,{onClick:is,children:[e.jsx(U,{children:e.jsx(_,{})}),"Activate License"]}),e.jsx(be,{}),e.jsxs(b,{onClick:rs,sx:{color:"error.main"},children:[e.jsx(U,{children:e.jsx(_e,{sx:{color:"error.main"}})}),"Delete License"]})]}),e.jsx(Hs,{open:l,onClose:()=>A(!1),initialPlan:"professional",initialQuantity:1,onPurchaseComplete:ds})]})};export{xt as default};
