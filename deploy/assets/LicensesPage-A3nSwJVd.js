const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.esm-K73FumZQ.js","assets/index.esm--uL3Qa3r.js","assets/UnifiedDataService-DQSAUp1m.js","assets/index-CNfDGr2f.js","assets/mui-F2qg0EzW.js","assets/vendor-CjD1bmmO.js","assets/stripe-CS2B2-a4.js","assets/index-CBai7h7s.css","assets/index.esm-C6E5jVjx.js","assets/FirestoreCollectionManager-mygy-oyY.js","assets/firebase-S1BqFoQs.js"])))=>i.map(i=>d[i]);
import{_ as is}from"./index-CNfDGr2f.js";import{j as e,aI as te,aJ as ne,B as n,bV as Ss,T as s,g as rs,bG as ws,aK as ae,bW as Is,bX as As,bY as Es,aL as ie,a as v,A as Ps,q as Ts,p as X,t as K,v as Q,G as x,af as Pe,bZ as re,D as Te,e as m,r as oe,w as ls,x as De,y as B,z as Ne,L as Ds,d as D,ai as ge,C as We,ay as Ns,aj as ke,H as Ws,aS as Le,ae as os,am as le,al as Ke,i as Ye,aB as ks,aC as Us,aD as zs,aE as Ze,aF as f,aG as Rs,u as Je,ag as Se,aH as Os,aR as Fs,as as ue,at as me,au as je,a5 as y,aP as we,aO as Qe,aW as Ie,I as T,aZ as Ue,bk as es,E as $s,X as ss,aX as Bs,a4 as Ms,b2 as _s}from"./mui-F2qg0EzW.js";import{r as d}from"./vendor-CjD1bmmO.js";import{u as cs}from"./notistack.esm-Ca-E78ev.js";import{b as Gs,c as qs,u as Vs,a as Hs,l as Xs,m as Ks,i as Ys,j as Zs}from"./useStreamlinedData-k7bXwoHQ.js";import{M as pe}from"./MetricCard-DMcmli_g.js";import{E as Js,l as Qs,u as et,a as st,C as ts}from"./stripe-CS2B2-a4.js";import"./UnifiedDataService-DQSAUp1m.js";import"./index.esm-C6E5jVjx.js";import"./index.esm--uL3Qa3r.js";import"./FirestoreCollectionManager-mygy-oyY.js";import"./firebase-S1BqFoQs.js";import"./index.esm-K73FumZQ.js";const Ae=[{id:"basic",name:"Basic",tier:"BASIC",price:29,maxDevices:2,features:["Basic project management","Up to 2 devices","Email support","Standard templates","5GB storage"]},{id:"professional",name:"Professional",tier:"PROFESSIONAL",price:99,maxDevices:5,popular:!0,features:["Advanced project management","Up to 5 devices","Priority support","Custom templates","50GB storage","Team collaboration","Advanced analytics"]},{id:"enterprise",name:"Enterprise",tier:"ENTERPRISE",price:199,maxDevices:10,features:["Enterprise project management","Up to 10 devices","24/7 dedicated support","Unlimited templates","500GB storage","Advanced team management","Custom integrations","White-label options","SLA guarantee"]}],ns=[{id:"plan-selection",label:"Select Plan",description:"Choose your license plan and quantity",completed:!1},{id:"billing-info",label:"Billing Information",description:"Enter your billing details",completed:!1},{id:"payment",label:"Payment",description:"Complete your payment securely",completed:!1},{id:"confirmation",label:"Confirmation",description:"Review and activate your licenses",completed:!1}],tt=Qs("pk_test_disabled"),nt=({purchaseData:a,onPaymentSuccess:h,onPaymentError:u,processing:A})=>{const E=et(),z=st(),[S,j]=d.useState(!1),[R,_]=d.useState(null),g=async b=>{if(b.preventDefault(),!E||!z){u("Stripe has not loaded yet. Please try again.");return}const Y=z.getElement(ts);if(!Y){u("Card element not found. Please refresh and try again.");return}try{const{error:w,paymentMethod:G}=await E.createPaymentMethod({type:"card",card:Y,billing_details:{name:`${a.billingAddress.firstName} ${a.billingAddress.lastName}`,email:a.billingAddress.email,phone:a.billingAddress.phone,address:{line1:a.billingAddress.address,city:a.billingAddress.city,state:a.billingAddress.state,postal_code:a.billingAddress.zipCode,country:a.billingAddress.country}}});if(w){u(w.message||"Payment method creation failed");return}h(G)}catch(w){u(w.message||"An unexpected error occurred")}},p=b=>{j(b.complete),_(b.error?b.error.message:null)};return e.jsxs(n,{component:"form",onSubmit:g,children:[e.jsx(K,{sx:{mb:3,border:"2px solid",borderColor:"primary.main"},children:e.jsxs(Q,{children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Ds,{color:"primary",sx:{mr:1}}),e.jsx(s,{variant:"h6",children:"Secure Payment"}),e.jsx(oe,{label:"SSL Encrypted",size:"small",color:"success",sx:{ml:"auto"}})]}),e.jsx(ts,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}},onChange:p}),R&&e.jsx(D,{severity:"error",sx:{mt:2},children:R})]})}),e.jsxs(D,{severity:"info",sx:{mb:3},children:[e.jsx(ge,{children:"Test Mode"}),e.jsxs(s,{variant:"body2",children:["Use test card: ",e.jsx("strong",{children:"4242 4242 4242 4242"})," with any future expiry date and any CVC."]})]}),e.jsx(v,{type:"submit",variant:"contained",fullWidth:!0,size:"large",disabled:!E||!S||A,startIcon:A?e.jsx(We,{size:20}):e.jsx(Ns,{}),sx:{py:2,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600,fontSize:"1.1rem"},children:A?"Processing Payment...":`Pay ${new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a.total)}`})]})},at=({open:a,onClose:h,initialPlan:u="professional",initialQuantity:A=1,onPurchaseComplete:E})=>{const{enqueueSnackbar:z}=cs(),[S,j]=d.useState(0),[R,_]=d.useState(ns),[g,p]=d.useState(!1),[b,Y]=d.useState(Ae.find(c=>c.id===u)||Ae[1]),[w,G]=d.useState(A),[l,N]=d.useState({firstName:"",lastName:"",company:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",country:"US"}),W=b.price*w,ee=W*.08,O=W+ee,fe={plan:b,quantity:w,billingAddress:l,total:O,tax:ee,subtotal:W},Z=()=>{if(S<R.length-1){const c=[...R];c[S].completed=!0,_(c),j(S+1)}},ye=()=>{S>0&&j(S-1)},F=()=>{g||(h(),j(0),_(ns.map(c=>({...c,completed:!1}))))},ve=c=>{switch(c){case 0:return b&&w>0;case 1:return!!(l.firstName&&l.lastName&&l.email&&l.address&&l.city&&l.state&&l.zipCode);case 2:return!0;default:return!0}},J=async c=>{p(!0);try{console.log("ðŸ›’ [LicensePurchaseFlow] Processing payment with method:",c.id);const r=await fetch("/api/licenses/purchase",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await q()}`},body:JSON.stringify({planId:b.id,quantity:w,paymentMethodId:c.id,billingAddress:l,total:O})});if(!r.ok)throw new Error("Payment processing failed");const $=await r.json();if($.success){const k=[...R];k[2].completed=!0,_(k),j(3),z("Payment processed successfully!",{variant:"success"}),setTimeout(()=>{E($.data),F()},3e3)}else throw new Error($.error||"Payment failed")}catch(r){console.error("âŒ [LicensePurchaseFlow] Payment error:",r),z(r.message||"Payment failed. Please try again.",{variant:"error"})}finally{p(!1)}},i=c=>{z(c,{variant:"error"})},q=async()=>{try{const{getAuth:c}=await is(async()=>{const{getAuth:de}=await import("./index.esm-K73FumZQ.js");return{getAuth:de}},__vite__mapDeps([0,1])),$=c().currentUser;if(!$)throw new Error("No authenticated user");return await $.getIdToken()}catch(c){throw console.error("âŒ [LicensePurchaseFlow] Error getting auth token:",c),new Error("Authentication failed")}},ce=c=>{switch(c){case 0:return e.jsxs(n,{children:[e.jsx(s,{variant:"h6",sx:{mb:3},children:"Choose Your License Plan"}),e.jsx(x,{container:!0,spacing:3,sx:{mb:3},children:Ae.map(r=>e.jsx(x,{item:!0,xs:12,md:4,children:e.jsxs(K,{sx:{cursor:"pointer",border:b.id===r.id?"2px solid":"1px solid",borderColor:b.id===r.id?"primary.main":"divider",position:"relative","&:hover":{borderColor:"primary.main",transform:"translateY(-2px)"},transition:"all 0.2s ease-in-out"},onClick:()=>Y(r),children:[r.popular&&e.jsx(oe,{label:"Most Popular",color:"primary",size:"small",sx:{position:"absolute",top:-10,left:"50%",transform:"translateX(-50%)",zIndex:1}}),e.jsxs(Q,{sx:{textAlign:"center",p:3},children:[e.jsx(s,{variant:"h5",sx:{fontWeight:600,mb:1},children:r.name}),e.jsxs(s,{variant:"h3",sx:{fontWeight:700,mb:1},children:["$",r.price,e.jsx(s,{component:"span",variant:"body1",color:"text.secondary",children:"/month"})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Up to ",r.maxDevices," devices"]}),e.jsx(ls,{dense:!0,children:r.features.map(($,k)=>e.jsxs(De,{sx:{px:0},children:[e.jsx(B,{sx:{minWidth:32},children:e.jsx(X,{color:"success",fontSize:"small"})}),e.jsx(Ne,{primary:$,primaryTypographyProps:{variant:"body2"}})]},k))})]})]})},r.id))}),e.jsx(K,{sx:{p:3,backgroundColor:"background.paper"},children:e.jsxs(x,{container:!0,spacing:3,alignItems:"center",children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Number of Licenses",type:"number",value:w,onChange:r=>G(Math.max(1,parseInt(r.target.value)||1)),inputProps:{min:1,max:100},helperText:`${w} Ã— $${b.price} = $${W}/month`})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(n,{sx:{textAlign:"right"},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600},children:["Monthly Total: $",W]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"+ taxes and fees"})]})})]})})]});case 1:return e.jsxs(n,{children:[e.jsx(s,{variant:"h6",sx:{mb:3},children:"Billing Information"}),e.jsxs(x,{container:!0,spacing:3,children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"First Name",value:l.firstName,onChange:r=>N({...l,firstName:r.target.value}),required:!0})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Last Name",value:l.lastName,onChange:r=>N({...l,lastName:r.target.value}),required:!0})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"Company (Optional)",value:l.company,onChange:r=>N({...l,company:r.target.value})})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Email Address",type:"email",value:l.email,onChange:r=>N({...l,email:r.target.value}),required:!0})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(m,{fullWidth:!0,label:"Phone Number (Optional)",value:l.phone,onChange:r=>N({...l,phone:r.target.value})})}),e.jsx(x,{item:!0,xs:12,children:e.jsx(m,{fullWidth:!0,label:"Address",value:l.address,onChange:r=>N({...l,address:r.target.value}),required:!0})}),e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsx(m,{fullWidth:!0,label:"City",value:l.city,onChange:r=>N({...l,city:r.target.value}),required:!0})}),e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsx(m,{fullWidth:!0,label:"State",value:l.state,onChange:r=>N({...l,state:r.target.value}),required:!0})}),e.jsx(x,{item:!0,xs:12,sm:4,children:e.jsx(m,{fullWidth:!0,label:"ZIP Code",value:l.zipCode,onChange:r=>N({...l,zipCode:r.target.value}),required:!0})})]})]});case 2:return e.jsxs(n,{children:[e.jsx(s,{variant:"h6",sx:{mb:3},children:"Payment Details"}),e.jsx(K,{sx:{mb:3},children:e.jsxs(Q,{children:[e.jsx(s,{variant:"h6",sx:{mb:2},children:"Order Summary"}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(s,{children:[b.name," Plan Ã— ",w]}),e.jsxs(s,{children:["$",W.toFixed(2)]})]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(s,{children:"Tax"}),e.jsxs(s,{children:["$",ee.toFixed(2)]})]}),e.jsx(Te,{sx:{my:1}}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",fontWeight:600},children:[e.jsx(s,{variant:"h6",children:"Total"}),e.jsxs(s,{variant:"h6",children:["$",O.toFixed(2)]})]})]})}),e.jsx(Js,{stripe:tt,children:e.jsx(nt,{purchaseData:fe,onPaymentSuccess:J,onPaymentError:i,processing:g})})]});case 3:return e.jsxs(n,{sx:{textAlign:"center"},children:[e.jsx(X,{sx:{fontSize:80,color:"success.main",mb:2}}),e.jsx(s,{variant:"h4",sx:{fontWeight:600,mb:2},children:"Payment Successful!"}),e.jsx(s,{variant:"body1",color:"text.secondary",sx:{mb:4},children:"Your licenses have been activated and are ready to use."}),e.jsx(K,{sx:{mb:3,textAlign:"left"},children:e.jsxs(Q,{children:[e.jsx(s,{variant:"h6",sx:{mb:2},children:"Purchase Details"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsxs(x,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Plan:"}),e.jsx(s,{variant:"body1",children:b.name})]}),e.jsxs(x,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Licenses:"}),e.jsx(s,{variant:"body1",children:w})]}),e.jsxs(x,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Monthly Cost:"}),e.jsxs(s,{variant:"body1",children:["$",O.toFixed(2)]})]}),e.jsxs(x,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Next Billing:"}),e.jsx(s,{variant:"body1",children:new Date(Date.now()+30*24*60*60*1e3).toLocaleDateString()})]})]})]})}),e.jsxs(n,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(v,{variant:"outlined",startIcon:e.jsx(Pe,{}),onClick:()=>z("Receipt downloaded",{variant:"success"}),children:"Download Receipt"}),e.jsx(v,{variant:"contained",startIcon:e.jsx(re,{}),onClick:()=>{E({licenses:[],invoice:{},subscription:{}}),F()},children:"View Licenses"})]})]});default:return null}};return e.jsxs(te,{open:a,onClose:F,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"70vh"}},children:[e.jsx(ne,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ss,{color:"primary"}),e.jsx(s,{variant:"h5",sx:{fontWeight:600},children:"Purchase Licenses"})]}),e.jsx(rs,{onClick:F,disabled:g,children:e.jsx(ws,{})})]})}),e.jsxs(ae,{sx:{pb:0},children:[e.jsx(Is,{activeStep:S,orientation:"horizontal",sx:{mb:4},children:R.map((c,r)=>e.jsx(As,{completed:c.completed,children:e.jsx(Es,{children:e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:c.label})})},c.id))}),e.jsx(n,{sx:{minHeight:400},children:ce(S)})]}),S<3&&e.jsxs(ie,{sx:{p:3,pt:2},children:[e.jsx(v,{onClick:ye,disabled:S===0||g,startIcon:e.jsx(Ps,{}),children:"Back"}),e.jsx(n,{sx:{flex:1}}),S<2&&e.jsx(v,{onClick:Z,variant:"contained",disabled:!ve(S),endIcon:e.jsx(Ts,{}),children:"Continue"})]})]})},it=a=>{switch(a){case"ACTIVE":return"success";case"PENDING":return"warning";case"SUSPENDED":return"error";case"EXPIRED":return"default";default:return"default"}},rt=a=>{switch(a){case"ACTIVE":return e.jsx(X,{});case"PENDING":return e.jsx(le,{});case"SUSPENDED":return e.jsx(Ue,{});case"EXPIRED":return e.jsx(ke,{});default:return e.jsx(os,{})}},lt=a=>{switch(a){case"BASIC":return"default";case"PROFESSIONAL":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},ot=()=>{const a=[];for(let h=0;h<4;h++)a.push(Math.random().toString(36).substr(2,4).toUpperCase());return`BL14-${a.join("-")}`},ze=(a,h)=>{if(!a)return"Unassigned";if(h&&a.email){const u=h.find(A=>A.email.toLowerCase()===a.email.toLowerCase());if(u){if(u.firstName&&u.lastName)return`${u.firstName} ${u.lastName}`;if(u.firstName)return u.firstName;if(u.lastName)return u.lastName}}return a.name&&a.name!=="Unknown User"?a.name:a.email?a.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(E=>E.charAt(0).toUpperCase()+E.slice(1).toLowerCase()).join(" "):"Unknown User"},as=(a,h)=>{if(!a)return"?";const u=ze(a,h);if(u==="Unassigned"||u==="Unknown User")return"?";const A=u.split(" ");return A.length>=2?(A[0].charAt(0)+A[1].charAt(0)).toUpperCase():u.charAt(0).toUpperCase()},Ee=a=>a.firstName&&a.lastName?`${a.firstName} ${a.lastName}`:a.firstName?a.firstName:a.lastName?a.lastName:a.email.split("@")[0],Ct=()=>{var Ve,He,Xe;const{enqueueSnackbar:a}=cs(),{data:h,loading:u,error:A}=Gs(),{data:E,loading:z,error:S}=qs(),{data:j,loading:R,error:_,refetch:g}=Vs(),{data:p,loading:b,error:Y}=Hs(),w=Xs(),G=Ks(),l=Ys();Zs();const[N,W]=d.useState(!1),[ee,O]=d.useState(!1),[fe,Z]=d.useState(!1),[ye,F]=d.useState(!1),[ve,J]=d.useState(!1),[i,q]=d.useState(null),[ce,c]=d.useState(null),[r,$]=d.useState(""),[k,de]=d.useState(""),[M,Re]=d.useState("PROFESSIONAL"),[U,Oe]=d.useState(1),[Fe,$e]=d.useState(""),[be,Be]=d.useState("PROFESSIONAL"),[Me,_e]=d.useState("PENDING"),[Ge,qe]=d.useState(""),ds=u||z||R||b,xs=A||S||_||Y;d.useEffect(()=>{const t=async o=>{var C;const I=o;console.log("ðŸ”„ License refresh event received:",I.detail),((C=I.detail)==null?void 0:C.action)==="created"&&await g()};return window.addEventListener("licenses:refresh",t),()=>{window.removeEventListener("licenses:refresh",t)}},[g]);const P=d.useMemo(()=>{if(!h||!E||!j)return{licenses:[],stats:{totalLicenses:0,activeLicenses:0,expiringSoon:0,unassignedLicenses:0,utilizationRate:0}};const t=j.length,o=j.filter(H=>H.status==="ACTIVE").length,I=j.filter(H=>{const he=new Date(H.expiresAt),Ce=new Date(Date.now()+30*24*60*60*1e3);return he<=Ce}).length,C=j.filter(H=>!H.assignedTo).length,L=t>0?o/t*100:0;return{licenses:j,stats:{totalLicenses:t,activeLicenses:o,expiringSoon:I,unassignedLicenses:C,utilizationRate:L}}},[h,E,j]),hs=(t,o)=>{console.log("ðŸ”§ [LicensesPage] Menu clicked for license:",o),q(o),c(t.currentTarget)},V=()=>{c(null)},us=t=>{navigator.clipboard.writeText(t),a("License key copied to clipboard",{variant:"success"}),V()},xe=d.useMemo(()=>{if(!p||!j)return[];const t=j.filter(o=>{var I;return(I=o.assignedTo)==null?void 0:I.userId}).map(o=>o.assignedTo.userId);return p.filter(o=>!t.includes(o.id))},[p,j]),ms=async()=>{if(!i||!k){a("Please select a valid team member to assign the license to",{variant:"error"});return}try{await l.mutate({licenseId:i.id,userId:k});const t=p==null?void 0:p.find(I=>I.id===k),o=t?Ee(t):"Unknown User";a(`License assigned to ${o}`,{variant:"success"}),de(""),Z(!1),V(),g()}catch(t){a((t==null?void 0:t.message)||"Failed to assign license",{variant:"error"})}},js=async()=>{var t,o,I;try{console.log("ðŸŽ« Starting license creation for",U,"license(s)...");const C=(j==null?void 0:j.length)||0;for(let L=0;L<U;L++){const se=ot(),H=C+L+1,he=`${M} License #${H.toString().padStart(3,"0")}`,Ce={key:se,name:he,tier:M,status:"PENDING",organization:{id:((t=h==null?void 0:h.organization)==null?void 0:t.id)||"",name:((o=h==null?void 0:h.organization)==null?void 0:o.name)||"",tier:((I=h==null?void 0:h.organization)==null?void 0:I.tier)||"BASIC"},usage:{apiCalls:0,dataTransfer:0,deviceCount:0,maxDevices:M==="ENTERPRISE"?10:M==="PROFESSIONAL"?5:2},expiresAt:new Date(Date.now()+365*24*60*60*1e3)};console.log(`ðŸŽ« Creating license ${L+1}/${U}: ${he} (${se})`);const Ls=await w.mutate(Ce);console.log(`âœ… License created with ID: ${Ls}`)}a(`${U} ${M.toLowerCase()} license(s) created successfully and ready for assignment`,{variant:"success"}),Re("PROFESSIONAL"),Oe(1),W(!1),console.log("ðŸ”„ Refreshing license data after creation..."),await g();try{const{unifiedDataService:L}=await is(async()=>{const{unifiedDataService:se}=await import("./UnifiedDataService-DQSAUp1m.js");return{unifiedDataService:se}},__vite__mapDeps([2,3,4,5,6,7,8,1,9,10,0]));await L.forceRefreshLicenses(),console.log("ðŸ”„ Force refreshed license data via UnifiedDataService")}catch(L){console.warn("âš ï¸ Failed to force refresh via UnifiedDataService:",L)}setTimeout(async()=>{console.log("ðŸ”„ Secondary refresh for eventual consistency..."),await g()},1e3),setTimeout(async()=>{console.log("ðŸ”„ Final refresh for safety..."),await g()},3e3),window.dispatchEvent(new CustomEvent("licenses:refresh",{detail:{action:"created",count:U,tier:M}}))}catch(C){console.error("âŒ License creation failed:",C),a((C==null?void 0:C.message)||"Failed to create license",{variant:"error"})}},ps=async()=>{if(i){try{await G.mutate({licenseId:i.id,updates:{status:"SUSPENDED"}}),a(`License ${i.name} has been suspended`,{variant:"warning"}),g()}catch(t){a((t==null?void 0:t.message)||"Failed to suspend license",{variant:"error"})}V()}},gs=async()=>{if(i){try{await G.mutate({licenseId:i.id,updates:{status:"ACTIVE"}}),a(`License ${i.name} has been activated`,{variant:"success"}),g()}catch(t){a((t==null?void 0:t.message)||"Failed to activate license",{variant:"error"})}V()}},fs=()=>{i&&(J(!0),V())},ys=async()=>{if(i)try{a(`License ${i.name} has been deleted`,{variant:"success"}),J(!1),q(null),g()}catch(t){a((t==null?void 0:t.message)||"Failed to delete license",{variant:"error"})}},vs=t=>{const o=t||i;if(!o){console.error("ðŸ”§ [LicensesPage] No license provided for editing"),a("Unable to load license data. Please try again.",{variant:"error"});return}console.log("ðŸ”§ [LicensesPage] Opening edit dialog for license:",o),q(o),$e(o.name),Be(o.tier),_e(o.status),qe(new Date(o.expiresAt).toISOString().split("T")[0]),V(),setTimeout(()=>{F(!0)},10)},bs=async()=>{if(i)try{await G.mutate({licenseId:i.id,updates:{name:Fe,tier:be,status:Me,expiresAt:new Date(Ge)}}),a(`License ${i.name} updated successfully`,{variant:"success"}),F(!1),q(null),g()}catch(t){a((t==null?void 0:t.message)||"Failed to update license",{variant:"error"})}},Cs=async t=>{console.log("ðŸŽ‰ [LicensesPage] Purchase completed:",t),a(`Successfully purchased ${t.licenses.length} license(s)! They are now active and ready to use.`,{variant:"success",autoHideDuration:6e3}),await g(),O(!1)};return ds?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(n,{textAlign:"center",children:[e.jsx(We,{size:60}),e.jsx(s,{variant:"h6",sx:{mt:2},children:"Loading License Data..."}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Fetching your licenses and subscription details"})]})}):xs?e.jsx(n,{sx:{p:3},children:e.jsxs(D,{severity:"error",children:[e.jsx(ge,{children:"Unable to Load License Data"}),e.jsx(s,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your license information. This could be due to:"}),e.jsxs(ls,{dense:!0,children:[e.jsxs(De,{children:[e.jsx(B,{children:e.jsx(ke,{fontSize:"small"})}),e.jsx(Ne,{primary:"Network connectivity issues"})]}),e.jsxs(De,{children:[e.jsx(B,{children:e.jsx(Ws,{fontSize:"small"})}),e.jsx(Ne,{primary:"Authentication token expired"})]})]}),e.jsx(n,{sx:{mt:2},children:e.jsx(v,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!h||!E?e.jsx(n,{sx:{p:3},children:e.jsxs(D,{severity:"info",children:[e.jsx(ge,{children:"Setting Up License Management"}),e.jsx(s,{variant:"body2",children:"We're preparing your license management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(n,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsxs(s,{variant:"body1",color:"text.secondary",children:["Manage your ",((Ve=E.organization)==null?void 0:Ve.name)||"Organization"," licenses and assignments",j&&e.jsxs("span",{style:{marginLeft:"8px",fontWeight:500,color:"primary.main"},children:["â€¢ ",j.length," total licenses"]})]})]}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(v,{variant:"outlined",startIcon:e.jsx(Le,{}),onClick:()=>W(!0),sx:{fontWeight:600},children:"Generate Test License"}),e.jsx(v,{variant:"contained",startIcon:e.jsx(Le,{}),onClick:()=>O(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Purchase Licenses"})]})]}),e.jsxs(x,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(x,{item:!0,xs:12,sm:6,md:3,children:e.jsx(pe,{title:"Total Licenses",value:P.stats.totalLicenses.toString(),icon:e.jsx(os,{}),color:"primary"})}),e.jsx(x,{item:!0,xs:12,sm:6,md:3,children:e.jsx(pe,{title:"Active Licenses",value:P.stats.activeLicenses.toString(),icon:e.jsx(X,{}),color:"success"})}),e.jsx(x,{item:!0,xs:12,sm:6,md:3,children:e.jsx(pe,{title:"Expiring Soon",value:P.stats.expiringSoon.toString(),icon:e.jsx(le,{}),color:"warning"})}),e.jsx(x,{item:!0,xs:12,sm:6,md:3,children:e.jsx(pe,{title:"Unassigned",value:P.stats.unassignedLicenses.toString(),icon:e.jsx(Ke,{}),color:"secondary"})})]}),e.jsx(K,{sx:{mb:4},children:e.jsxs(Q,{children:[e.jsx(s,{variant:"h6",sx:{fontWeight:600,mb:2},children:"License Utilization"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(Ye,{variant:"determinate",value:P.stats.utilizationRate,sx:{flex:1,height:8,borderRadius:4}}),e.jsxs(s,{variant:"body2",sx:{minWidth:60},children:[P.stats.utilizationRate.toFixed(1),"%"]})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[P.stats.activeLicenses," of ",P.stats.totalLicenses," licenses are currently active"]})]})}),P.stats.expiringSoon>0&&e.jsxs(D,{severity:"warning",sx:{mb:4},children:[e.jsx(ge,{children:"Licenses Expiring Soon"}),e.jsxs(s,{variant:"body2",sx:{mb:2},children:[P.stats.expiringSoon," license(s) will expire within the next 30 days."]}),e.jsx(v,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Renew Licenses"})]}),e.jsx(K,{children:e.jsxs(Q,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600},children:["All Licenses (",P.licenses.length,")"]}),e.jsx(v,{variant:"outlined",startIcon:e.jsx(Pe,{}),onClick:()=>a("License report downloaded",{variant:"success"}),children:"Export Report"})]}),e.jsx(ks,{children:e.jsxs(Us,{children:[e.jsx(zs,{children:e.jsxs(Ze,{children:[e.jsx(f,{sx:{fontWeight:600},children:"License"}),e.jsx(f,{sx:{fontWeight:600},children:"Tier"}),e.jsx(f,{sx:{fontWeight:600},children:"Status"}),e.jsx(f,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(f,{sx:{fontWeight:600},children:"Department"}),e.jsx(f,{sx:{fontWeight:600},children:"Role"}),e.jsx(f,{sx:{fontWeight:600},children:"Usage"}),e.jsx(f,{sx:{fontWeight:600},children:"Expires"}),e.jsx(f,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Rs,{children:P.licenses.map(t=>{var o,I;return e.jsxs(Ze,{hover:!0,children:[e.jsx(f,{children:e.jsxs(n,{children:[e.jsx(s,{variant:"body1",sx:{fontWeight:500},children:t.name}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:t.key})]})}),e.jsx(f,{children:e.jsx(oe,{label:t.tier,color:lt(t.tier),size:"small",icon:t.tier==="ENTERPRISE"?e.jsx(Je,{}):void 0})}),e.jsx(f,{children:e.jsx(oe,{icon:rt(t.status),label:t.status,color:it(t.status),size:"small"})}),e.jsx(f,{children:t.assignedTo?e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Se,{sx:{width:24,height:24},children:as(t.assignedTo,p)}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:ze(t.assignedTo,p)}),e.jsx(s,{variant:"caption",color:"text.secondary",children:t.assignedTo.email})]})]}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(f,{children:e.jsx(s,{variant:"body2",color:"text.secondary",children:t.assignedTo?((o=p==null?void 0:p.find(C=>{var L;return C.email===((L=t.assignedTo)==null?void 0:L.email)}))==null?void 0:o.department)||"Not specified":"â€”"})}),e.jsx(f,{children:t.assignedTo?e.jsx(oe,{label:((I=p==null?void 0:p.find(C=>{var L;return C.email===((L=t.assignedTo)==null?void 0:L.email)}))==null?void 0:I.role)||"Member",color:"primary",size:"small",variant:"outlined"}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"â€”"})}),e.jsx(f,{children:e.jsxs(n,{children:[e.jsxs(s,{variant:"body2",children:[t.usage.apiCalls.toLocaleString()," API calls"]}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:[t.usage.dataTransfer," GB transferred"]})]})}),e.jsx(f,{children:e.jsx(s,{variant:"body2",color:new Date(t.expiresAt)<=new Date(Date.now()+30*24*60*60*1e3)?"warning.main":"text.primary",children:new Date(t.expiresAt).toLocaleDateString()})}),e.jsx(f,{children:e.jsx(rs,{size:"small",onClick:C=>hs(C,t),children:e.jsx(Os,{})})})]},t.id)})})]})})]})}),e.jsx(Fs,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"},background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)"},onClick:()=>O(!0),children:e.jsx(Le,{})}),e.jsxs(te,{open:N,onClose:()=>W(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ne,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(re,{color:"primary"}),"Generate New Licenses"]})}),e.jsx(ae,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(D,{severity:"info",children:[e.jsx(s,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"Automatic License Generation"})}),e.jsx(s,{variant:"body2",children:"Licenses will be automatically generated with unique names and keys. You can assign them to team members after creation."})]}),e.jsxs(ue,{fullWidth:!0,children:[e.jsx(me,{children:"License Tier"}),e.jsxs(je,{value:M,label:"License Tier",onChange:t=>Re(t.target.value),children:[e.jsx(y,{value:"BASIC",children:e.jsxs(n,{children:[e.jsx(s,{variant:"body1",children:"Basic"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Limited features â€¢ 2 max devices"})]})}),e.jsx(y,{value:"PROFESSIONAL",children:e.jsxs(n,{children:[e.jsx(s,{variant:"body1",children:"Professional"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Full features â€¢ 5 max devices"})]})}),e.jsx(y,{value:"ENTERPRISE",children:e.jsxs(n,{children:[e.jsx(s,{variant:"body1",children:"Enterprise"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Advanced features â€¢ 10 max devices"})]})})]})]}),e.jsx(m,{fullWidth:!0,label:"Number of Licenses to Generate",type:"number",value:U,onChange:t=>Oe(parseInt(t.target.value)||1),inputProps:{min:1,max:50},helperText:`Will generate ${U} ${M.toLowerCase()} license${U>1?"s":""}`}),e.jsx(D,{severity:"success",children:e.jsxs(s,{variant:"body2",children:["âœ… Each license will have a 1-year validity period",e.jsx("br",{}),"âœ… Licenses can be assigned to team members immediately",e.jsx("br",{}),"âœ… Unique license keys will be automatically generated"]})})]})}),e.jsxs(ie,{children:[e.jsx(v,{onClick:()=>W(!1),children:"Cancel"}),e.jsxs(v,{onClick:js,variant:"contained",startIcon:e.jsx(re,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:["Generate ",U," License",U>1?"s":""]})]})]}),e.jsxs(te,{open:fe,onClose:()=>Z(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ne,{children:"Assign License"}),e.jsx(ae,{children:i&&e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(D,{severity:"info",children:e.jsxs(s,{variant:"body2",children:["Assigning license: ",e.jsx("strong",{children:i.name})]})}),e.jsxs(ue,{fullWidth:!0,children:[e.jsx(me,{children:"Assign To"}),e.jsx(je,{value:k,label:"Assign To",onChange:t=>de(t.target.value),disabled:xe.length===0,children:xe.length===0?e.jsx(y,{disabled:!0,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"No available team members for assignment"})}):xe.map(t=>e.jsx(y,{value:t.id,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Se,{sx:{width:24,height:24},children:Ee(t).charAt(0)}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:Ee(t)}),e.jsx(s,{variant:"caption",color:"text.secondary",children:t.email})]})]})},t.id))})]}),xe.length===0&&e.jsx(D,{severity:"info",children:e.jsx(s,{variant:"body2",children:"All team members already have licenses assigned. To assign this license, you'll need to unassign another license first or invite new team members."})}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"The user will receive an email with instructions to activate their license."})]})}),e.jsxs(ie,{children:[e.jsx(v,{onClick:()=>Z(!1),children:"Cancel"}),e.jsx(v,{onClick:ms,variant:"contained",startIcon:e.jsx(we,{}),children:"Assign License"})]})]}),e.jsxs(te,{open:ve,onClose:()=>J(!1),maxWidth:"sm",children:[e.jsx(ne,{children:"Delete License"}),e.jsx(ae,{children:i&&e.jsxs(n,{children:[e.jsxs(s,{variant:"body1",sx:{mb:2},children:["Are you sure you want to delete ",e.jsx("strong",{children:i.name}),"?"]}),e.jsx(D,{severity:"warning",children:e.jsx(s,{variant:"body2",children:"This action cannot be undone. The license will be permanently removed and any assigned user will lose access."})})]})}),e.jsxs(ie,{children:[e.jsx(v,{onClick:()=>J(!1),children:"Cancel"}),e.jsx(v,{onClick:ys,variant:"contained",color:"error",startIcon:e.jsx(Qe,{}),children:"Delete License"})]})]}),e.jsxs(te,{open:ye,onClose:()=>{F(!1),q(null)},maxWidth:"md",fullWidth:!0,children:[e.jsx(ne,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ie,{}),"Edit License: ",(i==null?void 0:i.name)||"Loading..."]})}),e.jsx(ae,{children:i?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(re,{})," Basic Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(m,{fullWidth:!0,label:"License Name",value:Fe,onChange:t=>$e(t.target.value),placeholder:"Development Team License",required:!0}),e.jsx(m,{fullWidth:!0,label:"License Key",value:i.key,disabled:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(re,{})})},helperText:"License key is automatically generated and cannot be changed"})]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(ue,{fullWidth:!0,children:[e.jsx(me,{children:"License Tier"}),e.jsxs(je,{value:be,label:"License Tier",onChange:t=>Be(t.target.value),children:[e.jsx(y,{value:"BASIC",children:e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Basic"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Limited features â€¢ 2 max devices â€¢ Basic support"})]})}),e.jsx(y,{value:"PROFESSIONAL",children:e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Professional"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Full features â€¢ 5 max devices â€¢ Priority support"})]})}),e.jsx(y,{value:"ENTERPRISE",children:e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Enterprise"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Advanced features â€¢ 10 max devices â€¢ 24/7 support"})]})})]})]}),e.jsxs(ue,{fullWidth:!0,children:[e.jsx(me,{children:"Status"}),e.jsxs(je,{value:Me,label:"Status",onChange:t=>_e(t.target.value),children:[e.jsx(y,{value:"PENDING",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(le,{color:"warning"}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Pending"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Awaiting activation"})]})]})}),e.jsx(y,{value:"ACTIVE",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(X,{color:"success"}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Active"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Fully operational"})]})]})}),e.jsx(y,{value:"SUSPENDED",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ue,{color:"error"}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Suspended"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Temporarily disabled"})]})]})}),e.jsx(y,{value:"EXPIRED",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ke,{color:"warning"}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Expired"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Past expiration date"})]})]})})]})]})]}),e.jsx(m,{fullWidth:!0,label:"Expiration Date",type:"date",value:Ge,onChange:t=>qe(t.target.value),InputLabelProps:{shrink:!0},required:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(le,{})})}})]}),e.jsxs(n,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(es,{})," Usage & Limits"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(m,{fullWidth:!0,label:"Max Devices",value:i.usage.maxDevices,disabled:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(Ke,{})})},helperText:`${be} tier limit`}),e.jsx(m,{fullWidth:!0,label:"Current Devices",value:i.usage.deviceCount,disabled:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(X,{})})}})]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(m,{fullWidth:!0,label:"API Calls Used",value:i.usage.apiCalls.toLocaleString(),disabled:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(es,{})})}}),e.jsx(m,{fullWidth:!0,label:"Data Transfer (GB)",value:i.usage.dataTransfer,disabled:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(Pe,{})})}})]}),e.jsxs(n,{sx:{mt:2},children:[e.jsxs(s,{variant:"body2",sx:{mb:1},children:["Device Usage: ",i.usage.deviceCount," / ",i.usage.maxDevices]}),e.jsx(Ye,{variant:"determinate",value:i.usage.deviceCount/i.usage.maxDevices*100,sx:{height:8,borderRadius:4},color:i.usage.deviceCount>=i.usage.maxDevices?"error":"primary"})]})]}),e.jsxs(n,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(we,{})," Assignment Information"]}),i.assignedTo?e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(m,{fullWidth:!0,label:"Assigned To",value:ze(i.assignedTo,p),disabled:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(Se,{sx:{width:20,height:20},children:as(i.assignedTo,p)})})}}),e.jsx(m,{fullWidth:!0,label:"User Email",value:i.assignedTo.email,disabled:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx($s,{})})}})]}):e.jsx(D,{severity:"info",children:e.jsx(s,{variant:"body2",children:'This license is currently unassigned. Use the "Assign License" action to assign it to a team member.'})})]}),e.jsxs(n,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ss,{})," Organization & Metadata"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(m,{fullWidth:!0,label:"Organization",value:((He=i.organization)==null?void 0:He.name)||"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(ss,{})})}}),e.jsx(m,{fullWidth:!0,label:"Organization Tier",value:((Xe=i.organization)==null?void 0:Xe.tier)||"BASIC",disabled:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(Je,{})})}})]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(m,{fullWidth:!0,label:"Created Date",value:i.createdAt?new Date(i.createdAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(le,{})})}}),e.jsx(m,{fullWidth:!0,label:"Last Updated",value:i.updatedAt?new Date(i.updatedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(T,{position:"start",children:e.jsx(Bs,{})})}})]})]}),e.jsxs(D,{severity:"warning",children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500,mb:1},children:"âš ï¸ Important Notes"}),e.jsxs(s,{variant:"body2",children:["â€¢ Changing the license tier will update device limits and feature access",e.jsx("br",{}),"â€¢ Status changes will immediately affect the user's access to the system",e.jsx("br",{}),"â€¢ Expiration date changes should be communicated to the license holder",e.jsx("br",{}),"â€¢ Some fields are system-managed and cannot be edited here"]})]})]}):e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(n,{textAlign:"center",children:[e.jsx(We,{size:40,sx:{mb:2}}),e.jsx(s,{variant:"body1",color:"text.secondary",children:"Loading license data..."}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"If this persists, please try again or refresh the page."})]})})}),e.jsxs(ie,{children:[e.jsx(v,{onClick:()=>F(!1),children:"Cancel"}),e.jsx(v,{onClick:bs,variant:"contained",startIcon:e.jsx(Ie,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(Ms,{anchorEl:ce,open:!!ce,onClose:V,children:[e.jsxs(y,{onClick:()=>i&&us(i.key),children:[e.jsx(B,{children:e.jsx(_s,{})}),"Copy License Key"]}),!(i!=null&&i.assignedTo)&&e.jsxs(y,{onClick:()=>Z(!0),children:[e.jsx(B,{children:e.jsx(we,{})}),"Assign License"]}),e.jsxs(y,{onClick:()=>i&&vs(i),children:[e.jsx(B,{children:e.jsx(Ie,{})}),"Edit License"]}),e.jsx(Te,{}),(i==null?void 0:i.status)==="ACTIVE"?e.jsxs(y,{onClick:ps,children:[e.jsx(B,{children:e.jsx(Ue,{})}),"Suspend License"]}):e.jsxs(y,{onClick:gs,children:[e.jsx(B,{children:e.jsx(X,{})}),"Activate License"]}),e.jsx(Te,{}),e.jsxs(y,{onClick:fs,sx:{color:"error.main"},children:[e.jsx(B,{children:e.jsx(Qe,{sx:{color:"error.main"}})}),"Delete License"]})]}),e.jsx(at,{open:ee,onClose:()=>O(!1),initialPlan:"professional",initialQuantity:1,onPurchaseComplete:Cs})]})};export{Ct as default};
