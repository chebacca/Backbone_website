import{j as e,a as r,T as n,d as y,az as ie,G as j,k as S,l as L,D as O,c as $,u as X,aQ as oe,aR as ce,aS as de,aT as le,aU as xe,aV as q,aW as t,aX as he,at as ue,h as H,I as ge,aY as je,aj as me,a4 as x,X as h,aZ as pe,a_ as be,a$ as fe,b0 as ve,i as Ce,as as ye,aD as Se,aE as Le,aF as Ae,aN as ke,n as K,b1 as Q,O as Ie}from"./mui-BChHEy9L.js";import{r as o}from"./vendor-OeuszDaU.js";import{u as Te}from"./notistack.esm-CcFOI6Un.js";import{u as Ee,c as k,e as I}from"./index-CUpnOosL.js";import"./stripe-D5_9WE-2.js";const De=i=>{switch(i){case"ACTIVE":return"success";case"SUSPENDED":return"warning";case"EXPIRED":return"error";case"PENDING":return"info";default:return"default"}},we=i=>{switch(i){case"ACTIVE":return e.jsx(K,{});case"SUSPENDED":return e.jsx(Q,{});case"EXPIRED":return e.jsx(Ie,{});case"PENDING":return e.jsx(Q,{});default:return e.jsx(K,{})}},Pe=i=>{switch(i){case"BASIC":return"default";case"PRO":return"success";case"ENTERPRISE":return"secondary";default:return"default"}},We=i=>i==="BASIC"?"outlined":"filled",Ne=()=>{const{enqueueSnackbar:i}=Te(),{user:l}=Ee(),[Re,T]=o.useState(!1),[u,E]=o.useState([]),[D,w]=o.useState(null),[d,P]=o.useState(null),[Y,m]=o.useState(!1),[p,W]=o.useState(""),[b,Z]=o.useState("");o.useEffect(()=>{let s=!0;return(async()=>{var c,M,z,U,B,F;try{T(!0);const re=String((l==null?void 0:l.role)||"").toUpperCase()==="SUPERADMIN";let C=[];if(re)try{C=((M=(c=(await k.get(`${I.admin.licenses()}?limit=200`)).data)==null?void 0:c.data)==null?void 0:M.licenses)??[]}catch{C=((U=(z=(await k.get(I.licenses.myLicenses())).data)==null?void 0:z.data)==null?void 0:U.licenses)??[]}else C=((F=(B=(await k.get(I.licenses.myLicenses())).data)==null?void 0:B.data)==null?void 0:F.licenses)??[];const te=C.map((a,N)=>{var V,G;return{id:a.id,key:a.key,name:(V=a.user)!=null&&V.name?`${a.user.name}'s License`:`License ${N+1}`,tier:String(a.tier||"").toUpperCase(),status:String(a.status||"").toUpperCase(),assignedTo:(G=a.user)!=null&&G.name?{name:a.user.name,email:a.user.email||""}:void 0,activatedAt:a.activatedAt||a.createdAt||void 0,expiresAt:a.expiresAt||a.currentPeriodEnd||new Date(Date.now()+30*24*3600*1e3).toISOString(),lastUsed:a.updatedAt||a.activatedAt||a.createdAt||void 0,deviceCount:a.activationCount??0,maxDevices:a.maxActivations??1,usage:{apiCalls:0,dataTransfer:0}}});if(!s)return;E(te)}catch(v){if(!s)return;i((v==null?void 0:v.message)||"Failed to load licenses",{variant:"error"}),E([])}finally{s&&T(!1)}})(),()=>{s=!1}},[l==null?void 0:l.role,i]);const _=(s,c)=>{w(s.currentTarget),P(c)},g=()=>{w(null),P(null)},J=s=>{navigator.clipboard.writeText(s),i("License key copied to clipboard",{variant:"success"}),g()},ee=()=>{d&&p&&(i(`License assigned to ${p}`,{variant:"success"}),m(!1),W(""),g())},se=()=>{d&&(i("License suspended",{variant:"warning"}),g())},ae=()=>{d&&(i("License activated",{variant:"success"}),g())},ne=u.filter(s=>{var c;return s.name.toLowerCase().includes(b.toLowerCase())||s.key.toLowerCase().includes(b.toLowerCase())||(((c=s.assignedTo)==null?void 0:c.email)||"").toLowerCase().includes(b.toLowerCase())}),A=o.useMemo(()=>u.filter(s=>s.status==="ACTIVE").length,[u]),f=o.useMemo(()=>u.length,[u]),R=o.useMemo(()=>f<=0?0:Math.round(A/f*100),[A,f]);return e.jsxs(r,{children:[e.jsx(r,{children:e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(r,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsx(n,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Manage and monitor your BackboneLogic, Inc. licenses"})]}),e.jsx(y,{variant:"contained",startIcon:e.jsx(ie,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Add License"})]})}),e.jsxs(j,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(r,{children:e.jsx(S,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(L,{children:[e.jsx(n,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:A}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Active Licenses"})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(r,{children:e.jsx(S,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(L,{children:[e.jsx(n,{variant:"h3",sx:{fontWeight:700},children:f}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Total Licenses"})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(r,{children:e.jsx(S,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(L,{children:[e.jsxs(n,{variant:"h3",sx:{fontWeight:700},children:[R,"%"]}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Utilization Rate"}),e.jsx(O,{variant:"determinate",value:R,sx:{mt:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(r,{children:e.jsx(S,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(L,{children:[e.jsx(n,{variant:"h3",sx:{fontWeight:700},children:"15"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Days to Renewal"})]})})})})]}),e.jsx(r,{children:e.jsx($,{sx:{p:3,mb:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(r,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(X,{placeholder:"Search licenses...",value:b,onChange:s=>Z(s.target.value),size:"small",sx:{flex:1},InputProps:{startAdornment:e.jsx(oe,{sx:{color:"text.secondary",mr:1}})}}),e.jsx(y,{variant:"outlined",startIcon:e.jsx(ce,{}),sx:{whiteSpace:"nowrap"},children:"Filters"})]})})}),e.jsx(r,{children:e.jsx(de,{component:$,sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(le,{children:[e.jsx(xe,{children:e.jsxs(q,{children:[e.jsx(t,{sx:{fontWeight:600},children:"License"}),e.jsx(t,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(t,{sx:{fontWeight:600},children:"Status"}),e.jsx(t,{sx:{fontWeight:600},children:"Tier"}),e.jsx(t,{sx:{fontWeight:600},children:"Devices"}),e.jsx(t,{sx:{fontWeight:600},children:"Usage"}),e.jsx(t,{sx:{fontWeight:600},children:"Expires"}),e.jsx(t,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(he,{children:ne.map(s=>e.jsxs(q,{hover:!0,children:[e.jsx(t,{children:e.jsxs(r,{children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:s.name}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:s.key})]})}),e.jsx(t,{children:s.assignedTo?e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ue,{sx:{width:32,height:32,fontSize:"0.875rem"},children:s.assignedTo.name[0]}),e.jsxs(r,{children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:s.assignedTo.name}),e.jsx(n,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(t,{children:e.jsx(H,{icon:we(s.status),label:s.status,color:De(s.status),size:"small",sx:{fontWeight:500}})}),e.jsx(t,{children:e.jsx(H,{label:s.tier,color:Pe(s.tier),size:"small",variant:We(s.tier)})}),e.jsx(t,{children:e.jsxs(r,{children:[e.jsxs(n,{variant:"body2",children:[s.deviceCount,"/",s.maxDevices]}),e.jsx(O,{variant:"determinate",value:s.deviceCount/s.maxDevices*100,sx:{width:80,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2}}})]})}),e.jsx(t,{children:e.jsxs(r,{children:[e.jsxs(n,{variant:"body2",children:[s.usage.apiCalls.toLocaleString()," calls"]}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:[s.usage.dataTransfer," GB"]})]})}),e.jsx(t,{children:e.jsx(n,{variant:"body2",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsx(t,{children:e.jsx(ge,{onClick:c=>_(c,s),size:"small",children:e.jsx(je,{})})})]},s.id))})]})})}),e.jsxs(me,{anchorEl:D,open:!!D,onClose:g,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsxs(x,{onClick:()=>d&&J(d.key),children:[e.jsx(h,{children:e.jsx(pe,{fontSize:"small"})}),"Copy License Key"]}),e.jsxs(x,{onClick:()=>m(!0),children:[e.jsx(h,{children:e.jsx(be,{fontSize:"small"})}),"Assign License"]}),e.jsxs(x,{onClick:()=>{},children:[e.jsx(h,{children:e.jsx(fe,{fontSize:"small"})}),"Edit License"]}),(d==null?void 0:d.status)==="ACTIVE"?e.jsxs(x,{onClick:se,children:[e.jsx(h,{children:e.jsx(ve,{fontSize:"small"})}),"Suspend License"]}):e.jsxs(x,{onClick:ae,children:[e.jsx(h,{children:e.jsx(Ce,{fontSize:"small"})}),"Activate License"]}),e.jsxs(x,{onClick:()=>{},children:[e.jsx(h,{children:e.jsx(ye,{fontSize:"small"})}),"Download Details"]})]}),e.jsxs(Se,{open:Y,onClose:()=>m(!1),PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(Le,{children:"Assign License"}),e.jsx(Ae,{children:e.jsx(X,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",fullWidth:!0,variant:"outlined",value:p,onChange:s=>W(s.target.value),sx:{mt:2}})}),e.jsxs(ke,{children:[e.jsx(y,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(y,{onClick:ee,variant:"contained",disabled:!p,children:"Assign"})]})]})]})};export{Ne as default};
