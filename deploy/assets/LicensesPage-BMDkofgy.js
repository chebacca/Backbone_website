import{j as e,B as r,C as $e,T as a,d as y,ai as z,w as Ge,x as Z,y as f,aj as ue,z as ee,H as Ve,a as m,ap as se,G as w,ae as je,p as V,am as ge,al as He,t as ne,v as ae,i as Ke,af as qe,aq as Xe,ar as _e,as as Je,at as ie,au as o,av as Qe,r as O,u as Ye,ag as te,g as Ze,aw as es,ax as ss,ay as F,az as M,aA as B,e as re,aB as le,aC as oe,aD as ce,a5 as j,aE as $,aF as ns,aG as de,aH as xe,a4 as as,aI as is,aJ as ts,D as he,aK as me}from"./mui-Dvh35qVf.js";import{r as d}from"./vendor-CjD1bmmO.js";import{u as rs}from"./notistack.esm-Ca-E78ev.js";import{u as ls,a as os,b as cs,c as ds,d as xs,e as hs,f as us,g as js}from"./useStreamlinedData-BKRUA3DU.js";import{M as R}from"./MetricCard-C5FutAvg.js";import"./UnifiedDataService-BZED9bIv.js";import"./index-C-Kxbqvo.js";import"./stripe-CbtnRl6i.js";import"./index.esm-DonjM_pP.js";import"./index.esm-D7ujsXeY.js";const gs=n=>{switch(n){case"ACTIVE":return"success";case"PENDING":return"warning";case"SUSPENDED":return"error";case"EXPIRED":return"default";default:return"default"}},ms=n=>{switch(n){case"ACTIVE":return e.jsx(V,{});case"PENDING":return e.jsx(ge,{});case"SUSPENDED":return e.jsx(me,{});case"EXPIRED":return e.jsx(ue,{});default:return e.jsx(je,{})}},ps=n=>{switch(n){case"BASIC":return"default";case"PROFESSIONAL":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},fs=()=>{const n=[];for(let t=0;t<4;t++)n.push(Math.random().toString(36).substr(2,4).toUpperCase());return`BL14-${n.join("-")}`},pe=n=>n?n.name&&n.name!=="Unknown User"?n.name:n.email?n.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(S=>S.charAt(0).toUpperCase()+S.slice(1).toLowerCase()).join(" "):"Unknown User":"Unassigned",ys=n=>{if(!n)return"?";const t=pe(n);if(t==="Unassigned"||t==="Unknown User")return"?";const v=t.split(" ");return v.length>=2?(v[0].charAt(0)+v[1].charAt(0)).toUpperCase():t.charAt(0).toUpperCase()},G=n=>n.firstName&&n.lastName?`${n.firstName} ${n.lastName}`:n.firstName?n.firstName:n.lastName?n.lastName:n.email.split("@")[0],Ws=()=>{var Y;const{enqueueSnackbar:n}=rs(),{data:t,loading:v,error:S}=ls(),{data:I,loading:fe,error:ye}=os(),{data:g,loading:ve,error:Le,refetch:D}=cs(),{data:x,loading:Ce,error:be}=ds(),we=xs(),H=hs(),Se=us();js();const[Ie,C]=d.useState(!1),[De,E]=d.useState(!1),[vs,Ee]=d.useState(!1),[Ae,A]=d.useState(!1),[i,U]=d.useState(null),[K,q]=d.useState(null),[Ls,Cs]=d.useState(""),[T,X]=d.useState(""),[N,_]=d.useState(""),[k,J]=d.useState("PROFESSIONAL"),[P,Q]=d.useState(1),Te=v||fe||ve||Ce,Ne=S||ye||Le||be,h=d.useMemo(()=>{if(!t||!I||!g)return{licenses:[],stats:{totalLicenses:0,activeLicenses:0,expiringSoon:0,unassignedLicenses:0,utilizationRate:0}};const s=g.length,l=g.filter(b=>b.status==="ACTIVE").length,u=g.filter(b=>{const Me=new Date(b.expiresAt),Be=new Date(Date.now()+30*24*60*60*1e3);return Me<=Be}).length,c=g.filter(b=>!b.assignedTo).length,p=s>0?l/s*100:0;return{licenses:g,stats:{totalLicenses:s,activeLicenses:l,expiringSoon:u,unassignedLicenses:c,utilizationRate:p}}},[t,I,g]),ke=(s,l)=>{U(l),q(s.currentTarget)},L=()=>{q(null),U(null)},Pe=s=>{navigator.clipboard.writeText(s),n("License key copied to clipboard",{variant:"success"}),L()},W=d.useMemo(()=>{if(!x||!g)return[];const s=g.filter(l=>{var u;return(u=l.assignedTo)==null?void 0:u.userId}).map(l=>l.assignedTo.userId);return x.filter(l=>!s.includes(l.id))},[x,g]),We=async()=>{if(!i||!T){n("Please select a valid team member to assign the license to",{variant:"error"});return}try{await Se.mutate({licenseId:i.id,userId:T});const s=x==null?void 0:x.find(u=>u.id===T),l=s?G(s):"Unknown User";n(`License assigned to ${l}`,{variant:"success"}),X(""),E(!1),L(),D()}catch(s){n((s==null?void 0:s.message)||"Failed to assign license",{variant:"error"})}},Re=async()=>{var s,l,u;if(!N.trim()){n("Please enter a license name",{variant:"error"});return}try{for(let c=0;c<P;c++){const p={key:fs(),name:P>1?`${N} ${c+1}`:N,tier:k,status:"PENDING",organization:{id:((s=t==null?void 0:t.organization)==null?void 0:s.id)||"",name:((l=t==null?void 0:t.organization)==null?void 0:l.name)||"",tier:((u=t==null?void 0:t.organization)==null?void 0:u.tier)||"BASIC"},usage:{apiCalls:0,dataTransfer:0,deviceCount:0,maxDevices:k==="ENTERPRISE"?10:k==="PROFESSIONAL"?5:2},expiresAt:new Date(Date.now()+31536e6)};await we.mutate(p)}n(`${P} license(s) created successfully`,{variant:"success"}),_(""),J("PROFESSIONAL"),Q(1),C(!1),D()}catch(c){n((c==null?void 0:c.message)||"Failed to create license",{variant:"error"})}},Ue=async()=>{if(i){try{await H.mutate({licenseId:i.id,updates:{status:"SUSPENDED"}}),n(`License ${i.name} has been suspended`,{variant:"warning"}),D()}catch(s){n((s==null?void 0:s.message)||"Failed to suspend license",{variant:"error"})}L()}},ze=async()=>{if(i){try{await H.mutate({licenseId:i.id,updates:{status:"ACTIVE"}}),n(`License ${i.name} has been activated`,{variant:"success"}),D()}catch(s){n((s==null?void 0:s.message)||"Failed to activate license",{variant:"error"})}L()}},Oe=()=>{i&&(A(!0),L())},Fe=async()=>{if(i)try{n(`License ${i.name} has been deleted`,{variant:"success"}),A(!1),U(null)}catch(s){n((s==null?void 0:s.message)||"Failed to delete license",{variant:"error"})}};return Te?e.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(r,{textAlign:"center",children:[e.jsx($e,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading License Data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Fetching your licenses and subscription details"})]})}):Ne?e.jsx(r,{sx:{p:3},children:e.jsxs(y,{severity:"error",children:[e.jsx(z,{children:"Unable to Load License Data"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your license information. This could be due to:"}),e.jsxs(Ge,{dense:!0,children:[e.jsxs(Z,{children:[e.jsx(f,{children:e.jsx(ue,{fontSize:"small"})}),e.jsx(ee,{primary:"Network connectivity issues"})]}),e.jsxs(Z,{children:[e.jsx(f,{children:e.jsx(Ve,{fontSize:"small"})}),e.jsx(ee,{primary:"Authentication token expired"})]})]}),e.jsx(r,{sx:{mt:2},children:e.jsx(m,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!t||!I?e.jsx(r,{sx:{p:3},children:e.jsxs(y,{severity:"info",children:[e.jsx(z,{children:"Setting Up License Management"}),e.jsx(a,{variant:"body2",children:"We're preparing your license management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(r,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(r,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsxs(a,{variant:"body1",color:"text.secondary",children:["Manage your ",((Y=I.organization)==null?void 0:Y.name)||"Organization"," licenses and assignments"]})]}),e.jsx(m,{variant:"contained",startIcon:e.jsx(se,{}),onClick:()=>C(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Create License"})]}),e.jsxs(w,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(w,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{title:"Total Licenses",value:h.stats.totalLicenses.toString(),icon:e.jsx(je,{}),color:"primary"})}),e.jsx(w,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{title:"Active Licenses",value:h.stats.activeLicenses.toString(),icon:e.jsx(V,{}),color:"success"})}),e.jsx(w,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{title:"Expiring Soon",value:h.stats.expiringSoon.toString(),icon:e.jsx(ge,{}),color:"warning"})}),e.jsx(w,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{title:"Unassigned",value:h.stats.unassignedLicenses.toString(),icon:e.jsx(He,{}),color:"secondary"})})]}),e.jsx(ne,{sx:{mb:4},children:e.jsxs(ae,{children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600,mb:2},children:"License Utilization"}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(Ke,{variant:"determinate",value:h.stats.utilizationRate,sx:{flex:1,height:8,borderRadius:4}}),e.jsxs(a,{variant:"body2",sx:{minWidth:60},children:[h.stats.utilizationRate.toFixed(1),"%"]})]}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:[h.stats.activeLicenses," of ",h.stats.totalLicenses," licenses are currently active"]})]})}),h.stats.expiringSoon>0&&e.jsxs(y,{severity:"warning",sx:{mb:4},children:[e.jsx(z,{children:"Licenses Expiring Soon"}),e.jsxs(a,{variant:"body2",sx:{mb:2},children:[h.stats.expiringSoon," license(s) will expire within the next 30 days."]}),e.jsx(m,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Renew Licenses"})]}),e.jsx(ne,{children:e.jsxs(ae,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600},children:["All Licenses (",h.licenses.length,")"]}),e.jsx(m,{variant:"outlined",startIcon:e.jsx(qe,{}),onClick:()=>n("License report downloaded",{variant:"success"}),children:"Export Report"})]}),e.jsx(Xe,{children:e.jsxs(_e,{children:[e.jsx(Je,{children:e.jsxs(ie,{children:[e.jsx(o,{sx:{fontWeight:600},children:"License"}),e.jsx(o,{sx:{fontWeight:600},children:"Tier"}),e.jsx(o,{sx:{fontWeight:600},children:"Status"}),e.jsx(o,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(o,{sx:{fontWeight:600},children:"Department"}),e.jsx(o,{sx:{fontWeight:600},children:"Role"}),e.jsx(o,{sx:{fontWeight:600},children:"Usage"}),e.jsx(o,{sx:{fontWeight:600},children:"Expires"}),e.jsx(o,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Qe,{children:h.licenses.map(s=>{var l,u;return e.jsxs(ie,{hover:!0,children:[e.jsx(o,{children:e.jsxs(r,{children:[e.jsx(a,{variant:"body1",sx:{fontWeight:500},children:s.name}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:s.key})]})}),e.jsx(o,{children:e.jsx(O,{label:s.tier,color:ps(s.tier),size:"small",icon:s.tier==="ENTERPRISE"?e.jsx(Ye,{}):void 0})}),e.jsx(o,{children:e.jsx(O,{icon:ms(s.status),label:s.status,color:gs(s.status),size:"small"})}),e.jsx(o,{children:s.assignedTo?e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(te,{sx:{width:24,height:24},children:ys(s.assignedTo)}),e.jsxs(r,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:pe(s.assignedTo)}),e.jsx(a,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(o,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.assignedTo?((l=x==null?void 0:x.find(c=>{var p;return c.email===((p=s.assignedTo)==null?void 0:p.email)}))==null?void 0:l.department)||"Not specified":"—"})}),e.jsx(o,{children:s.assignedTo?e.jsx(O,{label:((u=x==null?void 0:x.find(c=>{var p;return c.email===((p=s.assignedTo)==null?void 0:p.email)}))==null?void 0:u.role)||"Member",color:"primary",size:"small",variant:"outlined"}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"—"})}),e.jsx(o,{children:e.jsxs(r,{children:[e.jsxs(a,{variant:"body2",children:[s.usage.apiCalls.toLocaleString()," API calls"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.usage.dataTransfer," GB transferred"]})]})}),e.jsx(o,{children:e.jsx(a,{variant:"body2",color:new Date(s.expiresAt)<=new Date(Date.now()+30*24*60*60*1e3)?"warning.main":"text.primary",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsx(o,{children:e.jsx(Ze,{size:"small",onClick:c=>ke(c,s),children:e.jsx(es,{})})})]},s.id)})})]})})]})}),e.jsx(ss,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>C(!0),children:e.jsx(se,{})}),e.jsxs(F,{open:Ie,onClose:()=>C(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(M,{children:"Create New License"}),e.jsx(B,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(re,{fullWidth:!0,label:"License Name",value:N,onChange:s=>_(s.target.value),placeholder:"Development Team License"}),e.jsxs(le,{fullWidth:!0,children:[e.jsx(oe,{children:"License Tier"}),e.jsxs(ce,{value:k,label:"License Tier",onChange:s=>J(s.target.value),children:[e.jsx(j,{value:"BASIC",children:"Basic - Limited features"}),e.jsx(j,{value:"PROFESSIONAL",children:"Pro - Full features"}),e.jsx(j,{value:"ENTERPRISE",children:"Enterprise - Advanced features"})]})]}),e.jsx(re,{fullWidth:!0,label:"Number of Licenses",type:"number",value:P,onChange:s=>Q(parseInt(s.target.value)||1),inputProps:{min:1,max:50}}),e.jsx(y,{severity:"info",children:e.jsx(a,{variant:"body2",children:"New licenses will be created with a 1-year validity period and can be assigned to team members immediately."})})]})}),e.jsxs($,{children:[e.jsx(m,{onClick:()=>C(!1),children:"Cancel"}),e.jsx(m,{onClick:Re,variant:"contained",startIcon:e.jsx(ns,{}),children:"Create License"})]})]}),e.jsxs(F,{open:De,onClose:()=>E(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(M,{children:"Assign License"}),e.jsx(B,{children:i&&e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(y,{severity:"info",children:e.jsxs(a,{variant:"body2",children:["Assigning license: ",e.jsx("strong",{children:i.name})]})}),e.jsxs(le,{fullWidth:!0,children:[e.jsx(oe,{children:"Assign To"}),e.jsx(ce,{value:T,label:"Assign To",onChange:s=>X(s.target.value),disabled:W.length===0,children:W.length===0?e.jsx(j,{disabled:!0,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"No available team members for assignment"})}):W.map(s=>e.jsx(j,{value:s.id,children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(te,{sx:{width:24,height:24},children:G(s).charAt(0)}),e.jsxs(r,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:G(s)}),e.jsx(a,{variant:"caption",color:"text.secondary",children:s.email})]})]})},s.id))})]}),W.length===0&&e.jsx(y,{severity:"info",children:e.jsx(a,{variant:"body2",children:"All team members already have licenses assigned. To assign this license, you'll need to unassign another license first or invite new team members."})}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"The user will receive an email with instructions to activate their license."})]})}),e.jsxs($,{children:[e.jsx(m,{onClick:()=>E(!1),children:"Cancel"}),e.jsx(m,{onClick:We,variant:"contained",startIcon:e.jsx(de,{}),children:"Assign License"})]})]}),e.jsxs(F,{open:Ae,onClose:()=>A(!1),maxWidth:"sm",children:[e.jsx(M,{children:"Delete License"}),e.jsx(B,{children:i&&e.jsxs(r,{children:[e.jsxs(a,{variant:"body1",sx:{mb:2},children:["Are you sure you want to delete ",e.jsx("strong",{children:i.name}),"?"]}),e.jsx(y,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"This action cannot be undone. The license will be permanently removed and any assigned user will lose access."})})]})}),e.jsxs($,{children:[e.jsx(m,{onClick:()=>A(!1),children:"Cancel"}),e.jsx(m,{onClick:Fe,variant:"contained",color:"error",startIcon:e.jsx(xe,{}),children:"Delete License"})]})]}),e.jsxs(as,{anchorEl:K,open:!!K,onClose:L,children:[e.jsxs(j,{onClick:()=>i&&Pe(i.key),children:[e.jsx(f,{children:e.jsx(is,{})}),"Copy License Key"]}),!(i!=null&&i.assignedTo)&&e.jsxs(j,{onClick:()=>E(!0),children:[e.jsx(f,{children:e.jsx(de,{})}),"Assign License"]}),e.jsxs(j,{onClick:()=>Ee(!0),children:[e.jsx(f,{children:e.jsx(ts,{})}),"Edit License"]}),e.jsx(he,{}),(i==null?void 0:i.status)==="ACTIVE"?e.jsxs(j,{onClick:Ue,children:[e.jsx(f,{children:e.jsx(me,{})}),"Suspend License"]}):e.jsxs(j,{onClick:ze,children:[e.jsx(f,{children:e.jsx(V,{})}),"Activate License"]}),e.jsx(he,{}),e.jsxs(j,{onClick:Oe,sx:{color:"error.main"},children:[e.jsx(f,{children:e.jsx(xe,{sx:{color:"error.main"}})}),"Delete License"]})]})]})};export{Ws as default};
