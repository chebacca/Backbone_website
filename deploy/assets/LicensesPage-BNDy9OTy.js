import{j as e,a as t,T as n,d as C,ay as re,G as j,k as L,l as S,H as V,c as $,u as H,az as oe,aA as ce,aB as de,aC as le,aD as xe,aE as X,aF as i,aG as he,as as ue,h as q,I as ge,aH as je,aj as pe,a4 as x,X as h,aI as me,aJ as ye,aK as be,aL as fe,i as ve,aq as Ce,aM as Le,aN as Se,aO as Ae,aP as ke,n as K,aQ as J,O as Ee}from"./mui-BQ0lC4VB.js";import{r as o}from"./vendor-DIxetjBo.js";import{u as Ie}from"./notistack.esm-Bg0Tn0tt.js";import{u as Te,c as k,e as E}from"./index-C6B8gJok.js";import"./stripe-0lUOqiTp.js";const we=r=>{switch(r){case"ACTIVE":return"success";case"SUSPENDED":return"warning";case"EXPIRED":return"error";case"PENDING":return"info";default:return"default"}},De=r=>{switch(r){case"ACTIVE":return e.jsx(K,{});case"SUSPENDED":return e.jsx(J,{});case"EXPIRED":return e.jsx(Ee,{});case"PENDING":return e.jsx(J,{});default:return e.jsx(K,{})}},Pe=r=>{switch(r){case"BASIC":return"default";case"PRO":return"success";case"ENTERPRISE":return"secondary";default:return"default"}},We=r=>r==="BASIC"?"outlined":"filled",Ne=()=>{const{enqueueSnackbar:r}=Ie(),{user:l}=Te(),[Me,I]=o.useState(!1),[u,T]=o.useState([]),[w,D]=o.useState(null),[d,P]=o.useState(null),[Q,p]=o.useState(!1),[m,W]=o.useState(""),[y,Y]=o.useState("");o.useEffect(()=>{let s=!0;return(async()=>{var c,R,z,U,B,F;try{I(!0);const te=String((l==null?void 0:l.role)||"").toUpperCase()==="SUPERADMIN";let v=[];if(te)try{v=((R=(c=(await k.get(`${E.admin.licenses()}?limit=200`)).data)==null?void 0:c.data)==null?void 0:R.licenses)??[]}catch{v=((U=(z=(await k.get(E.licenses.myLicenses())).data)==null?void 0:z.data)==null?void 0:U.licenses)??[]}else v=((F=(B=(await k.get(E.licenses.myLicenses())).data)==null?void 0:B.data)==null?void 0:F.licenses)??[];const ie=v.map((a,N)=>{var G,O;return{id:a.id,key:a.key,name:(G=a.user)!=null&&G.name?`${a.user.name}'s License`:`License ${N+1}`,tier:String(a.tier||"").toUpperCase(),status:String(a.status||"").toUpperCase(),assignedTo:(O=a.user)!=null&&O.name?{name:a.user.name,email:a.user.email||""}:void 0,activatedAt:a.activatedAt||a.createdAt||void 0,expiresAt:a.expiresAt||a.currentPeriodEnd||new Date(Date.now()+30*24*3600*1e3).toISOString(),lastUsed:a.updatedAt||a.activatedAt||a.createdAt||void 0,deviceCount:a.activationCount??0,maxDevices:a.maxActivations??1,usage:{apiCalls:0,dataTransfer:0}}});if(!s)return;T(ie)}catch(f){if(!s)return;r((f==null?void 0:f.message)||"Failed to load licenses",{variant:"error"}),T([])}finally{s&&I(!1)}})(),()=>{s=!1}},[l==null?void 0:l.role,r]);const Z=(s,c)=>{D(s.currentTarget),P(c)},g=()=>{D(null),P(null)},_=s=>{navigator.clipboard.writeText(s),r("License key copied to clipboard",{variant:"success"}),g()},ee=()=>{d&&m&&(r(`License assigned to ${m}`,{variant:"success"}),p(!1),W(""),g())},se=()=>{d&&(r("License suspended",{variant:"warning"}),g())},ae=()=>{d&&(r("License activated",{variant:"success"}),g())},ne=u.filter(s=>{var c;return s.name.toLowerCase().includes(y.toLowerCase())||s.key.toLowerCase().includes(y.toLowerCase())||(((c=s.assignedTo)==null?void 0:c.email)||"").toLowerCase().includes(y.toLowerCase())}),A=o.useMemo(()=>u.filter(s=>s.status==="ACTIVE").length,[u]),b=o.useMemo(()=>u.length,[u]),M=o.useMemo(()=>b<=0?0:Math.round(A/b*100),[A,b]);return e.jsxs(t,{children:[e.jsx(t,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(t,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsx(n,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Manage and monitor your BackboneLogic, Inc. licenses"})]}),e.jsx(C,{variant:"contained",startIcon:e.jsx(re,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Add License"})]})}),e.jsxs(j,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(S,{children:[e.jsx(n,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:A}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Active Licenses"})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(S,{children:[e.jsx(n,{variant:"h3",sx:{fontWeight:700},children:b}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Total Licenses"})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(S,{children:[e.jsxs(n,{variant:"h3",sx:{fontWeight:700},children:[M,"%"]}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Utilization Rate"}),e.jsx(V,{variant:"determinate",value:M,sx:{mt:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(S,{children:[e.jsx(n,{variant:"h3",sx:{fontWeight:700},children:"15"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Days to Renewal"})]})})})})]}),e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},children:e.jsx($,{sx:{p:3,mb:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(t,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(H,{placeholder:"Search licenses...",value:y,onChange:s=>Y(s.target.value),size:"small",sx:{flex:1},InputProps:{startAdornment:e.jsx(oe,{sx:{color:"text.secondary",mr:1}})}}),e.jsx(C,{variant:"outlined",startIcon:e.jsx(ce,{}),sx:{whiteSpace:"nowrap"},children:"Filters"})]})})}),e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.6},children:e.jsx(de,{component:$,sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(le,{children:[e.jsx(xe,{children:e.jsxs(X,{children:[e.jsx(i,{sx:{fontWeight:600},children:"License"}),e.jsx(i,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(i,{sx:{fontWeight:600},children:"Status"}),e.jsx(i,{sx:{fontWeight:600},children:"Tier"}),e.jsx(i,{sx:{fontWeight:600},children:"Devices"}),e.jsx(i,{sx:{fontWeight:600},children:"Usage"}),e.jsx(i,{sx:{fontWeight:600},children:"Expires"}),e.jsx(i,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(he,{children:ne.map(s=>e.jsxs(X,{hover:!0,children:[e.jsx(i,{children:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:s.name}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:s.key})]})}),e.jsx(i,{children:s.assignedTo?e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ue,{sx:{width:32,height:32,fontSize:"0.875rem"},children:s.assignedTo.name[0]}),e.jsxs(t,{children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:s.assignedTo.name}),e.jsx(n,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(i,{children:e.jsx(q,{icon:De(s.status),label:s.status,color:we(s.status),size:"small",sx:{fontWeight:500}})}),e.jsx(i,{children:e.jsx(q,{label:s.tier,color:Pe(s.tier),size:"small",variant:We(s.tier)})}),e.jsx(i,{children:e.jsxs(t,{children:[e.jsxs(n,{variant:"body2",children:[s.deviceCount,"/",s.maxDevices]}),e.jsx(V,{variant:"determinate",value:s.deviceCount/s.maxDevices*100,sx:{width:80,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2}}})]})}),e.jsx(i,{children:e.jsxs(t,{children:[e.jsxs(n,{variant:"body2",children:[s.usage.apiCalls.toLocaleString()," calls"]}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:[s.usage.dataTransfer," GB"]})]})}),e.jsx(i,{children:e.jsx(n,{variant:"body2",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsx(i,{children:e.jsx(ge,{onClick:c=>Z(c,s),size:"small",children:e.jsx(je,{})})})]},s.id))})]})})}),e.jsxs(pe,{anchorEl:w,open:!!w,onClose:g,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsxs(x,{onClick:()=>d&&_(d.key),children:[e.jsx(h,{children:e.jsx(me,{fontSize:"small"})}),"Copy License Key"]}),e.jsxs(x,{onClick:()=>p(!0),children:[e.jsx(h,{children:e.jsx(ye,{fontSize:"small"})}),"Assign License"]}),e.jsxs(x,{onClick:()=>{},children:[e.jsx(h,{children:e.jsx(be,{fontSize:"small"})}),"Edit License"]}),(d==null?void 0:d.status)==="ACTIVE"?e.jsxs(x,{onClick:se,children:[e.jsx(h,{children:e.jsx(fe,{fontSize:"small"})}),"Suspend License"]}):e.jsxs(x,{onClick:ae,children:[e.jsx(h,{children:e.jsx(ve,{fontSize:"small"})}),"Activate License"]}),e.jsxs(x,{onClick:()=>{},children:[e.jsx(h,{children:e.jsx(Ce,{fontSize:"small"})}),"Download Details"]})]}),e.jsxs(Le,{open:Q,onClose:()=>p(!1),PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(Se,{children:"Assign License"}),e.jsx(Ae,{children:e.jsx(H,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",fullWidth:!0,variant:"outlined",value:m,onChange:s=>W(s.target.value),sx:{mt:2}})}),e.jsxs(ke,{children:[e.jsx(C,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(C,{onClick:ee,variant:"contained",disabled:!m,children:"Assign"})]})]})]})};export{Ne as default};
