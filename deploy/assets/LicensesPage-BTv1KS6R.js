import{j as e,B as r,C as $e,T as a,d as C,ai as z,w as Ge,x as Z,y as v,aj as ue,z as ee,H as Ve,a as p,ap as se,G as I,ae as je,p as V,am as ge,al as He,t as ne,v as ae,i as Ke,af as qe,aq as Xe,ar as _e,as as Je,at as te,au as o,av as Qe,r as O,u as Ye,ag as ie,g as Ze,aw as es,ax as ss,ay as F,az as M,aA as B,e as re,aB as le,aC as oe,aD as ce,a5 as g,aE as $,aF as ns,aG as de,aH as xe,a4 as as,aI as ts,aJ as is,D as he,aK as me}from"./mui-Dvh35qVf.js";import{r as h}from"./vendor-CjD1bmmO.js";import{u as rs}from"./notistack.esm-Ca-E78ev.js";import{u as ls,a as os,b as cs,c as ds,d as xs,e as hs,f as us,g as js}from"./useStreamlinedData-rbihFre0.js";import{M as R}from"./MetricCard-C5FutAvg.js";import"./UnifiedDataService-CFYGaazL.js";import"./index-BbJter-q.js";import"./stripe-CbtnRl6i.js";import"./index.esm-DonjM_pP.js";import"./index.esm-D7ujsXeY.js";const gs=n=>{switch(n){case"ACTIVE":return"success";case"PENDING":return"warning";case"SUSPENDED":return"error";case"EXPIRED":return"default";default:return"default"}},ms=n=>{switch(n){case"ACTIVE":return e.jsx(V,{});case"PENDING":return e.jsx(ge,{});case"SUSPENDED":return e.jsx(me,{});case"EXPIRED":return e.jsx(ue,{});default:return e.jsx(je,{})}},ps=n=>{switch(n){case"BASIC":return"default";case"PROFESSIONAL":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},fs=()=>{const n=[];for(let i=0;i<4;i++)n.push(Math.random().toString(36).substr(2,4).toUpperCase());return`BL14-${n.join("-")}`},pe=(n,i)=>{if(!n)return"Unassigned";if(i&&n.email){const c=i.find(y=>y.email.toLowerCase()===n.email.toLowerCase());if(c){if(c.firstName&&c.lastName)return`${c.firstName} ${c.lastName}`;if(c.firstName)return c.firstName;if(c.lastName)return c.lastName}}return n.name&&n.name!=="Unknown User"?n.name:n.email?n.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(L=>L.charAt(0).toUpperCase()+L.slice(1).toLowerCase()).join(" "):"Unknown User"},ys=(n,i)=>{if(!n)return"?";const c=pe(n,i);if(c==="Unassigned"||c==="Unknown User")return"?";const y=c.split(" ");return y.length>=2?(y[0].charAt(0)+y[1].charAt(0)).toUpperCase():c.charAt(0).toUpperCase()},G=n=>n.firstName&&n.lastName?`${n.firstName} ${n.lastName}`:n.firstName?n.firstName:n.lastName?n.lastName:n.email.split("@")[0],Ws=()=>{var Y;const{enqueueSnackbar:n}=rs(),{data:i,loading:c,error:y}=ls(),{data:L,loading:fe,error:ye}=os(),{data:m,loading:ve,error:Le,refetch:D}=cs(),{data:x,loading:Ce,error:be}=ds(),we=xs(),H=hs(),Se=us();js();const[Ie,w]=h.useState(!1),[De,E]=h.useState(!1),[vs,Ee]=h.useState(!1),[Ae,A]=h.useState(!1),[t,U]=h.useState(null),[K,q]=h.useState(null),[Ls,Cs]=h.useState(""),[N,X]=h.useState(""),[T,_]=h.useState(""),[k,J]=h.useState("PROFESSIONAL"),[P,Q]=h.useState(1),Ne=c||fe||ve||Ce,Te=y||ye||Le||be,u=h.useMemo(()=>{if(!i||!L||!m)return{licenses:[],stats:{totalLicenses:0,activeLicenses:0,expiringSoon:0,unassignedLicenses:0,utilizationRate:0}};const s=m.length,l=m.filter(S=>S.status==="ACTIVE").length,j=m.filter(S=>{const Me=new Date(S.expiresAt),Be=new Date(Date.now()+30*24*60*60*1e3);return Me<=Be}).length,d=m.filter(S=>!S.assignedTo).length,f=s>0?l/s*100:0;return{licenses:m,stats:{totalLicenses:s,activeLicenses:l,expiringSoon:j,unassignedLicenses:d,utilizationRate:f}}},[i,L,m]),ke=(s,l)=>{U(l),q(s.currentTarget)},b=()=>{q(null),U(null)},Pe=s=>{navigator.clipboard.writeText(s),n("License key copied to clipboard",{variant:"success"}),b()},W=h.useMemo(()=>{if(!x||!m)return[];const s=m.filter(l=>{var j;return(j=l.assignedTo)==null?void 0:j.userId}).map(l=>l.assignedTo.userId);return x.filter(l=>!s.includes(l.id))},[x,m]),We=async()=>{if(!t||!N){n("Please select a valid team member to assign the license to",{variant:"error"});return}try{await Se.mutate({licenseId:t.id,userId:N});const s=x==null?void 0:x.find(j=>j.id===N),l=s?G(s):"Unknown User";n(`License assigned to ${l}`,{variant:"success"}),X(""),E(!1),b(),D()}catch(s){n((s==null?void 0:s.message)||"Failed to assign license",{variant:"error"})}},Re=async()=>{var s,l,j;if(!T.trim()){n("Please enter a license name",{variant:"error"});return}try{for(let d=0;d<P;d++){const f={key:fs(),name:P>1?`${T} ${d+1}`:T,tier:k,status:"PENDING",organization:{id:((s=i==null?void 0:i.organization)==null?void 0:s.id)||"",name:((l=i==null?void 0:i.organization)==null?void 0:l.name)||"",tier:((j=i==null?void 0:i.organization)==null?void 0:j.tier)||"BASIC"},usage:{apiCalls:0,dataTransfer:0,deviceCount:0,maxDevices:k==="ENTERPRISE"?10:k==="PROFESSIONAL"?5:2},expiresAt:new Date(Date.now()+31536e6)};await we.mutate(f)}n(`${P} license(s) created successfully`,{variant:"success"}),_(""),J("PROFESSIONAL"),Q(1),w(!1),D()}catch(d){n((d==null?void 0:d.message)||"Failed to create license",{variant:"error"})}},Ue=async()=>{if(t){try{await H.mutate({licenseId:t.id,updates:{status:"SUSPENDED"}}),n(`License ${t.name} has been suspended`,{variant:"warning"}),D()}catch(s){n((s==null?void 0:s.message)||"Failed to suspend license",{variant:"error"})}b()}},ze=async()=>{if(t){try{await H.mutate({licenseId:t.id,updates:{status:"ACTIVE"}}),n(`License ${t.name} has been activated`,{variant:"success"}),D()}catch(s){n((s==null?void 0:s.message)||"Failed to activate license",{variant:"error"})}b()}},Oe=()=>{t&&(A(!0),b())},Fe=async()=>{if(t)try{n(`License ${t.name} has been deleted`,{variant:"success"}),A(!1),U(null)}catch(s){n((s==null?void 0:s.message)||"Failed to delete license",{variant:"error"})}};return Ne?e.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(r,{textAlign:"center",children:[e.jsx($e,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading License Data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Fetching your licenses and subscription details"})]})}):Te?e.jsx(r,{sx:{p:3},children:e.jsxs(C,{severity:"error",children:[e.jsx(z,{children:"Unable to Load License Data"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your license information. This could be due to:"}),e.jsxs(Ge,{dense:!0,children:[e.jsxs(Z,{children:[e.jsx(v,{children:e.jsx(ue,{fontSize:"small"})}),e.jsx(ee,{primary:"Network connectivity issues"})]}),e.jsxs(Z,{children:[e.jsx(v,{children:e.jsx(Ve,{fontSize:"small"})}),e.jsx(ee,{primary:"Authentication token expired"})]})]}),e.jsx(r,{sx:{mt:2},children:e.jsx(p,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!i||!L?e.jsx(r,{sx:{p:3},children:e.jsxs(C,{severity:"info",children:[e.jsx(z,{children:"Setting Up License Management"}),e.jsx(a,{variant:"body2",children:"We're preparing your license management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(r,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(r,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsxs(a,{variant:"body1",color:"text.secondary",children:["Manage your ",((Y=L.organization)==null?void 0:Y.name)||"Organization"," licenses and assignments"]})]}),e.jsx(p,{variant:"contained",startIcon:e.jsx(se,{}),onClick:()=>w(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Create License"})]}),e.jsxs(I,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{title:"Total Licenses",value:u.stats.totalLicenses.toString(),icon:e.jsx(je,{}),color:"primary"})}),e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{title:"Active Licenses",value:u.stats.activeLicenses.toString(),icon:e.jsx(V,{}),color:"success"})}),e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{title:"Expiring Soon",value:u.stats.expiringSoon.toString(),icon:e.jsx(ge,{}),color:"warning"})}),e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsx(R,{title:"Unassigned",value:u.stats.unassignedLicenses.toString(),icon:e.jsx(He,{}),color:"secondary"})})]}),e.jsx(ne,{sx:{mb:4},children:e.jsxs(ae,{children:[e.jsx(a,{variant:"h6",sx:{fontWeight:600,mb:2},children:"License Utilization"}),e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(Ke,{variant:"determinate",value:u.stats.utilizationRate,sx:{flex:1,height:8,borderRadius:4}}),e.jsxs(a,{variant:"body2",sx:{minWidth:60},children:[u.stats.utilizationRate.toFixed(1),"%"]})]}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:[u.stats.activeLicenses," of ",u.stats.totalLicenses," licenses are currently active"]})]})}),u.stats.expiringSoon>0&&e.jsxs(C,{severity:"warning",sx:{mb:4},children:[e.jsx(z,{children:"Licenses Expiring Soon"}),e.jsxs(a,{variant:"body2",sx:{mb:2},children:[u.stats.expiringSoon," license(s) will expire within the next 30 days."]}),e.jsx(p,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Renew Licenses"})]}),e.jsx(ne,{children:e.jsxs(ae,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600},children:["All Licenses (",u.licenses.length,")"]}),e.jsx(p,{variant:"outlined",startIcon:e.jsx(qe,{}),onClick:()=>n("License report downloaded",{variant:"success"}),children:"Export Report"})]}),e.jsx(Xe,{children:e.jsxs(_e,{children:[e.jsx(Je,{children:e.jsxs(te,{children:[e.jsx(o,{sx:{fontWeight:600},children:"License"}),e.jsx(o,{sx:{fontWeight:600},children:"Tier"}),e.jsx(o,{sx:{fontWeight:600},children:"Status"}),e.jsx(o,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(o,{sx:{fontWeight:600},children:"Department"}),e.jsx(o,{sx:{fontWeight:600},children:"Role"}),e.jsx(o,{sx:{fontWeight:600},children:"Usage"}),e.jsx(o,{sx:{fontWeight:600},children:"Expires"}),e.jsx(o,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Qe,{children:u.licenses.map(s=>{var l,j;return e.jsxs(te,{hover:!0,children:[e.jsx(o,{children:e.jsxs(r,{children:[e.jsx(a,{variant:"body1",sx:{fontWeight:500},children:s.name}),e.jsx(a,{variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:s.key})]})}),e.jsx(o,{children:e.jsx(O,{label:s.tier,color:ps(s.tier),size:"small",icon:s.tier==="ENTERPRISE"?e.jsx(Ye,{}):void 0})}),e.jsx(o,{children:e.jsx(O,{icon:ms(s.status),label:s.status,color:gs(s.status),size:"small"})}),e.jsx(o,{children:s.assignedTo?e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{sx:{width:24,height:24},children:ys(s.assignedTo,x)}),e.jsxs(r,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:pe(s.assignedTo,x)}),e.jsx(a,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(o,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.assignedTo?((l=x==null?void 0:x.find(d=>{var f;return d.email===((f=s.assignedTo)==null?void 0:f.email)}))==null?void 0:l.department)||"Not specified":"—"})}),e.jsx(o,{children:s.assignedTo?e.jsx(O,{label:((j=x==null?void 0:x.find(d=>{var f;return d.email===((f=s.assignedTo)==null?void 0:f.email)}))==null?void 0:j.role)||"Member",color:"primary",size:"small",variant:"outlined"}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"—"})}),e.jsx(o,{children:e.jsxs(r,{children:[e.jsxs(a,{variant:"body2",children:[s.usage.apiCalls.toLocaleString()," API calls"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.usage.dataTransfer," GB transferred"]})]})}),e.jsx(o,{children:e.jsx(a,{variant:"body2",color:new Date(s.expiresAt)<=new Date(Date.now()+30*24*60*60*1e3)?"warning.main":"text.primary",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsx(o,{children:e.jsx(Ze,{size:"small",onClick:d=>ke(d,s),children:e.jsx(es,{})})})]},s.id)})})]})})]})}),e.jsx(ss,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>w(!0),children:e.jsx(se,{})}),e.jsxs(F,{open:Ie,onClose:()=>w(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(M,{children:"Create New License"}),e.jsx(B,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(re,{fullWidth:!0,label:"License Name",value:T,onChange:s=>_(s.target.value),placeholder:"Development Team License"}),e.jsxs(le,{fullWidth:!0,children:[e.jsx(oe,{children:"License Tier"}),e.jsxs(ce,{value:k,label:"License Tier",onChange:s=>J(s.target.value),children:[e.jsx(g,{value:"BASIC",children:"Basic - Limited features"}),e.jsx(g,{value:"PROFESSIONAL",children:"Pro - Full features"}),e.jsx(g,{value:"ENTERPRISE",children:"Enterprise - Advanced features"})]})]}),e.jsx(re,{fullWidth:!0,label:"Number of Licenses",type:"number",value:P,onChange:s=>Q(parseInt(s.target.value)||1),inputProps:{min:1,max:50}}),e.jsx(C,{severity:"info",children:e.jsx(a,{variant:"body2",children:"New licenses will be created with a 1-year validity period and can be assigned to team members immediately."})})]})}),e.jsxs($,{children:[e.jsx(p,{onClick:()=>w(!1),children:"Cancel"}),e.jsx(p,{onClick:Re,variant:"contained",startIcon:e.jsx(ns,{}),children:"Create License"})]})]}),e.jsxs(F,{open:De,onClose:()=>E(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(M,{children:"Assign License"}),e.jsx(B,{children:t&&e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(C,{severity:"info",children:e.jsxs(a,{variant:"body2",children:["Assigning license: ",e.jsx("strong",{children:t.name})]})}),e.jsxs(le,{fullWidth:!0,children:[e.jsx(oe,{children:"Assign To"}),e.jsx(ce,{value:N,label:"Assign To",onChange:s=>X(s.target.value),disabled:W.length===0,children:W.length===0?e.jsx(g,{disabled:!0,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"No available team members for assignment"})}):W.map(s=>e.jsx(g,{value:s.id,children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{sx:{width:24,height:24},children:G(s).charAt(0)}),e.jsxs(r,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:G(s)}),e.jsx(a,{variant:"caption",color:"text.secondary",children:s.email})]})]})},s.id))})]}),W.length===0&&e.jsx(C,{severity:"info",children:e.jsx(a,{variant:"body2",children:"All team members already have licenses assigned. To assign this license, you'll need to unassign another license first or invite new team members."})}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"The user will receive an email with instructions to activate their license."})]})}),e.jsxs($,{children:[e.jsx(p,{onClick:()=>E(!1),children:"Cancel"}),e.jsx(p,{onClick:We,variant:"contained",startIcon:e.jsx(de,{}),children:"Assign License"})]})]}),e.jsxs(F,{open:Ae,onClose:()=>A(!1),maxWidth:"sm",children:[e.jsx(M,{children:"Delete License"}),e.jsx(B,{children:t&&e.jsxs(r,{children:[e.jsxs(a,{variant:"body1",sx:{mb:2},children:["Are you sure you want to delete ",e.jsx("strong",{children:t.name}),"?"]}),e.jsx(C,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"This action cannot be undone. The license will be permanently removed and any assigned user will lose access."})})]})}),e.jsxs($,{children:[e.jsx(p,{onClick:()=>A(!1),children:"Cancel"}),e.jsx(p,{onClick:Fe,variant:"contained",color:"error",startIcon:e.jsx(xe,{}),children:"Delete License"})]})]}),e.jsxs(as,{anchorEl:K,open:!!K,onClose:b,children:[e.jsxs(g,{onClick:()=>t&&Pe(t.key),children:[e.jsx(v,{children:e.jsx(ts,{})}),"Copy License Key"]}),!(t!=null&&t.assignedTo)&&e.jsxs(g,{onClick:()=>E(!0),children:[e.jsx(v,{children:e.jsx(de,{})}),"Assign License"]}),e.jsxs(g,{onClick:()=>Ee(!0),children:[e.jsx(v,{children:e.jsx(is,{})}),"Edit License"]}),e.jsx(he,{}),(t==null?void 0:t.status)==="ACTIVE"?e.jsxs(g,{onClick:Ue,children:[e.jsx(v,{children:e.jsx(me,{})}),"Suspend License"]}):e.jsxs(g,{onClick:ze,children:[e.jsx(v,{children:e.jsx(V,{})}),"Activate License"]}),e.jsx(he,{}),e.jsxs(g,{onClick:Oe,sx:{color:"error.main"},children:[e.jsx(v,{children:e.jsx(xe,{sx:{color:"error.main"}})}),"Delete License"]})]})]})};export{Ws as default};
