import{j as e,a as d,T as a,d as C,az as ne,G as p,k as L,l as k,H as F,c as N,u as U,aA as ie,aB as te,aC as re,aD as oe,aE as de,aF as G,aG as n,aH as ce,at as le,h as O,I as xe,aI as he,ak as ue,a4 as u,X as g,aJ as ge,aK as je,aL as me,aM as pe,i as be,ar as ye,aN as fe,aO as ve,aP as Ce,aQ as Le,n as V,aR as $,O as ke}from"./mui-DiYnqcGn.js";import{r}from"./vendor-DIxetjBo.js";import{b as Se,u as Ae,d as H,e as X}from"./index-CCGQgEqV.js";import{m as l}from"./proxy-B_KpOrcW.js";import"./stripe-CQkQ71Kl.js";const Te=t=>{switch(t){case"ACTIVE":return"success";case"SUSPENDED":return"warning";case"EXPIRED":return"error";case"PENDING":return"info";default:return"default"}},Ee=t=>{switch(t){case"ACTIVE":return e.jsx(V,{});case"SUSPENDED":return e.jsx($,{});case"EXPIRED":return e.jsx(ke,{});case"PENDING":return e.jsx($,{});default:return e.jsx(V,{})}},Ie=t=>{switch(t){case"BASIC":return"default";case"PRO":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},Be=()=>{const{enqueueSnackbar:t}=Se(),{user:x}=Ae(),[we,A]=r.useState(!1),[j,T]=r.useState([]),[E,I]=r.useState(null),[c,w]=r.useState(null),[K,b]=r.useState(!1),[y,D]=r.useState(""),[f,q]=r.useState("");r.useEffect(()=>{let s=!0;return(async()=>{var o,W,M,R;try{A(!0);const h=["admin","enterprise"].includes(String((x==null?void 0:x.role)||"").toLowerCase()),z=h?await H.get(`${X.admin.licenses()}?limit=200`):await H.get(X.licenses.myLicenses()),se=(h?((W=(o=z.data)==null?void 0:o.data)==null?void 0:W.licenses)??[]:((R=(M=z.data)==null?void 0:M.data)==null?void 0:R.licenses)??[]).map((i,ae)=>{var B;return{id:i.id,key:i.key,name:(B=i.user)!=null&&B.name?`${i.user.name}'s License`:`License ${ae+1}`,tier:i.tier,status:i.status,assignedTo:i.user?{name:i.user.name||"User",email:i.user.email||""}:void 0,activatedAt:i.activatedAt||void 0,expiresAt:i.expiresAt||new Date(Date.now()+30*24*3600*1e3).toISOString(),lastUsed:i.updatedAt||void 0,deviceCount:i.activationCount??0,maxDevices:i.maxActivations??1,usage:{apiCalls:0,dataTransfer:0}}});if(!s)return;T(se)}catch(h){if(!s)return;t((h==null?void 0:h.message)||"Failed to load licenses",{variant:"error"}),T([])}finally{s&&A(!1)}})(),()=>{s=!1}},[x==null?void 0:x.role,t]);const J=(s,o)=>{I(s.currentTarget),w(o)},m=()=>{I(null),w(null)},Q=s=>{navigator.clipboard.writeText(s),t("License key copied to clipboard",{variant:"success"}),m()},Y=()=>{c&&y&&(t(`License assigned to ${y}`,{variant:"success"}),b(!1),D(""),m())},Z=()=>{c&&(t("License suspended",{variant:"warning"}),m())},_=()=>{c&&(t("License activated",{variant:"success"}),m())},ee=j.filter(s=>{var o;return s.name.toLowerCase().includes(f.toLowerCase())||s.key.toLowerCase().includes(f.toLowerCase())||(((o=s.assignedTo)==null?void 0:o.email)||"").toLowerCase().includes(f.toLowerCase())}),S=r.useMemo(()=>j.filter(s=>s.status==="ACTIVE").length,[j]),v=r.useMemo(()=>j.length,[j]),P=r.useMemo(()=>v<=0?0:Math.round(S/v*100),[S,v]);return e.jsxs(d,{children:[e.jsx(l.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(d,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsx(a,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Manage and monitor your BackboneLogic, Inc. licenses"})]}),e.jsx(C,{variant:"contained",startIcon:e.jsx(ne,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Add License"})]})}),e.jsxs(p,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(k,{children:[e.jsx(a,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:S}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Active Licenses"})]})})})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(k,{children:[e.jsx(a,{variant:"h3",sx:{fontWeight:700},children:v}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total Licenses"})]})})})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(k,{children:[e.jsxs(a,{variant:"h3",sx:{fontWeight:700},children:[P,"%"]}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Utilization Rate"}),e.jsx(F,{variant:"determinate",value:P,sx:{mt:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}})]})})})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(k,{children:[e.jsx(a,{variant:"h3",sx:{fontWeight:700},children:"15"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Days to Renewal"})]})})})})]}),e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},children:e.jsx(N,{sx:{p:3,mb:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(d,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(U,{placeholder:"Search licenses...",value:f,onChange:s=>q(s.target.value),size:"small",sx:{flex:1},InputProps:{startAdornment:e.jsx(ie,{sx:{color:"text.secondary",mr:1}})}}),e.jsx(C,{variant:"outlined",startIcon:e.jsx(te,{}),sx:{whiteSpace:"nowrap"},children:"Filters"})]})})}),e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.6},children:e.jsx(re,{component:N,sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(oe,{children:[e.jsx(de,{children:e.jsxs(G,{children:[e.jsx(n,{sx:{fontWeight:600},children:"License"}),e.jsx(n,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(n,{sx:{fontWeight:600},children:"Status"}),e.jsx(n,{sx:{fontWeight:600},children:"Tier"}),e.jsx(n,{sx:{fontWeight:600},children:"Devices"}),e.jsx(n,{sx:{fontWeight:600},children:"Usage"}),e.jsx(n,{sx:{fontWeight:600},children:"Expires"}),e.jsx(n,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(ce,{children:ee.map(s=>e.jsxs(G,{hover:!0,children:[e.jsx(n,{children:e.jsxs(d,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:s.name}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:s.key})]})}),e.jsx(n,{children:s.assignedTo?e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(le,{sx:{width:32,height:32,fontSize:"0.875rem"},children:s.assignedTo.name[0]}),e.jsxs(d,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:s.assignedTo.name}),e.jsx(a,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(n,{children:e.jsx(O,{icon:Ee(s.status),label:s.status,color:Te(s.status),size:"small",sx:{fontWeight:500}})}),e.jsx(n,{children:e.jsx(O,{label:s.tier,color:Ie(s.tier),size:"small",variant:"outlined"})}),e.jsx(n,{children:e.jsxs(d,{children:[e.jsxs(a,{variant:"body2",children:[s.deviceCount,"/",s.maxDevices]}),e.jsx(F,{variant:"determinate",value:s.deviceCount/s.maxDevices*100,sx:{width:80,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2}}})]})}),e.jsx(n,{children:e.jsxs(d,{children:[e.jsxs(a,{variant:"body2",children:[s.usage.apiCalls.toLocaleString()," calls"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.usage.dataTransfer," GB"]})]})}),e.jsx(n,{children:e.jsx(a,{variant:"body2",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsx(n,{children:e.jsx(xe,{onClick:o=>J(o,s),size:"small",children:e.jsx(he,{})})})]},s.id))})]})})}),e.jsxs(ue,{anchorEl:E,open:!!E,onClose:m,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsxs(u,{onClick:()=>c&&Q(c.key),children:[e.jsx(g,{children:e.jsx(ge,{fontSize:"small"})}),"Copy License Key"]}),e.jsxs(u,{onClick:()=>b(!0),children:[e.jsx(g,{children:e.jsx(je,{fontSize:"small"})}),"Assign License"]}),e.jsxs(u,{onClick:()=>{},children:[e.jsx(g,{children:e.jsx(me,{fontSize:"small"})}),"Edit License"]}),(c==null?void 0:c.status)==="ACTIVE"?e.jsxs(u,{onClick:Z,children:[e.jsx(g,{children:e.jsx(pe,{fontSize:"small"})}),"Suspend License"]}):e.jsxs(u,{onClick:_,children:[e.jsx(g,{children:e.jsx(be,{fontSize:"small"})}),"Activate License"]}),e.jsxs(u,{onClick:()=>{},children:[e.jsx(g,{children:e.jsx(ye,{fontSize:"small"})}),"Download Details"]})]}),e.jsxs(fe,{open:K,onClose:()=>b(!1),PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(ve,{children:"Assign License"}),e.jsx(Ce,{children:e.jsx(U,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",fullWidth:!0,variant:"outlined",value:y,onChange:s=>D(s.target.value),sx:{mt:2}})}),e.jsxs(Le,{children:[e.jsx(C,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(C,{onClick:Y,variant:"contained",disabled:!y,children:"Assign"})]})]})]})};export{Be as default};
//# sourceMappingURL=LicensesPage-CB1E5L32.js.map
