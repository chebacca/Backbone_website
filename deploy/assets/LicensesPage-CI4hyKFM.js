import{j as e,a as r,T as i,d as y,aT as te,G as j,bb as re,aA as ie,bc as oe,aJ as ce,c as G,n as $,b0 as le,bd as de,b1 as xe,b2 as ue,b3 as he,b4 as O,b5 as n,b6 as ge,aC as je,m as K,a1 as me,I as pe,be,as as fe,ae as x,s as u,bf as ve,bg as Ce,bh as ye,bi as Se,y as Le,aB as Ae,D as Ie,k as Te,l as ke,v as Ee,w as X,bj as q,a4 as we}from"./mui-Ilj8o9AZ.js";import{r as o}from"./vendor-OeuszDaU.js";import{u as De}from"./notistack.esm-CcFOI6Un.js";import{u as Pe,d as A,e as I}from"./index-DWCkfl7P.js";import{M as S}from"./MetricCard-BdSYF6k0.js";import"./stripe-BKUR_tcx.js";const Me=t=>{switch(t){case"ACTIVE":return"success";case"SUSPENDED":return"warning";case"EXPIRED":return"error";case"PENDING":return"info";default:return"default"}},We=t=>{switch(t){case"ACTIVE":return e.jsx(X,{});case"SUSPENDED":return e.jsx(q,{});case"EXPIRED":return e.jsx(we,{});case"PENDING":return e.jsx(q,{});default:return e.jsx(X,{})}},ze=t=>{switch(t){case"BASIC":return"default";case"PRO":return"success";case"ENTERPRISE":return"secondary";default:return"default"}},Re=t=>t==="BASIC"?"outlined":"filled",Oe=()=>{const{enqueueSnackbar:t}=De(),{user:d}=Pe(),[Ue,T]=o.useState(!1),[h,k]=o.useState([]),[E,w]=o.useState(null),[l,D]=o.useState(null),[H,m]=o.useState(!1),[p,P]=o.useState(""),[b,J]=o.useState("");o.useEffect(()=>{let s=!0;return(async()=>{var c,W,z,R,U,B;try{T(!0);const ae=String((d==null?void 0:d.role)||"").toUpperCase()==="SUPERADMIN";let C=[];if(ae)try{C=((W=(c=(await A.get(`${I.admin.licenses()}?limit=200`)).data)==null?void 0:c.data)==null?void 0:W.licenses)??[]}catch{C=((R=(z=(await A.get(I.licenses.myLicenses())).data)==null?void 0:z.data)==null?void 0:R.licenses)??[]}else C=((B=(U=(await A.get(I.licenses.myLicenses())).data)==null?void 0:U.data)==null?void 0:B.licenses)??[];const ne=C.map((a,F)=>{var N,V;return{id:a.id,key:a.key,name:(N=a.user)!=null&&N.name?`${a.user.name}'s License`:`License ${F+1}`,tier:String(a.tier||"").toUpperCase(),status:String(a.status||"").toUpperCase(),assignedTo:(V=a.user)!=null&&V.name?{name:a.user.name,email:a.user.email||""}:void 0,activatedAt:a.activatedAt||a.createdAt||void 0,expiresAt:a.expiresAt||a.currentPeriodEnd||new Date(Date.now()+30*24*3600*1e3).toISOString(),lastUsed:a.updatedAt||a.activatedAt||a.createdAt||void 0,deviceCount:a.activationCount??0,maxDevices:a.maxActivations??1,usage:{apiCalls:0,dataTransfer:0}}});if(!s)return;k(ne)}catch(v){if(!s)return;t((v==null?void 0:v.message)||"Failed to load licenses",{variant:"error"}),k([])}finally{s&&T(!1)}})(),()=>{s=!1}},[d==null?void 0:d.role,t]);const Q=(s,c)=>{w(s.currentTarget),D(c)},g=()=>{w(null),D(null)},Y=s=>{navigator.clipboard.writeText(s),t("License key copied to clipboard",{variant:"success"}),g()},Z=()=>{l&&p&&(t(`License assigned to ${p}`,{variant:"success"}),m(!1),P(""),g())},_=()=>{l&&(t("License suspended",{variant:"warning"}),g())},ee=()=>{l&&(t("License activated",{variant:"success"}),g())},se=h.filter(s=>{var c;return s.name.toLowerCase().includes(b.toLowerCase())||s.key.toLowerCase().includes(b.toLowerCase())||(((c=s.assignedTo)==null?void 0:c.email)||"").toLowerCase().includes(b.toLowerCase())}),L=o.useMemo(()=>h.filter(s=>s.status==="ACTIVE").length,[h]),f=o.useMemo(()=>h.length,[h]),M=o.useMemo(()=>f<=0?0:Math.round(L/f*100),[L,f]);return e.jsxs(r,{children:[e.jsx(r,{children:e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(r,{children:[e.jsx(i,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsx(i,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Manage and monitor your BackboneLogic, Inc. licenses"})]}),e.jsx(y,{variant:"contained",startIcon:e.jsx(te,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Add License"})]})}),e.jsxs(j,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{title:"Active Licenses",value:L,icon:e.jsx(re,{}),color:"primary",trend:{value:12,direction:"up"}})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{title:"Total Licenses",value:f,icon:e.jsx(ie,{}),color:"secondary"})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{title:"Utilization Rate",value:`${M}%`,icon:e.jsx(oe,{}),color:"success",trend:{value:M,direction:"up"}})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(S,{title:"Days to Renewal",value:15,icon:e.jsx(ce,{}),color:"warning"})})]}),e.jsx(r,{children:e.jsx(G,{sx:{p:3,mb:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(r,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx($,{placeholder:"Search licenses...",value:b,onChange:s=>J(s.target.value),size:"small",sx:{flex:1},InputProps:{startAdornment:e.jsx(le,{sx:{color:"text.secondary",mr:1}})}}),e.jsx(y,{variant:"outlined",startIcon:e.jsx(de,{}),sx:{whiteSpace:"nowrap"},children:"Filters"})]})})}),e.jsx(r,{children:e.jsx(xe,{component:G,sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(O,{children:[e.jsx(n,{sx:{fontWeight:600},children:"License"}),e.jsx(n,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(n,{sx:{fontWeight:600},children:"Status"}),e.jsx(n,{sx:{fontWeight:600},children:"Tier"}),e.jsx(n,{sx:{fontWeight:600},children:"Devices"}),e.jsx(n,{sx:{fontWeight:600},children:"Usage"}),e.jsx(n,{sx:{fontWeight:600},children:"Expires"}),e.jsx(n,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(ge,{children:se.map(s=>e.jsxs(O,{hover:!0,children:[e.jsx(n,{children:e.jsxs(r,{children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:s.name}),e.jsx(i,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:s.key})]})}),e.jsx(n,{children:s.assignedTo?e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{sx:{width:32,height:32,fontSize:"0.875rem"},children:s.assignedTo.name[0]}),e.jsxs(r,{children:[e.jsx(i,{variant:"body2",sx:{fontWeight:500},children:s.assignedTo.name}),e.jsx(i,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]}):e.jsx(i,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(n,{children:e.jsx(K,{icon:We(s.status),label:s.status,color:Me(s.status),size:"small",sx:{fontWeight:500}})}),e.jsx(n,{children:e.jsx(K,{label:s.tier,color:ze(s.tier),size:"small",variant:Re(s.tier)})}),e.jsx(n,{children:e.jsxs(r,{children:[e.jsxs(i,{variant:"body2",children:[s.deviceCount,"/",s.maxDevices]}),e.jsx(me,{variant:"determinate",value:s.deviceCount/s.maxDevices*100,sx:{width:80,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2}}})]})}),e.jsx(n,{children:e.jsxs(r,{children:[e.jsxs(i,{variant:"body2",children:[s.usage.apiCalls.toLocaleString()," calls"]}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:[s.usage.dataTransfer," GB"]})]})}),e.jsx(n,{children:e.jsx(i,{variant:"body2",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsx(n,{children:e.jsx(pe,{onClick:c=>Q(c,s),size:"small",children:e.jsx(be,{})})})]},s.id))})]})})}),e.jsxs(fe,{anchorEl:E,open:!!E,onClose:g,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsxs(x,{onClick:()=>l&&Y(l.key),children:[e.jsx(u,{children:e.jsx(ve,{fontSize:"small"})}),"Copy License Key"]}),e.jsxs(x,{onClick:()=>m(!0),children:[e.jsx(u,{children:e.jsx(Ce,{fontSize:"small"})}),"Assign License"]}),e.jsxs(x,{onClick:()=>{},children:[e.jsx(u,{children:e.jsx(ye,{fontSize:"small"})}),"Edit License"]}),(l==null?void 0:l.status)==="ACTIVE"?e.jsxs(x,{onClick:_,children:[e.jsx(u,{children:e.jsx(Se,{fontSize:"small"})}),"Suspend License"]}):e.jsxs(x,{onClick:ee,children:[e.jsx(u,{children:e.jsx(Le,{fontSize:"small"})}),"Activate License"]}),e.jsxs(x,{onClick:()=>{},children:[e.jsx(u,{children:e.jsx(Ae,{fontSize:"small"})}),"Download Details"]})]}),e.jsxs(Ie,{open:H,onClose:()=>m(!1),PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(Te,{children:"Assign License"}),e.jsx(ke,{children:e.jsx($,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",fullWidth:!0,variant:"outlined",value:p,onChange:s=>P(s.target.value),sx:{mt:2}})}),e.jsxs(Ee,{children:[e.jsx(y,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(y,{onClick:Z,variant:"contained",disabled:!p,children:"Assign"})]})]})]})};export{Oe as default};
