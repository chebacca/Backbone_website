const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.esm-CiRfLMBX.js","assets/index.esm-BANGvNYi.js"])))=>i.map(i=>d[i]);
import{j as e,aI as he,aJ as ue,B as t,c7 as $s,T as s,g as Fe,bG as ls,aK as me,bZ as os,b_ as cs,b$ as ds,aL as je,a as S,A as xs,q as hs,p as G,t as W,v as z,G as I,af as Re,c8 as Ue,D as Pe,r as se,w as Oe,x as ae,y as V,z as le,e as N,L as us,d as U,ai as pe,C as Ee,ax as ms,R as Bs,c9 as Ms,ar as be,as as ve,at as we,M as A,F as _s,l as Qe,aB as js,c as Vs,aC as ps,aD as gs,aE as Ae,aF as m,aG as fs,ag as Se,aj as Ce,H as Gs,aS as Ze,ae as ys,am as de,aZ as xe,u as es,aH as Ys,aR as Hs,aP as Te,aO as ss,aW as ke,I as O,bk as ns,al as Xs,i as qs,E as Ks,Y as ts,aX as Js,a5 as Qs,b2 as Zs}from"./mui-B0Fi-Ngj.js";import{r as d}from"./vendor-CjD1bmmO.js";import{u as $e}from"./notistack.esm-Ca-E78ev.js";import{b as en,c as sn,u as nn,a as tn,l as rn,i as an,j as ln}from"./useStreamlinedData-BZk2ucwy.js";import{_ as bs}from"./index-tccEPAbz.js";import{E as vs,l as ws,u as Ss,a as Cs,C as Ie}from"./stripe-DCrHNGRE.js";import"./UnifiedDataService-d9BuCqXH.js";import"./index.esm-9jaBBmwp.js";import"./index.esm-BANGvNYi.js";import"./FirestoreCollectionManager-BK3x-hu2.js";import"./firebase-BBMwtecT.js";import"./index.esm-CiRfLMBX.js";const Ne=[{id:"basic",name:"Basic",tier:"BASIC",price:29,maxDevices:2,features:["Basic project management","Up to 2 devices","Email support","Standard templates","5GB storage"]},{id:"professional",name:"Professional",tier:"PROFESSIONAL",price:99,maxDevices:5,popular:!0,features:["Advanced project management","Up to 5 devices","Priority support","Custom templates","50GB storage","Team collaboration","Advanced analytics"]},{id:"enterprise",name:"Enterprise",tier:"ENTERPRISE",price:199,maxDevices:10,features:["Enterprise project management","Up to 10 devices","24/7 dedicated support","Unlimited templates","500GB storage","Advanced team management","Custom integrations","White-label options","SLA guarantee"]}],is=[{id:"plan-selection",label:"Select Plan",description:"Choose your license plan and quantity",completed:!1},{id:"payment",label:"Payment",description:"Complete your payment securely",completed:!1},{id:"confirmation",label:"Confirmation",description:"Review and activate your licenses",completed:!1}],on=ws("pk_test_disabled"),cn=({purchaseData:r,onPaymentSuccess:C,onPaymentError:l,processing:g})=>{const f=Ss(),p=Cs(),[y,c]=d.useState(!1),[L,T]=d.useState(null),b=async u=>{if(u.preventDefault(),!f||!p){l("Stripe has not loaded yet. Please try again.");return}const v=p.getElement(Ie);if(!v){l("Card element not found. Please refresh and try again.");return}try{const{error:w,paymentMethod:k}=await f.createPaymentMethod({type:"card",card:v,billing_details:{name:`${r.billingAddress.firstName} ${r.billingAddress.lastName}`,email:r.billingAddress.email,phone:r.billingAddress.phone,address:{line1:r.billingAddress.address,city:r.billingAddress.city,state:r.billingAddress.state,postal_code:r.billingAddress.zipCode,country:r.billingAddress.country}}});if(w){l(w.message||"Payment method creation failed");return}C(k)}catch(w){l(w.message||"An unexpected error occurred")}},o=u=>{c(u.complete),T(u.error?u.error.message:null)};return e.jsxs(t,{component:"form",onSubmit:b,children:[e.jsx(W,{sx:{mb:3,border:"2px solid",borderColor:"primary.main"},children:e.jsxs(z,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(us,{color:"primary",sx:{mr:1}}),e.jsx(s,{variant:"h6",children:"Secure Payment"}),e.jsx(se,{label:"SSL Encrypted",size:"small",color:"success",sx:{ml:"auto"}})]}),e.jsx(Ie,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}},onChange:o}),L&&e.jsx(U,{severity:"error",sx:{mt:2},children:L})]})}),e.jsxs(U,{severity:"info",sx:{mb:3},children:[e.jsx(pe,{children:"Test Mode"}),e.jsxs(s,{variant:"body2",children:["Use test card: ",e.jsx("strong",{children:"4242 4242 4242 4242"})," with any future expiry date and any CVC."]})]}),e.jsx(S,{type:"submit",variant:"contained",fullWidth:!0,size:"large",disabled:!f||!y||g,startIcon:g?e.jsx(Ee,{size:20}):e.jsx(ms,{}),sx:{py:2,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600,fontSize:"1.1rem"},children:g?"Processing Payment...":`Pay ${new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r.total)}`})]})},dn=({open:r,onClose:C,initialPlan:l="professional",initialQuantity:g=1,onPurchaseComplete:f})=>{const{enqueueSnackbar:p}=$e(),[y,c]=d.useState(0),[L,T]=d.useState(is),[b,o]=d.useState(!1),[u,v]=d.useState(Ne.find(n=>n.id===l)||Ne[1]),[w,k]=d.useState(g),$=u.price*w,B=$*.08,M=$+B,q={plan:u,quantity:w,total:M,tax:B,subtotal:$,billingAddress:{firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",country:""}},oe=()=>{if(y<L.length-1){const n=[...L];n[y].completed=!0,T(n),c(y+1)}},Y=()=>{y>0&&c(y-1)},H=()=>{b||(C(),c(0),T(is.map(n=>({...n,completed:!1}))))},X=n=>{switch(n){case 0:return u&&w>0;case 1:return!0;default:return!0}},ce=async n=>{o(!0);try{console.log("🛒 [LicensePurchaseFlow] Processing payment with method:",n.id);const h=await fetch("/api/licenses/purchase",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await a()}`},body:JSON.stringify({planId:u.id,quantity:w,paymentMethodId:n.id,total:M})});if(!h.ok)throw new Error("Payment processing failed");const D=await h.json();if(D.success){const E=[...L];E[2].completed=!0,T(E),c(3),p("Payment processed successfully!",{variant:"success"}),setTimeout(()=>{f(D.data),H()},3e3)}else throw new Error(D.error||"Payment failed")}catch(h){console.error("❌ [LicensePurchaseFlow] Payment error:",h),p(h.message||"Payment failed. Please try again.",{variant:"error"})}finally{o(!1)}},x=n=>{p(n,{variant:"error"})},a=async()=>{try{const{getAuth:n}=await bs(async()=>{const{getAuth:K}=await import("./index.esm-CiRfLMBX.js");return{getAuth:K}},__vite__mapDeps([0,1])),D=n().currentUser;if(!D)throw new Error("No authenticated user");return await D.getIdToken()}catch(n){throw console.error("❌ [LicensePurchaseFlow] Error getting auth token:",n),new Error("Authentication failed")}},P=n=>{switch(n){case 0:return e.jsxs(t,{children:[e.jsx(s,{variant:"h6",sx:{mb:3},children:"Choose Your License Plan"}),e.jsx(I,{container:!0,spacing:3,sx:{mb:3},children:Ne.map(h=>e.jsx(I,{item:!0,xs:12,md:4,children:e.jsxs(W,{sx:{cursor:"pointer",border:u.id===h.id?"2px solid":"1px solid",borderColor:u.id===h.id?"primary.main":"divider",position:"relative","&:hover":{borderColor:"primary.main",transform:"translateY(-2px)"},transition:"all 0.2s ease-in-out"},onClick:()=>v(h),children:[h.popular&&e.jsx(se,{label:"Most Popular",color:"primary",size:"small",sx:{position:"absolute",top:-10,left:"50%",transform:"translateX(-50%)",zIndex:1}}),e.jsxs(z,{sx:{textAlign:"center",p:3},children:[e.jsx(s,{variant:"h5",sx:{fontWeight:600,mb:1},children:h.name}),e.jsxs(s,{variant:"h3",sx:{fontWeight:700,mb:1},children:["$",h.price,e.jsx(s,{component:"span",variant:"body1",color:"text.secondary",children:"/month"})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["Up to ",h.maxDevices," devices"]}),e.jsx(Oe,{dense:!0,children:h.features.map((D,E)=>e.jsxs(ae,{sx:{px:0},children:[e.jsx(V,{sx:{minWidth:32},children:e.jsx(G,{color:"success",fontSize:"small"})}),e.jsx(le,{primary:D,primaryTypographyProps:{variant:"body2"}})]},E))})]})]})},h.id))}),e.jsx(W,{sx:{p:3,backgroundColor:"background.paper"},children:e.jsxs(I,{container:!0,spacing:3,alignItems:"center",children:[e.jsx(I,{item:!0,xs:12,sm:6,children:e.jsx(N,{fullWidth:!0,label:"Number of Licenses",type:"number",value:w,onChange:h=>k(Math.max(1,parseInt(h.target.value)||1)),inputProps:{min:1,max:100},helperText:`${w} × $${u.price} = $${$}/month`})}),e.jsx(I,{item:!0,xs:12,sm:6,children:e.jsxs(t,{sx:{textAlign:"right"},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600},children:["Monthly Total: $",$]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"+ taxes and fees"})]})})]})})]});case 1:return e.jsxs(t,{children:[e.jsx(s,{variant:"h6",sx:{mb:3},children:"Payment Details"}),e.jsx(W,{sx:{mb:3},children:e.jsxs(z,{children:[e.jsx(s,{variant:"h6",sx:{mb:2},children:"Order Summary"}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsxs(s,{children:[u.name," Plan × ",w]}),e.jsxs(s,{children:["$",$.toFixed(2)]})]}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(s,{children:"Tax"}),e.jsxs(s,{children:["$",B.toFixed(2)]})]}),e.jsx(Pe,{sx:{my:1}}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",fontWeight:600},children:[e.jsx(s,{variant:"h6",children:"Total"}),e.jsxs(s,{variant:"h6",children:["$",M.toFixed(2)]})]})]})}),e.jsx(vs,{stripe:on,children:e.jsx(cn,{purchaseData:q,onPaymentSuccess:ce,onPaymentError:x,processing:b})})]});case 2:return e.jsxs(t,{sx:{textAlign:"center"},children:[e.jsx(G,{sx:{fontSize:80,color:"success.main",mb:2}}),e.jsx(s,{variant:"h4",sx:{fontWeight:600,mb:2},children:"Payment Successful!"}),e.jsx(s,{variant:"body1",color:"text.secondary",sx:{mb:4},children:"Your licenses have been activated and are ready to use."}),e.jsx(W,{sx:{mb:3,textAlign:"left"},children:e.jsxs(z,{children:[e.jsx(s,{variant:"h6",sx:{mb:2},children:"Purchase Details"}),e.jsxs(I,{container:!0,spacing:2,children:[e.jsxs(I,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Plan:"}),e.jsx(s,{variant:"body1",children:u.name})]}),e.jsxs(I,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Licenses:"}),e.jsx(s,{variant:"body1",children:w})]}),e.jsxs(I,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Monthly Cost:"}),e.jsxs(s,{variant:"body1",children:["$",M.toFixed(2)]})]}),e.jsxs(I,{item:!0,xs:6,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Next Billing:"}),e.jsx(s,{variant:"body1",children:new Date(Date.now()+30*24*60*60*1e3).toLocaleDateString()})]})]})]})}),e.jsxs(t,{sx:{display:"flex",gap:2,justifyContent:"center"},children:[e.jsx(S,{variant:"outlined",startIcon:e.jsx(Re,{}),onClick:()=>p("Receipt downloaded",{variant:"success"}),children:"Download Receipt"}),e.jsx(S,{variant:"contained",startIcon:e.jsx(Ue,{}),onClick:()=>{f({licenses:[],invoice:{},subscription:{}}),H()},children:"View Licenses"})]})]});default:return null}};return e.jsxs(he,{open:r,onClose:H,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"70vh"}},children:[e.jsx(ue,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($s,{color:"primary"}),e.jsx(s,{variant:"h5",sx:{fontWeight:600},children:"Purchase Licenses"})]}),e.jsx(Fe,{onClick:H,disabled:b,children:e.jsx(ls,{})})]})}),e.jsxs(me,{sx:{pb:0},children:[e.jsx(os,{activeStep:y,orientation:"horizontal",sx:{mb:4},children:L.map((n,h)=>e.jsx(cs,{completed:n.completed,children:e.jsx(ds,{children:e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:n.label})})},n.id))}),e.jsx(t,{sx:{minHeight:400},children:P(y)})]}),y<3&&e.jsxs(je,{sx:{p:3,pt:2},children:[e.jsx(S,{onClick:Y,disabled:y===0||b,startIcon:e.jsx(xs,{}),children:"Back"}),e.jsx(t,{sx:{flex:1}}),y<2&&e.jsx(S,{onClick:oe,variant:"contained",disabled:!X(y),endIcon:e.jsx(hs,{}),children:"Continue"})]})]})},re=[{id:"basic-renewal",name:"Basic Renewal",tier:"BASIC",price:29,duration:12,discount:10},{id:"professional-renewal",name:"Professional Renewal",tier:"PROFESSIONAL",price:99,duration:12,discount:15},{id:"enterprise-renewal",name:"Enterprise Renewal",tier:"ENTERPRISE",price:199,duration:12,discount:20}],rs=[{id:"license-selection",label:"Select Licenses",description:"Choose which licenses to renew",completed:!1},{id:"renewal-options",label:"Renewal Options",description:"Select renewal duration and plan",completed:!1},{id:"payment",label:"Payment",description:"Complete your renewal payment",completed:!1},{id:"confirmation",label:"Confirmation",description:"Review and activate renewed licenses",completed:!1}],xn=ws("pk_test_disabled"),ee=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r),hn=(r,C)=>{const l=new Date(r);return l.setMonth(l.getMonth()+C),l},un=async()=>{const{getAuth:r}=await bs(async()=>{const{getAuth:g}=await import("./index.esm-CiRfLMBX.js");return{getAuth:g}},__vite__mapDeps([0,1])),l=r().currentUser;if(!l)throw new Error("User not authenticated");return await l.getIdToken()},mn=({renewalData:r,onPaymentSuccess:C,onPaymentError:l,processing:g})=>{const f=Ss(),p=Cs(),[y,c]=d.useState(!1),[L,T]=d.useState(null),b=async o=>{if(o.preventDefault(),!f||!p){l("Stripe has not loaded yet. Please try again.");return}const u=p.getElement(Ie);if(!u){l("Card element not found. Please refresh and try again.");return}try{const{error:v,paymentMethod:w}=await f.createPaymentMethod({type:"card",card:u,billing_details:{name:`${r.billingAddress.firstName} ${r.billingAddress.lastName}`,email:r.billingAddress.email,phone:r.billingAddress.phone,address:{line1:r.billingAddress.address,city:r.billingAddress.city,state:r.billingAddress.state,postal_code:r.billingAddress.zipCode,country:r.billingAddress.country}}});if(v){l(v.message||"Payment method creation failed");return}C(w)}catch(v){l(v.message||"An unexpected error occurred")}};return e.jsxs(t,{component:"form",onSubmit:b,children:[e.jsx(W,{sx:{mb:3},children:e.jsxs(z,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ms,{})," Payment Details"]}),e.jsxs(t,{sx:{mb:3},children:[e.jsx(Ie,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}}}},onChange:o=>{var u;c(o.complete),T(((u=o.error)==null?void 0:u.message)||null)}}),L&&e.jsx(s,{variant:"body2",color:"error",sx:{mt:1},children:L})]}),e.jsx(U,{severity:"info",sx:{mb:2},children:e.jsx(s,{variant:"body2",children:"Your payment is secured by Stripe. We never store your card information."})})]})}),e.jsx(S,{type:"submit",variant:"contained",size:"large",fullWidth:!0,disabled:!f||!y||g,startIcon:g?e.jsx(Ee,{size:20}):e.jsx(us,{}),sx:{py:1.5,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600,"&:disabled":{background:"#ccc"}},children:g?"Processing...":`Renew Licenses - ${ee(r.total)}`})]})},jn=({open:r,onClose:C,expiringLicenses:l,onRenewalComplete:g})=>{const{enqueueSnackbar:f}=$e(),[p,y]=d.useState(0),[c,L]=d.useState(rs),[T,b]=d.useState(!1),[o,u]=d.useState([]),[v,w]=d.useState(12);d.useEffect(()=>{l.length>0&&u(l)},[l]);const k=d.useMemo(()=>{if(o.length===0)return{selectedLicenses:[],renewalPlan:re[1],duration:v,total:0,tax:0,subtotal:0,discount:0,billingAddress:{firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",country:""}};const x=o.reduce((E,K)=>(E[K.tier]=(E[K.tier]||0)+1,E),{});let a=0,P=0;Object.entries(x).forEach(([E,K])=>{const Le=re.find(fe=>fe.tier===E)||re[1],J=Le.price*K,ge=J*(Le.discount||0)/100;a+=J,P+=ge});const n=a-P,h=n*.08,D=n+h;return{selectedLicenses:o,renewalPlan:re[1],duration:v,total:D,tax:h,subtotal:a,discount:P,billingAddress:{firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",country:""}}},[o,v]),$=()=>{if(p<c.length-1){const x=[...c];x[p].completed=!0,L(x),y(p+1)}},B=()=>{p>0&&y(p-1)},M=()=>{T||(C(),y(0),u([]),L(rs.map(x=>({...x,completed:!1}))))},q=x=>{switch(x){case 0:return o.length>0;case 1:return v>0;case 2:return!0;default:return!0}},oe=async x=>{b(!0);try{console.log("🔄 [LicenseRenewalWizard] Processing renewal payment with method:",x.id);const a=await fetch("/api/licenses/renew",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await un()}`},body:JSON.stringify({licenseIds:o.map(n=>n.id),duration:v,paymentMethodId:x.id,total:k.total})});if(!a.ok)throw new Error("Renewal processing failed");const P=await a.json();if(P.success){const n=[...c];n[3].completed=!0,L(n),y(4),f(`Successfully renewed ${o.length} license(s)!`,{variant:"success"}),g(P.data)}else throw new Error(P.error||"Renewal failed")}catch(a){console.error("❌ [LicenseRenewalWizard] Renewal error:",a),f(a.message||"Failed to process renewal. Please try again.",{variant:"error"})}finally{b(!1)}},Y=x=>{f(x,{variant:"error"}),b(!1)},H=x=>{u(a=>a.some(n=>n.id===x.id)?a.filter(n=>n.id!==x.id):[...a,x])},X=()=>{o.length===l.length?u([]):u(l)},ce=x=>{switch(x){case 0:return e.jsxs(t,{children:[e.jsx(s,{variant:"h6",sx:{mb:3},children:"Select Licenses to Renew"}),e.jsxs(U,{severity:"info",sx:{mb:3},children:[e.jsx(pe,{children:"Expiring Licenses Found"}),"We found ",l.length," license(s) that will expire within the next 30 days. Select which licenses you'd like to renew."]}),e.jsx(t,{sx:{mb:2},children:e.jsx(_s,{control:e.jsx(Qe,{checked:o.length===l.length,indeterminate:o.length>0&&o.length<l.length,onChange:X}),label:`Select All (${l.length} licenses)`})}),e.jsx(js,{component:Vs,children:e.jsxs(ps,{children:[e.jsx(gs,{children:e.jsxs(Ae,{children:[e.jsx(m,{padding:"checkbox",children:"Select"}),e.jsx(m,{children:"License"}),e.jsx(m,{children:"Tier"}),e.jsx(m,{children:"Assigned To"}),e.jsx(m,{children:"Expires"}),e.jsx(m,{children:"Renewal Price"})]})}),e.jsx(fs,{children:l.map(a=>{var D;const P=o.some(E=>E.id===a.id),n=re.find(E=>E.tier===a.tier)||re[1],h=n.price*(1-(n.discount||0)/100);return e.jsxs(Ae,{hover:!0,children:[e.jsx(m,{padding:"checkbox",children:e.jsx(Qe,{checked:P,onChange:()=>H(a)})}),e.jsx(m,{children:e.jsxs(t,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:a.name}),e.jsx(s,{variant:"caption",color:"text.secondary",children:a.key})]})}),e.jsx(m,{children:e.jsx(se,{label:a.tier,color:a.tier==="ENTERPRISE"?"secondary":"primary",size:"small"})}),e.jsx(m,{children:a.assignedTo?e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Se,{sx:{width:24,height:24},children:((D=a.assignedTo.name)==null?void 0:D.charAt(0))||"?"}),e.jsx(s,{variant:"body2",children:a.assignedTo.name||a.assignedTo.email})]}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(m,{children:e.jsx(s,{variant:"body2",color:"warning.main",sx:{fontWeight:500},children:new Date(a.expiresAt).toLocaleDateString()})}),e.jsx(m,{children:e.jsxs(t,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:ee(h)}),n.discount&&e.jsxs(s,{variant:"caption",color:"success.main",children:[n.discount,"% renewal discount"]})]})})]},a.id)})})]})}),o.length>0&&e.jsx(U,{severity:"success",sx:{mt:2},children:e.jsxs(s,{variant:"body2",children:[o.length," license(s) selected for renewal. Total: ",ee(k.subtotal-k.discount)]})})]});case 1:return e.jsxs(t,{children:[e.jsx(s,{variant:"h6",sx:{mb:3},children:"Renewal Options"}),e.jsxs(I,{container:!0,spacing:3,children:[e.jsx(I,{item:!0,xs:12,md:6,children:e.jsx(W,{children:e.jsxs(z,{children:[e.jsx(s,{variant:"h6",sx:{mb:2},children:"Renewal Duration"}),e.jsxs(be,{fullWidth:!0,children:[e.jsx(ve,{children:"Duration"}),e.jsxs(we,{value:v,label:"Duration",onChange:a=>w(Number(a.target.value)),children:[e.jsx(A,{value:6,children:"6 Months"}),e.jsx(A,{value:12,children:"12 Months (Recommended)"}),e.jsx(A,{value:24,children:"24 Months (Best Value)"})]})]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Longer renewals offer better value and fewer interruptions."})]})})}),e.jsx(I,{item:!0,xs:12,md:6,children:e.jsx(W,{children:e.jsxs(z,{children:[e.jsx(s,{variant:"h6",sx:{mb:2},children:"Renewal Summary"}),e.jsxs(Oe,{dense:!0,children:[e.jsx(ae,{children:e.jsx(le,{primary:"Licenses to Renew",secondary:`${o.length} licenses`})}),e.jsx(ae,{children:e.jsx(le,{primary:"Renewal Duration",secondary:`${v} months`})}),e.jsx(ae,{children:e.jsx(le,{primary:"New Expiration Date",secondary:o.length>0?hn(new Date(o[0].expiresAt),v).toLocaleDateString():"N/A"})})]})]})})})]}),e.jsx(W,{sx:{mt:3},children:e.jsxs(z,{children:[e.jsx(s,{variant:"h6",sx:{mb:2},children:"Pricing Breakdown"}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(s,{children:"Subtotal:"}),e.jsx(s,{children:ee(k.subtotal)})]}),k.discount>0&&e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(s,{color:"success.main",children:"Renewal Discount:"}),e.jsxs(s,{color:"success.main",children:["-",ee(k.discount)]})]}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(s,{children:"Tax (8%):"}),e.jsx(s,{children:ee(k.tax)})]}),e.jsx(Pe,{sx:{my:1}}),e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(s,{variant:"h6",children:"Total:"}),e.jsx(s,{variant:"h6",children:ee(k.total)})]})]})})]});case 2:return e.jsx(vs,{stripe:xn,children:e.jsx(mn,{renewalData:k,onPaymentSuccess:oe,onPaymentError:Y,processing:T})});case 3:return e.jsxs(t,{textAlign:"center",children:[e.jsx(G,{sx:{fontSize:80,color:"success.main",mb:2}}),e.jsx(s,{variant:"h4",sx:{mb:2},children:"Renewal Complete!"}),e.jsxs(s,{variant:"body1",sx:{mb:3},children:["Your ",o.length," license(s) have been successfully renewed."]}),e.jsxs(U,{severity:"success",sx:{mb:3},children:[e.jsx(pe,{children:"What happens next?"}),e.jsxs(s,{variant:"body2",children:["• Your licenses have been extended by ",v," months",e.jsx("br",{}),"• A receipt has been sent to your email",e.jsx("br",{}),"• Your team can continue using their licenses without interruption"]})]}),e.jsx(S,{variant:"contained",onClick:M,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Done"})]});default:return null}};return e.jsxs(he,{open:r,onClose:M,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{minHeight:"80vh"}},children:[e.jsx(ue,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Bs,{}),e.jsx(s,{variant:"h5",sx:{fontWeight:600},children:"License Renewal"})]}),e.jsx(Fe,{onClick:M,disabled:T,children:e.jsx(ls,{})})]})}),e.jsx(me,{children:e.jsx(os,{activeStep:p,orientation:"vertical",children:c.map((x,a)=>e.jsxs(cs,{children:[e.jsxs(ds,{icon:x.completed?e.jsx(G,{color:"success"}):e.jsx(t,{sx:{width:24,height:24,borderRadius:"50%",backgroundColor:a===p?"primary.main":"grey.300",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.875rem",fontWeight:600},children:a+1}),children:[e.jsx(s,{variant:"h6",children:x.label}),e.jsx(s,{variant:"body2",color:"text.secondary",children:x.description})]}),e.jsx(Ms,{children:e.jsx(t,{sx:{py:2},children:ce(a)})})]},x.id))})}),p<c.length-1&&e.jsxs(je,{sx:{p:3},children:[e.jsx(S,{onClick:B,disabled:p===0||T,startIcon:e.jsx(xs,{}),children:"Back"}),e.jsx(S,{onClick:$,disabled:!q(p)||T,variant:"contained",endIcon:e.jsx(hs,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:p===c.length-2?"Proceed to Payment":"Next"})]})]})},pn=r=>{switch(r){case"ACTIVE":return"success";case"PENDING":return"warning";case"SUSPENDED":return"error";case"EXPIRED":return"default";default:return"default"}},gn=r=>{switch(r){case"ACTIVE":return e.jsx(G,{});case"PENDING":return e.jsx(de,{});case"SUSPENDED":return e.jsx(xe,{});case"EXPIRED":return e.jsx(Ce,{});default:return e.jsx(ys,{})}},fn=r=>{switch(r){case"BASIC":return"default";case"PROFESSIONAL":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},ze=(r,C)=>{if(!r)return"Unassigned";if(C&&r.email){const l=C.find(g=>g.email&&g.email.toLowerCase()===r.email.toLowerCase());if(l){if(l.firstName&&l.lastName)return`${l.firstName} ${l.lastName}`;if(l.firstName)return l.firstName;if(l.lastName)return l.lastName}}return r.name&&r.name!=="Unknown User"?r.name:r.email?r.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(f=>f.charAt(0).toUpperCase()+f.slice(1).toLowerCase()).join(" "):"Unknown User"},as=(r,C)=>{if(!r)return"?";const l=ze(r,C);if(l==="Unassigned"||l==="Unknown User")return"?";const g=l.split(" ");return g.length>=2?(g[0].charAt(0)+g[1].charAt(0)).toUpperCase():l.charAt(0).toUpperCase()},We=r=>r.firstName&&r.lastName?`${r.firstName} ${r.lastName}`:r.firstName?r.firstName:r.lastName?r.lastName:r.email.split("@")[0],kn=()=>{var He,Xe,qe;const{enqueueSnackbar:r}=$e(),{data:C,loading:l,error:g}=en(),{data:f,loading:p,error:y}=sn(),{data:c,loading:L,error:T,refetch:b}=nn(),{data:o,loading:u,error:v}=tn(),w=rn(),k=an();ln();const[$,B]=d.useState(!1),[M,q]=d.useState(!1),[oe,Y]=d.useState(!1),[H,X]=d.useState(!1),[ce,x]=d.useState(!1),[a,P]=d.useState("all"),[n,h]=d.useState(null),[D,E]=d.useState(null),[K,Le]=d.useState(""),[J,ge]=d.useState(""),[fe,Be]=d.useState(""),[De,Me]=d.useState("PROFESSIONAL"),[_e,Ve]=d.useState("PENDING"),[Ge,Ye]=d.useState(""),Ps=l||p||L||u,Es=g||y||T||v;d.useEffect(()=>{const i=async j=>{var _;const R=j;console.log("🔄 License refresh event received:",R.detail),((_=R.detail)==null?void 0:_.action)==="created"&&await b()};return window.addEventListener("licenses:refresh",i),()=>{window.removeEventListener("licenses:refresh",i)}},[b]);const ne=d.useMemo(()=>{if(!C||!f||!c)return{licenses:[],filteredLicenses:[],stats:{totalLicenses:0,activeLicenses:0,expiringSoon:0,unassignedLicenses:0}};const i=c.length,j=c.filter(F=>F.status==="ACTIVE").length,R=c.filter(F=>{const te=new Date(F.expiresAt),ie=new Date(Date.now()+30*24*60*60*1e3);return te<=ie}).length,_=c.filter(F=>!F.assignedTo).length,Z={totalLicenses:i,activeLicenses:j,expiringSoon:R,unassignedLicenses:_},Os=[...a==="all"?c:a==="EXPIRED"?c.filter(F=>{const te=new Date(F.expiresAt),ie=new Date(Date.now()+30*24*60*60*1e3);return te<=ie}):c.filter(F=>F.status===a)].sort((F,te)=>{const ie={ACTIVE:0,PENDING:1,SUSPENDED:2,EXPIRED:3},Ke=ie[F.status]??4,Je=ie[te.status]??4;return Ke!==Je?Ke-Je:F.name.localeCompare(te.name)});return{licenses:c,filteredLicenses:Os,stats:Z}},[C,f,c,a]),As=(i,j)=>{console.log("🔧 [LicensesPage] Menu clicked for license:",j),h(j),E(i.currentTarget)},Q=()=>{E(null)},Is=i=>{navigator.clipboard.writeText(i),r("License key copied to clipboard",{variant:"success"}),Q()},ye=d.useMemo(()=>{if(!o||!c)return[];const i=c.filter(j=>{var R;return(R=j.assignedTo)==null?void 0:R.userId}).map(j=>j.assignedTo.userId);return o.filter(j=>!i.includes(j.id))},[o,c]),Ls=async()=>{if(!n||!J){r("Please select a valid team member to assign the license to",{variant:"error"});return}try{await k.mutate({licenseId:n.id,userId:J});const i=o==null?void 0:o.find(R=>R.id===J),j=i?We(i):"Unknown User";r(`License assigned to ${j}`,{variant:"success"}),ge(""),Y(!1),Q(),b()}catch(i){r((i==null?void 0:i.message)||"Failed to assign license",{variant:"error"})}},Ds=async()=>{if(n){try{await w.mutate({licenseId:n.id,updates:{status:"SUSPENDED"}}),r(`License ${n.name} has been suspended`,{variant:"warning"}),b()}catch(i){r((i==null?void 0:i.message)||"Failed to suspend license",{variant:"error"})}Q()}},Ts=async()=>{if(n){try{await w.mutate({licenseId:n.id,updates:{status:"ACTIVE"}}),r(`License ${n.name} has been activated`,{variant:"success"}),b()}catch(i){r((i==null?void 0:i.message)||"Failed to activate license",{variant:"error"})}Q()}},ks=()=>{n&&(x(!0),Q())},Ns=async()=>{if(n)try{r(`License ${n.name} has been deleted`,{variant:"success"}),x(!1),h(null),b()}catch(i){r((i==null?void 0:i.message)||"Failed to delete license",{variant:"error"})}},Ws=i=>{const j=i||n;if(!j){console.error("🔧 [LicensesPage] No license provided for editing"),r("Unable to load license data. Please try again.",{variant:"error"});return}console.log("🔧 [LicensesPage] Opening edit dialog for license:",j),h(j),Be(j.name),Me(j.tier),Ve(j.status),Ye(new Date(j.expiresAt).toISOString().split("T")[0]),Q(),setTimeout(()=>{X(!0)},10)},Rs=async()=>{if(n)try{await w.mutate({licenseId:n.id,updates:{name:fe,tier:De,status:_e,expiresAt:new Date(Ge)}}),r(`License ${n.name} updated successfully`,{variant:"success"}),X(!1),h(null),b()}catch(i){r((i==null?void 0:i.message)||"Failed to update license",{variant:"error"})}},Us=async i=>{console.log("🎉 [LicensesPage] Purchase completed:",i),r(`Successfully purchased ${i.licenses.length} license(s)! They are now active and ready to use.`,{variant:"success",autoHideDuration:6e3}),await b(),B(!1)},zs=async i=>{console.log("🔄 [LicensesPage] Renewal completed:",i),r(`Successfully renewed ${i.licenses.length} license(s)! Your licenses have been extended.`,{variant:"success",autoHideDuration:6e3}),await b(),q(!1)},Fs=d.useMemo(()=>{if(!c)return[];const i=new Date(Date.now()+30*24*60*60*1e3);return c.filter(j=>new Date(j.expiresAt)<=i)},[c]);return Ps?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(t,{textAlign:"center",children:[e.jsx(Ee,{size:60}),e.jsx(s,{variant:"h6",sx:{mt:2},children:"Loading License Data..."}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Fetching your licenses and subscription details"})]})}):Es?e.jsx(t,{sx:{p:3},children:e.jsxs(U,{severity:"error",children:[e.jsx(pe,{children:"Unable to Load License Data"}),e.jsx(s,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your license information. This could be due to:"}),e.jsxs(Oe,{dense:!0,children:[e.jsxs(ae,{children:[e.jsx(V,{children:e.jsx(Ce,{fontSize:"small"})}),e.jsx(le,{primary:"Network connectivity issues"})]}),e.jsxs(ae,{children:[e.jsx(V,{children:e.jsx(Gs,{fontSize:"small"})}),e.jsx(le,{primary:"Authentication token expired"})]})]}),e.jsx(t,{sx:{mt:2},children:e.jsx(S,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!C||!f?e.jsx(t,{sx:{p:3},children:e.jsxs(U,{severity:"info",children:[e.jsx(pe,{children:"Setting Up License Management"}),e.jsx(s,{variant:"body2",children:"We're preparing your license management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(t,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsxs(s,{variant:"body1",color:"text.secondary",children:["Manage your ",((He=f.organization)==null?void 0:He.name)||"Organization"," licenses and assignments",c&&e.jsxs(t,{component:"span",sx:{marginLeft:"8px",fontWeight:500,color:"primary.main"},children:["• ",c.length," total licenses"]})]})]}),e.jsx(t,{sx:{display:"flex",gap:2},children:e.jsx(S,{variant:"contained",startIcon:e.jsx(Ze,{}),onClick:()=>B(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Purchase Licenses"})})]}),e.jsxs(I,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsx(W,{sx:{background:a==="all"?"linear-gradient(135deg, #667eea 0%, #764ba2 100%)":"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(102, 126, 234, 0.3)"}},onClick:()=>P("all"),children:e.jsx(z,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:ne.stats.totalLicenses}),e.jsx(s,{variant:"body2",sx:{opacity:.9},children:"Total Licenses"})]}),e.jsx(ys,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsx(W,{sx:{background:a==="ACTIVE"?"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)":"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(17, 153, 142, 0.3)"}},onClick:()=>P("ACTIVE"),children:e.jsx(z,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:ne.stats.activeLicenses}),e.jsx(s,{variant:"body2",sx:{opacity:.9},children:"Active Licenses"})]}),e.jsx(G,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsx(W,{sx:{background:a==="PENDING"?"linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%)":"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(252, 74, 26, 0.3)"}},onClick:()=>P("PENDING"),children:e.jsx(z,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:(c==null?void 0:c.filter(i=>i.status==="PENDING").length)||0}),e.jsx(s,{variant:"body2",sx:{opacity:.9},children:"Pending Licenses"})]}),e.jsx(de,{sx:{fontSize:40,opacity:.8}})]})})})}),e.jsx(I,{item:!0,xs:12,sm:6,md:3,children:e.jsx(W,{sx:{background:a==="EXPIRED"?"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)":"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",height:"100%",cursor:"pointer",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 25px rgba(79, 172, 254, 0.3)"}},onClick:()=>P("EXPIRED"),children:e.jsxs(z,{children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(t,{children:[e.jsx(s,{variant:"h4",fontWeight:"bold",children:ne.stats.expiringSoon}),e.jsx(s,{variant:"body2",sx:{opacity:.9},children:"Expiring Soon"})]}),e.jsx(Ce,{sx:{fontSize:40,opacity:.8}})]}),ne.stats.expiringSoon>0&&e.jsx(S,{variant:"contained",size:"small",onClick:i=>{i.stopPropagation(),q(!0)},sx:{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white",fontWeight:600,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.3)"}},children:"Renew Licenses"})]})})})]}),e.jsx(W,{children:e.jsxs(z,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600},children:[a==="all"?"All Licenses":a==="EXPIRED"?"Expiring Soon Licenses":`${a} Licenses`," (",ne.filteredLicenses.length,")"]}),a!=="all"&&e.jsx(se,{label:`Filtered by: ${a==="EXPIRED"?"Expiring Soon":a}`,color:"primary",onDelete:()=>P("all"),deleteIcon:e.jsx(xe,{}),variant:"outlined"})]}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[a!=="all"&&e.jsx(S,{variant:"outlined",size:"small",onClick:()=>P("all"),startIcon:e.jsx(xe,{}),children:"Clear Filter"}),e.jsx(S,{variant:"outlined",startIcon:e.jsx(Re,{}),onClick:()=>r("License report downloaded",{variant:"success"}),children:"Export Report"})]})]}),e.jsx(js,{children:e.jsxs(ps,{children:[e.jsx(gs,{children:e.jsxs(Ae,{children:[e.jsx(m,{sx:{fontWeight:600},children:"License"}),e.jsx(m,{sx:{fontWeight:600},children:"Tier"}),e.jsx(m,{sx:{fontWeight:600},children:"Status"}),e.jsx(m,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(m,{sx:{fontWeight:600},children:"Department"}),e.jsx(m,{sx:{fontWeight:600},children:"Role"}),e.jsx(m,{sx:{fontWeight:600},children:"Expires"}),e.jsx(m,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(fs,{children:ne.filteredLicenses.map(i=>{var j,R;return e.jsxs(Ae,{hover:!0,children:[e.jsx(m,{children:e.jsxs(t,{children:[e.jsx(s,{variant:"body1",sx:{fontWeight:500},children:i.name}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:i.key})]})}),e.jsx(m,{children:e.jsx(se,{label:i.tier,color:fn(i.tier),size:"small",icon:i.tier==="ENTERPRISE"?e.jsx(es,{}):void 0})}),e.jsx(m,{children:e.jsx(se,{icon:gn(i.status),label:i.status,color:pn(i.status),size:"small"})}),e.jsx(m,{children:i.assignedTo?e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Se,{sx:{width:24,height:24},children:as(i.assignedTo,o)}),e.jsxs(t,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:ze(i.assignedTo,o)}),e.jsx(s,{variant:"caption",color:"text.secondary",children:i.assignedTo.email})]})]}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(m,{children:e.jsx(s,{variant:"body2",color:"text.secondary",children:i.assignedTo?((j=o==null?void 0:o.find(_=>{var Z;return _.email===((Z=i.assignedTo)==null?void 0:Z.email)}))==null?void 0:j.department)||"Not specified":"—"})}),e.jsx(m,{children:i.assignedTo?e.jsx(se,{label:((R=o==null?void 0:o.find(_=>{var Z;return _.email===((Z=i.assignedTo)==null?void 0:Z.email)}))==null?void 0:R.role)||"Member",color:"primary",size:"small",variant:"outlined"}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"—"})}),e.jsx(m,{children:e.jsx(s,{variant:"body2",color:new Date(i.expiresAt)<=new Date(Date.now()+30*24*60*60*1e3)?"warning.main":"text.primary",children:new Date(i.expiresAt).toLocaleDateString()})}),e.jsx(m,{children:e.jsx(Fe,{size:"small",onClick:_=>As(_,i),children:e.jsx(Ys,{})})})]},i.id)})})]})})]})}),e.jsx(Hs,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"},background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)"},onClick:()=>B(!0),children:e.jsx(Ze,{})}),e.jsxs(he,{open:oe,onClose:()=>Y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:"Assign License"}),e.jsx(me,{children:n&&e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(U,{severity:"info",children:e.jsxs(s,{variant:"body2",children:["Assigning license: ",e.jsx("strong",{children:n.name})]})}),e.jsxs(be,{fullWidth:!0,children:[e.jsx(ve,{children:"Assign To"}),e.jsx(we,{value:J,label:"Assign To",onChange:i=>ge(i.target.value),disabled:ye.length===0,children:ye.length===0?e.jsx(A,{disabled:!0,children:e.jsx(s,{variant:"body2",color:"text.secondary",children:"No available team members for assignment"})}):ye.map(i=>e.jsx(A,{value:i.id,children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Se,{sx:{width:24,height:24},children:We(i).charAt(0)}),e.jsxs(t,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:We(i)}),e.jsx(s,{variant:"caption",color:"text.secondary",children:i.email})]})]})},i.id))})]}),ye.length===0&&e.jsx(U,{severity:"info",children:e.jsx(s,{variant:"body2",children:"All team members already have licenses assigned. To assign this license, you'll need to unassign another license first or invite new team members."})}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"The user will receive an email with instructions to activate their license."})]})}),e.jsxs(je,{children:[e.jsx(S,{onClick:()=>Y(!1),children:"Cancel"}),e.jsx(S,{onClick:Ls,variant:"contained",startIcon:e.jsx(Te,{}),children:"Assign License"})]})]}),e.jsxs(he,{open:ce,onClose:()=>x(!1),maxWidth:"sm",children:[e.jsx(ue,{children:"Delete License"}),e.jsx(me,{children:n&&e.jsxs(t,{children:[e.jsxs(s,{variant:"body1",sx:{mb:2},children:["Are you sure you want to delete ",e.jsx("strong",{children:n.name}),"?"]}),e.jsx(U,{severity:"warning",children:e.jsx(s,{variant:"body2",children:"This action cannot be undone. The license will be permanently removed and any assigned user will lose access."})})]})}),e.jsxs(je,{children:[e.jsx(S,{onClick:()=>x(!1),children:"Cancel"}),e.jsx(S,{onClick:Ns,variant:"contained",color:"error",startIcon:e.jsx(ss,{}),children:"Delete License"})]})]}),e.jsxs(he,{open:H,onClose:()=>{X(!1),h(null)},maxWidth:"md",fullWidth:!0,children:[e.jsx(ue,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ke,{}),"Edit License: ",(n==null?void 0:n.name)||"Loading..."]})}),e.jsx(me,{children:n?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(t,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ue,{})," Basic Information"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{fullWidth:!0,label:"License Name",value:fe,onChange:i=>Be(i.target.value),placeholder:"Development Team License",required:!0}),e.jsx(N,{fullWidth:!0,label:"License Key",value:n.key,disabled:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Ue,{})})},helperText:"License key is automatically generated and cannot be changed"})]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(be,{fullWidth:!0,children:[e.jsx(ve,{children:"License Tier"}),e.jsxs(we,{value:De,label:"License Tier",onChange:i=>Me(i.target.value),children:[e.jsx(A,{value:"BASIC",children:e.jsxs(t,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Basic"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Limited features • 2 max devices • Basic support"})]})}),e.jsx(A,{value:"PROFESSIONAL",children:e.jsxs(t,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Professional"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Full features • 5 max devices • Priority support"})]})}),e.jsx(A,{value:"ENTERPRISE",children:e.jsxs(t,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Enterprise"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Advanced features • 10 max devices • 24/7 support"})]})})]})]}),e.jsxs(be,{fullWidth:!0,children:[e.jsx(ve,{children:"Status"}),e.jsxs(we,{value:_e,label:"Status",onChange:i=>Ve(i.target.value),children:[e.jsx(A,{value:"PENDING",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{color:"warning"}),e.jsxs(t,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Pending"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Awaiting activation"})]})]})}),e.jsx(A,{value:"ACTIVE",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(G,{color:"success"}),e.jsxs(t,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Active"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Fully operational"})]})]})}),e.jsx(A,{value:"SUSPENDED",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xe,{color:"error"}),e.jsxs(t,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Suspended"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Temporarily disabled"})]})]})}),e.jsx(A,{value:"EXPIRED",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ce,{color:"warning"}),e.jsxs(t,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:"Expired"}),e.jsx(s,{variant:"caption",color:"text.secondary",children:"Past expiration date"})]})]})})]})]})]}),e.jsx(N,{fullWidth:!0,label:"Expiration Date",type:"date",value:Ge,onChange:i=>Ye(i.target.value),InputLabelProps:{shrink:!0},required:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(de,{})})}})]}),e.jsxs(t,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ns,{})," Usage & Limits"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{fullWidth:!0,label:"Max Devices",value:n.usage.maxDevices,disabled:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Xs,{})})},helperText:`${De} tier limit`}),e.jsx(N,{fullWidth:!0,label:"Current Devices",value:n.usage.deviceCount,disabled:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(G,{})})}})]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{fullWidth:!0,label:"API Calls Used",value:n.usage.apiCalls.toLocaleString(),disabled:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(ns,{})})}}),e.jsx(N,{fullWidth:!0,label:"Data Transfer (GB)",value:n.usage.dataTransfer,disabled:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Re,{})})}})]}),e.jsxs(t,{sx:{mt:2},children:[e.jsxs(s,{variant:"body2",sx:{mb:1},children:["Device Usage: ",n.usage.deviceCount," / ",n.usage.maxDevices]}),e.jsx(qs,{variant:"determinate",value:n.usage.deviceCount/n.usage.maxDevices*100,sx:{height:8,borderRadius:4},color:n.usage.deviceCount>=n.usage.maxDevices?"error":"primary"})]})]}),e.jsxs(t,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Te,{})," Assignment Information"]}),n.assignedTo?e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{fullWidth:!0,label:"Assigned To",value:ze(n.assignedTo,o),disabled:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Se,{sx:{width:20,height:20},children:as(n.assignedTo,o)})})}}),e.jsx(N,{fullWidth:!0,label:"User Email",value:n.assignedTo.email,disabled:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Ks,{})})}})]}):e.jsx(U,{severity:"info",children:e.jsx(s,{variant:"body2",children:'This license is currently unassigned. Use the "Assign License" action to assign it to a team member.'})})]}),e.jsxs(t,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ts,{})," Organization & Metadata"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{fullWidth:!0,label:"Organization",value:((Xe=n.organization)==null?void 0:Xe.name)||"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(ts,{})})}}),e.jsx(N,{fullWidth:!0,label:"Organization Tier",value:((qe=n.organization)==null?void 0:qe.tier)||"BASIC",disabled:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(es,{})})}})]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(N,{fullWidth:!0,label:"Created Date",value:n.createdAt?new Date(n.createdAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(de,{})})}}),e.jsx(N,{fullWidth:!0,label:"Last Updated",value:n.updatedAt?new Date(n.updatedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(O,{position:"start",children:e.jsx(Js,{})})}})]})]}),e.jsxs(U,{severity:"warning",children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500,mb:1},children:"⚠️ Important Notes"}),e.jsxs(s,{variant:"body2",children:["• Changing the license tier will update device limits and feature access",e.jsx("br",{}),"• Status changes will immediately affect the user's access to the system",e.jsx("br",{}),"• Expiration date changes should be communicated to the license holder",e.jsx("br",{}),"• Some fields are system-managed and cannot be edited here"]})]})]}):e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(t,{textAlign:"center",children:[e.jsx(Ee,{size:40,sx:{mb:2}}),e.jsx(s,{variant:"body1",color:"text.secondary",children:"Loading license data..."}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"If this persists, please try again or refresh the page."})]})})}),e.jsxs(je,{children:[e.jsx(S,{onClick:()=>X(!1),children:"Cancel"}),e.jsx(S,{onClick:Rs,variant:"contained",startIcon:e.jsx(ke,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(Qs,{anchorEl:D,open:!!D,onClose:Q,children:[e.jsxs(A,{onClick:()=>n&&Is(n.key),children:[e.jsx(V,{children:e.jsx(Zs,{})}),"Copy License Key"]}),!(n!=null&&n.assignedTo)&&e.jsxs(A,{onClick:()=>Y(!0),children:[e.jsx(V,{children:e.jsx(Te,{})}),"Assign License"]}),e.jsxs(A,{onClick:()=>n&&Ws(n),children:[e.jsx(V,{children:e.jsx(ke,{})}),"Edit License"]}),e.jsx(Pe,{}),(n==null?void 0:n.status)==="ACTIVE"?e.jsxs(A,{onClick:Ds,children:[e.jsx(V,{children:e.jsx(xe,{})}),"Suspend License"]}):e.jsxs(A,{onClick:Ts,children:[e.jsx(V,{children:e.jsx(G,{})}),"Activate License"]}),e.jsx(Pe,{}),e.jsxs(A,{onClick:ks,sx:{color:"error.main"},children:[e.jsx(V,{children:e.jsx(ss,{sx:{color:"error.main"}})}),"Delete License"]})]}),e.jsx(dn,{open:$,onClose:()=>B(!1),initialPlan:"professional",initialQuantity:1,onPurchaseComplete:Us}),e.jsx(jn,{open:M,onClose:()=>q(!1),expiringLicenses:Fs,onRenewalComplete:zs})]})};export{kn as default};
