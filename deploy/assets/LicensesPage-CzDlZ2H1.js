import{j as e,B as i,C as Ne,T as n,d as p,ai as P,w as Pe,x as X,y as j,aj as te,z as _,H as We,a as d,ap as J,G as v,ae as ie,p as B,am as re,al as Re,t as Q,v as Y,i as ze,af as Oe,aq as Fe,ar as Be,as as Me,at as Z,au as c,av as $e,r as ee,u as Ue,ag as Ge,g as Ve,aw as He,ax as Ke,ay as W,az as R,aA as z,e as O,aB as qe,aC as Xe,aD as _e,a5 as u,aE as F,aF as Je,aG as se,aH as ne,a4 as Qe,aI as Ye,aJ as Ze,D as ae,aK as ce}from"./mui-Dvh35qVf.js";import{r as o}from"./vendor-CjD1bmmO.js";import{u as es}from"./notistack.esm-Ca-E78ev.js";import{u as ss,a as ns,b as as,c as ts,d as is,e as rs,f as cs}from"./useStreamlinedData-CWz6AUdb.js";import{M as A}from"./MetricCard-C5FutAvg.js";import"./UnifiedDataService-apWnyCAi.js";import"./index-D6rKLjux.js";import"./stripe-CbtnRl6i.js";import"./index.esm-DonjM_pP.js";import"./index.esm-D7ujsXeY.js";const ls=a=>{switch(a){case"ACTIVE":return"success";case"PENDING":return"warning";case"SUSPENDED":return"error";case"EXPIRED":return"default";default:return"default"}},os=a=>{switch(a){case"ACTIVE":return e.jsx(B,{});case"PENDING":return e.jsx(re,{});case"SUSPENDED":return e.jsx(ce,{});case"EXPIRED":return e.jsx(te,{});default:return e.jsx(ie,{})}},ds=a=>{switch(a){case"BASIC":return"default";case"PROFESSIONAL":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},xs=()=>{const a=[];for(let r=0;r<4;r++)a.push(Math.random().toString(36).substr(2,4).toUpperCase());return`BL14-${a.join("-")}`},Ss=()=>{var q;const{enqueueSnackbar:a}=es(),{data:r,loading:le,error:oe}=ss(),{data:L,loading:de,error:xe}=ns(),{data:g,loading:he,error:ue,refetch:C}=as(),je=ts(),M=is(),ge=rs();cs();const[me,y]=o.useState(!1),[pe,b]=o.useState(!1),[hs,ye]=o.useState(!1),[fe,S]=o.useState(!1),[t,T]=o.useState(null),[$,U]=o.useState(null),[k,G]=o.useState(""),[w,V]=o.useState(""),[D,H]=o.useState("PROFESSIONAL"),[E,K]=o.useState(1),ve=le||de||he,Le=oe||xe||ue,l=o.useMemo(()=>{if(!r||!L||!g)return{licenses:[],stats:{totalLicenses:0,activeLicenses:0,expiringSoon:0,unassignedLicenses:0,utilizationRate:0}};const s=g.length,x=g.filter(f=>f.status==="ACTIVE").length,I=g.filter(f=>{const Te=new Date(f.expiresAt),ke=new Date(Date.now()+30*24*60*60*1e3);return Te<=ke}).length,h=g.filter(f=>!f.assignedTo).length,N=s>0?x/s*100:0;return{licenses:g,stats:{totalLicenses:s,activeLicenses:x,expiringSoon:I,unassignedLicenses:h,utilizationRate:N}}},[r,L,g]),Ce=(s,x)=>{T(x),U(s.currentTarget)},m=()=>{U(null),T(null)},be=s=>{navigator.clipboard.writeText(s),a("License key copied to clipboard",{variant:"success"}),m()},Se=async()=>{if(!t||!k.trim()){a("Please enter a valid email address",{variant:"error"});return}try{const s=`user_${Date.now()}`;await ge.mutate({licenseId:t.id,userId:s}),a(`License assigned to ${k}`,{variant:"success"}),G(""),b(!1),m(),C()}catch(s){a((s==null?void 0:s.message)||"Failed to assign license",{variant:"error"})}},we=async()=>{var s,x,I;if(!w.trim()){a("Please enter a license name",{variant:"error"});return}try{for(let h=0;h<E;h++){const N={key:xs(),name:E>1?`${w} ${h+1}`:w,tier:D,status:"PENDING",organization:{id:((s=r==null?void 0:r.organization)==null?void 0:s.id)||"",name:((x=r==null?void 0:r.organization)==null?void 0:x.name)||"",tier:((I=r==null?void 0:r.organization)==null?void 0:I.tier)||"BASIC"},usage:{apiCalls:0,dataTransfer:0,deviceCount:0,maxDevices:D==="ENTERPRISE"?10:D==="PROFESSIONAL"?5:2},expiresAt:new Date(Date.now()+31536e6)};await je.mutate(N)}a(`${E} license(s) created successfully`,{variant:"success"}),V(""),H("PROFESSIONAL"),K(1),y(!1),C()}catch(h){a((h==null?void 0:h.message)||"Failed to create license",{variant:"error"})}},De=async()=>{if(t){try{await M.mutate({licenseId:t.id,updates:{status:"SUSPENDED"}}),a(`License ${t.name} has been suspended`,{variant:"warning"}),C()}catch(s){a((s==null?void 0:s.message)||"Failed to suspend license",{variant:"error"})}m()}},Ee=async()=>{if(t){try{await M.mutate({licenseId:t.id,updates:{status:"ACTIVE"}}),a(`License ${t.name} has been activated`,{variant:"success"}),C()}catch(s){a((s==null?void 0:s.message)||"Failed to activate license",{variant:"error"})}m()}},Ie=()=>{t&&(S(!0),m())},Ae=async()=>{if(t)try{a(`License ${t.name} has been deleted`,{variant:"success"}),S(!1),T(null)}catch(s){a((s==null?void 0:s.message)||"Failed to delete license",{variant:"error"})}};return ve?e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(i,{textAlign:"center",children:[e.jsx(Ne,{size:60}),e.jsx(n,{variant:"h6",sx:{mt:2},children:"Loading License Data..."}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Fetching your licenses and subscription details"})]})}):Le?e.jsx(i,{sx:{p:3},children:e.jsxs(p,{severity:"error",children:[e.jsx(P,{children:"Unable to Load License Data"}),e.jsx(n,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your license information. This could be due to:"}),e.jsxs(Pe,{dense:!0,children:[e.jsxs(X,{children:[e.jsx(j,{children:e.jsx(te,{fontSize:"small"})}),e.jsx(_,{primary:"Network connectivity issues"})]}),e.jsxs(X,{children:[e.jsx(j,{children:e.jsx(We,{fontSize:"small"})}),e.jsx(_,{primary:"Authentication token expired"})]})]}),e.jsx(i,{sx:{mt:2},children:e.jsx(d,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!r||!L?e.jsx(i,{sx:{p:3},children:e.jsxs(p,{severity:"info",children:[e.jsx(P,{children:"Setting Up License Management"}),e.jsx(n,{variant:"body2",children:"We're preparing your license management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(i,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsxs(n,{variant:"body1",color:"text.secondary",children:["Manage your ",((q=L.organization)==null?void 0:q.name)||"Organization"," licenses and assignments"]})]}),e.jsx(d,{variant:"contained",startIcon:e.jsx(J,{}),onClick:()=>y(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Create License"})]}),e.jsxs(v,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(v,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Total Licenses",value:l.stats.totalLicenses.toString(),icon:e.jsx(ie,{}),color:"primary"})}),e.jsx(v,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Active Licenses",value:l.stats.activeLicenses.toString(),icon:e.jsx(B,{}),color:"success"})}),e.jsx(v,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Expiring Soon",value:l.stats.expiringSoon.toString(),icon:e.jsx(re,{}),color:"warning"})}),e.jsx(v,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Unassigned",value:l.stats.unassignedLicenses.toString(),icon:e.jsx(Re,{}),color:"secondary"})})]}),e.jsx(Q,{sx:{mb:4},children:e.jsxs(Y,{children:[e.jsx(n,{variant:"h6",sx:{fontWeight:600,mb:2},children:"License Utilization"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(ze,{variant:"determinate",value:l.stats.utilizationRate,sx:{flex:1,height:8,borderRadius:4}}),e.jsxs(n,{variant:"body2",sx:{minWidth:60},children:[l.stats.utilizationRate.toFixed(1),"%"]})]}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[l.stats.activeLicenses," of ",l.stats.totalLicenses," licenses are currently active"]})]})}),l.stats.expiringSoon>0&&e.jsxs(p,{severity:"warning",sx:{mb:4},children:[e.jsx(P,{children:"Licenses Expiring Soon"}),e.jsxs(n,{variant:"body2",sx:{mb:2},children:[l.stats.expiringSoon," license(s) will expire within the next 30 days."]}),e.jsx(d,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Renew Licenses"})]}),e.jsx(Q,{children:e.jsxs(Y,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(n,{variant:"h6",sx:{fontWeight:600},children:["All Licenses (",l.licenses.length,")"]}),e.jsx(d,{variant:"outlined",startIcon:e.jsx(Oe,{}),onClick:()=>a("License report downloaded",{variant:"success"}),children:"Export Report"})]}),e.jsx(Fe,{children:e.jsxs(Be,{children:[e.jsx(Me,{children:e.jsxs(Z,{children:[e.jsx(c,{sx:{fontWeight:600},children:"License"}),e.jsx(c,{sx:{fontWeight:600},children:"Tier"}),e.jsx(c,{sx:{fontWeight:600},children:"Status"}),e.jsx(c,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(c,{sx:{fontWeight:600},children:"Usage"}),e.jsx(c,{sx:{fontWeight:600},children:"Expires"}),e.jsx(c,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx($e,{children:l.licenses.map(s=>e.jsxs(Z,{hover:!0,children:[e.jsx(c,{children:e.jsxs(i,{children:[e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:s.name}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:s.key})]})}),e.jsx(c,{children:e.jsx(ee,{label:s.tier,color:ds(s.tier),size:"small",icon:s.tier==="ENTERPRISE"?e.jsx(Ue,{}):void 0})}),e.jsx(c,{children:e.jsx(ee,{icon:os(s.status),label:s.status,color:ls(s.status),size:"small"})}),e.jsx(c,{children:s.assignedTo?e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{sx:{width:24,height:24},children:s.assignedTo.name.charAt(0)}),e.jsxs(i,{children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:s.assignedTo.name}),e.jsx(n,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(c,{children:e.jsxs(i,{children:[e.jsxs(n,{variant:"body2",children:[s.usage.apiCalls.toLocaleString()," API calls"]}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:[s.usage.dataTransfer," GB transferred"]})]})}),e.jsx(c,{children:e.jsx(n,{variant:"body2",color:new Date(s.expiresAt)<=new Date(Date.now()+30*24*60*60*1e3)?"warning.main":"text.primary",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsx(c,{children:e.jsx(Ve,{size:"small",onClick:x=>Ce(x,s),children:e.jsx(He,{})})})]},s.id))})]})})]})}),e.jsx(Ke,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>y(!0),children:e.jsx(J,{})}),e.jsxs(W,{open:me,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(R,{children:"Create New License"}),e.jsx(z,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(O,{fullWidth:!0,label:"License Name",value:w,onChange:s=>V(s.target.value),placeholder:"Development Team License"}),e.jsxs(qe,{fullWidth:!0,children:[e.jsx(Xe,{children:"License Tier"}),e.jsxs(_e,{value:D,label:"License Tier",onChange:s=>H(s.target.value),children:[e.jsx(u,{value:"BASIC",children:"Basic - Limited features"}),e.jsx(u,{value:"PROFESSIONAL",children:"Pro - Full features"}),e.jsx(u,{value:"ENTERPRISE",children:"Enterprise - Advanced features"})]})]}),e.jsx(O,{fullWidth:!0,label:"Number of Licenses",type:"number",value:E,onChange:s=>K(parseInt(s.target.value)||1),inputProps:{min:1,max:50}}),e.jsx(p,{severity:"info",children:e.jsx(n,{variant:"body2",children:"New licenses will be created with a 1-year validity period and can be assigned to team members immediately."})})]})}),e.jsxs(F,{children:[e.jsx(d,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(d,{onClick:we,variant:"contained",startIcon:e.jsx(Je,{}),children:"Create License"})]})]}),e.jsxs(W,{open:pe,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(R,{children:"Assign License"}),e.jsx(z,{children:t&&e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(p,{severity:"info",children:e.jsxs(n,{variant:"body2",children:["Assigning license: ",e.jsx("strong",{children:t.name})]})}),e.jsx(O,{fullWidth:!0,label:"Email Address",type:"email",value:k,onChange:s=>G(s.target.value),placeholder:"user@company.com"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"The user will receive an email with instructions to activate their license."})]})}),e.jsxs(F,{children:[e.jsx(d,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(d,{onClick:Se,variant:"contained",startIcon:e.jsx(se,{}),children:"Assign License"})]})]}),e.jsxs(W,{open:fe,onClose:()=>S(!1),maxWidth:"sm",children:[e.jsx(R,{children:"Delete License"}),e.jsx(z,{children:t&&e.jsxs(i,{children:[e.jsxs(n,{variant:"body1",sx:{mb:2},children:["Are you sure you want to delete ",e.jsx("strong",{children:t.name}),"?"]}),e.jsx(p,{severity:"warning",children:e.jsx(n,{variant:"body2",children:"This action cannot be undone. The license will be permanently removed and any assigned user will lose access."})})]})}),e.jsxs(F,{children:[e.jsx(d,{onClick:()=>S(!1),children:"Cancel"}),e.jsx(d,{onClick:Ae,variant:"contained",color:"error",startIcon:e.jsx(ne,{}),children:"Delete License"})]})]}),e.jsxs(Qe,{anchorEl:$,open:!!$,onClose:m,children:[e.jsxs(u,{onClick:()=>t&&be(t.key),children:[e.jsx(j,{children:e.jsx(Ye,{})}),"Copy License Key"]}),!(t!=null&&t.assignedTo)&&e.jsxs(u,{onClick:()=>b(!0),children:[e.jsx(j,{children:e.jsx(se,{})}),"Assign License"]}),e.jsxs(u,{onClick:()=>ye(!0),children:[e.jsx(j,{children:e.jsx(Ze,{})}),"Edit License"]}),e.jsx(ae,{}),(t==null?void 0:t.status)==="ACTIVE"?e.jsxs(u,{onClick:De,children:[e.jsx(j,{children:e.jsx(ce,{})}),"Suspend License"]}):e.jsxs(u,{onClick:Ee,children:[e.jsx(j,{children:e.jsx(B,{})}),"Activate License"]}),e.jsx(ae,{}),e.jsxs(u,{onClick:Ie,sx:{color:"error.main"},children:[e.jsx(j,{children:e.jsx(ne,{sx:{color:"error.main"}})}),"Delete License"]})]})]})};export{Ss as default};
