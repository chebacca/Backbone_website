import{j as e,a as i,T as a,d as C,az as te,G as j,k as L,l as S,J as O,c as V,v as $,aA as re,aB as oe,aC as ce,aD as de,aE as le,aF as H,aG as t,aH as xe,at as he,h as J,I as ue,aI as ge,ak as je,a5 as x,Y as h,aJ as me,aK as pe,aL as ye,aM as be,i as fe,ar as ve,aN as Ce,aO as Le,aP as Se,aQ as ke,o as K,aR as Q,Q as Ae}from"./mui-B8PGH2kt.js";import{r as o}from"./vendor-DIxetjBo.js";import{u as Ee}from"./notistack.esm-Bg0Tn0tt.js";import{u as Ie,c as A,e as E}from"./index-C2rukcDL.js";import"./stripe-CUnmz-K2.js";const Te=r=>{switch(r){case"ACTIVE":return"success";case"SUSPENDED":return"warning";case"EXPIRED":return"error";case"PENDING":return"info";default:return"default"}},we=r=>{switch(r){case"ACTIVE":return e.jsx(K,{});case"SUSPENDED":return e.jsx(Q,{});case"EXPIRED":return e.jsx(Ae,{});case"PENDING":return e.jsx(Q,{});default:return e.jsx(K,{})}},De=r=>{switch(r){case"BASIC":return"default";case"PRO":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},Be=()=>{const{enqueueSnackbar:r}=Ee(),{user:l}=Ie(),[Pe,I]=o.useState(!1),[u,T]=o.useState([]),[w,D]=o.useState(null),[d,P]=o.useState(null),[X,m]=o.useState(!1),[p,W]=o.useState(""),[y,q]=o.useState("");o.useEffect(()=>{let s=!0;return(async()=>{var c,R,z,U,B,F;try{I(!0);const ne=String((l==null?void 0:l.role)||"").toUpperCase()==="SUPERADMIN";let v=[];if(ne)try{v=((R=(c=(await A.get(`${E.admin.licenses()}?limit=200`)).data)==null?void 0:c.data)==null?void 0:R.licenses)??[]}catch{v=((U=(z=(await A.get(E.licenses.myLicenses())).data)==null?void 0:z.data)==null?void 0:U.licenses)??[]}else v=((F=(B=(await A.get(E.licenses.myLicenses())).data)==null?void 0:B.data)==null?void 0:F.licenses)??[];const ie=v.map((n,N)=>{var G;return{id:n.id,key:n.key,name:(G=n.user)!=null&&G.name?`${n.user.name}'s License`:`License ${N+1}`,tier:n.tier,status:n.status,assignedTo:n.user?{name:n.user.name||"User",email:n.user.email||""}:void 0,activatedAt:n.activatedAt||void 0,expiresAt:n.expiresAt||new Date(Date.now()+30*24*3600*1e3).toISOString(),lastUsed:n.updatedAt||void 0,deviceCount:n.activationCount??0,maxDevices:n.maxActivations??1,usage:{apiCalls:0,dataTransfer:0}}});if(!s)return;T(ie)}catch(f){if(!s)return;r((f==null?void 0:f.message)||"Failed to load licenses",{variant:"error"}),T([])}finally{s&&I(!1)}})(),()=>{s=!1}},[l==null?void 0:l.role,r]);const Y=(s,c)=>{D(s.currentTarget),P(c)},g=()=>{D(null),P(null)},Z=s=>{navigator.clipboard.writeText(s),r("License key copied to clipboard",{variant:"success"}),g()},_=()=>{d&&p&&(r(`License assigned to ${p}`,{variant:"success"}),m(!1),W(""),g())},ee=()=>{d&&(r("License suspended",{variant:"warning"}),g())},se=()=>{d&&(r("License activated",{variant:"success"}),g())},ae=u.filter(s=>{var c;return s.name.toLowerCase().includes(y.toLowerCase())||s.key.toLowerCase().includes(y.toLowerCase())||(((c=s.assignedTo)==null?void 0:c.email)||"").toLowerCase().includes(y.toLowerCase())}),k=o.useMemo(()=>u.filter(s=>s.status==="ACTIVE").length,[u]),b=o.useMemo(()=>u.length,[u]),M=o.useMemo(()=>b<=0?0:Math.round(k/b*100),[k,b]);return e.jsxs(i,{children:[e.jsx(i,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(i,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsx(a,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Manage and monitor your BackboneLogic, Inc. licenses"})]}),e.jsx(C,{variant:"contained",startIcon:e.jsx(te,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Add License"})]})}),e.jsxs(j,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(i,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(S,{children:[e.jsx(a,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:k}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Active Licenses"})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(i,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(S,{children:[e.jsx(a,{variant:"h3",sx:{fontWeight:700},children:b}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total Licenses"})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(i,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(S,{children:[e.jsxs(a,{variant:"h3",sx:{fontWeight:700},children:[M,"%"]}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Utilization Rate"}),e.jsx(O,{variant:"determinate",value:M,sx:{mt:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(i,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(S,{children:[e.jsx(a,{variant:"h3",sx:{fontWeight:700},children:"15"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Days to Renewal"})]})})})})]}),e.jsx(i,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},children:e.jsx(V,{sx:{p:3,mb:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(i,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx($,{placeholder:"Search licenses...",value:y,onChange:s=>q(s.target.value),size:"small",sx:{flex:1},InputProps:{startAdornment:e.jsx(re,{sx:{color:"text.secondary",mr:1}})}}),e.jsx(C,{variant:"outlined",startIcon:e.jsx(oe,{}),sx:{whiteSpace:"nowrap"},children:"Filters"})]})})}),e.jsx(i,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.6},children:e.jsx(ce,{component:V,sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(de,{children:[e.jsx(le,{children:e.jsxs(H,{children:[e.jsx(t,{sx:{fontWeight:600},children:"License"}),e.jsx(t,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(t,{sx:{fontWeight:600},children:"Status"}),e.jsx(t,{sx:{fontWeight:600},children:"Tier"}),e.jsx(t,{sx:{fontWeight:600},children:"Devices"}),e.jsx(t,{sx:{fontWeight:600},children:"Usage"}),e.jsx(t,{sx:{fontWeight:600},children:"Expires"}),e.jsx(t,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(xe,{children:ae.map(s=>e.jsxs(H,{hover:!0,children:[e.jsx(t,{children:e.jsxs(i,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:s.name}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:s.key})]})}),e.jsx(t,{children:s.assignedTo?e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(he,{sx:{width:32,height:32,fontSize:"0.875rem"},children:s.assignedTo.name[0]}),e.jsxs(i,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:s.assignedTo.name}),e.jsx(a,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(t,{children:e.jsx(J,{icon:we(s.status),label:s.status,color:Te(s.status),size:"small",sx:{fontWeight:500}})}),e.jsx(t,{children:e.jsx(J,{label:s.tier,color:De(s.tier),size:"small",variant:"outlined"})}),e.jsx(t,{children:e.jsxs(i,{children:[e.jsxs(a,{variant:"body2",children:[s.deviceCount,"/",s.maxDevices]}),e.jsx(O,{variant:"determinate",value:s.deviceCount/s.maxDevices*100,sx:{width:80,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2}}})]})}),e.jsx(t,{children:e.jsxs(i,{children:[e.jsxs(a,{variant:"body2",children:[s.usage.apiCalls.toLocaleString()," calls"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.usage.dataTransfer," GB"]})]})}),e.jsx(t,{children:e.jsx(a,{variant:"body2",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsx(t,{children:e.jsx(ue,{onClick:c=>Y(c,s),size:"small",children:e.jsx(ge,{})})})]},s.id))})]})})}),e.jsxs(je,{anchorEl:w,open:!!w,onClose:g,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsxs(x,{onClick:()=>d&&Z(d.key),children:[e.jsx(h,{children:e.jsx(me,{fontSize:"small"})}),"Copy License Key"]}),e.jsxs(x,{onClick:()=>m(!0),children:[e.jsx(h,{children:e.jsx(pe,{fontSize:"small"})}),"Assign License"]}),e.jsxs(x,{onClick:()=>{},children:[e.jsx(h,{children:e.jsx(ye,{fontSize:"small"})}),"Edit License"]}),(d==null?void 0:d.status)==="ACTIVE"?e.jsxs(x,{onClick:ee,children:[e.jsx(h,{children:e.jsx(be,{fontSize:"small"})}),"Suspend License"]}):e.jsxs(x,{onClick:se,children:[e.jsx(h,{children:e.jsx(fe,{fontSize:"small"})}),"Activate License"]}),e.jsxs(x,{onClick:()=>{},children:[e.jsx(h,{children:e.jsx(ve,{fontSize:"small"})}),"Download Details"]})]}),e.jsxs(Ce,{open:X,onClose:()=>m(!1),PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(Le,{children:"Assign License"}),e.jsx(Se,{children:e.jsx($,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",fullWidth:!0,variant:"outlined",value:p,onChange:s=>W(s.target.value),sx:{mt:2}})}),e.jsxs(ke,{children:[e.jsx(C,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(C,{onClick:_,variant:"contained",disabled:!p,children:"Assign"})]})]})]})};export{Be as default};
