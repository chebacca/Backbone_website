import{j as e,B as i,C as Ve,T as n,d as v,ai as I,w as Ge,x as te,y as g,aj as me,z as ie,H as He,a as h,ap as re,G as L,ae as ge,p as N,am as pe,aq as Ke,t as oe,v as le,i as qe,af as Xe,ar as _e,as as Je,at as Qe,au as ce,av as o,aw as Ye,r as de,u as Ze,ag as es,g as ss,ax as ns,ay as as,az as A,aA as k,aB as P,e as R,aC as ts,aD as is,aE as rs,a5 as j,aF as M,aG as os,aH as xe,aI as he,a4 as ls,aJ as cs,aK as ds,D as ue,aL as fe}from"./mui-C_fh8XDr.js";import{r as d}from"./vendor-CjD1bmmO.js";import{u as xs}from"./notistack.esm-Ca-E78ev.js";import{u as hs,a as us,b as js}from"./useStreamlinedData-aou3zA1R.js";import{M as D}from"./MetricCard-CgsP6LiV.js";import"./index-D8-YPbah.js";import"./stripe-DhLvsej_.js";import"./index.esm-CyAlu9Ug.js";import"./index.esm-DmQE6AXN.js";const ms=a=>{switch(a){case"ACTIVE":return"success";case"PENDING":return"warning";case"SUSPENDED":return"error";case"EXPIRED":return"default";default:return"default"}},gs=a=>{switch(a){case"ACTIVE":return e.jsx(N,{});case"PENDING":return e.jsx(pe,{});case"SUSPENDED":return e.jsx(fe,{});case"EXPIRED":return e.jsx(me,{});default:return e.jsx(ge,{})}},ps=a=>{switch(a){case"BASIC":return"default";case"PRO":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},je=()=>{const a=[];for(let r=0;r<4;r++)a.push(Math.random().toString(36).substr(2,4).toUpperCase());return`BL14-${a.join("-")}`},Ts=()=>{var G;const{enqueueSnackbar:a}=xs(),{data:r,loading:ve,error:ye}=hs(),{data:x,loading:Ce,error:Le}=us(),{loading:be,error:we}=js(),[De,y]=d.useState(!1),[Ee,b]=d.useState(!1),[fs,Se]=d.useState(!1),[Te,w]=d.useState(!1),[t,E]=d.useState(null),[W,O]=d.useState(null),[S,z]=d.useState(""),[U,B]=d.useState(""),[Ie,F]=d.useState("PRO"),[$,V]=d.useState(1),Ae=ve||Ce||be,ke=ye||Le||we,c=d.useMemo(()=>{var K,q,X,_,J,Q,Y,Z,ee,se,ne,ae;if(!r||!x)return{licenses:[],stats:{totalLicenses:0,activeLicenses:0,expiringSoon:0,unassignedLicenses:0,utilizationRate:0}};const s=((K=x.subscription)==null?void 0:K.seats)||1,C=((X=(q=x.organization)==null?void 0:q.usage)==null?void 0:X.totalUsers)||1,f=((J=(_=x.subscription)==null?void 0:_.plan)==null?void 0:J.tier)||"PRO",m=[{id:r.id,key:((Q=r.license)==null?void 0:Q.key)||je(),name:`${r.name||"User"}'s License`,tier:f,status:((Y=r.license)==null?void 0:Y.status)==="ACTIVE"?"ACTIVE":"PENDING",assignedTo:{name:r.name||"User",email:r.email,avatar:r.photoURL},activatedAt:((Z=r.license)==null?void 0:Z.activatedAt)||r.createdAt,expiresAt:((ee=x.subscription)==null?void 0:ee.currentPeriodEnd)||new Date(Date.now()+365*24*60*60*1e3).toISOString(),lastUsed:new Date().toISOString(),deviceCount:1,maxDevices:f==="ENTERPRISE"?10:f==="PRO"?5:2,usage:{apiCalls:Math.floor(Math.random()*1e4),dataTransfer:Math.floor(Math.random()*50)}}];for(let l=1;l<s;l++){const u=l<C,T=u?"ACTIVE":Math.random()>.7?"PENDING":"ACTIVE";m.push({id:`license_${l}`,key:je(),name:`License ${l+1}`,tier:f,status:T,assignedTo:u?{name:`Team Member ${l}`,email:`member${l}@${((ne=(se=x.organization)==null?void 0:se.name)==null?void 0:ne.toLowerCase().replace(/\s+/g,""))||"company"}.com`}:void 0,activatedAt:u?new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString():void 0,expiresAt:((ae=x.subscription)==null?void 0:ae.currentPeriodEnd)||new Date(Date.now()+365*24*60*60*1e3).toISOString(),lastUsed:u?new Date(Date.now()-Math.random()*7*24*60*60*1e3).toISOString():void 0,deviceCount:u?Math.floor(Math.random()*3)+1:0,maxDevices:f==="ENTERPRISE"?10:f==="PRO"?5:2,usage:{apiCalls:u?Math.floor(Math.random()*5e3):0,dataTransfer:u?Math.floor(Math.random()*25):0}})}const H=m.filter(l=>l.status==="ACTIVE").length,Be=m.filter(l=>{const u=new Date(l.expiresAt),T=new Date(Date.now()+30*24*60*60*1e3);return u<=T}).length,Fe=m.filter(l=>!l.assignedTo).length,$e={totalLicenses:m.length,activeLicenses:H,expiringSoon:Be,unassignedLicenses:Fe,utilizationRate:m.length>0?H/m.length*100:0};return{licenses:m,stats:$e}},[r,x]),Pe=(s,C)=>{E(C),O(s.currentTarget)},p=()=>{O(null),E(null)},Re=s=>{navigator.clipboard.writeText(s),a("License key copied to clipboard",{variant:"success"}),p()},Me=async()=>{if(!t||!S.trim()){a("Please enter a valid email address",{variant:"error"});return}try{a(`License assigned to ${S}`,{variant:"success"}),z(""),b(!1),p()}catch(s){a((s==null?void 0:s.message)||"Failed to assign license",{variant:"error"})}},Ne=async()=>{if(!U.trim()){a("Please enter a license name",{variant:"error"});return}try{a(`${$} license(s) created successfully`,{variant:"success"}),B(""),F("PRO"),V(1),y(!1)}catch(s){a((s==null?void 0:s.message)||"Failed to create license",{variant:"error"})}},We=()=>{t&&(a(`License ${t.name} has been suspended`,{variant:"warning"}),p())},Oe=()=>{t&&(a(`License ${t.name} has been activated`,{variant:"success"}),p())},ze=()=>{t&&(w(!0),p())},Ue=async()=>{if(t)try{a(`License ${t.name} has been deleted`,{variant:"success"}),w(!1),E(null)}catch(s){a((s==null?void 0:s.message)||"Failed to delete license",{variant:"error"})}};return Ae?e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(i,{textAlign:"center",children:[e.jsx(Ve,{size:60}),e.jsx(n,{variant:"h6",sx:{mt:2},children:"Loading License Data..."}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Fetching your licenses and subscription details"})]})}):ke?e.jsx(i,{sx:{p:3},children:e.jsxs(v,{severity:"error",children:[e.jsx(I,{children:"Unable to Load License Data"}),e.jsx(n,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your license information. This could be due to:"}),e.jsxs(Ge,{dense:!0,children:[e.jsxs(te,{children:[e.jsx(g,{children:e.jsx(me,{fontSize:"small"})}),e.jsx(ie,{primary:"Network connectivity issues"})]}),e.jsxs(te,{children:[e.jsx(g,{children:e.jsx(He,{fontSize:"small"})}),e.jsx(ie,{primary:"Authentication token expired"})]})]}),e.jsx(i,{sx:{mt:2},children:e.jsx(h,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!r||!x?e.jsx(i,{sx:{p:3},children:e.jsxs(v,{severity:"info",children:[e.jsx(I,{children:"Setting Up License Management"}),e.jsx(n,{variant:"body2",children:"We're preparing your license management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(i,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsxs(n,{variant:"body1",color:"text.secondary",children:["Manage your ",((G=x.organization)==null?void 0:G.name)||"Organization"," licenses and assignments"]})]}),e.jsx(h,{variant:"contained",startIcon:e.jsx(re,{}),onClick:()=>y(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Create License"})]}),e.jsxs(L,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(L,{item:!0,xs:12,sm:6,md:3,children:e.jsx(D,{title:"Total Licenses",value:c.stats.totalLicenses,icon:e.jsx(ge,{}),color:"primary"})}),e.jsx(L,{item:!0,xs:12,sm:6,md:3,children:e.jsx(D,{title:"Active Licenses",value:c.stats.activeLicenses,icon:e.jsx(N,{}),color:"success"})}),e.jsx(L,{item:!0,xs:12,sm:6,md:3,children:e.jsx(D,{title:"Expiring Soon",value:c.stats.expiringSoon,icon:e.jsx(pe,{}),color:"warning"})}),e.jsx(L,{item:!0,xs:12,sm:6,md:3,children:e.jsx(D,{title:"Unassigned",value:c.stats.unassignedLicenses,icon:e.jsx(Ke,{}),color:"info"})})]}),e.jsx(oe,{sx:{mb:4},children:e.jsxs(le,{children:[e.jsx(n,{variant:"h6",sx:{fontWeight:600,mb:2},children:"License Utilization"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(qe,{variant:"determinate",value:c.stats.utilizationRate,sx:{flex:1,height:8,borderRadius:4}}),e.jsxs(n,{variant:"body2",sx:{minWidth:60},children:[c.stats.utilizationRate.toFixed(1),"%"]})]}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[c.stats.activeLicenses," of ",c.stats.totalLicenses," licenses are currently active"]})]})}),c.stats.expiringSoon>0&&e.jsxs(v,{severity:"warning",sx:{mb:4},children:[e.jsx(I,{children:"Licenses Expiring Soon"}),e.jsxs(n,{variant:"body2",sx:{mb:2},children:[c.stats.expiringSoon," license(s) will expire within the next 30 days."]}),e.jsx(h,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Renew Licenses"})]}),e.jsx(oe,{children:e.jsxs(le,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(n,{variant:"h6",sx:{fontWeight:600},children:["All Licenses (",c.licenses.length,")"]}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(Xe,{}),onClick:()=>a("License report downloaded",{variant:"success"}),children:"Export Report"})]}),e.jsx(_e,{children:e.jsxs(Je,{children:[e.jsx(Qe,{children:e.jsxs(ce,{children:[e.jsx(o,{sx:{fontWeight:600},children:"License"}),e.jsx(o,{sx:{fontWeight:600},children:"Tier"}),e.jsx(o,{sx:{fontWeight:600},children:"Status"}),e.jsx(o,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(o,{sx:{fontWeight:600},children:"Usage"}),e.jsx(o,{sx:{fontWeight:600},children:"Expires"}),e.jsx(o,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Ye,{children:c.licenses.map(s=>e.jsxs(ce,{hover:!0,children:[e.jsx(o,{children:e.jsxs(i,{children:[e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:s.name}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:s.key})]})}),e.jsx(o,{children:e.jsx(de,{label:s.tier,color:ps(s.tier),size:"small",icon:s.tier==="ENTERPRISE"?e.jsx(Ze,{}):void 0})}),e.jsx(o,{children:e.jsx(de,{icon:gs(s.status),label:s.status,color:ms(s.status),size:"small"})}),e.jsx(o,{children:s.assignedTo?e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(es,{src:s.assignedTo.avatar,sx:{width:24,height:24},children:s.assignedTo.name.charAt(0)}),e.jsxs(i,{children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:s.assignedTo.name}),e.jsx(n,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(o,{children:e.jsxs(i,{children:[e.jsxs(n,{variant:"body2",children:[s.usage.apiCalls.toLocaleString()," API calls"]}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:[s.usage.dataTransfer," GB transferred"]})]})}),e.jsx(o,{children:e.jsx(n,{variant:"body2",color:new Date(s.expiresAt)<=new Date(Date.now()+30*24*60*60*1e3)?"warning.main":"text.primary",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsx(o,{children:e.jsx(ss,{size:"small",onClick:C=>Pe(C,s),children:e.jsx(ns,{})})})]},s.id))})]})})]})}),e.jsx(as,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>y(!0),children:e.jsx(re,{})}),e.jsxs(A,{open:De,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(k,{children:"Create New License"}),e.jsx(P,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(R,{fullWidth:!0,label:"License Name",value:U,onChange:s=>B(s.target.value),placeholder:"Development Team License"}),e.jsxs(ts,{fullWidth:!0,children:[e.jsx(is,{children:"License Tier"}),e.jsxs(rs,{value:Ie,label:"License Tier",onChange:s=>F(s.target.value),children:[e.jsx(j,{value:"BASIC",children:"Basic - Limited features"}),e.jsx(j,{value:"PRO",children:"Pro - Full features"}),e.jsx(j,{value:"ENTERPRISE",children:"Enterprise - Advanced features"})]})]}),e.jsx(R,{fullWidth:!0,label:"Number of Licenses",type:"number",value:$,onChange:s=>V(parseInt(s.target.value)||1),inputProps:{min:1,max:50}}),e.jsx(v,{severity:"info",children:e.jsx(n,{variant:"body2",children:"New licenses will be created with a 1-year validity period and can be assigned to team members immediately."})})]})}),e.jsxs(M,{children:[e.jsx(h,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(h,{onClick:Ne,variant:"contained",startIcon:e.jsx(os,{}),children:"Create License"})]})]}),e.jsxs(A,{open:Ee,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(k,{children:"Assign License"}),e.jsx(P,{children:t&&e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(v,{severity:"info",children:e.jsxs(n,{variant:"body2",children:["Assigning license: ",e.jsx("strong",{children:t.name})]})}),e.jsx(R,{fullWidth:!0,label:"Email Address",type:"email",value:S,onChange:s=>z(s.target.value),placeholder:"user@company.com"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"The user will receive an email with instructions to activate their license."})]})}),e.jsxs(M,{children:[e.jsx(h,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(h,{onClick:Me,variant:"contained",startIcon:e.jsx(xe,{}),children:"Assign License"})]})]}),e.jsxs(A,{open:Te,onClose:()=>w(!1),maxWidth:"sm",children:[e.jsx(k,{children:"Delete License"}),e.jsx(P,{children:t&&e.jsxs(i,{children:[e.jsxs(n,{variant:"body1",sx:{mb:2},children:["Are you sure you want to delete ",e.jsx("strong",{children:t.name}),"?"]}),e.jsx(v,{severity:"warning",children:e.jsx(n,{variant:"body2",children:"This action cannot be undone. The license will be permanently removed and any assigned user will lose access."})})]})}),e.jsxs(M,{children:[e.jsx(h,{onClick:()=>w(!1),children:"Cancel"}),e.jsx(h,{onClick:Ue,variant:"contained",color:"error",startIcon:e.jsx(he,{}),children:"Delete License"})]})]}),e.jsxs(ls,{anchorEl:W,open:!!W,onClose:p,children:[e.jsxs(j,{onClick:()=>t&&Re(t.key),children:[e.jsx(g,{children:e.jsx(cs,{})}),"Copy License Key"]}),!(t!=null&&t.assignedTo)&&e.jsxs(j,{onClick:()=>b(!0),children:[e.jsx(g,{children:e.jsx(xe,{})}),"Assign License"]}),e.jsxs(j,{onClick:()=>Se(!0),children:[e.jsx(g,{children:e.jsx(ds,{})}),"Edit License"]}),e.jsx(ue,{}),(t==null?void 0:t.status)==="ACTIVE"?e.jsxs(j,{onClick:We,children:[e.jsx(g,{children:e.jsx(fe,{})}),"Suspend License"]}):e.jsxs(j,{onClick:Oe,children:[e.jsx(g,{children:e.jsx(N,{})}),"Activate License"]}),e.jsx(ue,{}),e.jsxs(j,{onClick:ze,sx:{color:"error.main"},children:[e.jsx(g,{children:e.jsx(he,{sx:{color:"error.main"}})}),"Delete License"]})]})]})};export{Ts as default};
