import{j as e,a as t,T as n,d as C,az as ie,G as j,k as L,l as S,J as O,c as V,v as $,aA as re,aB as oe,aC as ce,aD as de,aE as le,aF as H,aG as i,aH as xe,at as he,h as J,I as ue,aI as ge,ak as je,a5 as x,Y as h,aJ as pe,aK as me,aL as ye,aM as be,i as fe,ar as ve,aN as Ce,aO as Le,aP as Se,aQ as ke,o as K,aR as Q,Q as Ae}from"./mui-B8PGH2kt.js";import{r as o}from"./vendor-DIxetjBo.js";import{u as Ee}from"./notistack.esm-Bg0Tn0tt.js";import{u as Ie,c as A,e as E}from"./index-BZYSNm-G.js";import"./stripe-CUnmz-K2.js";const Te=r=>{switch(r){case"ACTIVE":return"success";case"SUSPENDED":return"warning";case"EXPIRED":return"error";case"PENDING":return"info";default:return"default"}},we=r=>{switch(r){case"ACTIVE":return e.jsx(K,{});case"SUSPENDED":return e.jsx(Q,{});case"EXPIRED":return e.jsx(Ae,{});case"PENDING":return e.jsx(Q,{});default:return e.jsx(K,{})}},De=r=>{switch(r){case"BASIC":return"default";case"PRO":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},Be=()=>{const{enqueueSnackbar:r}=Ee(),{user:l}=Ie(),[Pe,I]=o.useState(!1),[u,T]=o.useState([]),[w,D]=o.useState(null),[d,P]=o.useState(null),[X,p]=o.useState(!1),[m,W]=o.useState(""),[y,q]=o.useState("");o.useEffect(()=>{let a=!0;return(async()=>{var c,R,z,U,B,F;try{I(!0);const ne=String((l==null?void 0:l.role)||"").toUpperCase()==="SUPERADMIN";let v=[];if(ne)try{v=((R=(c=(await A.get(`${E.admin.licenses()}?limit=200`)).data)==null?void 0:c.data)==null?void 0:R.licenses)??[]}catch{v=((U=(z=(await A.get(E.licenses.myLicenses())).data)==null?void 0:z.data)==null?void 0:U.licenses)??[]}else v=((F=(B=(await A.get(E.licenses.myLicenses())).data)==null?void 0:B.data)==null?void 0:F.licenses)??[];const te=v.map((s,N)=>{var G;return{id:s.id,key:s.key,name:(G=s.user)!=null&&G.name?`${s.user.name}'s License`:`License ${N+1}`,tier:String(s.tier||"").toUpperCase(),status:String(s.status||"").toUpperCase(),assignedTo:s.user?{name:s.user.name||"User",email:s.user.email||""}:void 0,activatedAt:s.activatedAt||s.createdAt||void 0,expiresAt:s.expiresAt||s.currentPeriodEnd||new Date(Date.now()+30*24*3600*1e3).toISOString(),lastUsed:s.updatedAt||s.activatedAt||s.createdAt||void 0,deviceCount:s.activationCount??0,maxDevices:s.maxActivations??1,usage:{apiCalls:0,dataTransfer:0}}});if(!a)return;T(te)}catch(f){if(!a)return;r((f==null?void 0:f.message)||"Failed to load licenses",{variant:"error"}),T([])}finally{a&&I(!1)}})(),()=>{a=!1}},[l==null?void 0:l.role,r]);const Y=(a,c)=>{D(a.currentTarget),P(c)},g=()=>{D(null),P(null)},Z=a=>{navigator.clipboard.writeText(a),r("License key copied to clipboard",{variant:"success"}),g()},_=()=>{d&&m&&(r(`License assigned to ${m}`,{variant:"success"}),p(!1),W(""),g())},ee=()=>{d&&(r("License suspended",{variant:"warning"}),g())},ae=()=>{d&&(r("License activated",{variant:"success"}),g())},se=u.filter(a=>{var c;return a.name.toLowerCase().includes(y.toLowerCase())||a.key.toLowerCase().includes(y.toLowerCase())||(((c=a.assignedTo)==null?void 0:c.email)||"").toLowerCase().includes(y.toLowerCase())}),k=o.useMemo(()=>u.filter(a=>a.status==="ACTIVE").length,[u]),b=o.useMemo(()=>u.length,[u]),M=o.useMemo(()=>b<=0?0:Math.round(k/b*100),[k,b]);return e.jsxs(t,{children:[e.jsx(t,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(t,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsx(n,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Manage and monitor your BackboneLogic, Inc. licenses"})]}),e.jsx(C,{variant:"contained",startIcon:e.jsx(ie,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Add License"})]})}),e.jsxs(j,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(S,{children:[e.jsx(n,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:k}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Active Licenses"})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(S,{children:[e.jsx(n,{variant:"h3",sx:{fontWeight:700},children:b}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Total Licenses"})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(S,{children:[e.jsxs(n,{variant:"h3",sx:{fontWeight:700},children:[M,"%"]}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Utilization Rate"}),e.jsx(O,{variant:"determinate",value:M,sx:{mt:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}})]})})})}),e.jsx(j,{item:!0,xs:12,sm:6,md:3,children:e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:e.jsx(L,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(S,{children:[e.jsx(n,{variant:"h3",sx:{fontWeight:700},children:"15"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Days to Renewal"})]})})})})]}),e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},children:e.jsx(V,{sx:{p:3,mb:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(t,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx($,{placeholder:"Search licenses...",value:y,onChange:a=>q(a.target.value),size:"small",sx:{flex:1},InputProps:{startAdornment:e.jsx(re,{sx:{color:"text.secondary",mr:1}})}}),e.jsx(C,{variant:"outlined",startIcon:e.jsx(oe,{}),sx:{whiteSpace:"nowrap"},children:"Filters"})]})})}),e.jsx(t,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.6},children:e.jsx(ce,{component:V,sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(de,{children:[e.jsx(le,{children:e.jsxs(H,{children:[e.jsx(i,{sx:{fontWeight:600},children:"License"}),e.jsx(i,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(i,{sx:{fontWeight:600},children:"Status"}),e.jsx(i,{sx:{fontWeight:600},children:"Tier"}),e.jsx(i,{sx:{fontWeight:600},children:"Devices"}),e.jsx(i,{sx:{fontWeight:600},children:"Usage"}),e.jsx(i,{sx:{fontWeight:600},children:"Expires"}),e.jsx(i,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(xe,{children:se.map(a=>e.jsxs(H,{hover:!0,children:[e.jsx(i,{children:e.jsxs(t,{children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:a.name}),e.jsx(n,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:a.key})]})}),e.jsx(i,{children:a.assignedTo?e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(he,{sx:{width:32,height:32,fontSize:"0.875rem"},children:a.assignedTo.name[0]}),e.jsxs(t,{children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:a.assignedTo.name}),e.jsx(n,{variant:"caption",color:"text.secondary",children:a.assignedTo.email})]})]}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(i,{children:e.jsx(J,{icon:we(a.status),label:a.status,color:Te(a.status),size:"small",sx:{fontWeight:500}})}),e.jsx(i,{children:e.jsx(J,{label:a.tier,color:De(a.tier),size:"small",variant:"outlined"})}),e.jsx(i,{children:e.jsxs(t,{children:[e.jsxs(n,{variant:"body2",children:[a.deviceCount,"/",a.maxDevices]}),e.jsx(O,{variant:"determinate",value:a.deviceCount/a.maxDevices*100,sx:{width:80,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2}}})]})}),e.jsx(i,{children:e.jsxs(t,{children:[e.jsxs(n,{variant:"body2",children:[a.usage.apiCalls.toLocaleString()," calls"]}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:[a.usage.dataTransfer," GB"]})]})}),e.jsx(i,{children:e.jsx(n,{variant:"body2",children:new Date(a.expiresAt).toLocaleDateString()})}),e.jsx(i,{children:e.jsx(ue,{onClick:c=>Y(c,a),size:"small",children:e.jsx(ge,{})})})]},a.id))})]})})}),e.jsxs(je,{anchorEl:w,open:!!w,onClose:g,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsxs(x,{onClick:()=>d&&Z(d.key),children:[e.jsx(h,{children:e.jsx(pe,{fontSize:"small"})}),"Copy License Key"]}),e.jsxs(x,{onClick:()=>p(!0),children:[e.jsx(h,{children:e.jsx(me,{fontSize:"small"})}),"Assign License"]}),e.jsxs(x,{onClick:()=>{},children:[e.jsx(h,{children:e.jsx(ye,{fontSize:"small"})}),"Edit License"]}),(d==null?void 0:d.status)==="ACTIVE"?e.jsxs(x,{onClick:ee,children:[e.jsx(h,{children:e.jsx(be,{fontSize:"small"})}),"Suspend License"]}):e.jsxs(x,{onClick:ae,children:[e.jsx(h,{children:e.jsx(fe,{fontSize:"small"})}),"Activate License"]}),e.jsxs(x,{onClick:()=>{},children:[e.jsx(h,{children:e.jsx(ve,{fontSize:"small"})}),"Download Details"]})]}),e.jsxs(Ce,{open:X,onClose:()=>p(!1),PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(Le,{children:"Assign License"}),e.jsx(Se,{children:e.jsx($,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",fullWidth:!0,variant:"outlined",value:m,onChange:a=>W(a.target.value),sx:{mt:2}})}),e.jsxs(ke,{children:[e.jsx(C,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(C,{onClick:_,variant:"contained",disabled:!m,children:"Assign"})]})]})]})};export{Be as default};
