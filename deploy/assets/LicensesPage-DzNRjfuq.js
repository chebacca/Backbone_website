import{j as e,a as n,T as a,d as v,az as ae,G as m,k as C,l as L,J as B,c as F,v as N,aA as ne,aB as ie,aC as te,aD as re,aE as oe,aF as U,aG as i,aH as ce,at as de,h as G,I as le,aI as xe,ak as he,a5 as h,Y as u,aJ as ue,aK as ge,aL as je,aM as me,i as pe,ar as be,aN as ye,aO as fe,aP as ve,aQ as Ce,o as O,aR as V,Q as Le}from"./mui-B8PGH2kt.js";import{r as o}from"./vendor-DIxetjBo.js";import{u as ke}from"./notistack.esm-Bg0Tn0tt.js";import{u as Se,c as $,e as H}from"./index-BzMQ2Kpo.js";import"./stripe-CUnmz-K2.js";const Ae=r=>{switch(r){case"ACTIVE":return"success";case"SUSPENDED":return"warning";case"EXPIRED":return"error";case"PENDING":return"info";default:return"default"}},Te=r=>{switch(r){case"ACTIVE":return e.jsx(O,{});case"SUSPENDED":return e.jsx(V,{});case"EXPIRED":return e.jsx(Le,{});case"PENDING":return e.jsx(V,{});default:return e.jsx(O,{})}},Ee=r=>{switch(r){case"BASIC":return"default";case"PRO":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},ze=()=>{const{enqueueSnackbar:r}=ke(),{user:l}=Se(),[Ie,S]=o.useState(!1),[g,A]=o.useState([]),[T,E]=o.useState(null),[d,I]=o.useState(null),[J,p]=o.useState(!1),[b,w]=o.useState(""),[y,K]=o.useState("");o.useEffect(()=>{let s=!0;return(async()=>{var c,P,W,M;try{S(!0);const x=["admin","enterprise"].includes(String((l==null?void 0:l.role)||"").toLowerCase()),R=x?await $.get(`${H.admin.licenses()}?limit=200`):await $.get(H.licenses.myLicenses()),ee=(x?((P=(c=R.data)==null?void 0:c.data)==null?void 0:P.licenses)??[]:((M=(W=R.data)==null?void 0:W.data)==null?void 0:M.licenses)??[]).map((t,se)=>{var z;return{id:t.id,key:t.key,name:(z=t.user)!=null&&z.name?`${t.user.name}'s License`:`License ${se+1}`,tier:t.tier,status:t.status,assignedTo:t.user?{name:t.user.name||"User",email:t.user.email||""}:void 0,activatedAt:t.activatedAt||void 0,expiresAt:t.expiresAt||new Date(Date.now()+30*24*3600*1e3).toISOString(),lastUsed:t.updatedAt||void 0,deviceCount:t.activationCount??0,maxDevices:t.maxActivations??1,usage:{apiCalls:0,dataTransfer:0}}});if(!s)return;A(ee)}catch(x){if(!s)return;r((x==null?void 0:x.message)||"Failed to load licenses",{variant:"error"}),A([])}finally{s&&S(!1)}})(),()=>{s=!1}},[l==null?void 0:l.role,r]);const Q=(s,c)=>{E(s.currentTarget),I(c)},j=()=>{E(null),I(null)},X=s=>{navigator.clipboard.writeText(s),r("License key copied to clipboard",{variant:"success"}),j()},q=()=>{d&&b&&(r(`License assigned to ${b}`,{variant:"success"}),p(!1),w(""),j())},Y=()=>{d&&(r("License suspended",{variant:"warning"}),j())},Z=()=>{d&&(r("License activated",{variant:"success"}),j())},_=g.filter(s=>{var c;return s.name.toLowerCase().includes(y.toLowerCase())||s.key.toLowerCase().includes(y.toLowerCase())||(((c=s.assignedTo)==null?void 0:c.email)||"").toLowerCase().includes(y.toLowerCase())}),k=o.useMemo(()=>g.filter(s=>s.status==="ACTIVE").length,[g]),f=o.useMemo(()=>g.length,[g]),D=o.useMemo(()=>f<=0?0:Math.round(k/f*100),[k,f]);return e.jsxs(n,{children:[e.jsx(n,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(n,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsx(a,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Manage and monitor your BackboneLogic, Inc. licenses"})]}),e.jsx(v,{variant:"contained",startIcon:e.jsx(ae,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Add License"})]})}),e.jsxs(m,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(n,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:e.jsx(C,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(L,{children:[e.jsx(a,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:k}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Active Licenses"})]})})})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(n,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsx(C,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(L,{children:[e.jsx(a,{variant:"h3",sx:{fontWeight:700},children:f}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Total Licenses"})]})})})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(n,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsx(C,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(L,{children:[e.jsxs(a,{variant:"h3",sx:{fontWeight:700},children:[D,"%"]}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Utilization Rate"}),e.jsx(B,{variant:"determinate",value:D,sx:{mt:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}})]})})})}),e.jsx(m,{item:!0,xs:12,sm:6,md:3,children:e.jsx(n,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:e.jsx(C,{sx:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%)",border:"1px solid rgba(255, 255, 255, 0.1)"},children:e.jsxs(L,{children:[e.jsx(a,{variant:"h3",sx:{fontWeight:700},children:"15"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Days to Renewal"})]})})})})]}),e.jsx(n,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},children:e.jsx(F,{sx:{p:3,mb:3,background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(n,{sx:{display:"flex",gap:2,alignItems:"center"},children:[e.jsx(N,{placeholder:"Search licenses...",value:y,onChange:s=>K(s.target.value),size:"small",sx:{flex:1},InputProps:{startAdornment:e.jsx(ne,{sx:{color:"text.secondary",mr:1}})}}),e.jsx(v,{variant:"outlined",startIcon:e.jsx(ie,{}),sx:{whiteSpace:"nowrap"},children:"Filters"})]})})}),e.jsx(n,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.6},children:e.jsx(te,{component:F,sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(re,{children:[e.jsx(oe,{children:e.jsxs(U,{children:[e.jsx(i,{sx:{fontWeight:600},children:"License"}),e.jsx(i,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(i,{sx:{fontWeight:600},children:"Status"}),e.jsx(i,{sx:{fontWeight:600},children:"Tier"}),e.jsx(i,{sx:{fontWeight:600},children:"Devices"}),e.jsx(i,{sx:{fontWeight:600},children:"Usage"}),e.jsx(i,{sx:{fontWeight:600},children:"Expires"}),e.jsx(i,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(ce,{children:_.map(s=>e.jsxs(U,{hover:!0,children:[e.jsx(i,{children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:s.name}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:s.key})]})}),e.jsx(i,{children:s.assignedTo?e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{sx:{width:32,height:32,fontSize:"0.875rem"},children:s.assignedTo.name[0]}),e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:s.assignedTo.name}),e.jsx(a,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(i,{children:e.jsx(G,{icon:Te(s.status),label:s.status,color:Ae(s.status),size:"small",sx:{fontWeight:500}})}),e.jsx(i,{children:e.jsx(G,{label:s.tier,color:Ee(s.tier),size:"small",variant:"outlined"})}),e.jsx(i,{children:e.jsxs(n,{children:[e.jsxs(a,{variant:"body2",children:[s.deviceCount,"/",s.maxDevices]}),e.jsx(B,{variant:"determinate",value:s.deviceCount/s.maxDevices*100,sx:{width:80,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2}}})]})}),e.jsx(i,{children:e.jsxs(n,{children:[e.jsxs(a,{variant:"body2",children:[s.usage.apiCalls.toLocaleString()," calls"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.usage.dataTransfer," GB"]})]})}),e.jsx(i,{children:e.jsx(a,{variant:"body2",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsx(i,{children:e.jsx(le,{onClick:c=>Q(c,s),size:"small",children:e.jsx(xe,{})})})]},s.id))})]})})}),e.jsxs(he,{anchorEl:T,open:!!T,onClose:j,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsxs(h,{onClick:()=>d&&X(d.key),children:[e.jsx(u,{children:e.jsx(ue,{fontSize:"small"})}),"Copy License Key"]}),e.jsxs(h,{onClick:()=>p(!0),children:[e.jsx(u,{children:e.jsx(ge,{fontSize:"small"})}),"Assign License"]}),e.jsxs(h,{onClick:()=>{},children:[e.jsx(u,{children:e.jsx(je,{fontSize:"small"})}),"Edit License"]}),(d==null?void 0:d.status)==="ACTIVE"?e.jsxs(h,{onClick:Y,children:[e.jsx(u,{children:e.jsx(me,{fontSize:"small"})}),"Suspend License"]}):e.jsxs(h,{onClick:Z,children:[e.jsx(u,{children:e.jsx(pe,{fontSize:"small"})}),"Activate License"]}),e.jsxs(h,{onClick:()=>{},children:[e.jsx(u,{children:e.jsx(be,{fontSize:"small"})}),"Download Details"]})]}),e.jsxs(ye,{open:J,onClose:()=>p(!1),PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(fe,{children:"Assign License"}),e.jsx(ve,{children:e.jsx(N,{autoFocus:!0,margin:"dense",label:"Email Address",type:"email",fullWidth:!0,variant:"outlined",value:b,onChange:s=>w(s.target.value),sx:{mt:2}})}),e.jsxs(Ce,{children:[e.jsx(v,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(v,{onClick:q,variant:"contained",disabled:!b,children:"Assign"})]})]})]})};export{ze as default};
