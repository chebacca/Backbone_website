import{j as e,B as i,C as He,T as n,d as v,ai as T,w as Ke,x as re,y as p,aj as pe,z as oe,H as _e,a as h,ap as le,G as C,ae as fe,p as k,am as ve,al as qe,t as ce,v as de,i as Xe,af as Je,aq as Qe,ar as Ye,as as Ze,at as xe,au as l,av as es,r as he,u as ss,ag as ns,g as ts,aw as as,ax as is,ay as A,az as R,aA as P,e as O,aB as rs,aC as os,aD as ls,a5 as j,aE as N,aF as cs,aG as ue,aH as je,a4 as ds,aI as xs,aJ as hs,D as ge,aK as ye}from"./mui-CwmAuw8Y.js";import{r as d}from"./vendor-CjD1bmmO.js";import{u as us}from"./notistack.esm-Ca-E78ev.js";import{u as js,a as gs,b as ms}from"./useStreamlinedData-petn63ul.js";import{M as I}from"./MetricCard-BnhjgK8w.js";import"./index-MWASw4oL.js";import"./stripe-N9VLlH2J.js";import"./index.esm-DonjM_pP.js";import"./index.esm-D7ujsXeY.js";const ps=t=>{switch(t){case"ACTIVE":return"success";case"PENDING":return"warning";case"SUSPENDED":return"error";case"EXPIRED":return"default";default:return"default"}},fs=t=>{switch(t){case"ACTIVE":return e.jsx(k,{});case"PENDING":return e.jsx(ve,{});case"SUSPENDED":return e.jsx(ye,{});case"EXPIRED":return e.jsx(pe,{});default:return e.jsx(fe,{})}},vs=t=>{switch(t){case"BASIC":return"default";case"PRO":return"primary";case"ENTERPRISE":return"secondary";default:return"default"}},me=()=>{const t=[];for(let r=0;r<4;r++)t.push(Math.random().toString(36).substr(2,4).toUpperCase());return`BL14-${t.join("-")}`},As=()=>{var G;const{enqueueSnackbar:t}=us(),{data:r,loading:Se,error:Ce}=js(),{data:x,loading:Le,error:be}=gs(),{loading:Ie,error:Ee}=ms(),[we,y]=d.useState(!1),[De,L]=d.useState(!1),[ys,Te]=d.useState(!1),[Ae,b]=d.useState(!1),[a,E]=d.useState(null),[M,W]=d.useState(null),[w,z]=d.useState(""),[U,B]=d.useState(""),[Re,F]=d.useState("PRO"),[$,V]=d.useState(1),Pe=Se||Le||Ie,Oe=Ce||be||Ee,c=d.useMemo(()=>{var K,_,q,X,J,Q,Y,Z,ee,se,ne,te,ae,ie;if(!r||!x)return{licenses:[],stats:{totalLicenses:0,activeLicenses:0,expiringSoon:0,unassignedLicenses:0,utilizationRate:0}};const s=((_=(K=x.subscription)==null?void 0:K.plan)==null?void 0:_.seats)||1,S=((X=(q=x.organization)==null?void 0:q.usage)==null?void 0:X.totalUsers)||1,g=((Q=(J=x.subscription)==null?void 0:J.plan)==null?void 0:Q.tier)||"BASIC",m=[{id:r.id,key:me(),name:`${r.name||"User"}'s License`,tier:g==="ENTERPRISE"?"ENTERPRISE":g==="PROFESSIONAL"?"PRO":"BASIC",status:((Y=r.license)==null?void 0:Y.status)==="ACTIVE"?"ACTIVE":"PENDING",assignedTo:{name:r.name||"User",email:r.email,avatar:void 0},activatedAt:((Z=r.createdAt)==null?void 0:Z.toISOString())||new Date().toISOString(),expiresAt:new Date(Date.now()+365*24*60*60*1e3).toISOString(),lastUsed:new Date().toISOString(),deviceCount:1,maxDevices:g==="ENTERPRISE"?10:g==="PROFESSIONAL"?5:2,usage:{apiCalls:Math.floor(Math.random()*1e4),dataTransfer:Math.floor(Math.random()*50)},userId:r.id,subscriptionId:((ee=x.subscription)==null?void 0:ee.id)||"default",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),organizationId:(se=r.organization)==null?void 0:se.id}];for(let o=1;o<s;o++){const u=o<S,D=u?"ACTIVE":Math.random()>.7?"PENDING":"ACTIVE";m.push({id:`license_${o}`,key:me(),name:`License ${o+1}`,tier:g==="ENTERPRISE"?"ENTERPRISE":g==="PROFESSIONAL"?"PRO":"BASIC",status:D,assignedTo:u?{name:`Team Member ${o}`,email:`member${o}@${((te=(ne=x.organization)==null?void 0:ne.name)==null?void 0:te.toLowerCase().replace(/\s+/g,""))||"company"}.com`}:void 0,activatedAt:u?new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString():void 0,expiresAt:new Date(Date.now()+365*24*60*60*1e3).toISOString(),lastUsed:u?new Date(Date.now()-Math.random()*7*24*60*60*1e3).toISOString():void 0,deviceCount:u?Math.floor(Math.random()*3)+1:0,maxDevices:g==="ENTERPRISE"?10:g==="PROFESSIONAL"?5:2,usage:{apiCalls:u?Math.floor(Math.random()*5e3):0,dataTransfer:u?Math.floor(Math.random()*25):0},userId:`user_${o}`,subscriptionId:((ae=x.subscription)==null?void 0:ae.id)||"default",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),organizationId:(ie=r.organization)==null?void 0:ie.id})}const H=m.filter(o=>o.status==="ACTIVE").length,$e=m.filter(o=>{const u=new Date(o.expiresAt),D=new Date(Date.now()+30*24*60*60*1e3);return u<=D}).length,Ve=m.filter(o=>!o.assignedTo).length,Ge={totalLicenses:m.length,activeLicenses:H,expiringSoon:$e,unassignedLicenses:Ve,utilizationRate:m.length>0?H/m.length*100:0};return{licenses:m,stats:Ge}},[r,x]),Ne=(s,S)=>{E(S),W(s.currentTarget)},f=()=>{W(null),E(null)},ke=s=>{navigator.clipboard.writeText(s),t("License key copied to clipboard",{variant:"success"}),f()},Me=async()=>{if(!a||!w.trim()){t("Please enter a valid email address",{variant:"error"});return}try{t(`License assigned to ${w}`,{variant:"success"}),z(""),L(!1),f()}catch(s){t((s==null?void 0:s.message)||"Failed to assign license",{variant:"error"})}},We=async()=>{if(!U.trim()){t("Please enter a license name",{variant:"error"});return}try{t(`${$} license(s) created successfully`,{variant:"success"}),B(""),F("PRO"),V(1),y(!1)}catch(s){t((s==null?void 0:s.message)||"Failed to create license",{variant:"error"})}},ze=()=>{a&&(t(`License ${a.name} has been suspended`,{variant:"warning"}),f())},Ue=()=>{a&&(t(`License ${a.name} has been activated`,{variant:"success"}),f())},Be=()=>{a&&(b(!0),f())},Fe=async()=>{if(a)try{t(`License ${a.name} has been deleted`,{variant:"success"}),b(!1),E(null)}catch(s){t((s==null?void 0:s.message)||"Failed to delete license",{variant:"error"})}};return Pe?e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(i,{textAlign:"center",children:[e.jsx(He,{size:60}),e.jsx(n,{variant:"h6",sx:{mt:2},children:"Loading License Data..."}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Fetching your licenses and subscription details"})]})}):Oe?e.jsx(i,{sx:{p:3},children:e.jsxs(v,{severity:"error",children:[e.jsx(T,{children:"Unable to Load License Data"}),e.jsx(n,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your license information. This could be due to:"}),e.jsxs(Ke,{dense:!0,children:[e.jsxs(re,{children:[e.jsx(p,{children:e.jsx(pe,{fontSize:"small"})}),e.jsx(oe,{primary:"Network connectivity issues"})]}),e.jsxs(re,{children:[e.jsx(p,{children:e.jsx(_e,{fontSize:"small"})}),e.jsx(oe,{primary:"Authentication token expired"})]})]}),e.jsx(i,{sx:{mt:2},children:e.jsx(h,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!r||!x?e.jsx(i,{sx:{p:3},children:e.jsxs(v,{severity:"info",children:[e.jsx(T,{children:"Setting Up License Management"}),e.jsx(n,{variant:"body2",children:"We're preparing your license management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(i,{children:[e.jsx(n,{variant:"h4",sx:{fontWeight:700,mb:1},children:"License Management"}),e.jsxs(n,{variant:"body1",color:"text.secondary",children:["Manage your ",((G=x.organization)==null?void 0:G.name)||"Organization"," licenses and assignments"]})]}),e.jsx(h,{variant:"contained",startIcon:e.jsx(le,{}),onClick:()=>y(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Create License"})]}),e.jsxs(C,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(I,{title:"Total Licenses",value:c.stats.totalLicenses.toString(),icon:e.jsx(fe,{}),color:"primary"})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(I,{title:"Active Licenses",value:c.stats.activeLicenses.toString(),icon:e.jsx(k,{}),color:"success"})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(I,{title:"Expiring Soon",value:c.stats.expiringSoon.toString(),icon:e.jsx(ve,{}),color:"warning"})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(I,{title:"Unassigned",value:c.stats.unassignedLicenses.toString(),icon:e.jsx(qe,{}),color:"secondary"})})]}),e.jsx(ce,{sx:{mb:4},children:e.jsxs(de,{children:[e.jsx(n,{variant:"h6",sx:{fontWeight:600,mb:2},children:"License Utilization"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(Xe,{variant:"determinate",value:c.stats.utilizationRate,sx:{flex:1,height:8,borderRadius:4}}),e.jsxs(n,{variant:"body2",sx:{minWidth:60},children:[c.stats.utilizationRate.toFixed(1),"%"]})]}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[c.stats.activeLicenses," of ",c.stats.totalLicenses," licenses are currently active"]})]})}),c.stats.expiringSoon>0&&e.jsxs(v,{severity:"warning",sx:{mb:4},children:[e.jsx(T,{children:"Licenses Expiring Soon"}),e.jsxs(n,{variant:"body2",sx:{mb:2},children:[c.stats.expiringSoon," license(s) will expire within the next 30 days."]}),e.jsx(h,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Renew Licenses"})]}),e.jsx(ce,{children:e.jsxs(de,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(n,{variant:"h6",sx:{fontWeight:600},children:["All Licenses (",c.licenses.length,")"]}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(Je,{}),onClick:()=>t("License report downloaded",{variant:"success"}),children:"Export Report"})]}),e.jsx(Qe,{children:e.jsxs(Ye,{children:[e.jsx(Ze,{children:e.jsxs(xe,{children:[e.jsx(l,{sx:{fontWeight:600},children:"License"}),e.jsx(l,{sx:{fontWeight:600},children:"Tier"}),e.jsx(l,{sx:{fontWeight:600},children:"Status"}),e.jsx(l,{sx:{fontWeight:600},children:"Assigned To"}),e.jsx(l,{sx:{fontWeight:600},children:"Usage"}),e.jsx(l,{sx:{fontWeight:600},children:"Expires"}),e.jsx(l,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(es,{children:c.licenses.map(s=>e.jsxs(xe,{hover:!0,children:[e.jsx(l,{children:e.jsxs(i,{children:[e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:s.name}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{fontFamily:"monospace"},children:s.key})]})}),e.jsx(l,{children:e.jsx(he,{label:s.tier,color:vs(s.tier),size:"small",icon:s.tier==="ENTERPRISE"?e.jsx(ss,{}):void 0})}),e.jsx(l,{children:e.jsx(he,{icon:fs(s.status),label:s.status,color:ps(s.status),size:"small"})}),e.jsx(l,{children:s.assignedTo?e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ns,{src:s.assignedTo.avatar,sx:{width:24,height:24},children:s.assignedTo.name.charAt(0)}),e.jsxs(i,{children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:s.assignedTo.name}),e.jsx(n,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"Unassigned"})}),e.jsx(l,{children:e.jsxs(i,{children:[e.jsxs(n,{variant:"body2",children:[s.usage.apiCalls.toLocaleString()," API calls"]}),e.jsxs(n,{variant:"caption",color:"text.secondary",children:[s.usage.dataTransfer," GB transferred"]})]})}),e.jsx(l,{children:e.jsx(n,{variant:"body2",color:new Date(s.expiresAt)<=new Date(Date.now()+30*24*60*60*1e3)?"warning.main":"text.primary",children:new Date(s.expiresAt).toLocaleDateString()})}),e.jsx(l,{children:e.jsx(ts,{size:"small",onClick:S=>Ne(S,s),children:e.jsx(as,{})})})]},s.id))})]})})]})}),e.jsx(is,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>y(!0),children:e.jsx(le,{})}),e.jsxs(A,{open:we,onClose:()=>y(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(R,{children:"Create New License"}),e.jsx(P,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(O,{fullWidth:!0,label:"License Name",value:U,onChange:s=>B(s.target.value),placeholder:"Development Team License"}),e.jsxs(rs,{fullWidth:!0,children:[e.jsx(os,{children:"License Tier"}),e.jsxs(ls,{value:Re,label:"License Tier",onChange:s=>F(s.target.value),children:[e.jsx(j,{value:"BASIC",children:"Basic - Limited features"}),e.jsx(j,{value:"PRO",children:"Pro - Full features"}),e.jsx(j,{value:"ENTERPRISE",children:"Enterprise - Advanced features"})]})]}),e.jsx(O,{fullWidth:!0,label:"Number of Licenses",type:"number",value:$,onChange:s=>V(parseInt(s.target.value)||1),inputProps:{min:1,max:50}}),e.jsx(v,{severity:"info",children:e.jsx(n,{variant:"body2",children:"New licenses will be created with a 1-year validity period and can be assigned to team members immediately."})})]})}),e.jsxs(N,{children:[e.jsx(h,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(h,{onClick:We,variant:"contained",startIcon:e.jsx(cs,{}),children:"Create License"})]})]}),e.jsxs(A,{open:De,onClose:()=>L(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(R,{children:"Assign License"}),e.jsx(P,{children:a&&e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(v,{severity:"info",children:e.jsxs(n,{variant:"body2",children:["Assigning license: ",e.jsx("strong",{children:a.name})]})}),e.jsx(O,{fullWidth:!0,label:"Email Address",type:"email",value:w,onChange:s=>z(s.target.value),placeholder:"user@company.com"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"The user will receive an email with instructions to activate their license."})]})}),e.jsxs(N,{children:[e.jsx(h,{onClick:()=>L(!1),children:"Cancel"}),e.jsx(h,{onClick:Me,variant:"contained",startIcon:e.jsx(ue,{}),children:"Assign License"})]})]}),e.jsxs(A,{open:Ae,onClose:()=>b(!1),maxWidth:"sm",children:[e.jsx(R,{children:"Delete License"}),e.jsx(P,{children:a&&e.jsxs(i,{children:[e.jsxs(n,{variant:"body1",sx:{mb:2},children:["Are you sure you want to delete ",e.jsx("strong",{children:a.name}),"?"]}),e.jsx(v,{severity:"warning",children:e.jsx(n,{variant:"body2",children:"This action cannot be undone. The license will be permanently removed and any assigned user will lose access."})})]})}),e.jsxs(N,{children:[e.jsx(h,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(h,{onClick:Fe,variant:"contained",color:"error",startIcon:e.jsx(je,{}),children:"Delete License"})]})]}),e.jsxs(ds,{anchorEl:M,open:!!M,onClose:f,children:[e.jsxs(j,{onClick:()=>a&&ke(a.key),children:[e.jsx(p,{children:e.jsx(xs,{})}),"Copy License Key"]}),!(a!=null&&a.assignedTo)&&e.jsxs(j,{onClick:()=>L(!0),children:[e.jsx(p,{children:e.jsx(ue,{})}),"Assign License"]}),e.jsxs(j,{onClick:()=>Te(!0),children:[e.jsx(p,{children:e.jsx(hs,{})}),"Edit License"]}),e.jsx(ge,{}),(a==null?void 0:a.status)==="ACTIVE"?e.jsxs(j,{onClick:ze,children:[e.jsx(p,{children:e.jsx(ye,{})}),"Suspend License"]}):e.jsxs(j,{onClick:Ue,children:[e.jsx(p,{children:e.jsx(k,{})}),"Activate License"]}),e.jsx(ge,{}),e.jsxs(j,{onClick:Be,sx:{color:"error.main"},children:[e.jsx(p,{children:e.jsx(je,{sx:{color:"error.main"}})}),"Delete License"]})]})]})};export{As as default};
