const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bofe41g1.js","assets/mui-DpsxcHA8.js","assets/vendor-DIxetjBo.js","assets/stripe-GgbZzTKy.js","assets/index-BFoWrjWu.css"])))=>i.map(i=>d[i]);
import{u as O,a as R,_ as q}from"./index-Bofe41g1.js";import{j as e,a as s,b as M,d as u,s as B,c as V,T as c,t as C,S,u as f,v as y,w as z,I as Z,x as H,y as Y,L as $,z as A,D as b}from"./mui-DpsxcHA8.js";import{u as J,r as g,L as I}from"./vendor-DIxetjBo.js";import{u as K,C as P}from"./index.esm-9wQFonXx.js";import{u as Q}from"./notistack.esm-Bg0Tn0tt.js";import"./stripe-GgbZzTKy.js";const se=()=>{const a=J(),{login:W,loginWithGoogle:E,loginWithApple:X}=O(),{setLoading:d}=R(),{enqueueSnackbar:i}=Q(),[h,T]=g.useState(!1),[j,x]=g.useState(null),[p,L]=g.useState(null),[v,D]=g.useState(""),{control:w,handleSubmit:U,formState:{errors:m,isSubmitting:k}}=K({defaultValues:{email:"",password:""}}),N=async o=>{var r,t;try{x(null),d(!0);const n=await W(o.email,o.password);i("Welcome back!",{variant:"success"});const l=String((n==null?void 0:n.role)||"").toUpperCase();a(l==="SUPERADMIN"?"/admin":l==="ACCOUNTING"?"/accounting":"/dashboard")}catch(n){if((r=n==null?void 0:n.details)!=null&&r.requires2FA||n!=null&&n.requires2FA)L(((t=n==null?void 0:n.details)==null?void 0:t.interimToken)||(n==null?void 0:n.interimToken)||null);else{const l=n.message||"Login failed. Please try again.";x(l),i(l,{variant:"error"})}}finally{d(!1)}},_=async o=>{try{x(null),d(!0);const r=await E(o);i("Signed in with Google",{variant:"success"});const t=String((r==null?void 0:r.role)||"").toUpperCase();a(t==="SUPERADMIN"?"/admin":t==="ACCOUNTING"?"/accounting":"/dashboard")}catch(r){const t=r.message||"Google sign-in failed.";x(t),i(t,{variant:"error"})}finally{d(!1)}};g.useEffect(()=>{const o=r=>{const t=r.detail;t!=null&&t.credential&&_(t.credential)};return window.addEventListener("google-credential",o),()=>window.removeEventListener("google-credential",o)},[]);const F=()=>{T(!h)};return e.jsx(s,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",alignItems:"center",py:{xs:4,md:0}},children:e.jsx(M,{maxWidth:"sm",children:e.jsxs(s,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsx(s,{sx:{mb:3},children:e.jsx(u,{startIcon:e.jsx(B,{}),onClick:()=>a("/"),sx:{color:"rgba(255, 255, 255, 0.7)","&:hover":{color:"primary.main",backgroundColor:"rgba(0, 212, 255, 0.1)"}},children:"Back to Home"})}),e.jsxs(V,{elevation:10,sx:{p:{xs:4,md:6},backgroundColor:"background.paper",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs(s,{sx:{textAlign:"center",mb:4},children:[e.jsx(s,{sx:{width:60,height:60,borderRadius:2,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",mb:3},children:e.jsx(c,{variant:"h4",sx:{fontWeight:700,color:"#000"},children:"D"})}),e.jsx(c,{variant:"h4",sx:{fontWeight:600,mb:2,textAlign:"center"},children:"Sign in to your BackboneLogic, Inc. account"}),e.jsx(c,{variant:"body1",color:"text.secondary",children:"Welcome back! Please sign in to continue."})]}),j&&e.jsx(C,{severity:"error",sx:{mb:3},children:j}),p?e.jsxs(s,{children:[e.jsx(C,{severity:"info",sx:{mb:3},children:"Enter the 6-digit code from your authenticator app. You can also use a backup code."}),e.jsx(f,{fullWidth:!0,label:"Authentication code",value:v,onChange:o=>D(o.target.value),sx:{mb:2}}),e.jsx(u,{variant:"contained",onClick:async()=>{var o;try{d(!0);const{verify2FA:r}=(await q(async()=>{const{authService:l}=await import("./index-Bofe41g1.js").then(G=>G.f);return{authService:l}},__vite__mapDeps([0,1,2,3,4]))).authService;if(!p)return;const t=await r(p,v.trim());localStorage.setItem("auth_token",t.token),localStorage.setItem("auth_user",JSON.stringify(t.user)),i("2FA verified. Welcome back!",{variant:"success"});const n=String(((o=t.user)==null?void 0:o.role)||"").toUpperCase();a(n==="SUPERADMIN"?"/admin":n==="ACCOUNTING"?"/accounting":"/dashboard")}catch(r){i(r.message||"Invalid code",{variant:"error"})}finally{d(!1)}},sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000"},children:"Verify Code"})]}):e.jsx(s,{component:"form",onSubmit:U(N),children:e.jsxs(S,{spacing:3,children:[e.jsx(P,{name:"email",control:w,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Please enter a valid email address"}},render:({field:o})=>{var r;return e.jsx(f,{...o,fullWidth:!0,label:"Email Address",type:"email",autoComplete:"email",error:!!m.email,helperText:(r=m.email)==null?void 0:r.message,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(z,{sx:{color:"text.secondary"}})})},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.05)"}}})}}),e.jsx(P,{name:"password",control:w,rules:{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters"}},render:({field:o})=>{var r;return e.jsx(f,{...o,fullWidth:!0,label:"Password",type:h?"text":"password",autoComplete:"current-password",error:!!m.password,helperText:(r=m.password)==null?void 0:r.message,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx($,{sx:{color:"text.secondary"}})}),endAdornment:e.jsx(y,{position:"end",children:e.jsx(Z,{onClick:F,edge:"end",sx:{color:"text.secondary"},children:h?e.jsx(H,{}):e.jsx(Y,{})})})},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.05)"}}})}}),e.jsx(s,{sx:{textAlign:"right"},children:e.jsx(A,{component:I,to:"/forgot-password",variant:"body2",sx:{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"Forgot your password?"})}),e.jsx(u,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:k,sx:{py:1.5,fontSize:"1.1rem",fontWeight:600,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000","&:hover":{background:"linear-gradient(135deg, #33ddff 0%, #7b8eed 100%)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.5)"}},children:k?"Signing In...":"Sign In"}),e.jsxs(s,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(b,{sx:{flex:1}}),e.jsx(c,{variant:"body2",sx:{mx:2,color:"text.secondary"},children:"or"}),e.jsx(b,{sx:{flex:1}})]}),e.jsxs(S,{spacing:2,direction:{xs:"column",sm:"row"},children:[e.jsx(u,{fullWidth:!0,variant:"outlined",onClick:async()=>{var r,t;const o=window;(t=(r=o.google)==null?void 0:r.accounts)!=null&&t.id?o.google.accounts.id.prompt():i("Google Sign-In not initialized. Please refresh.",{variant:"warning"})},children:"Continue with Google"}),e.jsx(u,{fullWidth:!0,variant:"outlined",onClick:async()=>{i("Apple Sign-In will appear if configured.",{variant:"info"})},children:"Continue with Apple"})]})]})}),e.jsx(b,{sx:{my:4},children:e.jsx(c,{variant:"body2",color:"text.secondary",children:"OR"})}),e.jsxs(s,{sx:{textAlign:"center"},children:[e.jsxs(c,{variant:"body2",color:"text.secondary",children:["Don't have an account?"," ",e.jsx(A,{component:I,to:"/register",sx:{color:"primary.main",textDecoration:"none",fontWeight:600,"&:hover":{textDecoration:"underline"}},children:"Create one now"})]}),e.jsx(c,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:"ðŸ”’ Your data is secure and protected by industry-leading encryption"})]})]})]})})})};export{se as default};
