const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DQ56AgSW.js","assets/mui-Bfk3EfzY.js","assets/vendor-OeuszDaU.js","assets/stripe-CV5HSYwT.js","assets/index-Dj6bZ7MF.css"])))=>i.map(i=>d[i]);
import{u as q,a as V,_ as Y}from"./index-DQ56AgSW.js";import{j as e,a as l,b as H,d as x,u as Z,c as K,T as d,A as I,S as W,v as w,w as v,y as $,I as J,z as Q,D as X,L as ee,K as P,O as j}from"./mui-Bfk3EfzY.js";import{u as re,r as p,b as T,L as U}from"./vendor-OeuszDaU.js";import{u as ne,C as E}from"./index.esm-BqJ7I8dv.js";import{u as te}from"./notistack.esm-CcFOI6Un.js";import"./stripe-CV5HSYwT.js";const de=()=>{const s=re(),{login:_,loginWithGoogle:D,loginWithApple:L}=q(),{setLoading:c}=V(),{enqueueSnackbar:i}=te(),[b,N]=p.useState(!1),[k,u]=p.useState(null),[y,O]=p.useState(null),[S,M]=p.useState(""),{control:A,handleSubmit:R,formState:{errors:h,isSubmitting:C}}=ne({defaultValues:{email:"",password:""}}),g=T.useMemo(()=>{try{return new URLSearchParams(window.location.search).get("bridge")==="1"}catch{return!1}},[]),m=T.useCallback(t=>{if(g)try{const r=localStorage.getItem("auth_token"),n=localStorage.getItem("refresh_token"),o={user:t,tokens:{accessToken:r,refreshToken:n}};window.opener&&window.opener.postMessage({type:"BACKBONE_AUTH",payload:o},"*"),window.close()}catch{}},[g]),G=async t=>{var r,n;try{u(null),c(!0);const o=await _(t.email,t.password);if(i("Welcome back!",{variant:"success"}),g){m(o);return}const a=String((o==null?void 0:o.role)||"").toUpperCase();s(a==="SUPERADMIN"?"/admin":a==="ACCOUNTING"?"/accounting":"/dashboard")}catch(o){if((r=o==null?void 0:o.details)!=null&&r.requires2FA||o!=null&&o.requires2FA)O(((n=o==null?void 0:o.details)==null?void 0:n.interimToken)||(o==null?void 0:o.interimToken)||null);else{const a=o.message||"Login failed. Please try again.";u(a),i(a,{variant:"error"})}}finally{c(!1)}},z=async t=>{try{u(null),c(!0);const r=await D(t);if(i("Signed in with Google",{variant:"success"}),g){m(r);return}const n=String((r==null?void 0:r.role)||"").toUpperCase();s(n==="SUPERADMIN"?"/admin":n==="ACCOUNTING"?"/accounting":"/dashboard")}catch(r){const n=r.message||"Google sign-in failed.";u(n),i(n,{variant:"error"})}finally{c(!1)}},B=async t=>{try{u(null),c(!0);const r=await L(t);if(i("Signed in with Apple",{variant:"success"}),g){m(r);return}const n=String((r==null?void 0:r.role)||"").toUpperCase();s(n==="SUPERADMIN"?"/admin":n==="ACCOUNTING"?"/accounting":"/dashboard")}catch(r){const n=r.message||"Apple sign-in failed.";u(n),i(n,{variant:"error"})}finally{c(!1)}};p.useEffect(()=>{const t=r=>{const n=r.detail;n!=null&&n.credential&&z(n.credential)};return window.addEventListener("google-credential",t),()=>window.removeEventListener("google-credential",t)},[]);const F=()=>{N(!b)};return e.jsx(l,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",alignItems:"center",py:{xs:4,md:0}},children:e.jsx(H,{maxWidth:"sm",children:e.jsxs(l,{children:[e.jsx(l,{sx:{mb:3},children:e.jsx(x,{startIcon:e.jsx(Z,{}),onClick:()=>s("/"),sx:{color:"rgba(255, 255, 255, 0.7)","&:hover":{color:"primary.main",backgroundColor:"rgba(0, 212, 255, 0.1)"}},children:"Back to Home"})}),e.jsxs(K,{elevation:10,sx:{p:{xs:4,md:6},backgroundColor:"background.paper",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs(l,{sx:{textAlign:"center",mb:4},children:[e.jsx(l,{sx:{width:60,height:60,borderRadius:2,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",mb:3},children:e.jsx(d,{variant:"h4",sx:{fontWeight:700,color:"#000"},children:"D"})}),e.jsx(d,{variant:"h4",sx:{fontWeight:600,mb:2,textAlign:"center"},children:"Sign in to your BackboneLogic, Inc. account"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"Welcome back! Please sign in to continue."})]}),k&&e.jsx(I,{severity:"error",sx:{mb:3},children:k}),y?e.jsxs(l,{children:[e.jsx(I,{severity:"info",sx:{mb:3},children:"Enter the 6-digit code from your authenticator app. You can also use a backup code."}),e.jsx(w,{fullWidth:!0,label:"Authentication code",value:S,onChange:t=>M(t.target.value),sx:{mb:2}}),e.jsx(x,{variant:"contained",onClick:async()=>{var t;try{c(!0);const{verify2FA:r}=(await Y(async()=>{const{authService:a}=await import("./index-DQ56AgSW.js").then(f=>f.g);return{authService:a}},__vite__mapDeps([0,1,2,3,4]))).authService;if(!y)return;const n=await r(y,S.trim());if(localStorage.setItem("auth_token",n.token),localStorage.setItem("auth_user",JSON.stringify(n.user)),i("2FA verified. Welcome back!",{variant:"success"}),g){m(n.user);return}const o=String(((t=n.user)==null?void 0:t.role)||"").toUpperCase();s(o==="SUPERADMIN"?"/admin":o==="ACCOUNTING"?"/accounting":"/dashboard")}catch(r){i(r.message||"Invalid code",{variant:"error"})}finally{c(!1)}},sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600,py:1.5,fontSize:"1rem","&:hover":{background:"linear-gradient(135deg, #33ddff 0%, #7b8eed 100%)",boxShadow:"0 4px 12px rgba(0, 212, 255, 0.3)",transform:"translateY(-1px)"}},children:"Verify Code"})]}):e.jsx(l,{component:"form",onSubmit:R(G),children:e.jsxs(W,{spacing:3,children:[e.jsx(E,{name:"email",control:A,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Please enter a valid email address"}},render:({field:t})=>{var r;return e.jsx(w,{...t,fullWidth:!0,label:"Email Address",type:"email",autoComplete:"email",error:!!h.email,helperText:(r=h.email)==null?void 0:r.message,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx($,{sx:{color:"text.secondary"}})})},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.05)"}}})}}),e.jsx(E,{name:"password",control:A,rules:{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters"}},render:({field:t})=>{var r;return e.jsx(w,{...t,fullWidth:!0,label:"Password",type:b?"text":"password",autoComplete:"current-password",error:!!h.password,helperText:(r=h.password)==null?void 0:r.message,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(ee,{sx:{color:"text.secondary"}})}),endAdornment:e.jsx(v,{position:"end",children:e.jsx(J,{onClick:F,edge:"end",sx:{color:"text.secondary"},children:b?e.jsx(Q,{}):e.jsx(X,{})})})},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.05)"}}})}}),e.jsx(l,{sx:{textAlign:"right"},children:e.jsx(P,{component:U,to:"/forgot-password",variant:"body2",sx:{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"Forgot your password?"})}),e.jsx(x,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:C,sx:{py:1.5,fontSize:"1.1rem",fontWeight:600,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000","&:hover":{background:"linear-gradient(135deg, #33ddff 0%, #7b8eed 100%)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.5)"}},children:C?"Signing In...":"Sign In"}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(j,{sx:{flex:1}}),e.jsx(d,{variant:"body2",sx:{mx:2,color:"text.secondary"},children:"or"}),e.jsx(j,{sx:{flex:1}})]}),e.jsxs(W,{spacing:2,direction:{xs:"column",sm:"row"},children:[e.jsx(x,{fullWidth:!0,variant:"outlined",onClick:async()=>{var r,n;const t=window;(n=(r=t.google)==null?void 0:r.accounts)!=null&&n.id?t.google.accounts.id.prompt():i("Google Sign-In not initialized. Please refresh.",{variant:"warning"})},sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"white",borderWidth:2,fontWeight:600,py:1.5,fontSize:"1rem","&:hover":{borderColor:"primary.main",backgroundColor:"rgba(0, 212, 255, 0.1)",boxShadow:"0 4px 12px rgba(0, 212, 255, 0.2)",transform:"translateY(-1px)"}},children:"Continue with Google"}),e.jsx(x,{fullWidth:!0,variant:"outlined",onClick:async()=>{var r,n,o;const t=window;if((n=(r=t.AppleID)==null?void 0:r.auth)!=null&&n.signIn)try{const a=await t.AppleID.auth.signIn(),f=(o=a==null?void 0:a.authorization)==null?void 0:o.id_token;f?await B(f):i("Apple did not return an id_token.",{variant:"warning"})}catch(a){i((a==null?void 0:a.message)||"Apple Sign-In was cancelled or failed.",{variant:"error"})}else i("Apple Sign-In not initialized. Please refresh.",{variant:"warning"})},sx:{borderColor:"rgba(255, 255, 255, 0.3)",color:"white",borderWidth:2,fontWeight:600,py:1.5,fontSize:"1rem","&:hover":{borderColor:"primary.main",backgroundColor:"rgba(0, 212, 255, 0.1)",boxShadow:"0 4px 12px rgba(0, 212, 255, 0.2)",transform:"translateY(-1px)"}},children:"Continue with Apple"})]})]})}),e.jsx(j,{sx:{my:4},children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"OR"})}),e.jsxs(l,{sx:{textAlign:"center"},children:[e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Don't have an account?"," ",e.jsx(P,{component:U,to:"/register",sx:{color:"primary.main",textDecoration:"none",fontWeight:600,"&:hover":{textDecoration:"underline"}},children:"Create one now"})]}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:"ðŸ”’ Your data is secure and protected by industry-leading encryption"})]})]})]})})})};export{de as default};
