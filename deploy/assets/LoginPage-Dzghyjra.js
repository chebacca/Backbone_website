const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BvoI4F7U.js","assets/mui-BeKQ6Vc5.js","assets/vendor-OeuszDaU.js","assets/stripe-B_MuO_-5.js","assets/index-BFoWrjWu.css"])))=>i.map(i=>d[i]);
import{u as R,a as q,_ as z}from"./index-BvoI4F7U.js";import{j as e,a as l,b as B,d as g,s as V,c as H,T as d,t as I,S,u as y,v as b,x as Z,I as Y,y as $,z as J,L as K,H as C,M as v}from"./mui-BeKQ6Vc5.js";import{u as Q,r as x,L as P}from"./vendor-OeuszDaU.js";import{u as X,C as T}from"./index.esm-BqJ7I8dv.js";import{u as ee}from"./notistack.esm-CcFOI6Un.js";import"./stripe-B_MuO_-5.js";const se=()=>{const i=Q(),{login:W,loginWithGoogle:E,loginWithApple:U}=R(),{setLoading:c}=q(),{enqueueSnackbar:s}=ee(),[m,D]=x.useState(!1),[j,u]=x.useState(null),[f,L]=x.useState(null),[w,N]=x.useState(""),{control:k,handleSubmit:_,formState:{errors:p,isSubmitting:A}}=X({defaultValues:{email:"",password:""}}),G=async r=>{var n,t;try{u(null),c(!0);const a=await W(r.email,r.password);s("Welcome back!",{variant:"success"});const o=String((a==null?void 0:a.role)||"").toUpperCase();i(o==="SUPERADMIN"?"/admin":o==="ACCOUNTING"?"/accounting":"/dashboard")}catch(a){if((n=a==null?void 0:a.details)!=null&&n.requires2FA||a!=null&&a.requires2FA)L(((t=a==null?void 0:a.details)==null?void 0:t.interimToken)||(a==null?void 0:a.interimToken)||null);else{const o=a.message||"Login failed. Please try again.";u(o),s(o,{variant:"error"})}}finally{c(!1)}},M=async r=>{try{u(null),c(!0);const n=await E(r);s("Signed in with Google",{variant:"success"});const t=String((n==null?void 0:n.role)||"").toUpperCase();i(t==="SUPERADMIN"?"/admin":t==="ACCOUNTING"?"/accounting":"/dashboard")}catch(n){const t=n.message||"Google sign-in failed.";u(t),s(t,{variant:"error"})}finally{c(!1)}},O=async r=>{try{u(null),c(!0);const n=await U(r);s("Signed in with Apple",{variant:"success"});const t=String((n==null?void 0:n.role)||"").toUpperCase();i(t==="SUPERADMIN"?"/admin":t==="ACCOUNTING"?"/accounting":"/dashboard")}catch(n){const t=n.message||"Apple sign-in failed.";u(t),s(t,{variant:"error"})}finally{c(!1)}};x.useEffect(()=>{const r=n=>{const t=n.detail;t!=null&&t.credential&&M(t.credential)};return window.addEventListener("google-credential",r),()=>window.removeEventListener("google-credential",r)},[]);const F=()=>{D(!m)};return e.jsx(l,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",alignItems:"center",py:{xs:4,md:0}},children:e.jsx(B,{maxWidth:"sm",children:e.jsxs(l,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsx(l,{sx:{mb:3},children:e.jsx(g,{startIcon:e.jsx(V,{}),onClick:()=>i("/"),sx:{color:"rgba(255, 255, 255, 0.7)","&:hover":{color:"primary.main",backgroundColor:"rgba(0, 212, 255, 0.1)"}},children:"Back to Home"})}),e.jsxs(H,{elevation:10,sx:{p:{xs:4,md:6},backgroundColor:"background.paper",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs(l,{sx:{textAlign:"center",mb:4},children:[e.jsx(l,{sx:{width:60,height:60,borderRadius:2,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",mb:3},children:e.jsx(d,{variant:"h4",sx:{fontWeight:700,color:"#000"},children:"D"})}),e.jsx(d,{variant:"h4",sx:{fontWeight:600,mb:2,textAlign:"center"},children:"Sign in to your BackboneLogic, Inc. account"}),e.jsx(d,{variant:"body1",color:"text.secondary",children:"Welcome back! Please sign in to continue."})]}),j&&e.jsx(I,{severity:"error",sx:{mb:3},children:j}),f?e.jsxs(l,{children:[e.jsx(I,{severity:"info",sx:{mb:3},children:"Enter the 6-digit code from your authenticator app. You can also use a backup code."}),e.jsx(y,{fullWidth:!0,label:"Authentication code",value:w,onChange:r=>N(r.target.value),sx:{mb:2}}),e.jsx(g,{variant:"contained",onClick:async()=>{var r;try{c(!0);const{verify2FA:n}=(await z(async()=>{const{authService:o}=await import("./index-BvoI4F7U.js").then(h=>h.f);return{authService:o}},__vite__mapDeps([0,1,2,3,4]))).authService;if(!f)return;const t=await n(f,w.trim());localStorage.setItem("auth_token",t.token),localStorage.setItem("auth_user",JSON.stringify(t.user)),s("2FA verified. Welcome back!",{variant:"success"});const a=String(((r=t.user)==null?void 0:r.role)||"").toUpperCase();i(a==="SUPERADMIN"?"/admin":a==="ACCOUNTING"?"/accounting":"/dashboard")}catch(n){s(n.message||"Invalid code",{variant:"error"})}finally{c(!1)}},sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000"},children:"Verify Code"})]}):e.jsx(l,{component:"form",onSubmit:_(G),children:e.jsxs(S,{spacing:3,children:[e.jsx(T,{name:"email",control:k,rules:{required:"Email is required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Please enter a valid email address"}},render:({field:r})=>{var n;return e.jsx(y,{...r,fullWidth:!0,label:"Email Address",type:"email",autoComplete:"email",error:!!p.email,helperText:(n=p.email)==null?void 0:n.message,InputProps:{startAdornment:e.jsx(b,{position:"start",children:e.jsx(Z,{sx:{color:"text.secondary"}})})},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.05)"}}})}}),e.jsx(T,{name:"password",control:k,rules:{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters"}},render:({field:r})=>{var n;return e.jsx(y,{...r,fullWidth:!0,label:"Password",type:m?"text":"password",autoComplete:"current-password",error:!!p.password,helperText:(n=p.password)==null?void 0:n.message,InputProps:{startAdornment:e.jsx(b,{position:"start",children:e.jsx(K,{sx:{color:"text.secondary"}})}),endAdornment:e.jsx(b,{position:"end",children:e.jsx(Y,{onClick:F,edge:"end",sx:{color:"text.secondary"},children:m?e.jsx($,{}):e.jsx(J,{})})})},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.05)"}}})}}),e.jsx(l,{sx:{textAlign:"right"},children:e.jsx(C,{component:P,to:"/forgot-password",variant:"body2",sx:{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"Forgot your password?"})}),e.jsx(g,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:A,sx:{py:1.5,fontSize:"1.1rem",fontWeight:600,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000","&:hover":{background:"linear-gradient(135deg, #33ddff 0%, #7b8eed 100%)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.5)"}},children:A?"Signing In...":"Sign In"}),e.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(v,{sx:{flex:1}}),e.jsx(d,{variant:"body2",sx:{mx:2,color:"text.secondary"},children:"or"}),e.jsx(v,{sx:{flex:1}})]}),e.jsxs(S,{spacing:2,direction:{xs:"column",sm:"row"},children:[e.jsx(g,{fullWidth:!0,variant:"outlined",onClick:async()=>{var n,t;const r=window;(t=(n=r.google)==null?void 0:n.accounts)!=null&&t.id?r.google.accounts.id.prompt():s("Google Sign-In not initialized. Please refresh.",{variant:"warning"})},children:"Continue with Google"}),e.jsx(g,{fullWidth:!0,variant:"outlined",onClick:async()=>{var n,t,a;const r=window;if((t=(n=r.AppleID)==null?void 0:n.auth)!=null&&t.signIn)try{const o=await r.AppleID.auth.signIn(),h=(a=o==null?void 0:o.authorization)==null?void 0:a.id_token;h?await O(h):s("Apple did not return an id_token.",{variant:"warning"})}catch(o){s((o==null?void 0:o.message)||"Apple Sign-In was cancelled or failed.",{variant:"error"})}else s("Apple Sign-In not initialized. Please refresh.",{variant:"warning"})},children:"Continue with Apple"})]})]})}),e.jsx(v,{sx:{my:4},children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"OR"})}),e.jsxs(l,{sx:{textAlign:"center"},children:[e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Don't have an account?"," ",e.jsx(C,{component:P,to:"/register",sx:{color:"primary.main",textDecoration:"none",fontWeight:600,"&:hover":{textDecoration:"underline"}},children:"Create one now"})]}),e.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:"ðŸ”’ Your data is secure and protected by industry-leading encryption"})]})]})]})})})};export{se as default};
