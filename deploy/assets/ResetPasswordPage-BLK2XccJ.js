import{j as e,a as o,b,c as f,a4 as V,T as t,d as x,w as M,A as C,a0 as p,n as S,X as u,I,_ as R,$ as W,a1 as D,L as H}from"./mui-Ilj8o9AZ.js";import{u as O,i as Y,r as n,L as Z}from"./vendor-OeuszDaU.js";import{u as $,C as A}from"./index.esm-BqJ7I8dv.js";import{u as G}from"./notistack.esm-CcFOI6Un.js";import{b as U}from"./index-psXGFYnT.js";import"./stripe-BKUR_tcx.js";const se=()=>{const a=O(),{token:i}=Y(),{enqueueSnackbar:w}=G(),[g,L]=n.useState(!1),[m,T]=n.useState(!1),[j,d]=n.useState(null),[z,q]=n.useState(!1),[E,y]=n.useState(null),{control:k,handleSubmit:B,watch:F,formState:{errors:l,isSubmitting:v}}=$({defaultValues:{password:"",confirmPassword:""}}),h=F("password");n.useEffect(()=>{if(!i){y(!1),d("Invalid reset link");return}y(!0)},[i]);const c=(r=>{if(!r)return{score:0,label:"",color:"error"};let s=0;return r.length>=8&&(s+=25),/[a-z]/.test(r)&&(s+=25),/[A-Z]/.test(r)&&(s+=25),/[0-9]/.test(r)&&(s+=25),/[^A-Za-z0-9]/.test(r)&&(s+=25),s<=25?{score:s,label:"Weak",color:"error"}:s<=50?{score:s,label:"Fair",color:"warning"}:s<=75?{score:s,label:"Good",color:"info"}:{score:Math.min(s,100),label:"Strong",color:"success"}})(h),N=async r=>{if(!i){d("Invalid reset token");return}try{d(null),await U.resetPassword(i,r.password),q(!0),w("Password reset successful!",{variant:"success"}),setTimeout(()=>{a("/login")},3e3)}catch(s){const P=s.message||"Failed to reset password. Please try again.";d(P),w(P,{variant:"error"})}};return E===!1?e.jsx(o,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",alignItems:"center",py:{xs:4,md:0}},children:e.jsx(b,{maxWidth:"sm",children:e.jsx(o,{children:e.jsxs(f,{elevation:10,sx:{p:{xs:4,md:6},backgroundColor:"background.paper",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",textAlign:"center"},children:[e.jsx(V,{sx:{fontSize:80,color:"error.main",mb:3}}),e.jsx(t,{variant:"h4",sx:{fontWeight:600,mb:2},children:"Invalid Reset Link"}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{mb:4},children:"This password reset link is invalid or has expired. Please request a new one."}),e.jsxs(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(x,{variant:"contained",onClick:()=>a("/forgot-password"),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000"},children:"Request New Reset Link"}),e.jsx(x,{variant:"outlined",onClick:()=>a("/login"),children:"Back to Login"})]})]})})})}):z?e.jsx(o,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",alignItems:"center",py:{xs:4,md:0}},children:e.jsx(b,{maxWidth:"sm",children:e.jsx(o,{children:e.jsxs(f,{elevation:10,sx:{p:{xs:4,md:6},backgroundColor:"background.paper",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)",textAlign:"center"},children:[e.jsx(M,{sx:{fontSize:80,color:"success.main",mb:3}}),e.jsx(t,{variant:"h4",sx:{fontWeight:600,mb:2},children:"Password Reset Successful!"}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{mb:4},children:"Your password has been successfully reset. You can now sign in with your new password."}),e.jsx(C,{severity:"info",sx:{mb:3},children:"Redirecting to login page in 3 seconds..."}),e.jsx(x,{variant:"contained",onClick:()=>a("/login"),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000"},children:"Continue to Login"})]})})})}):e.jsx(o,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)",display:"flex",alignItems:"center",py:{xs:4,md:0}},children:e.jsx(b,{maxWidth:"sm",children:e.jsx(o,{children:e.jsxs(f,{elevation:10,sx:{p:{xs:4,md:6},backgroundColor:"background.paper",borderRadius:3,border:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsxs(o,{sx:{textAlign:"center",mb:4},children:[e.jsx(o,{sx:{width:80,height:80,borderRadius:2,backgroundColor:"rgba(0, 212, 255, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",mx:"auto",mb:3},children:e.jsx(p,{sx:{fontSize:40,color:"primary.main"}})}),e.jsx(t,{variant:"h4",sx:{fontWeight:600,mb:1,background:"linear-gradient(135deg, #ffffff 0%, #00d4ff 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Reset Password"}),e.jsx(t,{variant:"body1",color:"text.secondary",children:"Enter your new password below"})]}),j&&e.jsx(C,{severity:"error",sx:{mb:3},children:j}),e.jsxs(o,{component:"form",onSubmit:B(N),children:[e.jsx(A,{name:"password",control:k,rules:{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters"},validate:{hasLowerCase:r=>/[a-z]/.test(r)||"Password must contain a lowercase letter",hasUpperCase:r=>/[A-Z]/.test(r)||"Password must contain an uppercase letter",hasNumber:r=>/\d/.test(r)||"Password must contain a number"}},render:({field:r})=>{var s;return e.jsxs(o,{sx:{mb:3},children:[e.jsx(S,{...r,fullWidth:!0,label:"New Password",type:g?"text":"password",error:!!l.password,helperText:(s=l.password)==null?void 0:s.message,InputProps:{startAdornment:e.jsx(u,{position:"start",children:e.jsx(p,{sx:{color:"text.secondary"}})}),endAdornment:e.jsx(u,{position:"end",children:e.jsx(I,{onClick:()=>L(!g),edge:"end",sx:{color:"text.secondary"},children:g?e.jsx(R,{}):e.jsx(W,{})})})},sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.05)"}}}),h&&e.jsxs(o,{sx:{mt:1},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[e.jsx(t,{variant:"caption",color:"text.secondary",children:"Password strength:"}),e.jsx(t,{variant:"caption",color:`${c.color}.main`,sx:{fontWeight:600},children:c.label})]}),e.jsx(D,{variant:"determinate",value:c.score,color:c.color,sx:{height:4,borderRadius:2,backgroundColor:"rgba(255, 255, 255, 0.1)"}})]})]})}}),e.jsx(A,{name:"confirmPassword",control:k,rules:{required:"Please confirm your password",validate:r=>r===h||"Passwords do not match"},render:({field:r})=>{var s;return e.jsx(S,{...r,fullWidth:!0,label:"Confirm New Password",type:m?"text":"password",error:!!l.confirmPassword,helperText:(s=l.confirmPassword)==null?void 0:s.message,sx:{mb:3,"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.05)"}},InputProps:{startAdornment:e.jsx(u,{position:"start",children:e.jsx(p,{sx:{color:"text.secondary"}})}),endAdornment:e.jsx(u,{position:"end",children:e.jsx(I,{onClick:()=>T(!m),edge:"end",sx:{color:"text.secondary"},children:m?e.jsx(R,{}):e.jsx(W,{})})})}})}}),e.jsx(x,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:v,sx:{py:1.5,fontSize:"1.1rem",fontWeight:600,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",mb:3,"&:hover":{background:"linear-gradient(135deg, #33ddff 0%, #7b8eed 100%)"},"&:disabled":{background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.5)"}},children:v?"Resetting Password...":"Reset Password"})]}),e.jsxs(o,{sx:{textAlign:"center"},children:[e.jsxs(t,{variant:"body2",color:"text.secondary",children:["Remember your password?"," ",e.jsx(H,{component:Z,to:"/login",sx:{color:"primary.main",textDecoration:"none",fontWeight:600,"&:hover":{textDecoration:"underline"}},children:"Sign in here"})]}),e.jsx(t,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:"ðŸ”’ Your new password will be securely encrypted"})]})]})})})})};export{se as default};
