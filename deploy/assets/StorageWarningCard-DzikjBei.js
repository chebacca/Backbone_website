import{j as e,t as I,v as L,B as g,aM as U,T as n,r as v,g as E,cd as O,Q,i as Y,d as D,ce as q,bC as H,aJ as J,a as y,cf as V,cg as G,c8 as K,S as X,aB as Z,aC as ee,aD as ae,e as te,aE as re}from"./mui-D8UjIA2s.js";import{r as l}from"./vendor-CjD1bmmO.js";import{c as R,e as se,u as oe}from"./index-CtftzVC1.js";const A={warning:.85,critical:.95,emergency:.98},T={free:{tier:"free",maxCollaborators:2,allowedStorageBackends:["firestore"],maxStorageQuota:1,storageWarningEnabled:!0,additionalStorageAvailable:!1,features:{cloudStorage:!0,localStorage:!1,encryption:!1,backup:!1,analytics:!1,customSchemas:!1}},pro:{tier:"pro",maxCollaborators:10,allowedStorageBackends:["firestore","gcs","s3"],maxStorageQuota:50,storageWarningEnabled:!0,additionalStorageAvailable:!0,additionalStoragePrice:.1,features:{cloudStorage:!0,localStorage:!0,encryption:!0,backup:!0,analytics:!0,customSchemas:!0}},enterprise:{tier:"enterprise",maxCollaborators:-1,allowedStorageBackends:["firestore","gcs","s3","aws","azure","local"],maxStorageQuota:-1,storageWarningEnabled:!1,additionalStorageAvailable:!0,additionalStoragePrice:.08,features:{cloudStorage:!0,localStorage:!0,encryption:!0,backup:!0,analytics:!0,customSchemas:!0}},"on-premises":{tier:"on-premises",maxCollaborators:-1,allowedStorageBackends:["local","private-cloud"],maxStorageQuota:-1,storageWarningEnabled:!1,additionalStorageAvailable:!1,features:{cloudStorage:!1,localStorage:!0,encryption:!0,backup:!0,analytics:!0,customSchemas:!0}}};class b{static async getStorageUsage(a){var o,r,u;try{const[t]=await Promise.all([R.get(se.subscriptions.mySubscriptions())]),x=((r=(o=t.data)==null?void 0:o.data)==null?void 0:r.subscriptions)||[],m=x.find(d=>d.status==="ACTIVE")||x[0],f=((u=m==null?void 0:m.tier)==null?void 0:u.toLowerCase())||"free",h=T[f],p={used:.5,breakdown:{}}.used,S=h.maxStorageQuota;let c=0,i="none";return S>0&&(c=p/S*100,c>=A.emergency*100?i="emergency":c>=A.critical*100?i="critical":c>=A.warning*100&&(i="warning")),{used:Math.round(p*100)/100,limit:S,percentage:Math.round(c*100)/100,tier:f,warningLevel:i,canPurchaseAdditional:h.additionalStorageAvailable||!1,additionalStoragePrice:h.additionalStoragePrice}}catch(t){return console.error("Failed to fetch storage usage:",t),{used:0,limit:1,percentage:0,tier:"free",warningLevel:"none",canPurchaseAdditional:!1}}}static async getStorageBreakdown(){try{const a={firestore:.3,gcs:.1,s3:.05,azure:.02,local:.03,total:.5};return{firestore:a.firestore,gcs:a.gcs,s3:a.s3,azure:a.azure,local:a.local,total:a.total}}catch(a){return console.error("Failed to fetch storage breakdown:",a),{firestore:0,gcs:0,s3:0,azure:0,local:0,total:0}}}static generateStorageAlerts(a){const o=[];if(a.warningLevel==="none"||a.limit===-1)return o;const r={id:`storage-${a.warningLevel}-${Date.now()}`,timestamp:new Date,canUpgrade:a.tier!=="enterprise",canPurchaseStorage:a.canPurchaseAdditional};switch(a.warningLevel){case"warning":o.push({...r,type:"warning",title:"Storage Usage Warning",message:`You're using ${a.percentage}% of your ${a.limit}GB storage limit. Consider upgrading your plan or purchasing additional storage.`,actionRequired:!1});break;case"critical":o.push({...r,type:"critical",title:"Critical Storage Usage",message:`You're using ${a.percentage}% of your ${a.limit}GB storage limit. Your account may be restricted soon. Please upgrade or purchase additional storage immediately.`,actionRequired:!0});break;case"emergency":o.push({...r,type:"emergency",title:"Storage Limit Almost Reached",message:`URGENT: You're using ${a.percentage}% of your ${a.limit}GB storage limit. New uploads will be blocked soon. Upgrade your plan or purchase additional storage now.`,actionRequired:!0});break}return o}static getUpgradeRecommendations(a){const o=[];return a.tier==="free"?o.push({tier:"pro",storageLimit:50,price:"$29/month",recommended:a.used>.8},{tier:"enterprise",storageLimit:-1,price:"Contact Sales",recommended:a.used>40}):a.tier==="pro"&&o.push({tier:"enterprise",storageLimit:-1,price:"Contact Sales",recommended:a.percentage>80}),o}static calculateAdditionalStorageCost(a,o){const r=T[o];return!r.additionalStorageAvailable||!r.additionalStoragePrice?0:a*r.additionalStoragePrice}static async purchaseAdditionalStorage(a){var o,r,u;try{return{success:!0,paymentUrl:(o=(await R.post("storage/purchase",{additionalGB:a})).data)==null?void 0:o.paymentUrl}}catch(t){return{success:!1,error:((u=(r=t.response)==null?void 0:r.data)==null?void 0:u.message)||"Failed to initiate storage purchase"}}}}const ce=({onUpgrade:k,onPurchaseStorage:a,compact:o=!1})=>{const{user:r}=oe();if((r==null?void 0:r.isTeamMember)||(r==null?void 0:r.role)==="TEAM_MEMBER"||(r==null?void 0:r.organizationId)||(r==null?void 0:r.memberRole)||(r==null?void 0:r.email)&&r.email!=="enterprise.user@example.com"&&localStorage.getItem("team_member_data"))return null;const[t,x]=l.useState(null),[m,f]=l.useState([]),[h,j]=l.useState(!0),[p,S]=l.useState(!1),[c,i]=l.useState(!1),[d,$]=l.useState(10),[z,M]=l.useState(new Set);l.useEffect(()=>{P();const s=setInterval(P,5*60*1e3);return()=>clearInterval(s)},[r]);const P=async()=>{try{j(!0);const s=await b.getStorageUsage();x(s);const C=b.generateStorageAlerts(s);f(C)}catch(s){console.error("Failed to fetch storage data:",s)}finally{j(!1)}},F=s=>{M(C=>new Set([...C,s]))},W=async()=>{if(a)a(d);else try{const s=await b.purchaseAdditionalStorage(d);s.success&&s.paymentUrl&&window.open(s.paymentUrl,"_blank")}catch(s){console.error("Failed to purchase storage:",s)}i(!1)},B=s=>{switch(s){case"emergency":return"error";case"critical":return"error";case"warning":return"warning";default:return"primary"}},N=s=>{switch(s){case"emergency":return"error";case"critical":return"error";case"warning":return"warning";default:return"info"}};if(h||!t)return e.jsx(I,{children:e.jsx(L,{children:e.jsxs(g,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(U,{}),e.jsx(n,{variant:"h6",children:"Loading storage usage..."})]})})});if(t.limit===-1&&m.length===0)return null;const _=m.filter(s=>!z.has(s.id)),w=t.additionalStoragePrice?b.calculateAdditionalStorageCost(d,t.tier):0;return e.jsxs(e.Fragment,{children:[e.jsx(I,{sx:{mb:2},children:e.jsxs(L,{children:[e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,children:[e.jsxs(g,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(U,{color:t.warningLevel!=="none"?"warning":"primary"}),e.jsx(n,{variant:"h6",children:"Cloud Storage Usage"}),t.warningLevel!=="none"&&e.jsx(v,{label:t.warningLevel.toUpperCase(),color:B(t.warningLevel),size:"small"})]}),e.jsx(E,{onClick:()=>S(!p),size:"small",children:p?e.jsx(O,{}):e.jsx(Q,{})})]}),e.jsxs(g,{mb:2,children:[e.jsxs(g,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsxs(n,{variant:"body2",color:"textSecondary",children:[t.used,"GB used"]}),e.jsx(n,{variant:"body2",color:"textSecondary",children:t.limit===-1?"Unlimited":`${t.limit}GB limit`})]}),t.limit>0&&e.jsx(Y,{variant:"determinate",value:Math.min(t.percentage,100),color:B(t.warningLevel),sx:{height:8,borderRadius:4}}),t.limit>0&&e.jsxs(n,{variant:"caption",color:"textSecondary",sx:{mt:.5,display:"block"},children:[t.percentage,"% used"]})]}),_.map(s=>e.jsxs(D,{severity:N(s.type),sx:{mb:1},action:e.jsx(E,{size:"small",onClick:()=>F(s.id),children:e.jsx(H,{fontSize:"small"})}),children:[e.jsx(q,{children:s.title}),s.message]},s.id)),(t.warningLevel!=="none"||!o)&&e.jsx(g,{mt:2,children:e.jsxs(J,{variant:"outlined",size:"small",fullWidth:!0,children:[t.tier!=="enterprise"&&e.jsx(y,{startIcon:e.jsx(V,{}),onClick:k,color:"primary",children:"Upgrade Plan"}),t.canPurchaseAdditional&&e.jsx(y,{startIcon:e.jsx(G,{}),onClick:()=>i(!0),color:"secondary",children:"Buy Storage"})]})}),e.jsx(K,{in:p,children:e.jsxs(g,{mt:2,pt:2,borderTop:1,borderColor:"divider",children:[e.jsxs(n,{variant:"subtitle2",gutterBottom:!0,children:["Current Plan: ",t.tier.toUpperCase()]}),t.additionalStoragePrice&&e.jsxs(n,{variant:"body2",color:"textSecondary",children:["Additional storage: $",t.additionalStoragePrice,"/GB/month"]}),e.jsxs(X,{direction:"row",spacing:1,mt:1,children:[e.jsx(v,{label:`${t.tier} tier`,size:"small"}),t.canPurchaseAdditional&&e.jsx(v,{label:"Storage expansion available",size:"small",color:"primary"})]})]})})]})}),e.jsxs(Z,{open:c,onClose:()=>i(!1),children:[e.jsx(ee,{children:"Purchase Additional Storage"}),e.jsxs(ae,{children:[e.jsxs(n,{variant:"body2",color:"textSecondary",sx:{mb:2},children:["Add more cloud storage to your ",t.tier," plan."]}),e.jsx(te,{label:"Additional Storage (GB)",type:"number",value:d,onChange:s=>$(Math.max(1,parseInt(s.target.value)||1)),fullWidth:!0,sx:{mb:2},inputProps:{min:1,max:1e3}}),w>0&&e.jsx(D,{severity:"info",children:e.jsxs(n,{variant:"body2",children:["Cost: $",w.toFixed(2),"/month for ",d,"GB"]})})]}),e.jsxs(re,{children:[e.jsx(y,{onClick:()=>i(!1),children:"Cancel"}),e.jsxs(y,{onClick:W,variant:"contained",startIcon:e.jsx(G,{}),children:["Purchase $",w.toFixed(2),"/month"]})]})]})]})};export{ce as S};
