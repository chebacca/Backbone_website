import{j as e,B as i,i as Z,T as n,d as y,a as d,ay as W,G as l,az as ee,aA as L,am as $,ao as te,t as S,v as f,D as ne,r as F,aB as ae,c as se,aC as re,aD as ie,aE as R,aF as r,aG as le,g as oe,aH as ce,a4 as de,a5 as V,af as xe,aI as he,aJ as me,aK as ue,e as m,aL as je,p as Y,aj as pe}from"./mui-BO-fjSjW.js";import{r as C}from"./vendor-CjD1bmmO.js";import{u as ge}from"./notistack.esm-Ca-E78ev.js";import{b as ye,c as Se,e as fe}from"./useStreamlinedData-BhGCz1_N.js";import{M as u}from"./MetricCard-Bwv-4yrN.js";import"./UnifiedDataService-oV7RTCqm.js";import"./index-B_FkPNdT.js";import"./stripe-BghXmgwV.js";import"./index.esm-DPts1Tj8.js";import"./index.esm-DFeBm_6f.js";import"./FirestoreCollectionManager-B42l6Gje.js";import"./firebase-BKftYLyI.js";import"./index.esm-zGMEL0w1.js";const G=s=>{switch(s.toLowerCase()){case"active":case"paid":case"succeeded":return"success";case"pending":return"warning";case"failed":case"cancelled":return"error";case"past_due":return"warning";default:return"default"}},H=s=>{switch(s.toLowerCase()){case"active":case"paid":case"succeeded":return e.jsx(Y,{});case"pending":return e.jsx($,{});case"failed":case"cancelled":return e.jsx(pe,{});default:return e.jsx(Y,{})}},v=(s,j="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:j}).format(s/100),w=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Be=()=>{var U,E,T,z,A,O,B,k,N;const{enqueueSnackbar:s}=ge(),{data:j,loading:q}=ye(),{data:o,loading:J}=Se(),p=fe(),[I,D]=C.useState(null),[Ce,P]=C.useState(null),[K,c]=C.useState(!1),_=q||J,Q=(a,h)=>{D(a.currentTarget),P(h)},b=()=>{D(null),P(null)},M=async a=>{try{s("Invoice download started",{variant:"success"})}catch{s("Failed to download invoice",{variant:"error"})}b()},X=async()=>{try{s("Payment method updated successfully",{variant:"success"}),c(!1)}catch{s("Failed to update payment method",{variant:"error"})}};if(_)return e.jsxs(i,{sx:{p:3},children:[e.jsx(Z,{}),e.jsx(n,{sx:{mt:2},children:"Loading billing information..."})]});if(!j||!o)return e.jsx(i,{sx:{p:3},children:e.jsx(y,{severity:"error",children:"Unable to load billing data"})});const t=o.subscription||{status:"active",plan:{tier:o.organization.tier,seats:5,pricePerSeat:o.organization.tier==="ENTERPRISE"?1980:o.organization.tier==="PROFESSIONAL"?980:380},currentPeriodEnd:new Date(Date.now()+30*24*60*60*1e3).toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},g=[{id:"1",number:"INV-2024-001",date:new Date(Date.now()-30*24*60*60*1e3).toISOString(),amount:(((U=t==null?void 0:t.plan)==null?void 0:U.pricePerSeat)||0)*(((E=t==null?void 0:t.plan)==null?void 0:E.seats)||0),status:"paid",description:`${o.organization.tier} Plan - Monthly`},{id:"2",number:"INV-2024-002",date:new Date(Date.now()-60*24*60*60*1e3).toISOString(),amount:(((T=t==null?void 0:t.plan)==null?void 0:T.pricePerSeat)||0)*(((z=t==null?void 0:t.plan)==null?void 0:z.seats)||0),status:"paid",description:`${o.organization.tier} Plan - Monthly`}],x={monthlySpend:(((A=t==null?void 0:t.plan)==null?void 0:A.pricePerSeat)||0)*(((O=t==null?void 0:t.plan)==null?void 0:O.seats)||0),totalInvoices:g.length,nextPayment:(t==null?void 0:t.currentPeriodEnd)||new Date,subscriptionStatus:(t==null?void 0:t.status)||"ACTIVE"};return e.jsxs(i,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(n,{variant:"h4",component:"h1",children:"Billing & Payments"}),p.isAccountOwner&&e.jsx(d,{variant:"contained",startIcon:e.jsx(W,{}),onClick:()=>c(!0),children:"Update Payment Method"})]}),e.jsxs(l,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(u,{title:"Monthly Spend",value:v(x.monthlySpend),icon:e.jsx(ee,{}),color:"primary"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(u,{title:"Total Invoices",value:x.totalInvoices,icon:e.jsx(L,{}),color:"warning"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(u,{title:"Next Payment",value:w(x.nextPayment.toString()),icon:e.jsx($,{}),color:"warning"})}),e.jsx(l,{item:!0,xs:12,sm:6,md:3,children:e.jsx(u,{title:"Subscription",value:x.subscriptionStatus.toUpperCase(),icon:e.jsx(te,{}),color:"success"})})]}),e.jsxs(l,{container:!0,spacing:3,children:[e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{children:e.jsxs(f,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Current Subscription"}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(n,{variant:"h4",color:"primary",children:o.organization.tier}),e.jsxs(n,{color:"text.secondary",children:[v((((B=t==null?void 0:t.plan)==null?void 0:B.pricePerSeat)||0)*(((k=t==null?void 0:t.plan)==null?void 0:k.seats)||0)),"/month"]})]}),e.jsx(ne,{sx:{my:2}}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(n,{children:"Status:"}),e.jsx(F,{icon:H(t.status),label:t.status.toUpperCase(),color:G(t.status),size:"small"})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(n,{children:"Seats:"}),e.jsx(n,{children:((N=t==null?void 0:t.plan)==null?void 0:N.seats)||0})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(n,{children:"Next Billing:"}),e.jsx(n,{children:w(((t==null?void 0:t.currentPeriodEnd)||new Date).toString())})]}),p.isAccountOwner&&e.jsx(d,{variant:"outlined",fullWidth:!0,children:"Manage Subscription"})]})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(S,{children:e.jsxs(f,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Payment Method"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(W,{sx:{mr:2,color:"text.secondary"}}),e.jsxs(i,{children:[e.jsx(n,{children:"•••• •••• •••• 4242"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Expires 12/25"})]})]}),e.jsx(y,{severity:"info",sx:{mb:2},children:"Your payment method is securely stored with Stripe."}),p.isAccountOwner&&e.jsx(d,{variant:"outlined",fullWidth:!0,onClick:()=>c(!0),children:"Update Payment Method"})]})})})]}),e.jsx(S,{sx:{mt:3},children:e.jsxs(f,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Invoice History"}),e.jsx(ae,{component:se,variant:"outlined",children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(R,{children:[e.jsx(r,{children:"Invoice #"}),e.jsx(r,{children:"Date"}),e.jsx(r,{children:"Description"}),e.jsx(r,{children:"Amount"}),e.jsx(r,{children:"Status"}),e.jsx(r,{align:"right",children:"Actions"})]})}),e.jsx(le,{children:g.map(a=>e.jsxs(R,{children:[e.jsx(r,{children:e.jsx(n,{variant:"body2",fontFamily:"monospace",children:a.number})}),e.jsx(r,{children:w(a.date)}),e.jsx(r,{children:a.description}),e.jsx(r,{children:e.jsx(n,{fontWeight:"medium",children:v(a.amount)})}),e.jsx(r,{children:e.jsx(F,{icon:H(a.status),label:a.status.toUpperCase(),color:G(a.status),size:"small"})}),e.jsx(r,{align:"right",children:e.jsx(oe,{onClick:h=>Q(h,a),size:"small",children:e.jsx(ce,{})})})]},a.id))})]})}),g.length===0&&e.jsx(i,{sx:{textAlign:"center",py:4},children:e.jsx(n,{color:"text.secondary",children:"No invoices found."})})]})}),e.jsxs(de,{anchorEl:I,open:!!I,onClose:b,children:[e.jsxs(V,{onClick:()=>M(),children:[e.jsx(xe,{sx:{mr:1},fontSize:"small"}),"Download PDF"]}),e.jsxs(V,{onClick:()=>M(),children:[e.jsx(L,{sx:{mr:1},fontSize:"small"}),"View Receipt"]})]}),e.jsxs(he,{open:K,onClose:()=>c(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(me,{children:"Update Payment Method"}),e.jsxs(ue,{children:[e.jsx(y,{severity:"info",sx:{mb:2},children:"Payment methods are securely processed through Stripe. Your card information is never stored on our servers."}),e.jsx(m,{fullWidth:!0,label:"Card Number",placeholder:"1234 5678 9012 3456",margin:"normal"}),e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(m,{fullWidth:!0,label:"Expiry Date",placeholder:"MM/YY",margin:"normal"})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(m,{fullWidth:!0,label:"CVC",placeholder:"123",margin:"normal"})})]}),e.jsx(m,{fullWidth:!0,label:"Cardholder Name",margin:"normal"})]}),e.jsxs(je,{children:[e.jsx(d,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(d,{variant:"contained",onClick:X,children:"Update Payment Method"})]})]})]})};export{Be as StreamlinedBillingPage,Be as default};
