import{j as e,B as i,i as G,T as t,d as y,a as d,aU as U,G as o,ak as H,aV as O,ap as W,aW as $,t as S,v as f,D as q,r as T,as as J,c as _,at as K,au as Q,av as k,aw as a,ax as X,g as Z,ay as ee,a4 as te,a5 as z,af as ne,aF as se,aG as re,aH as ae,e as h,aI as ie,p as E,aJ as oe}from"./mui-BDWO4bKb.js";import{r as b}from"./vendor-CjD1bmmO.js";import{u as le}from"./notistack.esm-Ca-E78ev.js";import{u as ce,a as de,c as xe}from"./useStreamlinedData-DcNfScCM.js";import{M as m}from"./MetricCard-QTqyYwVF.js";import"./index-Dbxqq8rg.js";import"./stripe-CpfM3ZZO.js";import"./index.esm-ClhtutUx.js";import"./index.esm-COtph9ny.js";const A=r=>{switch(r.toLowerCase()){case"active":case"paid":case"succeeded":return"success";case"pending":return"warning";case"failed":case"cancelled":return"error";case"past_due":return"warning";default:return"default"}},B=r=>{switch(r.toLowerCase()){case"active":case"paid":case"succeeded":return e.jsx(E,{});case"pending":return e.jsx(W,{});case"failed":case"cancelled":return e.jsx(oe,{});default:return e.jsx(E,{})}},C=(r,j="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:j}).format(r/100),v=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),Ce=()=>{const{enqueueSnackbar:r}=le(),{data:j,loading:N}=ce(),{data:l,loading:F}=de(),p=xe(),[w,I]=b.useState(null),[ue,P]=b.useState(null),[L,c]=b.useState(!1),R=N||F,V=(s,u)=>{I(s.currentTarget),P(u)},D=()=>{I(null),P(null)},M=async s=>{try{r("Invoice download started",{variant:"success"})}catch{r("Failed to download invoice",{variant:"error"})}D()},Y=async()=>{try{r("Payment method updated successfully",{variant:"success"}),c(!1)}catch{r("Failed to update payment method",{variant:"error"})}};if(R)return e.jsxs(i,{sx:{p:3},children:[e.jsx(G,{}),e.jsx(t,{sx:{mt:2},children:"Loading billing information..."})]});if(!j||!l)return e.jsx(i,{sx:{p:3},children:e.jsx(y,{severity:"error",children:"Unable to load billing data"})});const n=l.subscription||{status:"active",plan:{tier:l.organization.tier,seats:5,pricePerSeat:l.organization.tier==="ENTERPRISE"?1980:l.organization.tier==="PROFESSIONAL"?980:380},currentPeriodEnd:new Date(Date.now()+30*24*60*60*1e3).toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},g=[{id:"1",number:"INV-2024-001",date:new Date(Date.now()-30*24*60*60*1e3).toISOString(),amount:n.plan.pricePerSeat*n.plan.seats,status:"paid",description:`${l.organization.tier} Plan - Monthly`},{id:"2",number:"INV-2024-002",date:new Date(Date.now()-60*24*60*60*1e3).toISOString(),amount:n.plan.pricePerSeat*n.plan.seats,status:"paid",description:`${l.organization.tier} Plan - Monthly`}],x={monthlySpend:n.plan.pricePerSeat*n.plan.seats,totalInvoices:g.length,nextPayment:n.currentPeriodEnd,subscriptionStatus:n.status};return e.jsxs(i,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(t,{variant:"h4",component:"h1",children:"Billing & Payments"}),p.isAccountOwner&&e.jsx(d,{variant:"contained",startIcon:e.jsx(U,{}),onClick:()=>c(!0),children:"Update Payment Method"})]}),e.jsxs(o,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{title:"Monthly Spend",value:C(x.monthlySpend),icon:e.jsx(H,{}),color:"primary"})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{title:"Total Invoices",value:x.totalInvoices,icon:e.jsx(O,{}),color:"warning"})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{title:"Next Payment",value:v(x.nextPayment.toString()),icon:e.jsx(W,{}),color:"warning"})}),e.jsx(o,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{title:"Subscription",value:x.subscriptionStatus.toUpperCase(),icon:e.jsx($,{}),color:"success"})})]}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(S,{children:e.jsxs(f,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Current Subscription"}),e.jsxs(i,{sx:{mb:2},children:[e.jsx(t,{variant:"h4",color:"primary",children:l.organization.tier}),e.jsxs(t,{color:"text.secondary",children:[C(n.plan.pricePerSeat*n.plan.seats),"/month"]})]}),e.jsx(q,{sx:{my:2}}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(t,{children:"Status:"}),e.jsx(T,{icon:B(n.status),label:n.status.toUpperCase(),color:A(n.status),size:"small"})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[e.jsx(t,{children:"Seats:"}),e.jsx(t,{children:n.plan.seats})]}),e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(t,{children:"Next Billing:"}),e.jsx(t,{children:v(n.currentPeriodEnd.toString())})]}),p.isAccountOwner&&e.jsx(d,{variant:"outlined",fullWidth:!0,children:"Manage Subscription"})]})})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsx(S,{children:e.jsxs(f,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Payment Method"}),e.jsxs(i,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(U,{sx:{mr:2,color:"text.secondary"}}),e.jsxs(i,{children:[e.jsx(t,{children:"•••• •••• •••• 4242"}),e.jsx(t,{variant:"caption",color:"text.secondary",children:"Expires 12/25"})]})]}),e.jsx(y,{severity:"info",sx:{mb:2},children:"Your payment method is securely stored with Stripe."}),p.isAccountOwner&&e.jsx(d,{variant:"outlined",fullWidth:!0,onClick:()=>c(!0),children:"Update Payment Method"})]})})})]}),e.jsx(S,{sx:{mt:3},children:e.jsxs(f,{children:[e.jsx(t,{variant:"h6",gutterBottom:!0,children:"Invoice History"}),e.jsx(J,{component:_,variant:"outlined",children:e.jsxs(K,{children:[e.jsx(Q,{children:e.jsxs(k,{children:[e.jsx(a,{children:"Invoice #"}),e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Description"}),e.jsx(a,{children:"Amount"}),e.jsx(a,{children:"Status"}),e.jsx(a,{align:"right",children:"Actions"})]})}),e.jsx(X,{children:g.map(s=>e.jsxs(k,{children:[e.jsx(a,{children:e.jsx(t,{variant:"body2",fontFamily:"monospace",children:s.number})}),e.jsx(a,{children:v(s.date)}),e.jsx(a,{children:s.description}),e.jsx(a,{children:e.jsx(t,{fontWeight:"medium",children:C(s.amount)})}),e.jsx(a,{children:e.jsx(T,{icon:B(s.status),label:s.status.toUpperCase(),color:A(s.status),size:"small"})}),e.jsx(a,{align:"right",children:e.jsx(Z,{onClick:u=>V(u,s),size:"small",children:e.jsx(ee,{})})})]},s.id))})]})}),g.length===0&&e.jsx(i,{sx:{textAlign:"center",py:4},children:e.jsx(t,{color:"text.secondary",children:"No invoices found."})})]})}),e.jsxs(te,{anchorEl:w,open:!!w,onClose:D,children:[e.jsxs(z,{onClick:()=>M(),children:[e.jsx(ne,{sx:{mr:1},fontSize:"small"}),"Download PDF"]}),e.jsxs(z,{onClick:()=>M(),children:[e.jsx(O,{sx:{mr:1},fontSize:"small"}),"View Receipt"]})]}),e.jsxs(se,{open:L,onClose:()=>c(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(re,{children:"Update Payment Method"}),e.jsxs(ae,{children:[e.jsx(y,{severity:"info",sx:{mb:2},children:"Payment methods are securely processed through Stripe. Your card information is never stored on our servers."}),e.jsx(h,{fullWidth:!0,label:"Card Number",placeholder:"1234 5678 9012 3456",margin:"normal"}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,label:"Expiry Date",placeholder:"MM/YY",margin:"normal"})}),e.jsx(o,{item:!0,xs:6,children:e.jsx(h,{fullWidth:!0,label:"CVC",placeholder:"123",margin:"normal"})})]}),e.jsx(h,{fullWidth:!0,label:"Cardholder Name",margin:"normal"})]}),e.jsxs(ie,{children:[e.jsx(d,{onClick:()=>c(!1),children:"Cancel"}),e.jsx(d,{variant:"contained",onClick:Y,children:"Update Payment Method"})]})]})]})};export{Ce as StreamlinedBillingPage,Ce as default};
