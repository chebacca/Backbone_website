import{j as e,B as r,i as $,T as i,d as A,a as C,ap as q,G as d,aL as k,p as y,am as N,t as H,v as K,aq as X,c as J,ar as Q,as as Y,at as D,au as a,av as Z,aM as _,g as z,aI as P,ag as ee,r as h,aw as se,a4 as ae,a5 as c,aJ as ne,aH as te,ay as re,az as ie,aA as le,e as w,aE as ce,o as oe,aj as de}from"./mui-CwmAuw8Y.js";import{r as j}from"./vendor-CjD1bmmO.js";import{u as xe}from"./notistack.esm-Ca-E78ev.js";import{u as ue,a as he,c as je}from"./useStreamlinedData-DCuA8z-C.js";import{M as m}from"./MetricCard-BnhjgK8w.js";import"./index-CPHMAeaw.js";import"./stripe-N9VLlH2J.js";import"./index.esm-DonjM_pP.js";import"./index.esm-D7ujsXeY.js";const me=t=>{switch(t){case"ENTERPRISE":return"success";case"PROFESSIONAL":return"primary";case"BASIC":return"secondary";default:return"default"}},pe=t=>{switch(t){case"ACTIVE":return"success";case"PENDING":return"warning";case"SUSPENDED":return"error";case"EXPIRED":return"error";default:return"default"}},ge=t=>{switch(t){case"ACTIVE":return e.jsx(y,{});case"PENDING":return e.jsx(N,{});case"SUSPENDED":return e.jsx(de,{});case"EXPIRED":return e.jsx(oe,{});default:return e.jsx(y,{})}},Ae=()=>{var I,L;const{enqueueSnackbar:t}=xe(),{data:B,loading:R}=ue(),{data:l,loading:M}=he(),O=je(),[f,v]=j.useState(null),[p,S]=j.useState(null),[W,x]=j.useState(!1),[Ce,F]=j.useState(!1),U=R||M,V=(s,n)=>{v(s.currentTarget),S(n)},g=()=>{v(null),S(null)},E=async s=>{try{await navigator.clipboard.writeText(s),t("License key copied to clipboard",{variant:"success"})}catch{t("Failed to copy license key",{variant:"error"})}g()},G=async s=>{try{t("License created successfully",{variant:"success"}),x(!1)}catch{t("Failed to create license",{variant:"error"})}};if(U)return e.jsxs(r,{sx:{p:3},children:[e.jsx($,{}),e.jsx(i,{sx:{mt:2},children:"Loading licenses..."})]});if(!B||!l)return e.jsx(r,{sx:{p:3},children:e.jsx(A,{severity:"error",children:"Unable to load license data"})});const o=l.members.filter(s=>s.license).map(s=>{var n,T,b;return{id:s.id,key:`${l.organization.tier}-${s.id.slice(-8)}`,assignedTo:s,tier:((n=s.license)==null?void 0:n.type)||"BASIC",status:((T=s.license)==null?void 0:T.status)||"ACTIVE",permissions:((b=s.license)==null?void 0:b.permissions)||[]}}),u={totalLicenses:o.length,activeLicenses:o.filter(s=>s.status==="ACTIVE").length,availableSeats:((L=(I=l.subscription)==null?void 0:I.plan)==null?void 0:L.seats)||0,usedSeats:o.length};return e.jsxs(r,{sx:{p:3},children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(i,{variant:"h4",component:"h1",children:"License Management"}),O.canManageTeam&&e.jsx(C,{variant:"contained",startIcon:e.jsx(q,{}),onClick:()=>x(!0),children:"Create License"})]}),e.jsxs(d,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{title:"Total Licenses",value:u.totalLicenses,icon:e.jsx(k,{}),color:"primary"})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{title:"Active Licenses",value:u.activeLicenses,icon:e.jsx(y,{}),color:"success"})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{title:"Available Seats",value:u.availableSeats-u.usedSeats,icon:e.jsx(N,{}),color:"warning"})}),e.jsx(d,{item:!0,xs:12,sm:6,md:3,children:e.jsx(m,{title:"Organization Tier",value:l.organization.tier,icon:e.jsx(k,{}),color:"secondary"})})]}),e.jsx(H,{children:e.jsxs(K,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Active Licenses"}),e.jsx(X,{component:J,variant:"outlined",children:e.jsxs(Q,{children:[e.jsx(Y,{children:e.jsxs(D,{children:[e.jsx(a,{children:"License Key"}),e.jsx(a,{children:"Assigned To"}),e.jsx(a,{children:"Tier"}),e.jsx(a,{children:"Status"}),e.jsx(a,{children:"Permissions"}),e.jsx(a,{align:"right",children:"Actions"})]})}),e.jsx(Z,{children:o.map(s=>e.jsxs(D,{children:[e.jsx(a,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"body2",fontFamily:"monospace",children:s.key}),e.jsx(_,{title:"Copy license key",children:e.jsx(z,{size:"small",onClick:()=>E(s.key),children:e.jsx(P,{fontSize:"small"})})})]})}),e.jsx(a,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ee,{sx:{width:32,height:32},children:s.assignedTo.name.charAt(0)}),e.jsxs(r,{children:[e.jsx(i,{variant:"body2",fontWeight:"medium",children:s.assignedTo.name}),e.jsx(i,{variant:"caption",color:"text.secondary",children:s.assignedTo.email})]})]})}),e.jsx(a,{children:e.jsx(h,{label:s.tier,color:me(s.tier),size:"small"})}),e.jsx(a,{children:e.jsx(h,{icon:ge(s.status),label:s.status,color:pe(s.status),size:"small"})}),e.jsx(a,{children:e.jsxs(r,{sx:{display:"flex",gap:.5,flexWrap:"wrap"},children:[s.permissions.slice(0,2).map(n=>e.jsx(h,{label:n,size:"small",variant:"outlined"},n)),s.permissions.length>2&&e.jsx(h,{label:`+${s.permissions.length-2}`,size:"small",variant:"outlined"})]})}),e.jsx(a,{align:"right",children:e.jsx(z,{onClick:n=>V(n,s),size:"small",children:e.jsx(se,{})})})]},s.id))})]})}),o.length===0&&e.jsx(r,{sx:{textAlign:"center",py:4},children:e.jsx(i,{color:"text.secondary",children:"No licenses found. Create your first license to get started."})})]})}),e.jsxs(ae,{anchorEl:f,open:!!f,onClose:g,children:[e.jsxs(c,{onClick:()=>E(p==null?void 0:p.key),children:[e.jsx(P,{sx:{mr:1},fontSize:"small"}),"Copy License Key"]}),e.jsxs(c,{onClick:()=>F(!0),children:[e.jsx(ne,{sx:{mr:1},fontSize:"small"}),"Edit License"]}),e.jsxs(c,{onClick:g,children:[e.jsx(te,{sx:{mr:1},fontSize:"small"}),"Revoke License"]})]}),e.jsxs(re,{open:W,onClose:()=>x(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ie,{children:"Create New License"}),e.jsxs(le,{children:[e.jsx(A,{severity:"info",sx:{mb:2},children:"Licenses are automatically created when you add team members. This dialog allows you to create additional licenses for future use."}),e.jsx(w,{fullWidth:!0,label:"License Name",margin:"normal",placeholder:"Enter license name"}),e.jsxs(w,{fullWidth:!0,select:!0,label:"License Tier",margin:"normal",defaultValue:l.organization.tier,children:[e.jsx(c,{value:"BASIC",children:"Basic"}),e.jsx(c,{value:"PROFESSIONAL",children:"Professional"}),e.jsx(c,{value:"ENTERPRISE",children:"Enterprise"})]})]}),e.jsxs(ce,{children:[e.jsx(C,{onClick:()=>x(!1),children:"Cancel"}),e.jsx(C,{variant:"contained",onClick:()=>G(),children:"Create License"})]})]})]})};export{Ae as StreamlinedLicensesPage,Ae as default};
