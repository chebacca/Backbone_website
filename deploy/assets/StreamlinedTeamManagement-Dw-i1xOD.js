import{j as e,B as d,a_ as F,d as Q,a as R,t as V,v as _,X as Y,T as x,r as E,ap as Z,au as m,c as b,av as ee,aw as ae,ax as L,ay as i,az as se,f as ne,g as H,aE as le,aC as te,aH as ie,aI as re,aJ as ce,S as de,e as j,a5 as h,aK as oe}from"./mui-C0ZDli_l.js";import{r as C}from"./vendor-CjD1bmmO.js";import{a as ue,d as he,c as xe,e as pe}from"./useStreamlinedData-C9NVZ4f3.js";import"./index-Bq4VIwtE.js";import"./stripe-BUwd9CCU.js";import"./index.esm-ClhtutUx.js";import"./index.esm-COtph9ny.js";const je=({open:s,onClose:y,member:a,onSave:T})=>{var I,p;const[l,r]=C.useState({name:(a==null?void 0:a.name)||"",email:(a==null?void 0:a.email)||"",userType:(a==null?void 0:a.userType)||"TEAM_MEMBER",role:(a==null?void 0:a.role)||"MEMBER",department:((I=a==null?void 0:a.teamMemberData)==null?void 0:I.department)||"",licenseType:((p=a==null?void 0:a.license)==null?void 0:p.type)||"BASIC"}),v=()=>{var t,M,g,A,f,S;T({name:l.name,email:l.email,userType:l.userType,role:l.role,teamMemberData:{managedBy:((t=a==null?void 0:a.teamMemberData)==null?void 0:t.managedBy)||"UNASSIGNED",department:l.department,assignedProjects:((M=a==null?void 0:a.teamMemberData)==null?void 0:M.assignedProjects)||[]},license:{type:l.licenseType,status:((g=a==null?void 0:a.license)==null?void 0:g.status)||"ACTIVE",permissions:((A=a==null?void 0:a.license)==null?void 0:A.permissions)||[],canCreateProjects:((f=a==null?void 0:a.license)==null?void 0:f.canCreateProjects)||!1,canManageTeam:((S=a==null?void 0:a.license)==null?void 0:S.canManageTeam)||!1}}),y()};return e.jsxs(ie,{open:s,onClose:y,maxWidth:"sm",fullWidth:!0,children:[e.jsx(re,{children:a?"Edit Team Member":"Add Team Member"}),e.jsx(ce,{children:e.jsxs(de,{spacing:3,sx:{mt:1},children:[e.jsx(j,{label:"Name",value:l.name,onChange:t=>r({...l,name:t.target.value}),fullWidth:!0}),e.jsx(j,{label:"Email",type:"email",value:l.email,onChange:t=>r({...l,email:t.target.value}),fullWidth:!0}),e.jsxs(j,{label:"User Type",select:!0,value:l.userType,onChange:t=>r({...l,userType:t.target.value}),fullWidth:!0,children:[e.jsx(h,{value:"TEAM_MEMBER",children:"Team Member"}),e.jsx(h,{value:"ADMIN",children:"Admin"})]}),e.jsxs(j,{label:"Role",select:!0,value:l.role,onChange:t=>r({...l,role:t.target.value}),fullWidth:!0,children:[e.jsx(h,{value:"MEMBER",children:"Member"}),e.jsx(h,{value:"ADMIN",children:"Admin"}),e.jsx(h,{value:"VIEWER",children:"Viewer"})]}),e.jsx(j,{label:"Department",value:l.department,onChange:t=>r({...l,department:t.target.value}),fullWidth:!0}),e.jsxs(j,{label:"License Type",select:!0,value:l.licenseType,onChange:t=>r({...l,licenseType:t.target.value}),fullWidth:!0,children:[e.jsx(h,{value:"BASIC",children:"Basic"}),e.jsx(h,{value:"PROFESSIONAL",children:"Professional"}),e.jsx(h,{value:"ENTERPRISE",children:"Enterprise"})]})]})}),e.jsxs(oe,{children:[e.jsx(R,{onClick:y,children:"Cancel"}),e.jsx(R,{onClick:v,variant:"contained",children:a?"Update":"Create"})]})]})},Ie=()=>{var D,N,O,B,U,w,z,P,W,k;const{data:s,loading:y,error:a,refetch:T}=ue(),{mutate:l,loading:r}=he(),v=xe(),[I,p]=C.useState(!1),[t,M]=C.useState(),[g,A]=C.useState([]),f=pe((s==null?void 0:s.members)||[],A),S=g.length>0?g:(s==null?void 0:s.members)||[],G=()=>{M(void 0),p(!0)},J=n=>{M(n),p(!0)},K=async n=>{if(!t){console.log("Create new member:",n);return}const o=f(c=>c.map(u=>u.id===t.id?{...u,...n}:u));try{await l({userId:t.id,updates:n}),T()}catch(c){o(),console.error("Failed to update member:",c)}},X=async n=>{if(!confirm(`Are you sure you want to remove ${n.name} from the team?`))return;const o=f(c=>c.filter(u=>u.id!==n.id));try{await l({userId:n.id,updates:{status:"INACTIVE"}}),T()}catch(c){o(),console.error("Failed to remove member:",c)}},$=(n,o)=>n==="ACCOUNT_OWNER"?"primary":o==="ADMIN"?"secondary":"default",q=n=>{switch(n){case"ENTERPRISE":return"error";case"PROFESSIONAL":return"warning";case"BASIC":return"info";default:return"default"}};return y?e.jsxs(d,{sx:{p:3},children:[e.jsx(F,{variant:"rectangular",height:200,sx:{mb:3}}),e.jsx(F,{variant:"rectangular",height:400})]}):a?e.jsxs(d,{sx:{p:3},children:[e.jsx(Q,{severity:"error",sx:{mb:3},children:a}),e.jsx(R,{onClick:T,variant:"contained",children:"Retry"})]}):e.jsxs(d,{sx:{p:3},children:[e.jsx(V,{sx:{mb:3},children:e.jsxs(_,{children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Y,{sx:{mr:2,color:"primary.main"}}),e.jsx(x,{variant:"h5",component:"h1",children:(D=s==null?void 0:s.organization)==null?void 0:D.name}),e.jsx(E,{label:(N=s==null?void 0:s.organization)==null?void 0:N.tier,color:"primary",sx:{ml:2}})]}),e.jsxs(d,{sx:{display:"flex",gap:4},children:[e.jsxs(d,{children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Total Members"}),e.jsx(x,{variant:"h6",children:((B=(O=s==null?void 0:s.organization)==null?void 0:O.usage)==null?void 0:B.totalUsers)||0})]}),e.jsxs(d,{children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Subscription Status"}),e.jsx(E,{label:((U=s==null?void 0:s.subscription)==null?void 0:U.status)||"Unknown",color:((w=s==null?void 0:s.subscription)==null?void 0:w.status)==="ACTIVE"?"success":"warning",size:"small"})]}),e.jsxs(d,{children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Seats Used"}),e.jsxs(x,{variant:"h6",children:[((P=(z=s==null?void 0:s.subscription)==null?void 0:z.plan)==null?void 0:P.seats)||0," / ",((k=(W=s==null?void 0:s.organization)==null?void 0:W.usage)==null?void 0:k.totalUsers)||0]})]})]})]})}),e.jsx(V,{children:e.jsxs(_,{children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(x,{variant:"h6",component:"h2",children:"Team Members"}),v.canManageTeam&&e.jsx(R,{variant:"contained",startIcon:e.jsx(Z,{}),onClick:G,disabled:r,children:"Add Member"})]}),e.jsx(m,{component:b,variant:"outlined",children:e.jsxs(ee,{children:[e.jsx(ae,{children:e.jsxs(L,{children:[e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Role"}),e.jsx(i,{children:"License"}),e.jsx(i,{children:"Department"}),e.jsx(i,{children:"Status"}),v.canManageTeam&&e.jsx(i,{children:"Actions"})]})}),e.jsx(se,{children:S.map(n=>{var o,c,u;return e.jsxs(L,{children:[e.jsx(i,{children:e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ne,{sx:{mr:1,color:"text.secondary"}}),n.name]})}),e.jsx(i,{children:n.email}),e.jsx(i,{children:e.jsx(E,{label:n.userType==="ACCOUNT_OWNER"?"Owner":n.role,color:$(n.userType,n.role),size:"small"})}),e.jsx(i,{children:e.jsx(E,{label:((o=n.license)==null?void 0:o.type)||"None",color:q(((c=n.license)==null?void 0:c.type)||""),size:"small"})}),e.jsx(i,{children:((u=n.teamMemberData)==null?void 0:u.department)||"-"}),e.jsx(i,{children:e.jsx(E,{label:n.status,color:n.status==="ACTIVE"?"success":"default",size:"small"})}),v.canManageTeam&&e.jsxs(i,{children:[e.jsx(H,{size:"small",onClick:()=>J(n),disabled:r,children:e.jsx(le,{})}),n.userType!=="ACCOUNT_OWNER"&&e.jsx(H,{size:"small",onClick:()=>X(n),disabled:r,color:"error",children:e.jsx(te,{})})]})]},n.id)})})]})})]})}),e.jsx(je,{open:I,onClose:()=>p(!1),member:t,onSave:K})]})};export{Ie as StreamlinedTeamManagement,Ie as default};
