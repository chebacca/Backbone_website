import{j as e,B as d,aN as F,d as Q,a as D,t as V,v as L,X as Y,T as x,r as E,ai as Z,ao as b,c as m,ap as ee,aq as se,ar as _,as as i,at as ae,f as ne,g as q,ay as le,aw as te,aB as ie,aC as re,aD as ce,S as de,e as j,a5 as h,aE as oe}from"./mui-D8UjIA2s.js";import{r as C}from"./vendor-CjD1bmmO.js";import{u as ue,a as he,b as xe,c as pe}from"./useStreamlinedData-B9P6f8Xg.js";import"./index-COLKuLd4.js";import"./stripe-CUttI3Gx.js";import"./index.esm-ClhtutUx.js";import"./index.esm-COtph9ny.js";const je=({open:a,onClose:y,member:s,onSave:T})=>{var I,p;const[l,r]=C.useState({name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||"",userType:(s==null?void 0:s.userType)||"TEAM_MEMBER",role:(s==null?void 0:s.role)||"MEMBER",department:((I=s==null?void 0:s.teamMemberData)==null?void 0:I.department)||"",licenseType:((p=s==null?void 0:s.license)==null?void 0:p.type)||"BASIC"}),v=()=>{var t,M,g,A,f,S;T({name:l.name,email:l.email,userType:l.userType,role:l.role,teamMemberData:{managedBy:((t=s==null?void 0:s.teamMemberData)==null?void 0:t.managedBy)||"UNASSIGNED",department:l.department,assignedProjects:((M=s==null?void 0:s.teamMemberData)==null?void 0:M.assignedProjects)||[]},license:{type:l.licenseType,status:((g=s==null?void 0:s.license)==null?void 0:g.status)||"ACTIVE",permissions:((A=s==null?void 0:s.license)==null?void 0:A.permissions)||[],canCreateProjects:((f=s==null?void 0:s.license)==null?void 0:f.canCreateProjects)||!1,canManageTeam:((S=s==null?void 0:s.license)==null?void 0:S.canManageTeam)||!1}}),y()};return e.jsxs(ie,{open:a,onClose:y,maxWidth:"sm",fullWidth:!0,children:[e.jsx(re,{children:s?"Edit Team Member":"Add Team Member"}),e.jsx(ce,{children:e.jsxs(de,{spacing:3,sx:{mt:1},children:[e.jsx(j,{label:"Name",value:l.name,onChange:t=>r({...l,name:t.target.value}),fullWidth:!0}),e.jsx(j,{label:"Email",type:"email",value:l.email,onChange:t=>r({...l,email:t.target.value}),fullWidth:!0}),e.jsxs(j,{label:"User Type",select:!0,value:l.userType,onChange:t=>r({...l,userType:t.target.value}),fullWidth:!0,children:[e.jsx(h,{value:"TEAM_MEMBER",children:"Team Member"}),e.jsx(h,{value:"ADMIN",children:"Admin"})]}),e.jsxs(j,{label:"Role",select:!0,value:l.role,onChange:t=>r({...l,role:t.target.value}),fullWidth:!0,children:[e.jsx(h,{value:"MEMBER",children:"Member"}),e.jsx(h,{value:"ADMIN",children:"Admin"}),e.jsx(h,{value:"VIEWER",children:"Viewer"})]}),e.jsx(j,{label:"Department",value:l.department,onChange:t=>r({...l,department:t.target.value}),fullWidth:!0}),e.jsxs(j,{label:"License Type",select:!0,value:l.licenseType,onChange:t=>r({...l,licenseType:t.target.value}),fullWidth:!0,children:[e.jsx(h,{value:"BASIC",children:"Basic"}),e.jsx(h,{value:"PROFESSIONAL",children:"Professional"}),e.jsx(h,{value:"ENTERPRISE",children:"Enterprise"})]})]})}),e.jsxs(oe,{children:[e.jsx(D,{onClick:y,children:"Cancel"}),e.jsx(D,{onClick:v,variant:"contained",children:s?"Update":"Create"})]})]})},Ie=()=>{var N,R,B,O,U,w,P,W,z,k;const{data:a,loading:y,error:s,refetch:T}=ue(),{mutate:l,loading:r}=he(),v=xe(),[I,p]=C.useState(!1),[t,M]=C.useState(),[g,A]=C.useState([]),f=pe((a==null?void 0:a.members)||[],A),S=g.length>0?g:(a==null?void 0:a.members)||[],G=()=>{M(void 0),p(!0)},H=n=>{M(n),p(!0)},X=async n=>{if(!t){console.log("Create new member:",n);return}const o=f(c=>c.map(u=>u.id===t.id?{...u,...n}:u));try{await l({userId:t.id,updates:n}),T()}catch(c){o(),console.error("Failed to update member:",c)}},$=async n=>{if(!confirm(`Are you sure you want to remove ${n.name} from the team?`))return;const o=f(c=>c.filter(u=>u.id!==n.id));try{await l({userId:n.id,updates:{status:"INACTIVE"}}),T()}catch(c){o(),console.error("Failed to remove member:",c)}},J=(n,o)=>n==="ACCOUNT_OWNER"?"primary":o==="ADMIN"?"secondary":"default",K=n=>{switch(n){case"ENTERPRISE":return"error";case"PROFESSIONAL":return"warning";case"BASIC":return"info";default:return"default"}};return y?e.jsxs(d,{sx:{p:3},children:[e.jsx(F,{variant:"rectangular",height:200,sx:{mb:3}}),e.jsx(F,{variant:"rectangular",height:400})]}):s?e.jsxs(d,{sx:{p:3},children:[e.jsx(Q,{severity:"error",sx:{mb:3},children:s}),e.jsx(D,{onClick:T,variant:"contained",children:"Retry"})]}):e.jsxs(d,{sx:{p:3},children:[e.jsx(V,{sx:{mb:3},children:e.jsxs(L,{children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(Y,{sx:{mr:2,color:"primary.main"}}),e.jsx(x,{variant:"h5",component:"h1",children:(N=a==null?void 0:a.organization)==null?void 0:N.name}),e.jsx(E,{label:(R=a==null?void 0:a.organization)==null?void 0:R.tier,color:"primary",sx:{ml:2}})]}),e.jsxs(d,{sx:{display:"flex",gap:4},children:[e.jsxs(d,{children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Total Members"}),e.jsx(x,{variant:"h6",children:((O=(B=a==null?void 0:a.organization)==null?void 0:B.usage)==null?void 0:O.totalUsers)||0})]}),e.jsxs(d,{children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Subscription Status"}),e.jsx(E,{label:((U=a==null?void 0:a.subscription)==null?void 0:U.status)||"Unknown",color:((w=a==null?void 0:a.subscription)==null?void 0:w.status)==="ACTIVE"?"success":"warning",size:"small"})]}),e.jsxs(d,{children:[e.jsx(x,{variant:"body2",color:"text.secondary",children:"Seats Used"}),e.jsxs(x,{variant:"h6",children:[((W=(P=a==null?void 0:a.subscription)==null?void 0:P.plan)==null?void 0:W.seats)||0," / ",((k=(z=a==null?void 0:a.organization)==null?void 0:z.usage)==null?void 0:k.totalUsers)||0]})]})]})]})}),e.jsx(V,{children:e.jsxs(L,{children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(x,{variant:"h6",component:"h2",children:"Team Members"}),v.canManageTeam&&e.jsx(D,{variant:"contained",startIcon:e.jsx(Z,{}),onClick:G,disabled:r,children:"Add Member"})]}),e.jsx(b,{component:m,variant:"outlined",children:e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(_,{children:[e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Role"}),e.jsx(i,{children:"License"}),e.jsx(i,{children:"Department"}),e.jsx(i,{children:"Status"}),v.canManageTeam&&e.jsx(i,{children:"Actions"})]})}),e.jsx(ae,{children:S.map(n=>{var o,c,u;return e.jsxs(_,{children:[e.jsx(i,{children:e.jsxs(d,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ne,{sx:{mr:1,color:"text.secondary"}}),n.name]})}),e.jsx(i,{children:n.email}),e.jsx(i,{children:e.jsx(E,{label:n.userType==="ACCOUNT_OWNER"?"Owner":n.role,color:J(n.userType,n.role),size:"small"})}),e.jsx(i,{children:e.jsx(E,{label:((o=n.license)==null?void 0:o.type)||"None",color:K(((c=n.license)==null?void 0:c.type)||""),size:"small"})}),e.jsx(i,{children:((u=n.teamMemberData)==null?void 0:u.department)||"-"}),e.jsx(i,{children:e.jsx(E,{label:n.status,color:n.status==="ACTIVE"?"success":"default",size:"small"})}),v.canManageTeam&&e.jsxs(i,{children:[e.jsx(q,{size:"small",onClick:()=>H(n),disabled:r,children:e.jsx(le,{})}),n.userType!=="ACCOUNT_OWNER"&&e.jsx(q,{size:"small",onClick:()=>$(n),disabled:r,color:"error",children:e.jsx(te,{})})]})]},n.id)})})]})})]})}),e.jsx(je,{open:I,onClose:()=>p(!1),member:t,onSave:X})]})};export{Ie as StreamlinedTeamManagement,Ie as default};
