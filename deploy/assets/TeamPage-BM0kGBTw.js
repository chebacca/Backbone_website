import{j as e,B as r,C as Ue,T as s,d as j,ai as R,w as $e,x as le,y as b,aj as Be,z as oe,H as Fe,a as o,aG as Ve,G as f,W as ue,p as je,am as ge,u as Ge,t as He,v as qe,aZ as _e,aq as Je,ar as Ke,as as Ye,at as ce,au as l,av as Ze,ag as Qe,r as de,a_ as Xe,g as ea,aw as aa,ax as sa,ap as ta,ay as M,az as I,aA as w,e as g,aB as xe,aC as me,aD as he,a5 as d,aE as D,n as na,aH as N,i as ra,a4 as ia,aJ as la,E as oa,D as ca,aK as da}from"./mui-CwmAuw8Y.js";import{r as x}from"./vendor-CjD1bmmO.js";import{u as xa}from"./notistack.esm-Ca-E78ev.js";import{u as ma,a as ha,b as ua}from"./useStreamlinedData-DCuA8z-C.js";import{M as A}from"./MetricCard-BnhjgK8w.js";import"./index-CPHMAeaw.js";import"./stripe-N9VLlH2J.js";import"./index.esm-DonjM_pP.js";import"./index.esm-D7ujsXeY.js";const ja=i=>{switch(i){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},ga=i=>{switch(i){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},va=i=>{switch(i){case"active":return e.jsx(je,{});case"pending":return e.jsx(ge,{});case"suspended":return e.jsx(da,{});case"removed":return e.jsx(N,{});default:return e.jsx(ue,{})}},Da=()=>{var V,G,H;const{enqueueSnackbar:i}=xa(),{data:c,loading:ve,error:pe}=ma(),{data:h,loading:be,error:fe}=ha(),{loading:ye,error:Se}=ua(),[Ce,v]=x.useState(!1),[Me,T]=x.useState(!1),[Ie,y]=x.useState(!1),[we,S]=x.useState(!1),[W,O]=x.useState(""),[L,z]=x.useState("member"),[De,P]=x.useState(""),[n,k]=x.useState(null),[U,$]=x.useState(null),[E,B]=x.useState(0),Ae=ve||be||ye,Te=pe||fe||Se,t=x.useMemo(()=>{var _,J,K,Y,Z,Q,X,ee,ae,se,te;if(!c||!h)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}};const a=((J=(_=h.organization)==null?void 0:_.usage)==null?void 0:J.totalUsers)||1,u=((Y=(K=h.subscription)==null?void 0:K.plan)==null?void 0:Y.seats)||1,p=[{id:c.id,firstName:((Z=c.name)==null?void 0:Z.split(" ")[0])||"User",lastName:((Q=c.name)==null?void 0:Q.split(" ").slice(1).join(" "))||"",email:c.email,role:"owner",status:"active",joinedAt:((X=c.createdAt)==null?void 0:X.toISOString())||new Date().toISOString(),lastActive:new Date().toISOString(),licenseAssigned:((ee=c.license)==null?void 0:ee.type)||"BASIC",licenseType:((ae=c.license)==null?void 0:ae.status)==="ACTIVE"?"PRO":"BASIC",department:"Management",avatar:void 0}];for(let m=1;m<a;m++){const ne=["admin","member","viewer","manager"],re=["active","pending"],ie=["Engineering","Design","Marketing","Sales","Support"];p.push({id:`member_${m}`,firstName:"Team",lastName:`Member ${m}`,email:`member${m}@${((te=(se=h.organization)==null?void 0:se.name)==null?void 0:te.toLowerCase().replace(/\s+/g,""))||"company"}.com`,role:ne[Math.floor(Math.random()*ne.length)],status:re[Math.floor(Math.random()*re.length)],joinedAt:new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString(),lastActive:new Date(Date.now()-Math.random()*7*24*60*60*1e3).toISOString(),licenseAssigned:`LIC-${Math.random().toString(36).substr(2,8).toUpperCase()}`,licenseType:Math.random()>.5?"PRO":"BASIC",department:ie[Math.floor(Math.random()*ie.length)]})}const q=p.filter(m=>m.status==="active").length,ze=p.filter(m=>m.status==="pending").length,Pe={totalMembers:p.length,activeMembers:q,pendingInvites:ze,availableSeats:Math.max(0,u-q),totalSeats:u};return{members:p,stats:Pe}},[c,h]),We=(a,u)=>{k(u),$(a.currentTarget)},C=()=>{$(null),k(null)},ke=async()=>{if(!W.trim()){i("Please enter an email address",{variant:"error"});return}if(t.stats.availableSeats<=0){i("No available seats. Please upgrade your plan.",{variant:"error"});return}try{i(`Invitation sent to ${W}`,{variant:"success"}),O(""),z("member"),P(""),v(!1)}catch(a){i((a==null?void 0:a.message)||"Failed to send invitation",{variant:"error"})}},Ee=()=>{n&&(T(!0),C())},Re=()=>{n&&(y(!0),C())},Ne=async()=>{if(n)try{i(`${n.firstName} ${n.lastName} has been removed from the team`,{variant:"success"}),y(!1),k(null)}catch(a){i((a==null?void 0:a.message)||"Failed to remove team member",{variant:"error"})}},Oe=()=>{n&&(i(`Invitation resent to ${n.email}`,{variant:"success"}),C())},F=()=>{B(t.stats.totalSeats),S(!0)},Le=async()=>{try{i(`Seat allocation updated to ${E} seats`,{variant:"success"}),S(!1)}catch(a){i((a==null?void 0:a.message)||"Failed to update seat allocation",{variant:"error"})}};return Ae?e.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(r,{textAlign:"center",children:[e.jsx(Ue,{size:60}),e.jsx(s,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):Te?e.jsx(r,{sx:{p:3},children:e.jsxs(j,{severity:"error",children:[e.jsx(R,{children:"Unable to Load Team Data"}),e.jsx(s,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs($e,{dense:!0,children:[e.jsxs(le,{children:[e.jsx(b,{children:e.jsx(Be,{fontSize:"small"})}),e.jsx(oe,{primary:"Network connectivity issues"})]}),e.jsxs(le,{children:[e.jsx(b,{children:e.jsx(Fe,{fontSize:"small"})}),e.jsx(oe,{primary:"Authentication token expired"})]})]}),e.jsx(r,{sx:{mt:2},children:e.jsx(o,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!c||!h?e.jsx(r,{sx:{p:3},children:e.jsxs(j,{severity:"info",children:[e.jsx(R,{children:"Setting Up Team Management"}),e.jsx(s,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(r,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(r,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(s,{variant:"body1",color:"text.secondary",children:["Manage your ",((V=h.organization)==null?void 0:V.name)||"Organization"," team members and permissions"]})]}),e.jsx(o,{variant:"contained",startIcon:e.jsx(Ve,{}),onClick:()=>v(!0),disabled:t.stats.availableSeats<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(f,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(f,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Total Members",value:t.stats.totalMembers,icon:e.jsx(ue,{}),color:"primary"})}),e.jsx(f,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Active Members",value:t.stats.activeMembers,icon:e.jsx(je,{}),color:"success"})}),e.jsx(f,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Pending Invites",value:t.stats.pendingInvites,icon:e.jsx(ge,{}),color:"warning"})}),e.jsx(f,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Available Seats",value:`${t.stats.availableSeats}/${t.stats.totalSeats}`,icon:e.jsx(Ge,{}),color:"primary"})})]}),t.stats.availableSeats<=0&&e.jsxs(j,{severity:"warning",sx:{mb:4},children:[e.jsx(R,{children:"No Available Seats"}),e.jsx(s,{variant:"body2",sx:{mb:2},children:"You've reached your seat limit. Upgrade your plan or manage existing seats to invite new members."}),e.jsxs(r,{sx:{display:"flex",gap:2},children:[e.jsx(o,{variant:"outlined",size:"small",onClick:F,children:"Manage Seats"}),e.jsx(o,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(He,{children:e.jsxs(qe,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",t.members.length,")"]}),e.jsx(o,{variant:"outlined",startIcon:e.jsx(_e,{}),onClick:F,children:"Manage Seats"})]}),e.jsx(Je,{children:e.jsxs(Ke,{children:[e.jsx(Ye,{children:e.jsxs(ce,{children:[e.jsx(l,{sx:{fontWeight:600},children:"Member"}),e.jsx(l,{sx:{fontWeight:600},children:"Role"}),e.jsx(l,{sx:{fontWeight:600},children:"Status"}),e.jsx(l,{sx:{fontWeight:600},children:"Department"}),e.jsx(l,{sx:{fontWeight:600},children:"License"}),e.jsx(l,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(l,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Ze,{children:t.members.map(a=>e.jsxs(ce,{hover:!0,children:[e.jsx(l,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(Qe,{src:a.avatar,sx:{width:40,height:40},children:[a.firstName.charAt(0),a.lastName.charAt(0)]}),e.jsxs(r,{children:[e.jsxs(s,{variant:"body1",sx:{fontWeight:500},children:[a.firstName," ",a.lastName]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:a.email})]})]})}),e.jsx(l,{children:e.jsx(de,{label:a.role.toUpperCase(),color:ja(a.role),size:"small",icon:a.role==="admin"?e.jsx(Xe,{}):void 0})}),e.jsx(l,{children:e.jsx(de,{icon:va(a.status),label:a.status.toUpperCase(),color:ga(a.status),size:"small"})}),e.jsx(l,{children:e.jsx(s,{variant:"body2",children:a.department||"Unassigned"})}),e.jsx(l,{children:e.jsxs(r,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:a.licenseType||"None"}),a.licenseAssigned&&e.jsxs(s,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[a.licenseAssigned.substring(0,12),"..."]})]})}),e.jsx(l,{children:e.jsx(s,{variant:"body2",color:"text.secondary",children:new Date(a.lastActive).toLocaleDateString()})}),e.jsx(l,{children:e.jsx(ea,{size:"small",onClick:u=>We(u,a),disabled:a.role==="owner"&&a.id===c.id,children:e.jsx(aa,{})})})]},a.id))})]})})]})}),e.jsx(sa,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>v(!0),disabled:t.stats.availableSeats<=0,children:e.jsx(ta,{})}),e.jsxs(M,{open:Ce,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(I,{children:"Invite Team Member"}),e.jsx(w,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(g,{fullWidth:!0,label:"Email Address",type:"email",value:W,onChange:a=>O(a.target.value),placeholder:"colleague@company.com"}),e.jsxs(xe,{fullWidth:!0,children:[e.jsx(me,{children:"Role"}),e.jsxs(he,{value:L,label:"Role",onChange:a=>z(a.target.value),children:[e.jsx(d,{value:"viewer",children:"Viewer - Read-only access"}),e.jsx(d,{value:"member",children:"Member - Standard access"}),e.jsx(d,{value:"manager",children:"Manager - Team management"}),e.jsx(d,{value:"admin",children:"Admin - Full access"})]})]}),e.jsx(g,{fullWidth:!0,label:"Department (Optional)",value:De,onChange:a=>P(a.target.value),placeholder:"Engineering, Design, Marketing..."}),e.jsx(j,{severity:"info",children:e.jsxs(s,{variant:"body2",children:["The invited member will receive an email with instructions to join your organization. They will be assigned a ",L==="admin"?"PRO":"BASIC"," license automatically."]})})]})}),e.jsxs(D,{children:[e.jsx(o,{onClick:()=>v(!1),children:"Cancel"}),e.jsx(o,{onClick:ke,variant:"contained",startIcon:e.jsx(na,{}),children:"Send Invitation"})]})]}),e.jsxs(M,{open:Me,onClose:()=>T(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(I,{children:"Edit Team Member"}),e.jsx(w,{children:n&&e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(g,{fullWidth:!0,label:"First Name",defaultValue:n.firstName}),e.jsx(g,{fullWidth:!0,label:"Last Name",defaultValue:n.lastName}),e.jsxs(xe,{fullWidth:!0,children:[e.jsx(me,{children:"Role"}),e.jsxs(he,{defaultValue:n.role,label:"Role",children:[e.jsx(d,{value:"viewer",children:"Viewer"}),e.jsx(d,{value:"member",children:"Member"}),e.jsx(d,{value:"manager",children:"Manager"}),e.jsx(d,{value:"admin",children:"Admin"})]})]}),e.jsx(g,{fullWidth:!0,label:"Department",defaultValue:n.department})]})}),e.jsxs(D,{children:[e.jsx(o,{onClick:()=>T(!1),children:"Cancel"}),e.jsx(o,{variant:"contained",children:"Save Changes"})]})]}),e.jsxs(M,{open:Ie,onClose:()=>y(!1),maxWidth:"sm",children:[e.jsx(I,{children:"Remove Team Member"}),e.jsx(w,{children:n&&e.jsxs(r,{children:[e.jsxs(s,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsxs("strong",{children:[n.firstName," ",n.lastName]})," from your team?"]}),e.jsx(j,{severity:"warning",children:e.jsx(s,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources. Their license will be freed up for reassignment."})})]})}),e.jsxs(D,{children:[e.jsx(o,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(o,{onClick:Ne,variant:"contained",color:"error",startIcon:e.jsx(N,{}),children:"Remove Member"})]})]}),e.jsxs(M,{open:we,onClose:()=>S(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(I,{children:"Manage Seat Allocation"}),e.jsx(w,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(r,{children:[e.jsxs(s,{variant:"body1",sx:{mb:2},children:["Current Plan: ",e.jsx("strong",{children:((H=(G=h.subscription)==null?void 0:G.plan)==null?void 0:H.tier)||"PRO"})]}),e.jsx(ra,{variant:"determinate",value:t.stats.activeMembers/t.stats.totalSeats*100,sx:{height:8,borderRadius:4,mb:1}}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[t.stats.activeMembers," of ",t.stats.totalSeats," seats used"]})]}),e.jsx(g,{fullWidth:!0,label:"Total Seats",type:"number",value:E,onChange:a=>B(parseInt(a.target.value)||0),inputProps:{min:t.stats.activeMembers,max:100},helperText:`Minimum: ${t.stats.activeMembers} (current active members)`}),e.jsx(j,{severity:"info",children:e.jsx(s,{variant:"body2",children:"Increasing seats will update your billing. Decreasing seats below active members will require removing members first."})})]})}),e.jsxs(D,{children:[e.jsx(o,{onClick:()=>S(!1),children:"Cancel"}),e.jsx(o,{onClick:Le,variant:"contained",disabled:E<t.stats.activeMembers,children:"Update Seats"})]})]}),e.jsxs(ia,{anchorEl:U,open:!!U,onClose:C,children:[e.jsxs(d,{onClick:Ee,children:[e.jsx(b,{children:e.jsx(la,{})}),"Edit Member"]}),(n==null?void 0:n.status)==="pending"&&e.jsxs(d,{onClick:Oe,children:[e.jsx(b,{children:e.jsx(oa,{})}),"Resend Invite"]}),e.jsx(ca,{}),e.jsxs(d,{onClick:Re,sx:{color:"error.main"},children:[e.jsx(b,{children:e.jsx(N,{sx:{color:"error.main"}})}),"Remove Member"]})]})]})};export{Da as default};
