import{j as e,B as i,C as Pe,T as s,d as g,ai as O,w as Be,x as re,y,aj as $e,z as le,H as qe,a as d,aG as Ue,G as C,W as ue,p as je,am as ge,u as Ge,t as He,v as Ke,aX as Ve,aq as Ye,ar as Xe,as as _e,at as oe,au as o,av as Je,ag as Qe,r as ce,aY as Ze,g as ea,aw as aa,ax as sa,ap as ta,ay as D,az as k,aB as W,e as p,aC as de,aD as me,aE as xe,a5 as m,aF as A,n as na,aI as he,aH as P,i as ia,a4 as ra,E as la,D as oa,aK as ca}from"./mui-BN540ctE.js";import{r as l}from"./vendor-CjD1bmmO.js";import{u as da}from"./notistack.esm-Ca-E78ev.js";import{u as ma,a as xa,c as ha,j as ua,k as ja,l as ga,m as va}from"./useStreamlinedData-CzHPPLA-.js";import{M as E}from"./MetricCard-D6gfkAIi.js";import"./UnifiedDataService-BaFOuxm7.js";import"./index-CHgXrSvL.js";import"./stripe-C-GNnApq.js";import"./index.esm-DonjM_pP.js";import"./index.esm-D7ujsXeY.js";const pa=r=>{switch(r){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},ba=r=>{switch(r){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},fa=r=>{switch(r){case"active":return e.jsx(je,{});case"pending":return e.jsx(ge,{});case"suspended":return e.jsx(ca,{});case"removed":return e.jsx(P,{});default:return e.jsx(ue,{})}},Aa=()=>{var ae,se,te;const{enqueueSnackbar:r}=da(),{data:c,loading:ve,error:pe}=ma(),{data:v,loading:be,error:fe}=xa(),{data:u,loading:ye,error:Ce,refetch:B}=ha(),Se=ua(),Me=ja();ga(),va();const[Ie,b]=l.useState(!1),[Te,S]=l.useState(!1),[we,M]=l.useState(!1),[De,I]=l.useState(!1),[f,$]=l.useState(""),[N,q]=l.useState("member"),[U,G]=l.useState(""),[t,T]=l.useState(null),[H,K]=l.useState(null),[R,V]=l.useState(0),[z,Y]=l.useState(""),[L,X]=l.useState(""),[_,J]=l.useState("member"),[Q,Z]=l.useState(""),ke=ve||be||ye,We=pe||fe||Ce,n=l.useMemo(()=>{var ne,ie;if(!c||!v||!u)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}};const a=((ie=(ne=v.subscription)==null?void 0:ne.plan)==null?void 0:ie.seats)||1,x=u.filter(F=>F.status==="active").length,j=u.filter(F=>F.status==="pending").length,h={totalMembers:u.length,activeMembers:x,pendingInvites:j,availableSeats:Math.max(0,a-u.length),totalSeats:a};return{members:u,stats:h}},[c,v,u]),Ae=(a,x)=>{T(x),K(a.currentTarget)},w=()=>{K(null),T(null)},Ee=async()=>{var a,x,j;if(!f.trim()){r("Please enter an email address",{variant:"error"});return}if(n.stats.availableSeats<=0){r("No available seats. Please upgrade your plan.",{variant:"error"});return}try{const h={firstName:f.split("@")[0],lastName:"",email:f,role:N,status:"pending",organization:{id:((a=c==null?void 0:c.organization)==null?void 0:a.id)||"",name:((x=c==null?void 0:c.organization)==null?void 0:x.name)||"",tier:((j=c==null?void 0:c.organization)==null?void 0:j.tier)||"BASIC"},department:U||void 0,assignedProjects:[]};await Se.mutate(h),r(`Invitation sent to ${f}`,{variant:"success"}),$(""),q("member"),G(""),b(!1),B()}catch(h){r((h==null?void 0:h.message)||"Failed to send invitation",{variant:"error"})}},Ne=()=>{t&&(Y(t.firstName||""),X(t.lastName||""),J(t.role||"member"),Z(t.department||""),S(!0),w())},Re=()=>{t&&(M(!0),w())},ze=async()=>{if(t)try{r(`${t.firstName} ${t.lastName} has been removed from the team`,{variant:"success"}),M(!1),T(null)}catch(a){r((a==null?void 0:a.message)||"Failed to remove team member",{variant:"error"})}},Le=()=>{t&&(r(`Invitation resent to ${t.email}`,{variant:"success"}),w())},ee=()=>{V(n.stats.totalSeats),I(!0)},Fe=async()=>{try{r(`Seat allocation updated to ${R} seats`,{variant:"success"}),I(!1)}catch(a){r((a==null?void 0:a.message)||"Failed to update seat allocation",{variant:"error"})}},Oe=async()=>{if(t)try{await Me.mutate({memberId:t.id,updates:{firstName:z,lastName:L,role:_,department:Q}}),r(`Team member ${z} ${L} updated successfully`,{variant:"success"}),S(!1),T(null),B()}catch(a){r((a==null?void 0:a.message)||"Failed to update team member",{variant:"error"})}};return ke?e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(i,{textAlign:"center",children:[e.jsx(Pe,{size:60}),e.jsx(s,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):We?e.jsx(i,{sx:{p:3},children:e.jsxs(g,{severity:"error",children:[e.jsx(O,{children:"Unable to Load Team Data"}),e.jsx(s,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs(Be,{dense:!0,children:[e.jsxs(re,{children:[e.jsx(y,{children:e.jsx($e,{fontSize:"small"})}),e.jsx(le,{primary:"Network connectivity issues"})]}),e.jsxs(re,{children:[e.jsx(y,{children:e.jsx(qe,{fontSize:"small"})}),e.jsx(le,{primary:"Authentication token expired"})]})]}),e.jsx(i,{sx:{mt:2},children:e.jsx(d,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!c||!v?e.jsx(i,{sx:{p:3},children:e.jsxs(g,{severity:"info",children:[e.jsx(O,{children:"Setting Up Team Management"}),e.jsx(s,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(i,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(s,{variant:"body1",color:"text.secondary",children:["Manage your ",((ae=v.organization)==null?void 0:ae.name)||"Organization"," team members and permissions"]})]}),e.jsx(d,{variant:"contained",startIcon:e.jsx(Ue,{}),onClick:()=>b(!0),disabled:n.stats.availableSeats<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(C,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(E,{title:"Total Members",value:n.stats.totalMembers,icon:e.jsx(ue,{}),color:"primary"})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(E,{title:"Active Members",value:n.stats.activeMembers,icon:e.jsx(je,{}),color:"success"})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(E,{title:"Pending Invites",value:n.stats.pendingInvites,icon:e.jsx(ge,{}),color:"warning"})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(E,{title:"Available Seats",value:`${n.stats.availableSeats}/${n.stats.totalSeats}`,icon:e.jsx(Ge,{}),color:"primary"})})]}),n.stats.availableSeats<=0&&e.jsxs(g,{severity:"warning",sx:{mb:4},children:[e.jsx(O,{children:"No Available Seats"}),e.jsx(s,{variant:"body2",sx:{mb:2},children:"You've reached your seat limit. Upgrade your plan or manage existing seats to invite new members."}),e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsx(d,{variant:"outlined",size:"small",onClick:ee,children:"Manage Seats"}),e.jsx(d,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(He,{children:e.jsxs(Ke,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",n.members.length,")"]}),e.jsx(d,{variant:"outlined",startIcon:e.jsx(Ve,{}),onClick:ee,children:"Manage Seats"})]}),e.jsx(Ye,{children:e.jsxs(Xe,{children:[e.jsx(_e,{children:e.jsxs(oe,{children:[e.jsx(o,{sx:{fontWeight:600},children:"Member"}),e.jsx(o,{sx:{fontWeight:600},children:"Role"}),e.jsx(o,{sx:{fontWeight:600},children:"Status"}),e.jsx(o,{sx:{fontWeight:600},children:"Department"}),e.jsx(o,{sx:{fontWeight:600},children:"License"}),e.jsx(o,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(o,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Je,{children:n.members.map(a=>{var x,j;return e.jsxs(oe,{hover:!0,children:[e.jsx(o,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(Qe,{src:a.avatar,sx:{width:40,height:40},children:[a.firstName.charAt(0),a.lastName.charAt(0)]}),e.jsxs(i,{children:[e.jsxs(s,{variant:"body1",sx:{fontWeight:500},children:[a.firstName," ",a.lastName]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:a.email})]})]})}),e.jsx(o,{children:e.jsx(ce,{label:a.role.toUpperCase(),color:pa(a.role),size:"small",icon:a.role==="admin"?e.jsx(Ze,{}):void 0})}),e.jsx(o,{children:e.jsx(ce,{icon:fa(a.status),label:a.status.toUpperCase(),color:ba(a.status),size:"small"})}),e.jsx(o,{children:e.jsx(s,{variant:"body2",children:a.department||"Unassigned"})}),e.jsx(o,{children:e.jsxs(i,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:((x=a.licenseAssignment)==null?void 0:x.licenseType)||"None"}),((j=a.licenseAssignment)==null?void 0:j.licenseKey)&&e.jsxs(s,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[a.licenseAssignment.licenseKey.substring(0,12),"..."]})]})}),e.jsx(o,{children:e.jsx(s,{variant:"body2",color:"text.secondary",children:a.lastActive?new Date(a.lastActive).toLocaleDateString():"Never"})}),e.jsx(o,{children:e.jsx(ea,{size:"small",onClick:h=>Ae(h,a),disabled:a.role==="owner"&&a.id===c.id,children:e.jsx(aa,{})})})]},a.id)})})]})})]})}),e.jsx(sa,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>b(!0),disabled:n.stats.availableSeats<=0,children:e.jsx(ta,{})}),e.jsxs(D,{open:Ie,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(k,{children:"Invite Team Member"}),e.jsx(W,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(p,{fullWidth:!0,label:"Email Address",type:"email",value:f,onChange:a=>$(a.target.value),placeholder:"colleague@company.com"}),e.jsxs(de,{fullWidth:!0,children:[e.jsx(me,{children:"Role"}),e.jsxs(xe,{value:N,label:"Role",onChange:a=>q(a.target.value),children:[e.jsx(m,{value:"viewer",children:"Viewer - Read-only access"}),e.jsx(m,{value:"member",children:"Member - Standard access"}),e.jsx(m,{value:"manager",children:"Manager - Team management"}),e.jsx(m,{value:"admin",children:"Admin - Full access"})]})]}),e.jsx(p,{fullWidth:!0,label:"Department (Optional)",value:U,onChange:a=>G(a.target.value),placeholder:"Engineering, Design, Marketing..."}),e.jsx(g,{severity:"info",children:e.jsxs(s,{variant:"body2",children:["The invited member will receive an email with instructions to join your organization. They will be assigned a ",N==="admin"?"PRO":"BASIC"," license automatically."]})})]})}),e.jsxs(A,{children:[e.jsx(d,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(d,{onClick:Ee,variant:"contained",startIcon:e.jsx(na,{}),children:"Send Invitation"})]})]}),e.jsxs(D,{open:Te,onClose:()=>S(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(k,{children:"Edit Team Member"}),e.jsx(W,{children:t&&e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(p,{fullWidth:!0,label:"First Name",value:z,onChange:a=>Y(a.target.value),required:!0}),e.jsx(p,{fullWidth:!0,label:"Last Name",value:L,onChange:a=>X(a.target.value),required:!0}),e.jsxs(de,{fullWidth:!0,children:[e.jsx(me,{children:"Role"}),e.jsxs(xe,{value:_,label:"Role",onChange:a=>J(a.target.value),children:[e.jsx(m,{value:"viewer",children:"Viewer - Read-only access"}),e.jsx(m,{value:"member",children:"Member - Standard access"}),e.jsx(m,{value:"manager",children:"Manager - Team management"}),e.jsx(m,{value:"admin",children:"Admin - Full access"})]})]}),e.jsx(p,{fullWidth:!0,label:"Department",value:Q,onChange:a=>Z(a.target.value),placeholder:"Engineering, Design, Marketing..."}),e.jsx(g,{severity:"info",children:e.jsx(s,{variant:"body2",children:"Role changes will immediately affect the member's permissions and access levels. Department information helps with organization and project assignments."})})]})}),e.jsxs(A,{children:[e.jsx(d,{onClick:()=>S(!1),children:"Cancel"}),e.jsx(d,{onClick:Oe,variant:"contained",startIcon:e.jsx(he,{}),children:"Save Changes"})]})]}),e.jsxs(D,{open:we,onClose:()=>M(!1),maxWidth:"sm",children:[e.jsx(k,{children:"Remove Team Member"}),e.jsx(W,{children:t&&e.jsxs(i,{children:[e.jsxs(s,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsxs("strong",{children:[t.firstName," ",t.lastName]})," from your team?"]}),e.jsx(g,{severity:"warning",children:e.jsx(s,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources. Their license will be freed up for reassignment."})})]})}),e.jsxs(A,{children:[e.jsx(d,{onClick:()=>M(!1),children:"Cancel"}),e.jsx(d,{onClick:ze,variant:"contained",color:"error",startIcon:e.jsx(P,{}),children:"Remove Member"})]})]}),e.jsxs(D,{open:De,onClose:()=>I(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(k,{children:"Manage Seat Allocation"}),e.jsx(W,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(i,{children:[e.jsxs(s,{variant:"body1",sx:{mb:2},children:["Current Plan: ",e.jsx("strong",{children:((te=(se=v.subscription)==null?void 0:se.plan)==null?void 0:te.tier)||"PRO"})]}),e.jsx(ia,{variant:"determinate",value:n.stats.activeMembers/n.stats.totalSeats*100,sx:{height:8,borderRadius:4,mb:1}}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[n.stats.activeMembers," of ",n.stats.totalSeats," seats used"]})]}),e.jsx(p,{fullWidth:!0,label:"Total Seats",type:"number",value:R,onChange:a=>V(parseInt(a.target.value)||0),inputProps:{min:n.stats.activeMembers,max:100},helperText:`Minimum: ${n.stats.activeMembers} (current active members)`}),e.jsx(g,{severity:"info",children:e.jsx(s,{variant:"body2",children:"Increasing seats will update your billing. Decreasing seats below active members will require removing members first."})})]})}),e.jsxs(A,{children:[e.jsx(d,{onClick:()=>I(!1),children:"Cancel"}),e.jsx(d,{onClick:Fe,variant:"contained",disabled:R<n.stats.activeMembers,children:"Update Seats"})]})]}),e.jsxs(ra,{anchorEl:H,open:!!H,onClose:w,children:[e.jsxs(m,{onClick:Ne,children:[e.jsx(y,{children:e.jsx(he,{})}),"Edit Member"]}),(t==null?void 0:t.status)==="pending"&&e.jsxs(m,{onClick:Le,children:[e.jsx(y,{children:e.jsx(la,{})}),"Resend Invite"]}),e.jsx(oa,{}),e.jsxs(m,{onClick:Re,sx:{color:"error.main"},children:[e.jsx(y,{children:e.jsx(P,{sx:{color:"error.main"}})}),"Remove Member"]})]})]})};export{Aa as default};
