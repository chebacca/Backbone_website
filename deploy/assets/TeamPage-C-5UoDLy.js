import{j as e,B as i,C as De,T as s,d as v,ai as L,w as We,x as _,y,aj as Ae,z as Q,H as ke,a as c,aG as Re,G as C,W as ne,p as ie,am as re,u as ze,t as Ee,v as Ne,aX as Le,aq as Oe,ar as Pe,as as Be,at as Z,au as l,av as Fe,ag as $e,r as ee,aY as Ve,g as Ue,aw as Ge,ax as He,ap as qe,ay as T,az as w,aA as D,e as p,aB as ae,aC as se,aD as te,a5 as d,aE as W,n as Ke,aH as O,i as Ye,a4 as Je,aJ as Xe,E as _e,D as Qe,aK as Ze}from"./mui-Dvh35qVf.js";import{r as x}from"./vendor-CjD1bmmO.js";import{u as ea}from"./notistack.esm-Ca-E78ev.js";import{u as aa,a as sa,c as ta,j as na,k as ia,l as ra,m as la}from"./useStreamlinedData-rbihFre0.js";import{M as A}from"./MetricCard-C5FutAvg.js";import"./UnifiedDataService-CFYGaazL.js";import"./index-BbJter-q.js";import"./stripe-CbtnRl6i.js";import"./index.esm-DonjM_pP.js";import"./index.esm-D7ujsXeY.js";const oa=r=>{switch(r){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},ca=r=>{switch(r){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},da=r=>{switch(r){case"active":return e.jsx(ie,{});case"pending":return e.jsx(re,{});case"suspended":return e.jsx(Ze,{});case"removed":return e.jsx(O,{});default:return e.jsx(ne,{})}},ya=()=>{var q,K,Y;const{enqueueSnackbar:r}=ea(),{data:o,loading:le,error:oe}=aa(),{data:g,loading:ce,error:de}=sa(),{data:u,loading:xe,error:me,refetch:he}=ta(),ue=na();ia(),ra(),la();const[je,b]=x.useState(!1),[ge,k]=x.useState(!1),[ve,S]=x.useState(!1),[pe,M]=x.useState(!1),[f,P]=x.useState(""),[R,B]=x.useState("member"),[F,$]=x.useState(""),[n,z]=x.useState(null),[V,U]=x.useState(null),[E,G]=x.useState(0),be=le||ce||xe,fe=oe||de||me,t=x.useMemo(()=>{var J,X;if(!o||!g||!u)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}};const a=((X=(J=g.subscription)==null?void 0:J.plan)==null?void 0:X.seats)||1,m=u.filter(N=>N.status==="active").length,j=u.filter(N=>N.status==="pending").length,h={totalMembers:u.length,activeMembers:m,pendingInvites:j,availableSeats:Math.max(0,a-u.length),totalSeats:a};return{members:u,stats:h}},[o,g,u]),ye=(a,m)=>{z(m),U(a.currentTarget)},I=()=>{U(null),z(null)},Ce=async()=>{var a,m,j;if(!f.trim()){r("Please enter an email address",{variant:"error"});return}if(t.stats.availableSeats<=0){r("No available seats. Please upgrade your plan.",{variant:"error"});return}try{const h={firstName:f.split("@")[0],lastName:"",email:f,role:R,status:"pending",organization:{id:((a=o==null?void 0:o.organization)==null?void 0:a.id)||"",name:((m=o==null?void 0:o.organization)==null?void 0:m.name)||"",tier:((j=o==null?void 0:o.organization)==null?void 0:j.tier)||"BASIC"},department:F||void 0,assignedProjects:[]};await ue.mutate(h),r(`Invitation sent to ${f}`,{variant:"success"}),P(""),B("member"),$(""),b(!1),he()}catch(h){r((h==null?void 0:h.message)||"Failed to send invitation",{variant:"error"})}},Se=()=>{n&&(k(!0),I())},Me=()=>{n&&(S(!0),I())},Ie=async()=>{if(n)try{r(`${n.firstName} ${n.lastName} has been removed from the team`,{variant:"success"}),S(!1),z(null)}catch(a){r((a==null?void 0:a.message)||"Failed to remove team member",{variant:"error"})}},Te=()=>{n&&(r(`Invitation resent to ${n.email}`,{variant:"success"}),I())},H=()=>{G(t.stats.totalSeats),M(!0)},we=async()=>{try{r(`Seat allocation updated to ${E} seats`,{variant:"success"}),M(!1)}catch(a){r((a==null?void 0:a.message)||"Failed to update seat allocation",{variant:"error"})}};return be?e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(i,{textAlign:"center",children:[e.jsx(De,{size:60}),e.jsx(s,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):fe?e.jsx(i,{sx:{p:3},children:e.jsxs(v,{severity:"error",children:[e.jsx(L,{children:"Unable to Load Team Data"}),e.jsx(s,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs(We,{dense:!0,children:[e.jsxs(_,{children:[e.jsx(y,{children:e.jsx(Ae,{fontSize:"small"})}),e.jsx(Q,{primary:"Network connectivity issues"})]}),e.jsxs(_,{children:[e.jsx(y,{children:e.jsx(ke,{fontSize:"small"})}),e.jsx(Q,{primary:"Authentication token expired"})]})]}),e.jsx(i,{sx:{mt:2},children:e.jsx(c,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!o||!g?e.jsx(i,{sx:{p:3},children:e.jsxs(v,{severity:"info",children:[e.jsx(L,{children:"Setting Up Team Management"}),e.jsx(s,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(i,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(i,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(s,{variant:"body1",color:"text.secondary",children:["Manage your ",((q=g.organization)==null?void 0:q.name)||"Organization"," team members and permissions"]})]}),e.jsx(c,{variant:"contained",startIcon:e.jsx(Re,{}),onClick:()=>b(!0),disabled:t.stats.availableSeats<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(C,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Total Members",value:t.stats.totalMembers,icon:e.jsx(ne,{}),color:"primary"})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Active Members",value:t.stats.activeMembers,icon:e.jsx(ie,{}),color:"success"})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Pending Invites",value:t.stats.pendingInvites,icon:e.jsx(re,{}),color:"warning"})}),e.jsx(C,{item:!0,xs:12,sm:6,md:3,children:e.jsx(A,{title:"Available Seats",value:`${t.stats.availableSeats}/${t.stats.totalSeats}`,icon:e.jsx(ze,{}),color:"primary"})})]}),t.stats.availableSeats<=0&&e.jsxs(v,{severity:"warning",sx:{mb:4},children:[e.jsx(L,{children:"No Available Seats"}),e.jsx(s,{variant:"body2",sx:{mb:2},children:"You've reached your seat limit. Upgrade your plan or manage existing seats to invite new members."}),e.jsxs(i,{sx:{display:"flex",gap:2},children:[e.jsx(c,{variant:"outlined",size:"small",onClick:H,children:"Manage Seats"}),e.jsx(c,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(Ee,{children:e.jsxs(Ne,{children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",t.members.length,")"]}),e.jsx(c,{variant:"outlined",startIcon:e.jsx(Le,{}),onClick:H,children:"Manage Seats"})]}),e.jsx(Oe,{children:e.jsxs(Pe,{children:[e.jsx(Be,{children:e.jsxs(Z,{children:[e.jsx(l,{sx:{fontWeight:600},children:"Member"}),e.jsx(l,{sx:{fontWeight:600},children:"Role"}),e.jsx(l,{sx:{fontWeight:600},children:"Status"}),e.jsx(l,{sx:{fontWeight:600},children:"Department"}),e.jsx(l,{sx:{fontWeight:600},children:"License"}),e.jsx(l,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(l,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Fe,{children:t.members.map(a=>{var m,j;return e.jsxs(Z,{hover:!0,children:[e.jsx(l,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs($e,{src:a.avatar,sx:{width:40,height:40},children:[a.firstName.charAt(0),a.lastName.charAt(0)]}),e.jsxs(i,{children:[e.jsxs(s,{variant:"body1",sx:{fontWeight:500},children:[a.firstName," ",a.lastName]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:a.email})]})]})}),e.jsx(l,{children:e.jsx(ee,{label:a.role.toUpperCase(),color:oa(a.role),size:"small",icon:a.role==="admin"?e.jsx(Ve,{}):void 0})}),e.jsx(l,{children:e.jsx(ee,{icon:da(a.status),label:a.status.toUpperCase(),color:ca(a.status),size:"small"})}),e.jsx(l,{children:e.jsx(s,{variant:"body2",children:a.department||"Unassigned"})}),e.jsx(l,{children:e.jsxs(i,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:((m=a.licenseAssignment)==null?void 0:m.licenseType)||"None"}),((j=a.licenseAssignment)==null?void 0:j.licenseKey)&&e.jsxs(s,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[a.licenseAssignment.licenseKey.substring(0,12),"..."]})]})}),e.jsx(l,{children:e.jsx(s,{variant:"body2",color:"text.secondary",children:a.lastActive?new Date(a.lastActive).toLocaleDateString():"Never"})}),e.jsx(l,{children:e.jsx(Ue,{size:"small",onClick:h=>ye(h,a),disabled:a.role==="owner"&&a.id===o.id,children:e.jsx(Ge,{})})})]},a.id)})})]})})]})}),e.jsx(He,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>b(!0),disabled:t.stats.availableSeats<=0,children:e.jsx(qe,{})}),e.jsxs(T,{open:je,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(w,{children:"Invite Team Member"}),e.jsx(D,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(p,{fullWidth:!0,label:"Email Address",type:"email",value:f,onChange:a=>P(a.target.value),placeholder:"colleague@company.com"}),e.jsxs(ae,{fullWidth:!0,children:[e.jsx(se,{children:"Role"}),e.jsxs(te,{value:R,label:"Role",onChange:a=>B(a.target.value),children:[e.jsx(d,{value:"viewer",children:"Viewer - Read-only access"}),e.jsx(d,{value:"member",children:"Member - Standard access"}),e.jsx(d,{value:"manager",children:"Manager - Team management"}),e.jsx(d,{value:"admin",children:"Admin - Full access"})]})]}),e.jsx(p,{fullWidth:!0,label:"Department (Optional)",value:F,onChange:a=>$(a.target.value),placeholder:"Engineering, Design, Marketing..."}),e.jsx(v,{severity:"info",children:e.jsxs(s,{variant:"body2",children:["The invited member will receive an email with instructions to join your organization. They will be assigned a ",R==="admin"?"PRO":"BASIC"," license automatically."]})})]})}),e.jsxs(W,{children:[e.jsx(c,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(c,{onClick:Ce,variant:"contained",startIcon:e.jsx(Ke,{}),children:"Send Invitation"})]})]}),e.jsxs(T,{open:ge,onClose:()=>k(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(w,{children:"Edit Team Member"}),e.jsx(D,{children:n&&e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(p,{fullWidth:!0,label:"First Name",defaultValue:n.firstName}),e.jsx(p,{fullWidth:!0,label:"Last Name",defaultValue:n.lastName}),e.jsxs(ae,{fullWidth:!0,children:[e.jsx(se,{children:"Role"}),e.jsxs(te,{defaultValue:n.role,label:"Role",children:[e.jsx(d,{value:"viewer",children:"Viewer"}),e.jsx(d,{value:"member",children:"Member"}),e.jsx(d,{value:"manager",children:"Manager"}),e.jsx(d,{value:"admin",children:"Admin"})]})]}),e.jsx(p,{fullWidth:!0,label:"Department",defaultValue:n.department})]})}),e.jsxs(W,{children:[e.jsx(c,{onClick:()=>k(!1),children:"Cancel"}),e.jsx(c,{variant:"contained",children:"Save Changes"})]})]}),e.jsxs(T,{open:ve,onClose:()=>S(!1),maxWidth:"sm",children:[e.jsx(w,{children:"Remove Team Member"}),e.jsx(D,{children:n&&e.jsxs(i,{children:[e.jsxs(s,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsxs("strong",{children:[n.firstName," ",n.lastName]})," from your team?"]}),e.jsx(v,{severity:"warning",children:e.jsx(s,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources. Their license will be freed up for reassignment."})})]})}),e.jsxs(W,{children:[e.jsx(c,{onClick:()=>S(!1),children:"Cancel"}),e.jsx(c,{onClick:Ie,variant:"contained",color:"error",startIcon:e.jsx(O,{}),children:"Remove Member"})]})]}),e.jsxs(T,{open:pe,onClose:()=>M(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(w,{children:"Manage Seat Allocation"}),e.jsx(D,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(i,{children:[e.jsxs(s,{variant:"body1",sx:{mb:2},children:["Current Plan: ",e.jsx("strong",{children:((Y=(K=g.subscription)==null?void 0:K.plan)==null?void 0:Y.tier)||"PRO"})]}),e.jsx(Ye,{variant:"determinate",value:t.stats.activeMembers/t.stats.totalSeats*100,sx:{height:8,borderRadius:4,mb:1}}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[t.stats.activeMembers," of ",t.stats.totalSeats," seats used"]})]}),e.jsx(p,{fullWidth:!0,label:"Total Seats",type:"number",value:E,onChange:a=>G(parseInt(a.target.value)||0),inputProps:{min:t.stats.activeMembers,max:100},helperText:`Minimum: ${t.stats.activeMembers} (current active members)`}),e.jsx(v,{severity:"info",children:e.jsx(s,{variant:"body2",children:"Increasing seats will update your billing. Decreasing seats below active members will require removing members first."})})]})}),e.jsxs(W,{children:[e.jsx(c,{onClick:()=>M(!1),children:"Cancel"}),e.jsx(c,{onClick:we,variant:"contained",disabled:E<t.stats.activeMembers,children:"Update Seats"})]})]}),e.jsxs(Je,{anchorEl:V,open:!!V,onClose:I,children:[e.jsxs(d,{onClick:Se,children:[e.jsx(y,{children:e.jsx(Xe,{})}),"Edit Member"]}),(n==null?void 0:n.status)==="pending"&&e.jsxs(d,{onClick:Te,children:[e.jsx(y,{children:e.jsx(_e,{})}),"Resend Invite"]}),e.jsx(Qe,{}),e.jsxs(d,{onClick:Me,sx:{color:"error.main"},children:[e.jsx(y,{children:e.jsx(O,{sx:{color:"error.main"}})}),"Remove Member"]})]})]})};export{ya as default};
