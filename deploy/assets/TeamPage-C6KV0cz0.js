import{j as e,B as t,C as Je,T as a,d as u,ai as ge,w as zs,x as Ye,y as S,aj as Os,z as Ze,H as je,a as h,aG as pe,G as q,W as ce,p as we,am as Ie,u as y,t as $s,v as Gs,aq as Us,ar as qs,as as Bs,at as Qe,au as g,av as Hs,ag as Ks,r as X,aZ as _s,g as Xe,aw as Vs,ax as Js,ap as Ys,ay as ee,az as se,aB as ae,a_ as es,e as d,I as w,a$ as ss,b0 as as,aC as te,aD as ne,aE as re,a5 as m,F as ts,s as ns,R as Zs,aF as ie,aI as ve,aL as Qs,b1 as rs,L as fe,b2 as be,aH as Pe,a4 as Xs,E as ea,D as sa,aJ as aa}from"./mui-Cr9U6iW2.js";import{r as o,b as is}from"./vendor-CjD1bmmO.js";import{u as ta}from"./notistack.esm-Ca-E78ev.js";import{b as na,c as ra,a as ia,u as la,h as oa,j as ca,k as da,l as xa,f as ha,g as ma,m as ua}from"./useStreamlinedData-CZLoG2Wt.js";import{M as le}from"./MetricCard-CCtxyf7i.js";import"./UnifiedDataService-FohLDSMk.js";import"./index-Bb_GMner.js";import"./stripe-ggaMUove.js";import"./index.esm-B4qVkIPL.js";import"./index.esm-DmQE6AXN.js";const P=r=>r.firstName&&r.lastName?`${r.firstName} ${r.lastName}`:r.email,ga=r=>{var p,v,C;const i=((p=r.firstName)==null?void 0:p.charAt(0))||((v=r.email)==null?void 0:v.charAt(0))||"U",j=((C=r.lastName)==null?void 0:C.charAt(0))||"";return i+j},ja=r=>{if(!r)return"default";switch(r){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},pa=r=>{if(!r)return"default";switch(r){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},ls=r=>{if(!r)return e.jsx(ce,{});switch(r){case"active":return e.jsx(we,{});case"pending":return e.jsx(Ie,{});case"suspended":return e.jsx(aa,{});case"removed":return e.jsx(Pe,{});default:return e.jsx(ce,{})}},oe=()=>{const i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let j="";for(let p=0;p<12;p++)j+=i.charAt(Math.floor(Math.random()*i.length));return j},ye=(r,i)=>{var v,C;if(!r||!i)return!1;const j=(v=r.role)==null?void 0:v.toUpperCase(),p=(C=i.role)==null?void 0:C.toUpperCase();return j==="ENTERPRISE_USER"||j==="OWNER"||j==="ADMIN"&&p!=="ENTERPRISE_USER"&&p!=="OWNER"?!0:r.id===i.id},va=(r,i)=>!r.assignedProjects||!i?[]:i.filter(j=>r.assignedProjects.includes(j.id)),Na=()=>{var Ve;const{enqueueSnackbar:r}=ta(),{data:i,loading:j,error:p}=na(),{data:v,loading:C,error:os}=ra(),{data:W,loading:cs,error:ds,refetch:L}=ia(),{data:c,loading:xs,error:hs,refetch:D}=la(),{data:ms,loading:us,error:gs}=oa(),js=ca(),ps=da(),vs=xa(),Ce=ha(),fs=ma(),de=ua(),[bs,z]=o.useState(!1),[ys,B]=o.useState(!1),[ws,H]=o.useState(!1),[Is,K]=o.useState(!1),[xe,Le]=o.useState(""),[O,Te]=o.useState(""),[$,Ae]=o.useState(""),[Ne,Se]=o.useState("member"),[We,De]=o.useState(""),[Ee,Me]=o.useState(""),[ke,Re]=o.useState(""),[he,_]=o.useState(""),[E,Ps]=o.useState(!0),[n,G]=o.useState(void 0),[Fe,ze]=o.useState(null),[M,Oe]=o.useState(""),[V,$e]=o.useState(""),[me,Ge]=o.useState(""),[ue,Ue]=o.useState(""),[qe,Be]=o.useState("member"),[He,Ke]=o.useState(""),[Cs,J]=o.useState(!1),[Y,Z]=o.useState(""),[k,Q]=o.useState(""),[T,_e]=o.useState(!0),Ls=j||C||cs||xs||us,Ts=p||os||ds||hs||gs;is.useEffect(()=>{E&&_(oe())},[E]),is.useEffect(()=>{const s=async()=>{await Promise.all([D(),L()])};return window.addEventListener("licenses:refresh",s),()=>window.removeEventListener("licenses:refresh",s)},[D,L]);const f=o.useMemo(()=>{if(!i||!v||!W||!c)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableLicenses:0,totalLicenses:0,assignedLicenses:0}};const s=W.filter(b=>b.status==="active").length,l=W.filter(b=>b.status==="pending").length,I=c.length,x=c.filter(b=>b.assignedTo).length,U=c.filter(b=>b.status==="PENDING"&&!b.assignedTo).length,N={totalMembers:W.length,activeMembers:s,pendingInvites:l,availableLicenses:U,totalLicenses:I,assignedLicenses:x};return{members:W,stats:N}},[i,v,W,c]),R=s=>{if(!s.licenseAssignment)return null;const l=c==null?void 0:c.find(I=>{var x;return I.id===((x=s.licenseAssignment)==null?void 0:x.licenseId)});return{licenseId:s.licenseAssignment.licenseId,licenseType:s.licenseAssignment.licenseType,licenseKey:s.licenseAssignment.licenseKey,status:(l==null?void 0:l.status)||"UNKNOWN"}},A=()=>c?c.filter(s=>s.status==="PENDING"&&!s.assignedTo):[],As=(s,l)=>{G(l),ze(s.currentTarget)},F=()=>{ze(null)},Ns=async()=>{var s,l,I;if(!xe.trim()){r("Please enter an email address",{variant:"error"});return}if(!O.trim()){r("Please enter a first name",{variant:"error"});return}if(!$.trim()){r("Please enter a last name",{variant:"error"});return}if(!he.trim()){r("Please provide a temporary password",{variant:"error"});return}if(A().length<=0){r("No available licenses. Please generate more licenses first.",{variant:"error"});return}if(!M){r("Please select a license to assign to this team member",{variant:"error"});return}try{const x={firstName:O.trim(),lastName:$.trim(),email:xe.trim().toLowerCase(),role:Ne,status:"pending",organization:{id:((s=i==null?void 0:i.organization)==null?void 0:s.id)||"",name:((l=i==null?void 0:i.organization)==null?void 0:l.name)||"",tier:((I=i==null?void 0:i.organization)==null?void 0:I.tier)||"BASIC"},department:We.trim()||"",assignedProjects:[],avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(O+" "+$)}&background=667eea&color=fff`},U=await js.mutate({...x,temporaryPassword:he,position:Ee.trim()||"",phone:ke.trim()||""});if(M&&U)try{await Ce.mutate({licenseId:M,userId:U});const N=c==null?void 0:c.find(b=>b.id===M);console.log(`✅ [TeamPage] Assigned ${N==null?void 0:N.tier} license to new member:`,U)}catch(N){console.warn("Failed to assign selected license:",N)}r(`Team member ${O} ${$} created successfully with license assigned. They can now login with their email and temporary password.`,{variant:"success"}),Le(""),Te(""),Ae(""),Se("member"),De(""),Me(""),Re(""),_(oe()),Oe(""),z(!1),await Promise.all([L(),D()])}catch(x){console.error("❌ [TeamPage] Failed to create team member:",x),r((x==null?void 0:x.message)||"Failed to create team member",{variant:"error"})}},Ss=s=>{const l=s||n;if(!l){r("Unable to load member data. Please try again.",{variant:"error"});return}F(),G(l),Ge(l.firstName||""),Ue(l.lastName||""),Be(l.role||"member"),Ke(l.department||""),J(!1),Z(""),Q(""),_e(!0),B(!0)},Ws=async()=>{if(!n){r("No team member selected",{variant:"error"});return}if(!ye(i,n)){r("You do not have permission to change this password",{variant:"error"});return}const s=T?oe():Y;if(!T){if(!s.trim()){r("Please enter a new password",{variant:"error"});return}if(s!==k){r("Passwords do not match",{variant:"error"});return}if(s.length<8){r("Password must be at least 8 characters long",{variant:"error"});return}}try{await de.mutate({memberId:n.id,newPassword:s}),r(`Password ${T?"generated and ":""}updated successfully for ${P(n)}`,{variant:"success"}),J(!1),Z(""),Q("")}catch(l){console.error("❌ [TeamPage] Failed to update password:",l),r((l==null?void 0:l.message)||"Failed to update password",{variant:"error"})}},Ds=()=>{n&&(F(),H(!0))},Es=async()=>{if(n)try{const s=R(n);await vs.mutate({memberId:n.id}),s?r(`${P(n)} has been removed from the team. Their license has been released back to the available pool.`,{variant:"success"}):r(`${P(n)} has been removed from the team`,{variant:"success"}),H(!1),G(void 0),await Promise.all([L(),D()])}catch(s){console.error("❌ [TeamPage] Failed to remove team member:",s),r((s==null?void 0:s.message)||"Failed to remove team member",{variant:"error"})}},Ms=()=>{n&&(r(`Invitation resent to ${n.email}`,{variant:"success"}),F())},ks=async()=>{if(!n||!V){r("Please select a valid license to assign",{variant:"error"});return}try{await Ce.mutate({licenseId:V,userId:n.id}),r(`License assigned to ${P(n)}`,{variant:"success"}),$e(""),K(!1),F(),await Promise.all([D(),L()])}catch(s){console.error("❌ [TeamPage] Failed to assign license:",s),r((s==null?void 0:s.message)||"Failed to assign license",{variant:"error"})}},Rs=async()=>{if(n)try{const s=R(n);if(!s){r("This team member has no license to release",{variant:"warning"});return}await fs.mutate({licenseId:s.licenseId}),r(`${s.licenseType} license has been released from ${P(n)} and is now available for reassignment.`,{variant:"success"}),F(),await Promise.all([D(),L()])}catch(s){console.error("❌ [TeamPage] Failed to release license:",s),r((s==null?void 0:s.message)||"Failed to release license",{variant:"error"})}},Fs=async()=>{if(n)try{await ps.mutate({memberId:n.id,updates:{firstName:me,lastName:ue,role:qe,department:He||""}}),r(`Team member ${me} ${ue} updated successfully`,{variant:"success"}),B(!1),G(void 0),L()}catch(s){r((s==null?void 0:s.message)||"Failed to update team member",{variant:"error"})}};return Ls?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(t,{textAlign:"center",children:[e.jsx(Je,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):Ts?e.jsx(t,{sx:{p:3},children:e.jsxs(u,{severity:"error",children:[e.jsx(ge,{children:"Unable to Load Team Data"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs(zs,{dense:!0,children:[e.jsxs(Ye,{children:[e.jsx(S,{children:e.jsx(Os,{fontSize:"small"})}),e.jsx(Ze,{primary:"Network connectivity issues"})]}),e.jsxs(Ye,{children:[e.jsx(S,{children:e.jsx(je,{fontSize:"small"})}),e.jsx(Ze,{primary:"Authentication token expired"})]})]}),e.jsx(t,{sx:{mt:2},children:e.jsx(h,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!i||!v?e.jsx(t,{sx:{p:3},children:e.jsxs(u,{severity:"info",children:[e.jsx(ge,{children:"Setting Up Team Management"}),e.jsx(a,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(t,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(a,{variant:"body1",color:"text.secondary",children:["Manage your ",((Ve=v.organization)==null?void 0:Ve.name)||"Organization"," team members and permissions"]})]}),e.jsx(h,{variant:"contained",startIcon:e.jsx(pe,{}),onClick:()=>z(!0),disabled:A().length<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(q,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(q,{item:!0,xs:12,sm:6,md:3,children:e.jsx(le,{title:"Total Members",value:f.stats.totalMembers,icon:e.jsx(ce,{}),color:"primary"})}),e.jsx(q,{item:!0,xs:12,sm:6,md:3,children:e.jsx(le,{title:"Active Members",value:f.stats.activeMembers,icon:e.jsx(we,{}),color:"success"})}),e.jsx(q,{item:!0,xs:12,sm:6,md:3,children:e.jsx(le,{title:"Pending Invites",value:f.stats.pendingInvites,icon:e.jsx(Ie,{}),color:"warning"})}),e.jsx(q,{item:!0,xs:12,sm:6,md:3,children:e.jsx(le,{title:"Available Licenses",value:`${f.stats.availableLicenses}/${f.stats.totalLicenses}`,icon:e.jsx(y,{}),color:"primary"})})]}),f.stats.availableLicenses<=0&&e.jsxs(u,{severity:"warning",sx:{mb:4},children:[e.jsx(ge,{children:"No Available Licenses"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"You need to generate more licenses to invite new team members. Go to the Licenses page to create additional licenses."}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(h,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Generate Licenses"}),e.jsx(h,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx($s,{children:e.jsxs(Gs,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",f.members.length,")"]}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(y,{}),onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Manage Licenses"})]}),e.jsx(Us,{children:e.jsxs(qs,{children:[e.jsx(Bs,{children:e.jsxs(Qe,{children:[e.jsx(g,{sx:{fontWeight:600},children:"Member"}),e.jsx(g,{sx:{fontWeight:600},children:"Role"}),e.jsx(g,{sx:{fontWeight:600},children:"Status"}),e.jsx(g,{sx:{fontWeight:600},children:"Department"}),e.jsx(g,{sx:{fontWeight:600},children:"License"}),e.jsx(g,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(g,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Hs,{children:f.members.filter(s=>s&&s.id&&s.email).map(s=>{var l,I;return e.jsxs(Qe,{hover:!0,children:[e.jsx(g,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ks,{src:s.avatar,sx:{width:40,height:40},children:ga(s)}),e.jsxs(t,{children:[e.jsx(a,{variant:"body1",sx:{fontWeight:500},children:P(s)}),e.jsx(a,{variant:"body2",color:"text.secondary",children:s.email})]})]})}),e.jsx(g,{children:e.jsx(X,{label:((l=s.role)==null?void 0:l.toUpperCase())||"UNKNOWN",color:ja(s.role),size:"small",icon:s.role==="admin"?e.jsx(_s,{}):void 0})}),e.jsx(g,{children:e.jsx(X,{icon:ls(s.status),label:((I=s.status)==null?void 0:I.toUpperCase())||"UNKNOWN",color:pa(s.status),size:"small"})}),e.jsx(g,{children:e.jsx(a,{variant:"body2",children:s.department||"Unassigned"})}),e.jsx(g,{children:e.jsx(t,{children:(()=>{const x=R(s);return x?e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:x.licenseType}),e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[x.licenseKey.substring(0,12),"..."]}),e.jsx(X,{label:x.status,size:"small",color:x.status==="ACTIVE"?"success":"warning",sx:{mt:.5}})]}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"None"})})()})}),e.jsx(g,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.lastActive?new Date(s.lastActive).toLocaleDateString():"Never"})}),e.jsx(g,{children:e.jsx(Xe,{size:"small",onClick:x=>As(x,s),disabled:s.role==="owner"&&s.id===(i==null?void 0:i.id),children:e.jsx(Vs,{})})})]},s.id)})})]})})]})}),e.jsx(Js,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>z(!0),disabled:A().length<=0,children:e.jsx(Ys,{})}),e.jsxs(ee,{open:bs,onClose:()=>z(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(se,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(pe,{}),"Create New Team Member"]})}),e.jsx(ae,{children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(es,{})," Personal Information"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:O,onChange:s=>Te(s.target.value),placeholder:"John",required:!0}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:$,onChange:s=>Ae(s.target.value),placeholder:"Doe",required:!0})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:xe,onChange:s=>Le(s.target.value),placeholder:"john.doe@company.com",required:!0,sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Phone Number (Optional)",value:ke,onChange:s=>Re(s.target.value),placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(w,{position:"start",children:e.jsx(ss,{})})}})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(as,{})," Role & Department"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(te,{fullWidth:!0,children:[e.jsx(ne,{children:"Role"}),e.jsxs(re,{value:Ne,label:"Role",onChange:s=>Se(s.target.value),children:[e.jsx(m,{value:"viewer",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(m,{value:"member",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(m,{value:"manager",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(m,{value:"admin",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:We,onChange:s=>De(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title (Optional)",value:Ee,onChange:s=>Me(s.target.value),placeholder:"Senior Developer, Product Manager..."})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{})," Authentication"]}),e.jsx(ts,{control:e.jsx(ns,{checked:E,onChange:s=>Ps(s.target.checked)}),label:"Auto-generate secure password",sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Temporary Password",type:"password",value:he,onChange:s=>_(s.target.value),disabled:E,required:!0,InputProps:{endAdornment:e.jsx(w,{position:"end",children:e.jsx(Xe,{onClick:()=>_(oe()),disabled:!E,children:e.jsx(Zs,{})})})},helperText:E?"Password will be auto-generated":"User will need this password to login initially"})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(y,{})," License Assignment"]}),e.jsxs(te,{fullWidth:!0,sx:{mb:2},children:[e.jsx(ne,{children:"Select License to Assign"}),e.jsx(re,{value:M,label:"Select License to Assign",onChange:s=>Oe(s.target.value),required:!0,children:A().length===0?e.jsx(m,{disabled:!0,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"No available licenses found"})}):A().map(s=>e.jsx(m,{value:s.id,children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(y,{color:"primary"}),e.jsxs(t,{sx:{flex:1},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:s.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.tier," • ",s.key," • Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id))}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Only unassigned PENDING licenses are available for assignment"})]}),e.jsxs(u,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🎫 License Assignment Details"}),e.jsx(a,{variant:"body2",children:"This team member will be created as a full Firebase authenticated user and assigned the selected license. They can login immediately with their email and temporary password."}),e.jsxs(a,{variant:"body2",sx:{mt:1,fontWeight:500},children:["Available licenses: ",f.stats.availableLicenses," of ",f.stats.totalLicenses]})]})]}),A().length<=0&&e.jsx(u,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No licenses available! Please generate more licenses before creating team members."})})]})}),e.jsxs(ie,{children:[e.jsx(h,{onClick:()=>z(!1),children:"Cancel"}),e.jsx(h,{onClick:Ns,variant:"contained",startIcon:e.jsx(pe,{}),disabled:A().length<=0||!M,children:"Create Team Member"})]})]}),e.jsxs(ee,{open:ys,onClose:()=>{B(!1),G(void 0)},maxWidth:"md",fullWidth:!0,children:[e.jsx(se,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ve,{}),"🚀 ENHANCED Edit Team Member: ",(n==null?void 0:n.firstName)||"Loading..."," ",(n==null?void 0:n.lastName)||""]})}),e.jsx(ae,{children:n?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(es,{})," Personal Information"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:me,onChange:s=>Ge(s.target.value),required:!0,placeholder:"John"}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:ue,onChange:s=>Ue(s.target.value),required:!0,placeholder:"Doe"})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:n.email,disabled:!0,sx:{mb:2},helperText:"Email cannot be changed after account creation"}),e.jsx(d,{fullWidth:!0,label:"Phone Number",value:"",disabled:!0,placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(w,{position:"start",children:e.jsx(ss,{})})},helperText:"Phone number not available in current data model"})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(as,{})," Role & Department"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(te,{fullWidth:!0,children:[e.jsx(ne,{children:"Role"}),e.jsxs(re,{value:qe,label:"Role",onChange:s=>Be(s.target.value),children:[e.jsx(m,{value:"viewer",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(m,{value:"member",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(m,{value:"manager",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(m,{value:"admin",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:He,onChange:s=>Ke(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title",value:"",disabled:!0,placeholder:"Senior Developer, Product Manager...",helperText:"Position not available in current data model"})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(y,{})," License & Access"]}),(()=>{const s=R(n);return e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"License Type",value:(s==null?void 0:s.licenseType)||"None",disabled:!0,InputProps:{startAdornment:e.jsx(w,{position:"start",children:e.jsx(y,{})})}}),e.jsx(d,{fullWidth:!0,label:"License Status",value:s?s.status:"Unassigned",disabled:!0,InputProps:{startAdornment:e.jsx(w,{position:"start",children:s?e.jsx(we,{}):e.jsx(Ie,{})})}})]})})(),e.jsx(d,{fullWidth:!0,label:"Last Active",value:n.lastActive?new Date(n.lastActive).toLocaleString():"Never",disabled:!0,InputProps:{startAdornment:e.jsx(w,{position:"start",children:e.jsx(Qs,{})})}})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(rs,{})," Project Assignments"]}),(()=>{const s=va(n,ms||[]);return s.length>0?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.map(l=>e.jsx(X,{label:l.name,color:"primary",variant:"outlined",size:"small",icon:e.jsx(rs,{}),sx:{maxWidth:200}},l.id))}),e.jsxs(t,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx("strong",{children:"Project Details:"})}),s.map(l=>e.jsxs(t,{sx:{mb:1,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:l.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Mode: ",l.mode," • Storage: ",l.storageBackend," • Status: ",l.status]}),l.description&&e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:l.description})]},l.id))]})]}):e.jsx(u,{severity:"info",children:e.jsx(a,{variant:"body2",children:"No projects assigned yet. This team member can be assigned to projects from the Cloud Projects page."})})})()]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{})," Account Status"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"Account Status",value:n.status,disabled:!0,InputProps:{startAdornment:e.jsx(w,{position:"start",children:ls(n.status)})}}),e.jsx(d,{fullWidth:!0,label:"Member Since",value:n.joinedAt?new Date(n.joinedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(w,{position:"start",children:e.jsx(ce,{})})}})]})]}),ye(i,n)&&e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(fe,{})," Password Management"]}),Cs?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(u,{severity:"warning",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🔐 Password Change"}),e.jsx(a,{variant:"body2",children:T?"A secure password will be automatically generated.":"Please enter a new password with at least 8 characters."})]}),e.jsx(ts,{control:e.jsx(ns,{checked:T,onChange:s=>_e(s.target.checked)}),label:"Auto-generate secure password"}),!T&&e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(d,{fullWidth:!0,label:"New Password",type:"password",value:Y,onChange:s=>Z(s.target.value),placeholder:"Enter new password (min 8 characters)",required:!0,InputProps:{startAdornment:e.jsx(w,{position:"start",children:e.jsx(fe,{})})}}),e.jsx(d,{fullWidth:!0,label:"Confirm Password",type:"password",value:k,onChange:s=>Q(s.target.value),placeholder:"Confirm new password",required:!0,error:k!==""&&Y!==k,helperText:k!==""&&Y!==k?"Passwords do not match":"",InputProps:{startAdornment:e.jsx(w,{position:"start",children:e.jsx(fe,{})})}})]}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(h,{variant:"contained",startIcon:e.jsx(be,{}),onClick:Ws,disabled:de.loading,sx:{background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)",color:"white",fontWeight:600},children:de.loading?"Updating...":T?"Generate & Update Password":"Update Password"}),e.jsx(h,{variant:"outlined",onClick:()=>{J(!1),Z(""),Q("")},children:"Cancel"})]})]}):e.jsxs(t,{children:[e.jsxs(u,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"🔐 Password Access"})}),e.jsx(a,{variant:"body2",children:(i==null?void 0:i.id)===n.id?"You can change your own password here.":(i==null?void 0:i.role)==="ENTERPRISE_USER"||(i==null?void 0:i.role)==="owner"?"As the account owner, you can change this team member's password.":"As an admin, you can change this team member's password."})]}),e.jsx(h,{variant:"outlined",startIcon:e.jsx(be,{}),onClick:()=>J(!0),sx:{mb:2},children:"Change Password"})]})]}),e.jsxs(u,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"⚠️ Important Notes"}),e.jsxs(a,{variant:"body2",children:["• Role changes will immediately affect the member's permissions and access levels",e.jsx("br",{}),"• Department information helps with organization and project assignments",e.jsx("br",{}),"• Project assignments are managed from the Cloud Projects page",e.jsx("br",{}),"• License assignments are managed through the Licenses page",e.jsx("br",{}),ye(i,n)&&"• Password changes take effect immediately"]})]})]}):e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(t,{textAlign:"center",children:[e.jsx(Je,{size:40,sx:{mb:2}}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Loading member data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"If this persists, please close and try again."})]})})}),e.jsxs(ie,{children:[e.jsx(h,{onClick:()=>B(!1),children:"Cancel"}),e.jsx(h,{onClick:Fs,variant:"contained",startIcon:e.jsx(ve,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(ee,{open:ws,onClose:()=>H(!1),maxWidth:"sm",children:[e.jsx(se,{children:"Remove Team Member"}),e.jsx(ae,{children:n&&e.jsxs(t,{children:[e.jsxs(a,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsx("strong",{children:P(n)})," from your team?"]}),(()=>{const s=R(n);return s?e.jsxs(u,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🎫 License Management"}),e.jsxs(a,{variant:"body2",children:["This team member currently has a ",e.jsx("strong",{children:s.licenseType})," license assigned. When removed, their license will be automatically released back to your available license pool and can be reassigned to another team member."]})]}):e.jsx(u,{severity:"info",sx:{mb:2},children:e.jsx(a,{variant:"body2",children:"This team member has no license assigned, so no license will be affected."})})})(),e.jsx(u,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources."})})]})}),e.jsxs(ie,{children:[e.jsx(h,{onClick:()=>H(!1),children:"Cancel"}),e.jsx(h,{onClick:Es,variant:"contained",color:"error",startIcon:e.jsx(Pe,{}),children:"Remove Member"})]})]}),e.jsxs(Xs,{anchorEl:Fe,open:!!Fe,onClose:F,children:[e.jsxs(m,{onClick:()=>Ss(n),children:[e.jsx(S,{children:e.jsx(ve,{})}),"Edit Member"]}),n?R(n)?e.jsxs(m,{onClick:Rs,children:[e.jsx(S,{children:e.jsx(be,{})}),"Release License"]}):e.jsxs(m,{onClick:()=>K(!0),children:[e.jsx(S,{children:e.jsx(y,{})}),"Assign License"]}):null,(n==null?void 0:n.status)==="pending"&&e.jsxs(m,{onClick:Ms,children:[e.jsx(S,{children:e.jsx(ea,{})}),"Resend Invite"]}),e.jsx(sa,{}),e.jsxs(m,{onClick:Ds,sx:{color:"error.main"},children:[e.jsx(S,{children:e.jsx(Pe,{sx:{color:"error.main"}})}),"Remove Member"]})]}),e.jsxs(ee,{open:Is,onClose:()=>K(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(se,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(y,{}),"Assign License to ",n?P(n):"Team Member"]})}),e.jsx(ae,{children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(u,{severity:"info",children:e.jsxs(a,{variant:"body2",children:["Assigning a license to ",e.jsx("strong",{children:n?P(n):"Team Member"})," (",n==null?void 0:n.email,")"]})}),e.jsxs(te,{fullWidth:!0,children:[e.jsx(ne,{children:"Select License"}),e.jsx(re,{value:V,label:"Select License",onChange:s=>$e(s.target.value),children:c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).map(s=>e.jsx(m,{value:s.id,children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(y,{color:"primary"}),e.jsxs(t,{children:[e.jsxs(a,{variant:"body2",sx:{fontWeight:500},children:[s.tier," License"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.key," • Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id))}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Only unassigned PENDING licenses are available for assignment"})]}),(c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0&&e.jsx(u,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No available licenses found. All licenses are either assigned or not in PENDING status."})}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"The selected license will be assigned to this team member and they will have immediate access to the system."})]})}),e.jsxs(ie,{children:[e.jsx(h,{onClick:()=>K(!1),children:"Cancel"}),e.jsx(h,{onClick:ks,variant:"contained",startIcon:e.jsx(y,{}),disabled:!V||(c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0,children:"Assign License"})]})]})]})};export{Na as default};
