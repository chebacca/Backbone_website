import{j as e,B as r,C as ze,T as s,d as j,ai as E,w as Pe,x as re,y as f,aj as Ue,z as ie,H as $e,a as o,aH as Be,G as b,W as he,p as me,am as ue,u as Fe,t as Ve,v as He,a_ as Ge,ar as _e,as as qe,at as Ke,au as le,av as l,aw as Ye,ag as Je,r as oe,a$ as Qe,g as Xe,ax as Ze,ay as ea,ap as aa,az as M,aA as I,aB as w,e as g,aC as ce,aD as de,aE as xe,a5 as d,aF as D,n as sa,aI as N,i as ta,a4 as na,aK as ra,E as ia,D as la,aL as oa}from"./mui-C_fh8XDr.js";import{r as x}from"./vendor-CjD1bmmO.js";import{u as ca}from"./notistack.esm-Ca-E78ev.js";import{u as da,a as xa,b as ha}from"./useStreamlinedData-aou3zA1R.js";import{M as T}from"./MetricCard-CgsP6LiV.js";import"./index-D8-YPbah.js";import"./stripe-DhLvsej_.js";import"./index.esm-CyAlu9Ug.js";import"./index.esm-DmQE6AXN.js";const ma=i=>{switch(i){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},ua=i=>{switch(i){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},ja=i=>{switch(i){case"active":return e.jsx(me,{});case"pending":return e.jsx(ue,{});case"suspended":return e.jsx(oa,{});case"removed":return e.jsx(N,{});default:return e.jsx(he,{})}},Ia=()=>{var V,H,G;const{enqueueSnackbar:i}=ca(),{data:c,loading:je,error:ge}=da(),{data:m,loading:ve,error:pe}=xa(),{loading:fe,error:be}=ha(),[ye,v]=x.useState(!1),[Se,A]=x.useState(!1),[Ce,y]=x.useState(!1),[Me,S]=x.useState(!1),[W,L]=x.useState(""),[O,z]=x.useState("member"),[Ie,P]=x.useState(""),[n,k]=x.useState(null),[U,$]=x.useState(null),[R,B]=x.useState(0),we=je||ve||fe,De=ge||pe||be,t=x.useMemo(()=>{var q,K,Y,J,Q,X,Z,ee,ae;if(!c||!m)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}};const a=((K=(q=m.organization)==null?void 0:q.usage)==null?void 0:K.totalUsers)||1,u=((Y=m.subscription)==null?void 0:Y.seats)||1,p=[{id:c.id,firstName:((J=c.name)==null?void 0:J.split(" ")[0])||"User",lastName:((Q=c.name)==null?void 0:Q.split(" ").slice(1).join(" "))||"",email:c.email,role:"owner",status:"active",joinedAt:c.createdAt||new Date().toISOString(),lastActive:new Date().toISOString(),licenseAssigned:(X=c.license)==null?void 0:X.key,licenseType:((Z=c.license)==null?void 0:Z.status)==="ACTIVE"?"PRO":"BASIC",department:"Management",avatar:c.photoURL}];for(let h=1;h<a;h++){const se=["admin","member","viewer","manager"],te=["active","pending"],ne=["Engineering","Design","Marketing","Sales","Support"];p.push({id:`member_${h}`,firstName:"Team",lastName:`Member ${h}`,email:`member${h}@${((ae=(ee=m.organization)==null?void 0:ee.name)==null?void 0:ae.toLowerCase().replace(/\s+/g,""))||"company"}.com`,role:se[Math.floor(Math.random()*se.length)],status:te[Math.floor(Math.random()*te.length)],joinedAt:new Date(Date.now()-Math.random()*90*24*60*60*1e3).toISOString(),lastActive:new Date(Date.now()-Math.random()*7*24*60*60*1e3).toISOString(),licenseAssigned:`LIC-${Math.random().toString(36).substr(2,8).toUpperCase()}`,licenseType:Math.random()>.5?"PRO":"BASIC",department:ne[Math.floor(Math.random()*ne.length)]})}const _=p.filter(h=>h.status==="active").length,Le=p.filter(h=>h.status==="pending").length,Oe={totalMembers:p.length,activeMembers:_,pendingInvites:Le,availableSeats:Math.max(0,u-_),totalSeats:u};return{members:p,stats:Oe}},[c,m]),Te=(a,u)=>{k(u),$(a.currentTarget)},C=()=>{$(null),k(null)},Ae=async()=>{if(!W.trim()){i("Please enter an email address",{variant:"error"});return}if(t.stats.availableSeats<=0){i("No available seats. Please upgrade your plan.",{variant:"error"});return}try{i(`Invitation sent to ${W}`,{variant:"success"}),L(""),z("member"),P(""),v(!1)}catch(a){i((a==null?void 0:a.message)||"Failed to send invitation",{variant:"error"})}},We=()=>{n&&(A(!0),C())},ke=()=>{n&&(y(!0),C())},Re=async()=>{if(n)try{i(`${n.firstName} ${n.lastName} has been removed from the team`,{variant:"success"}),y(!1),k(null)}catch(a){i((a==null?void 0:a.message)||"Failed to remove team member",{variant:"error"})}},Ee=()=>{n&&(i(`Invitation resent to ${n.email}`,{variant:"success"}),C())},F=()=>{B(t.stats.totalSeats),S(!0)},Ne=async()=>{try{i(`Seat allocation updated to ${R} seats`,{variant:"success"}),S(!1)}catch(a){i((a==null?void 0:a.message)||"Failed to update seat allocation",{variant:"error"})}};return we?e.jsx(r,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(r,{textAlign:"center",children:[e.jsx(ze,{size:60}),e.jsx(s,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):De?e.jsx(r,{sx:{p:3},children:e.jsxs(j,{severity:"error",children:[e.jsx(E,{children:"Unable to Load Team Data"}),e.jsx(s,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs(Pe,{dense:!0,children:[e.jsxs(re,{children:[e.jsx(f,{children:e.jsx(Ue,{fontSize:"small"})}),e.jsx(ie,{primary:"Network connectivity issues"})]}),e.jsxs(re,{children:[e.jsx(f,{children:e.jsx($e,{fontSize:"small"})}),e.jsx(ie,{primary:"Authentication token expired"})]})]}),e.jsx(r,{sx:{mt:2},children:e.jsx(o,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!c||!m?e.jsx(r,{sx:{p:3},children:e.jsxs(j,{severity:"info",children:[e.jsx(E,{children:"Setting Up Team Management"}),e.jsx(s,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(r,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(r,{children:[e.jsx(s,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(s,{variant:"body1",color:"text.secondary",children:["Manage your ",((V=m.organization)==null?void 0:V.name)||"Organization"," team members and permissions"]})]}),e.jsx(o,{variant:"contained",startIcon:e.jsx(Be,{}),onClick:()=>v(!0),disabled:t.stats.availableSeats<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(b,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(b,{item:!0,xs:12,sm:6,md:3,children:e.jsx(T,{title:"Total Members",value:t.stats.totalMembers,icon:e.jsx(he,{}),color:"primary"})}),e.jsx(b,{item:!0,xs:12,sm:6,md:3,children:e.jsx(T,{title:"Active Members",value:t.stats.activeMembers,icon:e.jsx(me,{}),color:"success"})}),e.jsx(b,{item:!0,xs:12,sm:6,md:3,children:e.jsx(T,{title:"Pending Invites",value:t.stats.pendingInvites,icon:e.jsx(ue,{}),color:"warning"})}),e.jsx(b,{item:!0,xs:12,sm:6,md:3,children:e.jsx(T,{title:"Available Seats",value:`${t.stats.availableSeats}/${t.stats.totalSeats}`,icon:e.jsx(Fe,{}),color:"info"})})]}),t.stats.availableSeats<=0&&e.jsxs(j,{severity:"warning",sx:{mb:4},children:[e.jsx(E,{children:"No Available Seats"}),e.jsx(s,{variant:"body2",sx:{mb:2},children:"You've reached your seat limit. Upgrade your plan or manage existing seats to invite new members."}),e.jsxs(r,{sx:{display:"flex",gap:2},children:[e.jsx(o,{variant:"outlined",size:"small",onClick:F,children:"Manage Seats"}),e.jsx(o,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(Ve,{children:e.jsxs(He,{children:[e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",t.members.length,")"]}),e.jsx(o,{variant:"outlined",startIcon:e.jsx(Ge,{}),onClick:F,children:"Manage Seats"})]}),e.jsx(_e,{children:e.jsxs(qe,{children:[e.jsx(Ke,{children:e.jsxs(le,{children:[e.jsx(l,{sx:{fontWeight:600},children:"Member"}),e.jsx(l,{sx:{fontWeight:600},children:"Role"}),e.jsx(l,{sx:{fontWeight:600},children:"Status"}),e.jsx(l,{sx:{fontWeight:600},children:"Department"}),e.jsx(l,{sx:{fontWeight:600},children:"License"}),e.jsx(l,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(l,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Ye,{children:t.members.map(a=>e.jsxs(le,{hover:!0,children:[e.jsx(l,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(Je,{src:a.avatar,sx:{width:40,height:40},children:[a.firstName.charAt(0),a.lastName.charAt(0)]}),e.jsxs(r,{children:[e.jsxs(s,{variant:"body1",sx:{fontWeight:500},children:[a.firstName," ",a.lastName]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:a.email})]})]})}),e.jsx(l,{children:e.jsx(oe,{label:a.role.toUpperCase(),color:ma(a.role),size:"small",icon:a.role==="admin"?e.jsx(Qe,{}):void 0})}),e.jsx(l,{children:e.jsx(oe,{icon:ja(a.status),label:a.status.toUpperCase(),color:ua(a.status),size:"small"})}),e.jsx(l,{children:e.jsx(s,{variant:"body2",children:a.department||"Unassigned"})}),e.jsx(l,{children:e.jsxs(r,{children:[e.jsx(s,{variant:"body2",sx:{fontWeight:500},children:a.licenseType||"None"}),a.licenseAssigned&&e.jsxs(s,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[a.licenseAssigned.substring(0,12),"..."]})]})}),e.jsx(l,{children:e.jsx(s,{variant:"body2",color:"text.secondary",children:new Date(a.lastActive).toLocaleDateString()})}),e.jsx(l,{children:e.jsx(Xe,{size:"small",onClick:u=>Te(u,a),disabled:a.role==="owner"&&a.id===c.id,children:e.jsx(Ze,{})})})]},a.id))})]})})]})}),e.jsx(ea,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>v(!0),disabled:t.stats.availableSeats<=0,children:e.jsx(aa,{})}),e.jsxs(M,{open:ye,onClose:()=>v(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(I,{children:"Invite Team Member"}),e.jsx(w,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(g,{fullWidth:!0,label:"Email Address",type:"email",value:W,onChange:a=>L(a.target.value),placeholder:"colleague@company.com"}),e.jsxs(ce,{fullWidth:!0,children:[e.jsx(de,{children:"Role"}),e.jsxs(xe,{value:O,label:"Role",onChange:a=>z(a.target.value),children:[e.jsx(d,{value:"viewer",children:"Viewer - Read-only access"}),e.jsx(d,{value:"member",children:"Member - Standard access"}),e.jsx(d,{value:"manager",children:"Manager - Team management"}),e.jsx(d,{value:"admin",children:"Admin - Full access"})]})]}),e.jsx(g,{fullWidth:!0,label:"Department (Optional)",value:Ie,onChange:a=>P(a.target.value),placeholder:"Engineering, Design, Marketing..."}),e.jsx(j,{severity:"info",children:e.jsxs(s,{variant:"body2",children:["The invited member will receive an email with instructions to join your organization. They will be assigned a ",O==="admin"?"PRO":"BASIC"," license automatically."]})})]})}),e.jsxs(D,{children:[e.jsx(o,{onClick:()=>v(!1),children:"Cancel"}),e.jsx(o,{onClick:Ae,variant:"contained",startIcon:e.jsx(sa,{}),children:"Send Invitation"})]})]}),e.jsxs(M,{open:Se,onClose:()=>A(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(I,{children:"Edit Team Member"}),e.jsx(w,{children:n&&e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(g,{fullWidth:!0,label:"First Name",defaultValue:n.firstName}),e.jsx(g,{fullWidth:!0,label:"Last Name",defaultValue:n.lastName}),e.jsxs(ce,{fullWidth:!0,children:[e.jsx(de,{children:"Role"}),e.jsxs(xe,{defaultValue:n.role,label:"Role",children:[e.jsx(d,{value:"viewer",children:"Viewer"}),e.jsx(d,{value:"member",children:"Member"}),e.jsx(d,{value:"manager",children:"Manager"}),e.jsx(d,{value:"admin",children:"Admin"})]})]}),e.jsx(g,{fullWidth:!0,label:"Department",defaultValue:n.department})]})}),e.jsxs(D,{children:[e.jsx(o,{onClick:()=>A(!1),children:"Cancel"}),e.jsx(o,{variant:"contained",children:"Save Changes"})]})]}),e.jsxs(M,{open:Ce,onClose:()=>y(!1),maxWidth:"sm",children:[e.jsx(I,{children:"Remove Team Member"}),e.jsx(w,{children:n&&e.jsxs(r,{children:[e.jsxs(s,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsxs("strong",{children:[n.firstName," ",n.lastName]})," from your team?"]}),e.jsx(j,{severity:"warning",children:e.jsx(s,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources. Their license will be freed up for reassignment."})})]})}),e.jsxs(D,{children:[e.jsx(o,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(o,{onClick:Re,variant:"contained",color:"error",startIcon:e.jsx(N,{}),children:"Remove Member"})]})]}),e.jsxs(M,{open:Me,onClose:()=>S(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(I,{children:"Manage Seat Allocation"}),e.jsx(w,{children:e.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(r,{children:[e.jsxs(s,{variant:"body1",sx:{mb:2},children:["Current Plan: ",e.jsx("strong",{children:((G=(H=m.subscription)==null?void 0:H.plan)==null?void 0:G.tier)||"PRO"})]}),e.jsx(ta,{variant:"determinate",value:t.stats.activeMembers/t.stats.totalSeats*100,sx:{height:8,borderRadius:4,mb:1}}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[t.stats.activeMembers," of ",t.stats.totalSeats," seats used"]})]}),e.jsx(g,{fullWidth:!0,label:"Total Seats",type:"number",value:R,onChange:a=>B(parseInt(a.target.value)||0),inputProps:{min:t.stats.activeMembers,max:100},helperText:`Minimum: ${t.stats.activeMembers} (current active members)`}),e.jsx(j,{severity:"info",children:e.jsx(s,{variant:"body2",children:"Increasing seats will update your billing. Decreasing seats below active members will require removing members first."})})]})}),e.jsxs(D,{children:[e.jsx(o,{onClick:()=>S(!1),children:"Cancel"}),e.jsx(o,{onClick:Ne,variant:"contained",disabled:R<t.stats.activeMembers,children:"Update Seats"})]})]}),e.jsxs(na,{anchorEl:U,open:!!U,onClose:C,children:[e.jsxs(d,{onClick:We,children:[e.jsx(f,{children:e.jsx(ra,{})}),"Edit Member"]}),(n==null?void 0:n.status)==="pending"&&e.jsxs(d,{onClick:Ee,children:[e.jsx(f,{children:e.jsx(ia,{})}),"Resend Invite"]}),e.jsx(la,{}),e.jsxs(d,{onClick:ke,sx:{color:"error.main"},children:[e.jsx(f,{children:e.jsx(N,{sx:{color:"error.main"}})}),"Remove Member"]})]})]})};export{Ia as default};
