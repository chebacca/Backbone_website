import{j as e,a as c,T as l,d as B,b3 as ge,G as y,k as P,l as V,at as R,o as ue,n as L,ax as te,m as he,H as be,aC as je,c as pe,aD as fe,aE as ve,aF as Z,aG as x,aH as Se,h as ee,b4 as ye,b5 as Ie,b6 as Me,I as Ee,aI as Ae,b7 as we,az as Ce,aj as Ne,a4 as E,X as z,aL as De,w as Oe,b8 as ae,b2 as Te,aN as ke,aO as Re,aP as We,u as G,aS as Pe,aT as Ve,aU as ze,aQ as Fe}from"./mui-BGhK1avx.js";import{r as j}from"./vendor-OeuszDaU.js";import{u as Be}from"./notistack.esm-CcFOI6Un.js";import{u as Ge,c as w,e as C}from"./index-346rOOt_.js";import"./stripe-B34TymDN.js";const Le=g=>{switch(g){case"admin":return"secondary";case"owner":return"secondary";case"manager":return"info";case"member":return"success";case"viewer":return"default";default:return"default"}},Ue=g=>{switch(g){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},_e=g=>{switch(g){case"active":return e.jsx(L,{});case"pending":return e.jsx(te,{});case"suspended":return e.jsx(ae,{});default:return e.jsx(L,{})}},tt=()=>{const{enqueueSnackbar:g}=Be(),{user:F}=Ge(),[se,N]=j.useState([]),[p,D]=j.useState({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}),[A,U]=j.useState(null),[$e,_]=j.useState(""),$=(t,{includeTime:a=!1}={})=>{try{if(!t){const o=new Date;return a?o.toISOString():o.toISOString().slice(0,10)}if(typeof t=="string"||typeof t=="number"){const o=new Date(t);if(!Number.isNaN(o.getTime()))return a?o.toISOString():o.toISOString().slice(0,10)}if(typeof t=="object"){const o=t._seconds,i=t._nanoseconds??0;if(typeof o=="number"){const d=o*1e3+Math.floor(i/1e6),h=new Date(d);return a?h.toISOString():h.toISOString().slice(0,10)}}}catch{}const u=new Date;return a?u.toISOString():u.toISOString().slice(0,10)};j.useEffect(()=>{let t=!0;return(async()=>{var a,u,o,i,d,h;try{const m=await w.get(C.organizations.my()),f=((u=(a=m==null?void 0:m.data)==null?void 0:a.data)==null?void 0:u.owned)??[],v=((i=(o=m==null?void 0:m.data)==null?void 0:o.data)==null?void 0:i.memberOf)??[],b=f[0]||v[0]||null;if(!b){t&&(U(null),_(""),N([]),D({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}));return}const S=b.members||[],s=S.filter(r=>r.status==="INVITED").length,n=S.filter(r=>r.status==="ACTIVE").length,J=(((h=(d=(await w.get(C.subscriptions.mySubscriptions())).data)==null?void 0:d.data)==null?void 0:h.subscriptions)??[]).filter(r=>r.organizationId===b.id&&r.status==="ACTIVE").reduce((r,k)=>r+(k.seats||0),0),de=Math.max(0,J-(n+s)),K=(Array.isArray(S)?S:[]).filter(r=>r&&r.status!=="REMOVED").map(r=>{const k=String(r.email||"user@example.com"),Y=k.split("@")[0]||"User",me={OWNER:"owner",ENTERPRISE_ADMIN:"admin",MANAGER:"manager",MEMBER:"member"},xe={INVITED:"pending",ACTIVE:"active",REMOVED:"removed"};return{id:String(r.id||`${k}-${Math.random().toString(36).slice(2)}`),firstName:Y.charAt(0).toUpperCase()+Y.slice(1),lastName:"",email:k,role:me[String(r.role)]||"member",status:xe[String(r.status)]||"active",joinedAt:$(r.joinedAt),lastActive:$(r.updatedAt||r.joinedAt||new Date,{includeTime:!0})}});if(!t)return;U(b.id),_(b.name||"Organization"),N(K),D({totalMembers:K.length,activeMembers:n,pendingInvites:s,availableSeats:de,totalSeats:J})}catch(m){if(!t)return;console.error("[TeamPage] Failed to load team data:",m),N([]),D({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0})}})(),()=>{t=!1}},[F==null?void 0:F.email]);const[H,q]=j.useState(null),[I,Q]=j.useState(null),[ne,O]=j.useState(!1),[He,ie]=j.useState(!1),[M,T]=j.useState({email:"",role:"member",department:"",message:""}),re=(t,a)=>{q(t.currentTarget),Q(a)},W=()=>{q(null),Q(null)},oe=async()=>{var t,a,u,o;if(A)try{const i={admin:"ENTERPRISE_ADMIN",owner:"ENTERPRISE_ADMIN",manager:"MANAGER",member:"MEMBER",viewer:"MEMBER"};await w.post(C.organizations.invite(A),{email:M.email,role:i[M.role]||"MEMBER"}),g(`Invitation sent to ${M.email}`,{variant:"success"}),O(!1),T({email:"",role:"member",department:"",message:""});const d=await w.get(C.organizations.my()),h=((a=(t=d==null?void 0:d.data)==null?void 0:t.data)==null?void 0:a.owned)??[],m=((o=(u=d==null?void 0:d.data)==null?void 0:u.data)==null?void 0:o.memberOf)??[],f=[...h,...m].find(v=>v.id===A)||h[0]||m[0];if(f){const v=f.members||[],b=v.filter(n=>n.status!=="REMOVED").map(n=>({id:n.id,firstName:(n.email||"User").split("@")[0],lastName:"",email:n.email,role:n.role==="OWNER"?"owner":n.role==="ENTERPRISE_ADMIN"?"admin":n.role==="MANAGER"?"manager":"member",status:n.status==="INVITED"?"pending":n.status==="ACTIVE"?"active":"removed",joinedAt:(n.joinedAt?new Date(n.joinedAt):new Date).toISOString().slice(0,10),lastActive:new Date().toISOString()})),S=v.filter(n=>n.status==="INVITED").length,s=v.filter(n=>n.status==="ACTIVE").length;N(b),D(n=>({...n,totalMembers:b.length,pendingInvites:S,activeMembers:s,availableSeats:Math.max(0,n.totalSeats-(s+S))}))}}catch(i){g((i==null?void 0:i.message)||"Failed to send invitation",{variant:"error"})}},le=()=>{I&&g(`Invitation resent to ${I.email}`,{variant:"success"}),W()},ce=async()=>{var t,a,u,o;if(!(!I||!A))try{await w.post(C.organizations.removeMember(A,I.id)),g(`${I.email} removed from team`,{variant:"warning"});const i=await w.get(C.organizations.my()),d=((a=(t=i==null?void 0:i.data)==null?void 0:t.data)==null?void 0:a.owned)??[],h=((o=(u=i==null?void 0:i.data)==null?void 0:u.data)==null?void 0:o.memberOf)??[],m=[...d,...h].find(f=>f.id===A)||d[0]||h[0];if(m){const f=m.members||[],v=f.filter(s=>s.status!=="REMOVED").map(s=>({id:s.id,firstName:(s.email||"User").split("@")[0],lastName:"",email:s.email,role:s.role==="OWNER"?"owner":s.role==="ENTERPRISE_ADMIN"?"admin":s.role==="MANAGER"?"manager":"member",status:s.status==="INVITED"?"pending":s.status==="ACTIVE"?"active":"removed",joinedAt:(s.joinedAt?new Date(s.joinedAt):new Date).toISOString().slice(0,10),lastActive:new Date().toISOString()})),b=f.filter(s=>s.status==="INVITED").length,S=f.filter(s=>s.status==="ACTIVE").length;N(v),D(s=>({...s,totalMembers:v.length,pendingInvites:b,activeMembers:S,availableSeats:Math.max(0,s.totalSeats-(S+b))}))}}catch(i){g((i==null?void 0:i.message)||"Failed to remove member",{variant:"error"})}finally{W()}},X=j.useMemo(()=>p.totalSeats<=0?0:(p.totalSeats-p.availableSeats)/p.totalSeats*100,[p.totalSeats,p.availableSeats]);return e.jsxs(c,{children:[e.jsx(c,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(c,{children:[e.jsx(l,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsx(l,{variant:"body1",color:"text.secondary",children:"Manage your team members, roles, and license assignments"})]}),e.jsx(B,{variant:"contained",startIcon:e.jsx(ge,{}),onClick:()=>O(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]})}),e.jsxs(y,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:e.jsx(P,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(V,{children:[e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(R,{sx:{bgcolor:"primary.main"},children:e.jsx(ue,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:p.totalMembers}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Total Members"})]})})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsx(P,{sx:{background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%)",border:"1px solid rgba(76, 175, 80, 0.2)"},children:e.jsxs(V,{children:[e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(R,{sx:{bgcolor:"success.main"},children:e.jsx(L,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700,color:"success.main"},children:p.activeMembers}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Active Members"})]})})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsx(P,{sx:{background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 152, 0, 0.05) 100%)",border:"1px solid rgba(255, 152, 0, 0.2)"},children:e.jsxs(V,{children:[e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(R,{sx:{bgcolor:"warning.main"},children:e.jsx(te,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700,color:"warning.main"},children:p.pendingInvites}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Pending Invites"})]})})})}),e.jsx(y,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:e.jsx(P,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(V,{children:[e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(R,{sx:{bgcolor:"secondary.main"},children:e.jsx(he,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700},children:p.availableSeats}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Available Seats"}),e.jsx(be,{variant:"determinate",value:X,sx:{mt:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:X>80?"linear-gradient(90deg, #ff9800 0%, #f44336 100%)":"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}})]})})})})]}),e.jsx(c,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},children:e.jsx(je,{component:pe,sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(fe,{children:[e.jsx(ve,{children:e.jsxs(Z,{children:[e.jsx(x,{sx:{fontWeight:600},children:"Member"}),e.jsx(x,{sx:{fontWeight:600},children:"Role"}),e.jsx(x,{sx:{fontWeight:600},children:"Department"}),e.jsx(x,{sx:{fontWeight:600},children:"Status"}),e.jsx(x,{sx:{fontWeight:600},children:"License"}),e.jsx(x,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(x,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Se,{children:se.map(t=>e.jsxs(Z,{hover:!0,children:[e.jsx(x,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(R,{sx:{width:40,height:40},children:[t.firstName[0],t.lastName[0]]}),e.jsxs(c,{children:[e.jsxs(l,{variant:"body2",sx:{fontWeight:500},children:[t.firstName," ",t.lastName]}),e.jsx(l,{variant:"caption",color:"text.secondary",children:t.email})]})]})}),e.jsx(x,{children:e.jsx(ee,{icon:t.role==="admin"?e.jsx(ye,{}):e.jsx(Ie,{}),label:t.role.toUpperCase(),color:Le(t.role),size:"small",variant:"outlined"})}),e.jsx(x,{children:e.jsx(l,{variant:"body2",children:t.department||"Not assigned"})}),e.jsx(x,{children:e.jsx(ee,{icon:_e(t.status),label:t.status.toUpperCase(),color:Ue(t.status),size:"small"})}),e.jsx(x,{children:t.licenseAssigned?e.jsx(Me,{title:t.licenseAssigned,children:e.jsx(l,{variant:"body2",sx:{fontFamily:"monospace",maxWidth:120,overflow:"hidden",textOverflow:"ellipsis"},children:t.licenseAssigned})}):e.jsx(l,{variant:"body2",color:"text.secondary",children:"No license"})}),e.jsx(x,{children:e.jsx(l,{variant:"body2",children:t.lastActive?new Date(t.lastActive).toLocaleDateString():"Never"})}),e.jsx(x,{children:e.jsx(Ee,{onClick:a=>re(a,t),size:"small",children:e.jsx(Ae,{})})})]},t.id))})]})})}),e.jsx(we,{color:"primary",sx:{position:"fixed",bottom:24,right:24,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000"},onClick:()=>O(!0),children:e.jsx(Ce,{})}),e.jsxs(Ne,{anchorEl:H,open:!!H,onClose:W,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsxs(E,{onClick:()=>ie(!0),children:[e.jsx(z,{children:e.jsx(De,{fontSize:"small"})}),"Edit Member"]}),(I==null?void 0:I.status)==="pending"&&e.jsxs(E,{onClick:le,children:[e.jsx(z,{children:e.jsx(Oe,{fontSize:"small"})}),"Resend Invite"]}),e.jsxs(E,{onClick:W,children:[e.jsx(z,{children:e.jsx(ae,{fontSize:"small"})}),"Suspend Member"]}),e.jsxs(E,{onClick:ce,sx:{color:"error.main"},children:[e.jsx(z,{children:e.jsx(Te,{fontSize:"small",sx:{color:"error.main"}})}),"Remove Member"]})]}),e.jsxs(ke,{open:ne,onClose:()=>O(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(Re,{children:"Invite Team Member"}),e.jsx(We,{children:e.jsxs(y,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(y,{item:!0,xs:12,children:e.jsx(G,{fullWidth:!0,label:"Email Address",type:"email",value:M.email,onChange:t=>T(a=>({...a,email:t.target.value}))})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsxs(Pe,{fullWidth:!0,children:[e.jsx(Ve,{children:"Role"}),e.jsxs(ze,{value:M.role,label:"Role",onChange:t=>T(a=>({...a,role:t.target.value})),inputProps:{"aria-label":"Select team member role",title:"Select the role for this team member"},children:[e.jsx(E,{value:"viewer",children:"Viewer"}),e.jsx(E,{value:"member",children:"Member"}),e.jsx(E,{value:"admin",children:"Admin"})]})]})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(G,{fullWidth:!0,label:"Department",value:M.department,onChange:t=>T(a=>({...a,department:t.target.value}))})}),e.jsx(y,{item:!0,xs:12,children:e.jsx(G,{fullWidth:!0,label:"Welcome Message (Optional)",multiline:!0,rows:3,value:M.message,onChange:t=>T(a=>({...a,message:t.target.value}))})})]})}),e.jsxs(Fe,{children:[e.jsx(B,{onClick:()=>O(!1),children:"Cancel"}),e.jsx(B,{onClick:oe,variant:"contained",disabled:!M.email,children:"Send Invitation"})]})]})]})};export{tt as default};
