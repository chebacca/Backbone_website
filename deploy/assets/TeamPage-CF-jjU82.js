import{j as e,a as o,T as l,d as F,b3 as xe,G as p,k as V,l as P,at as k,o as ue,n as L,ax as ee,m as ge,H as he,aC as be,c as je,aD as pe,aE as ve,aF as Y,aG as d,aH as fe,h as Z,b4 as ye,b5 as Ie,b6 as Se,I as Me,aI as Ee,b7 as Ae,az as we,aj as Ce,a4 as E,X as z,aL as Ne,w as De,b8 as ae,b2 as Te,aN as Oe,aO as ke,aP as Re,u as G,aS as We,aT as Ve,aU as Pe,aQ as ze}from"./mui-BGhK1avx.js";import{r as g}from"./vendor-OeuszDaU.js";import{u as Be}from"./notistack.esm-CcFOI6Un.js";import{u as Fe,c as w,e as C}from"./index-DqhYf4g3.js";import"./stripe-B34TymDN.js";const Ge=x=>{switch(x){case"admin":return"secondary";case"owner":return"secondary";case"manager":return"info";case"member":return"success";case"viewer":return"default";default:return"default"}},Le=x=>{switch(x){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},Ue=x=>{switch(x){case"active":return e.jsx(L,{});case"pending":return e.jsx(ee,{});case"suspended":return e.jsx(ae,{});default:return e.jsx(L,{})}},ea=()=>{const{enqueueSnackbar:x}=Be(),{user:B}=Fe(),[te,N]=g.useState([]),[h,D]=g.useState({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}),[A,U]=g.useState(null),[_e,_]=g.useState("");g.useEffect(()=>{let a=!0;return(async()=>{var n,I,S,i,m,M;try{const c=await w.get(C.organizations.my()),b=((I=(n=c==null?void 0:c.data)==null?void 0:n.data)==null?void 0:I.owned)??[],j=((i=(S=c==null?void 0:c.data)==null?void 0:S.data)==null?void 0:i.memberOf)??[],u=b[0]||j[0]||null;if(!u){a&&(U(null),_(""),N([]),D({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}));return}const v=u.members||[],t=v.filter(r=>r.status==="INVITED").length,s=v.filter(r=>r.status==="ACTIVE").length,X=(((M=(m=(await w.get(C.subscriptions.mySubscriptions())).data)==null?void 0:m.data)==null?void 0:M.subscriptions)??[]).filter(r=>r.organizationId===u.id&&r.status==="ACTIVE").reduce((r,W)=>r+(W.seats||0),0),de=Math.max(0,X-(s+t)),J=v.filter(r=>r.status!=="REMOVED").map(r=>{const W=r.email||"",K=W.split("@")[0]||"User",ce={OWNER:"owner",ENTERPRISE_ADMIN:"admin",MANAGER:"manager",MEMBER:"member"},me={INVITED:"pending",ACTIVE:"active",REMOVED:"removed"};return{id:r.id,firstName:K.charAt(0).toUpperCase()+K.slice(1),lastName:"",email:W,role:ce[r.role]||"member",status:me[r.status]||"active",joinedAt:(r.joinedAt?new Date(r.joinedAt):new Date).toISOString().slice(0,10),lastActive:new Date().toISOString()}});if(!a)return;U(u.id),_(u.name||"Organization"),N(J),D({totalMembers:J.length,activeMembers:s,pendingInvites:t,availableSeats:de,totalSeats:X})}catch{if(!a)return;N([]),D({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0})}})(),()=>{a=!1}},[B==null?void 0:B.email]);const[H,$]=g.useState(null),[f,q]=g.useState(null),[se,T]=g.useState(!1),[He,ne]=g.useState(!1),[y,O]=g.useState({email:"",role:"member",department:"",message:""}),ie=(a,n)=>{$(a.currentTarget),q(n)},R=()=>{$(null),q(null)},re=async()=>{var a,n,I,S;if(A)try{const i={admin:"ENTERPRISE_ADMIN",owner:"ENTERPRISE_ADMIN",manager:"MANAGER",member:"MEMBER",viewer:"MEMBER"};await w.post(C.organizations.invite(A),{email:y.email,role:i[y.role]||"MEMBER"}),x(`Invitation sent to ${y.email}`,{variant:"success"}),T(!1),O({email:"",role:"member",department:"",message:""});const m=await w.get(C.organizations.my()),M=((n=(a=m==null?void 0:m.data)==null?void 0:a.data)==null?void 0:n.owned)??[],c=((S=(I=m==null?void 0:m.data)==null?void 0:I.data)==null?void 0:S.memberOf)??[],b=[...M,...c].find(j=>j.id===A)||M[0]||c[0];if(b){const j=b.members||[],u=j.filter(s=>s.status!=="REMOVED").map(s=>({id:s.id,firstName:(s.email||"User").split("@")[0],lastName:"",email:s.email,role:s.role==="OWNER"?"owner":s.role==="ENTERPRISE_ADMIN"?"admin":s.role==="MANAGER"?"manager":"member",status:s.status==="INVITED"?"pending":s.status==="ACTIVE"?"active":"removed",joinedAt:(s.joinedAt?new Date(s.joinedAt):new Date).toISOString().slice(0,10),lastActive:new Date().toISOString()})),v=j.filter(s=>s.status==="INVITED").length,t=j.filter(s=>s.status==="ACTIVE").length;N(u),D(s=>({...s,totalMembers:u.length,pendingInvites:v,activeMembers:t,availableSeats:Math.max(0,s.totalSeats-(t+v))}))}}catch(i){x((i==null?void 0:i.message)||"Failed to send invitation",{variant:"error"})}},le=()=>{f&&x(`Invitation resent to ${f.email}`,{variant:"success"}),R()},oe=async()=>{var a,n,I,S;if(!(!f||!A))try{await w.post(C.organizations.removeMember(A,f.id)),x(`${f.email} removed from team`,{variant:"warning"});const i=await w.get(C.organizations.my()),m=((n=(a=i==null?void 0:i.data)==null?void 0:a.data)==null?void 0:n.owned)??[],M=((S=(I=i==null?void 0:i.data)==null?void 0:I.data)==null?void 0:S.memberOf)??[],c=[...m,...M].find(b=>b.id===A)||m[0]||M[0];if(c){const b=c.members||[],j=b.filter(t=>t.status!=="REMOVED").map(t=>({id:t.id,firstName:(t.email||"User").split("@")[0],lastName:"",email:t.email,role:t.role==="OWNER"?"owner":t.role==="ENTERPRISE_ADMIN"?"admin":t.role==="MANAGER"?"manager":"member",status:t.status==="INVITED"?"pending":t.status==="ACTIVE"?"active":"removed",joinedAt:(t.joinedAt?new Date(t.joinedAt):new Date).toISOString().slice(0,10),lastActive:new Date().toISOString()})),u=b.filter(t=>t.status==="INVITED").length,v=b.filter(t=>t.status==="ACTIVE").length;N(j),D(t=>({...t,totalMembers:j.length,pendingInvites:u,activeMembers:v,availableSeats:Math.max(0,t.totalSeats-(v+u))}))}}catch(i){x((i==null?void 0:i.message)||"Failed to remove member",{variant:"error"})}finally{R()}},Q=g.useMemo(()=>h.totalSeats<=0?0:(h.totalSeats-h.availableSeats)/h.totalSeats*100,[h.totalSeats,h.availableSeats]);return e.jsxs(o,{children:[e.jsx(o,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(o,{children:[e.jsx(l,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsx(l,{variant:"body1",color:"text.secondary",children:"Manage your team members, roles, and license assignments"})]}),e.jsx(F,{variant:"contained",startIcon:e.jsx(xe,{}),onClick:()=>T(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]})}),e.jsxs(p,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsx(o,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:e.jsx(V,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs(P,{children:[e.jsx(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(k,{sx:{bgcolor:"primary.main"},children:e.jsx(ue,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:h.totalMembers}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Total Members"})]})})})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsx(o,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsx(V,{sx:{background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%)",border:"1px solid rgba(76, 175, 80, 0.2)"},children:e.jsxs(P,{children:[e.jsx(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(k,{sx:{bgcolor:"success.main"},children:e.jsx(L,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700,color:"success.main"},children:h.activeMembers}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Active Members"})]})})})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsx(o,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsx(V,{sx:{background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 152, 0, 0.05) 100%)",border:"1px solid rgba(255, 152, 0, 0.2)"},children:e.jsxs(P,{children:[e.jsx(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(k,{sx:{bgcolor:"warning.main"},children:e.jsx(ee,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700,color:"warning.main"},children:h.pendingInvites}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Pending Invites"})]})})})}),e.jsx(p,{item:!0,xs:12,sm:6,md:3,children:e.jsx(o,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:e.jsx(V,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(P,{children:[e.jsx(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(k,{sx:{bgcolor:"secondary.main"},children:e.jsx(ge,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700},children:h.availableSeats}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Available Seats"}),e.jsx(he,{variant:"determinate",value:Q,sx:{mt:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:Q>80?"linear-gradient(90deg, #ff9800 0%, #f44336 100%)":"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}})]})})})})]}),e.jsx(o,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},children:e.jsx(be,{component:je,sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(pe,{children:[e.jsx(ve,{children:e.jsxs(Y,{children:[e.jsx(d,{sx:{fontWeight:600},children:"Member"}),e.jsx(d,{sx:{fontWeight:600},children:"Role"}),e.jsx(d,{sx:{fontWeight:600},children:"Department"}),e.jsx(d,{sx:{fontWeight:600},children:"Status"}),e.jsx(d,{sx:{fontWeight:600},children:"License"}),e.jsx(d,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(d,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(fe,{children:te.map(a=>e.jsxs(Y,{hover:!0,children:[e.jsx(d,{children:e.jsxs(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(k,{sx:{width:40,height:40},children:[a.firstName[0],a.lastName[0]]}),e.jsxs(o,{children:[e.jsxs(l,{variant:"body2",sx:{fontWeight:500},children:[a.firstName," ",a.lastName]}),e.jsx(l,{variant:"caption",color:"text.secondary",children:a.email})]})]})}),e.jsx(d,{children:e.jsx(Z,{icon:a.role==="admin"?e.jsx(ye,{}):e.jsx(Ie,{}),label:a.role.toUpperCase(),color:Ge(a.role),size:"small",variant:"outlined"})}),e.jsx(d,{children:e.jsx(l,{variant:"body2",children:a.department||"Not assigned"})}),e.jsx(d,{children:e.jsx(Z,{icon:Ue(a.status),label:a.status.toUpperCase(),color:Le(a.status),size:"small"})}),e.jsx(d,{children:a.licenseAssigned?e.jsx(Se,{title:a.licenseAssigned,children:e.jsx(l,{variant:"body2",sx:{fontFamily:"monospace",maxWidth:120,overflow:"hidden",textOverflow:"ellipsis"},children:a.licenseAssigned})}):e.jsx(l,{variant:"body2",color:"text.secondary",children:"No license"})}),e.jsx(d,{children:e.jsx(l,{variant:"body2",children:a.lastActive?new Date(a.lastActive).toLocaleDateString():"Never"})}),e.jsx(d,{children:e.jsx(Me,{onClick:n=>ie(n,a),size:"small",children:e.jsx(Ee,{})})})]},a.id))})]})})}),e.jsx(Ae,{color:"primary",sx:{position:"fixed",bottom:24,right:24,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000"},onClick:()=>T(!0),children:e.jsx(we,{})}),e.jsxs(Ce,{anchorEl:H,open:!!H,onClose:R,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsxs(E,{onClick:()=>ne(!0),children:[e.jsx(z,{children:e.jsx(Ne,{fontSize:"small"})}),"Edit Member"]}),(f==null?void 0:f.status)==="pending"&&e.jsxs(E,{onClick:le,children:[e.jsx(z,{children:e.jsx(De,{fontSize:"small"})}),"Resend Invite"]}),e.jsxs(E,{onClick:R,children:[e.jsx(z,{children:e.jsx(ae,{fontSize:"small"})}),"Suspend Member"]}),e.jsxs(E,{onClick:oe,sx:{color:"error.main"},children:[e.jsx(z,{children:e.jsx(Te,{fontSize:"small",sx:{color:"error.main"}})}),"Remove Member"]})]}),e.jsxs(Oe,{open:se,onClose:()=>T(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(ke,{children:"Invite Team Member"}),e.jsx(Re,{children:e.jsxs(p,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(p,{item:!0,xs:12,children:e.jsx(G,{fullWidth:!0,label:"Email Address",type:"email",value:y.email,onChange:a=>O(n=>({...n,email:a.target.value}))})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsxs(We,{fullWidth:!0,children:[e.jsx(Ve,{children:"Role"}),e.jsxs(Pe,{value:y.role,label:"Role",onChange:a=>O(n=>({...n,role:a.target.value})),inputProps:{"aria-label":"Select team member role",title:"Select the role for this team member"},children:[e.jsx(E,{value:"viewer",children:"Viewer"}),e.jsx(E,{value:"member",children:"Member"}),e.jsx(E,{value:"admin",children:"Admin"})]})]})}),e.jsx(p,{item:!0,xs:12,sm:6,children:e.jsx(G,{fullWidth:!0,label:"Department",value:y.department,onChange:a=>O(n=>({...n,department:a.target.value}))})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(G,{fullWidth:!0,label:"Welcome Message (Optional)",multiline:!0,rows:3,value:y.message,onChange:a=>O(n=>({...n,message:a.target.value}))})})]})}),e.jsxs(ze,{children:[e.jsx(F,{onClick:()=>T(!1),children:"Cancel"}),e.jsx(F,{onClick:re,variant:"contained",disabled:!y.email,children:"Send Invitation"})]})]})]})};export{ea as default};
