import{j as e,a as c,T as l,d as _,b3 as be,G as S,k as U,l as $,at as V,o as pe,n as q,ax as ne,m as je,H as fe,aC as ve,c as ye,aD as Se,aE as Me,aF as ae,aG as x,aH as Ie,h as se,b4 as Ee,b5 as Ae,b6 as Ce,I as we,aI as De,b7 as Ne,az as Te,aj as Oe,a4 as A,X as G,aL as Re,w as ke,b8 as re,b2 as We,aN as Pe,aO as Ve,aP as ze,u as H,aS as Be,aT as Fe,aU as Ue,aQ as $e}from"./mui-BGhK1avx.js";import{r as f}from"./vendor-OeuszDaU.js";import{u as Ge}from"./notistack.esm-CcFOI6Un.js";import{u as Le,c as D,e as N}from"./index-DIj67Gs0.js";import"./stripe-B34TymDN.js";const _e=u=>{switch(u){case"admin":return"secondary";case"owner":return"secondary";case"manager":return"info";case"member":return"success";case"viewer":return"default";default:return"default"}},He=u=>{switch(u){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},qe=u=>{switch(u){case"active":return e.jsx(q,{});case"pending":return e.jsx(ne,{});case"suspended":return e.jsx(re,{});default:return e.jsx(q,{})}},tt=()=>{const{enqueueSnackbar:u}=Ge(),{user:L}=Le(),[ie,T]=f.useState([]),[v,O]=f.useState({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}),[C,Q]=f.useState(null),[Qe,X]=f.useState(""),w=(t,{includeTime:a=!1}={})=>{try{if(!t){const o=new Date;return a?o.toISOString():o.toISOString().slice(0,10)}if(typeof t=="string"||typeof t=="number"){const o=new Date(t);if(!Number.isNaN(o.getTime()))return a?o.toISOString():o.toISOString().slice(0,10)}if(typeof t=="object"){const o=t._seconds,n=t._nanoseconds??0;if(typeof o=="number"){const d=o*1e3+Math.floor(n/1e6),h=new Date(d);return a?h.toISOString():h.toISOString().slice(0,10)}}}catch{}const g=new Date;return a?g.toISOString():g.toISOString().slice(0,10)};f.useEffect(()=>{let t=!0;return(async()=>{var a,g,o,n,d,h;try{const m=await D.get(N.organizations.my()),b=((g=(a=m==null?void 0:m.data)==null?void 0:a.data)==null?void 0:g.owned)??[],p=((n=(o=m==null?void 0:m.data)==null?void 0:o.data)==null?void 0:n.memberOf)??[],j=b[0]||p[0]||null;if(!j){t&&(Q(null),X(""),T([]),O({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0}));return}const y=j.members||[],r=y.filter(i=>i.status==="INVITED").length,s=y.filter(i=>i.status==="ACTIVE").length,F=(((h=(d=(await D.get(N.subscriptions.mySubscriptions())).data)==null?void 0:d.data)==null?void 0:h.subscriptions)??[]).filter(i=>i.organizationId===j.id&&i.status==="ACTIVE").reduce((i,P)=>i+(P.seats||0),0),ue=Math.max(0,F-(s+r)),ee=(Array.isArray(y)?y:[]).filter(i=>i&&i.status!=="REMOVED").map(i=>{const P=String(i.email||"user@example.com"),te=P.split("@")[0]||"User",ge={OWNER:"owner",ENTERPRISE_ADMIN:"admin",MANAGER:"manager",MEMBER:"member"},he={INVITED:"pending",ACTIVE:"active",REMOVED:"removed"};return{id:String(i.id||`${P}-${Math.random().toString(36).slice(2)}`),firstName:te.charAt(0).toUpperCase()+te.slice(1),lastName:"",email:P,role:ge[String(i.role)]||"member",status:he[String(i.status)]||"active",joinedAt:w(i.joinedAt),lastActive:w(i.updatedAt||i.joinedAt||new Date,{includeTime:!0})}});if(!t)return;Q(j.id),X(j.name||"Organization"),T(ee),O({totalMembers:ee.length,activeMembers:s,pendingInvites:r,availableSeats:ue,totalSeats:F})}catch(m){if(!t)return;console.error("[TeamPage] Failed to load team data:",m),T([]),O({totalMembers:0,activeMembers:0,pendingInvites:0,availableSeats:0,totalSeats:0})}})(),()=>{t=!1}},[L==null?void 0:L.email]);const[J,K]=f.useState(null),[M,Y]=f.useState(null),[oe,R]=f.useState(!1),[Xe,le]=f.useState(!1),[I,k]=f.useState({email:"",role:"member",department:"",message:""}),ce=(t,a)=>{K(t.currentTarget),Y(a)},z=()=>{K(null),Y(null)},de=async()=>{var t,a,g,o;if(C)try{const n={admin:"ENTERPRISE_ADMIN",owner:"ENTERPRISE_ADMIN",manager:"MANAGER",member:"MEMBER",viewer:"MEMBER"};await D.post(N.organizations.invite(C),{email:I.email,role:n[I.role]||"MEMBER"}),u(`Invitation sent to ${I.email}`,{variant:"success"}),R(!1),k({email:"",role:"member",department:"",message:""});const d=await D.get(N.organizations.my()),h=((a=(t=d==null?void 0:d.data)==null?void 0:t.data)==null?void 0:a.owned)??[],m=((o=(g=d==null?void 0:d.data)==null?void 0:g.data)==null?void 0:o.memberOf)??[],b=[...h,...m].find(p=>p.id===C)||h[0]||m[0];if(b){const p=b.members||[],j=(Array.isArray(p)?p:[]).filter(s=>s&&s.status!=="REMOVED").map(s=>{const E=String(s.email||"user@example.com"),W=E.split("@")[0]||"User",B={OWNER:"owner",ENTERPRISE_ADMIN:"admin",MANAGER:"manager",MEMBER:"member"},F={INVITED:"pending",ACTIVE:"active",REMOVED:"removed"};return{id:String(s.id||`${E}-${Math.random().toString(36).slice(2)}`),firstName:W.charAt(0).toUpperCase()+W.slice(1),lastName:"",email:E,role:B[String(s.role)]||"member",status:F[String(s.status)]||"active",joinedAt:w(s.joinedAt),lastActive:w(s.updatedAt||s.joinedAt||new Date,{includeTime:!0})}}),y=p.filter(s=>s.status==="INVITED").length,r=p.filter(s=>s.status==="ACTIVE").length;T(j),O(s=>({...s,totalMembers:j.length,pendingInvites:y,activeMembers:r,availableSeats:Math.max(0,s.totalSeats-(r+y))}))}}catch(n){console.error("[TeamPage] Invite failed:",n),u((n==null?void 0:n.message)||"Failed to send invitation",{variant:"error"})}},me=()=>{M&&u(`Invitation resent to ${M.email}`,{variant:"success"}),z()},xe=async()=>{var t,a,g,o;if(!(!M||!C))try{await D.post(N.organizations.removeMember(C,M.id)),u(`${M.email} removed from team`,{variant:"warning"});const n=await D.get(N.organizations.my()),d=((a=(t=n==null?void 0:n.data)==null?void 0:t.data)==null?void 0:a.owned)??[],h=((o=(g=n==null?void 0:n.data)==null?void 0:g.data)==null?void 0:o.memberOf)??[],m=[...d,...h].find(b=>b.id===C)||d[0]||h[0];if(m){const b=m.members||[],p=(Array.isArray(b)?b:[]).filter(r=>r&&r.status!=="REMOVED").map(r=>{const s=String(r.email||"user@example.com"),E=s.split("@")[0]||"User",W={OWNER:"owner",ENTERPRISE_ADMIN:"admin",MANAGER:"manager",MEMBER:"member"},B={INVITED:"pending",ACTIVE:"active",REMOVED:"removed"};return{id:String(r.id||`${s}-${Math.random().toString(36).slice(2)}`),firstName:E.charAt(0).toUpperCase()+E.slice(1),lastName:"",email:s,role:W[String(r.role)]||"member",status:B[String(r.status)]||"active",joinedAt:w(r.joinedAt),lastActive:w(r.updatedAt||r.joinedAt||new Date,{includeTime:!0})}}),j=b.filter(r=>r.status==="INVITED").length,y=b.filter(r=>r.status==="ACTIVE").length;T(p),O(r=>({...r,totalMembers:p.length,pendingInvites:j,activeMembers:y,availableSeats:Math.max(0,r.totalSeats-(y+j))}))}}catch(n){console.error("[TeamPage] Remove member failed:",n),u((n==null?void 0:n.message)||"Failed to remove member",{variant:"error"})}finally{z()}},Z=f.useMemo(()=>v.totalSeats<=0?0:(v.totalSeats-v.availableSeats)/v.totalSeats*100,[v.totalSeats,v.availableSeats]);return e.jsxs(c,{children:[e.jsx(c,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(c,{children:[e.jsx(l,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsx(l,{variant:"body1",color:"text.secondary",children:"Manage your team members, roles, and license assignments"})]}),e.jsx(_,{variant:"contained",startIcon:e.jsx(be,{}),onClick:()=>R(!0),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]})}),e.jsxs(S,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},children:e.jsx(U,{sx:{background:"linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(102, 126, 234, 0.1) 100%)",border:"1px solid rgba(0, 212, 255, 0.2)"},children:e.jsxs($,{children:[e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(V,{sx:{bgcolor:"primary.main"},children:e.jsx(pe,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700,color:"primary.main"},children:v.totalMembers}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Total Members"})]})})})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},children:e.jsx(U,{sx:{background:"linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%)",border:"1px solid rgba(76, 175, 80, 0.2)"},children:e.jsxs($,{children:[e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(V,{sx:{bgcolor:"success.main"},children:e.jsx(q,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700,color:"success.main"},children:v.activeMembers}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Active Members"})]})})})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},children:e.jsx(U,{sx:{background:"linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 152, 0, 0.05) 100%)",border:"1px solid rgba(255, 152, 0, 0.2)"},children:e.jsxs($,{children:[e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(V,{sx:{bgcolor:"warning.main"},children:e.jsx(ne,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700,color:"warning.main"},children:v.pendingInvites}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Pending Invites"})]})})})}),e.jsx(S,{item:!0,xs:12,sm:6,md:3,children:e.jsx(c,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},children:e.jsx(U,{sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs($,{children:[e.jsx(c,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:e.jsx(V,{sx:{bgcolor:"secondary.main"},children:e.jsx(je,{})})}),e.jsx(l,{variant:"h3",sx:{fontWeight:700},children:v.availableSeats}),e.jsx(l,{variant:"body2",color:"text.secondary",children:"Available Seats"}),e.jsx(fe,{variant:"determinate",value:Z,sx:{mt:1,height:4,borderRadius:2,backgroundColor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{borderRadius:2,background:Z>80?"linear-gradient(90deg, #ff9800 0%, #f44336 100%)":"linear-gradient(90deg, #00d4ff 0%, #667eea 100%)"}}})]})})})})]}),e.jsx(c,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5},children:e.jsx(ve,{component:ye,sx:{background:"linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%)",backdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.1)"},children:e.jsxs(Se,{children:[e.jsx(Me,{children:e.jsxs(ae,{children:[e.jsx(x,{sx:{fontWeight:600},children:"Member"}),e.jsx(x,{sx:{fontWeight:600},children:"Role"}),e.jsx(x,{sx:{fontWeight:600},children:"Department"}),e.jsx(x,{sx:{fontWeight:600},children:"Status"}),e.jsx(x,{sx:{fontWeight:600},children:"License"}),e.jsx(x,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(x,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Ie,{children:ie.map(t=>e.jsxs(ae,{hover:!0,children:[e.jsx(x,{children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(V,{sx:{width:40,height:40},children:[t.firstName[0],t.lastName[0]]}),e.jsxs(c,{children:[e.jsxs(l,{variant:"body2",sx:{fontWeight:500},children:[t.firstName," ",t.lastName]}),e.jsx(l,{variant:"caption",color:"text.secondary",children:t.email})]})]})}),e.jsx(x,{children:e.jsx(se,{icon:t.role==="admin"?e.jsx(Ee,{}):e.jsx(Ae,{}),label:t.role.toUpperCase(),color:_e(t.role),size:"small",variant:"outlined"})}),e.jsx(x,{children:e.jsx(l,{variant:"body2",children:t.department||"Not assigned"})}),e.jsx(x,{children:e.jsx(se,{icon:qe(t.status),label:t.status.toUpperCase(),color:He(t.status),size:"small"})}),e.jsx(x,{children:t.licenseAssigned?e.jsx(Ce,{title:t.licenseAssigned,children:e.jsx(l,{variant:"body2",sx:{fontFamily:"monospace",maxWidth:120,overflow:"hidden",textOverflow:"ellipsis"},children:t.licenseAssigned})}):e.jsx(l,{variant:"body2",color:"text.secondary",children:"No license"})}),e.jsx(x,{children:e.jsx(l,{variant:"body2",children:t.lastActive?new Date(t.lastActive).toLocaleDateString():"Never"})}),e.jsx(x,{children:e.jsx(we,{onClick:a=>ce(a,t),size:"small",children:e.jsx(De,{})})})]},t.id))})]})})}),e.jsx(Ne,{color:"primary",sx:{position:"fixed",bottom:24,right:24,background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000"},onClick:()=>R(!0),children:e.jsx(Te,{})}),e.jsxs(Oe,{anchorEl:J,open:!!J,onClose:z,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsxs(A,{onClick:()=>le(!0),children:[e.jsx(G,{children:e.jsx(Re,{fontSize:"small"})}),"Edit Member"]}),(M==null?void 0:M.status)==="pending"&&e.jsxs(A,{onClick:me,children:[e.jsx(G,{children:e.jsx(ke,{fontSize:"small"})}),"Resend Invite"]}),e.jsxs(A,{onClick:z,children:[e.jsx(G,{children:e.jsx(re,{fontSize:"small"})}),"Suspend Member"]}),e.jsxs(A,{onClick:xe,sx:{color:"error.main"},children:[e.jsx(G,{children:e.jsx(We,{fontSize:"small",sx:{color:"error.main"}})}),"Remove Member"]})]}),e.jsxs(Pe,{open:oe,onClose:()=>R(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{backgroundColor:"background.paper",border:"1px solid rgba(255, 255, 255, 0.1)"}},children:[e.jsx(Ve,{children:"Invite Team Member"}),e.jsx(ze,{children:e.jsxs(S,{container:!0,spacing:3,sx:{mt:1},children:[e.jsx(S,{item:!0,xs:12,children:e.jsx(H,{fullWidth:!0,label:"Email Address",type:"email",value:I.email,onChange:t=>k(a=>({...a,email:t.target.value}))})}),e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsxs(Be,{fullWidth:!0,children:[e.jsx(Fe,{children:"Role"}),e.jsxs(Ue,{value:I.role,label:"Role",onChange:t=>k(a=>({...a,role:t.target.value})),inputProps:{"aria-label":"Select team member role",title:"Select the role for this team member"},children:[e.jsx(A,{value:"viewer",children:"Viewer"}),e.jsx(A,{value:"member",children:"Member"}),e.jsx(A,{value:"admin",children:"Admin"})]})]})}),e.jsx(S,{item:!0,xs:12,sm:6,children:e.jsx(H,{fullWidth:!0,label:"Department",value:I.department,onChange:t=>k(a=>({...a,department:t.target.value}))})}),e.jsx(S,{item:!0,xs:12,children:e.jsx(H,{fullWidth:!0,label:"Welcome Message (Optional)",multiline:!0,rows:3,value:I.message,onChange:t=>k(a=>({...a,message:t.target.value}))})})]})}),e.jsxs($e,{children:[e.jsx(_,{onClick:()=>R(!1),children:"Cancel"}),e.jsx(_,{onClick:de,variant:"contained",disabled:!I.email,children:"Send Invitation"})]})]})]})};export{tt as default};
