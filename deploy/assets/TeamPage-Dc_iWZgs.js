const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UnifiedDataService-DanHx1Ur.js","assets/index-UlA8C2rF.js","assets/mui-Cr9U6iW2.js","assets/vendor-CjD1bmmO.js","assets/stripe-ggaMUove.js","assets/index-CBai7h7s.css","assets/index.esm-B4qVkIPL.js","assets/index.esm-DmQE6AXN.js"])))=>i.map(i=>d[i]);
import{_ as Je}from"./index-UlA8C2rF.js";import{j as e,B as t,C as Ye,T as a,d as u,ai as ge,w as $s,x as Ze,y as W,aj as Gs,z as Qe,H as je,a as x,aG as pe,G as U,W as ce,p as we,am as Ie,u as P,t as Us,v as Bs,R as Xe,aq as qs,ar as Hs,as as Ks,at as es,au as g,av as Vs,ag as Js,r as X,aZ as Ys,g as ss,aw as Zs,ax as Qs,ap as Xs,ay as ee,az as se,aB as ae,a_ as as,e as d,I as C,a$ as ts,b0 as ns,aC as te,aD as ne,aE as re,a5 as m,F as rs,s as is,aF as ie,aI as ve,aL as ea,b1 as ls,L as fe,b2 as be,aH as Pe,a4 as sa,E as aa,D as ta,aJ as na}from"./mui-Cr9U6iW2.js";import{r as o,b as os}from"./vendor-CjD1bmmO.js";import{u as ra}from"./notistack.esm-Ca-E78ev.js";import{b as ia,c as la,a as oa,u as ca,h as da,j as ha,k as xa,l as ma,f as ua,g as ga,m as ja}from"./useStreamlinedData-jBxecPYN.js";import{M as le}from"./MetricCard-CCtxyf7i.js";import"./stripe-ggaMUove.js";import"./UnifiedDataService-DanHx1Ur.js";import"./index.esm-B4qVkIPL.js";import"./index.esm-DmQE6AXN.js";const L=n=>n.firstName&&n.lastName?`${n.firstName} ${n.lastName}`:n.email,pa=n=>{var b,y,A;const l=((b=n.firstName)==null?void 0:b.charAt(0))||((y=n.email)==null?void 0:y.charAt(0))||"U",p=((A=n.lastName)==null?void 0:A.charAt(0))||"";return l+p},va=n=>{if(!n)return"default";switch(n){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},fa=n=>{if(!n)return"default";switch(n){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},cs=n=>{if(!n)return e.jsx(ce,{});switch(n){case"active":return e.jsx(we,{});case"pending":return e.jsx(Ie,{});case"suspended":return e.jsx(na,{});case"removed":return e.jsx(Pe,{});default:return e.jsx(ce,{})}},oe=()=>{const l="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let p="";for(let b=0;b<12;b++)p+=l.charAt(Math.floor(Math.random()*l.length));return p},ye=(n,l)=>{var y,A;if(!n||!l)return!1;const p=(y=n.role)==null?void 0:y.toUpperCase(),b=(A=l.role)==null?void 0:A.toUpperCase();return p==="ENTERPRISE_USER"||p==="OWNER"||p==="ADMIN"&&b!=="ENTERPRISE_USER"&&b!=="OWNER"?!0:n.id===l.id},ba=(n,l)=>!n.assignedProjects||!l?[]:l.filter(p=>n.assignedProjects.includes(p.id)),Da=()=>{var Ve;const{enqueueSnackbar:n}=ra(),{data:l,loading:p,error:b}=ia(),{data:y,loading:A,error:ds}=la(),{data:E,loading:hs,error:xs,refetch:f}=oa(),{data:c,loading:ms,error:us,refetch:w}=ca(),{data:gs,loading:js,error:ps}=da(),vs=ha(),fs=xa(),bs=ma(),Ce=ua(),ys=ga(),de=ja(),[ws,O]=o.useState(!1),[Is,B]=o.useState(!1),[Ps,q]=o.useState(!1),[Cs,H]=o.useState(!1),[he,Te]=o.useState(""),[_,Le]=o.useState(""),[$,Ae]=o.useState(""),[Se,Ne]=o.useState("member"),[De,We]=o.useState(""),[Ee,Me]=o.useState(""),[ke,Re]=o.useState(""),[xe,K]=o.useState(""),[M,Ts]=o.useState(!0),[r,G]=o.useState(void 0),[Fe,ze]=o.useState(null),[S,Oe]=o.useState(""),[V,_e]=o.useState(""),[me,$e]=o.useState(""),[ue,Ge]=o.useState(""),[Ue,Be]=o.useState("member"),[qe,He]=o.useState(""),[Ls,J]=o.useState(!1),[Y,Z]=o.useState(""),[k,Q]=o.useState(""),[N,Ke]=o.useState(!0),As=p||A||hs||ms||js,Ss=b||ds||xs||us||ps;os.useEffect(()=>{M&&K(oe())},[M]),os.useEffect(()=>{const s=async()=>{await Promise.all([w(),f()])},i=async()=>{await Promise.all([f(),w()])};return window.addEventListener("licenses:refresh",s),window.addEventListener("team:refresh",i),()=>{window.removeEventListener("licenses:refresh",s),window.removeEventListener("team:refresh",i)}},[w,f]);const I=o.useMemo(()=>{if(!l||!y||!E||!c)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableLicenses:0,totalLicenses:0,assignedLicenses:0}};const s=E.filter(v=>v.status==="active").length,i=E.filter(v=>v.status==="pending").length,T=c.length,h=c.filter(v=>v.assignedTo).length,z=c.filter(v=>v.status==="PENDING"&&!v.assignedTo).length,j={totalMembers:E.length,activeMembers:s,pendingInvites:i,availableLicenses:z,totalLicenses:T,assignedLicenses:h};return{members:E,stats:j}},[l,y,E,c]),R=s=>{if(!s.licenseAssignment)return null;const i=c==null?void 0:c.find(T=>{var h;return T.id===((h=s.licenseAssignment)==null?void 0:h.licenseId)});return{licenseId:s.licenseAssignment.licenseId,licenseType:s.licenseAssignment.licenseType,licenseKey:s.licenseAssignment.licenseKey,status:(i==null?void 0:i.status)||"UNKNOWN"}},D=()=>c?c.filter(s=>s.status==="PENDING"&&!s.assignedTo):[],Ns=(s,i)=>{G(i),ze(s.currentTarget)},F=()=>{ze(null)},Ds=async()=>{var s,i,T;if(!he.trim()){n("Please enter an email address",{variant:"error"});return}if(!_.trim()){n("Please enter a first name",{variant:"error"});return}if(!$.trim()){n("Please enter a last name",{variant:"error"});return}if(!xe.trim()){n("Please provide a temporary password",{variant:"error"});return}if(D().length<=0){n("No available licenses. Please generate more licenses first.",{variant:"error"});return}if(!S){n("Please select a license to assign to this team member",{variant:"error"});return}try{const h={firstName:_.trim(),lastName:$.trim(),email:he.trim().toLowerCase(),role:Se,status:"pending",organization:{id:((s=l==null?void 0:l.organization)==null?void 0:s.id)||"",name:((i=l==null?void 0:l.organization)==null?void 0:i.name)||"",tier:((T=l==null?void 0:l.organization)==null?void 0:T.tier)||"BASIC"},department:De.trim()||"",assignedProjects:[],avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(_+" "+$)}&background=667eea&color=fff`},z=await vs.mutate({...h,temporaryPassword:xe,position:Ee.trim()||"",phone:ke.trim()||""});if(S&&z)try{await Ce.mutate({licenseId:S,userId:z});const j=c==null?void 0:c.find(v=>v.id===S);console.log(`âœ… [TeamPage] Assigned ${j==null?void 0:j.tier} license to new member:`,z)}catch(j){console.warn("Failed to assign selected license:",j)}n(`Team member ${_} ${$} created successfully with license assigned. They can now login with their email and temporary password.`,{variant:"success"}),console.log("ðŸ”„ Refreshing team data after member creation..."),await Promise.all([f(),w()]);try{const{unifiedDataService:j}=await Je(async()=>{const{unifiedDataService:v}=await import("./UnifiedDataService-DanHx1Ur.js");return{unifiedDataService:v}},__vite__mapDeps([0,1,2,3,4,5,6,7]));await j.forceRefreshLicenses(),j.clearCacheByPattern("org-team-members-"),j.clearCacheByPattern("org-users-"),console.log("ðŸ”„ Force refreshed team data via UnifiedDataService")}catch(j){console.warn("âš ï¸ Failed to force refresh via UnifiedDataService:",j)}setTimeout(async()=>{console.log("ðŸ”„ Secondary refresh for eventual consistency..."),await Promise.all([f(),w()])},1e3),setTimeout(async()=>{console.log("ðŸ”„ Final refresh for safety..."),await Promise.all([f(),w()])},3e3),window.dispatchEvent(new CustomEvent("team:refresh",{detail:{action:"member_created",memberId:z,licenseId:S}})),Te(""),Le(""),Ae(""),Ne("member"),We(""),Me(""),Re(""),K(oe()),Oe(""),O(!1)}catch(h){console.error("âŒ [TeamPage] Failed to create team member:",h),n((h==null?void 0:h.message)||"Failed to create team member",{variant:"error"})}},Ws=s=>{const i=s||r;if(!i){n("Unable to load member data. Please try again.",{variant:"error"});return}F(),G(i),$e(i.firstName||""),Ge(i.lastName||""),Be(i.role||"member"),He(i.department||""),J(!1),Z(""),Q(""),Ke(!0),B(!0)},Es=async()=>{if(!r){n("No team member selected",{variant:"error"});return}if(!ye(l,r)){n("You do not have permission to change this password",{variant:"error"});return}const s=N?oe():Y;if(!N){if(!s.trim()){n("Please enter a new password",{variant:"error"});return}if(s!==k){n("Passwords do not match",{variant:"error"});return}if(s.length<8){n("Password must be at least 8 characters long",{variant:"error"});return}}try{await de.mutate({memberId:r.id,newPassword:s}),n(`Password ${N?"generated and ":""}updated successfully for ${L(r)}`,{variant:"success"}),J(!1),Z(""),Q("")}catch(i){console.error("âŒ [TeamPage] Failed to update password:",i),n((i==null?void 0:i.message)||"Failed to update password",{variant:"error"})}},Ms=()=>{r&&(F(),q(!0))},ks=async()=>{if(r)try{const s=R(r);await bs.mutate({memberId:r.id}),s?n(`${L(r)} has been removed from the team. Their license has been released back to the available pool.`,{variant:"success"}):n(`${L(r)} has been removed from the team`,{variant:"success"}),q(!1),G(void 0),await Promise.all([f(),w()])}catch(s){console.error("âŒ [TeamPage] Failed to remove team member:",s),n((s==null?void 0:s.message)||"Failed to remove team member",{variant:"error"})}},Rs=()=>{r&&(n(`Invitation resent to ${r.email}`,{variant:"success"}),F())},Fs=async()=>{if(!r||!V){n("Please select a valid license to assign",{variant:"error"});return}try{await Ce.mutate({licenseId:V,userId:r.id}),n(`License assigned to ${L(r)}`,{variant:"success"}),_e(""),H(!1),F(),await Promise.all([w(),f()])}catch(s){console.error("âŒ [TeamPage] Failed to assign license:",s),n((s==null?void 0:s.message)||"Failed to assign license",{variant:"error"})}},zs=async()=>{if(r)try{const s=R(r);if(!s){n("This team member has no license to release",{variant:"warning"});return}await ys.mutate({licenseId:s.licenseId}),n(`${s.licenseType} license has been released from ${L(r)} and is now available for reassignment.`,{variant:"success"}),F(),await Promise.all([w(),f()])}catch(s){console.error("âŒ [TeamPage] Failed to release license:",s),n((s==null?void 0:s.message)||"Failed to release license",{variant:"error"})}},Os=async()=>{if(r)try{await fs.mutate({memberId:r.id,updates:{firstName:me,lastName:ue,role:Ue,department:qe||""}}),n(`Team member ${me} ${ue} updated successfully`,{variant:"success"}),B(!1),G(void 0),f()}catch(s){n((s==null?void 0:s.message)||"Failed to update team member",{variant:"error"})}},_s=async()=>{try{const{unifiedDataService:s}=await Je(async()=>{const{unifiedDataService:i}=await import("./UnifiedDataService-DanHx1Ur.js");return{unifiedDataService:i}},__vite__mapDeps([0,1,2,3,4,5,6,7]));await s.migrateExistingTeamMembers(),n("Team member migration completed successfully!",{variant:"success"}),await Promise.all([f(),w()])}catch(s){console.error("Migration failed:",s),n((s==null?void 0:s.message)||"Migration failed",{variant:"error"})}};return As?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(t,{textAlign:"center",children:[e.jsx(Ye,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):Ss?e.jsx(t,{sx:{p:3},children:e.jsxs(u,{severity:"error",children:[e.jsx(ge,{children:"Unable to Load Team Data"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs($s,{dense:!0,children:[e.jsxs(Ze,{children:[e.jsx(W,{children:e.jsx(Gs,{fontSize:"small"})}),e.jsx(Qe,{primary:"Network connectivity issues"})]}),e.jsxs(Ze,{children:[e.jsx(W,{children:e.jsx(je,{fontSize:"small"})}),e.jsx(Qe,{primary:"Authentication token expired"})]})]}),e.jsx(t,{sx:{mt:2},children:e.jsx(x,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!l||!y?e.jsx(t,{sx:{p:3},children:e.jsxs(u,{severity:"info",children:[e.jsx(ge,{children:"Setting Up Team Management"}),e.jsx(a,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(t,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(a,{variant:"body1",color:"text.secondary",children:["Manage your ",((Ve=y.organization)==null?void 0:Ve.name)||"Organization"," team members and permissions"]})]}),e.jsx(x,{variant:"contained",startIcon:e.jsx(pe,{}),onClick:()=>O(!0),disabled:D().length<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(U,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsx(le,{title:"Total Members",value:I.stats.totalMembers,icon:e.jsx(ce,{}),color:"primary"})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsx(le,{title:"Active Members",value:I.stats.activeMembers,icon:e.jsx(we,{}),color:"success"})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsx(le,{title:"Pending Invites",value:I.stats.pendingInvites,icon:e.jsx(Ie,{}),color:"warning"})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsx(le,{title:"Available Licenses",value:`${I.stats.availableLicenses}/${I.stats.totalLicenses}`,icon:e.jsx(P,{}),color:"primary"})})]}),I.stats.availableLicenses<=0&&e.jsxs(u,{severity:"warning",sx:{mb:4},children:[e.jsx(ge,{children:"No Available Licenses"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"You need to generate more licenses to invite new team members. Go to the Licenses page to create additional licenses."}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Generate Licenses"}),e.jsx(x,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(Us,{children:e.jsxs(Bs,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",I.members.length,")"]}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"outlined",startIcon:e.jsx(Xe,{}),onClick:_s,size:"small",sx:{color:"warning.main",borderColor:"warning.main","&:hover":{borderColor:"warning.dark",backgroundColor:"warning.light"}},children:"Fix Missing Members"}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(P,{}),onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Manage Licenses"})]})]}),e.jsx(qs,{children:e.jsxs(Hs,{children:[e.jsx(Ks,{children:e.jsxs(es,{children:[e.jsx(g,{sx:{fontWeight:600},children:"Member"}),e.jsx(g,{sx:{fontWeight:600},children:"Role"}),e.jsx(g,{sx:{fontWeight:600},children:"Status"}),e.jsx(g,{sx:{fontWeight:600},children:"Department"}),e.jsx(g,{sx:{fontWeight:600},children:"License"}),e.jsx(g,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(g,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Vs,{children:I.members.filter(s=>s&&s.id&&s.email).map(s=>{var i,T;return e.jsxs(es,{hover:!0,children:[e.jsx(g,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Js,{src:s.avatar,sx:{width:40,height:40},children:pa(s)}),e.jsxs(t,{children:[e.jsx(a,{variant:"body1",sx:{fontWeight:500},children:L(s)}),e.jsx(a,{variant:"body2",color:"text.secondary",children:s.email})]})]})}),e.jsx(g,{children:e.jsx(X,{label:((i=s.role)==null?void 0:i.toUpperCase())||"UNKNOWN",color:va(s.role),size:"small",icon:s.role==="admin"?e.jsx(Ys,{}):void 0})}),e.jsx(g,{children:e.jsx(X,{icon:cs(s.status),label:((T=s.status)==null?void 0:T.toUpperCase())||"UNKNOWN",color:fa(s.status),size:"small"})}),e.jsx(g,{children:e.jsx(a,{variant:"body2",children:s.department||"Unassigned"})}),e.jsx(g,{children:e.jsx(t,{children:(()=>{const h=R(s);return h?e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:h.licenseType}),e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[h.licenseKey.substring(0,12),"..."]}),e.jsx(X,{label:h.status,size:"small",color:h.status==="ACTIVE"?"success":"warning",sx:{mt:.5}})]}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"None"})})()})}),e.jsx(g,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.lastActive?new Date(s.lastActive).toLocaleDateString():"Never"})}),e.jsx(g,{children:e.jsx(ss,{size:"small",onClick:h=>Ns(h,s),disabled:s.role==="owner"&&s.id===(l==null?void 0:l.id),children:e.jsx(Zs,{})})})]},s.id)})})]})})]})}),e.jsx(Qs,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>O(!0),disabled:D().length<=0,children:e.jsx(Xs,{})}),e.jsxs(ee,{open:ws,onClose:()=>O(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(se,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(pe,{}),"Create New Team Member"]})}),e.jsx(ae,{children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(as,{})," Personal Information"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:_,onChange:s=>Le(s.target.value),placeholder:"John",required:!0}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:$,onChange:s=>Ae(s.target.value),placeholder:"Doe",required:!0})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:he,onChange:s=>Te(s.target.value),placeholder:"john.doe@company.com",required:!0,sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Phone Number (Optional)",value:ke,onChange:s=>Re(s.target.value),placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(ts,{})})}})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ns,{})," Role & Department"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(te,{fullWidth:!0,children:[e.jsx(ne,{children:"Role"}),e.jsxs(re,{value:Se,label:"Role",onChange:s=>Ne(s.target.value),children:[e.jsx(m,{value:"viewer",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(m,{value:"member",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(m,{value:"manager",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(m,{value:"admin",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:De,onChange:s=>We(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title (Optional)",value:Ee,onChange:s=>Me(s.target.value),placeholder:"Senior Developer, Product Manager..."})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{})," Authentication"]}),e.jsx(rs,{control:e.jsx(is,{checked:M,onChange:s=>Ts(s.target.checked)}),label:"Auto-generate secure password",sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Temporary Password",type:"password",value:xe,onChange:s=>K(s.target.value),disabled:M,required:!0,InputProps:{endAdornment:e.jsx(C,{position:"end",children:e.jsx(ss,{onClick:()=>K(oe()),disabled:!M,children:e.jsx(Xe,{})})})},helperText:M?"Password will be auto-generated":"User will need this password to login initially"})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(P,{})," License Assignment"]}),e.jsxs(te,{fullWidth:!0,sx:{mb:2},children:[e.jsx(ne,{children:"Select License to Assign"}),e.jsx(re,{value:S,label:"Select License to Assign",onChange:s=>Oe(s.target.value),required:!0,children:D().length===0?e.jsx(m,{disabled:!0,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"No available licenses found"})}):D().map(s=>e.jsx(m,{value:s.id,children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(P,{color:"primary"}),e.jsxs(t,{sx:{flex:1},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:s.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.tier," â€¢ ",s.key," â€¢ Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id))}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Only unassigned PENDING licenses are available for assignment"})]}),e.jsxs(u,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸŽ« License Assignment Details"}),e.jsx(a,{variant:"body2",children:"This team member will be created as a full Firebase authenticated user and assigned the selected license. They can login immediately with their email and temporary password."}),e.jsxs(a,{variant:"body2",sx:{mt:1,fontWeight:500},children:["Available licenses: ",I.stats.availableLicenses," of ",I.stats.totalLicenses]})]})]}),D().length<=0&&e.jsx(u,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No licenses available! Please generate more licenses before creating team members."})})]})}),e.jsxs(ie,{children:[e.jsx(x,{onClick:()=>O(!1),children:"Cancel"}),e.jsx(x,{onClick:Ds,variant:"contained",startIcon:e.jsx(pe,{}),disabled:D().length<=0||!S,children:"Create Team Member"})]})]}),e.jsxs(ee,{open:Is,onClose:()=>{B(!1),G(void 0)},maxWidth:"md",fullWidth:!0,children:[e.jsx(se,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ve,{}),"ðŸš€ ENHANCED Edit Team Member: ",(r==null?void 0:r.firstName)||"Loading..."," ",(r==null?void 0:r.lastName)||""]})}),e.jsx(ae,{children:r?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(as,{})," Personal Information"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:me,onChange:s=>$e(s.target.value),required:!0,placeholder:"John"}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:ue,onChange:s=>Ge(s.target.value),required:!0,placeholder:"Doe"})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:r.email,disabled:!0,sx:{mb:2},helperText:"Email cannot be changed after account creation"}),e.jsx(d,{fullWidth:!0,label:"Phone Number",value:"",disabled:!0,placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(ts,{})})},helperText:"Phone number not available in current data model"})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ns,{})," Role & Department"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(te,{fullWidth:!0,children:[e.jsx(ne,{children:"Role"}),e.jsxs(re,{value:Ue,label:"Role",onChange:s=>Be(s.target.value),children:[e.jsx(m,{value:"viewer",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(m,{value:"member",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(m,{value:"manager",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(m,{value:"admin",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:qe,onChange:s=>He(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title",value:"",disabled:!0,placeholder:"Senior Developer, Product Manager...",helperText:"Position not available in current data model"})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(P,{})," License & Access"]}),(()=>{const s=R(r);return e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"License Type",value:(s==null?void 0:s.licenseType)||"None",disabled:!0,InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(P,{})})}}),e.jsx(d,{fullWidth:!0,label:"License Status",value:s?s.status:"Unassigned",disabled:!0,InputProps:{startAdornment:e.jsx(C,{position:"start",children:s?e.jsx(we,{}):e.jsx(Ie,{})})}})]})})(),e.jsx(d,{fullWidth:!0,label:"Last Active",value:r.lastActive?new Date(r.lastActive).toLocaleString():"Never",disabled:!0,InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(ea,{})})}})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ls,{})," Project Assignments"]}),(()=>{const s=ba(r,gs||[]);return s.length>0?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.map(i=>e.jsx(X,{label:i.name,color:"primary",variant:"outlined",size:"small",icon:e.jsx(ls,{}),sx:{maxWidth:200}},i.id))}),e.jsxs(t,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx("strong",{children:"Project Details:"})}),s.map(i=>e.jsxs(t,{sx:{mb:1,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:i.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Mode: ",i.mode," â€¢ Storage: ",i.storageBackend," â€¢ Status: ",i.status]}),i.description&&e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:i.description})]},i.id))]})]}):e.jsx(u,{severity:"info",children:e.jsx(a,{variant:"body2",children:"No projects assigned yet. This team member can be assigned to projects from the Cloud Projects page."})})})()]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{})," Account Status"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"Account Status",value:r.status,disabled:!0,InputProps:{startAdornment:e.jsx(C,{position:"start",children:cs(r.status)})}}),e.jsx(d,{fullWidth:!0,label:"Member Since",value:r.joinedAt?new Date(r.joinedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(ce,{})})}})]})]}),ye(l,r)&&e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(fe,{})," Password Management"]}),Ls?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(u,{severity:"warning",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸ” Password Change"}),e.jsx(a,{variant:"body2",children:N?"A secure password will be automatically generated.":"Please enter a new password with at least 8 characters."})]}),e.jsx(rs,{control:e.jsx(is,{checked:N,onChange:s=>Ke(s.target.checked)}),label:"Auto-generate secure password"}),!N&&e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(d,{fullWidth:!0,label:"New Password",type:"password",value:Y,onChange:s=>Z(s.target.value),placeholder:"Enter new password (min 8 characters)",required:!0,InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(fe,{})})}}),e.jsx(d,{fullWidth:!0,label:"Confirm Password",type:"password",value:k,onChange:s=>Q(s.target.value),placeholder:"Confirm new password",required:!0,error:k!==""&&Y!==k,helperText:k!==""&&Y!==k?"Passwords do not match":"",InputProps:{startAdornment:e.jsx(C,{position:"start",children:e.jsx(fe,{})})}})]}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",startIcon:e.jsx(be,{}),onClick:Es,disabled:de.loading,sx:{background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)",color:"white",fontWeight:600},children:de.loading?"Updating...":N?"Generate & Update Password":"Update Password"}),e.jsx(x,{variant:"outlined",onClick:()=>{J(!1),Z(""),Q("")},children:"Cancel"})]})]}):e.jsxs(t,{children:[e.jsxs(u,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"ðŸ” Password Access"})}),e.jsx(a,{variant:"body2",children:(l==null?void 0:l.id)===r.id?"You can change your own password here.":(l==null?void 0:l.role)==="ENTERPRISE_USER"||(l==null?void 0:l.role)==="owner"?"As the account owner, you can change this team member's password.":"As an admin, you can change this team member's password."})]}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(be,{}),onClick:()=>J(!0),sx:{mb:2},children:"Change Password"})]})]}),e.jsxs(u,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"âš ï¸ Important Notes"}),e.jsxs(a,{variant:"body2",children:["â€¢ Role changes will immediately affect the member's permissions and access levels",e.jsx("br",{}),"â€¢ Department information helps with organization and project assignments",e.jsx("br",{}),"â€¢ Project assignments are managed from the Cloud Projects page",e.jsx("br",{}),"â€¢ License assignments are managed through the Licenses page",e.jsx("br",{}),ye(l,r)&&"â€¢ Password changes take effect immediately"]})]})]}):e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(t,{textAlign:"center",children:[e.jsx(Ye,{size:40,sx:{mb:2}}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Loading member data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"If this persists, please close and try again."})]})})}),e.jsxs(ie,{children:[e.jsx(x,{onClick:()=>B(!1),children:"Cancel"}),e.jsx(x,{onClick:Os,variant:"contained",startIcon:e.jsx(ve,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(ee,{open:Ps,onClose:()=>q(!1),maxWidth:"sm",children:[e.jsx(se,{children:"Remove Team Member"}),e.jsx(ae,{children:r&&e.jsxs(t,{children:[e.jsxs(a,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsx("strong",{children:L(r)})," from your team?"]}),(()=>{const s=R(r);return s?e.jsxs(u,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸŽ« License Management"}),e.jsxs(a,{variant:"body2",children:["This team member currently has a ",e.jsx("strong",{children:s.licenseType})," license assigned. When removed, their license will be automatically released back to your available license pool and can be reassigned to another team member."]})]}):e.jsx(u,{severity:"info",sx:{mb:2},children:e.jsx(a,{variant:"body2",children:"This team member has no license assigned, so no license will be affected."})})})(),e.jsx(u,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources."})})]})}),e.jsxs(ie,{children:[e.jsx(x,{onClick:()=>q(!1),children:"Cancel"}),e.jsx(x,{onClick:ks,variant:"contained",color:"error",startIcon:e.jsx(Pe,{}),children:"Remove Member"})]})]}),e.jsxs(sa,{anchorEl:Fe,open:!!Fe,onClose:F,children:[e.jsxs(m,{onClick:()=>Ws(r),children:[e.jsx(W,{children:e.jsx(ve,{})}),"Edit Member"]}),r?R(r)?e.jsxs(m,{onClick:zs,children:[e.jsx(W,{children:e.jsx(be,{})}),"Release License"]}):e.jsxs(m,{onClick:()=>H(!0),children:[e.jsx(W,{children:e.jsx(P,{})}),"Assign License"]}):null,(r==null?void 0:r.status)==="pending"&&e.jsxs(m,{onClick:Rs,children:[e.jsx(W,{children:e.jsx(aa,{})}),"Resend Invite"]}),e.jsx(ta,{}),e.jsxs(m,{onClick:Ms,sx:{color:"error.main"},children:[e.jsx(W,{children:e.jsx(Pe,{sx:{color:"error.main"}})}),"Remove Member"]})]}),e.jsxs(ee,{open:Cs,onClose:()=>H(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(se,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(P,{}),"Assign License to ",r?L(r):"Team Member"]})}),e.jsx(ae,{children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(u,{severity:"info",children:e.jsxs(a,{variant:"body2",children:["Assigning a license to ",e.jsx("strong",{children:r?L(r):"Team Member"})," (",r==null?void 0:r.email,")"]})}),e.jsxs(te,{fullWidth:!0,children:[e.jsx(ne,{children:"Select License"}),e.jsx(re,{value:V,label:"Select License",onChange:s=>_e(s.target.value),children:c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).map(s=>e.jsx(m,{value:s.id,children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(P,{color:"primary"}),e.jsxs(t,{children:[e.jsxs(a,{variant:"body2",sx:{fontWeight:500},children:[s.tier," License"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.key," â€¢ Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id))}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Only unassigned PENDING licenses are available for assignment"})]}),(c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0&&e.jsx(u,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No available licenses found. All licenses are either assigned or not in PENDING status."})}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"The selected license will be assigned to this team member and they will have immediate access to the system."})]})}),e.jsxs(ie,{children:[e.jsx(x,{onClick:()=>H(!1),children:"Cancel"}),e.jsx(x,{onClick:Fs,variant:"contained",startIcon:e.jsx(P,{}),disabled:!V||(c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0,children:"Assign License"})]})]})]})};export{Da as default};
