import{j as e,B as n,C as Fe,T as a,d as p,ai as ee,w as Ts,x as ze,y as D,aj as Ls,z as Oe,H as se,a as x,aG as ae,G as M,W as xe,p as he,am as me,u as _,t as As,v as Ss,aq as Ws,ar as Ns,as as Es,at as $e,au as h,av as Ds,ag as Ms,r as ne,aZ as ks,g as qe,aw as Rs,ax as Fs,ap as zs,ay as te,az as re,aB as ie,a_ as Be,e as d,I as v,a$ as Ge,b0 as He,aC as _e,aD as Ue,aE as Je,a5 as g,F as Ve,s as Ye,R as Os,aF as oe,aI as le,aL as $s,b1 as Ke,L as de,b2 as Ze,aH as ue,a4 as qs,E as Bs,D as Gs,aJ as Hs}from"./mui-Cr9U6iW2.js";import{r as l,b as Qe}from"./vendor-CjD1bmmO.js";import{u as _s}from"./notistack.esm-Ca-E78ev.js";import{b as Us,c as Js,a as Vs,u as Ys,h as Ks,j as Zs,k as Qs,l as Xs,f as ea,g as sa,m as aa}from"./useStreamlinedData-BPF1_Gp1.js";import{M as U}from"./MetricCard-CCtxyf7i.js";import"./UnifiedDataService-BJ1w2JLX.js";import"./index-D39nysFB.js";import"./stripe-ggaMUove.js";import"./index.esm-B4qVkIPL.js";import"./index.esm-DmQE6AXN.js";const na=i=>{switch(i){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},ta=i=>{switch(i){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},Xe=i=>{switch(i){case"active":return e.jsx(he,{});case"pending":return e.jsx(me,{});case"suspended":return e.jsx(Hs,{});case"removed":return e.jsx(ue,{});default:return e.jsx(xe,{})}},J=()=>{const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let j="";for(let y=0;y<12;y++)j+=r.charAt(Math.floor(Math.random()*r.length));return j},ce=(i,r)=>{var w,k;if(console.log("🔐 [canManagePassword] Checking permissions:",{currentUser:i,currentUserRole:i==null?void 0:i.role,currentUserId:i==null?void 0:i.id,targetMember:r,targetMemberRole:r==null?void 0:r.role,targetMemberId:r==null?void 0:r.id}),!i||!r)return console.log("🔐 [canManagePassword] Missing user data"),!1;const j=(w=i.role)==null?void 0:w.toUpperCase(),y=(k=r.role)==null?void 0:k.toUpperCase();return j==="ENTERPRISE_USER"||j==="OWNER"?(console.log("🔐 [canManagePassword] Enterprise user/Owner can manage all passwords"),!0):j==="ADMIN"&&y!=="ENTERPRISE_USER"&&y!=="OWNER"?(console.log("🔐 [canManagePassword] Admin can manage non-owner passwords"),!0):i.id===r.id?(console.log("🔐 [canManagePassword] User can manage own password"),!0):(console.log("🔐 [canManagePassword] No permission to manage password"),!1)},ra=(i,r)=>!i.assignedProjects||!r?[]:r.filter(j=>i.assignedProjects.includes(j.id)),ja=()=>{var ke,Re;const{enqueueSnackbar:i}=_s(),{data:r,loading:j,error:y}=Us(),{data:w,loading:k,error:es}=Js(),{data:I,loading:ss,error:as,refetch:R}=Vs(),{data:f,loading:ns,error:ts,refetch:V}=Ys(),{data:rs,loading:is,error:os}=Ks(),ls=Zs(),ds=Qs();Xs();const cs=ea();sa();const Y=aa(),[xs,A]=l.useState(!1),[hs,F]=l.useState(!1),[ms,z]=l.useState(!1),[K,ge]=l.useState(""),[S,je]=l.useState(""),[W,pe]=l.useState(""),[ve,fe]=l.useState("member"),[be,ye]=l.useState(""),[we,Pe]=l.useState(""),[Ce,Ie]=l.useState(""),[Z,O]=l.useState(""),[T,us]=l.useState(!0),[t,N]=l.useState(void 0),[Te,Le]=l.useState(null),[Q,Ae]=l.useState(""),[X,Se]=l.useState(""),[We,Ne]=l.useState("member"),[Ee,De]=l.useState(""),[gs,$]=l.useState(!1),[q,B]=l.useState(""),[L,G]=l.useState(""),[P,Me]=l.useState(!0),js=j||k||ss||ns||is,ps=y||es||as||ts||os;Qe.useEffect(()=>{T&&O(J())},[T]),Qe.useEffect(()=>{const s=async()=>{console.log("🔄 [TeamPage] License refresh event detected, refetching data..."),await Promise.all([V(),R()])};return window.addEventListener("licenses:refresh",s),()=>{window.removeEventListener("licenses:refresh",s)}},[V,R]);const c=l.useMemo(()=>{if(!r||!w||!I||!f)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableLicenses:0,totalLicenses:0,assignedLicenses:0}};const s=I.filter(m=>m.status==="active").length,o=I.filter(m=>m.status==="pending").length,b=f.length,u=f.filter(m=>m.assignedTo).length,C=f.filter(m=>m.status==="PENDING"&&!m.assignedTo).length;console.log("📊 [TeamPage] License stats:",{totalLicenses:b,assignedLicenses:u,availableLicenses:C});const E={totalMembers:I.length,activeMembers:s,pendingInvites:o,availableLicenses:C,totalLicenses:b,assignedLicenses:u};return{members:I,stats:E}},[r,w,I,f]),vs=(s,o)=>{console.log("🔧 [TeamPage] Menu clicked for member:",o),N(o),Le(s.currentTarget)},H=()=>{Le(null)},fs=async()=>{var s,o,b;if(!K.trim()){i("Please enter an email address",{variant:"error"});return}if(!S.trim()){i("Please enter a first name",{variant:"error"});return}if(!W.trim()){i("Please enter a last name",{variant:"error"});return}if(!Z.trim()){i("Please provide a temporary password",{variant:"error"});return}if(c.stats.availableLicenses<=0){i("No available licenses. Please generate more licenses first.",{variant:"error"});return}try{console.log("👤 [TeamPage] Creating full user with Firebase authentication...");const u={firstName:S.trim(),lastName:W.trim(),email:K.trim().toLowerCase(),role:ve,status:"pending",organization:{id:((s=r==null?void 0:r.organization)==null?void 0:s.id)||"",name:((o=r==null?void 0:r.organization)==null?void 0:o.name)||"",tier:((b=r==null?void 0:r.organization)==null?void 0:b.tier)||"BASIC"},department:be.trim()||void 0,assignedProjects:[],avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(S+" "+W)}&background=667eea&color=fff`},C=await ls.mutate({...u,temporaryPassword:Z,position:we.trim()||void 0,phone:Ce.trim()||void 0});console.log("✅ [TeamPage] Team member created with ID:",C);const E=f==null?void 0:f.find(m=>m.status==="PENDING"&&!m.assignedTo);if(E&&C)try{await cs.mutate({licenseId:E.id,userId:C}),console.log("✅ [TeamPage] Auto-assigned license",E.id,"to new member",C)}catch(m){console.warn("⚠️ [TeamPage] Failed to auto-assign license:",m)}i(`Team member ${S} ${W} created successfully with license assigned. They can now login with their email and temporary password.`,{variant:"success"}),ge(""),je(""),pe(""),fe("member"),ye(""),Pe(""),Ie(""),O(J()),A(!1),await Promise.all([R(),V()])}catch(u){console.error("❌ [TeamPage] Failed to create team member:",u),i((u==null?void 0:u.message)||"Failed to create team member",{variant:"error"})}},bs=s=>{const o=t;if(!o){console.error("🔧 [TeamPage] No member provided for editing"),i("Unable to load member data. Please try again.",{variant:"error"});return}console.log("🔧 [TeamPage] Opening edit dialog for member:",o),H(),N(o),Ae(o.firstName||""),Se(o.lastName||""),Ne(o.role||"member"),De(o.department||""),$(!1),B(""),G(""),Me(!0),F(!0)},ys=async()=>{if(!t){i("No team member selected",{variant:"error"});return}if(!ce(r,t)){i("You do not have permission to change this password",{variant:"error"});return}const s=P?J():q;if(!P){if(!s.trim()){i("Please enter a new password",{variant:"error"});return}if(s!==L){i("Passwords do not match",{variant:"error"});return}if(s.length<8){i("Password must be at least 8 characters long",{variant:"error"});return}}try{await Y.mutate({memberId:t.id||t.userId,newPassword:s}),console.log("🔐 [TeamPage] Password change requested for member:",t.email),i(`Password ${P?"generated and ":""}updated successfully for ${t.firstName} ${t.lastName}`,{variant:"success"}),$(!1),B(""),G("")}catch(o){console.error("❌ [TeamPage] Failed to update password:",o),i((o==null?void 0:o.message)||"Failed to update password",{variant:"error"})}},ws=()=>{t&&(H(),z(!0))},Ps=async()=>{if(t)try{i(`${t.firstName} ${t.lastName} has been removed from the team`,{variant:"success"}),z(!1),N(void 0)}catch(s){i((s==null?void 0:s.message)||"Failed to remove team member",{variant:"error"})}},Cs=()=>{t&&(i(`Invitation resent to ${t.email}`,{variant:"success"}),H())},Is=async()=>{if(t)try{await ds.mutate({memberId:t.id,updates:{firstName:Q,lastName:X,role:We,department:Ee}}),i(`Team member ${Q} ${X} updated successfully`,{variant:"success"}),F(!1),N(void 0),R()}catch(s){i((s==null?void 0:s.message)||"Failed to update team member",{variant:"error"})}};return js?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(n,{textAlign:"center",children:[e.jsx(Fe,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):ps?e.jsx(n,{sx:{p:3},children:e.jsxs(p,{severity:"error",children:[e.jsx(ee,{children:"Unable to Load Team Data"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs(Ts,{dense:!0,children:[e.jsxs(ze,{children:[e.jsx(D,{children:e.jsx(Ls,{fontSize:"small"})}),e.jsx(Oe,{primary:"Network connectivity issues"})]}),e.jsxs(ze,{children:[e.jsx(D,{children:e.jsx(se,{fontSize:"small"})}),e.jsx(Oe,{primary:"Authentication token expired"})]})]}),e.jsx(n,{sx:{mt:2},children:e.jsx(x,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!r||!w?e.jsx(n,{sx:{p:3},children:e.jsxs(p,{severity:"info",children:[e.jsx(ee,{children:"Setting Up Team Management"}),e.jsx(a,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(n,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(a,{variant:"body1",color:"text.secondary",children:["Manage your ",((ke=w.organization)==null?void 0:ke.name)||"Organization"," team members and permissions"]})]}),e.jsx(x,{variant:"contained",startIcon:e.jsx(ae,{}),onClick:()=>A(!0),disabled:c.stats.availableLicenses<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(M,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(M,{item:!0,xs:12,sm:6,md:3,children:e.jsx(U,{title:"Total Members",value:c.stats.totalMembers,icon:e.jsx(xe,{}),color:"primary"})}),e.jsx(M,{item:!0,xs:12,sm:6,md:3,children:e.jsx(U,{title:"Active Members",value:c.stats.activeMembers,icon:e.jsx(he,{}),color:"success"})}),e.jsx(M,{item:!0,xs:12,sm:6,md:3,children:e.jsx(U,{title:"Pending Invites",value:c.stats.pendingInvites,icon:e.jsx(me,{}),color:"warning"})}),e.jsx(M,{item:!0,xs:12,sm:6,md:3,children:e.jsx(U,{title:"Available Licenses",value:`${c.stats.availableLicenses}/${c.stats.totalLicenses}`,icon:e.jsx(_,{}),color:"primary"})})]}),c.stats.availableLicenses<=0&&e.jsxs(p,{severity:"warning",sx:{mb:4},children:[e.jsx(ee,{children:"No Available Licenses"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"You need to generate more licenses to invite new team members. Go to the Licenses page to create additional licenses."}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Generate Licenses"}),e.jsx(x,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(As,{children:e.jsxs(Ss,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",c.members.length,")"]}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(_,{}),onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Manage Licenses"})]}),e.jsx(Ws,{children:e.jsxs(Ns,{children:[e.jsx(Es,{children:e.jsxs($e,{children:[e.jsx(h,{sx:{fontWeight:600},children:"Member"}),e.jsx(h,{sx:{fontWeight:600},children:"Role"}),e.jsx(h,{sx:{fontWeight:600},children:"Status"}),e.jsx(h,{sx:{fontWeight:600},children:"Department"}),e.jsx(h,{sx:{fontWeight:600},children:"License"}),e.jsx(h,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(h,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Ds,{children:c.members.map(s=>{var o,b;return e.jsxs($e,{hover:!0,children:[e.jsx(h,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(Ms,{src:s.avatar,sx:{width:40,height:40},children:[s.firstName.charAt(0),s.lastName.charAt(0)]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"body1",sx:{fontWeight:500},children:[s.firstName," ",s.lastName]}),e.jsx(a,{variant:"body2",color:"text.secondary",children:s.email})]})]})}),e.jsx(h,{children:e.jsx(ne,{label:s.role.toUpperCase(),color:na(s.role),size:"small",icon:s.role==="admin"?e.jsx(ks,{}):void 0})}),e.jsx(h,{children:e.jsx(ne,{icon:Xe(s.status),label:s.status.toUpperCase(),color:ta(s.status),size:"small"})}),e.jsx(h,{children:e.jsx(a,{variant:"body2",children:s.department||"Unassigned"})}),e.jsx(h,{children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:((o=s.licenseAssignment)==null?void 0:o.licenseType)||"None"}),((b=s.licenseAssignment)==null?void 0:b.licenseKey)&&e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[s.licenseAssignment.licenseKey.substring(0,12),"..."]})]})}),e.jsx(h,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.lastActive?new Date(s.lastActive).toLocaleDateString():"Never"})}),e.jsx(h,{children:e.jsx(qe,{size:"small",onClick:u=>vs(u,s),disabled:s.role==="owner"&&s.id===r.id,children:e.jsx(Rs,{})})})]},s.id)})})]})})]})}),e.jsx(Fs,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>A(!0),disabled:c.stats.availableLicenses<=0,children:e.jsx(zs,{})}),e.jsxs(te,{open:xs,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(re,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ae,{}),"Create New Team Member"]})}),e.jsx(ie,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Be,{})," Personal Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:S,onChange:s=>je(s.target.value),placeholder:"John",required:!0}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:W,onChange:s=>pe(s.target.value),placeholder:"Doe",required:!0})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:K,onChange:s=>ge(s.target.value),placeholder:"john.doe@company.com",required:!0,sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Phone Number (Optional)",value:Ce,onChange:s=>Ie(s.target.value),placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(Ge,{})})}})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(He,{})," Role & Department"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(_e,{fullWidth:!0,children:[e.jsx(Ue,{children:"Role"}),e.jsxs(Je,{value:ve,label:"Role",onChange:s=>fe(s.target.value),children:[e.jsx(g,{value:"viewer",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(g,{value:"member",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(g,{value:"manager",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(g,{value:"admin",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:be,onChange:s=>ye(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title (Optional)",value:we,onChange:s=>Pe(s.target.value),placeholder:"Senior Developer, Product Manager..."})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(se,{})," Authentication"]}),e.jsx(Ve,{control:e.jsx(Ye,{checked:T,onChange:s=>us(s.target.checked)}),label:"Auto-generate secure password",sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Temporary Password",type:"password",value:Z,onChange:s=>O(s.target.value),disabled:T,required:!0,InputProps:{endAdornment:e.jsx(v,{position:"end",children:e.jsx(qe,{onClick:()=>O(J()),disabled:!T,children:e.jsx(Os,{})})})},helperText:T?"Password will be auto-generated":"User will need this password to login initially"})]}),e.jsxs(p,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🎫 License Assignment"}),e.jsx(a,{variant:"body2",children:"This team member will be created as a full Firebase authenticated user and automatically assigned an available license. They can login immediately with their email and temporary password."}),e.jsxs(a,{variant:"body2",sx:{mt:1,fontWeight:500},children:["Available licenses: ",c.stats.availableLicenses," of ",c.stats.totalLicenses]})]}),c.stats.availableLicenses<=0&&e.jsx(p,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No licenses available! Please generate more licenses before creating team members."})})]})}),e.jsxs(oe,{children:[e.jsx(x,{onClick:()=>A(!1),children:"Cancel"}),e.jsx(x,{onClick:fs,variant:"contained",startIcon:e.jsx(ae,{}),disabled:c.stats.availableLicenses<=0,children:"Create Team Member"})]})]}),e.jsxs(te,{open:hs,onClose:()=>{F(!1),N(void 0)},maxWidth:"md",fullWidth:!0,children:[e.jsx(re,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(le,{}),"🚀 ENHANCED Edit Team Member: ",(t==null?void 0:t.firstName)||"Loading..."," ",(t==null?void 0:t.lastName)||""]})}),e.jsx(ie,{children:t?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Be,{})," Personal Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:Q,onChange:s=>Ae(s.target.value),required:!0,placeholder:"John"}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:X,onChange:s=>Se(s.target.value),required:!0,placeholder:"Doe"})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:t.email,disabled:!0,sx:{mb:2},helperText:"Email cannot be changed after account creation"}),e.jsx(d,{fullWidth:!0,label:"Phone Number",value:"",disabled:!0,placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(Ge,{})})},helperText:"Phone number not available in current data model"})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(He,{})," Role & Department"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(_e,{fullWidth:!0,children:[e.jsx(Ue,{children:"Role"}),e.jsxs(Je,{value:We,label:"Role",onChange:s=>Ne(s.target.value),children:[e.jsx(g,{value:"viewer",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(g,{value:"member",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(g,{value:"manager",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(g,{value:"admin",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:Ee,onChange:s=>De(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title",value:"",disabled:!0,placeholder:"Senior Developer, Product Manager...",helperText:"Position not available in current data model"})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(_,{})," License & Access"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"License Type",value:((Re=t.licenseAssignment)==null?void 0:Re.licenseType)||"None",disabled:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(_,{})})}}),e.jsx(d,{fullWidth:!0,label:"License Status",value:t.licenseAssignment?"Assigned":"Unassigned",disabled:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:t.licenseAssignment?e.jsx(he,{}):e.jsx(me,{})})}})]}),e.jsx(d,{fullWidth:!0,label:"Last Active",value:t.lastActive?new Date(t.lastActive).toLocaleString():"Never",disabled:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx($s,{})})}})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ke,{})," Project Assignments"]}),(()=>{const s=ra(t,rs||[]);return s.length>0?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.map(o=>e.jsx(ne,{label:o.name,color:"primary",variant:"outlined",size:"small",icon:e.jsx(Ke,{}),sx:{maxWidth:200}},o.id))}),e.jsxs(n,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx("strong",{children:"Project Details:"})}),s.map(o=>e.jsxs(n,{sx:{mb:1,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:o.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Mode: ",o.mode," • Storage: ",o.storageBackend," • Status: ",o.status]}),o.description&&e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:o.description})]},o.id))]})]}):e.jsx(p,{severity:"info",children:e.jsx(a,{variant:"body2",children:"No projects assigned yet. This team member can be assigned to projects from the Cloud Projects page."})})})()]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(se,{})," Account Status"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"Account Status",value:t.status,disabled:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:Xe(t.status)})}}),e.jsx(d,{fullWidth:!0,label:"Member Since",value:t.joinedAt?new Date(t.joinedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(xe,{})})}})]})]}),(()=>{const s=ce(r,t);return console.log("🔐 [TeamPage] Password permission check:",{currentUser:r,selectedMember:t,canManage:s}),s})()&&e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{})," Password Management"]}),gs?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(p,{severity:"warning",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🔐 Password Change"}),e.jsx(a,{variant:"body2",children:P?"A secure password will be automatically generated.":"Please enter a new password with at least 8 characters."})]}),e.jsx(Ve,{control:e.jsx(Ye,{checked:P,onChange:s=>Me(s.target.checked)}),label:"Auto-generate secure password"}),!P&&e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(d,{fullWidth:!0,label:"New Password",type:"password",value:q,onChange:s=>B(s.target.value),placeholder:"Enter new password (min 8 characters)",required:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(de,{})})}}),e.jsx(d,{fullWidth:!0,label:"Confirm Password",type:"password",value:L,onChange:s=>G(s.target.value),placeholder:"Confirm new password",required:!0,error:L!==""&&q!==L,helperText:L!==""&&q!==L?"Passwords do not match":"",InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(de,{})})}})]}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",startIcon:e.jsx(Ze,{}),onClick:ys,disabled:Y.loading,sx:{background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)",color:"white",fontWeight:600},children:Y.loading?"Updating...":P?"Generate & Update Password":"Update Password"}),e.jsx(x,{variant:"outlined",onClick:()=>{$(!1),B(""),G("")},children:"Cancel"})]})]}):e.jsxs(n,{children:[e.jsxs(p,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"🔐 Password Access"})}),e.jsx(a,{variant:"body2",children:(r==null?void 0:r.id)===t.id?"You can change your own password here.":(r==null?void 0:r.role)==="ENTERPRISE_USER"||(r==null?void 0:r.role)==="owner"?"As the account owner, you can change this team member's password.":"As an admin, you can change this team member's password."})]}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(Ze,{}),onClick:()=>$(!0),sx:{mb:2},children:"Change Password"})]})]}),e.jsxs(p,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"⚠️ Important Notes"}),e.jsxs(a,{variant:"body2",children:["• Role changes will immediately affect the member's permissions and access levels",e.jsx("br",{}),"• Department information helps with organization and project assignments",e.jsx("br",{}),"• Project assignments are managed from the Cloud Projects page",e.jsx("br",{}),"• License assignments are managed through the Licenses page",e.jsx("br",{}),ce(r,t)&&"• Password changes take effect immediately"]})]})]}):e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(n,{textAlign:"center",children:[e.jsx(Fe,{size:40,sx:{mb:2}}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Loading member data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"If this persists, please close and try again."})]})})}),e.jsxs(oe,{children:[e.jsx(x,{onClick:()=>F(!1),children:"Cancel"}),e.jsx(x,{onClick:Is,variant:"contained",startIcon:e.jsx(le,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(te,{open:ms,onClose:()=>z(!1),maxWidth:"sm",children:[e.jsx(re,{children:"Remove Team Member"}),e.jsx(ie,{children:t&&e.jsxs(n,{children:[e.jsxs(a,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsxs("strong",{children:[t.firstName," ",t.lastName]})," from your team?"]}),e.jsx(p,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources. Their license will be freed up for reassignment."})})]})}),e.jsxs(oe,{children:[e.jsx(x,{onClick:()=>z(!1),children:"Cancel"}),e.jsx(x,{onClick:Ps,variant:"contained",color:"error",startIcon:e.jsx(ue,{}),children:"Remove Member"})]})]}),e.jsxs(qs,{anchorEl:Te,open:!!Te,onClose:H,children:[e.jsxs(g,{onClick:()=>bs(),children:[e.jsx(D,{children:e.jsx(le,{})}),"Edit Member"]}),(t==null?void 0:t.status)==="pending"&&e.jsxs(g,{onClick:Cs,children:[e.jsx(D,{children:e.jsx(Bs,{})}),"Resend Invite"]}),e.jsx(Gs,{}),e.jsxs(g,{onClick:ws,sx:{color:"error.main"},children:[e.jsx(D,{children:e.jsx(ue,{sx:{color:"error.main"}})}),"Remove Member"]})]})]})};export{ja as default};
