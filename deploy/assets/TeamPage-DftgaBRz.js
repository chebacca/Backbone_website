import{j as e,B as t,C as He,T as a,d as p,ai as xe,w as Ws,x as _e,y as A,aj as Ds,z as Ue,H as he,a as x,aG as me,G as F,W as be,p as ye,am as we,u as b,t as Es,v as ks,aq as Ms,ar as Rs,as as Fs,at as Ke,au as m,av as zs,ag as Os,r as Y,aZ as Gs,g as Ve,aw as $s,ax as qs,ap as Bs,ay as Z,az as Q,aB as X,a_ as Je,e as d,I as f,a$ as Ye,b0 as Ze,aC as ue,aD as ge,aE as je,a5 as j,F as Qe,s as Xe,R as Hs,aF as ee,aI as pe,aL as _s,b1 as es,L as ve,b2 as ss,aH as Pe,a4 as Us,E as Ks,D as Vs,aJ as Js}from"./mui-Cr9U6iW2.js";import{r as o,b as as}from"./vendor-CjD1bmmO.js";import{u as Ys}from"./notistack.esm-Ca-E78ev.js";import{b as Zs,c as Qs,a as Xs,u as ea,h as sa,j as aa,k as na,l as ta,f as ra,g as ia,m as la}from"./useStreamlinedData-BHcq7xMu.js";import{M as se}from"./MetricCard-CCtxyf7i.js";import"./UnifiedDataService-BNLqaFPv.js";import"./index-dE98RdCu.js";import"./stripe-ggaMUove.js";import"./index.esm-B4qVkIPL.js";import"./index.esm-DmQE6AXN.js";const oa=r=>{switch(r){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},ca=r=>{switch(r){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},ns=r=>{switch(r){case"active":return e.jsx(ye,{});case"pending":return e.jsx(we,{});case"suspended":return e.jsx(Js,{});case"removed":return e.jsx(Pe,{});default:return e.jsx(be,{})}},ae=()=>{const i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let v="";for(let y=0;y<12;y++)v+=i.charAt(Math.floor(Math.random()*i.length));return v},fe=(r,i)=>{var w,z;if(console.log("🔐 [canManagePassword] Checking permissions:",{currentUser:r,currentUserRole:r==null?void 0:r.role,currentUserId:r==null?void 0:r.id,targetMember:i,targetMemberRole:i==null?void 0:i.role,targetMemberId:i==null?void 0:i.id}),!r||!i)return console.log("🔐 [canManagePassword] Missing user data"),!1;const v=(w=r.role)==null?void 0:w.toUpperCase(),y=(z=i.role)==null?void 0:z.toUpperCase();return v==="ENTERPRISE_USER"||v==="OWNER"?(console.log("🔐 [canManagePassword] Enterprise user/Owner can manage all passwords"),!0):v==="ADMIN"&&y!=="ENTERPRISE_USER"&&y!=="OWNER"?(console.log("🔐 [canManagePassword] Admin can manage non-owner passwords"),!0):r.id===i.id?(console.log("🔐 [canManagePassword] User can manage own password"),!0):(console.log("🔐 [canManagePassword] No permission to manage password"),!1)},da=(r,i)=>!r.assignedProjects||!i?[]:i.filter(v=>r.assignedProjects.includes(v.id)),ya=()=>{var Be;const{enqueueSnackbar:r}=Ys(),{data:i,loading:v,error:y}=Zs(),{data:w,loading:z,error:ts}=Qs(),{data:T,loading:rs,error:is,refetch:S}=Xs(),{data:c,loading:ls,error:os,refetch:O}=ea(),{data:cs,loading:ds,error:xs}=sa(),hs=aa(),ms=na();ta();const Ie=ra();ia();const ne=la(),[us,W]=o.useState(!1),[gs,G]=o.useState(!1),[js,$]=o.useState(!1),[ps,q]=o.useState(!1),[te,Ce]=o.useState(""),[D,Te]=o.useState(""),[E,Le]=o.useState(""),[Ne,Ae]=o.useState("member"),[B,Se]=o.useState(""),[re,We]=o.useState(""),[ie,De]=o.useState(""),[le,H]=o.useState(""),[L,vs]=o.useState(!0),[n,k]=o.useState(void 0),[Ee,ke]=o.useState(null),[_,Me]=o.useState(""),[oe,Re]=o.useState(""),[ce,Fe]=o.useState(""),[ze,Oe]=o.useState("member"),[Ge,$e]=o.useState(""),[fs,U]=o.useState(!1),[K,V]=o.useState(""),[N,J]=o.useState(""),[P,qe]=o.useState(!0),bs=v||z||rs||ls||ds,ys=y||ts||is||os||xs;as.useEffect(()=>{L&&H(ae())},[L]),as.useEffect(()=>{const s=async()=>{console.log("🔄 [TeamPage] License refresh event detected, refetching data..."),await Promise.all([O(),S()])};return window.addEventListener("licenses:refresh",s),()=>{window.removeEventListener("licenses:refresh",s)}},[O,S]);const h=o.useMemo(()=>{if(!i||!w||!T||!c)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableLicenses:0,totalLicenses:0,assignedLicenses:0}};const s=T.filter(g=>g.status==="active").length,l=T.filter(g=>g.status==="pending").length,I=c.length,u=c.filter(g=>g.assignedTo).length,C=c.filter(g=>g.status==="PENDING"&&!g.assignedTo).length;console.log("📊 [TeamPage] License stats:",{totalLicenses:I,assignedLicenses:u,availableLicenses:C});const R={totalMembers:T.length,activeMembers:s,pendingInvites:l,availableLicenses:C,totalLicenses:I,assignedLicenses:u};return{members:T,stats:R}},[i,w,T,c]),de=s=>{if(!s.licenseAssignment)return null;const l=c==null?void 0:c.find(I=>{var u;return I.id===((u=s.licenseAssignment)==null?void 0:u.licenseId)});return{licenseType:s.licenseAssignment.licenseType,licenseKey:s.licenseAssignment.licenseKey,status:(l==null?void 0:l.status)||"UNKNOWN"}},ws=(s,l)=>{console.log("🔧 [TeamPage] Menu clicked for member:",l),k(l),ke(s.currentTarget)},M=()=>{ke(null)},Ps=async()=>{var s,l,I;if(!te.trim()){r("Please enter an email address",{variant:"error"});return}if(!D.trim()){r("Please enter a first name",{variant:"error"});return}if(!E.trim()){r("Please enter a last name",{variant:"error"});return}if(!le.trim()){r("Please provide a temporary password",{variant:"error"});return}if(h.stats.availableLicenses<=0){r("No available licenses. Please generate more licenses first.",{variant:"error"});return}try{console.log("👤 [TeamPage] Creating full user with Firebase authentication...");const u={firstName:D.trim(),lastName:E.trim(),email:te.trim().toLowerCase(),role:Ne,status:"pending",organization:{id:((s=i==null?void 0:i.organization)==null?void 0:s.id)||"",name:((l=i==null?void 0:i.organization)==null?void 0:l.name)||"",tier:((I=i==null?void 0:i.organization)==null?void 0:I.tier)||"BASIC"},department:B.trim()||"",assignedProjects:[],avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(D+" "+E)}&background=667eea&color=fff`};console.log("🔍 [TeamPage] Department field value:",B),console.log("🔍 [TeamPage] Department field trimmed:",B.trim()),console.log("🔍 [TeamPage] Department field final:",u.department),console.log("🔍 [TeamPage] Position field value:",re),console.log("🔍 [TeamPage] Phone field value:",ie);const C=await hs.mutate({...u,temporaryPassword:le,position:re.trim()||"",phone:ie.trim()||""});console.log("✅ [TeamPage] Team member created with ID:",C);const R=c==null?void 0:c.find(g=>g.status==="PENDING"&&!g.assignedTo);if(R&&C)try{await Ie.mutate({licenseId:R.id,userId:C}),console.log("✅ [TeamPage] Auto-assigned license",R.id,"to new member",C)}catch(g){console.warn("⚠️ [TeamPage] Failed to auto-assign license:",g)}r(`Team member ${D} ${E} created successfully with license assigned. They can now login with their email and temporary password.`,{variant:"success"}),Ce(""),Te(""),Le(""),Ae("member"),Se(""),We(""),De(""),H(ae()),W(!1),await Promise.all([S(),O()])}catch(u){console.error("❌ [TeamPage] Failed to create team member:",u),r((u==null?void 0:u.message)||"Failed to create team member",{variant:"error"})}},Is=s=>{const l=s||n;if(!l){console.error("🔧 [TeamPage] No member provided for editing"),r("Unable to load member data. Please try again.",{variant:"error"});return}console.log("🔧 [TeamPage] Opening edit dialog for member:",l),M(),k(l),Re(l.firstName||""),Fe(l.lastName||""),Oe(l.role||"member"),$e(l.department||""),U(!1),V(""),J(""),qe(!0),G(!0)},Cs=async()=>{if(!n){r("No team member selected",{variant:"error"});return}if(!fe(i,n)){r("You do not have permission to change this password",{variant:"error"});return}const s=P?ae():K;if(!P){if(!s.trim()){r("Please enter a new password",{variant:"error"});return}if(s!==N){r("Passwords do not match",{variant:"error"});return}if(s.length<8){r("Password must be at least 8 characters long",{variant:"error"});return}}try{await ne.mutate({memberId:n.id,newPassword:s}),console.log("🔐 [TeamPage] Password change requested for member:",n.email),r(`Password ${P?"generated and ":""}updated successfully for ${n.firstName} ${n.lastName}`,{variant:"success"}),U(!1),V(""),J("")}catch(l){console.error("❌ [TeamPage] Failed to update password:",l),r((l==null?void 0:l.message)||"Failed to update password",{variant:"error"})}},Ts=()=>{n&&(M(),$(!0))},Ls=async()=>{if(n)try{r(`${n.firstName} ${n.lastName} has been removed from the team`,{variant:"success"}),$(!1),k(void 0)}catch(s){r((s==null?void 0:s.message)||"Failed to remove team member",{variant:"error"})}},Ns=()=>{n&&(r(`Invitation resent to ${n.email}`,{variant:"success"}),M())},As=async()=>{if(!n||!_){r("Please select a valid license to assign",{variant:"error"});return}try{console.log("🎫 [TeamPage] Manually assigning license to existing member:",n.email),await Ie.mutate({licenseId:_,userId:n.id}),r(`License assigned to ${n.firstName} ${n.lastName}`,{variant:"success"}),Me(""),q(!1),M(),await Promise.all([O(),S()])}catch(s){console.error("❌ [TeamPage] Failed to assign license:",s),r((s==null?void 0:s.message)||"Failed to assign license",{variant:"error"})}},Ss=async()=>{if(n)try{await ms.mutate({memberId:n.id,updates:{firstName:oe,lastName:ce,role:ze,department:Ge||""}}),r(`Team member ${oe} ${ce} updated successfully`,{variant:"success"}),G(!1),k(void 0),S()}catch(s){r((s==null?void 0:s.message)||"Failed to update team member",{variant:"error"})}};return bs?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(t,{textAlign:"center",children:[e.jsx(He,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):ys?e.jsx(t,{sx:{p:3},children:e.jsxs(p,{severity:"error",children:[e.jsx(xe,{children:"Unable to Load Team Data"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs(Ws,{dense:!0,children:[e.jsxs(_e,{children:[e.jsx(A,{children:e.jsx(Ds,{fontSize:"small"})}),e.jsx(Ue,{primary:"Network connectivity issues"})]}),e.jsxs(_e,{children:[e.jsx(A,{children:e.jsx(he,{fontSize:"small"})}),e.jsx(Ue,{primary:"Authentication token expired"})]})]}),e.jsx(t,{sx:{mt:2},children:e.jsx(x,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!i||!w?e.jsx(t,{sx:{p:3},children:e.jsxs(p,{severity:"info",children:[e.jsx(xe,{children:"Setting Up Team Management"}),e.jsx(a,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(t,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(a,{variant:"body1",color:"text.secondary",children:["Manage your ",((Be=w.organization)==null?void 0:Be.name)||"Organization"," team members and permissions"]})]}),e.jsx(x,{variant:"contained",startIcon:e.jsx(me,{}),onClick:()=>W(!0),disabled:h.stats.availableLicenses<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(F,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(F,{item:!0,xs:12,sm:6,md:3,children:e.jsx(se,{title:"Total Members",value:h.stats.totalMembers,icon:e.jsx(be,{}),color:"primary"})}),e.jsx(F,{item:!0,xs:12,sm:6,md:3,children:e.jsx(se,{title:"Active Members",value:h.stats.activeMembers,icon:e.jsx(ye,{}),color:"success"})}),e.jsx(F,{item:!0,xs:12,sm:6,md:3,children:e.jsx(se,{title:"Pending Invites",value:h.stats.pendingInvites,icon:e.jsx(we,{}),color:"warning"})}),e.jsx(F,{item:!0,xs:12,sm:6,md:3,children:e.jsx(se,{title:"Available Licenses",value:`${h.stats.availableLicenses}/${h.stats.totalLicenses}`,icon:e.jsx(b,{}),color:"primary"})})]}),h.stats.availableLicenses<=0&&e.jsxs(p,{severity:"warning",sx:{mb:4},children:[e.jsx(xe,{children:"No Available Licenses"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"You need to generate more licenses to invite new team members. Go to the Licenses page to create additional licenses."}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Generate Licenses"}),e.jsx(x,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(Es,{children:e.jsxs(ks,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",h.members.length,")"]}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(b,{}),onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Manage Licenses"})]}),e.jsx(Ms,{children:e.jsxs(Rs,{children:[e.jsx(Fs,{children:e.jsxs(Ke,{children:[e.jsx(m,{sx:{fontWeight:600},children:"Member"}),e.jsx(m,{sx:{fontWeight:600},children:"Role"}),e.jsx(m,{sx:{fontWeight:600},children:"Status"}),e.jsx(m,{sx:{fontWeight:600},children:"Department"}),e.jsx(m,{sx:{fontWeight:600},children:"License"}),e.jsx(m,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(m,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(zs,{children:h.members.map(s=>e.jsxs(Ke,{hover:!0,children:[e.jsx(m,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(Os,{src:s.avatar,sx:{width:40,height:40},children:[s.firstName.charAt(0),s.lastName.charAt(0)]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"body1",sx:{fontWeight:500},children:[s.firstName," ",s.lastName]}),e.jsx(a,{variant:"body2",color:"text.secondary",children:s.email})]})]})}),e.jsx(m,{children:e.jsx(Y,{label:s.role.toUpperCase(),color:oa(s.role),size:"small",icon:s.role==="admin"?e.jsx(Gs,{}):void 0})}),e.jsx(m,{children:e.jsx(Y,{icon:ns(s.status),label:s.status.toUpperCase(),color:ca(s.status),size:"small"})}),e.jsx(m,{children:e.jsx(a,{variant:"body2",children:s.department||"Unassigned"})}),e.jsx(m,{children:e.jsx(t,{children:(()=>{const l=de(s);return l?e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:l.licenseType}),e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[l.licenseKey.substring(0,12),"..."]}),e.jsx(Y,{label:l.status,size:"small",color:l.status==="ACTIVE"?"success":"warning",sx:{mt:.5}})]}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"None"})})()})}),e.jsx(m,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.lastActive?new Date(s.lastActive).toLocaleDateString():"Never"})}),e.jsx(m,{children:e.jsx(Ve,{size:"small",onClick:l=>ws(l,s),disabled:s.role==="owner"&&s.id===i.id,children:e.jsx($s,{})})})]},s.id))})]})})]})}),e.jsx(qs,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>W(!0),disabled:h.stats.availableLicenses<=0,children:e.jsx(Bs,{})}),e.jsxs(Z,{open:us,onClose:()=>W(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Q,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(me,{}),"Create New Team Member"]})}),e.jsx(X,{children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Je,{})," Personal Information"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:D,onChange:s=>Te(s.target.value),placeholder:"John",required:!0}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:E,onChange:s=>Le(s.target.value),placeholder:"Doe",required:!0})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:te,onChange:s=>Ce(s.target.value),placeholder:"john.doe@company.com",required:!0,sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Phone Number (Optional)",value:ie,onChange:s=>De(s.target.value),placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(f,{position:"start",children:e.jsx(Ye,{})})}})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ze,{})," Role & Department"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(ue,{fullWidth:!0,children:[e.jsx(ge,{children:"Role"}),e.jsxs(je,{value:Ne,label:"Role",onChange:s=>Ae(s.target.value),children:[e.jsx(j,{value:"viewer",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(j,{value:"member",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(j,{value:"manager",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(j,{value:"admin",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:B,onChange:s=>Se(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title (Optional)",value:re,onChange:s=>We(s.target.value),placeholder:"Senior Developer, Product Manager..."})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(he,{})," Authentication"]}),e.jsx(Qe,{control:e.jsx(Xe,{checked:L,onChange:s=>vs(s.target.checked)}),label:"Auto-generate secure password",sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Temporary Password",type:"password",value:le,onChange:s=>H(s.target.value),disabled:L,required:!0,InputProps:{endAdornment:e.jsx(f,{position:"end",children:e.jsx(Ve,{onClick:()=>H(ae()),disabled:!L,children:e.jsx(Hs,{})})})},helperText:L?"Password will be auto-generated":"User will need this password to login initially"})]}),e.jsxs(p,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🎫 License Assignment"}),e.jsx(a,{variant:"body2",children:"This team member will be created as a full Firebase authenticated user and automatically assigned an available license. They can login immediately with their email and temporary password."}),e.jsxs(a,{variant:"body2",sx:{mt:1,fontWeight:500},children:["Available licenses: ",h.stats.availableLicenses," of ",h.stats.totalLicenses]})]}),h.stats.availableLicenses<=0&&e.jsx(p,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No licenses available! Please generate more licenses before creating team members."})})]})}),e.jsxs(ee,{children:[e.jsx(x,{onClick:()=>W(!1),children:"Cancel"}),e.jsx(x,{onClick:Ps,variant:"contained",startIcon:e.jsx(me,{}),disabled:h.stats.availableLicenses<=0,children:"Create Team Member"})]})]}),e.jsxs(Z,{open:gs,onClose:()=>{G(!1),k(void 0)},maxWidth:"md",fullWidth:!0,children:[e.jsx(Q,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(pe,{}),"🚀 ENHANCED Edit Team Member: ",(n==null?void 0:n.firstName)||"Loading..."," ",(n==null?void 0:n.lastName)||""]})}),e.jsx(X,{children:n?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Je,{})," Personal Information"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:oe,onChange:s=>Re(s.target.value),required:!0,placeholder:"John"}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:ce,onChange:s=>Fe(s.target.value),required:!0,placeholder:"Doe"})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:n.email,disabled:!0,sx:{mb:2},helperText:"Email cannot be changed after account creation"}),e.jsx(d,{fullWidth:!0,label:"Phone Number",value:"",disabled:!0,placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(f,{position:"start",children:e.jsx(Ye,{})})},helperText:"Phone number not available in current data model"})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ze,{})," Role & Department"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(ue,{fullWidth:!0,children:[e.jsx(ge,{children:"Role"}),e.jsxs(je,{value:ze,label:"Role",onChange:s=>Oe(s.target.value),children:[e.jsx(j,{value:"viewer",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(j,{value:"member",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(j,{value:"manager",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(j,{value:"admin",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:Ge,onChange:s=>$e(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title",value:"",disabled:!0,placeholder:"Senior Developer, Product Manager...",helperText:"Position not available in current data model"})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(b,{})," License & Access"]}),(()=>{const s=de(n);return e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"License Type",value:(s==null?void 0:s.licenseType)||"None",disabled:!0,InputProps:{startAdornment:e.jsx(f,{position:"start",children:e.jsx(b,{})})}}),e.jsx(d,{fullWidth:!0,label:"License Status",value:s?s.status:"Unassigned",disabled:!0,InputProps:{startAdornment:e.jsx(f,{position:"start",children:s?e.jsx(ye,{}):e.jsx(we,{})})}})]})})(),e.jsx(d,{fullWidth:!0,label:"Last Active",value:n.lastActive?new Date(n.lastActive).toLocaleString():"Never",disabled:!0,InputProps:{startAdornment:e.jsx(f,{position:"start",children:e.jsx(_s,{})})}})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(es,{})," Project Assignments"]}),(()=>{const s=da(n,cs||[]);return s.length>0?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.map(l=>e.jsx(Y,{label:l.name,color:"primary",variant:"outlined",size:"small",icon:e.jsx(es,{}),sx:{maxWidth:200}},l.id))}),e.jsxs(t,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx("strong",{children:"Project Details:"})}),s.map(l=>e.jsxs(t,{sx:{mb:1,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:l.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Mode: ",l.mode," • Storage: ",l.storageBackend," • Status: ",l.status]}),l.description&&e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:l.description})]},l.id))]})]}):e.jsx(p,{severity:"info",children:e.jsx(a,{variant:"body2",children:"No projects assigned yet. This team member can be assigned to projects from the Cloud Projects page."})})})()]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(he,{})," Account Status"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"Account Status",value:n.status,disabled:!0,InputProps:{startAdornment:e.jsx(f,{position:"start",children:ns(n.status)})}}),e.jsx(d,{fullWidth:!0,label:"Member Since",value:n.joinedAt?new Date(n.joinedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(f,{position:"start",children:e.jsx(be,{})})}})]})]}),(()=>{const s=fe(i,n);return console.log("🔐 [TeamPage] Password permission check:",{currentUser:i,selectedMember:n,canManage:s}),s})()&&e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ve,{})," Password Management"]}),fs?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(p,{severity:"warning",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🔐 Password Change"}),e.jsx(a,{variant:"body2",children:P?"A secure password will be automatically generated.":"Please enter a new password with at least 8 characters."})]}),e.jsx(Qe,{control:e.jsx(Xe,{checked:P,onChange:s=>qe(s.target.checked)}),label:"Auto-generate secure password"}),!P&&e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(d,{fullWidth:!0,label:"New Password",type:"password",value:K,onChange:s=>V(s.target.value),placeholder:"Enter new password (min 8 characters)",required:!0,InputProps:{startAdornment:e.jsx(f,{position:"start",children:e.jsx(ve,{})})}}),e.jsx(d,{fullWidth:!0,label:"Confirm Password",type:"password",value:N,onChange:s=>J(s.target.value),placeholder:"Confirm new password",required:!0,error:N!==""&&K!==N,helperText:N!==""&&K!==N?"Passwords do not match":"",InputProps:{startAdornment:e.jsx(f,{position:"start",children:e.jsx(ve,{})})}})]}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",startIcon:e.jsx(ss,{}),onClick:Cs,disabled:ne.loading,sx:{background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)",color:"white",fontWeight:600},children:ne.loading?"Updating...":P?"Generate & Update Password":"Update Password"}),e.jsx(x,{variant:"outlined",onClick:()=>{U(!1),V(""),J("")},children:"Cancel"})]})]}):e.jsxs(t,{children:[e.jsxs(p,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"🔐 Password Access"})}),e.jsx(a,{variant:"body2",children:(i==null?void 0:i.id)===n.id?"You can change your own password here.":(i==null?void 0:i.role)==="ENTERPRISE_USER"||(i==null?void 0:i.role)==="owner"?"As the account owner, you can change this team member's password.":"As an admin, you can change this team member's password."})]}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(ss,{}),onClick:()=>U(!0),sx:{mb:2},children:"Change Password"})]})]}),e.jsxs(p,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"⚠️ Important Notes"}),e.jsxs(a,{variant:"body2",children:["• Role changes will immediately affect the member's permissions and access levels",e.jsx("br",{}),"• Department information helps with organization and project assignments",e.jsx("br",{}),"• Project assignments are managed from the Cloud Projects page",e.jsx("br",{}),"• License assignments are managed through the Licenses page",e.jsx("br",{}),fe(i,n)&&"• Password changes take effect immediately"]})]})]}):e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(t,{textAlign:"center",children:[e.jsx(He,{size:40,sx:{mb:2}}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Loading member data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"If this persists, please close and try again."})]})})}),e.jsxs(ee,{children:[e.jsx(x,{onClick:()=>G(!1),children:"Cancel"}),e.jsx(x,{onClick:Ss,variant:"contained",startIcon:e.jsx(pe,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(Z,{open:js,onClose:()=>$(!1),maxWidth:"sm",children:[e.jsx(Q,{children:"Remove Team Member"}),e.jsx(X,{children:n&&e.jsxs(t,{children:[e.jsxs(a,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsxs("strong",{children:[n.firstName," ",n.lastName]})," from your team?"]}),e.jsx(p,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources. Their license will be freed up for reassignment."})})]})}),e.jsxs(ee,{children:[e.jsx(x,{onClick:()=>$(!1),children:"Cancel"}),e.jsx(x,{onClick:Ls,variant:"contained",color:"error",startIcon:e.jsx(Pe,{}),children:"Remove Member"})]})]}),e.jsxs(Us,{anchorEl:Ee,open:!!Ee,onClose:M,children:[e.jsxs(j,{onClick:()=>Is(n),children:[e.jsx(A,{children:e.jsx(pe,{})}),"Edit Member"]}),n?de(n)?null:e.jsxs(j,{onClick:()=>q(!0),children:[e.jsx(A,{children:e.jsx(b,{})}),"Assign License"]}):null,(n==null?void 0:n.status)==="pending"&&e.jsxs(j,{onClick:Ns,children:[e.jsx(A,{children:e.jsx(Ks,{})}),"Resend Invite"]}),e.jsx(Vs,{}),e.jsxs(j,{onClick:Ts,sx:{color:"error.main"},children:[e.jsx(A,{children:e.jsx(Pe,{sx:{color:"error.main"}})}),"Remove Member"]})]}),e.jsxs(Z,{open:ps,onClose:()=>q(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Q,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{}),"Assign License to ",n==null?void 0:n.firstName," ",n==null?void 0:n.lastName]})}),e.jsx(X,{children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(p,{severity:"info",children:e.jsxs(a,{variant:"body2",children:["Assigning a license to ",e.jsxs("strong",{children:[n==null?void 0:n.firstName," ",n==null?void 0:n.lastName]})," (",n==null?void 0:n.email,")"]})}),e.jsxs(ue,{fullWidth:!0,children:[e.jsx(ge,{children:"Select License"}),e.jsx(je,{value:_,label:"Select License",onChange:s=>Me(s.target.value),children:c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).map(s=>e.jsx(j,{value:s.id,children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(b,{color:"primary"}),e.jsxs(t,{children:[e.jsxs(a,{variant:"body2",sx:{fontWeight:500},children:[s.tier," License"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.key," • Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id))}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Only unassigned PENDING licenses are available for assignment"})]}),(c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0&&e.jsx(p,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No available licenses found. All licenses are either assigned or not in PENDING status."})}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"The selected license will be assigned to this team member and they will have immediate access to the system."})]})}),e.jsxs(ee,{children:[e.jsx(x,{onClick:()=>q(!1),children:"Cancel"}),e.jsx(x,{onClick:As,variant:"contained",startIcon:e.jsx(b,{}),disabled:!_||(c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0,children:"Assign License"})]})]})]})};export{ya as default};
