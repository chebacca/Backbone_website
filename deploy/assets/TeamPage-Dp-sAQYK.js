import{j as e,B as n,C as Re,T as a,d as p,ai as X,w as Is,x as Fe,y as D,aj as Ts,z as ze,H as ee,a as x,aG as se,G as k,W as ce,p as xe,am as he,u as _,t as Ls,v as As,aq as Ss,ar as Ws,as as Ns,at as Oe,au as h,av as Es,ag as Ds,r as ae,aZ as ks,g as $e,aw as Ms,ax as Rs,ap as Fs,ay as ne,az as te,aB as re,a_ as qe,e as d,I as v,a$ as Be,b0 as Ge,aC as He,aD as _e,aE as Je,a5 as g,F as Ue,s as Ve,R as zs,aF as ie,aI as oe,aL as Os,b1 as Ye,L as le,b2 as Ke,aH as me,a4 as $s,E as qs,D as Bs,aJ as Gs}from"./mui-Cr9U6iW2.js";import{r as l,b as Ze}from"./vendor-CjD1bmmO.js";import{u as Hs}from"./notistack.esm-Ca-E78ev.js";import{b as _s,c as Js,a as Us,u as Vs,h as Ys,j as Ks,k as Zs,l as Qs,f as Xs,g as ea}from"./useStreamlinedData-D8pQFAtN.js";import{M as J}from"./MetricCard-CCtxyf7i.js";import"./UnifiedDataService-DfkYFqUR.js";import"./index-DgsBIZRr.js";import"./stripe-ggaMUove.js";import"./index.esm-B4qVkIPL.js";import"./index.esm-DmQE6AXN.js";const sa=i=>{switch(i){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},aa=i=>{switch(i){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},Qe=i=>{switch(i){case"active":return e.jsx(xe,{});case"pending":return e.jsx(he,{});case"suspended":return e.jsx(Gs,{});case"removed":return e.jsx(me,{});default:return e.jsx(ce,{})}},U=()=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let j="";for(let y=0;y<12;y++)j+=t.charAt(Math.floor(Math.random()*t.length));return j},de=(i,t)=>{var w,M;if(console.log("🔐 [canManagePassword] Checking permissions:",{currentUser:i,currentUserRole:i==null?void 0:i.role,currentUserId:i==null?void 0:i.id,targetMember:t,targetMemberRole:t==null?void 0:t.role,targetMemberId:t==null?void 0:t.id}),!i||!t)return console.log("🔐 [canManagePassword] Missing user data"),!1;const j=(w=i.role)==null?void 0:w.toUpperCase(),y=(M=t.role)==null?void 0:M.toUpperCase();return j==="ENTERPRISE_USER"||j==="OWNER"?(console.log("🔐 [canManagePassword] Enterprise user/Owner can manage all passwords"),!0):j==="ADMIN"&&y!=="ENTERPRISE_USER"&&y!=="OWNER"?(console.log("🔐 [canManagePassword] Admin can manage non-owner passwords"),!0):i.id===t.id?(console.log("🔐 [canManagePassword] User can manage own password"),!0):(console.log("🔐 [canManagePassword] No permission to manage password"),!1)},na=(i,t)=>!i.assignedProjects||!t?[]:t.filter(j=>i.assignedProjects.includes(j.id)),ua=()=>{var ke,Me;const{enqueueSnackbar:i}=Hs(),{data:t,loading:j,error:y}=_s(),{data:w,loading:M,error:Xe}=Js(),{data:I,loading:es,error:ss,refetch:R}=Us(),{data:f,loading:as,error:ns,refetch:V}=Vs(),{data:ts,loading:rs,error:is}=Ys(),os=Ks(),ls=Zs();Qs();const ds=Xs();ea();const[cs,A]=l.useState(!1),[xs,F]=l.useState(!1),[hs,z]=l.useState(!1),[Y,ue]=l.useState(""),[S,ge]=l.useState(""),[W,je]=l.useState(""),[pe,ve]=l.useState("member"),[fe,be]=l.useState(""),[ye,we]=l.useState(""),[Pe,Ce]=l.useState(""),[K,O]=l.useState(""),[T,ms]=l.useState(!0),[r,N]=l.useState(void 0),[Ie,Te]=l.useState(null),[Z,Le]=l.useState(""),[Q,Ae]=l.useState(""),[Se,We]=l.useState("member"),[Ne,Ee]=l.useState(""),[us,$]=l.useState(!1),[q,B]=l.useState(""),[L,G]=l.useState(""),[P,De]=l.useState(!0),gs=j||M||es||as||rs,js=y||Xe||ss||ns||is;Ze.useEffect(()=>{T&&O(U())},[T]),Ze.useEffect(()=>{const s=async()=>{console.log("🔄 [TeamPage] License refresh event detected, refetching data..."),await Promise.all([V(),R()])};return window.addEventListener("licenses:refresh",s),()=>{window.removeEventListener("licenses:refresh",s)}},[V,R]);const c=l.useMemo(()=>{if(!t||!w||!I||!f)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableLicenses:0,totalLicenses:0,assignedLicenses:0}};const s=I.filter(m=>m.status==="active").length,o=I.filter(m=>m.status==="pending").length,b=f.length,u=f.filter(m=>m.assignedTo).length,C=f.filter(m=>m.status==="PENDING"&&!m.assignedTo).length;console.log("📊 [TeamPage] License stats:",{totalLicenses:b,assignedLicenses:u,availableLicenses:C});const E={totalMembers:I.length,activeMembers:s,pendingInvites:o,availableLicenses:C,totalLicenses:b,assignedLicenses:u};return{members:I,stats:E}},[t,w,I,f]),ps=(s,o)=>{console.log("🔧 [TeamPage] Menu clicked for member:",o),N(o),Te(s.currentTarget)},H=()=>{Te(null)},vs=async()=>{var s,o,b;if(!Y.trim()){i("Please enter an email address",{variant:"error"});return}if(!S.trim()){i("Please enter a first name",{variant:"error"});return}if(!W.trim()){i("Please enter a last name",{variant:"error"});return}if(!K.trim()){i("Please provide a temporary password",{variant:"error"});return}if(c.stats.availableLicenses<=0){i("No available licenses. Please generate more licenses first.",{variant:"error"});return}try{console.log("👤 [TeamPage] Creating full user with Firebase authentication...");const u={firstName:S.trim(),lastName:W.trim(),email:Y.trim().toLowerCase(),role:pe,status:"pending",organization:{id:((s=t==null?void 0:t.organization)==null?void 0:s.id)||"",name:((o=t==null?void 0:t.organization)==null?void 0:o.name)||"",tier:((b=t==null?void 0:t.organization)==null?void 0:b.tier)||"BASIC"},department:fe.trim()||void 0,assignedProjects:[],avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(S+" "+W)}&background=667eea&color=fff`},C=await os.mutate({...u,temporaryPassword:K,position:ye.trim()||void 0,phone:Pe.trim()||void 0});console.log("✅ [TeamPage] Team member created with ID:",C);const E=f==null?void 0:f.find(m=>m.status==="PENDING"&&!m.assignedTo);if(E&&C)try{await ds.mutate({licenseId:E.id,userId:C}),console.log("✅ [TeamPage] Auto-assigned license",E.id,"to new member",C)}catch(m){console.warn("⚠️ [TeamPage] Failed to auto-assign license:",m)}i(`Team member ${S} ${W} created successfully with license assigned. They can now login with their email and temporary password.`,{variant:"success"}),ue(""),ge(""),je(""),ve("member"),be(""),we(""),Ce(""),O(U()),A(!1),await Promise.all([R(),V()])}catch(u){console.error("❌ [TeamPage] Failed to create team member:",u),i((u==null?void 0:u.message)||"Failed to create team member",{variant:"error"})}},fs=s=>{const o=r;if(!o){console.error("🔧 [TeamPage] No member provided for editing"),i("Unable to load member data. Please try again.",{variant:"error"});return}console.log("🔧 [TeamPage] Opening edit dialog for member:",o),H(),N(o),Le(o.firstName||""),Ae(o.lastName||""),We(o.role||"member"),Ee(o.department||""),$(!1),B(""),G(""),De(!0),F(!0)},bs=async()=>{if(!r){i("No team member selected",{variant:"error"});return}if(!de(t,r)){i("You do not have permission to change this password",{variant:"error"});return}const s=P?U():q;if(!P){if(!s.trim()){i("Please enter a new password",{variant:"error"});return}if(s!==L){i("Passwords do not match",{variant:"error"});return}if(s.length<8){i("Password must be at least 8 characters long",{variant:"error"});return}}try{console.log("🔐 [TeamPage] Password change requested for member:",r.email),i(`Password ${P?"generated and ":""}updated successfully for ${r.firstName} ${r.lastName}`,{variant:"success"}),$(!1),B(""),G("")}catch(o){console.error("❌ [TeamPage] Failed to update password:",o),i((o==null?void 0:o.message)||"Failed to update password",{variant:"error"})}},ys=()=>{r&&(H(),z(!0))},ws=async()=>{if(r)try{i(`${r.firstName} ${r.lastName} has been removed from the team`,{variant:"success"}),z(!1),N(void 0)}catch(s){i((s==null?void 0:s.message)||"Failed to remove team member",{variant:"error"})}},Ps=()=>{r&&(i(`Invitation resent to ${r.email}`,{variant:"success"}),H())},Cs=async()=>{if(r)try{await ls.mutate({memberId:r.id,updates:{firstName:Z,lastName:Q,role:Se,department:Ne}}),i(`Team member ${Z} ${Q} updated successfully`,{variant:"success"}),F(!1),N(void 0),R()}catch(s){i((s==null?void 0:s.message)||"Failed to update team member",{variant:"error"})}};return gs?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(n,{textAlign:"center",children:[e.jsx(Re,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):js?e.jsx(n,{sx:{p:3},children:e.jsxs(p,{severity:"error",children:[e.jsx(X,{children:"Unable to Load Team Data"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs(Is,{dense:!0,children:[e.jsxs(Fe,{children:[e.jsx(D,{children:e.jsx(Ts,{fontSize:"small"})}),e.jsx(ze,{primary:"Network connectivity issues"})]}),e.jsxs(Fe,{children:[e.jsx(D,{children:e.jsx(ee,{fontSize:"small"})}),e.jsx(ze,{primary:"Authentication token expired"})]})]}),e.jsx(n,{sx:{mt:2},children:e.jsx(x,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!t||!w?e.jsx(n,{sx:{p:3},children:e.jsxs(p,{severity:"info",children:[e.jsx(X,{children:"Setting Up Team Management"}),e.jsx(a,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(n,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(a,{variant:"body1",color:"text.secondary",children:["Manage your ",((ke=w.organization)==null?void 0:ke.name)||"Organization"," team members and permissions"]})]}),e.jsx(x,{variant:"contained",startIcon:e.jsx(se,{}),onClick:()=>A(!0),disabled:c.stats.availableLicenses<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(k,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(k,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{title:"Total Members",value:c.stats.totalMembers,icon:e.jsx(ce,{}),color:"primary"})}),e.jsx(k,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{title:"Active Members",value:c.stats.activeMembers,icon:e.jsx(xe,{}),color:"success"})}),e.jsx(k,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{title:"Pending Invites",value:c.stats.pendingInvites,icon:e.jsx(he,{}),color:"warning"})}),e.jsx(k,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{title:"Available Licenses",value:`${c.stats.availableLicenses}/${c.stats.totalLicenses}`,icon:e.jsx(_,{}),color:"primary"})})]}),c.stats.availableLicenses<=0&&e.jsxs(p,{severity:"warning",sx:{mb:4},children:[e.jsx(X,{children:"No Available Licenses"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"You need to generate more licenses to invite new team members. Go to the Licenses page to create additional licenses."}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Generate Licenses"}),e.jsx(x,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(Ls,{children:e.jsxs(As,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",c.members.length,")"]}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(_,{}),onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Manage Licenses"})]}),e.jsx(Ss,{children:e.jsxs(Ws,{children:[e.jsx(Ns,{children:e.jsxs(Oe,{children:[e.jsx(h,{sx:{fontWeight:600},children:"Member"}),e.jsx(h,{sx:{fontWeight:600},children:"Role"}),e.jsx(h,{sx:{fontWeight:600},children:"Status"}),e.jsx(h,{sx:{fontWeight:600},children:"Department"}),e.jsx(h,{sx:{fontWeight:600},children:"License"}),e.jsx(h,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(h,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Es,{children:c.members.map(s=>{var o,b;return e.jsxs(Oe,{hover:!0,children:[e.jsx(h,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(Ds,{src:s.avatar,sx:{width:40,height:40},children:[s.firstName.charAt(0),s.lastName.charAt(0)]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"body1",sx:{fontWeight:500},children:[s.firstName," ",s.lastName]}),e.jsx(a,{variant:"body2",color:"text.secondary",children:s.email})]})]})}),e.jsx(h,{children:e.jsx(ae,{label:s.role.toUpperCase(),color:sa(s.role),size:"small",icon:s.role==="admin"?e.jsx(ks,{}):void 0})}),e.jsx(h,{children:e.jsx(ae,{icon:Qe(s.status),label:s.status.toUpperCase(),color:aa(s.status),size:"small"})}),e.jsx(h,{children:e.jsx(a,{variant:"body2",children:s.department||"Unassigned"})}),e.jsx(h,{children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:((o=s.licenseAssignment)==null?void 0:o.licenseType)||"None"}),((b=s.licenseAssignment)==null?void 0:b.licenseKey)&&e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[s.licenseAssignment.licenseKey.substring(0,12),"..."]})]})}),e.jsx(h,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.lastActive?new Date(s.lastActive).toLocaleDateString():"Never"})}),e.jsx(h,{children:e.jsx($e,{size:"small",onClick:u=>ps(u,s),disabled:s.role==="owner"&&s.id===t.id,children:e.jsx(Ms,{})})})]},s.id)})})]})})]})}),e.jsx(Rs,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>A(!0),disabled:c.stats.availableLicenses<=0,children:e.jsx(Fs,{})}),e.jsxs(ne,{open:cs,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(te,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(se,{}),"Create New Team Member"]})}),e.jsx(re,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(qe,{})," Personal Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:S,onChange:s=>ge(s.target.value),placeholder:"John",required:!0}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:W,onChange:s=>je(s.target.value),placeholder:"Doe",required:!0})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:Y,onChange:s=>ue(s.target.value),placeholder:"john.doe@company.com",required:!0,sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Phone Number (Optional)",value:Pe,onChange:s=>Ce(s.target.value),placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(Be,{})})}})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{})," Role & Department"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(He,{fullWidth:!0,children:[e.jsx(_e,{children:"Role"}),e.jsxs(Je,{value:pe,label:"Role",onChange:s=>ve(s.target.value),children:[e.jsx(g,{value:"viewer",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(g,{value:"member",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(g,{value:"manager",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(g,{value:"admin",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:fe,onChange:s=>be(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title (Optional)",value:ye,onChange:s=>we(s.target.value),placeholder:"Senior Developer, Product Manager..."})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ee,{})," Authentication"]}),e.jsx(Ue,{control:e.jsx(Ve,{checked:T,onChange:s=>ms(s.target.checked)}),label:"Auto-generate secure password",sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Temporary Password",type:"password",value:K,onChange:s=>O(s.target.value),disabled:T,required:!0,InputProps:{endAdornment:e.jsx(v,{position:"end",children:e.jsx($e,{onClick:()=>O(U()),disabled:!T,children:e.jsx(zs,{})})})},helperText:T?"Password will be auto-generated":"User will need this password to login initially"})]}),e.jsxs(p,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🎫 License Assignment"}),e.jsx(a,{variant:"body2",children:"This team member will be created as a full Firebase authenticated user and automatically assigned an available license. They can login immediately with their email and temporary password."}),e.jsxs(a,{variant:"body2",sx:{mt:1,fontWeight:500},children:["Available licenses: ",c.stats.availableLicenses," of ",c.stats.totalLicenses]})]}),c.stats.availableLicenses<=0&&e.jsx(p,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No licenses available! Please generate more licenses before creating team members."})})]})}),e.jsxs(ie,{children:[e.jsx(x,{onClick:()=>A(!1),children:"Cancel"}),e.jsx(x,{onClick:vs,variant:"contained",startIcon:e.jsx(se,{}),disabled:c.stats.availableLicenses<=0,children:"Create Team Member"})]})]}),e.jsxs(ne,{open:xs,onClose:()=>{F(!1),N(void 0)},maxWidth:"md",fullWidth:!0,children:[e.jsx(te,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(oe,{}),"🚀 ENHANCED Edit Team Member: ",(r==null?void 0:r.firstName)||"Loading..."," ",(r==null?void 0:r.lastName)||""]})}),e.jsx(re,{children:r?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(qe,{})," Personal Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:Z,onChange:s=>Le(s.target.value),required:!0,placeholder:"John"}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:Q,onChange:s=>Ae(s.target.value),required:!0,placeholder:"Doe"})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:r.email,disabled:!0,sx:{mb:2},helperText:"Email cannot be changed after account creation"}),e.jsx(d,{fullWidth:!0,label:"Phone Number",value:"",disabled:!0,placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(Be,{})})},helperText:"Phone number not available in current data model"})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{})," Role & Department"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(He,{fullWidth:!0,children:[e.jsx(_e,{children:"Role"}),e.jsxs(Je,{value:Se,label:"Role",onChange:s=>We(s.target.value),children:[e.jsx(g,{value:"viewer",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(g,{value:"member",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(g,{value:"manager",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(g,{value:"admin",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:Ne,onChange:s=>Ee(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title",value:"",disabled:!0,placeholder:"Senior Developer, Product Manager...",helperText:"Position not available in current data model"})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(_,{})," License & Access"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"License Type",value:((Me=r.licenseAssignment)==null?void 0:Me.licenseType)||"None",disabled:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(_,{})})}}),e.jsx(d,{fullWidth:!0,label:"License Status",value:r.licenseAssignment?"Assigned":"Unassigned",disabled:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:r.licenseAssignment?e.jsx(xe,{}):e.jsx(he,{})})}})]}),e.jsx(d,{fullWidth:!0,label:"Last Active",value:r.lastActive?new Date(r.lastActive).toLocaleString():"Never",disabled:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(Os,{})})}})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ye,{})," Project Assignments"]}),(()=>{const s=na(r,ts||[]);return s.length>0?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.map(o=>e.jsx(ae,{label:o.name,color:"primary",variant:"outlined",size:"small",icon:e.jsx(Ye,{}),sx:{maxWidth:200}},o.id))}),e.jsxs(n,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx("strong",{children:"Project Details:"})}),s.map(o=>e.jsxs(n,{sx:{mb:1,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:o.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Mode: ",o.mode," • Storage: ",o.storageBackend," • Status: ",o.status]}),o.description&&e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:o.description})]},o.id))]})]}):e.jsx(p,{severity:"info",children:e.jsx(a,{variant:"body2",children:"No projects assigned yet. This team member can be assigned to projects from the Cloud Projects page."})})})()]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ee,{})," Account Status"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"Account Status",value:r.status,disabled:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:Qe(r.status)})}}),e.jsx(d,{fullWidth:!0,label:"Member Since",value:r.joinedAt?new Date(r.joinedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(ce,{})})}})]})]}),(()=>{const s=de(t,r);return console.log("🔐 [TeamPage] Password permission check:",{currentUser:t,selectedMember:r,canManage:s}),s})()&&e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(le,{})," Password Management"]}),us?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(p,{severity:"warning",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🔐 Password Change"}),e.jsx(a,{variant:"body2",children:P?"A secure password will be automatically generated.":"Please enter a new password with at least 8 characters."})]}),e.jsx(Ue,{control:e.jsx(Ve,{checked:P,onChange:s=>De(s.target.checked)}),label:"Auto-generate secure password"}),!P&&e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(d,{fullWidth:!0,label:"New Password",type:"password",value:q,onChange:s=>B(s.target.value),placeholder:"Enter new password (min 8 characters)",required:!0,InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(le,{})})}}),e.jsx(d,{fullWidth:!0,label:"Confirm Password",type:"password",value:L,onChange:s=>G(s.target.value),placeholder:"Confirm new password",required:!0,error:L!==""&&q!==L,helperText:L!==""&&q!==L?"Passwords do not match":"",InputProps:{startAdornment:e.jsx(v,{position:"start",children:e.jsx(le,{})})}})]}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",startIcon:e.jsx(Ke,{}),onClick:bs,sx:{background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)",color:"white",fontWeight:600},children:P?"Generate & Update Password":"Update Password"}),e.jsx(x,{variant:"outlined",onClick:()=>{$(!1),B(""),G("")},children:"Cancel"})]})]}):e.jsxs(n,{children:[e.jsxs(p,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"🔐 Password Access"})}),e.jsx(a,{variant:"body2",children:(t==null?void 0:t.id)===r.id?"You can change your own password here.":(t==null?void 0:t.role)==="ENTERPRISE_USER"||(t==null?void 0:t.role)==="owner"?"As the account owner, you can change this team member's password.":"As an admin, you can change this team member's password."})]}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(Ke,{}),onClick:()=>$(!0),sx:{mb:2},children:"Change Password"})]})]}),e.jsxs(p,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"⚠️ Important Notes"}),e.jsxs(a,{variant:"body2",children:["• Role changes will immediately affect the member's permissions and access levels",e.jsx("br",{}),"• Department information helps with organization and project assignments",e.jsx("br",{}),"• Project assignments are managed from the Cloud Projects page",e.jsx("br",{}),"• License assignments are managed through the Licenses page",e.jsx("br",{}),de(t,r)&&"• Password changes take effect immediately"]})]})]}):e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(n,{textAlign:"center",children:[e.jsx(Re,{size:40,sx:{mb:2}}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Loading member data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"If this persists, please close and try again."})]})})}),e.jsxs(ie,{children:[e.jsx(x,{onClick:()=>F(!1),children:"Cancel"}),e.jsx(x,{onClick:Cs,variant:"contained",startIcon:e.jsx(oe,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(ne,{open:hs,onClose:()=>z(!1),maxWidth:"sm",children:[e.jsx(te,{children:"Remove Team Member"}),e.jsx(re,{children:r&&e.jsxs(n,{children:[e.jsxs(a,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsxs("strong",{children:[r.firstName," ",r.lastName]})," from your team?"]}),e.jsx(p,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources. Their license will be freed up for reassignment."})})]})}),e.jsxs(ie,{children:[e.jsx(x,{onClick:()=>z(!1),children:"Cancel"}),e.jsx(x,{onClick:ws,variant:"contained",color:"error",startIcon:e.jsx(me,{}),children:"Remove Member"})]})]}),e.jsxs($s,{anchorEl:Ie,open:!!Ie,onClose:H,children:[e.jsxs(g,{onClick:()=>fs(),children:[e.jsx(D,{children:e.jsx(oe,{})}),"Edit Member"]}),(r==null?void 0:r.status)==="pending"&&e.jsxs(g,{onClick:Ps,children:[e.jsx(D,{children:e.jsx(qs,{})}),"Resend Invite"]}),e.jsx(Bs,{}),e.jsxs(g,{onClick:ys,sx:{color:"error.main"},children:[e.jsx(D,{children:e.jsx(me,{sx:{color:"error.main"}})}),"Remove Member"]})]})]})};export{ua as default};
