import{j as e,B as n,C as _e,T as a,d as m,ai as ce,w as ks,x as Ke,y as T,aj as Rs,z as Ve,H as de,a as x,aG as xe,G as O,W as be,p as fe,am as ye,u as I,t as Fs,v as zs,aq as Os,ar as $s,as as Gs,at as Je,au as u,av as Us,ag as Bs,r as Z,aZ as qs,g as Ye,aw as Hs,ax as _s,ap as Ks,ay as Q,az as X,aB as ee,a_ as Ze,e as d,I as y,a$ as Qe,b0 as Xe,aC as he,aD as me,aE as ue,a5 as g,F as es,s as ss,R as Vs,aF as se,aI as ge,aL as Js,b1 as as,L as je,b2 as pe,aH as we,a4 as Ys,E as Zs,D as Qs,aJ as Xs}from"./mui-Cr9U6iW2.js";import{r as o,b as ts}from"./vendor-CjD1bmmO.js";import{u as ea}from"./notistack.esm-Ca-E78ev.js";import{b as sa,c as aa,a as ta,u as na,h as ra,j as ia,k as la,l as oa,f as ca,g as da,m as xa}from"./useStreamlinedData-D6kYFYJc.js";import{M as ae}from"./MetricCard-CCtxyf7i.js";import"./UnifiedDataService-QPELPnrI.js";import"./index-B0laaR9q.js";import"./stripe-ggaMUove.js";import"./index.esm-B4qVkIPL.js";import"./index.esm-DmQE6AXN.js";const w=r=>r.firstName&&r.lastName?`${r.firstName} ${r.lastName}`:r.email,ha=r=>{var b,f,P;const l=((b=r.firstName)==null?void 0:b.charAt(0))||((f=r.email)==null?void 0:f.charAt(0))||"U",p=((P=r.lastName)==null?void 0:P.charAt(0))||"";return l+p},ma=r=>{switch(r){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},ua=r=>{switch(r){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},ns=r=>{switch(r){case"active":return e.jsx(fe,{});case"pending":return e.jsx(ye,{});case"suspended":return e.jsx(Xs,{});case"removed":return e.jsx(we,{});default:return e.jsx(be,{})}},te=()=>{const l="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let p="";for(let b=0;b<12;b++)p+=l.charAt(Math.floor(Math.random()*l.length));return p},ve=(r,l)=>{var f,P;if(!r||!l)return!1;const p=(f=r.role)==null?void 0:f.toUpperCase(),b=(P=l.role)==null?void 0:P.toUpperCase();return p==="ENTERPRISE_USER"||p==="OWNER"||p==="ADMIN"&&b!=="ENTERPRISE_USER"&&b!=="OWNER"?!0:r.id===l.id},ga=(r,l)=>!r.assignedProjects||!l?[]:l.filter(p=>r.assignedProjects.includes(p.id)),La=()=>{var He;const{enqueueSnackbar:r}=ea(),{data:l,loading:p,error:b}=sa(),{data:f,loading:P,error:rs}=aa(),{data:A,loading:is,error:ls,refetch:C}=ta(),{data:c,loading:os,error:cs,refetch:N}=na(),{data:ds,loading:xs,error:hs}=ra(),ms=ia(),us=la(),gs=oa(),Ie=ca(),js=da(),ne=xa(),[ps,k]=o.useState(!1),[vs,$]=o.useState(!1),[bs,G]=o.useState(!1),[fs,U]=o.useState(!1),[re,Pe]=o.useState(""),[R,Ce]=o.useState(""),[F,Le]=o.useState(""),[Te,Ae]=o.useState("member"),[Ne,We]=o.useState(""),[Se,De]=o.useState(""),[Ee,Me]=o.useState(""),[ie,B]=o.useState(""),[W,ys]=o.useState(!0),[t,z]=o.useState(void 0),[ke,Re]=o.useState(null),[q,Fe]=o.useState(""),[le,ze]=o.useState(""),[oe,Oe]=o.useState(""),[$e,Ge]=o.useState("member"),[Ue,Be]=o.useState(""),[ws,H]=o.useState(!1),[_,K]=o.useState(""),[S,V]=o.useState(""),[L,qe]=o.useState(!0),Is=p||P||is||os||xs,Ps=b||rs||ls||cs||hs;ts.useEffect(()=>{W&&B(te())},[W]),ts.useEffect(()=>{const s=async()=>{await Promise.all([N(),C()])};return window.addEventListener("licenses:refresh",s),()=>window.removeEventListener("licenses:refresh",s)},[N,C]);const h=o.useMemo(()=>{if(!l||!f||!A||!c)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableLicenses:0,totalLicenses:0,assignedLicenses:0}};const s=A.filter(j=>j.status==="active").length,i=A.filter(j=>j.status==="pending").length,M=c.length,v=c.filter(j=>j.assignedTo).length,J=c.filter(j=>j.status==="PENDING"&&!j.assignedTo).length,Y={totalMembers:A.length,activeMembers:s,pendingInvites:i,availableLicenses:J,totalLicenses:M,assignedLicenses:v};return{members:A,stats:Y}},[l,f,A,c]),D=s=>{if(!s.licenseAssignment)return null;const i=c==null?void 0:c.find(M=>{var v;return M.id===((v=s.licenseAssignment)==null?void 0:v.licenseId)});return{licenseId:s.licenseAssignment.licenseId,licenseType:s.licenseAssignment.licenseType,licenseKey:s.licenseAssignment.licenseKey,status:(i==null?void 0:i.status)||"UNKNOWN"}},Cs=(s,i)=>{z(i),Re(s.currentTarget)},E=()=>{Re(null)},Ls=async()=>{var s,i,M;if(!re.trim()){r("Please enter an email address",{variant:"error"});return}if(!R.trim()){r("Please enter a first name",{variant:"error"});return}if(!F.trim()){r("Please enter a last name",{variant:"error"});return}if(!ie.trim()){r("Please provide a temporary password",{variant:"error"});return}if(h.stats.availableLicenses<=0){r("No available licenses. Please generate more licenses first.",{variant:"error"});return}try{const v={firstName:R.trim(),lastName:F.trim(),email:re.trim().toLowerCase(),role:Te,status:"pending",organization:{id:((s=l==null?void 0:l.organization)==null?void 0:s.id)||"",name:((i=l==null?void 0:l.organization)==null?void 0:i.name)||"",tier:((M=l==null?void 0:l.organization)==null?void 0:M.tier)||"BASIC"},department:Ne.trim()||"",assignedProjects:[],avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(R+" "+F)}&background=667eea&color=fff`},J=await ms.mutate({...v,temporaryPassword:ie,position:Se.trim()||"",phone:Ee.trim()||""}),Y=c==null?void 0:c.find(j=>j.status==="PENDING"&&!j.assignedTo);if(Y&&J)try{await Ie.mutate({licenseId:Y.id,userId:J})}catch(j){console.warn("Failed to auto-assign license:",j)}r(`Team member ${R} ${F} created successfully with license assigned. They can now login with their email and temporary password.`,{variant:"success"}),Pe(""),Ce(""),Le(""),Ae("member"),We(""),De(""),Me(""),B(te()),k(!1),await Promise.all([C(),N()])}catch(v){console.error("❌ [TeamPage] Failed to create team member:",v),r((v==null?void 0:v.message)||"Failed to create team member",{variant:"error"})}},Ts=s=>{const i=s||t;if(!i){r("Unable to load member data. Please try again.",{variant:"error"});return}E(),z(i),ze(i.firstName||""),Oe(i.lastName||""),Ge(i.role||"member"),Be(i.department||""),H(!1),K(""),V(""),qe(!0),$(!0)},As=async()=>{if(!t){r("No team member selected",{variant:"error"});return}if(!ve(l,t)){r("You do not have permission to change this password",{variant:"error"});return}const s=L?te():_;if(!L){if(!s.trim()){r("Please enter a new password",{variant:"error"});return}if(s!==S){r("Passwords do not match",{variant:"error"});return}if(s.length<8){r("Password must be at least 8 characters long",{variant:"error"});return}}try{await ne.mutate({memberId:t.id,newPassword:s}),r(`Password ${L?"generated and ":""}updated successfully for ${w(t)}`,{variant:"success"}),H(!1),K(""),V("")}catch(i){console.error("❌ [TeamPage] Failed to update password:",i),r((i==null?void 0:i.message)||"Failed to update password",{variant:"error"})}},Ns=()=>{t&&(E(),G(!0))},Ws=async()=>{if(t)try{const s=D(t);await gs.mutate({memberId:t.id}),s?r(`${w(t)} has been removed from the team. Their license has been released back to the available pool.`,{variant:"success"}):r(`${w(t)} has been removed from the team`,{variant:"success"}),G(!1),z(void 0),await Promise.all([C(),N()])}catch(s){console.error("❌ [TeamPage] Failed to remove team member:",s),r((s==null?void 0:s.message)||"Failed to remove team member",{variant:"error"})}},Ss=()=>{t&&(r(`Invitation resent to ${t.email}`,{variant:"success"}),E())},Ds=async()=>{if(!t||!q){r("Please select a valid license to assign",{variant:"error"});return}try{await Ie.mutate({licenseId:q,userId:t.id}),r(`License assigned to ${w(t)}`,{variant:"success"}),Fe(""),U(!1),E(),await Promise.all([N(),C()])}catch(s){console.error("❌ [TeamPage] Failed to assign license:",s),r((s==null?void 0:s.message)||"Failed to assign license",{variant:"error"})}},Es=async()=>{if(t)try{const s=D(t);if(!s){r("This team member has no license to release",{variant:"warning"});return}await js.mutate({licenseId:s.licenseId}),r(`${s.licenseType} license has been released from ${w(t)} and is now available for reassignment.`,{variant:"success"}),E(),await Promise.all([N(),C()])}catch(s){console.error("❌ [TeamPage] Failed to release license:",s),r((s==null?void 0:s.message)||"Failed to release license",{variant:"error"})}},Ms=async()=>{if(t)try{await us.mutate({memberId:t.id,updates:{firstName:le,lastName:oe,role:$e,department:Ue||""}}),r(`Team member ${le} ${oe} updated successfully`,{variant:"success"}),$(!1),z(void 0),C()}catch(s){r((s==null?void 0:s.message)||"Failed to update team member",{variant:"error"})}};return Is?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(n,{textAlign:"center",children:[e.jsx(_e,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):Ps?e.jsx(n,{sx:{p:3},children:e.jsxs(m,{severity:"error",children:[e.jsx(ce,{children:"Unable to Load Team Data"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs(ks,{dense:!0,children:[e.jsxs(Ke,{children:[e.jsx(T,{children:e.jsx(Rs,{fontSize:"small"})}),e.jsx(Ve,{primary:"Network connectivity issues"})]}),e.jsxs(Ke,{children:[e.jsx(T,{children:e.jsx(de,{fontSize:"small"})}),e.jsx(Ve,{primary:"Authentication token expired"})]})]}),e.jsx(n,{sx:{mt:2},children:e.jsx(x,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!l||!f?e.jsx(n,{sx:{p:3},children:e.jsxs(m,{severity:"info",children:[e.jsx(ce,{children:"Setting Up Team Management"}),e.jsx(a,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(n,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(a,{variant:"body1",color:"text.secondary",children:["Manage your ",((He=f.organization)==null?void 0:He.name)||"Organization"," team members and permissions"]})]}),e.jsx(x,{variant:"contained",startIcon:e.jsx(xe,{}),onClick:()=>k(!0),disabled:h.stats.availableLicenses<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(O,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(O,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ae,{title:"Total Members",value:h.stats.totalMembers,icon:e.jsx(be,{}),color:"primary"})}),e.jsx(O,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ae,{title:"Active Members",value:h.stats.activeMembers,icon:e.jsx(fe,{}),color:"success"})}),e.jsx(O,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ae,{title:"Pending Invites",value:h.stats.pendingInvites,icon:e.jsx(ye,{}),color:"warning"})}),e.jsx(O,{item:!0,xs:12,sm:6,md:3,children:e.jsx(ae,{title:"Available Licenses",value:`${h.stats.availableLicenses}/${h.stats.totalLicenses}`,icon:e.jsx(I,{}),color:"primary"})})]}),h.stats.availableLicenses<=0&&e.jsxs(m,{severity:"warning",sx:{mb:4},children:[e.jsx(ce,{children:"No Available Licenses"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"You need to generate more licenses to invite new team members. Go to the Licenses page to create additional licenses."}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Generate Licenses"}),e.jsx(x,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(Fs,{children:e.jsxs(zs,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",h.members.length,")"]}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(I,{}),onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Manage Licenses"})]}),e.jsx(Os,{children:e.jsxs($s,{children:[e.jsx(Gs,{children:e.jsxs(Je,{children:[e.jsx(u,{sx:{fontWeight:600},children:"Member"}),e.jsx(u,{sx:{fontWeight:600},children:"Role"}),e.jsx(u,{sx:{fontWeight:600},children:"Status"}),e.jsx(u,{sx:{fontWeight:600},children:"Department"}),e.jsx(u,{sx:{fontWeight:600},children:"License"}),e.jsx(u,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(u,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Us,{children:h.members.map(s=>e.jsxs(Je,{hover:!0,children:[e.jsx(u,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Bs,{src:s.avatar,sx:{width:40,height:40},children:ha(s)}),e.jsxs(n,{children:[e.jsx(a,{variant:"body1",sx:{fontWeight:500},children:w(s)}),e.jsx(a,{variant:"body2",color:"text.secondary",children:s.email})]})]})}),e.jsx(u,{children:e.jsx(Z,{label:s.role.toUpperCase(),color:ma(s.role),size:"small",icon:s.role==="admin"?e.jsx(qs,{}):void 0})}),e.jsx(u,{children:e.jsx(Z,{icon:ns(s.status),label:s.status.toUpperCase(),color:ua(s.status),size:"small"})}),e.jsx(u,{children:e.jsx(a,{variant:"body2",children:s.department||"Unassigned"})}),e.jsx(u,{children:e.jsx(n,{children:(()=>{const i=D(s);return i?e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:i.licenseType}),e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[i.licenseKey.substring(0,12),"..."]}),e.jsx(Z,{label:i.status,size:"small",color:i.status==="ACTIVE"?"success":"warning",sx:{mt:.5}})]}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"None"})})()})}),e.jsx(u,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.lastActive?new Date(s.lastActive).toLocaleDateString():"Never"})}),e.jsx(u,{children:e.jsx(Ye,{size:"small",onClick:i=>Cs(i,s),disabled:s.role==="owner"&&s.id===l.id,children:e.jsx(Hs,{})})})]},s.id))})]})})]})}),e.jsx(_s,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>k(!0),disabled:h.stats.availableLicenses<=0,children:e.jsx(Ks,{})}),e.jsxs(Q,{open:ps,onClose:()=>k(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(X,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(xe,{}),"Create New Team Member"]})}),e.jsx(ee,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ze,{})," Personal Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:R,onChange:s=>Ce(s.target.value),placeholder:"John",required:!0}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:F,onChange:s=>Le(s.target.value),placeholder:"Doe",required:!0})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:re,onChange:s=>Pe(s.target.value),placeholder:"john.doe@company.com",required:!0,sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Phone Number (Optional)",value:Ee,onChange:s=>Me(s.target.value),placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(Qe,{})})}})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xe,{})," Role & Department"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(he,{fullWidth:!0,children:[e.jsx(me,{children:"Role"}),e.jsxs(ue,{value:Te,label:"Role",onChange:s=>Ae(s.target.value),children:[e.jsx(g,{value:"viewer",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(g,{value:"member",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(g,{value:"manager",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(g,{value:"admin",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:Ne,onChange:s=>We(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title (Optional)",value:Se,onChange:s=>De(s.target.value),placeholder:"Senior Developer, Product Manager..."})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{})," Authentication"]}),e.jsx(es,{control:e.jsx(ss,{checked:W,onChange:s=>ys(s.target.checked)}),label:"Auto-generate secure password",sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Temporary Password",type:"password",value:ie,onChange:s=>B(s.target.value),disabled:W,required:!0,InputProps:{endAdornment:e.jsx(y,{position:"end",children:e.jsx(Ye,{onClick:()=>B(te()),disabled:!W,children:e.jsx(Vs,{})})})},helperText:W?"Password will be auto-generated":"User will need this password to login initially"})]}),e.jsxs(m,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🎫 License Assignment"}),e.jsx(a,{variant:"body2",children:"This team member will be created as a full Firebase authenticated user and automatically assigned an available license. They can login immediately with their email and temporary password."}),e.jsxs(a,{variant:"body2",sx:{mt:1,fontWeight:500},children:["Available licenses: ",h.stats.availableLicenses," of ",h.stats.totalLicenses]})]}),h.stats.availableLicenses<=0&&e.jsx(m,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No licenses available! Please generate more licenses before creating team members."})})]})}),e.jsxs(se,{children:[e.jsx(x,{onClick:()=>k(!1),children:"Cancel"}),e.jsx(x,{onClick:Ls,variant:"contained",startIcon:e.jsx(xe,{}),disabled:h.stats.availableLicenses<=0,children:"Create Team Member"})]})]}),e.jsxs(Q,{open:vs,onClose:()=>{$(!1),z(void 0)},maxWidth:"md",fullWidth:!0,children:[e.jsx(X,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ge,{}),"🚀 ENHANCED Edit Team Member: ",(t==null?void 0:t.firstName)||"Loading..."," ",(t==null?void 0:t.lastName)||""]})}),e.jsx(ee,{children:t?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ze,{})," Personal Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:le,onChange:s=>ze(s.target.value),required:!0,placeholder:"John"}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:oe,onChange:s=>Oe(s.target.value),required:!0,placeholder:"Doe"})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:t.email,disabled:!0,sx:{mb:2},helperText:"Email cannot be changed after account creation"}),e.jsx(d,{fullWidth:!0,label:"Phone Number",value:"",disabled:!0,placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(Qe,{})})},helperText:"Phone number not available in current data model"})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Xe,{})," Role & Department"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(he,{fullWidth:!0,children:[e.jsx(me,{children:"Role"}),e.jsxs(ue,{value:$e,label:"Role",onChange:s=>Ge(s.target.value),children:[e.jsx(g,{value:"viewer",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(g,{value:"member",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(g,{value:"manager",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(g,{value:"admin",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:Ue,onChange:s=>Be(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title",value:"",disabled:!0,placeholder:"Senior Developer, Product Manager...",helperText:"Position not available in current data model"})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(I,{})," License & Access"]}),(()=>{const s=D(t);return e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"License Type",value:(s==null?void 0:s.licenseType)||"None",disabled:!0,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(I,{})})}}),e.jsx(d,{fullWidth:!0,label:"License Status",value:s?s.status:"Unassigned",disabled:!0,InputProps:{startAdornment:e.jsx(y,{position:"start",children:s?e.jsx(fe,{}):e.jsx(ye,{})})}})]})})(),e.jsx(d,{fullWidth:!0,label:"Last Active",value:t.lastActive?new Date(t.lastActive).toLocaleString():"Never",disabled:!0,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(Js,{})})}})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(as,{})," Project Assignments"]}),(()=>{const s=ga(t,ds||[]);return s.length>0?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.map(i=>e.jsx(Z,{label:i.name,color:"primary",variant:"outlined",size:"small",icon:e.jsx(as,{}),sx:{maxWidth:200}},i.id))}),e.jsxs(n,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx("strong",{children:"Project Details:"})}),s.map(i=>e.jsxs(n,{sx:{mb:1,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:i.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Mode: ",i.mode," • Storage: ",i.storageBackend," • Status: ",i.status]}),i.description&&e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:i.description})]},i.id))]})]}):e.jsx(m,{severity:"info",children:e.jsx(a,{variant:"body2",children:"No projects assigned yet. This team member can be assigned to projects from the Cloud Projects page."})})})()]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(de,{})," Account Status"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"Account Status",value:t.status,disabled:!0,InputProps:{startAdornment:e.jsx(y,{position:"start",children:ns(t.status)})}}),e.jsx(d,{fullWidth:!0,label:"Member Since",value:t.joinedAt?new Date(t.joinedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(be,{})})}})]})]}),ve(l,t)&&e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(je,{})," Password Management"]}),ws?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(m,{severity:"warning",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🔐 Password Change"}),e.jsx(a,{variant:"body2",children:L?"A secure password will be automatically generated.":"Please enter a new password with at least 8 characters."})]}),e.jsx(es,{control:e.jsx(ss,{checked:L,onChange:s=>qe(s.target.checked)}),label:"Auto-generate secure password"}),!L&&e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(d,{fullWidth:!0,label:"New Password",type:"password",value:_,onChange:s=>K(s.target.value),placeholder:"Enter new password (min 8 characters)",required:!0,InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(je,{})})}}),e.jsx(d,{fullWidth:!0,label:"Confirm Password",type:"password",value:S,onChange:s=>V(s.target.value),placeholder:"Confirm new password",required:!0,error:S!==""&&_!==S,helperText:S!==""&&_!==S?"Passwords do not match":"",InputProps:{startAdornment:e.jsx(y,{position:"start",children:e.jsx(je,{})})}})]}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",startIcon:e.jsx(pe,{}),onClick:As,disabled:ne.loading,sx:{background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)",color:"white",fontWeight:600},children:ne.loading?"Updating...":L?"Generate & Update Password":"Update Password"}),e.jsx(x,{variant:"outlined",onClick:()=>{H(!1),K(""),V("")},children:"Cancel"})]})]}):e.jsxs(n,{children:[e.jsxs(m,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"🔐 Password Access"})}),e.jsx(a,{variant:"body2",children:(l==null?void 0:l.id)===t.id?"You can change your own password here.":(l==null?void 0:l.role)==="ENTERPRISE_USER"||(l==null?void 0:l.role)==="owner"?"As the account owner, you can change this team member's password.":"As an admin, you can change this team member's password."})]}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(pe,{}),onClick:()=>H(!0),sx:{mb:2},children:"Change Password"})]})]}),e.jsxs(m,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"⚠️ Important Notes"}),e.jsxs(a,{variant:"body2",children:["• Role changes will immediately affect the member's permissions and access levels",e.jsx("br",{}),"• Department information helps with organization and project assignments",e.jsx("br",{}),"• Project assignments are managed from the Cloud Projects page",e.jsx("br",{}),"• License assignments are managed through the Licenses page",e.jsx("br",{}),ve(l,t)&&"• Password changes take effect immediately"]})]})]}):e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(n,{textAlign:"center",children:[e.jsx(_e,{size:40,sx:{mb:2}}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Loading member data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"If this persists, please close and try again."})]})})}),e.jsxs(se,{children:[e.jsx(x,{onClick:()=>$(!1),children:"Cancel"}),e.jsx(x,{onClick:Ms,variant:"contained",startIcon:e.jsx(ge,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(Q,{open:bs,onClose:()=>G(!1),maxWidth:"sm",children:[e.jsx(X,{children:"Remove Team Member"}),e.jsx(ee,{children:t&&e.jsxs(n,{children:[e.jsxs(a,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsx("strong",{children:w(t)})," from your team?"]}),(()=>{const s=D(t);return s?e.jsxs(m,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🎫 License Management"}),e.jsxs(a,{variant:"body2",children:["This team member currently has a ",e.jsx("strong",{children:s.licenseType})," license assigned. When removed, their license will be automatically released back to your available license pool and can be reassigned to another team member."]})]}):e.jsx(m,{severity:"info",sx:{mb:2},children:e.jsx(a,{variant:"body2",children:"This team member has no license assigned, so no license will be affected."})})})(),e.jsx(m,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources."})})]})}),e.jsxs(se,{children:[e.jsx(x,{onClick:()=>G(!1),children:"Cancel"}),e.jsx(x,{onClick:Ws,variant:"contained",color:"error",startIcon:e.jsx(we,{}),children:"Remove Member"})]})]}),e.jsxs(Ys,{anchorEl:ke,open:!!ke,onClose:E,children:[e.jsxs(g,{onClick:()=>Ts(t),children:[e.jsx(T,{children:e.jsx(ge,{})}),"Edit Member"]}),t?D(t)?e.jsxs(g,{onClick:Es,children:[e.jsx(T,{children:e.jsx(pe,{})}),"Release License"]}):e.jsxs(g,{onClick:()=>U(!0),children:[e.jsx(T,{children:e.jsx(I,{})}),"Assign License"]}):null,(t==null?void 0:t.status)==="pending"&&e.jsxs(g,{onClick:Ss,children:[e.jsx(T,{children:e.jsx(Zs,{})}),"Resend Invite"]}),e.jsx(Qs,{}),e.jsxs(g,{onClick:Ns,sx:{color:"error.main"},children:[e.jsx(T,{children:e.jsx(we,{sx:{color:"error.main"}})}),"Remove Member"]})]}),e.jsxs(Q,{open:fs,onClose:()=>U(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(X,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(I,{}),"Assign License to ",t?w(t):"Team Member"]})}),e.jsx(ee,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(m,{severity:"info",children:e.jsxs(a,{variant:"body2",children:["Assigning a license to ",e.jsx("strong",{children:t?w(t):"Team Member"})," (",t==null?void 0:t.email,")"]})}),e.jsxs(he,{fullWidth:!0,children:[e.jsx(me,{children:"Select License"}),e.jsx(ue,{value:q,label:"Select License",onChange:s=>Fe(s.target.value),children:c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).map(s=>e.jsx(g,{value:s.id,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(I,{color:"primary"}),e.jsxs(n,{children:[e.jsxs(a,{variant:"body2",sx:{fontWeight:500},children:[s.tier," License"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.key," • Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id))}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Only unassigned PENDING licenses are available for assignment"})]}),(c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0&&e.jsx(m,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No available licenses found. All licenses are either assigned or not in PENDING status."})}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"The selected license will be assigned to this team member and they will have immediate access to the system."})]})}),e.jsxs(se,{children:[e.jsx(x,{onClick:()=>U(!1),children:"Cancel"}),e.jsx(x,{onClick:Ds,variant:"contained",startIcon:e.jsx(I,{}),disabled:!q||(c==null?void 0:c.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0,children:"Assign License"})]})]})]})};export{La as default};
