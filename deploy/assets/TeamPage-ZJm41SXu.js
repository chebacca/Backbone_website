const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UnifiedDataService-BmG0VMOM.js","assets/index-Qowk6HOu.js","assets/mui-Cr9U6iW2.js","assets/vendor-CjD1bmmO.js","assets/stripe-ggaMUove.js","assets/index-CBai7h7s.css","assets/index.esm-B4qVkIPL.js","assets/index.esm-DmQE6AXN.js"])))=>i.map(i=>d[i]);
import{_ as Hs}from"./index-Qowk6HOu.js";import{j as e,B as t,C as rs,T as a,d as u,ai as ye,w as Vs,x as is,y as M,aj as Ys,z as ls,H as we,a as g,aG as Ie,G as Z,W as je,p as ge,am as Q,u as w,t as Js,v as Zs,aq as Qs,ar as Xs,as as ea,at as os,au as j,av as sa,ag as aa,r as oe,aZ as ta,g as cs,aw as na,ax as ra,ap as ia,ay as ce,az as de,aB as xe,a_ as ds,e as m,I as S,a$ as xs,b0 as hs,aC as U,aD as G,aE as _,a5 as h,F as Pe,s as Ce,R as la,aF as he,aI as Te,aL as oa,b1 as ms,aJ as js,L as Le,b2 as Ae,aH as Ne,a4 as ca,E as da,D as xa}from"./mui-Cr9U6iW2.js";import{r as d,b as us}from"./vendor-CjD1bmmO.js";import{u as ha}from"./notistack.esm-Ca-E78ev.js";import{b as ma,c as ua,a as ga,u as ja,h as va,j as pa,k as fa,l as ba,f as ya,g as wa,m as Ia}from"./useStreamlinedData-u2M67dp8.js";import{M as me}from"./MetricCard-CCtxyf7i.js";import"./stripe-ggaMUove.js";import"./UnifiedDataService-BmG0VMOM.js";import"./index.esm-B4qVkIPL.js";import"./index.esm-DmQE6AXN.js";const N=i=>i.firstName&&i.lastName?`${i.firstName} ${i.lastName}`:i.email,Pa=i=>{var I,P,W;const l=((I=i.firstName)==null?void 0:I.charAt(0))||((P=i.email)==null?void 0:P.charAt(0))||"U",p=((W=i.lastName)==null?void 0:W.charAt(0))||"";return l+p},Ca=i=>{if(!i)return"default";switch(i){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},Ta=i=>{if(!i)return"default";switch(i){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},gs=i=>{if(!i)return e.jsx(je,{});switch(i){case"active":return e.jsx(ge,{});case"pending":return e.jsx(Q,{});case"suspended":return e.jsx(js,{});case"removed":return e.jsx(Ne,{});default:return e.jsx(je,{})}},ue=()=>{const l="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let p="";for(let I=0;I<12;I++)p+=l.charAt(Math.floor(Math.random()*l.length));return p},Se=(i,l)=>{var P,W;if(!i||!l)return!1;const p=(P=i.role)==null?void 0:P.toUpperCase(),I=(W=l.role)==null?void 0:W.toUpperCase();return p==="ENTERPRISE_USER"||p==="OWNER"||p==="ADMIN"&&I!=="ENTERPRISE_USER"&&I!=="OWNER"?!0:i.id===l.id},La=(i,l)=>!i.assignedProjects||!l?[]:l.filter(p=>i.assignedProjects.includes(p.id)),$a=()=>{var ts,ns;const{enqueueSnackbar:i}=ha(),{data:l,loading:p,error:I}=ma(),{data:P,loading:W,error:vs}=ua(),{data:R,loading:ps,error:fs,refetch:C}=ga(),{data:o,loading:bs,error:ys,refetch:T}=ja(),{data:ws,loading:Is,error:Ps}=va(),Cs=pa(),Ts=fa(),Ls=ba(),ve=ya(),We=wa(),pe=Ia(),[As,B]=d.useState(!1),[Ss,X]=d.useState(!1),[Ns,ee]=d.useState(!1),[Ws,se]=d.useState(!1),[fe,De]=d.useState(""),[q,Ee]=d.useState(""),[K,ke]=d.useState(""),[Me,Re]=d.useState("member"),[Fe,$e]=d.useState(""),[ze,Oe]=d.useState(""),[Ue,Ge]=d.useState(""),[be,ae]=d.useState(""),[F,Ds]=d.useState(!0),[H,_e]=d.useState(!1),[n,V]=d.useState(void 0),[Be,qe]=d.useState(null),[D,Ke]=d.useState(""),[te,He]=d.useState(""),[Y,Ve]=d.useState(""),[J,Ye]=d.useState(""),[Je,Ze]=d.useState("member"),[Qe,Xe]=d.useState(""),[L,es]=d.useState(""),[f,ss]=d.useState("pending"),[Es,ne]=d.useState(!1),[re,ie]=d.useState(""),[$,le]=d.useState(""),[E,as]=d.useState(!0),ks=p||W||ps||bs||Is,Ms=I||vs||fs||ys||Ps;us.useEffect(()=>{F&&ae(ue())},[F]),us.useEffect(()=>{const s=async()=>{await Promise.all([T(),C()])},r=async()=>{await Promise.all([C(),T()])};return window.addEventListener("licenses:refresh",s),window.addEventListener("team:refresh",r),()=>{window.removeEventListener("licenses:refresh",s),window.removeEventListener("team:refresh",r)}},[T,C]);const A=d.useMemo(()=>{if(!l||!P||!R||!o)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableLicenses:0,totalLicenses:0,assignedLicenses:0}};const s=R.filter(b=>b.status==="active").length,r=R.filter(b=>b.status==="pending").length,c=o.length,x=o.filter(b=>b.assignedTo).length,O=o.filter(b=>b.status==="PENDING"&&!b.assignedTo).length,v={totalMembers:R.length,activeMembers:s,pendingInvites:r,availableLicenses:O,totalLicenses:c,assignedLicenses:x};return{members:R,stats:v}},[l,P,R,o]),y=s=>{if(!s.licenseAssignment)return null;const r=o==null?void 0:o.find(c=>{var x;return c.id===((x=s.licenseAssignment)==null?void 0:x.licenseId)});return{licenseId:s.licenseAssignment.licenseId,licenseType:s.licenseAssignment.licenseType,licenseKey:s.licenseAssignment.licenseKey,status:(r==null?void 0:r.status)||"UNKNOWN"}},k=()=>o?o.filter(s=>s.status==="PENDING"&&!s.assignedTo):[],Rs=s=>{if(!o)return[];const r=s?y(s):null;return o.filter(c=>!!(c.status==="PENDING"&&!c.assignedTo||r&&c.id===r.licenseId))},Fs=(s,r)=>{V(r),qe(s.currentTarget)},z=()=>{qe(null)},$s=async()=>{var s,r,c;if(!fe.trim()){i("Please enter an email address",{variant:"error"});return}if(!q.trim()){i("Please enter a first name",{variant:"error"});return}if(!K.trim()){i("Please enter a last name",{variant:"error"});return}if(!be.trim()){i("Please provide a temporary password",{variant:"error"});return}if(k().length<=0){i("No available licenses. Please generate more licenses first.",{variant:"error"});return}if(!D){i("Please select a license to assign to this team member",{variant:"error"});return}try{const x={firstName:q.trim(),lastName:K.trim(),email:fe.trim().toLowerCase(),role:Me,status:H?"active":"pending",organization:{id:((s=l==null?void 0:l.organization)==null?void 0:s.id)||"",name:((r=l==null?void 0:l.organization)==null?void 0:r.name)||"",tier:((c=l==null?void 0:l.organization)==null?void 0:c.tier)||"BASIC"},department:Fe.trim()||"",assignedProjects:[],avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(q+" "+K)}&background=667eea&color=fff`},O=await Cs.mutate({...x,temporaryPassword:be,position:ze.trim()||"",phone:Ue.trim()||""});if(D&&O)try{await ve.mutate({licenseId:D,userId:O});const v=o==null?void 0:o.find(b=>b.id===D);console.log(`âœ… [TeamPage] Assigned ${v==null?void 0:v.tier} license to new member:`,O)}catch(v){console.warn("Failed to assign selected license:",v)}i(`Team member ${q} ${K} created successfully with license assigned. Status: ${H?"Active - ready to login":"Pending - requires activation"}.`,{variant:"success"}),console.log("ðŸ”„ Refreshing team data after member creation..."),await Promise.all([C(),T()]);try{const{unifiedDataService:v}=await Hs(async()=>{const{unifiedDataService:b}=await import("./UnifiedDataService-BmG0VMOM.js");return{unifiedDataService:b}},__vite__mapDeps([0,1,2,3,4,5,6,7]));await v.forceRefreshLicenses(),v.clearCacheByPattern("org-team-members-"),v.clearCacheByPattern("org-users-"),console.log("ðŸ”„ Force refreshed team data via UnifiedDataService")}catch(v){console.warn("âš ï¸ Failed to force refresh via UnifiedDataService:",v)}setTimeout(async()=>{console.log("ðŸ”„ Secondary refresh for eventual consistency..."),await Promise.all([C(),T()])},1e3),setTimeout(async()=>{console.log("ðŸ”„ Final refresh for safety..."),await Promise.all([C(),T()])},3e3),window.dispatchEvent(new CustomEvent("team:refresh",{detail:{action:"member_created",memberId:O,licenseId:D}})),De(""),Ee(""),ke(""),Re("member"),$e(""),Oe(""),Ge(""),ae(ue()),Ke(""),_e(!1),B(!1)}catch(x){console.error("âŒ [TeamPage] Failed to create team member:",x),i((x==null?void 0:x.message)||"Failed to create team member",{variant:"error"})}},zs=s=>{const r=s||n;if(!r){i("Unable to load member data. Please try again.",{variant:"error"});return}z(),V(r),Ve(r.firstName||""),Ye(r.lastName||""),Ze(r.role||"member"),Xe(r.department||""),ss(r.status||"pending");const c=y(r);es((c==null?void 0:c.licenseId)||""),ne(!1),ie(""),le(""),as(!0),X(!0)},Os=async()=>{if(!n){i("No team member selected",{variant:"error"});return}if(!Se(l,n)){i("You do not have permission to change this password",{variant:"error"});return}const s=E?ue():re;if(!E){if(!s.trim()){i("Please enter a new password",{variant:"error"});return}if(s!==$){i("Passwords do not match",{variant:"error"});return}if(s.length<8){i("Password must be at least 8 characters long",{variant:"error"});return}}try{await pe.mutate({memberId:n.id,newPassword:s}),i(`Password ${E?"generated and ":""}updated successfully for ${N(n)}`,{variant:"success"}),ne(!1),ie(""),le("")}catch(r){console.error("âŒ [TeamPage] Failed to update password:",r),i((r==null?void 0:r.message)||"Failed to update password",{variant:"error"})}},Us=()=>{n&&(z(),ee(!0))},Gs=async()=>{if(n)try{const s=y(n);await Ls.mutate({memberId:n.id}),s?i(`${N(n)} has been removed from the team. Their license has been released back to the available pool.`,{variant:"success"}):i(`${N(n)} has been removed from the team`,{variant:"success"}),ee(!1),V(void 0),await Promise.all([C(),T()])}catch(s){console.error("âŒ [TeamPage] Failed to remove team member:",s),i((s==null?void 0:s.message)||"Failed to remove team member",{variant:"error"})}},_s=()=>{n&&(i(`Invitation resent to ${n.email}`,{variant:"success"}),z())},Bs=async()=>{if(!n||!te){i("Please select a valid license to assign",{variant:"error"});return}try{await ve.mutate({licenseId:te,userId:n.id}),i(`License assigned to ${N(n)}`,{variant:"success"}),He(""),se(!1),z(),await Promise.all([T(),C()])}catch(s){console.error("âŒ [TeamPage] Failed to assign license:",s),i((s==null?void 0:s.message)||"Failed to assign license",{variant:"error"})}},qs=async()=>{if(n)try{const s=y(n);if(!s){i("This team member has no license to release",{variant:"warning"});return}await We.mutate({licenseId:s.licenseId}),i(`${s.licenseType} license has been released from ${N(n)} and is now available for reassignment.`,{variant:"success"}),z(),await Promise.all([T(),C()])}catch(s){console.error("âŒ [TeamPage] Failed to release license:",s),i((s==null?void 0:s.message)||"Failed to release license",{variant:"error"})}},Ks=async()=>{if(n)try{await Ts.mutate({memberId:n.id,updates:{firstName:Y,lastName:J,role:Je,department:Qe||"",status:f}});const s=y(n),r=(s==null?void 0:s.licenseId)||"";if(L!==r){if(r)try{await We.mutate({licenseId:r}),console.log("âœ… [TeamPage] Released current license:",r)}catch(c){console.warn("âš ï¸ [TeamPage] Failed to release current license:",c)}if(L)try{await ve.mutate({licenseId:L,userId:n.id});const c=o==null?void 0:o.find(x=>x.id===L);console.log("âœ… [TeamPage] Assigned new license:",L,c==null?void 0:c.tier),i(`Team member ${Y} ${J} updated successfully with ${(c==null?void 0:c.tier)||"new"} license assigned`,{variant:"success"})}catch(c){console.error("âŒ [TeamPage] Failed to assign new license:",c),i("Member updated but license assignment failed",{variant:"warning"})}else i(`Team member ${Y} ${J} updated successfully. License removed.`,{variant:"success"})}else i(`Team member ${Y} ${J} updated successfully`,{variant:"success"});X(!1),V(void 0),await Promise.all([C(),T()])}catch(s){i((s==null?void 0:s.message)||"Failed to update team member",{variant:"error"})}};return ks?e.jsx(t,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(t,{textAlign:"center",children:[e.jsx(rs,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):Ms?e.jsx(t,{sx:{p:3},children:e.jsxs(u,{severity:"error",children:[e.jsx(ye,{children:"Unable to Load Team Data"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs(Vs,{dense:!0,children:[e.jsxs(is,{children:[e.jsx(M,{children:e.jsx(Ys,{fontSize:"small"})}),e.jsx(ls,{primary:"Network connectivity issues"})]}),e.jsxs(is,{children:[e.jsx(M,{children:e.jsx(we,{fontSize:"small"})}),e.jsx(ls,{primary:"Authentication token expired"})]})]}),e.jsx(t,{sx:{mt:2},children:e.jsx(g,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!l||!P?e.jsx(t,{sx:{p:3},children:e.jsxs(u,{severity:"info",children:[e.jsx(ye,{children:"Setting Up Team Management"}),e.jsx(a,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(t,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(a,{variant:"body1",color:"text.secondary",children:["Manage your ",((ts=P.organization)==null?void 0:ts.name)||"Organization"," team members and permissions"]})]}),e.jsx(g,{variant:"contained",startIcon:e.jsx(Ie,{}),onClick:()=>B(!0),disabled:k().length<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(Z,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:e.jsx(me,{title:"Total Members",value:A.stats.totalMembers,icon:e.jsx(je,{}),color:"primary"})}),e.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:e.jsx(me,{title:"Active Members",value:A.stats.activeMembers,icon:e.jsx(ge,{}),color:"success"})}),e.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:e.jsx(me,{title:"Pending Invites",value:A.stats.pendingInvites,icon:e.jsx(Q,{}),color:"warning"})}),e.jsx(Z,{item:!0,xs:12,sm:6,md:3,children:e.jsx(me,{title:"Available Licenses",value:`${A.stats.availableLicenses}/${A.stats.totalLicenses}`,icon:e.jsx(w,{}),color:"primary"})})]}),A.stats.availableLicenses<=0&&e.jsxs(u,{severity:"warning",sx:{mb:4},children:[e.jsx(ye,{children:"No Available Licenses"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"You need to generate more licenses to invite new team members. Go to the Licenses page to create additional licenses."}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(g,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Generate Licenses"}),e.jsx(g,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(Js,{children:e.jsxs(Zs,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",A.members.length,")"]}),e.jsx(g,{variant:"outlined",startIcon:e.jsx(w,{}),onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Manage Licenses"})]}),e.jsx(Qs,{children:e.jsxs(Xs,{children:[e.jsx(ea,{children:e.jsxs(os,{children:[e.jsx(j,{sx:{fontWeight:600},children:"Member"}),e.jsx(j,{sx:{fontWeight:600},children:"Role"}),e.jsx(j,{sx:{fontWeight:600},children:"Status"}),e.jsx(j,{sx:{fontWeight:600},children:"Department"}),e.jsx(j,{sx:{fontWeight:600},children:"License"}),e.jsx(j,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(j,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(sa,{children:A.members.filter(s=>s&&s.id&&s.email).map(s=>{var r,c;return e.jsxs(os,{hover:!0,children:[e.jsx(j,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(aa,{src:s.avatar,sx:{width:40,height:40},children:Pa(s)}),e.jsxs(t,{children:[e.jsx(a,{variant:"body1",sx:{fontWeight:500},children:N(s)}),e.jsx(a,{variant:"body2",color:"text.secondary",children:s.email})]})]})}),e.jsx(j,{children:e.jsx(oe,{label:((r=s.role)==null?void 0:r.toUpperCase())||"UNKNOWN",color:Ca(s.role),size:"small",icon:s.role==="admin"?e.jsx(ta,{}):void 0})}),e.jsx(j,{children:e.jsx(oe,{icon:gs(s.status),label:((c=s.status)==null?void 0:c.toUpperCase())||"UNKNOWN",color:Ta(s.status),size:"small"})}),e.jsx(j,{children:e.jsx(a,{variant:"body2",children:s.department||"Unassigned"})}),e.jsx(j,{children:e.jsx(t,{children:(()=>{const x=y(s);return x?e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:x.licenseType}),e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[x.licenseKey.substring(0,12),"..."]}),e.jsx(oe,{label:x.status,size:"small",color:x.status==="ACTIVE"?"success":"warning",sx:{mt:.5}})]}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"None"})})()})}),e.jsx(j,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.lastActive?new Date(s.lastActive).toLocaleDateString():"Never"})}),e.jsx(j,{children:e.jsx(cs,{size:"small",onClick:x=>Fs(x,s),disabled:s.role==="owner"&&s.id===(l==null?void 0:l.id),children:e.jsx(na,{})})})]},s.id)})})]})})]})}),e.jsx(ra,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>B(!0),disabled:k().length<=0,children:e.jsx(ia,{})}),e.jsxs(ce,{open:As,onClose:()=>B(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(de,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Ie,{}),"Create New Team Member"]})}),e.jsx(xe,{children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ds,{})," Personal Information"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(m,{fullWidth:!0,label:"First Name",value:q,onChange:s=>Ee(s.target.value),placeholder:"John",required:!0}),e.jsx(m,{fullWidth:!0,label:"Last Name",value:K,onChange:s=>ke(s.target.value),placeholder:"Doe",required:!0})]}),e.jsx(m,{fullWidth:!0,label:"Email Address",type:"email",value:fe,onChange:s=>De(s.target.value),placeholder:"john.doe@company.com",required:!0,sx:{mb:2}}),e.jsx(m,{fullWidth:!0,label:"Phone Number (Optional)",value:Ue,onChange:s=>Ge(s.target.value),placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(S,{position:"start",children:e.jsx(xs,{})})}})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(hs,{})," Role & Department"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(U,{fullWidth:!0,children:[e.jsx(G,{children:"Role"}),e.jsxs(_,{value:Me,label:"Role",onChange:s=>Re(s.target.value),children:[e.jsx(h,{value:"viewer",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(h,{value:"member",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(h,{value:"manager",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(h,{value:"admin",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(m,{fullWidth:!0,label:"Department",value:Fe,onChange:s=>$e(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(m,{fullWidth:!0,label:"Position/Title (Optional)",value:ze,onChange:s=>Oe(s.target.value),placeholder:"Senior Developer, Product Manager..."})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(we,{})," Authentication"]}),e.jsx(Pe,{control:e.jsx(Ce,{checked:F,onChange:s=>Ds(s.target.checked)}),label:"Auto-generate secure password",sx:{mb:2}}),e.jsx(m,{fullWidth:!0,label:"Temporary Password",type:"password",value:be,onChange:s=>ae(s.target.value),disabled:F,required:!0,InputProps:{endAdornment:e.jsx(S,{position:"end",children:e.jsx(cs,{onClick:()=>ae(ue()),disabled:!F,children:e.jsx(la,{})})})},helperText:F?"Password will be auto-generated":"User will need this password to login initially",sx:{mb:2}}),e.jsx(Pe,{control:e.jsx(Ce,{checked:H,onChange:s=>_e(s.target.checked)}),label:"Activate team member immediately",sx:{mb:1}}),e.jsx(u,{severity:H?"success":"info",sx:{mt:1},children:e.jsx(a,{variant:"body2",children:H?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"âœ… Active Status:"}),' Team member will be created with "active" status and can login immediately with their credentials.']}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"â³ Pending Status:"}),' Team member will be created with "pending" status and will need to be activated later through the edit dialog.']})})})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(w,{})," License Assignment"]}),e.jsxs(U,{fullWidth:!0,sx:{mb:2},children:[e.jsx(G,{children:"Select License to Assign"}),e.jsx(_,{value:D,label:"Select License to Assign",onChange:s=>Ke(s.target.value),required:!0,children:k().length===0?e.jsx(h,{disabled:!0,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"No available licenses found"})}):k().map(s=>e.jsx(h,{value:s.id,children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(w,{color:"primary"}),e.jsxs(t,{sx:{flex:1},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:s.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.tier," â€¢ ",s.key," â€¢ Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id))}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Only unassigned PENDING licenses are available for assignment"})]}),e.jsxs(u,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸŽ« License Assignment Details"}),e.jsx(a,{variant:"body2",children:"This team member will be created as a full Firebase authenticated user and assigned the selected license. They can login immediately with their email and temporary password."}),e.jsxs(a,{variant:"body2",sx:{mt:1,fontWeight:500},children:["Available licenses: ",A.stats.availableLicenses," of ",A.stats.totalLicenses]})]})]}),k().length<=0&&e.jsx(u,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No licenses available! Please generate more licenses before creating team members."})})]})}),e.jsxs(he,{children:[e.jsx(g,{onClick:()=>B(!1),children:"Cancel"}),e.jsx(g,{onClick:$s,variant:"contained",startIcon:e.jsx(Ie,{}),disabled:k().length<=0||!D,children:"Create Team Member"})]})]}),e.jsxs(ce,{open:Ss,onClose:()=>{X(!1),V(void 0)},maxWidth:"md",fullWidth:!0,children:[e.jsx(de,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Te,{}),"ðŸš€ ENHANCED Edit Team Member: ",(n==null?void 0:n.firstName)||"Loading..."," ",(n==null?void 0:n.lastName)||""]})}),e.jsx(xe,{children:n?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ds,{})," Personal Information"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(m,{fullWidth:!0,label:"First Name",value:Y,onChange:s=>Ve(s.target.value),required:!0,placeholder:"John"}),e.jsx(m,{fullWidth:!0,label:"Last Name",value:J,onChange:s=>Ye(s.target.value),required:!0,placeholder:"Doe"})]}),e.jsx(m,{fullWidth:!0,label:"Email Address",type:"email",value:n.email,disabled:!0,sx:{mb:2},helperText:"Email cannot be changed after account creation"}),e.jsx(m,{fullWidth:!0,label:"Phone Number",value:"",disabled:!0,placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(S,{position:"start",children:e.jsx(xs,{})})},helperText:"Phone number not available in current data model"})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(hs,{})," Role & Department"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(U,{fullWidth:!0,children:[e.jsx(G,{children:"Role"}),e.jsxs(_,{value:Je,label:"Role",onChange:s=>Ze(s.target.value),children:[e.jsx(h,{value:"viewer",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(h,{value:"member",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(h,{value:"manager",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(h,{value:"admin",children:e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(m,{fullWidth:!0,label:"Department",value:Qe,onChange:s=>Xe(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(m,{fullWidth:!0,label:"Position/Title",value:"",disabled:!0,placeholder:"Senior Developer, Product Manager...",helperText:"Position not available in current data model"})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(w,{})," License & Access"]}),e.jsxs(U,{fullWidth:!0,sx:{mb:2},children:[e.jsx(G,{children:"Assign License"}),e.jsxs(_,{value:L,label:"Assign License",onChange:s=>es(s.target.value),children:[e.jsx(h,{value:"",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{color:"disabled"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"No License (Remove current license)"})]})}),Rs(n).map(s=>{var c;const r=((c=y(n))==null?void 0:c.licenseId)===s.id;return e.jsx(h,{value:s.id,children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(w,{color:r?"primary":"action"}),e.jsxs(t,{sx:{flex:1},children:[e.jsxs(a,{variant:"body2",sx:{fontWeight:r?600:400},children:[s.name," ",r&&"(Current)"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.tier," â€¢ ",s.key," â€¢ Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id)})]}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"You can reassign licenses between team members. Released licenses return to the available pool."})]}),(()=>{const s=y(n);return o==null||o.find(r=>r.id===L),s!=null&&s.licenseId,e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(m,{fullWidth:!0,label:"Current License",value:(s==null?void 0:s.licenseType)||"None",disabled:!0,InputProps:{startAdornment:e.jsx(S,{position:"start",children:e.jsx(w,{})})}}),e.jsx(m,{fullWidth:!0,label:"License Status",value:s?s.status:"Unassigned",disabled:!0,InputProps:{startAdornment:e.jsx(S,{position:"start",children:s?e.jsx(ge,{}):e.jsx(Q,{})})}})]})})(),(()=>{const s=y(n),r=o==null?void 0:o.find(x=>x.id===L);return L!==((s==null?void 0:s.licenseId)||"")?e.jsxs(u,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸ”„ License Change Preview"}),e.jsxs(a,{variant:"body2",children:[s?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Current:"})," ",s.licenseType," (",s.licenseKey,")",e.jsx("br",{})]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Current:"})," No license assigned",e.jsx("br",{})]}),e.jsx("strong",{children:"New:"})," ",r?`${r.tier} (${r.key})`:"No license (will be removed)"]}),s&&e.jsx(a,{variant:"body2",sx:{mt:1,fontStyle:"italic"},children:"The current license will be released back to the available pool."})]}):null})(),e.jsx(m,{fullWidth:!0,label:"Last Active",value:n.lastActive?new Date(n.lastActive).toLocaleString():"Never",disabled:!0,InputProps:{startAdornment:e.jsx(S,{position:"start",children:e.jsx(oa,{})})}})]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ms,{})," Project Assignments"]}),(()=>{const s=La(n,ws||[]);return s.length>0?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(t,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.map(r=>e.jsx(oe,{label:r.name,color:"primary",variant:"outlined",size:"small",icon:e.jsx(ms,{}),sx:{maxWidth:200}},r.id))}),e.jsxs(t,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx("strong",{children:"Project Details:"})}),s.map(r=>e.jsxs(t,{sx:{mb:1,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:r.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Mode: ",r.mode," â€¢ Storage: ",r.storageBackend," â€¢ Status: ",r.status]}),r.description&&e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:r.description})]},r.id))]})]}):e.jsx(u,{severity:"info",children:e.jsx(a,{variant:"body2",children:"No projects assigned yet. This team member can be assigned to projects from the Cloud Projects page."})})})()]}),e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(we,{})," Account Status"]}),e.jsxs(t,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(U,{fullWidth:!0,children:[e.jsx(G,{children:"Account Status"}),e.jsxs(_,{value:f,label:"Account Status",onChange:s=>ss(s.target.value),startAdornment:e.jsx(S,{position:"start",children:gs(f)}),children:[e.jsx(h,{value:"active",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ge,{color:"success"}),e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Active"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Can login and access all assigned resources"})]})]})}),e.jsx(h,{value:"pending",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Q,{color:"warning"}),e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Pending"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Awaiting activation or first login"})]})]})}),e.jsx(h,{value:"suspended",children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(js,{color:"error"}),e.jsxs(t,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Suspended"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Temporarily blocked from access"})]})]})})]})]}),e.jsx(m,{fullWidth:!0,label:"Member Since",value:n.joinedAt?new Date(n.joinedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(S,{position:"start",children:e.jsx(je,{})})}})]}),f!==n.status&&e.jsxs(u,{severity:f==="active"?"success":f==="suspended"?"warning":"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸ”„ Status Change Preview"}),e.jsxs(a,{variant:"body2",children:[e.jsx("strong",{children:"Current:"})," ",(ns=n.status)==null?void 0:ns.toUpperCase(),e.jsx("br",{}),e.jsx("strong",{children:"New:"})," ",f==null?void 0:f.toUpperCase()]}),e.jsxs(a,{variant:"body2",sx:{mt:1,fontStyle:"italic"},children:[f==="active"&&"Team member will be able to login and access all assigned resources.",f==="pending"&&"Team member will need to be activated before they can access resources.",f==="suspended"&&"Team member will be blocked from accessing any resources."]})]})]}),Se(l,n)&&e.jsxs(t,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Le,{})," Password Management"]}),Es?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(u,{severity:"warning",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸ” Password Change"}),e.jsx(a,{variant:"body2",children:E?"A secure password will be automatically generated.":"Please enter a new password with at least 8 characters."})]}),e.jsx(Pe,{control:e.jsx(Ce,{checked:E,onChange:s=>as(s.target.checked)}),label:"Auto-generate secure password"}),!E&&e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(m,{fullWidth:!0,label:"New Password",type:"password",value:re,onChange:s=>ie(s.target.value),placeholder:"Enter new password (min 8 characters)",required:!0,InputProps:{startAdornment:e.jsx(S,{position:"start",children:e.jsx(Le,{})})}}),e.jsx(m,{fullWidth:!0,label:"Confirm Password",type:"password",value:$,onChange:s=>le(s.target.value),placeholder:"Confirm new password",required:!0,error:$!==""&&re!==$,helperText:$!==""&&re!==$?"Passwords do not match":"",InputProps:{startAdornment:e.jsx(S,{position:"start",children:e.jsx(Le,{})})}})]}),e.jsxs(t,{sx:{display:"flex",gap:2},children:[e.jsx(g,{variant:"contained",startIcon:e.jsx(Ae,{}),onClick:Os,disabled:pe.loading,sx:{background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)",color:"white",fontWeight:600},children:pe.loading?"Updating...":E?"Generate & Update Password":"Update Password"}),e.jsx(g,{variant:"outlined",onClick:()=>{ne(!1),ie(""),le("")},children:"Cancel"})]})]}):e.jsxs(t,{children:[e.jsxs(u,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"ðŸ” Password Access"})}),e.jsx(a,{variant:"body2",children:(l==null?void 0:l.id)===n.id?"You can change your own password here.":(l==null?void 0:l.role)==="ENTERPRISE_USER"||(l==null?void 0:l.role)==="owner"?"As the account owner, you can change this team member's password.":"As an admin, you can change this team member's password."})]}),e.jsx(g,{variant:"outlined",startIcon:e.jsx(Ae,{}),onClick:()=>ne(!0),sx:{mb:2},children:"Change Password"})]})]}),e.jsxs(u,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"âš ï¸ Important Notes"}),e.jsxs(a,{variant:"body2",children:["â€¢ Role changes will immediately affect the member's permissions and access levels",e.jsx("br",{}),"â€¢ Department information helps with organization and project assignments",e.jsx("br",{}),"â€¢ Project assignments are managed from the Cloud Projects page",e.jsx("br",{}),"â€¢ License assignments are managed through the Licenses page",e.jsx("br",{}),Se(l,n)&&"â€¢ Password changes take effect immediately"]})]})]}):e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(t,{textAlign:"center",children:[e.jsx(rs,{size:40,sx:{mb:2}}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Loading member data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"If this persists, please close and try again."})]})})}),e.jsxs(he,{children:[e.jsx(g,{onClick:()=>X(!1),children:"Cancel"}),e.jsx(g,{onClick:Ks,variant:"contained",startIcon:e.jsx(Te,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(ce,{open:Ns,onClose:()=>ee(!1),maxWidth:"sm",children:[e.jsx(de,{children:"Remove Team Member"}),e.jsx(xe,{children:n&&e.jsxs(t,{children:[e.jsxs(a,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsx("strong",{children:N(n)})," from your team?"]}),(()=>{const s=y(n);return s?e.jsxs(u,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸŽ« License Management"}),e.jsxs(a,{variant:"body2",children:["This team member currently has a ",e.jsx("strong",{children:s.licenseType})," license assigned. When removed, their license will be automatically released back to your available license pool and can be reassigned to another team member."]})]}):e.jsx(u,{severity:"info",sx:{mb:2},children:e.jsx(a,{variant:"body2",children:"This team member has no license assigned, so no license will be affected."})})})(),e.jsx(u,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources."})})]})}),e.jsxs(he,{children:[e.jsx(g,{onClick:()=>ee(!1),children:"Cancel"}),e.jsx(g,{onClick:Gs,variant:"contained",color:"error",startIcon:e.jsx(Ne,{}),children:"Remove Member"})]})]}),e.jsxs(ca,{anchorEl:Be,open:!!Be,onClose:z,children:[e.jsxs(h,{onClick:()=>zs(n),children:[e.jsx(M,{children:e.jsx(Te,{})}),"Edit Member"]}),n?y(n)?e.jsxs(h,{onClick:qs,children:[e.jsx(M,{children:e.jsx(Ae,{})}),"Release License"]}):e.jsxs(h,{onClick:()=>se(!0),children:[e.jsx(M,{children:e.jsx(w,{})}),"Assign License"]}):null,(n==null?void 0:n.status)==="pending"&&e.jsxs(h,{onClick:_s,children:[e.jsx(M,{children:e.jsx(da,{})}),"Resend Invite"]}),e.jsx(xa,{}),e.jsxs(h,{onClick:Us,sx:{color:"error.main"},children:[e.jsx(M,{children:e.jsx(Ne,{sx:{color:"error.main"}})}),"Remove Member"]})]}),e.jsxs(ce,{open:Ws,onClose:()=>se(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(de,{children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(w,{}),"Assign License to ",n?N(n):"Team Member"]})}),e.jsx(xe,{children:e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(u,{severity:"info",children:e.jsxs(a,{variant:"body2",children:["Assigning a license to ",e.jsx("strong",{children:n?N(n):"Team Member"})," (",n==null?void 0:n.email,")"]})}),e.jsxs(U,{fullWidth:!0,children:[e.jsx(G,{children:"Select License"}),e.jsx(_,{value:te,label:"Select License",onChange:s=>He(s.target.value),children:o==null?void 0:o.filter(s=>s.status==="PENDING"&&!s.assignedTo).map(s=>e.jsx(h,{value:s.id,children:e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(w,{color:"primary"}),e.jsxs(t,{children:[e.jsxs(a,{variant:"body2",sx:{fontWeight:500},children:[s.tier," License"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.key," â€¢ Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id))}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Only unassigned PENDING licenses are available for assignment"})]}),(o==null?void 0:o.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0&&e.jsx(u,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No available licenses found. All licenses are either assigned or not in PENDING status."})}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"The selected license will be assigned to this team member and they will have immediate access to the system."})]})}),e.jsxs(he,{children:[e.jsx(g,{onClick:()=>se(!1),children:"Cancel"}),e.jsx(g,{onClick:Bs,variant:"contained",startIcon:e.jsx(w,{}),disabled:!te||(o==null?void 0:o.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0,children:"Assign License"})]})]})]})};export{$a as default};
