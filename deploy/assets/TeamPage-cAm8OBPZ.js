import{j as e,B as n,C as Ee,T as a,d as j,ai as X,w as Is,x as Re,y as N,aj as Ts,z as Fe,H as U,a as x,aG as ee,G as D,W as de,p as ce,am as xe,u as H,t as Ls,v as As,aq as Ws,ar as Ss,as as Ns,at as ze,au as h,av as Ds,ag as ks,r as se,aZ as Ms,g as Oe,aw as Es,ax as Rs,ap as Fs,ay as ae,az as ne,aB as te,a_ as $e,e as d,I as p,a$ as qe,b0 as Be,aC as Ge,aD as He,aE as Je,a5 as g,F as Ve,s as Ye,R as zs,aF as re,aI as ie,aL as Os,b1 as _e,L as oe,b2 as Ke,aH as he,a4 as $s,E as qs,D as Bs,aJ as Gs}from"./mui-Cr9U6iW2.js";import{r as l,b as Ze}from"./vendor-CjD1bmmO.js";import{u as Hs}from"./notistack.esm-Ca-E78ev.js";import{b as Js,c as Vs,a as Ys,u as _s,h as Ks,j as Zs,k as Qs,l as Xs,f as Us,g as ea}from"./useStreamlinedData-DLvSv5OO.js";import{M as J}from"./MetricCard-CCtxyf7i.js";import"./UnifiedDataService-CQgEXsD9.js";import"./index-Cnn4ChlA.js";import"./stripe-ggaMUove.js";import"./index.esm-B4qVkIPL.js";import"./index.esm-DmQE6AXN.js";const sa=r=>{switch(r){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},aa=r=>{switch(r){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},Qe=r=>{switch(r){case"active":return e.jsx(ce,{});case"pending":return e.jsx(xe,{});case"suspended":return e.jsx(Gs,{});case"removed":return e.jsx(he,{});default:return e.jsx(de,{})}},V=()=>{const i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let w="";for(let k=0;k<12;k++)w+=i.charAt(Math.floor(Math.random()*i.length));return w},le=(r,i)=>(console.log("🔐 [canManagePassword] Checking permissions:",{currentUser:r,currentUserRole:r==null?void 0:r.role,currentUserId:r==null?void 0:r.id,targetMember:i,targetMemberRole:i==null?void 0:i.role,targetMemberId:i==null?void 0:i.id}),!r||!i?(console.log("🔐 [canManagePassword] Missing user data"),!1):r.role==="owner"?(console.log("🔐 [canManagePassword] Owner can manage all passwords"),!0):r.role==="admin"&&i.role!=="owner"?(console.log("🔐 [canManagePassword] Admin can manage non-owner passwords"),!0):r.id===i.id?(console.log("🔐 [canManagePassword] User can manage own password"),!0):(console.log("🔐 [canManagePassword] No permission to manage password"),!1)),na=(r,i)=>!r.assignedProjects||!i?[]:i.filter(w=>r.assignedProjects.includes(w.id)),ua=()=>{var ke,Me;const{enqueueSnackbar:r}=Hs(),{data:i,loading:w,error:k}=Js(),{data:M,loading:Xe,error:Ue}=Vs(),{data:P,loading:es,error:ss,refetch:E}=Ys(),{data:v,loading:as,error:ns,refetch:Y}=_s(),{data:ts,loading:rs,error:is}=Ks(),os=Zs(),ls=Qs();Xs();const ds=Us();ea();const[cs,T]=l.useState(!1),[xs,R]=l.useState(!1),[hs,F]=l.useState(!1),[_,me]=l.useState(""),[L,ue]=l.useState(""),[A,ge]=l.useState(""),[je,pe]=l.useState("member"),[ve,fe]=l.useState(""),[be,ye]=l.useState(""),[we,Pe]=l.useState(""),[K,z]=l.useState(""),[C,ms]=l.useState(!0),[t,W]=l.useState(void 0),[Ce,Ie]=l.useState(null),[Z,Te]=l.useState(""),[Q,Le]=l.useState(""),[Ae,We]=l.useState("member"),[Se,Ne]=l.useState(""),[us,O]=l.useState(!1),[$,q]=l.useState(""),[I,B]=l.useState(""),[b,De]=l.useState(!0),gs=w||Xe||es||as||rs,js=k||Ue||ss||ns||is;Ze.useEffect(()=>{C&&z(V())},[C]),Ze.useEffect(()=>{const s=async()=>{console.log("🔄 [TeamPage] License refresh event detected, refetching data..."),await Promise.all([Y(),E()])};return window.addEventListener("licenses:refresh",s),()=>{window.removeEventListener("licenses:refresh",s)}},[Y,E]);const c=l.useMemo(()=>{if(!i||!M||!P||!v)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableLicenses:0,totalLicenses:0,assignedLicenses:0}};const s=P.filter(m=>m.status==="active").length,o=P.filter(m=>m.status==="pending").length,f=v.length,u=v.filter(m=>m.assignedTo).length,y=v.filter(m=>m.status==="PENDING"&&!m.assignedTo).length;console.log("📊 [TeamPage] License stats:",{totalLicenses:f,assignedLicenses:u,availableLicenses:y});const S={totalMembers:P.length,activeMembers:s,pendingInvites:o,availableLicenses:y,totalLicenses:f,assignedLicenses:u};return{members:P,stats:S}},[i,M,P,v]),ps=(s,o)=>{console.log("🔧 [TeamPage] Menu clicked for member:",o),W(o),Ie(s.currentTarget)},G=()=>{Ie(null)},vs=async()=>{var s,o,f;if(!_.trim()){r("Please enter an email address",{variant:"error"});return}if(!L.trim()){r("Please enter a first name",{variant:"error"});return}if(!A.trim()){r("Please enter a last name",{variant:"error"});return}if(!K.trim()){r("Please provide a temporary password",{variant:"error"});return}if(c.stats.availableLicenses<=0){r("No available licenses. Please generate more licenses first.",{variant:"error"});return}try{console.log("👤 [TeamPage] Creating full user with Firebase authentication...");const u={firstName:L.trim(),lastName:A.trim(),email:_.trim().toLowerCase(),role:je,status:"pending",organization:{id:((s=i==null?void 0:i.organization)==null?void 0:s.id)||"",name:((o=i==null?void 0:i.organization)==null?void 0:o.name)||"",tier:((f=i==null?void 0:i.organization)==null?void 0:f.tier)||"BASIC"},department:ve.trim()||void 0,assignedProjects:[],avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(L+" "+A)}&background=667eea&color=fff`},y=await os.mutate({...u,temporaryPassword:K,position:be.trim()||void 0,phone:we.trim()||void 0});console.log("✅ [TeamPage] Team member created with ID:",y);const S=v==null?void 0:v.find(m=>m.status==="PENDING"&&!m.assignedTo);if(S&&y)try{await ds.mutate({licenseId:S.id,userId:y}),console.log("✅ [TeamPage] Auto-assigned license",S.id,"to new member",y)}catch(m){console.warn("⚠️ [TeamPage] Failed to auto-assign license:",m)}r(`Team member ${L} ${A} created successfully with license assigned. They can now login with their email and temporary password.`,{variant:"success"}),me(""),ue(""),ge(""),pe("member"),fe(""),ye(""),Pe(""),z(V()),T(!1),await Promise.all([E(),Y()])}catch(u){console.error("❌ [TeamPage] Failed to create team member:",u),r((u==null?void 0:u.message)||"Failed to create team member",{variant:"error"})}},fs=s=>{const o=s||t;if(!o){console.error("🔧 [TeamPage] No member provided for editing"),r("Unable to load member data. Please try again.",{variant:"error"});return}console.log("🔧 [TeamPage] Opening edit dialog for member:",o),G(),W(o),Te(o.firstName||""),Le(o.lastName||""),We(o.role||"member"),Ne(o.department||""),O(!1),q(""),B(""),De(!0),R(!0)},bs=async()=>{if(!t){r("No team member selected",{variant:"error"});return}if(!le(i,t)){r("You do not have permission to change this password",{variant:"error"});return}const s=b?V():$;if(!b){if(!s.trim()){r("Please enter a new password",{variant:"error"});return}if(s!==I){r("Passwords do not match",{variant:"error"});return}if(s.length<8){r("Password must be at least 8 characters long",{variant:"error"});return}}try{console.log("🔐 [TeamPage] Password change requested for member:",t.email),r(`Password ${b?"generated and ":""}updated successfully for ${t.firstName} ${t.lastName}`,{variant:"success"}),O(!1),q(""),B("")}catch(o){console.error("❌ [TeamPage] Failed to update password:",o),r((o==null?void 0:o.message)||"Failed to update password",{variant:"error"})}},ys=()=>{t&&(G(),F(!0))},ws=async()=>{if(t)try{r(`${t.firstName} ${t.lastName} has been removed from the team`,{variant:"success"}),F(!1),W(void 0)}catch(s){r((s==null?void 0:s.message)||"Failed to remove team member",{variant:"error"})}},Ps=()=>{t&&(r(`Invitation resent to ${t.email}`,{variant:"success"}),G())},Cs=async()=>{if(t)try{await ls.mutate({memberId:t.id,updates:{firstName:Z,lastName:Q,role:Ae,department:Se}}),r(`Team member ${Z} ${Q} updated successfully`,{variant:"success"}),R(!1),W(void 0),E()}catch(s){r((s==null?void 0:s.message)||"Failed to update team member",{variant:"error"})}};return gs?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(n,{textAlign:"center",children:[e.jsx(Ee,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):js?e.jsx(n,{sx:{p:3},children:e.jsxs(j,{severity:"error",children:[e.jsx(X,{children:"Unable to Load Team Data"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs(Is,{dense:!0,children:[e.jsxs(Re,{children:[e.jsx(N,{children:e.jsx(Ts,{fontSize:"small"})}),e.jsx(Fe,{primary:"Network connectivity issues"})]}),e.jsxs(Re,{children:[e.jsx(N,{children:e.jsx(U,{fontSize:"small"})}),e.jsx(Fe,{primary:"Authentication token expired"})]})]}),e.jsx(n,{sx:{mt:2},children:e.jsx(x,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!i||!M?e.jsx(n,{sx:{p:3},children:e.jsxs(j,{severity:"info",children:[e.jsx(X,{children:"Setting Up Team Management"}),e.jsx(a,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(n,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(a,{variant:"body1",color:"text.secondary",children:["Manage your ",((ke=M.organization)==null?void 0:ke.name)||"Organization"," team members and permissions"]})]}),e.jsx(x,{variant:"contained",startIcon:e.jsx(ee,{}),onClick:()=>T(!0),disabled:c.stats.availableLicenses<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(D,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(D,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{title:"Total Members",value:c.stats.totalMembers,icon:e.jsx(de,{}),color:"primary"})}),e.jsx(D,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{title:"Active Members",value:c.stats.activeMembers,icon:e.jsx(ce,{}),color:"success"})}),e.jsx(D,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{title:"Pending Invites",value:c.stats.pendingInvites,icon:e.jsx(xe,{}),color:"warning"})}),e.jsx(D,{item:!0,xs:12,sm:6,md:3,children:e.jsx(J,{title:"Available Licenses",value:`${c.stats.availableLicenses}/${c.stats.totalLicenses}`,icon:e.jsx(H,{}),color:"primary"})})]}),c.stats.availableLicenses<=0&&e.jsxs(j,{severity:"warning",sx:{mb:4},children:[e.jsx(X,{children:"No Available Licenses"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"You need to generate more licenses to invite new team members. Go to the Licenses page to create additional licenses."}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Generate Licenses"}),e.jsx(x,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(Ls,{children:e.jsxs(As,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",c.members.length,")"]}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(H,{}),onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Manage Licenses"})]}),e.jsx(Ws,{children:e.jsxs(Ss,{children:[e.jsx(Ns,{children:e.jsxs(ze,{children:[e.jsx(h,{sx:{fontWeight:600},children:"Member"}),e.jsx(h,{sx:{fontWeight:600},children:"Role"}),e.jsx(h,{sx:{fontWeight:600},children:"Status"}),e.jsx(h,{sx:{fontWeight:600},children:"Department"}),e.jsx(h,{sx:{fontWeight:600},children:"License"}),e.jsx(h,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(h,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Ds,{children:c.members.map(s=>{var o,f;return e.jsxs(ze,{hover:!0,children:[e.jsx(h,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsxs(ks,{src:s.avatar,sx:{width:40,height:40},children:[s.firstName.charAt(0),s.lastName.charAt(0)]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"body1",sx:{fontWeight:500},children:[s.firstName," ",s.lastName]}),e.jsx(a,{variant:"body2",color:"text.secondary",children:s.email})]})]})}),e.jsx(h,{children:e.jsx(se,{label:s.role.toUpperCase(),color:sa(s.role),size:"small",icon:s.role==="admin"?e.jsx(Ms,{}):void 0})}),e.jsx(h,{children:e.jsx(se,{icon:Qe(s.status),label:s.status.toUpperCase(),color:aa(s.status),size:"small"})}),e.jsx(h,{children:e.jsx(a,{variant:"body2",children:s.department||"Unassigned"})}),e.jsx(h,{children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:((o=s.licenseAssignment)==null?void 0:o.licenseType)||"None"}),((f=s.licenseAssignment)==null?void 0:f.licenseKey)&&e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[s.licenseAssignment.licenseKey.substring(0,12),"..."]})]})}),e.jsx(h,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.lastActive?new Date(s.lastActive).toLocaleDateString():"Never"})}),e.jsx(h,{children:e.jsx(Oe,{size:"small",onClick:u=>ps(u,s),disabled:s.role==="owner"&&s.id===i.id,children:e.jsx(Es,{})})})]},s.id)})})]})})]})}),e.jsx(Rs,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>T(!0),disabled:c.stats.availableLicenses<=0,children:e.jsx(Fs,{})}),e.jsxs(ae,{open:cs,onClose:()=>T(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(ne,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ee,{}),"Create New Team Member"]})}),e.jsx(te,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx($e,{})," Personal Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:L,onChange:s=>ue(s.target.value),placeholder:"John",required:!0}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:A,onChange:s=>ge(s.target.value),placeholder:"Doe",required:!0})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:_,onChange:s=>me(s.target.value),placeholder:"john.doe@company.com",required:!0,sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Phone Number (Optional)",value:we,onChange:s=>Pe(s.target.value),placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(qe,{})})}})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Be,{})," Role & Department"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(Ge,{fullWidth:!0,children:[e.jsx(He,{children:"Role"}),e.jsxs(Je,{value:je,label:"Role",onChange:s=>pe(s.target.value),children:[e.jsx(g,{value:"viewer",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(g,{value:"member",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(g,{value:"manager",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(g,{value:"admin",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:ve,onChange:s=>fe(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title (Optional)",value:be,onChange:s=>ye(s.target.value),placeholder:"Senior Developer, Product Manager..."})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(U,{})," Authentication"]}),e.jsx(Ve,{control:e.jsx(Ye,{checked:C,onChange:s=>ms(s.target.checked)}),label:"Auto-generate secure password",sx:{mb:2}}),e.jsx(d,{fullWidth:!0,label:"Temporary Password",type:"password",value:K,onChange:s=>z(s.target.value),disabled:C,required:!0,InputProps:{endAdornment:e.jsx(p,{position:"end",children:e.jsx(Oe,{onClick:()=>z(V()),disabled:!C,children:e.jsx(zs,{})})})},helperText:C?"Password will be auto-generated":"User will need this password to login initially"})]}),e.jsxs(j,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🎫 License Assignment"}),e.jsx(a,{variant:"body2",children:"This team member will be created as a full Firebase authenticated user and automatically assigned an available license. They can login immediately with their email and temporary password."}),e.jsxs(a,{variant:"body2",sx:{mt:1,fontWeight:500},children:["Available licenses: ",c.stats.availableLicenses," of ",c.stats.totalLicenses]})]}),c.stats.availableLicenses<=0&&e.jsx(j,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No licenses available! Please generate more licenses before creating team members."})})]})}),e.jsxs(re,{children:[e.jsx(x,{onClick:()=>T(!1),children:"Cancel"}),e.jsx(x,{onClick:vs,variant:"contained",startIcon:e.jsx(ee,{}),disabled:c.stats.availableLicenses<=0,children:"Create Team Member"})]})]}),e.jsxs(ae,{open:xs,onClose:()=>{R(!1),W(void 0)},maxWidth:"md",fullWidth:!0,children:[e.jsx(ne,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ie,{}),"🚀 ENHANCED Edit Team Member: ",(t==null?void 0:t.firstName)||"Loading..."," ",(t==null?void 0:t.lastName)||""]})}),e.jsx(te,{children:t?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx($e,{})," Personal Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"First Name",value:Z,onChange:s=>Te(s.target.value),required:!0,placeholder:"John"}),e.jsx(d,{fullWidth:!0,label:"Last Name",value:Q,onChange:s=>Le(s.target.value),required:!0,placeholder:"Doe"})]}),e.jsx(d,{fullWidth:!0,label:"Email Address",type:"email",value:t.email,disabled:!0,sx:{mb:2},helperText:"Email cannot be changed after account creation"}),e.jsx(d,{fullWidth:!0,label:"Phone Number",value:"",disabled:!0,placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(qe,{})})},helperText:"Phone number not available in current data model"})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(Be,{})," Role & Department"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(Ge,{fullWidth:!0,children:[e.jsx(He,{children:"Role"}),e.jsxs(Je,{value:Ae,label:"Role",onChange:s=>We(s.target.value),children:[e.jsx(g,{value:"viewer",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(g,{value:"member",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(g,{value:"manager",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(g,{value:"admin",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(d,{fullWidth:!0,label:"Department",value:Se,onChange:s=>Ne(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(d,{fullWidth:!0,label:"Position/Title",value:"",disabled:!0,placeholder:"Senior Developer, Product Manager...",helperText:"Position not available in current data model"})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(H,{})," License & Access"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"License Type",value:((Me=t.licenseAssignment)==null?void 0:Me.licenseType)||"None",disabled:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(H,{})})}}),e.jsx(d,{fullWidth:!0,label:"License Status",value:t.licenseAssignment?"Assigned":"Unassigned",disabled:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:t.licenseAssignment?e.jsx(ce,{}):e.jsx(xe,{})})}})]}),e.jsx(d,{fullWidth:!0,label:"Last Active",value:t.lastActive?new Date(t.lastActive).toLocaleString():"Never",disabled:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(Os,{})})}})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(_e,{})," Project Assignments"]}),(()=>{const s=na(t,ts||[]);return s.length>0?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.map(o=>e.jsx(se,{label:o.name,color:"primary",variant:"outlined",size:"small",icon:e.jsx(_e,{}),sx:{maxWidth:200}},o.id))}),e.jsxs(n,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx("strong",{children:"Project Details:"})}),s.map(o=>e.jsxs(n,{sx:{mb:1,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:o.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Mode: ",o.mode," • Storage: ",o.storageBackend," • Status: ",o.status]}),o.description&&e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:o.description})]},o.id))]})]}):e.jsx(j,{severity:"info",children:e.jsx(a,{variant:"body2",children:"No projects assigned yet. This team member can be assigned to projects from the Cloud Projects page."})})})()]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(U,{})," Account Status"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(d,{fullWidth:!0,label:"Account Status",value:t.status,disabled:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:Qe(t.status)})}}),e.jsx(d,{fullWidth:!0,label:"Member Since",value:t.joinedAt?new Date(t.joinedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(de,{})})}})]})]}),(console.log("🔐 [TeamPage] Password permission check:",{currentUser:i,selectedMember:t,canManage:le(i,t)}),!0)&&e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(oe,{})," Password Management"]}),us?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(j,{severity:"warning",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"🔐 Password Change"}),e.jsx(a,{variant:"body2",children:b?"A secure password will be automatically generated.":"Please enter a new password with at least 8 characters."})]}),e.jsx(Ve,{control:e.jsx(Ye,{checked:b,onChange:s=>De(s.target.checked)}),label:"Auto-generate secure password"}),!b&&e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(d,{fullWidth:!0,label:"New Password",type:"password",value:$,onChange:s=>q(s.target.value),placeholder:"Enter new password (min 8 characters)",required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(oe,{})})}}),e.jsx(d,{fullWidth:!0,label:"Confirm Password",type:"password",value:I,onChange:s=>B(s.target.value),placeholder:"Confirm new password",required:!0,error:I!==""&&$!==I,helperText:I!==""&&$!==I?"Passwords do not match":"",InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(oe,{})})}})]}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(x,{variant:"contained",startIcon:e.jsx(Ke,{}),onClick:bs,sx:{background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)",color:"white",fontWeight:600},children:b?"Generate & Update Password":"Update Password"}),e.jsx(x,{variant:"outlined",onClick:()=>{O(!1),q(""),B("")},children:"Cancel"})]})]}):e.jsxs(n,{children:[e.jsxs(j,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"🔐 Password Access"})}),e.jsx(a,{variant:"body2",children:(i==null?void 0:i.id)===t.id?"You can change your own password here.":(i==null?void 0:i.role)==="owner"?"As the account owner, you can change this team member's password.":"As an admin, you can change this team member's password."})]}),e.jsx(x,{variant:"outlined",startIcon:e.jsx(Ke,{}),onClick:()=>O(!0),sx:{mb:2},children:"Change Password"})]})]}),e.jsxs(j,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"⚠️ Important Notes"}),e.jsxs(a,{variant:"body2",children:["• Role changes will immediately affect the member's permissions and access levels",e.jsx("br",{}),"• Department information helps with organization and project assignments",e.jsx("br",{}),"• Project assignments are managed from the Cloud Projects page",e.jsx("br",{}),"• License assignments are managed through the Licenses page",e.jsx("br",{}),le(i,t)&&"• Password changes take effect immediately"]})]})]}):e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(n,{textAlign:"center",children:[e.jsx(Ee,{size:40,sx:{mb:2}}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Loading member data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"If this persists, please close and try again."})]})})}),e.jsxs(re,{children:[e.jsx(x,{onClick:()=>R(!1),children:"Cancel"}),e.jsx(x,{onClick:Cs,variant:"contained",startIcon:e.jsx(ie,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(ae,{open:hs,onClose:()=>F(!1),maxWidth:"sm",children:[e.jsx(ne,{children:"Remove Team Member"}),e.jsx(te,{children:t&&e.jsxs(n,{children:[e.jsxs(a,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsxs("strong",{children:[t.firstName," ",t.lastName]})," from your team?"]}),e.jsx(j,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources. Their license will be freed up for reassignment."})})]})}),e.jsxs(re,{children:[e.jsx(x,{onClick:()=>F(!1),children:"Cancel"}),e.jsx(x,{onClick:ws,variant:"contained",color:"error",startIcon:e.jsx(he,{}),children:"Remove Member"})]})]}),e.jsxs($s,{anchorEl:Ce,open:!!Ce,onClose:G,children:[e.jsxs(g,{onClick:()=>fs(t),children:[e.jsx(N,{children:e.jsx(ie,{})}),"Edit Member"]}),(t==null?void 0:t.status)==="pending"&&e.jsxs(g,{onClick:Ps,children:[e.jsx(N,{children:e.jsx(qs,{})}),"Resend Invite"]}),e.jsx(Bs,{}),e.jsxs(g,{onClick:ys,sx:{color:"error.main"},children:[e.jsx(N,{children:e.jsx(he,{sx:{color:"error.main"}})}),"Remove Member"]})]})]})};export{ua as default};
