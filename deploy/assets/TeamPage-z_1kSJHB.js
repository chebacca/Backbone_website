const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UnifiedDataService-Bss6Woh7.js","assets/index-6RET3WBQ.js","assets/mui-Cr9U6iW2.js","assets/vendor-CjD1bmmO.js","assets/stripe-ggaMUove.js","assets/index-CBai7h7s.css","assets/index.esm-B4qVkIPL.js","assets/index.esm-DmQE6AXN.js"])))=>i.map(i=>d[i]);
import{_ as Gs}from"./index-6RET3WBQ.js";import{j as e,B as n,C as Qe,T as a,d as g,ai as ve,w as Us,x as Xe,y as k,aj as _s,z as es,H as fe,a as u,aG as be,G as K,W as me,p as Ce,am as xe,u as y,t as Bs,v as qs,aq as Ks,ar as Hs,as as Vs,at as ss,au as j,av as Ys,ag as Js,r as re,aZ as Zs,g as as,aw as Qs,ax as Xs,ap as ea,ay as ie,az as le,aB as oe,a_ as ts,e as x,I as A,a$ as ns,b0 as rs,aC as H,aD as V,aE as Y,a5 as m,F as is,s as ls,R as sa,aF as ce,aI as ye,aL as aa,b1 as os,L as we,b2 as Ie,aH as Te,a4 as ta,E as na,D as ra,aJ as ia}from"./mui-Cr9U6iW2.js";import{r as d,b as cs}from"./vendor-CjD1bmmO.js";import{u as la}from"./notistack.esm-Ca-E78ev.js";import{b as oa,c as ca,a as da,u as ha,h as xa,j as ma,k as ua,l as ga,f as ja,g as pa,m as va}from"./useStreamlinedData-DqKnuY7c.js";import{M as de}from"./MetricCard-CCtxyf7i.js";import"./stripe-ggaMUove.js";import"./UnifiedDataService-Bss6Woh7.js";import"./index.esm-B4qVkIPL.js";import"./index.esm-DmQE6AXN.js";const N=r=>r.firstName&&r.lastName?`${r.firstName} ${r.lastName}`:r.email,fa=r=>{var w,I,S;const l=((w=r.firstName)==null?void 0:w.charAt(0))||((I=r.email)==null?void 0:I.charAt(0))||"U",v=((S=r.lastName)==null?void 0:S.charAt(0))||"";return l+v},ba=r=>{if(!r)return"default";switch(r){case"owner":return"error";case"admin":return"primary";case"manager":return"secondary";case"member":return"info";case"viewer":return"default";default:return"default"}},ya=r=>{if(!r)return"default";switch(r){case"active":return"success";case"pending":return"warning";case"suspended":return"error";case"removed":return"default";default:return"default"}},ds=r=>{if(!r)return e.jsx(me,{});switch(r){case"active":return e.jsx(Ce,{});case"pending":return e.jsx(xe,{});case"suspended":return e.jsx(ia,{});case"removed":return e.jsx(Te,{});default:return e.jsx(me,{})}},he=()=>{const l="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let v="";for(let w=0;w<12;w++)v+=l.charAt(Math.floor(Math.random()*l.length));return v},Pe=(r,l)=>{var I,S;if(!r||!l)return!1;const v=(I=r.role)==null?void 0:I.toUpperCase(),w=(S=l.role)==null?void 0:S.toUpperCase();return v==="ENTERPRISE_USER"||v==="OWNER"||v==="ADMIN"&&w!=="ENTERPRISE_USER"&&w!=="OWNER"?!0:r.id===l.id},wa=(r,l)=>!r.assignedProjects||!l?[]:l.filter(v=>r.assignedProjects.includes(v.id)),Ea=()=>{var Ze;const{enqueueSnackbar:r}=la(),{data:l,loading:v,error:w}=oa(),{data:I,loading:S,error:hs}=ca(),{data:M,loading:xs,error:ms,refetch:P}=da(),{data:o,loading:us,error:gs,refetch:C}=ha(),{data:js,loading:ps,error:vs}=xa(),fs=ma(),bs=ua(),ys=ga(),ue=ja(),Le=pa(),ge=va(),[ws,O]=d.useState(!1),[Is,J]=d.useState(!1),[Ps,Z]=d.useState(!1),[Cs,Q]=d.useState(!1),[je,Ae]=d.useState(""),[G,Ne]=d.useState(""),[U,Se]=d.useState(""),[We,De]=d.useState("member"),[Ee,ke]=d.useState(""),[Me,Re]=d.useState(""),[Fe,ze]=d.useState(""),[pe,X]=d.useState(""),[R,Ts]=d.useState(!0),[t,_]=d.useState(void 0),[$e,Oe]=d.useState(null),[W,Ge]=d.useState(""),[ee,Ue]=d.useState(""),[B,_e]=d.useState(""),[q,Be]=d.useState(""),[qe,Ke]=d.useState("member"),[He,Ve]=d.useState(""),[T,Ye]=d.useState(""),[Ls,se]=d.useState(!1),[ae,te]=d.useState(""),[F,ne]=d.useState(""),[D,Je]=d.useState(!0),As=v||S||xs||us||ps,Ns=w||hs||ms||gs||vs;cs.useEffect(()=>{R&&X(he())},[R]),cs.useEffect(()=>{const s=async()=>{await Promise.all([C(),P()])},i=async()=>{await Promise.all([P(),C()])};return window.addEventListener("licenses:refresh",s),window.addEventListener("team:refresh",i),()=>{window.removeEventListener("licenses:refresh",s),window.removeEventListener("team:refresh",i)}},[C,P]);const L=d.useMemo(()=>{if(!l||!I||!M||!o)return{members:[],stats:{totalMembers:0,activeMembers:0,pendingInvites:0,availableLicenses:0,totalLicenses:0,assignedLicenses:0}};const s=M.filter(f=>f.status==="active").length,i=M.filter(f=>f.status==="pending").length,c=o.length,h=o.filter(f=>f.assignedTo).length,$=o.filter(f=>f.status==="PENDING"&&!f.assignedTo).length,p={totalMembers:M.length,activeMembers:s,pendingInvites:i,availableLicenses:$,totalLicenses:c,assignedLicenses:h};return{members:M,stats:p}},[l,I,M,o]),b=s=>{if(!s.licenseAssignment)return null;const i=o==null?void 0:o.find(c=>{var h;return c.id===((h=s.licenseAssignment)==null?void 0:h.licenseId)});return{licenseId:s.licenseAssignment.licenseId,licenseType:s.licenseAssignment.licenseType,licenseKey:s.licenseAssignment.licenseKey,status:(i==null?void 0:i.status)||"UNKNOWN"}},E=()=>o?o.filter(s=>s.status==="PENDING"&&!s.assignedTo):[],Ss=s=>{if(!o)return[];const i=s?b(s):null;return o.filter(c=>!!(c.status==="PENDING"&&!c.assignedTo||i&&c.id===i.licenseId))},Ws=(s,i)=>{_(i),Oe(s.currentTarget)},z=()=>{Oe(null)},Ds=async()=>{var s,i,c;if(!je.trim()){r("Please enter an email address",{variant:"error"});return}if(!G.trim()){r("Please enter a first name",{variant:"error"});return}if(!U.trim()){r("Please enter a last name",{variant:"error"});return}if(!pe.trim()){r("Please provide a temporary password",{variant:"error"});return}if(E().length<=0){r("No available licenses. Please generate more licenses first.",{variant:"error"});return}if(!W){r("Please select a license to assign to this team member",{variant:"error"});return}try{const h={firstName:G.trim(),lastName:U.trim(),email:je.trim().toLowerCase(),role:We,status:"pending",organization:{id:((s=l==null?void 0:l.organization)==null?void 0:s.id)||"",name:((i=l==null?void 0:l.organization)==null?void 0:i.name)||"",tier:((c=l==null?void 0:l.organization)==null?void 0:c.tier)||"BASIC"},department:Ee.trim()||"",assignedProjects:[],avatar:`https://ui-avatars.com/api/?name=${encodeURIComponent(G+" "+U)}&background=667eea&color=fff`},$=await fs.mutate({...h,temporaryPassword:pe,position:Me.trim()||"",phone:Fe.trim()||""});if(W&&$)try{await ue.mutate({licenseId:W,userId:$});const p=o==null?void 0:o.find(f=>f.id===W);console.log(`âœ… [TeamPage] Assigned ${p==null?void 0:p.tier} license to new member:`,$)}catch(p){console.warn("Failed to assign selected license:",p)}r(`Team member ${G} ${U} created successfully with license assigned. They can now login with their email and temporary password.`,{variant:"success"}),console.log("ðŸ”„ Refreshing team data after member creation..."),await Promise.all([P(),C()]);try{const{unifiedDataService:p}=await Gs(async()=>{const{unifiedDataService:f}=await import("./UnifiedDataService-Bss6Woh7.js");return{unifiedDataService:f}},__vite__mapDeps([0,1,2,3,4,5,6,7]));await p.forceRefreshLicenses(),p.clearCacheByPattern("org-team-members-"),p.clearCacheByPattern("org-users-"),console.log("ðŸ”„ Force refreshed team data via UnifiedDataService")}catch(p){console.warn("âš ï¸ Failed to force refresh via UnifiedDataService:",p)}setTimeout(async()=>{console.log("ðŸ”„ Secondary refresh for eventual consistency..."),await Promise.all([P(),C()])},1e3),setTimeout(async()=>{console.log("ðŸ”„ Final refresh for safety..."),await Promise.all([P(),C()])},3e3),window.dispatchEvent(new CustomEvent("team:refresh",{detail:{action:"member_created",memberId:$,licenseId:W}})),Ae(""),Ne(""),Se(""),De("member"),ke(""),Re(""),ze(""),X(he()),Ge(""),O(!1)}catch(h){console.error("âŒ [TeamPage] Failed to create team member:",h),r((h==null?void 0:h.message)||"Failed to create team member",{variant:"error"})}},Es=s=>{const i=s||t;if(!i){r("Unable to load member data. Please try again.",{variant:"error"});return}z(),_(i),_e(i.firstName||""),Be(i.lastName||""),Ke(i.role||"member"),Ve(i.department||"");const c=b(i);Ye((c==null?void 0:c.licenseId)||""),se(!1),te(""),ne(""),Je(!0),J(!0)},ks=async()=>{if(!t){r("No team member selected",{variant:"error"});return}if(!Pe(l,t)){r("You do not have permission to change this password",{variant:"error"});return}const s=D?he():ae;if(!D){if(!s.trim()){r("Please enter a new password",{variant:"error"});return}if(s!==F){r("Passwords do not match",{variant:"error"});return}if(s.length<8){r("Password must be at least 8 characters long",{variant:"error"});return}}try{await ge.mutate({memberId:t.id,newPassword:s}),r(`Password ${D?"generated and ":""}updated successfully for ${N(t)}`,{variant:"success"}),se(!1),te(""),ne("")}catch(i){console.error("âŒ [TeamPage] Failed to update password:",i),r((i==null?void 0:i.message)||"Failed to update password",{variant:"error"})}},Ms=()=>{t&&(z(),Z(!0))},Rs=async()=>{if(t)try{const s=b(t);await ys.mutate({memberId:t.id}),s?r(`${N(t)} has been removed from the team. Their license has been released back to the available pool.`,{variant:"success"}):r(`${N(t)} has been removed from the team`,{variant:"success"}),Z(!1),_(void 0),await Promise.all([P(),C()])}catch(s){console.error("âŒ [TeamPage] Failed to remove team member:",s),r((s==null?void 0:s.message)||"Failed to remove team member",{variant:"error"})}},Fs=()=>{t&&(r(`Invitation resent to ${t.email}`,{variant:"success"}),z())},zs=async()=>{if(!t||!ee){r("Please select a valid license to assign",{variant:"error"});return}try{await ue.mutate({licenseId:ee,userId:t.id}),r(`License assigned to ${N(t)}`,{variant:"success"}),Ue(""),Q(!1),z(),await Promise.all([C(),P()])}catch(s){console.error("âŒ [TeamPage] Failed to assign license:",s),r((s==null?void 0:s.message)||"Failed to assign license",{variant:"error"})}},$s=async()=>{if(t)try{const s=b(t);if(!s){r("This team member has no license to release",{variant:"warning"});return}await Le.mutate({licenseId:s.licenseId}),r(`${s.licenseType} license has been released from ${N(t)} and is now available for reassignment.`,{variant:"success"}),z(),await Promise.all([C(),P()])}catch(s){console.error("âŒ [TeamPage] Failed to release license:",s),r((s==null?void 0:s.message)||"Failed to release license",{variant:"error"})}},Os=async()=>{if(t)try{await bs.mutate({memberId:t.id,updates:{firstName:B,lastName:q,role:qe,department:He||""}});const s=b(t),i=(s==null?void 0:s.licenseId)||"";if(T!==i){if(i)try{await Le.mutate({licenseId:i}),console.log("âœ… [TeamPage] Released current license:",i)}catch(c){console.warn("âš ï¸ [TeamPage] Failed to release current license:",c)}if(T)try{await ue.mutate({licenseId:T,userId:t.id});const c=o==null?void 0:o.find(h=>h.id===T);console.log("âœ… [TeamPage] Assigned new license:",T,c==null?void 0:c.tier),r(`Team member ${B} ${q} updated successfully with ${(c==null?void 0:c.tier)||"new"} license assigned`,{variant:"success"})}catch(c){console.error("âŒ [TeamPage] Failed to assign new license:",c),r("Member updated but license assignment failed",{variant:"warning"})}else r(`Team member ${B} ${q} updated successfully. License removed.`,{variant:"success"})}else r(`Team member ${B} ${q} updated successfully`,{variant:"success"});J(!1),_(void 0),await Promise.all([P(),C()])}catch(s){r((s==null?void 0:s.message)||"Failed to update team member",{variant:"error"})}};return As?e.jsx(n,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsxs(n,{textAlign:"center",children:[e.jsx(Qe,{size:60}),e.jsx(a,{variant:"h6",sx:{mt:2},children:"Loading Team Data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Fetching your team members and organization details"})]})}):Ns?e.jsx(n,{sx:{p:3},children:e.jsxs(g,{severity:"error",children:[e.jsx(ve,{children:"Unable to Load Team Data"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"We encountered an issue loading your team information. This could be due to:"}),e.jsxs(Us,{dense:!0,children:[e.jsxs(Xe,{children:[e.jsx(k,{children:e.jsx(_s,{fontSize:"small"})}),e.jsx(es,{primary:"Network connectivity issues"})]}),e.jsxs(Xe,{children:[e.jsx(k,{children:e.jsx(fe,{fontSize:"small"})}),e.jsx(es,{primary:"Authentication token expired"})]})]}),e.jsx(n,{sx:{mt:2},children:e.jsx(u,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})})]})}):!l||!I?e.jsx(n,{sx:{p:3},children:e.jsxs(g,{severity:"info",children:[e.jsx(ve,{children:"Setting Up Team Management"}),e.jsx(a,{variant:"body2",children:"We're preparing your team management dashboard. This may take a moment for new accounts."})]})}):e.jsxs(n,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4},children:[e.jsxs(n,{children:[e.jsx(a,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Team Management"}),e.jsxs(a,{variant:"body1",color:"text.secondary",children:["Manage your ",((Ze=I.organization)==null?void 0:Ze.name)||"Organization"," team members and permissions"]})]}),e.jsx(u,{variant:"contained",startIcon:e.jsx(be,{}),onClick:()=>O(!0),disabled:E().length<=0,sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Invite Member"})]}),e.jsxs(K,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(K,{item:!0,xs:12,sm:6,md:3,children:e.jsx(de,{title:"Total Members",value:L.stats.totalMembers,icon:e.jsx(me,{}),color:"primary"})}),e.jsx(K,{item:!0,xs:12,sm:6,md:3,children:e.jsx(de,{title:"Active Members",value:L.stats.activeMembers,icon:e.jsx(Ce,{}),color:"success"})}),e.jsx(K,{item:!0,xs:12,sm:6,md:3,children:e.jsx(de,{title:"Pending Invites",value:L.stats.pendingInvites,icon:e.jsx(xe,{}),color:"warning"})}),e.jsx(K,{item:!0,xs:12,sm:6,md:3,children:e.jsx(de,{title:"Available Licenses",value:`${L.stats.availableLicenses}/${L.stats.totalLicenses}`,icon:e.jsx(y,{}),color:"primary"})})]}),L.stats.availableLicenses<=0&&e.jsxs(g,{severity:"warning",sx:{mb:4},children:[e.jsx(ve,{children:"No Available Licenses"}),e.jsx(a,{variant:"body2",sx:{mb:2},children:"You need to generate more licenses to invite new team members. Go to the Licenses page to create additional licenses."}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(u,{variant:"contained",size:"small",onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Generate Licenses"}),e.jsx(u,{variant:"outlined",size:"small",onClick:()=>window.open("/dashboard/billing","_blank"),children:"Upgrade Plan"})]})]}),e.jsx(Bs,{children:e.jsxs(qs,{children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsxs(a,{variant:"h6",sx:{fontWeight:600},children:["Team Members (",L.members.length,")"]}),e.jsx(u,{variant:"outlined",startIcon:e.jsx(y,{}),onClick:()=>window.open("/dashboard/licenses","_blank"),children:"Manage Licenses"})]}),e.jsx(Ks,{children:e.jsxs(Hs,{children:[e.jsx(Vs,{children:e.jsxs(ss,{children:[e.jsx(j,{sx:{fontWeight:600},children:"Member"}),e.jsx(j,{sx:{fontWeight:600},children:"Role"}),e.jsx(j,{sx:{fontWeight:600},children:"Status"}),e.jsx(j,{sx:{fontWeight:600},children:"Department"}),e.jsx(j,{sx:{fontWeight:600},children:"License"}),e.jsx(j,{sx:{fontWeight:600},children:"Last Active"}),e.jsx(j,{sx:{fontWeight:600},children:"Actions"})]})}),e.jsx(Ys,{children:L.members.filter(s=>s&&s.id&&s.email).map(s=>{var i,c;return e.jsxs(ss,{hover:!0,children:[e.jsx(j,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Js,{src:s.avatar,sx:{width:40,height:40},children:fa(s)}),e.jsxs(n,{children:[e.jsx(a,{variant:"body1",sx:{fontWeight:500},children:N(s)}),e.jsx(a,{variant:"body2",color:"text.secondary",children:s.email})]})]})}),e.jsx(j,{children:e.jsx(re,{label:((i=s.role)==null?void 0:i.toUpperCase())||"UNKNOWN",color:ba(s.role),size:"small",icon:s.role==="admin"?e.jsx(Zs,{}):void 0})}),e.jsx(j,{children:e.jsx(re,{icon:ds(s.status),label:((c=s.status)==null?void 0:c.toUpperCase())||"UNKNOWN",color:ya(s.status),size:"small"})}),e.jsx(j,{children:e.jsx(a,{variant:"body2",children:s.department||"Unassigned"})}),e.jsx(j,{children:e.jsx(n,{children:(()=>{const h=b(s);return h?e.jsxs(e.Fragment,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:h.licenseType}),e.jsxs(a,{variant:"caption",color:"text.secondary",sx:{fontFamily:"monospace"},children:[h.licenseKey.substring(0,12),"..."]}),e.jsx(re,{label:h.status,size:"small",color:h.status==="ACTIVE"?"success":"warning",sx:{mt:.5}})]}):e.jsx(a,{variant:"body2",color:"text.secondary",children:"None"})})()})}),e.jsx(j,{children:e.jsx(a,{variant:"body2",color:"text.secondary",children:s.lastActive?new Date(s.lastActive).toLocaleDateString():"Never"})}),e.jsx(j,{children:e.jsx(as,{size:"small",onClick:h=>Ws(h,s),disabled:s.role==="owner"&&s.id===(l==null?void 0:l.id),children:e.jsx(Qs,{})})})]},s.id)})})]})})]})}),e.jsx(Xs,{color:"primary",sx:{position:"fixed",bottom:16,right:16,display:{xs:"flex",md:"none"}},onClick:()=>O(!0),disabled:E().length<=0,children:e.jsx(ea,{})}),e.jsxs(ie,{open:ws,onClose:()=>O(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(be,{}),"Create New Team Member"]})}),e.jsx(oe,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ts,{})," Personal Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(x,{fullWidth:!0,label:"First Name",value:G,onChange:s=>Ne(s.target.value),placeholder:"John",required:!0}),e.jsx(x,{fullWidth:!0,label:"Last Name",value:U,onChange:s=>Se(s.target.value),placeholder:"Doe",required:!0})]}),e.jsx(x,{fullWidth:!0,label:"Email Address",type:"email",value:je,onChange:s=>Ae(s.target.value),placeholder:"john.doe@company.com",required:!0,sx:{mb:2}}),e.jsx(x,{fullWidth:!0,label:"Phone Number (Optional)",value:Fe,onChange:s=>ze(s.target.value),placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(A,{position:"start",children:e.jsx(ns,{})})}})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(rs,{})," Role & Department"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(H,{fullWidth:!0,children:[e.jsx(V,{children:"Role"}),e.jsxs(Y,{value:We,label:"Role",onChange:s=>De(s.target.value),children:[e.jsx(m,{value:"viewer",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(m,{value:"member",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(m,{value:"manager",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(m,{value:"admin",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(x,{fullWidth:!0,label:"Department",value:Ee,onChange:s=>ke(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(x,{fullWidth:!0,label:"Position/Title (Optional)",value:Me,onChange:s=>Re(s.target.value),placeholder:"Senior Developer, Product Manager..."})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(fe,{})," Authentication"]}),e.jsx(is,{control:e.jsx(ls,{checked:R,onChange:s=>Ts(s.target.checked)}),label:"Auto-generate secure password",sx:{mb:2}}),e.jsx(x,{fullWidth:!0,label:"Temporary Password",type:"password",value:pe,onChange:s=>X(s.target.value),disabled:R,required:!0,InputProps:{endAdornment:e.jsx(A,{position:"end",children:e.jsx(as,{onClick:()=>X(he()),disabled:!R,children:e.jsx(sa,{})})})},helperText:R?"Password will be auto-generated":"User will need this password to login initially"})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(y,{})," License Assignment"]}),e.jsxs(H,{fullWidth:!0,sx:{mb:2},children:[e.jsx(V,{children:"Select License to Assign"}),e.jsx(Y,{value:W,label:"Select License to Assign",onChange:s=>Ge(s.target.value),required:!0,children:E().length===0?e.jsx(m,{disabled:!0,children:e.jsx(a,{variant:"body2",color:"text.secondary",children:"No available licenses found"})}):E().map(s=>e.jsx(m,{value:s.id,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(y,{color:"primary"}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:s.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.tier," â€¢ ",s.key," â€¢ Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id))}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Only unassigned PENDING licenses are available for assignment"})]}),e.jsxs(g,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸŽ« License Assignment Details"}),e.jsx(a,{variant:"body2",children:"This team member will be created as a full Firebase authenticated user and assigned the selected license. They can login immediately with their email and temporary password."}),e.jsxs(a,{variant:"body2",sx:{mt:1,fontWeight:500},children:["Available licenses: ",L.stats.availableLicenses," of ",L.stats.totalLicenses]})]})]}),E().length<=0&&e.jsx(g,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No licenses available! Please generate more licenses before creating team members."})})]})}),e.jsxs(ce,{children:[e.jsx(u,{onClick:()=>O(!1),children:"Cancel"}),e.jsx(u,{onClick:Ds,variant:"contained",startIcon:e.jsx(be,{}),disabled:E().length<=0||!W,children:"Create Team Member"})]})]}),e.jsxs(ie,{open:Is,onClose:()=>{J(!1),_(void 0)},maxWidth:"md",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(ye,{}),"ðŸš€ ENHANCED Edit Team Member: ",(t==null?void 0:t.firstName)||"Loading..."," ",(t==null?void 0:t.lastName)||""]})}),e.jsx(oe,{children:t?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(ts,{})," Personal Information"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(x,{fullWidth:!0,label:"First Name",value:B,onChange:s=>_e(s.target.value),required:!0,placeholder:"John"}),e.jsx(x,{fullWidth:!0,label:"Last Name",value:q,onChange:s=>Be(s.target.value),required:!0,placeholder:"Doe"})]}),e.jsx(x,{fullWidth:!0,label:"Email Address",type:"email",value:t.email,disabled:!0,sx:{mb:2},helperText:"Email cannot be changed after account creation"}),e.jsx(x,{fullWidth:!0,label:"Phone Number",value:"",disabled:!0,placeholder:"+1 (555) 123-4567",InputProps:{startAdornment:e.jsx(A,{position:"start",children:e.jsx(ns,{})})},helperText:"Phone number not available in current data model"})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(rs,{})," Role & Department"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsxs(H,{fullWidth:!0,children:[e.jsx(V,{children:"Role"}),e.jsxs(Y,{value:qe,label:"Role",onChange:s=>Ke(s.target.value),children:[e.jsx(m,{value:"viewer",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Viewer"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Read-only access to projects"})]})}),e.jsx(m,{value:"member",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Member"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Standard project access"})]})}),e.jsx(m,{value:"manager",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Manager"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Team management capabilities"})]})}),e.jsx(m,{value:"admin",children:e.jsxs(n,{children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:"Admin"}),e.jsx(a,{variant:"caption",color:"text.secondary",children:"Full organizational access"})]})})]})]}),e.jsx(x,{fullWidth:!0,label:"Department",value:He,onChange:s=>Ve(s.target.value),placeholder:"Engineering, Design, Marketing..."})]}),e.jsx(x,{fullWidth:!0,label:"Position/Title",value:"",disabled:!0,placeholder:"Senior Developer, Product Manager...",helperText:"Position not available in current data model"})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(y,{})," License & Access"]}),e.jsxs(H,{fullWidth:!0,sx:{mb:2},children:[e.jsx(V,{children:"Assign License"}),e.jsxs(Y,{value:T,label:"Assign License",onChange:s=>Ye(s.target.value),children:[e.jsx(m,{value:"",children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xe,{color:"disabled"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"No License (Remove current license)"})]})}),Ss(t).map(s=>{var c;const i=((c=b(t))==null?void 0:c.licenseId)===s.id;return e.jsx(m,{value:s.id,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(y,{color:i?"primary":"action"}),e.jsxs(n,{sx:{flex:1},children:[e.jsxs(a,{variant:"body2",sx:{fontWeight:i?600:400},children:[s.name," ",i&&"(Current)"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.tier," â€¢ ",s.key," â€¢ Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id)})]}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"You can reassign licenses between team members. Released licenses return to the available pool."})]}),(()=>{const s=b(t);return o==null||o.find(i=>i.id===T),s!=null&&s.licenseId,e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(x,{fullWidth:!0,label:"Current License",value:(s==null?void 0:s.licenseType)||"None",disabled:!0,InputProps:{startAdornment:e.jsx(A,{position:"start",children:e.jsx(y,{})})}}),e.jsx(x,{fullWidth:!0,label:"License Status",value:s?s.status:"Unassigned",disabled:!0,InputProps:{startAdornment:e.jsx(A,{position:"start",children:s?e.jsx(Ce,{}):e.jsx(xe,{})})}})]})})(),(()=>{const s=b(t),i=o==null?void 0:o.find(h=>h.id===T);return T!==((s==null?void 0:s.licenseId)||"")?e.jsxs(g,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸ”„ License Change Preview"}),e.jsxs(a,{variant:"body2",children:[s?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Current:"})," ",s.licenseType," (",s.licenseKey,")",e.jsx("br",{})]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Current:"})," No license assigned",e.jsx("br",{})]}),e.jsx("strong",{children:"New:"})," ",i?`${i.tier} (${i.key})`:"No license (will be removed)"]}),s&&e.jsx(a,{variant:"body2",sx:{mt:1,fontStyle:"italic"},children:"The current license will be released back to the available pool."})]}):null})(),e.jsx(x,{fullWidth:!0,label:"Last Active",value:t.lastActive?new Date(t.lastActive).toLocaleString():"Never",disabled:!0,InputProps:{startAdornment:e.jsx(A,{position:"start",children:e.jsx(aa,{})})}})]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(os,{})," Project Assignments"]}),(()=>{const s=wa(t,js||[]);return s.length>0?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:s.map(i=>e.jsx(re,{label:i.name,color:"primary",variant:"outlined",size:"small",icon:e.jsx(os,{}),sx:{maxWidth:200}},i.id))}),e.jsxs(n,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mb:1},children:e.jsx("strong",{children:"Project Details:"})}),s.map(i=>e.jsxs(n,{sx:{mb:1,p:2,bgcolor:"background.paper",borderRadius:1,border:"1px solid",borderColor:"divider"},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500},children:i.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:["Mode: ",i.mode," â€¢ Storage: ",i.storageBackend," â€¢ Status: ",i.status]}),i.description&&e.jsx(a,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:i.description})]},i.id))]})]}):e.jsx(g,{severity:"info",children:e.jsx(a,{variant:"body2",children:"No projects assigned yet. This team member can be assigned to projects from the Cloud Projects page."})})})()]}),e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(fe,{})," Account Status"]}),e.jsxs(n,{sx:{display:"flex",gap:2,mb:2},children:[e.jsx(x,{fullWidth:!0,label:"Account Status",value:t.status,disabled:!0,InputProps:{startAdornment:e.jsx(A,{position:"start",children:ds(t.status)})}}),e.jsx(x,{fullWidth:!0,label:"Member Since",value:t.joinedAt?new Date(t.joinedAt).toLocaleDateString():"Unknown",disabled:!0,InputProps:{startAdornment:e.jsx(A,{position:"start",children:e.jsx(me,{})})}})]})]}),Pe(l,t)&&e.jsxs(n,{children:[e.jsxs(a,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(we,{})," Password Management"]}),Ls?e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(g,{severity:"warning",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸ” Password Change"}),e.jsx(a,{variant:"body2",children:D?"A secure password will be automatically generated.":"Please enter a new password with at least 8 characters."})]}),e.jsx(is,{control:e.jsx(ls,{checked:D,onChange:s=>Je(s.target.checked)}),label:"Auto-generate secure password"}),!D&&e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(x,{fullWidth:!0,label:"New Password",type:"password",value:ae,onChange:s=>te(s.target.value),placeholder:"Enter new password (min 8 characters)",required:!0,InputProps:{startAdornment:e.jsx(A,{position:"start",children:e.jsx(we,{})})}}),e.jsx(x,{fullWidth:!0,label:"Confirm Password",type:"password",value:F,onChange:s=>ne(s.target.value),placeholder:"Confirm new password",required:!0,error:F!==""&&ae!==F,helperText:F!==""&&ae!==F?"Passwords do not match":"",InputProps:{startAdornment:e.jsx(A,{position:"start",children:e.jsx(we,{})})}})]}),e.jsxs(n,{sx:{display:"flex",gap:2},children:[e.jsx(u,{variant:"contained",startIcon:e.jsx(Ie,{}),onClick:ks,disabled:ge.loading,sx:{background:"linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)",color:"white",fontWeight:600},children:ge.loading?"Updating...":D?"Generate & Update Password":"Update Password"}),e.jsx(u,{variant:"outlined",onClick:()=>{se(!1),te(""),ne("")},children:"Cancel"})]})]}):e.jsxs(n,{children:[e.jsxs(g,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"ðŸ” Password Access"})}),e.jsx(a,{variant:"body2",children:(l==null?void 0:l.id)===t.id?"You can change your own password here.":(l==null?void 0:l.role)==="ENTERPRISE_USER"||(l==null?void 0:l.role)==="owner"?"As the account owner, you can change this team member's password.":"As an admin, you can change this team member's password."})]}),e.jsx(u,{variant:"outlined",startIcon:e.jsx(Ie,{}),onClick:()=>se(!0),sx:{mb:2},children:"Change Password"})]})]}),e.jsxs(g,{severity:"info",children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"âš ï¸ Important Notes"}),e.jsxs(a,{variant:"body2",children:["â€¢ Role changes will immediately affect the member's permissions and access levels",e.jsx("br",{}),"â€¢ Department information helps with organization and project assignments",e.jsx("br",{}),"â€¢ Project assignments are managed from the Cloud Projects page",e.jsx("br",{}),"â€¢ License assignments are managed through the Licenses page",e.jsx("br",{}),Pe(l,t)&&"â€¢ Password changes take effect immediately"]})]})]}):e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:200},children:e.jsxs(n,{textAlign:"center",children:[e.jsx(Qe,{size:40,sx:{mb:2}}),e.jsx(a,{variant:"body1",color:"text.secondary",children:"Loading member data..."}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"If this persists, please close and try again."})]})})}),e.jsxs(ce,{children:[e.jsx(u,{onClick:()=>J(!1),children:"Cancel"}),e.jsx(u,{onClick:Os,variant:"contained",startIcon:e.jsx(ye,{}),sx:{background:"linear-gradient(135deg, #00d4ff 0%, #667eea 100%)",color:"#000",fontWeight:600},children:"Save Changes"})]})]}),e.jsxs(ie,{open:Ps,onClose:()=>Z(!1),maxWidth:"sm",children:[e.jsx(le,{children:"Remove Team Member"}),e.jsx(oe,{children:t&&e.jsxs(n,{children:[e.jsxs(a,{variant:"body1",sx:{mb:2},children:["Are you sure you want to remove ",e.jsx("strong",{children:N(t)})," from your team?"]}),(()=>{const s=b(t);return s?e.jsxs(g,{severity:"info",sx:{mb:2},children:[e.jsx(a,{variant:"body2",sx:{fontWeight:500,mb:1},children:"ðŸŽ« License Management"}),e.jsxs(a,{variant:"body2",children:["This team member currently has a ",e.jsx("strong",{children:s.licenseType})," license assigned. When removed, their license will be automatically released back to your available license pool and can be reassigned to another team member."]})]}):e.jsx(g,{severity:"info",sx:{mb:2},children:e.jsx(a,{variant:"body2",children:"This team member has no license assigned, so no license will be affected."})})})(),e.jsx(g,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"This action cannot be undone. The member will lose access to all projects and resources."})})]})}),e.jsxs(ce,{children:[e.jsx(u,{onClick:()=>Z(!1),children:"Cancel"}),e.jsx(u,{onClick:Rs,variant:"contained",color:"error",startIcon:e.jsx(Te,{}),children:"Remove Member"})]})]}),e.jsxs(ta,{anchorEl:$e,open:!!$e,onClose:z,children:[e.jsxs(m,{onClick:()=>Es(t),children:[e.jsx(k,{children:e.jsx(ye,{})}),"Edit Member"]}),t?b(t)?e.jsxs(m,{onClick:$s,children:[e.jsx(k,{children:e.jsx(Ie,{})}),"Release License"]}):e.jsxs(m,{onClick:()=>Q(!0),children:[e.jsx(k,{children:e.jsx(y,{})}),"Assign License"]}):null,(t==null?void 0:t.status)==="pending"&&e.jsxs(m,{onClick:Fs,children:[e.jsx(k,{children:e.jsx(na,{})}),"Resend Invite"]}),e.jsx(ra,{}),e.jsxs(m,{onClick:Ms,sx:{color:"error.main"},children:[e.jsx(k,{children:e.jsx(Te,{sx:{color:"error.main"}})}),"Remove Member"]})]}),e.jsxs(ie,{open:Cs,onClose:()=>Q(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(le,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(y,{}),"Assign License to ",t?N(t):"Team Member"]})}),e.jsx(oe,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:"column",gap:3,mt:2},children:[e.jsx(g,{severity:"info",children:e.jsxs(a,{variant:"body2",children:["Assigning a license to ",e.jsx("strong",{children:t?N(t):"Team Member"})," (",t==null?void 0:t.email,")"]})}),e.jsxs(H,{fullWidth:!0,children:[e.jsx(V,{children:"Select License"}),e.jsx(Y,{value:ee,label:"Select License",onChange:s=>Ue(s.target.value),children:o==null?void 0:o.filter(s=>s.status==="PENDING"&&!s.assignedTo).map(s=>e.jsx(m,{value:s.id,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(y,{color:"primary"}),e.jsxs(n,{children:[e.jsxs(a,{variant:"body2",sx:{fontWeight:500},children:[s.tier," License"]}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[s.key," â€¢ Expires ",new Date(s.expiresAt).toLocaleDateString()]})]})]})},s.id))}),e.jsx(a,{variant:"caption",color:"text.secondary",sx:{mt:1},children:"Only unassigned PENDING licenses are available for assignment"})]}),(o==null?void 0:o.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0&&e.jsx(g,{severity:"warning",children:e.jsx(a,{variant:"body2",children:"No available licenses found. All licenses are either assigned or not in PENDING status."})}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"The selected license will be assigned to this team member and they will have immediate access to the system."})]})}),e.jsxs(ce,{children:[e.jsx(u,{onClick:()=>Q(!1),children:"Cancel"}),e.jsx(u,{onClick:zs,variant:"contained",startIcon:e.jsx(y,{}),disabled:!ee||(o==null?void 0:o.filter(s=>s.status==="PENDING"&&!s.assignedTo).length)===0,children:"Assign License"})]})]})]})};export{Ea as default};
