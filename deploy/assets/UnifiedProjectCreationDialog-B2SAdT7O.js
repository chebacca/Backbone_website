import{j as r,aD as F,aE as I,a as w,az as y,T as g,I as T,bQ as L,aF as E,t as U,D as G,aN as q,d as A,c as R,G as s,u as x,aJ as h,aK as f,aL as j,a4 as i}from"./mui-DWJOBiaP.js";import{r as l}from"./vendor-OeuszDaU.js";import{s as z}from"./index-DkMcDCFD.js";const W={name:"",description:"",visibility:"private",storageMode:"local",cloudProvider:"firestore",gcsBucket:"",gcsPrefix:"",enableLocalNetwork:!1,networkPort:3e3,networkAddress:"localhost",maxNetworkUsers:250,networkPassword:"",preferredWebsitePort:3002,preferredApiPort:3003,maxCollaborators:10,enableRealTime:!0,enableComments:!0,enableFileSharing:!0,enableVersionControl:!0,enableEncryption:!1,autoBackup:!0,backupInterval:30,enableAuditLog:!1},J=({open:m,onClose:n,mode:d,onSuccess:b,onCreate:k,maxCollaborators:c=10})=>{const[S,B]=l.useState(0),[e,o]=l.useState(W),[u,v]=l.useState(!1),[C,p]=l.useState(null),[V,P]=l.useState({});l.useEffect(()=>{m&&(o({...W,enableLocalNetwork:d==="standalone",maxCollaborators:Math.min(c,d==="shared_network"?25:5),enableRealTime:d==="shared_network"}),B(0),p(null),P({}))},[m,d]);const D=a=>{const t={};switch(a){case 0:e.name.trim()||(t.name="Project name is required"),e.name.length>100&&(t.name="Project name must be less than 100 characters");break;case 1:e.storageMode==="cloud"&&e.cloudProvider==="gcs"&&(e.gcsBucket.trim()||(t.gcsBucket="GCS bucket name is required"));break;case 2:e.enableLocalNetwork&&((e.networkPort<1024||e.networkPort>65535)&&(t.networkPort="Port must be between 1024 and 65535"),e.networkAddress.trim()||(t.networkAddress="Network address is required"),(e.maxNetworkUsers<1||e.maxNetworkUsers>250)&&(t.maxNetworkUsers="Max users must be between 1 and 250")),typeof e.preferredWebsitePort=="number"&&(e.preferredWebsitePort<1024||e.preferredWebsitePort>65535)&&(t.preferredWebsitePort="Website port must be 1024-65535"),typeof e.preferredApiPort=="number"&&(e.preferredApiPort<1024||e.preferredApiPort>65535)&&(t.preferredApiPort="API port must be 1024-65535");break;case 3:(e.maxCollaborators<1||e.maxCollaborators>c)&&(t.maxCollaborators=`Max collaborators must be between 1 and ${c}`);break}return P(t),Object.keys(t).length===0},M=async()=>{if(D(S)){v(!0),p(null);try{const a={name:e.name,description:e.description,storageMode:e.storageMode,preferredPorts:{website:e.preferredWebsitePort,api:e.preferredApiPort},localNetworkConfig:e.enableLocalNetwork?{enabled:!0,port:e.networkPort,address:e.networkAddress,maxUsers:e.maxNetworkUsers}:void 0,cloudConfig:e.storageMode==="cloud"?{provider:e.cloudProvider,bucket:e.gcsBucket,prefix:e.gcsPrefix}:void 0,collaborationSettings:{maxCollaborators:e.maxCollaborators,enableRealTime:e.enableRealTime,enableComments:e.enableComments,enableFileSharing:e.enableFileSharing}};console.log("ðŸ” Project creation options:",a),console.log("ðŸ” User maxCollaborators limit:",c),console.log("ðŸ” Form maxCollaborators value:",e.maxCollaborators);const t=k?await k(a):await z.createProject(a);b==null||b(t),n()}catch(a){p(a instanceof Error?a.message:"Failed to create project")}finally{v(!1)}}},N=()=>r.jsxs(w,{sx:{py:2},children:[r.jsx(g,{variant:"h6",gutterBottom:!0,sx:{mb:3,color:"text.primary",fontWeight:600},children:"Create New Cloud Project"}),r.jsxs(R,{elevation:0,sx:{p:3,mb:3,backgroundColor:"background.paper",border:"1px solid",borderColor:"divider"},children:[r.jsx(g,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:600,mb:3},children:"Project Information"}),r.jsxs(s,{container:!0,spacing:3,children:[r.jsx(s,{item:!0,xs:12,children:r.jsx(x,{fullWidth:!0,label:"Project Name",value:e.name,onChange:a=>o(t=>({...t,name:a.target.value})),placeholder:"Enter project name",required:!0,sx:{mb:2}})}),r.jsx(s,{item:!0,xs:12,children:r.jsx(x,{fullWidth:!0,label:"Description",value:e.description,onChange:a=>o(t=>({...t,description:a.target.value})),multiline:!0,rows:3,placeholder:"Describe your project",sx:{mb:2}})}),r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(h,{fullWidth:!0,children:[r.jsx(f,{children:"Visibility"}),r.jsxs(j,{value:e.visibility||"private",onChange:a=>o(t=>({...t,visibility:a.target.value})),label:"Visibility",children:[r.jsx(i,{value:"private",children:"Private"}),r.jsx(i,{value:"organization",children:"Organization"}),r.jsx(i,{value:"public",children:"Public"})]})]})}),r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(h,{fullWidth:!0,children:[r.jsx(f,{children:"Storage Backend"}),r.jsxs(j,{value:e.storageMode||"cloud",onChange:a=>o(t=>({...t,storageMode:a.target.value})),label:"Storage Backend",children:[r.jsx(i,{value:"cloud",children:"Cloud (Firebase/GCS)"}),r.jsx(i,{value:"local",children:"Local (.dbproj)"})]})]})}),e.storageMode==="cloud"&&r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsxs(h,{fullWidth:!0,children:[r.jsx(f,{children:"Cloud Type"}),r.jsxs(j,{value:e.cloudProvider||"firestore",onChange:a=>o(t=>({...t,cloudProvider:a.target.value})),label:"Cloud Type",children:[r.jsx(i,{value:"firestore",children:"Firestore (metadata)"}),r.jsx(i,{value:"gcs",children:"Google Cloud Storage (assets)"})]})]})}),e.storageMode==="cloud"&&e.cloudProvider==="gcs"&&r.jsxs(r.Fragment,{children:[r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsx(x,{fullWidth:!0,label:"GCS Bucket",value:e.gcsBucket,onChange:a=>o(t=>({...t,gcsBucket:a.target.value})),placeholder:"my-project-bucket",required:!0})}),r.jsx(s,{item:!0,xs:12,sm:6,children:r.jsx(x,{fullWidth:!0,label:"GCS Prefix (optional)",value:e.gcsPrefix,onChange:a=>o(t=>({...t,gcsPrefix:a.target.value})),placeholder:"projects/my-project/"})})]})]})]})]});return r.jsxs(F,{open:m,onClose:n,maxWidth:"md",fullWidth:!0,sx:{zIndex:1400},PaperProps:{sx:{minHeight:"70vh",backgroundColor:"background.default","& .MuiDialogContent-root":{backgroundColor:"background.default"}}},children:[r.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"background.paper",borderBottom:"1px solid",borderColor:"divider",pb:2},children:[r.jsxs(w,{sx:{display:"flex",alignItems:"center",gap:1},children:[r.jsx(y,{color:"primary"}),r.jsx(g,{variant:"h6",sx:{fontWeight:600},children:"Create New Project"})]}),r.jsx(T,{onClick:n,size:"small",children:r.jsx(L,{})})]}),r.jsxs(E,{sx:{p:3},children:[C&&r.jsx(U,{severity:"error",sx:{mb:3},children:C}),N(),u&&r.jsx(G,{sx:{mt:2}})]}),r.jsxs(q,{sx:{px:3,pb:3,pt:2,backgroundColor:"background.paper",borderTop:"1px solid",borderColor:"divider"},children:[r.jsx(A,{onClick:n,variant:"outlined",disabled:u,sx:{borderColor:"primary.main",color:"primary.main"},children:"Close"}),r.jsx(A,{onClick:M,variant:"contained",disabled:u||!e.name.trim(),startIcon:r.jsx(y,{}),sx:{backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:u?"Creating...":"Create Project"})]})]})};export{J as U};
