import{j as e,aE as pe,aF as ge,a as s,az as V,T as a,I as be,bP as me,aG as je,t as k,a6 as ve,a7 as fe,a8 as ke,D as $,aM as ye,d as y,G as n,k as I,l as N,h as B,aN as z,aH as W,aO as F,M as _,F as u,Q as b,cg as Ce,ch as q,u as x,aI as M,c8 as we,c9 as Pe,ca as L,Z as Y,aJ as H,aK as Q,a4 as v}from"./mui-BL8LFCmL.js";import{r as h}from"./vendor-OeuszDaU.js";import{d as J,s as Se}from"./index-C4sUh3vm.js";const K={name:"",description:"",visibility:"private",storageMode:"local",cloudProvider:"firestore",gcsBucket:"",gcsPrefix:"",enableLocalNetwork:!1,networkPort:3e3,networkAddress:"localhost",maxNetworkUsers:250,networkPassword:"",preferredWebsitePort:3002,preferredApiPort:3003,maxCollaborators:10,enableRealTime:!0,enableComments:!0,enableFileSharing:!0,enableVersionControl:!0,enableEncryption:!1,autoBackup:!0,backupInterval:30,enableAuditLog:!1,selectedDatasets:[]},Z=["Basic Information","Storage Configuration","Network Settings","Collaboration Options","Dataset Assignment","Review & Create"],Ne=({open:C,onClose:f,mode:m,onSuccess:w,onCreate:T,maxCollaborators:c=10})=>{const[p,P]=h.useState(0),[r,R]=h.useState(K),[g,U]=h.useState(!1),[E,S]=h.useState(null),[i,D]=h.useState({}),[A,X]=h.useState([]),[ee,O]=h.useState(!1),re=async()=>{try{O(!0);const o=(await J.listDatasets({})).map(d=>{var j;return{...d,__label:`${d.name} ${((j=d.storage)==null?void 0:j.backend)==="gcs"?"(GCS)":"(Firestore)"}`}});X(o)}catch(t){console.error("Failed to load datasets:",t)}finally{O(!1)}};h.useEffect(()=>{C&&(R({...K,enableLocalNetwork:m==="standalone",maxCollaborators:c,enableRealTime:m==="shared_network"}),P(0),S(null),D({}),re())},[C,m,c]);const l=t=>{R(d=>({...d,...t}));const o={...i};Object.keys(t).forEach(d=>{delete o[d]}),D(o)},G=t=>{const o={};switch(t){case 0:r.name.trim()||(o.name="Project name is required"),r.name.length>100&&(o.name="Project name must be less than 100 characters");break;case 1:r.storageMode==="cloud"&&r.cloudProvider==="gcs"&&(r.gcsBucket.trim()||(o.gcsBucket="GCS bucket name is required"));break;case 2:r.enableLocalNetwork&&((r.networkPort<1024||r.networkPort>65535)&&(o.networkPort="Port must be between 1024 and 65535"),r.networkAddress.trim()||(o.networkAddress="Network address is required"),(r.maxNetworkUsers<1||r.maxNetworkUsers>250)&&(o.maxNetworkUsers="Max users must be between 1 and 250")),typeof r.preferredWebsitePort=="number"&&(r.preferredWebsitePort<1024||r.preferredWebsitePort>65535)&&(o.preferredWebsitePort="Website port must be 1024-65535"),typeof r.preferredApiPort=="number"&&(r.preferredApiPort<1024||r.preferredApiPort>65535)&&(o.preferredApiPort="API port must be 1024-65535");break;case 3:(r.maxCollaborators<1||r.maxCollaborators>c)&&(o.maxCollaborators=`Max collaborators must be between 1 and ${c}`);break}return D(o),Object.keys(o).length===0},te=()=>{G(p)&&P(t=>t+1)},ae=()=>{P(t=>t-1)},se=async()=>{if(G(p)){U(!0),S(null);try{const t={name:r.name,description:r.description,storageMode:r.storageMode,preferredPorts:{website:r.preferredWebsitePort,api:r.preferredApiPort},localNetworkConfig:r.enableLocalNetwork?{enabled:!0,port:r.networkPort,address:r.networkAddress,maxUsers:r.maxNetworkUsers}:void 0,cloudConfig:r.storageMode==="cloud"?{provider:r.cloudProvider,bucket:r.gcsBucket,prefix:r.gcsPrefix}:void 0,collaborationSettings:{maxCollaborators:r.maxCollaborators,enableRealTime:r.enableRealTime,enableComments:r.enableComments,enableFileSharing:r.enableFileSharing}};console.log("🔍 Project creation options:",t),console.log("🔍 User maxCollaborators limit:",c),console.log("🔍 Form maxCollaborators value:",r.maxCollaborators);const o=T?await T(t):await Se.createProject(t);if(r.selectedDatasets.length>0){console.log("🔍 Assigning datasets to project:",r.selectedDatasets);for(const d of r.selectedDatasets)try{await J.assignDatasetToProject(o,d),console.log("✅ Assigned dataset",d,"to project",o)}catch(j){console.error("❌ Failed to assign dataset",d,"to project",o,":",j)}}w==null||w(o),f()}catch(t){S(t instanceof Error?t.message:"Failed to create project")}finally{U(!1)}}},oe=()=>e.jsxs(s,{sx:{py:2},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Project Information"}),e.jsx(a,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Provide basic information about your project. This can be changed later."}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"Project Name",value:r.name,onChange:t=>l({name:t.target.value}),error:!!i.name,helperText:i.name,required:!0,placeholder:"My Awesome Project"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"Description",value:r.description,onChange:t=>l({description:t.target.value}),multiline:!0,rows:3,placeholder:"Describe what this project is about..."})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(M,{fullWidth:!0,children:[e.jsx(H,{id:"visibility-label",children:"Visibility"}),e.jsxs(Q,{labelId:"visibility-label",id:"visibility-select",value:r.visibility,onChange:t=>{console.log("🔍 Visibility changed:",t.target.value),l({visibility:t.target.value})},label:"Visibility",children:[e.jsx(v,{value:"private",children:"Private"}),e.jsx(v,{value:"organization",children:"Organization"}),e.jsx(v,{value:"public",children:"Public"})]})]})})]})]}),ne=()=>e.jsxs(s,{sx:{py:2},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Storage Configuration"}),e.jsx(a,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Choose how your project data will be stored and accessed."}),e.jsxs(M,{component:"fieldset",fullWidth:!0,sx:{mb:3},children:[e.jsx(we,{component:"legend",children:"Storage Mode"}),e.jsxs(Pe,{value:r.storageMode,onChange:t=>l({storageMode:t.target.value}),children:[e.jsx(u,{value:"local",control:e.jsx(L,{}),label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(z,{}),e.jsxs(s,{children:[e.jsx(a,{variant:"body1",children:"Local Storage"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Store project files on your local machine"})]})]})}),e.jsx(u,{value:"cloud",control:e.jsx(L,{}),label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Y,{}),e.jsxs(s,{children:[e.jsx(a,{variant:"body1",children:"Cloud Storage"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Store project data in the cloud for sharing and backup"})]})]})}),e.jsx(u,{value:"hybrid",control:e.jsx(L,{}),label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{}),e.jsxs(s,{children:[e.jsx(a,{variant:"body1",children:"Hybrid Storage"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Combine local and cloud storage for optimal performance"})]})]})})]})]}),r.storageMode==="cloud"&&e.jsx(I,{variant:"outlined",sx:{mb:2},children:e.jsxs(N,{children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Cloud Provider Settings"}),e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,children:e.jsxs(M,{fullWidth:!0,children:[e.jsx(H,{id:"cloud-provider-label",children:"Cloud Provider"}),e.jsxs(Q,{labelId:"cloud-provider-label",id:"cloud-provider-select",value:r.cloudProvider,onChange:t=>{console.log("🔍 Cloud provider changed:",t.target.value),l({cloudProvider:t.target.value})},label:"Cloud Provider",children:[e.jsx(v,{value:"firestore",children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Y,{}),e.jsxs(s,{children:[e.jsx(a,{children:"Firestore"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Real-time NoSQL database"})]})]})}),e.jsx(v,{value:"gcs",children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{}),e.jsxs(s,{children:[e.jsx(a,{children:"Google Cloud Storage"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Object storage with metadata"})]})]})})]})]})}),r.cloudProvider==="gcs"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"GCS Bucket",value:r.gcsBucket,onChange:t=>l({gcsBucket:t.target.value}),error:!!i.gcsBucket,helperText:i.gcsBucket,placeholder:"my-project-bucket"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Prefix (Optional)",value:r.gcsPrefix,onChange:t=>l({gcsPrefix:t.target.value}),placeholder:"projects/"})})]})]})]})})]}),le=()=>e.jsxs(s,{sx:{py:2},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Network Configuration"}),e.jsx(a,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Configure local network deployment for team collaboration."}),e.jsx(q,{sx:{mb:3},children:e.jsx(u,{control:e.jsx(b,{checked:r.enableLocalNetwork,onChange:t=>l({enableLocalNetwork:t.target.checked})}),label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{}),e.jsxs(s,{children:[e.jsx(a,{children:"Enable Local Network Deployment"}),e.jsx(a,{variant:"body2",color:"text.secondary",children:"Allow team members to connect to your local instance"})]})]})})}),r.enableLocalNetwork&&e.jsx("div",{children:e.jsx(I,{variant:"outlined",children:e.jsxs(N,{children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Network Deployment Settings"}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Network Address",value:r.networkAddress,onChange:t=>l({networkAddress:t.target.value}),error:!!i.networkAddress,helperText:i.networkAddress||"IP address or hostname",placeholder:"192.168.1.100"})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Port",type:"number",value:r.networkPort,onChange:t=>l({networkPort:parseInt(t.target.value)||3e3}),error:!!i.networkPort,helperText:i.networkPort||"Port 1024-65535",InputProps:{inputProps:{min:1024,max:65535}}})}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx(_,{sx:{my:1}}),e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Desktop/Web Preferred Development Ports"})]}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Preferred Website Port (Dev)",type:"number",value:r.preferredWebsitePort??"",onChange:t=>l({preferredWebsitePort:parseInt(t.target.value)||void 0}),error:!!i.preferredWebsitePort,helperText:i.preferredWebsitePort||"Optional. Default 3002",InputProps:{inputProps:{min:1024,max:65535}}})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Preferred API Port (Dev)",type:"number",value:r.preferredApiPort??"",onChange:t=>l({preferredApiPort:parseInt(t.target.value)||void 0}),error:!!i.preferredApiPort,helperText:i.preferredApiPort||"Optional. Default 3003",InputProps:{inputProps:{min:1024,max:65535}}})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Max Network Users",type:"number",value:r.maxNetworkUsers,onChange:t=>l({maxNetworkUsers:parseInt(t.target.value)||10}),error:!!i.maxNetworkUsers,helperText:i.maxNetworkUsers,InputProps:{inputProps:{min:1,max:100}}})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Network Password (Optional)",type:"password",value:r.networkPassword,onChange:t=>l({networkPassword:t.target.value}),helperText:"Leave empty for no password protection"})})]}),e.jsx(k,{severity:"info",sx:{mt:2},children:e.jsxs(a,{variant:"body2",children:["Your local instance will be accessible at"," ",e.jsxs("strong",{children:["http://",r.networkAddress,":",r.networkPort]})]})})]})})})]}),ie=()=>e.jsxs(s,{sx:{py:2},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Collaboration Settings"}),e.jsx(a,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Configure how team members can collaborate on this project."}),e.jsxs(n,{container:!0,spacing:3,children:[e.jsxs(n,{item:!0,xs:12,children:[e.jsxs(a,{gutterBottom:!0,children:["Max Collaborators: ",r.maxCollaborators]}),e.jsx(Ce,{value:r.maxCollaborators,onChange:(t,o)=>l({maxCollaborators:o}),min:1,max:c,marks:[{value:1,label:"1"},{value:Math.min(25,c),label:Math.min(25,c).toString()},{value:Math.min(50,c),label:Math.min(50,c).toString()},{value:c,label:c.toString()}],valueLabelDisplay:"auto"})]}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle1",gutterBottom:!0,children:"Collaboration Features"}),e.jsxs(q,{children:[e.jsx(u,{control:e.jsx(b,{checked:r.enableRealTime,onChange:t=>l({enableRealTime:t.target.checked})}),label:"Real-time Editing"}),e.jsx(u,{control:e.jsx(b,{checked:r.enableComments,onChange:t=>l({enableComments:t.target.checked})}),label:"Comments & Annotations"}),e.jsx(u,{control:e.jsx(b,{checked:r.enableFileSharing,onChange:t=>l({enableFileSharing:t.target.checked})}),label:"File Sharing"}),e.jsx(u,{control:e.jsx(b,{checked:r.enableVersionControl,onChange:t=>l({enableVersionControl:t.target.checked})}),label:"Version Control"})]})]})]})]}),de=()=>e.jsxs(s,{sx:{py:2},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Dataset Assignment (Optional)"}),e.jsx(a,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Select existing datasets to assign to this project. You can also assign datasets later from the project details page."}),ee?e.jsx(s,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx($,{sx:{width:"100%"}})}):e.jsxs(s,{children:[A.length===0?e.jsx(k,{severity:"info",sx:{mb:2},children:e.jsx(a,{variant:"body2",children:"No datasets available. You can create datasets from the main Cloud Projects page and assign them later."})}):e.jsxs(s,{children:[e.jsxs(a,{variant:"subtitle2",gutterBottom:!0,children:["Available Datasets (",A.length,")"]}),e.jsx(s,{sx:{maxHeight:300,overflowY:"auto",border:"1px solid",borderColor:"divider",borderRadius:1,p:1},children:A.map(t=>{var o;return e.jsx(u,{control:e.jsx(b,{checked:r.selectedDatasets.includes(t.id),onChange:d=>{const ue=d.target.checked?[...r.selectedDatasets,t.id]:r.selectedDatasets.filter(he=>he!==t.id);l({selectedDatasets:ue})}}),label:e.jsxs(s,{children:[e.jsx(a,{variant:"body2",fontWeight:500,children:t.name}),e.jsxs(a,{variant:"caption",color:"text.secondary",children:[t.description||"No description"," • ",((o=t.storage)==null?void 0:o.backend)==="gcs"?"Google Cloud Storage":"Firestore"]})]}),sx:{display:"flex",width:"100%",m:0,p:1,borderRadius:1,"&:hover":{backgroundColor:"action.hover"}}},t.id)})}),r.selectedDatasets.length>0&&e.jsx(k,{severity:"success",sx:{mt:2},children:e.jsxs(a,{variant:"body2",children:[r.selectedDatasets.length," dataset",r.selectedDatasets.length>1?"s":""," selected for assignment."]})})]}),e.jsx(s,{sx:{mt:2,p:2,backgroundColor:"action.hover",borderRadius:1},children:e.jsxs(a,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Tip:"}),' You can create new datasets from the main Cloud Projects page using the "Create Dataset" button, then assign them to projects as needed.']})})]})]}),ce=()=>e.jsxs(s,{sx:{py:2},children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Review & Create"}),e.jsx(a,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Review your project configuration before creating."}),e.jsx(n,{container:!0,spacing:2,children:e.jsx(n,{item:!0,xs:12,children:e.jsx(I,{variant:"outlined",children:e.jsxs(N,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:r.name}),r.description&&e.jsx(a,{variant:"body2",color:"text.secondary",paragraph:!0,children:r.description}),e.jsxs(s,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(B,{icon:m==="standalone"?e.jsx(z,{}):e.jsx(W,{}),label:m==="standalone"?"Standalone Mode":"Network Mode",color:"primary"}),e.jsx(B,{icon:e.jsx(F,{}),label:`${r.storageMode} storage`,variant:"outlined"}),r.enableLocalNetwork&&e.jsx(B,{icon:e.jsx(W,{}),label:`Network: ${r.networkAddress}:${r.networkPort}`,variant:"outlined"})]}),e.jsx(_,{sx:{my:2}}),e.jsx(a,{variant:"subtitle2",gutterBottom:!0,children:"Configuration Summary:"}),e.jsxs(s,{component:"ul",sx:{pl:2,m:0},children:[e.jsxs(a,{component:"li",variant:"body2",children:["Storage: ",r.storageMode,r.storageMode==="cloud"&&` (${r.cloudProvider})`]}),e.jsxs(a,{component:"li",variant:"body2",children:["Max Collaborators: ",r.maxCollaborators]}),r.enableLocalNetwork&&e.jsxs(a,{component:"li",variant:"body2",children:["Local Network: ",r.networkAddress,":",r.networkPort,"(max ",r.maxNetworkUsers," users)"]}),e.jsxs(a,{component:"li",variant:"body2",children:["Features: ",[r.enableRealTime&&"Real-time",r.enableComments&&"Comments",r.enableFileSharing&&"File Sharing",r.enableVersionControl&&"Version Control"].filter(Boolean).join(", ")]}),r.selectedDatasets.length>0&&e.jsxs(a,{component:"li",variant:"body2",children:["Datasets: ",r.selectedDatasets.length," dataset",r.selectedDatasets.length>1?"s":""," selected"]})]})]})})})})]}),xe=t=>{switch(t){case 0:return oe();case 1:return ne();case 2:return le();case 3:return ie();case 4:return de();case 5:return ce();default:return null}};return e.jsxs(pe,{open:C,onClose:f,maxWidth:"md",fullWidth:!0,sx:{zIndex:1400},PaperProps:{sx:{minHeight:"70vh",backgroundColor:"background.default","& .MuiDialogContent-root":{backgroundColor:"background.default"}}},children:[e.jsxs(ge,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",backgroundColor:"background.paper",borderBottom:"1px solid",borderColor:"divider",pb:2},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(V,{color:"primary"}),e.jsx(a,{variant:"h6",sx:{fontWeight:600},children:"Create New Project"})]}),e.jsx(be,{onClick:f,size:"small",children:e.jsx(me,{})})]}),e.jsxs(je,{sx:{p:3},children:[E&&e.jsx(k,{severity:"error",sx:{mb:3},children:E}),e.jsx(ve,{activeStep:p,orientation:"horizontal",sx:{mb:3},children:Z.map((t,o)=>e.jsx(fe,{children:e.jsx(ke,{children:t})},t))}),xe(p),g&&e.jsx($,{sx:{mt:2}})]}),e.jsxs(ye,{sx:{px:3,pb:3,pt:2,backgroundColor:"background.paper",borderTop:"1px solid",borderColor:"divider",justifyContent:"space-between"},children:[e.jsx(y,{onClick:f,variant:"outlined",disabled:g,sx:{borderColor:"primary.main",color:"primary.main"},children:"Cancel"}),e.jsxs(s,{sx:{display:"flex",gap:1},children:[e.jsx(y,{onClick:ae,disabled:p===0||g,variant:"outlined",children:"Back"}),p===Z.length-1?e.jsx(y,{onClick:se,variant:"contained",disabled:g||!r.name.trim(),startIcon:e.jsx(V,{}),sx:{backgroundColor:"primary.main","&:hover":{backgroundColor:"primary.dark"}},children:g?"Creating...":"Create Project"}):e.jsx(y,{onClick:te,variant:"contained",disabled:g,children:"Next"})]})]})]})};export{Ne as U};
