const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/CloudProjectIntegration-BcZMMiZo.js","assets/mui-DfoTb_nB.js","assets/vendor-OeuszDaU.js","assets/index-CVyAHYZ-.js","assets/stripe-DEPCLfU9.js","assets/index-DrfToOVX.css","assets/proxy-oKNssMSV.js"])))=>i.map(i=>d[i]);
var te=Object.defineProperty;var re=(m,r,a)=>r in m?te(m,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):m[r]=a;var S=(m,r,a)=>re(m,typeof r!="symbol"?r+"":r,a);import{j as e,aD as ae,aE as oe,T as s,I as se,bO as ne,aG as le,t as D,a as l,a6 as ie,a7 as ce,a8 as de,cg as ue,D as he,aJ as xe,d as k,K as ge,G as u,k as I,l as M,h as A,aK as U,aI as N,aH as L,M as me,ch as pe,ci as R,F as p,Q as w,u as j,aZ as O,c7 as je,c8 as be,c9 as B,Z as q,a$ as fe,a4 as V}from"./mui-DfoTb_nB.js";import{r as f}from"./vendor-OeuszDaU.js";import{_ as we}from"./index-CVyAHYZ-.js";import{m as Se}from"./proxy-oKNssMSV.js";const v=class v{constructor(){S(this,"listeners",[]);S(this,"state",{currentStep:"mode_selection",selectedMode:null,storageMode:"local",isAuthenticated:!1,user:null,selectedProjectId:null,error:null,isLoading:!1});this.initialize()}static getInstance(){return this.instance||(this.instance=new v),this.instance}async initialize(){try{const r=this.checkExistingAuthentication(),a=localStorage.getItem("preferredApplicationMode"),n=localStorage.getItem("preferredStorageMode");if(sessionStorage.getItem("startup_reset")==="true"){sessionStorage.removeItem("startup_reset"),this.updateState({currentStep:"mode_selection",selectedMode:null,storageMode:n||"local",isAuthenticated:!1});return}if(r.isValid&&a){this.updateState({isAuthenticated:!0,user:r.user,selectedMode:a,storageMode:n||"local"});const d=localStorage.getItem("lastProjectId");d&&this.validateProjectAccess(d,a)?await this.completeStartup(d):this.updateState({currentStep:"project_selection"})}else this.updateState({currentStep:"mode_selection",storageMode:n||"local"})}catch(r){console.error("Startup initialization error:",r),this.updateState({error:"Failed to initialize application",currentStep:"mode_selection"})}}subscribe(r){return this.listeners.push(r),r(this.state),()=>{const a=this.listeners.indexOf(r);a>-1&&this.listeners.splice(a,1)}}getState(){return{...this.state}}async selectMode(r,a="local"){try{this.updateState({isLoading:!0,error:null}),localStorage.setItem("preferredApplicationMode",r),localStorage.setItem("preferredStorageMode",a),this.updateState({selectedMode:r,storageMode:a}),this.requiresAuthentication(r,a)?this.state.isAuthenticated?this.updateState({currentStep:"project_selection",isLoading:!1}):this.updateState({currentStep:"authentication",isLoading:!1}):this.updateState({currentStep:"project_selection",isLoading:!1})}catch(n){console.error("Mode selection error:",n),this.updateState({error:"Failed to select mode",isLoading:!1})}}async onAuthenticationSuccess(r){try{this.updateState({isAuthenticated:!0,user:r,currentStep:"project_selection",error:null}),localStorage.setItem("currentUser",JSON.stringify(r)),localStorage.setItem("lastAuthTime",Date.now().toString())}catch(a){console.error("Authentication success handling error:",a),this.updateState({error:"Failed to complete authentication"})}}async selectProject(r){try{if(this.updateState({isLoading:!0,error:null}),!this.validateProjectAccess(r,this.state.selectedMode))throw new Error("Invalid project access");await this.completeStartup(r)}catch(a){console.error("Project selection error:",a),this.updateState({error:"Failed to select project",isLoading:!1})}}async createProject(r){try{this.updateState({isLoading:!0,error:null}),this.validateProjectCreationOptions(r);const a=await this.executeProjectCreation(r);return await this.completeStartup(a),a}catch(a){throw console.error("Project creation error:",a),this.updateState({error:`Failed to create project: ${a instanceof Error?a.message:"Unknown error"}`,isLoading:!1}),a}}async reset(){sessionStorage.clear(),localStorage.removeItem("currentUser"),localStorage.removeItem("lastAuthTime"),localStorage.removeItem("lastProjectId"),sessionStorage.setItem("startup_reset","true"),this.updateState({currentStep:"mode_selection",selectedMode:null,isAuthenticated:!1,user:null,selectedProjectId:null,error:null,isLoading:!1})}async switchMode(r,a="local"){this.state.selectedProjectId&&localStorage.setItem("lastProjectId",this.state.selectedProjectId),await this.selectMode(r,a)}updateState(r){this.state={...this.state,...r},this.listeners.forEach(a=>{try{a(this.state)}catch(n){console.error("Startup listener error:",n)}})}checkExistingAuthentication(){try{const r=localStorage.getItem("currentUser"),a=localStorage.getItem("lastAuthTime");if(!r||!a)return{isValid:!1,user:null};const n=parseInt(a),c=Date.now(),d=24*60*60*1e3;return c-n>d?{isValid:!1,user:null}:{isValid:!0,user:JSON.parse(r)}}catch{return{isValid:!1,user:null}}}requiresAuthentication(r,a){return r==="shared_network"||r==="standalone"&&a==="cloud"||a==="hybrid"}validateProjectAccess(r,a){return!(!r||!a)}validateProjectCreationOptions(r){var a,n,c,d;if(!((a=r.name)!=null&&a.trim()))throw new Error("Project name is required");if((n=r.localNetworkConfig)!=null&&n.enabled){const{port:t,address:b,maxUsers:g}=r.localNetworkConfig;if(!t||t<1024||t>65535)throw new Error("Invalid port number (must be between 1024-65535)");if(!(b!=null&&b.trim()))throw new Error("Network address is required for local network deployment");if(!g||g<1||g>100)throw new Error("Max users must be between 1-100")}if(r.storageMode==="cloud"&&((c=r.cloudConfig)==null?void 0:c.provider)==="gcs"&&!((d=r.cloudConfig.bucket)!=null&&d.trim()))throw new Error("GCS bucket is required for cloud storage")}async executeProjectCreation(r){if(this.requiresCloudIntegration()){const{cloudProjectIntegration:n}=await we(async()=>{const{cloudProjectIntegration:d}=await import("./CloudProjectIntegration-BcZMMiZo.js");return{cloudProjectIntegration:d}},__vite__mapDeps([0,1,2,3,4,5,6])),c=localStorage.getItem("auth_token");return c&&n.setAuthToken(c),await n.createCloudProject(r)}else return await this.createLocalProject(r)}requiresCloudIntegration(){return this.state.selectedMode==="shared_network"||this.state.storageMode==="cloud"||this.state.storageMode==="hybrid"}async createLocalProject(r){var d;const a={name:r.name,description:r.description,mode:this.state.selectedMode,storageMode:this.state.storageMode,createdBy:((d=this.state.user)==null?void 0:d.id)||"local-user",createdAt:new Date().toISOString(),localNetworkConfig:r.localNetworkConfig,collaborationSettings:r.collaborationSettings},n=`local_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,c=JSON.parse(localStorage.getItem("localProjects")||"[]");return c.push({id:n,...a}),localStorage.setItem("localProjects",JSON.stringify(c)),console.log("Created local project:",n,a),n}async completeStartup(r){localStorage.setItem("lastProjectId",r),this.updateState({currentStep:"complete",selectedProjectId:r,isLoading:!1,error:null}),window.dispatchEvent(new CustomEvent("startup:complete",{detail:{mode:this.state.selectedMode,storageMode:this.state.storageMode,projectId:r,user:this.state.user}}))}isComplete(){return this.state.currentStep==="complete"&&this.state.selectedMode!==null&&this.state.selectedProjectId!==null}requiresAuthentication(){return this.requiresAuthentication(this.state.selectedMode,this.state.storageMode)}getSelectedMode(){return this.state.selectedMode}getStorageMode(){return this.state.storageMode}getCurrentUser(){return this.state.user}getSelectedProjectId(){return this.state.selectedProjectId}};S(v,"instance");let E=v;const $=E.getInstance();typeof window<"u"&&(window.simplifiedStartupSequencer=$);const W={name:"",description:"",storageMode:"local",cloudProvider:"firestore",gcsBucket:"",gcsPrefix:"",enableLocalNetwork:!1,networkPort:3e3,networkAddress:"localhost",maxNetworkUsers:10,networkPassword:"",maxCollaborators:10,enableRealTime:!0,enableComments:!0,enableFileSharing:!0,enableVersionControl:!0,enableEncryption:!1,autoBackup:!0,backupInterval:30,enableAuditLog:!1},G=["Basic Information","Storage Configuration","Network Settings","Collaboration Options","Review & Create"],Ie=({open:m,onClose:r,mode:a,onSuccess:n})=>{const[c,d]=f.useState(0),[t,b]=f.useState(W),[g,_]=f.useState(!1),[F,C]=f.useState(null),[x,y]=f.useState({});f.useEffect(()=>{m&&(b({...W,enableLocalNetwork:a==="standalone",maxCollaborators:a==="shared_network"?25:5,enableRealTime:a==="shared_network"}),d(0),C(null),y({}))},[m,a]);const h=o=>{b(P=>({...P,...o}));const i={...x};Object.keys(o).forEach(P=>{delete i[P]}),y(i)},T=o=>{const i={};switch(o){case 0:t.name.trim()||(i.name="Project name is required"),t.name.length>100&&(i.name="Project name must be less than 100 characters");break;case 1:t.storageMode==="cloud"&&t.cloudProvider==="gcs"&&(t.gcsBucket.trim()||(i.gcsBucket="GCS bucket name is required"));break;case 2:t.enableLocalNetwork&&((t.networkPort<1024||t.networkPort>65535)&&(i.networkPort="Port must be between 1024 and 65535"),t.networkAddress.trim()||(i.networkAddress="Network address is required"),(t.maxNetworkUsers<1||t.maxNetworkUsers>100)&&(i.maxNetworkUsers="Max users must be between 1 and 100"));break;case 3:(t.maxCollaborators<1||t.maxCollaborators>100)&&(i.maxCollaborators="Max collaborators must be between 1 and 100");break}return y(i),Object.keys(i).length===0},z=()=>{T(c)&&d(o=>o+1)},J=()=>{d(o=>o-1)},H=async()=>{if(T(c)){_(!0),C(null);try{const o={name:t.name,description:t.description,storageMode:t.storageMode,localNetworkConfig:t.enableLocalNetwork?{enabled:!0,port:t.networkPort,address:t.networkAddress,maxUsers:t.maxNetworkUsers}:void 0,cloudConfig:t.storageMode==="cloud"?{provider:t.cloudProvider,bucket:t.gcsBucket,prefix:t.gcsPrefix}:void 0,collaborationSettings:{maxCollaborators:t.maxCollaborators,enableRealTime:t.enableRealTime,enableComments:t.enableComments,enableFileSharing:t.enableFileSharing}},i=await $.createProject(o);n==null||n(i),r()}catch(o){C(o instanceof Error?o.message:"Failed to create project")}finally{_(!1)}}},K=o=>{switch(o){case 0:return Q();case 1:return Z();case 2:return X();case 3:return Y();case 4:return ee();default:return null}},Q=()=>e.jsxs(l,{sx:{py:2},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Project Information"}),e.jsx(s,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Provide basic information about your project. This can be changed later."}),e.jsxs(u,{container:!0,spacing:3,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Project Name",value:t.name,onChange:o=>h({name:o.target.value}),error:!!x.name,helperText:x.name,required:!0,placeholder:"My Awesome Project"})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(j,{fullWidth:!0,label:"Description",value:t.description,onChange:o=>h({description:o.target.value}),multiline:!0,rows:3,placeholder:"Describe what this project is about..."})})]})]}),Z=()=>e.jsxs(l,{sx:{py:2},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Storage Configuration"}),e.jsx(s,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Choose how your project data will be stored and accessed."}),e.jsxs(O,{component:"fieldset",fullWidth:!0,sx:{mb:3},children:[e.jsx(je,{component:"legend",children:"Storage Mode"}),e.jsxs(be,{value:t.storageMode,onChange:o=>h({storageMode:o.target.value}),children:[e.jsx(p,{value:"local",control:e.jsx(B,{}),label:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(U,{}),e.jsxs(l,{children:[e.jsx(s,{variant:"body1",children:"Local Storage"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Store project files on your local machine"})]})]})}),e.jsx(p,{value:"cloud",control:e.jsx(B,{}),label:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(q,{}),e.jsxs(l,{children:[e.jsx(s,{variant:"body1",children:"Cloud Storage"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Store project data in the cloud for sharing and backup"})]})]})}),e.jsx(p,{value:"hybrid",control:e.jsx(B,{}),label:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(L,{}),e.jsxs(l,{children:[e.jsx(s,{variant:"body1",children:"Hybrid Storage"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Combine local and cloud storage for optimal performance"})]})]})})]})]}),t.storageMode==="cloud"&&e.jsx(I,{variant:"outlined",sx:{mb:2},children:e.jsxs(M,{children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Cloud Provider Settings"}),e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(O,{fullWidth:!0,children:e.jsxs(fe,{value:t.cloudProvider,onChange:o=>h({cloudProvider:o.target.value}),children:[e.jsx(V,{value:"firestore",children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(q,{}),e.jsxs(l,{children:[e.jsx(s,{children:"Firestore"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Real-time NoSQL database"})]})]})}),e.jsx(V,{value:"gcs",children:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(L,{}),e.jsxs(l,{children:[e.jsx(s,{children:"Google Cloud Storage"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Object storage with metadata"})]})]})})]})})}),t.cloudProvider==="gcs"&&e.jsxs(e.Fragment,{children:[e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(j,{fullWidth:!0,label:"GCS Bucket",value:t.gcsBucket,onChange:o=>h({gcsBucket:o.target.value}),error:!!x.gcsBucket,helperText:x.gcsBucket,placeholder:"my-project-bucket"})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(j,{fullWidth:!0,label:"Prefix (Optional)",value:t.gcsPrefix,onChange:o=>h({gcsPrefix:o.target.value}),placeholder:"projects/"})})]})]})]})})]}),X=()=>e.jsxs(l,{sx:{py:2},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Network Configuration"}),e.jsx(s,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Configure local network deployment for team collaboration."}),e.jsx(R,{sx:{mb:3},children:e.jsx(p,{control:e.jsx(w,{checked:t.enableLocalNetwork,onChange:o=>h({enableLocalNetwork:o.target.checked})}),label:e.jsxs(l,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(N,{}),e.jsxs(l,{children:[e.jsx(s,{children:"Enable Local Network Deployment"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Allow team members to connect to your local instance"})]})]})})}),t.enableLocalNetwork&&e.jsx(Se.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:e.jsx(I,{variant:"outlined",children:e.jsxs(M,{children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Network Deployment Settings"}),e.jsxs(u,{container:!0,spacing:3,children:[e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(j,{fullWidth:!0,label:"Network Address",value:t.networkAddress,onChange:o=>h({networkAddress:o.target.value}),error:!!x.networkAddress,helperText:x.networkAddress||"IP address or hostname",placeholder:"192.168.1.100"})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(j,{fullWidth:!0,label:"Port",type:"number",value:t.networkPort,onChange:o=>h({networkPort:parseInt(o.target.value)||3e3}),error:!!x.networkPort,helperText:x.networkPort||"Port 1024-65535",InputProps:{inputProps:{min:1024,max:65535}}})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(j,{fullWidth:!0,label:"Max Network Users",type:"number",value:t.maxNetworkUsers,onChange:o=>h({maxNetworkUsers:parseInt(o.target.value)||10}),error:!!x.maxNetworkUsers,helperText:x.maxNetworkUsers,InputProps:{inputProps:{min:1,max:100}}})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(j,{fullWidth:!0,label:"Network Password (Optional)",type:"password",value:t.networkPassword,onChange:o=>h({networkPassword:o.target.value}),helperText:"Leave empty for no password protection"})})]}),e.jsx(D,{severity:"info",sx:{mt:2},children:e.jsxs(s,{variant:"body2",children:["Your local instance will be accessible at"," ",e.jsxs("strong",{children:["http://",t.networkAddress,":",t.networkPort]})]})})]})})})]}),Y=()=>e.jsxs(l,{sx:{py:2},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Collaboration Settings"}),e.jsx(s,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Configure how team members can collaborate on this project."}),e.jsxs(u,{container:!0,spacing:3,children:[e.jsxs(u,{item:!0,xs:12,children:[e.jsxs(s,{gutterBottom:!0,children:["Max Collaborators: ",t.maxCollaborators]}),e.jsx(pe,{value:t.maxCollaborators,onChange:(o,i)=>h({maxCollaborators:i}),min:1,max:100,marks:[{value:1,label:"1"},{value:25,label:"25"},{value:50,label:"50"},{value:100,label:"100"}],valueLabelDisplay:"auto"})]}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(s,{variant:"subtitle1",gutterBottom:!0,children:"Collaboration Features"}),e.jsxs(R,{children:[e.jsx(p,{control:e.jsx(w,{checked:t.enableRealTime,onChange:o=>h({enableRealTime:o.target.checked})}),label:"Real-time Editing"}),e.jsx(p,{control:e.jsx(w,{checked:t.enableComments,onChange:o=>h({enableComments:o.target.checked})}),label:"Comments & Annotations"}),e.jsx(p,{control:e.jsx(w,{checked:t.enableFileSharing,onChange:o=>h({enableFileSharing:o.target.checked})}),label:"File Sharing"}),e.jsx(p,{control:e.jsx(w,{checked:t.enableVersionControl,onChange:o=>h({enableVersionControl:o.target.checked})}),label:"Version Control"})]})]})]})]}),ee=()=>e.jsxs(l,{sx:{py:2},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Review & Create"}),e.jsx(s,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Review your project configuration before creating."}),e.jsx(u,{container:!0,spacing:2,children:e.jsx(u,{item:!0,xs:12,children:e.jsx(I,{variant:"outlined",children:e.jsxs(M,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:t.name}),t.description&&e.jsx(s,{variant:"body2",color:"text.secondary",paragraph:!0,children:t.description}),e.jsxs(l,{sx:{display:"flex",gap:1,flexWrap:"wrap",mb:2},children:[e.jsx(A,{icon:a==="standalone"?e.jsx(U,{}):e.jsx(N,{}),label:a==="standalone"?"Standalone Mode":"Network Mode",color:"primary"}),e.jsx(A,{icon:e.jsx(L,{}),label:`${t.storageMode} storage`,variant:"outlined"}),t.enableLocalNetwork&&e.jsx(A,{icon:e.jsx(N,{}),label:`Network: ${t.networkAddress}:${t.networkPort}`,variant:"outlined"})]}),e.jsx(me,{sx:{my:2}}),e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Configuration Summary:"}),e.jsxs(l,{component:"ul",sx:{pl:2,m:0},children:[e.jsxs(s,{component:"li",variant:"body2",children:["Storage: ",t.storageMode,t.storageMode==="cloud"&&` (${t.cloudProvider})`]}),e.jsxs(s,{component:"li",variant:"body2",children:["Max Collaborators: ",t.maxCollaborators]}),t.enableLocalNetwork&&e.jsxs(s,{component:"li",variant:"body2",children:["Local Network: ",t.networkAddress,":",t.networkPort,"(max ",t.maxNetworkUsers," users)"]}),e.jsxs(s,{component:"li",variant:"body2",children:["Features: ",[t.enableRealTime&&"Real-time",t.enableComments&&"Comments",t.enableFileSharing&&"File Sharing",t.enableVersionControl&&"Version Control"].filter(Boolean).join(", ")]})]})]})})})})]});return e.jsxs(ae,{open:m,onClose:r,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"70vh"}},children:[e.jsxs(oe,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(s,{variant:"h6",children:["Create New ",a==="standalone"?"Standalone":"Network"," Project"]}),e.jsx(se,{onClick:r,size:"small",children:e.jsx(ne,{})})]}),e.jsxs(le,{children:[F&&e.jsx(D,{severity:"error",sx:{mb:2},children:F}),e.jsx(l,{sx:{width:"100%"},children:e.jsx(ie,{activeStep:c,orientation:"vertical",children:G.map((o,i)=>e.jsxs(ce,{children:[e.jsx(de,{children:o}),e.jsx(ue,{children:K(i)})]},o))})}),g&&e.jsx(he,{sx:{mt:2}})]}),e.jsxs(xe,{sx:{px:3,pb:2},children:[e.jsx(k,{onClick:r,disabled:g,children:"Cancel"}),c>0&&e.jsx(k,{onClick:J,disabled:g,children:"Back"}),c<G.length-1?e.jsx(k,{onClick:z,variant:"contained",disabled:g,children:"Next"}):e.jsx(k,{onClick:H,variant:"contained",disabled:g,startIcon:e.jsx(ge,{}),children:g?"Creating...":"Create Project"})]})]})};export{Ie as U,$ as s};
