const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.esm-DOG5cvVU.js","assets/index.esm-COtph9ny.js","assets/FirestoreCollectionManager-BYWGwTL8.js","assets/index-XoBbXTtz.js","assets/mui-BDWO4bKb.js","assets/vendor-CjD1bmmO.js","assets/stripe-CpfM3ZZO.js","assets/index-CBai7h7s.css","assets/index.esm-ClhtutUx.js"])))=>i.map(i=>d[i]);
import{_ as h}from"./index-XoBbXTtz.js";import{r as P,i as S,S as C,D as M,_ as j,a as z,b as O,c as R,d as U,e as x,f as V,g as k,h as L,F as B}from"./index.esm-COtph9ny.js";import{getFirestore as A,query as w,collection as f,where as c,getDocs as F,getDoc as v,doc as y,orderBy as G,addDoc as q,deleteDoc as Q}from"./index.esm-ClhtutUx.js";import{getAuth as E}from"./index.esm-DOG5cvVU.js";import"./mui-BDWO4bKb.js";import"./vendor-CjD1bmmO.js";import"./stripe-CpfM3ZZO.js";var K="firebase",W="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */P(K,W,"app");const Y=Object.freeze(Object.defineProperty({__proto__:null,FirebaseError:B,SDK_VERSION:C,_DEFAULT_ENTRY_NAME:M,_addComponent:j,_apps:z,_components:O,_getProvider:R,_isFirebaseServerApp:U,_registerComponent:x,_serverApps:V,getApp:k,getApps:L,initializeApp:S,registerVersion:P},Symbol.toStringTag,{value:"Module"})),_={},$=()=>typeof window<"u"&&window.FIREBASE_CONFIG?window.FIREBASE_CONFIG:{apiKey:(_==null?void 0:_.VITE_FIREBASE_API_KEY)||"AIzaSyDFnIzSYCdPsDDdvP1lympVxEeUn0AQhWs",authDomain:"backbone-logic.firebaseapp.com",projectId:"backbone-logic",storageBucket:"backbone-logic.firebasestorage.app",messagingSenderId:"749245129278",appId:"1:749245129278:web:dfa5647101ea160a3b276f",measurementId:"G-8SZRDQ4XVR"},T=$();let b;try{b=S(T),console.log("üî• [Firebase] App initialized successfully")}catch(r){console.log("‚ÑπÔ∏è [Firebase] App already initialized or error:",r)}async function J(){if(b)return b;try{const{getApps:r}=await h(async()=>{const{getApps:t}=await Promise.resolve().then(()=>Y);return{getApps:t}},void 0),e=r();if(e.length>0)return b=e[0],console.log("‚úÖ [Firebase] Using existing app instance"),b}catch(r){console.warn("‚ö†Ô∏è [Firebase] Failed to get existing apps:",r)}try{return b=S(T,"fallback"),console.log("‚úÖ [Firebase] Created fallback app instance"),b}catch(r){throw console.error("‚ùå [Firebase] Failed to create fallback app:",r),new Error("Failed to initialize Firebase app")}}const g=b?A(b):A(),u=b?E(b):E();u&&h(async()=>{const{setPersistence:r,browserLocalPersistence:e}=await import("./index.esm-DOG5cvVU.js");return{setPersistence:r,browserLocalPersistence:e}},__vite__mapDeps([0,1])).then(({setPersistence:r,browserLocalPersistence:e})=>{r(u,e).catch(t=>{console.warn("‚ö†Ô∏è [Firebase] Failed to set auth persistence:",t)})}).catch(r=>{console.warn("‚ö†Ô∏è [Firebase] Failed to import auth persistence:",r)});async function ne(){const r=await J();return{app:r,db:A(r),auth:E(r)}}function X(){if(!(typeof window>"u"))try{console.log("‚ÑπÔ∏è [Firebase] Skipping client-side CSP override - relying on Firebase hosting CSP");const r=document.querySelector('meta[http-equiv="Content-Security-Policy"]');r&&(r.remove(),console.log("üßπ [Firebase] Removed conflicting client-side CSP meta tag"))}catch(r){console.warn("‚ö†Ô∏è [Firebase] Failed to clean up CSP:",r)}}X();typeof window<"u"&&(window.FIREBASE_IGNORE_UNDEFINED_PROPERTIES=!0);console.log("üåê [Firebase] Licensing website mode: production (web-only) - no emulators");const ce=()=>!0;let N=!1;const le=async()=>{if(!N)try{const{firestoreCollectionManager:r}=await h(async()=>{const{firestoreCollectionManager:e}=await import("./FirestoreCollectionManager-BYWGwTL8.js");return{firestoreCollectionManager:e}},__vite__mapDeps([2,3,4,5,6,7,8,1,0]));await r.initializeCollections(),N=!0,console.log("‚úÖ [Firebase] Collection manager initialized")}catch(r){console.error("‚ùå [Firebase] Failed to initialize collection manager:",r)}},me=()=>u.currentUser!==null,de=()=>u.currentUser,Z=r=>{var e;return((e=u.currentUser)==null?void 0:e.email)===r},pe=async r=>{try{if(Z(r))return!0;if(u.currentUser&&u.currentUser.email!==r){const{signOut:e}=await h(async()=>{const{signOut:t}=await import("./index.esm-DOG5cvVU.js");return{signOut:t}},__vite__mapDeps([0,1]));await e(u)}try{const e=localStorage.getItem("auth_user"),t=localStorage.getItem("temp_credentials");if(e&&t){const a=JSON.parse(t);if(a.email===r&&a.password){console.log("üîë [Firebase] Attempting to restore Firebase Auth session with stored credentials");const{signInWithEmailAndPassword:i}=await h(async()=>{const{signInWithEmailAndPassword:m}=await import("./index.esm-DOG5cvVU.js");return{signInWithEmailAndPassword:m}},__vite__mapDeps([0,1]));return await i(u,r,a.password),console.log("‚úÖ [Firebase] Firebase Auth session restored successfully"),!0}}}catch(e){console.warn("‚ö†Ô∏è [Firebase] Could not restore session with stored credentials:",e)}return console.log("‚ÑπÔ∏è [Firebase] No stored credentials available for session restoration"),!1}catch(e){return console.warn("‚ö†Ô∏è [Firebase] Error during session restoration:",e),!1}};class ge{static async getOrganizationsForUser(e){try{console.log("üîç [Firebase] Getting organizations for user:",e);const t=w(f(g,"organizations"),c("ownerUserId","==",e)),a=await F(t),i=w(f(g,"org_members"),c("userId","==",e),c("status","==","ACTIVE")),m=await F(i),s=new Set,n=[];a.forEach(d=>{const p={id:d.id,...d.data()};n.push(p),s.add(d.id)});for(const d of m.docs){const o=d.data().orgId;if(!s.has(o)){const l=await v(y(g,"organizations",o));if(l.exists()){const I={id:l.id,...l.data()};n.push(I),s.add(o)}}}return console.log("‚úÖ [Firebase] Found organizations:",n.length),n}catch(t){return console.error("‚ùå [Firebase] Error getting organizations:",t),[]}}static async getOrgMembers(e){try{console.log("üîç [Firebase] Getting org members for:",e);const t=w(f(g,"org_members"),c("orgId","==",e),c("status","==","ACTIVE"),G("createdAt","desc")),a=await F(t),i=[];return a.forEach(m=>{const s=m.data();let n=s.name;n||(s.firstName&&s.lastName?n=`${s.firstName} ${s.lastName}`:s.firstName?n=s.firstName:s.lastName?n=s.lastName:s.email?n=s.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "):n="Unknown User");const d={id:m.id,...s,name:n};i.push(d)}),console.log("‚úÖ [Firebase] Found org members:",i.length),i}catch(t){return console.error("‚ùå [Firebase] Error getting org members:",t),[]}}static async getProjectTeamMembers(e){try{console.log("üîç [Firebase] Getting project team members for:",e);const t=w(f(g,"projectTeamMembers"),c("projectId","==",e),c("isActive","==",!0)),a=await F(t),i=[];for(const m of a.docs){const s=m.data();let n;try{const p=await v(y(g,"org_members",s.teamMemberId));if(p.exists()){const o=p.data();let l=o.name;l||(o.firstName&&o.lastName?l=`${o.firstName} ${o.lastName}`:o.firstName?l=o.firstName:o.lastName?l=o.lastName:o.email?l=o.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(D=>D.charAt(0).toUpperCase()+D.slice(1).toLowerCase()).join(" "):l="Unknown User"),n={id:p.id,...o,name:l}}}catch(p){console.warn("Failed to get team member details:",p)}const d={id:m.id,...s,teamMember:n};i.push(d)}return console.log("‚úÖ [Firebase] Found project team members:",i.length),i}catch(t){return console.error("‚ùå [Firebase] Error getting project team members:",t),[]}}static async addTeamMemberToProject(e,t,a="DO_ER"){try{console.log("üîç [Firebase] Adding team member to project:",{projectId:e,teamMemberId:t,role:a});const i=w(f(g,"projectTeamMembers"),c("projectId","==",e),c("teamMemberId","==",t),c("isActive","==",!0));if(!(await F(i)).empty)throw new Error("Team member is already assigned to this project");if(a==="ADMIN"){const p=w(f(g,"projectTeamMembers"),c("projectId","==",e),c("role","==","ADMIN"),c("isActive","==",!0));if(!(await F(p)).empty)throw new Error("Only one Admin is allowed per project. Please remove the existing Admin first.")}const s={projectId:e,teamMemberId:t,role:a,assignedAt:new Date,assignedBy:"current_user",isActive:!0},n=Object.fromEntries(Object.entries(s).filter(([p,o])=>o!=null)),d=await q(f(g,"projectTeamMembers"),n);return console.log("‚úÖ [Firebase] Team member added successfully:",d.id),{id:d.id,...s}}catch(i){throw console.error("‚ùå [Firebase] Error adding team member:",i),i}}static async removeTeamMemberFromProject(e,t){try{console.log("üîç [Firebase] Removing team member from project:",{projectId:e,teamMemberId:t});const a=w(f(g,"projectTeamMembers"),c("projectId","==",e),c("teamMemberId","==",t),c("isActive","==",!0)),i=await F(a);for(const m of i.docs)await Q(y(g,"projectTeamMembers",m.id));console.log("‚úÖ [Firebase] Team member removed successfully")}catch(a){throw console.error("‚ùå [Firebase] Error removing team member:",a),a}}}export{ge as FirebaseTeamMemberService,b as app,u as auth,g as db,ge as default,u as firebaseAuth,g as firestore,X as fixCSPIssues,de as getCurrentFirebaseUser,ne as getInitializedServices,le as initializeFirebaseCollections,Z as isEmailAuthenticated,me as isUserAuthenticated,ce as isWebOnlyMode,pe as tryRestoreFirebaseSession};
