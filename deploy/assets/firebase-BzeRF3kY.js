const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.esm-K73FumZQ.js","assets/index.esm--uL3Qa3r.js","assets/FirestoreCollectionManager-D5wVqmZA.js","assets/index-BX_gmOp_.js","assets/mui-DWTWYqgO.js","assets/vendor-CjD1bmmO.js","assets/stripe-TYTTXgaF.js","assets/index-CBai7h7s.css","assets/index.esm-C6E5jVjx.js"])))=>i.map(i=>d[i]);
import{_ as A}from"./index-BX_gmOp_.js";import{r as M,i as v,g as S,S as O,D as U,_ as x,a as k,b as L,c as V,d as q,e as Q,f as B,h as G,F as K}from"./index.esm--uL3Qa3r.js";import{getFirestore as I,query as w,collection as f,where as d,getDocs as F,getDoc as P,doc as E,orderBy as W,addDoc as Y,deleteDoc as $}from"./index.esm-C6E5jVjx.js";import{getAuth as N}from"./index.esm-K73FumZQ.js";import"./mui-DWTWYqgO.js";import"./vendor-CjD1bmmO.js";import"./stripe-TYTTXgaF.js";var J="firebase",X="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */M(J,X,"app");const Z=Object.freeze(Object.defineProperty({__proto__:null,FirebaseError:K,SDK_VERSION:O,_DEFAULT_ENTRY_NAME:U,_addComponent:x,_apps:k,_components:L,_getProvider:V,_isFirebaseServerApp:q,_registerComponent:Q,_serverApps:B,getApp:G,getApps:S,initializeApp:v,registerVersion:M},Symbol.toStringTag,{value:"Module"})),D={},H=()=>typeof window<"u"&&window.FIREBASE_CONFIG?window.FIREBASE_CONFIG:{apiKey:(D==null?void 0:D.VITE_FIREBASE_API_KEY)||"AIzaSyDFnIzSYCdPsDDdvP1lympVxEeUn0AQhWs",authDomain:"backbone-logic.firebaseapp.com",projectId:"backbone-logic",databaseURL:"https://backbone-logic-default-rtdb.firebaseio.com",storageBucket:"backbone-logic.firebasestorage.app",messagingSenderId:"749245129278",appId:"1:749245129278:web:dfa5647101ea160a3b276f",measurementId:"G-8SZRDQ4XVR"},R=H();let a;if(typeof window<"u"&&window.firebaseApp)console.log("üî• [Firebase] Using globally initialized Firebase app"),a=window.firebaseApp;else{const e=S();if(e.length>0)a=e[0],console.log("üî• [Firebase] Using existing Firebase app:",a.name),typeof window<"u"&&(window.firebaseApp=a);else try{a=v(R),console.log("üî• [Firebase] App initialized successfully"),typeof window<"u"&&(window.firebaseApp=a)}catch(t){console.error("‚ùå [Firebase] Failed to initialize app:",t);const o=S();o.length>0&&(a=o[0],console.log("üî• [Firebase] Using fallback existing app:",a.name))}}async function ee(){if(a)return a;if(typeof window<"u"&&window.firebaseApp)return a=window.firebaseApp,console.log("‚úÖ [Firebase] Found global app instance"),a;try{const{getApps:e}=await A(async()=>{const{getApps:o}=await Promise.resolve().then(()=>Z);return{getApps:o}},void 0),t=e();if(t.length>0)return a=t[0],console.log("‚úÖ [Firebase] Using existing app instance"),typeof window<"u"&&(window.firebaseApp=a),a}catch(e){console.warn("‚ö†Ô∏è [Firebase] Failed to get existing apps:",e)}try{return a=v(R,"fallback"),console.log("‚úÖ [Firebase] Created fallback app instance"),typeof window<"u"&&(window.firebaseApp=a),a}catch(e){throw console.error("‚ùå [Firebase] Failed to create fallback app:",e),new Error("Failed to initialize Firebase app")}}const u=a?I(a):I(),b=a?N(a):N();b&&A(async()=>{const{setPersistence:e,browserLocalPersistence:t}=await import("./index.esm-K73FumZQ.js");return{setPersistence:e,browserLocalPersistence:t}},__vite__mapDeps([0,1])).then(({setPersistence:e,browserLocalPersistence:t})=>{e(b,t).catch(o=>{console.warn("‚ö†Ô∏è [Firebase] Failed to set auth persistence:",o)})}).catch(e=>{console.warn("‚ö†Ô∏è [Firebase] Failed to import auth persistence:",e)});async function me(){const e=await ee();return{app:e,db:I(e),auth:N(e)}}function te(){if(!(typeof window>"u"))try{console.log("‚ÑπÔ∏è [Firebase] Skipping client-side CSP override - relying on Firebase hosting CSP");const e=document.querySelector('meta[http-equiv="Content-Security-Policy"]');e&&(e.remove(),console.log("üßπ [Firebase] Removed conflicting client-side CSP meta tag"))}catch(e){console.warn("‚ö†Ô∏è [Firebase] Failed to clean up CSP:",e)}}te();typeof window<"u"&&(window.FIREBASE_IGNORE_UNDEFINED_PROPERTIES=!0);console.log("üåê [Firebase] Licensing website mode: production (web-only) - no emulators");const de=()=>!0;let T=!1;const pe=async()=>{if(!T)try{const{firestoreCollectionManager:e}=await A(async()=>{const{firestoreCollectionManager:t}=await import("./FirestoreCollectionManager-D5wVqmZA.js");return{firestoreCollectionManager:t}},__vite__mapDeps([2,3,4,5,6,7,8,1,0]));await e.initializeCollections(),T=!0,console.log("‚úÖ [Firebase] Collection manager initialized")}catch(e){console.error("‚ùå [Firebase] Failed to initialize collection manager:",e)}},ue=()=>b.currentUser!==null,ge=()=>b.currentUser,re=e=>{var t;return((t=b.currentUser)==null?void 0:t.email)===e},be=async e=>{var t,o;try{const{doc:i,getDoc:n,query:g,collection:s,where:c,getDocs:p}=await A(async()=>{const{doc:y,getDoc:h,query:_,collection:C,where:j,getDocs:z}=await import("./index.esm-C6E5jVjx.js");return{doc:y,getDoc:h,query:_,collection:C,where:j,getDocs:z}},__vite__mapDeps([8,1]));let m=await n(i(u,"users",e.uid)),r=null,l=null;if(m.exists())r=m.data(),l=m.id,console.log("‚úÖ [Firebase] Found user by Firebase UID:",r.email);else{const y=g(s(u,"users"),c("email","==",e.email)),h=await p(y);h.empty||(r=h.docs[0].data(),l=h.docs[0].id,console.log("‚úÖ [Firebase] Found user by email:",r.email))}return r&&l?{id:l,email:r.email,name:r.name||r.displayName||e.displayName||r.email.split("@")[0],role:r.role||"USER",organizationId:r.organizationId,isTeamMember:r.isTeamMember,memberRole:r.memberRole,memberStatus:r.memberStatus,firebaseUid:e.uid,subscription:r.subscription,licenses:r.licenses,teamMemberData:r.teamMemberData}:{id:e.uid,email:e.email||"",name:e.displayName||((t=e.email)==null?void 0:t.split("@")[0])||"User",role:"USER",firebaseUid:e.uid}}catch(i){return console.warn("‚ö†Ô∏è [Firebase] Failed to load user from Firestore:",i),{id:e.uid,email:e.email||"",name:e.displayName||((o=e.email)==null?void 0:o.split("@")[0])||"User",role:"USER",firebaseUid:e.uid}}},fe=async e=>{try{if(console.log("üîë [Firebase] Attempting to restore Firebase Auth session for:",e),re(e))return console.log("‚úÖ [Firebase] User already authenticated with correct email"),!0;if(b.currentUser&&b.currentUser.email!==e){console.log("üîÑ [Firebase] Different user authenticated, signing out first");const{signOut:t}=await A(async()=>{const{signOut:o}=await import("./index.esm-K73FumZQ.js");return{signOut:o}},__vite__mapDeps([0,1]));await t(b)}try{const t=localStorage.getItem("temp_credentials");if(t){const o=JSON.parse(t);if(o.email===e&&o.password){console.log("üîë [Firebase] Attempting to restore Firebase Auth session with stored credentials");const{signInWithEmailAndPassword:i}=await A(async()=>{const{signInWithEmailAndPassword:n}=await import("./index.esm-K73FumZQ.js");return{signInWithEmailAndPassword:n}},__vite__mapDeps([0,1]));return await i(b,e,o.password),console.log("‚úÖ [Firebase] Firebase Auth session restored successfully"),!0}}}catch(t){console.warn("‚ö†Ô∏è [Firebase] Could not restore session with stored credentials:",t)}return console.log("‚ÑπÔ∏è [Firebase] No stored credentials available for session restoration"),!1}catch(t){return console.warn("‚ö†Ô∏è [Firebase] Error during session restoration:",t),!1}};class we{static async getOrganizationsForUser(t){try{console.log("üîç [Firebase] Getting organizations for user:",t);const o=w(f(u,"organizations"),d("ownerUserId","==",t)),i=await F(o),n=w(f(u,"org_members"),d("userId","==",t),d("status","==","ACTIVE")),g=await F(n),s=new Set,c=[];i.forEach(p=>{const m={id:p.id,...p.data()};c.push(m),s.add(p.id)});for(const p of g.docs){const r=p.data().orgId;if(!s.has(r)){const l=await P(E(u,"organizations",r));if(l.exists()){const y={id:l.id,...l.data()};c.push(y),s.add(r)}}}return console.log("‚úÖ [Firebase] Found organizations:",c.length),c}catch(o){return console.error("‚ùå [Firebase] Error getting organizations:",o),[]}}static async getOrgMembers(t){try{console.log("üîç [Firebase] Getting org members for:",t);const o=w(f(u,"org_members"),d("orgId","==",t),d("status","==","ACTIVE"),W("createdAt","desc")),i=await F(o),n=[];return i.forEach(g=>{const s=g.data();let c=s.name;c||(s.firstName&&s.lastName?c=`${s.firstName} ${s.lastName}`:s.firstName?c=s.firstName:s.lastName?c=s.lastName:s.email?c=s.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "):c="Unknown User");const p={id:g.id,...s,name:c};n.push(p)}),console.log("‚úÖ [Firebase] Found org members:",n.length),n}catch(o){return console.error("‚ùå [Firebase] Error getting org members:",o),[]}}static async getProjectTeamMembers(t){try{console.log("üîç [Firebase] Getting project team members for:",t);const o=w(f(u,"projectTeamMembers"),d("projectId","==",t),d("isActive","==",!0)),i=await F(o),n=[];for(const g of i.docs){const s=g.data();let c;try{const m=await P(E(u,"org_members",s.teamMemberId));if(m.exists()){const r=m.data();let l=r.name;l||(r.firstName&&r.lastName?l=`${r.firstName} ${r.lastName}`:r.firstName?l=r.firstName:r.lastName?l=r.lastName:r.email?l=r.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(_=>_.charAt(0).toUpperCase()+_.slice(1).toLowerCase()).join(" "):l="Unknown User"),c={id:m.id,...r,name:l}}}catch(m){console.warn("Failed to get team member details:",m)}const p={id:g.id,...s,teamMember:c};n.push(p)}return console.log("‚úÖ [Firebase] Found project team members:",n.length),n}catch(o){return console.error("‚ùå [Firebase] Error getting project team members:",o),[]}}static async addTeamMemberToProject(t,o,i="DO_ER"){try{console.log("üîç [Firebase] Adding team member to project:",{projectId:t,teamMemberId:o,role:i});const n=w(f(u,"projectTeamMembers"),d("projectId","==",t),d("teamMemberId","==",o),d("isActive","==",!0));if(!(await F(n)).empty)throw new Error("Team member is already assigned to this project");if(i==="ADMIN"){const m=w(f(u,"projectTeamMembers"),d("projectId","==",t),d("role","==","ADMIN"),d("isActive","==",!0));if(!(await F(m)).empty)throw new Error("Only one Admin is allowed per project. Please remove the existing Admin first.")}const s={projectId:t,teamMemberId:o,role:i,assignedAt:new Date,assignedBy:"current_user",isActive:!0},c=Object.fromEntries(Object.entries(s).filter(([m,r])=>r!=null)),p=await Y(f(u,"projectTeamMembers"),c);return console.log("‚úÖ [Firebase] Team member added successfully:",p.id),{id:p.id,...s}}catch(n){throw console.error("‚ùå [Firebase] Error adding team member:",n),n}}static async removeTeamMemberFromProject(t,o){try{console.log("üîç [Firebase] Removing team member from project:",{projectId:t,teamMemberId:o});const i=w(f(u,"projectTeamMembers"),d("projectId","==",t),d("teamMemberId","==",o),d("isActive","==",!0)),n=await F(i);for(const g of n.docs)await $(E(u,"projectTeamMembers",g.id));console.log("‚úÖ [Firebase] Team member removed successfully")}catch(i){throw console.error("‚ùå [Firebase] Error removing team member:",i),i}}}export{we as FirebaseTeamMemberService,a as app,b as auth,u as db,we as default,b as firebaseAuth,u as firestore,te as fixCSPIssues,ge as getCurrentFirebaseUser,me as getInitializedServices,pe as initializeFirebaseCollections,re as isEmailAuthenticated,ue as isUserAuthenticated,de as isWebOnlyMode,be as loadUserFromFirestore,fe as tryRestoreFirebaseSession};
