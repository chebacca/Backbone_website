const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.esm-DeaBpi77.js","assets/index.esm-DmQE6AXN.js","assets/FirestoreCollectionManager-DizwdHvm.js","assets/index-BIhenV_W.js","assets/mui-Cr9U6iW2.js","assets/vendor-CjD1bmmO.js","assets/stripe-ggaMUove.js","assets/index-CBai7h7s.css","assets/index.esm-B4qVkIPL.js"])))=>i.map(i=>d[i]);
import{_}from"./index-BIhenV_W.js";import{r as T,i as N,S as z,D as O,_ as U,a as x,b as V,c as L,d as k,e as q,f as Q,g as B,h as G,F as K}from"./index.esm-DmQE6AXN.js";import{getFirestore as S,query as F,collection as f,where as m,getDocs as w,getDoc as v,doc as E,orderBy as W,addDoc as Y,deleteDoc as $}from"./index.esm-B4qVkIPL.js";import{getAuth as I}from"./index.esm-DeaBpi77.js";import"./mui-Cr9U6iW2.js";import"./vendor-CjD1bmmO.js";import"./stripe-ggaMUove.js";var J="firebase",X="12.1.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */T(J,X,"app");const Z=Object.freeze(Object.defineProperty({__proto__:null,FirebaseError:K,SDK_VERSION:z,_DEFAULT_ENTRY_NAME:O,_addComponent:U,_apps:x,_components:V,_getProvider:L,_isFirebaseServerApp:k,_registerComponent:q,_serverApps:Q,getApp:B,getApps:G,initializeApp:N,registerVersion:T},Symbol.toStringTag,{value:"Module"})),D={},H=()=>typeof window<"u"&&window.FIREBASE_CONFIG?window.FIREBASE_CONFIG:{apiKey:(D==null?void 0:D.VITE_FIREBASE_API_KEY)||"AIzaSyDFnIzSYCdPsDDdvP1lympVxEeUn0AQhWs",authDomain:"backbone-logic.firebaseapp.com",projectId:"backbone-logic",storageBucket:"backbone-logic.firebasestorage.app",messagingSenderId:"749245129278",appId:"1:749245129278:web:dfa5647101ea160a3b276f",measurementId:"G-8SZRDQ4XVR"},M=H();let g;try{g=N(M),console.log("üî• [Firebase] App initialized successfully")}catch(e){console.log("‚ÑπÔ∏è [Firebase] App already initialized or error:",e)}async function ee(){if(g)return g;try{const{getApps:e}=await _(async()=>{const{getApps:o}=await Promise.resolve().then(()=>Z);return{getApps:o}},void 0),t=e();if(t.length>0)return g=t[0],console.log("‚úÖ [Firebase] Using existing app instance"),g}catch(e){console.warn("‚ö†Ô∏è [Firebase] Failed to get existing apps:",e)}try{return g=N(M,"fallback"),console.log("‚úÖ [Firebase] Created fallback app instance"),g}catch(e){throw console.error("‚ùå [Firebase] Failed to create fallback app:",e),new Error("Failed to initialize Firebase app")}}const u=g?S(g):S(),b=g?I(g):I();b&&_(async()=>{const{setPersistence:e,browserLocalPersistence:t}=await import("./index.esm-DeaBpi77.js");return{setPersistence:e,browserLocalPersistence:t}},__vite__mapDeps([0,1])).then(({setPersistence:e,browserLocalPersistence:t})=>{e(b,t).catch(o=>{console.warn("‚ö†Ô∏è [Firebase] Failed to set auth persistence:",o)})}).catch(e=>{console.warn("‚ö†Ô∏è [Firebase] Failed to import auth persistence:",e)});async function me(){const e=await ee();return{app:e,db:S(e),auth:I(e)}}function te(){if(!(typeof window>"u"))try{console.log("‚ÑπÔ∏è [Firebase] Skipping client-side CSP override - relying on Firebase hosting CSP");const e=document.querySelector('meta[http-equiv="Content-Security-Policy"]');e&&(e.remove(),console.log("üßπ [Firebase] Removed conflicting client-side CSP meta tag"))}catch(e){console.warn("‚ö†Ô∏è [Firebase] Failed to clean up CSP:",e)}}te();typeof window<"u"&&(window.FIREBASE_IGNORE_UNDEFINED_PROPERTIES=!0);console.log("üåê [Firebase] Licensing website mode: production (web-only) - no emulators");const de=()=>!0;let P=!1;const ue=async()=>{if(!P)try{const{firestoreCollectionManager:e}=await _(async()=>{const{firestoreCollectionManager:t}=await import("./FirestoreCollectionManager-DizwdHvm.js");return{firestoreCollectionManager:t}},__vite__mapDeps([2,3,4,5,6,7,8,1,0]));await e.initializeCollections(),P=!0,console.log("‚úÖ [Firebase] Collection manager initialized")}catch(e){console.error("‚ùå [Firebase] Failed to initialize collection manager:",e)}},pe=()=>b.currentUser!==null,ge=()=>b.currentUser,re=e=>{var t;return((t=b.currentUser)==null?void 0:t.email)===e},be=async e=>{var t,o;try{const{doc:a,getDoc:i,query:p,collection:s,where:n,getDocs:d}=await _(async()=>{const{doc:y,getDoc:h,query:A,collection:C,where:R,getDocs:j}=await import("./index.esm-B4qVkIPL.js");return{doc:y,getDoc:h,query:A,collection:C,where:R,getDocs:j}},__vite__mapDeps([8,1]));let l=await i(a(u,"users",e.uid)),r=null,c=null;if(l.exists())r=l.data(),c=l.id,console.log("‚úÖ [Firebase] Found user by Firebase UID:",r.email);else{const y=p(s(u,"users"),n("email","==",e.email)),h=await d(y);h.empty||(r=h.docs[0].data(),c=h.docs[0].id,console.log("‚úÖ [Firebase] Found user by email:",r.email))}return r&&c?{id:c,email:r.email,name:r.name||r.displayName||e.displayName||r.email.split("@")[0],role:r.role||"USER",organizationId:r.organizationId,isTeamMember:r.isTeamMember,memberRole:r.memberRole,memberStatus:r.memberStatus,firebaseUid:e.uid,subscription:r.subscription,licenses:r.licenses,teamMemberData:r.teamMemberData}:{id:e.uid,email:e.email||"",name:e.displayName||((t=e.email)==null?void 0:t.split("@")[0])||"User",role:"USER",firebaseUid:e.uid}}catch(a){return console.warn("‚ö†Ô∏è [Firebase] Failed to load user from Firestore:",a),{id:e.uid,email:e.email||"",name:e.displayName||((o=e.email)==null?void 0:o.split("@")[0])||"User",role:"USER",firebaseUid:e.uid}}},fe=async e=>{try{if(console.log("üîë [Firebase] Attempting to restore Firebase Auth session for:",e),re(e))return console.log("‚úÖ [Firebase] User already authenticated with correct email"),!0;if(b.currentUser&&b.currentUser.email!==e){console.log("üîÑ [Firebase] Different user authenticated, signing out first");const{signOut:t}=await _(async()=>{const{signOut:o}=await import("./index.esm-DeaBpi77.js");return{signOut:o}},__vite__mapDeps([0,1]));await t(b)}try{const t=localStorage.getItem("temp_credentials");if(t){const o=JSON.parse(t);if(o.email===e&&o.password){console.log("üîë [Firebase] Attempting to restore Firebase Auth session with stored credentials");const{signInWithEmailAndPassword:a}=await _(async()=>{const{signInWithEmailAndPassword:i}=await import("./index.esm-DeaBpi77.js");return{signInWithEmailAndPassword:i}},__vite__mapDeps([0,1]));return await a(b,e,o.password),console.log("‚úÖ [Firebase] Firebase Auth session restored successfully"),!0}}}catch(t){console.warn("‚ö†Ô∏è [Firebase] Could not restore session with stored credentials:",t)}return console.log("‚ÑπÔ∏è [Firebase] No stored credentials available for session restoration"),!1}catch(t){return console.warn("‚ö†Ô∏è [Firebase] Error during session restoration:",t),!1}};class Fe{static async getOrganizationsForUser(t){try{console.log("üîç [Firebase] Getting organizations for user:",t);const o=F(f(u,"organizations"),m("ownerUserId","==",t)),a=await w(o),i=F(f(u,"org_members"),m("userId","==",t),m("status","==","ACTIVE")),p=await w(i),s=new Set,n=[];a.forEach(d=>{const l={id:d.id,...d.data()};n.push(l),s.add(d.id)});for(const d of p.docs){const r=d.data().orgId;if(!s.has(r)){const c=await v(E(u,"organizations",r));if(c.exists()){const y={id:c.id,...c.data()};n.push(y),s.add(r)}}}return console.log("‚úÖ [Firebase] Found organizations:",n.length),n}catch(o){return console.error("‚ùå [Firebase] Error getting organizations:",o),[]}}static async getOrgMembers(t){try{console.log("üîç [Firebase] Getting org members for:",t);const o=F(f(u,"org_members"),m("orgId","==",t),m("status","==","ACTIVE"),W("createdAt","desc")),a=await w(o),i=[];return a.forEach(p=>{const s=p.data();let n=s.name;n||(s.firstName&&s.lastName?n=`${s.firstName} ${s.lastName}`:s.firstName?n=s.firstName:s.lastName?n=s.lastName:s.email?n=s.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(c=>c.charAt(0).toUpperCase()+c.slice(1).toLowerCase()).join(" "):n="Unknown User");const d={id:p.id,...s,name:n};i.push(d)}),console.log("‚úÖ [Firebase] Found org members:",i.length),i}catch(o){return console.error("‚ùå [Firebase] Error getting org members:",o),[]}}static async getProjectTeamMembers(t){try{console.log("üîç [Firebase] Getting project team members for:",t);const o=F(f(u,"projectTeamMembers"),m("projectId","==",t),m("isActive","==",!0)),a=await w(o),i=[];for(const p of a.docs){const s=p.data();let n;try{const l=await v(E(u,"org_members",s.teamMemberId));if(l.exists()){const r=l.data();let c=r.name;c||(r.firstName&&r.lastName?c=`${r.firstName} ${r.lastName}`:r.firstName?c=r.firstName:r.lastName?c=r.lastName:r.email?c=r.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(A=>A.charAt(0).toUpperCase()+A.slice(1).toLowerCase()).join(" "):c="Unknown User"),n={id:l.id,...r,name:c}}}catch(l){console.warn("Failed to get team member details:",l)}const d={id:p.id,...s,teamMember:n};i.push(d)}return console.log("‚úÖ [Firebase] Found project team members:",i.length),i}catch(o){return console.error("‚ùå [Firebase] Error getting project team members:",o),[]}}static async addTeamMemberToProject(t,o,a="DO_ER"){try{console.log("üîç [Firebase] Adding team member to project:",{projectId:t,teamMemberId:o,role:a});const i=F(f(u,"projectTeamMembers"),m("projectId","==",t),m("teamMemberId","==",o),m("isActive","==",!0));if(!(await w(i)).empty)throw new Error("Team member is already assigned to this project");if(a==="ADMIN"){const l=F(f(u,"projectTeamMembers"),m("projectId","==",t),m("role","==","ADMIN"),m("isActive","==",!0));if(!(await w(l)).empty)throw new Error("Only one Admin is allowed per project. Please remove the existing Admin first.")}const s={projectId:t,teamMemberId:o,role:a,assignedAt:new Date,assignedBy:"current_user",isActive:!0},n=Object.fromEntries(Object.entries(s).filter(([l,r])=>r!=null)),d=await Y(f(u,"projectTeamMembers"),n);return console.log("‚úÖ [Firebase] Team member added successfully:",d.id),{id:d.id,...s}}catch(i){throw console.error("‚ùå [Firebase] Error adding team member:",i),i}}static async removeTeamMemberFromProject(t,o){try{console.log("üîç [Firebase] Removing team member from project:",{projectId:t,teamMemberId:o});const a=F(f(u,"projectTeamMembers"),m("projectId","==",t),m("teamMemberId","==",o),m("isActive","==",!0)),i=await w(a);for(const p of i.docs)await $(E(u,"projectTeamMembers",p.id));console.log("‚úÖ [Firebase] Team member removed successfully")}catch(a){throw console.error("‚ùå [Firebase] Error removing team member:",a),a}}}export{Fe as FirebaseTeamMemberService,g as app,b as auth,u as db,Fe as default,b as firebaseAuth,u as firestore,te as fixCSPIssues,ge as getCurrentFirebaseUser,me as getInitializedServices,ue as initializeFirebaseCollections,re as isEmailAuthenticated,pe as isUserAuthenticated,de as isWebOnlyMode,be as loadUserFromFirestore,fe as tryRestoreFirebaseSession};
